<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>CodeQL on Yuy0ung的知识库</title>
    <link>https://yuy0ung.github.io/blog/sdl/sast/codeql/</link>
    <description>Recent content in CodeQL on Yuy0ung的知识库</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Wed, 17 Dec 2025 00:00:00 +0800</lastBuildDate>
    <atom:link href="https://yuy0ung.github.io/blog/sdl/sast/codeql/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>CodeQL基础</title>
      <link>https://yuy0ung.github.io/blog/sdl/sast/codeql/codeql%E5%9F%BA%E7%A1%80/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://yuy0ung.github.io/blog/sdl/sast/codeql/codeql%E5%9F%BA%E7%A1%80/</guid>
      <description>&lt;h1 id=&#34;codeql基础&#34;&gt;CodeQL基础&lt;/h1&gt;&#xA;&lt;h2 id=&#34;配置&#34;&gt;配置&lt;/h2&gt;&#xA;&lt;p&gt;简单说一下环境配置&lt;/p&gt;&#xA;&lt;p&gt;引擎地址：https://github.com/github/codeql-cli-binaries/releases，下载后配置环境变量：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/QQ_1764324742906.png&#34; alt=&#34;QQ_1764324742906&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;然后安装sdk：https://github.com/github/codeql，改名成ql，放在之前引擎的同目录下：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20251128181257723.png&#34; alt=&#34;image-20251128181257723&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;然后在vscode安装插件：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/QQ_1764324799890.png&#34; alt=&#34;QQ_1764324799890&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;在设置里添加一下CodeQL可执行文件的位置：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20251128181342913.png&#34; alt=&#34;image-20251128181342913&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;用CodeQL分析项目本质是执行查询，首先需要去待审计源代码的根目录建立分析数据库，我这里分析的一个开源的漏洞合集：https://github.com/l4yn3/micro_service_seclab/&lt;/p&gt;&#xA;&lt;p&gt;首先要建立分析数据库：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;codeql database create javaseclabstest --language&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;java&amp;#34;&lt;/span&gt; --command&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;mvn clean install -Dmaven.test.skip=true&amp;#34;&lt;/span&gt; --source-root&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/Users/yuy0ung/Desktop/SAST/micro_service_seclab-main&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20251203175126741.png&#34; alt=&#34;image-20251203175126741&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;执行成功你应该可以在这个目录里看到一个codeqltest目录:&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/QQ_1764325090840.png&#34; alt=&#34;QQ_1764325090840&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;接着我们在vscode引入这个目录：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/QQ_1764502485467.png&#34; alt=&#34;QQ_1764502485467&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;然后我们新建一个query： &lt;code&gt;demo.ql&lt;/code&gt;，内容为&lt;code&gt;select &amp;quot;Hello World&lt;/code&gt;“，位置为&lt;code&gt;CodeQL/ql/java/ql/examples/test.ql&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;接下来运行query：&#xA;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20251202172201418.png&#34; alt=&#34;image-20251202172201418&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以看到结果输出了hello world，说明配置没有问题了&lt;/p&gt;&#xA;&lt;h2 id=&#34;codeql基础语法&#34;&gt;CodeQL基础语法&lt;/h2&gt;&#xA;&lt;h3 id=&#34;ql语法&#34;&gt;ql语法&lt;/h3&gt;&#xA;&lt;p&gt;说白了就是查询语法，QL查询的语法结构为：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datatype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;condition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;something&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;比如：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&#xA;&lt;li&gt;第一行表示我们要引入CodeQL的类库，因为我们分析的项目是java的，所以要import java（如果QL文件在 &lt;code&gt;ql\java\ql\&lt;/code&gt; 目录中时就不需要 &lt;code&gt;import java&lt;/code&gt; 了，因为这是 CodeQL 标准库目录，其会自动隐式加载该目录下的依赖，但如果写在其他目录下就需要手动 &lt;code&gt;import java&lt;/code&gt; ，包括其子目录）&lt;/li&gt;&#xA;&lt;li&gt;第三行表示定义一个int型变量i，表示我们获取所有的int类型的数据&lt;/li&gt;&#xA;&lt;li&gt;第四行为判定条件&lt;/li&gt;&#xA;&lt;li&gt;第五行为输出i&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;也就是说在所有的整形数字i中，当i==1的时候，就输出i，按照这个逻辑，最终的输出就应该为1:&#xA;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20251203135714622.png&#34; alt=&#34;image-20251203135714622&#34;&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>使用CodeQL进行白盒扫描</title>
      <link>https://yuy0ung.github.io/blog/sdl/sast/codeql/%E4%BD%BF%E7%94%A8codeql%E8%BF%9B%E8%A1%8C%E7%99%BD%E7%9B%92%E6%89%AB%E6%8F%8F/</link>
      <pubDate>Wed, 17 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://yuy0ung.github.io/blog/sdl/sast/codeql/%E4%BD%BF%E7%94%A8codeql%E8%BF%9B%E8%A1%8C%E7%99%BD%E7%9B%92%E6%89%AB%E6%8F%8F/</guid>
      <description>&lt;h1 id=&#34;使用codeql进行白盒扫描&#34;&gt;使用CodeQL进行白盒扫描&lt;/h1&gt;&#xA;&lt;p&gt;接下来学点不一样的，从企业安全建设角度出发，我们通常会根据codeQL提供的的CWE漏洞规则，针对代码进行扫描，我们选取以下CWE规则：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;【注入类】&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- SQL Injection (089)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- XSS (079)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- Command Exec (078)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- Expression / Code Injection (094)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- SSRF (918)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- XXE (611)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;【资源访问类】&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- Path Traversal (22)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;【反序列化】&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- Unsafe Deserialization (502)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;【认证授权】&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- Authentication Bypass (287)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- Authorization Bypass (807)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;【敏感信息】&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- Hardcoded Credentials (798)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;接下来以https://github.com/whgojp/JavaSecLab/项目为例&lt;/p&gt;&#xA;&lt;h2 id=&#34;sql注入&#34;&gt;SQL注入&lt;/h2&gt;&#xA;&lt;p&gt;我们使用codeql官方的规则进行sql注入扫描（记得先构建数据库）：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;codeql database analyze ~/tools/CodeQL/db/javasecpro &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  codeql/java-queries:Security/CWE/CWE-089 &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --format&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sarif-latest &lt;span class=&#34;se&#34;&gt;\&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --output&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sql.sarif&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20251216104533092.png&#34; alt=&#34;image-20251216104533092&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以看到扫描完成后在文件夹新增了一个sarif文件，这个就是扫描结果文件，可以在vscode下载sarif viewer插件进行解析查看：&#xA;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/6f2bac46131bc294ac75406979531746.png&#34; alt=&#34;6f2bac46131bc294ac75406979531746&#34;&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
