<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>waf对抗 on Yuy0ung的知识库</title>
    <link>https://yuy0ung.github.io/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/</link>
    <description>Recent content in waf对抗 on Yuy0ung的知识库</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Thu, 11 Dec 2025 00:00:00 +0800</lastBuildDate>
    <atom:link href="https://yuy0ung.github.io/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>waf笔记</title>
      <link>https://yuy0ung.github.io/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/waf%E7%AC%94%E8%AE%B0/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://yuy0ung.github.io/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/waf%E7%AC%94%E8%AE%B0/</guid>
      <description>&lt;h1 id=&#34;waf笔记&#34;&gt;waf笔记&lt;/h1&gt;&#xA;&lt;p&gt;记录一下攻防演练中waf相关见闻&lt;/p&gt;&#xA;&lt;h2 id=&#34;常见漏洞通用bypass&#34;&gt;常见漏洞通用bypass&lt;/h2&gt;&#xA;&lt;p&gt;常见漏洞中一些通用的值得尝试的方法&lt;/p&gt;&#xA;&lt;h3 id=&#34;shiro&#34;&gt;shiro&lt;/h3&gt;&#xA;&lt;p&gt;一位师傅说的：&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;一部分shiro相关waf有一个检测步骤：&lt;/p&gt;&#xA;&lt;p&gt;将rememberMe的值用最常见的默认key去尝试解密，然后查看是否有敏感参数比如命令执行语句&lt;/p&gt;&#xA;&lt;p&gt;所以默认key的shiro攻击很容易被waf&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;将请求包的method改为随机字符串，比如&lt;code&gt;GET&lt;/code&gt;改为&lt;code&gt;xxxxT&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;method置空，比如直接删掉&lt;code&gt;GET&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;脏数据，在cookie的&lt;code&gt;rememberMe=&lt;/code&gt;后面增加一些特殊字符&lt;code&gt;.&lt;/code&gt;或`（因为shiro处理点号、反引号等会直接去除）&#xA;&lt;ul&gt;&#xA;&lt;li&gt;空白字段，在&lt;code&gt;rememberMe=&lt;/code&gt;中添加&amp;quot;tab&amp;quot;锁进变为&lt;code&gt;rememberMe&#x9;&#x9;&#x9;=&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;Host头的域名改为IP能绕过一部分只防护域名的云waf&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;常见waf&#34;&gt;常见waf&lt;/h2&gt;&#xA;&lt;p&gt;由于一直试通用的bypass比较费时间，所以记住一些常见waf的特性肯定会事半功倍&lt;/p&gt;&#xA;&lt;h3 id=&#34;电信云堤&#34;&gt;电信云堤&lt;/h3&gt;&#xA;&lt;p&gt;打shiro遇到的：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250605171031177.png&#34; alt=&#34;image-20250605171031177&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;师傅说这个waf和大部分云waf都有个特性就是有可能只防护了域名，对此的bypass手法就是在请求包host头中把域名改成真实IP&lt;/p&gt;&#xA;&lt;h3 id=&#34;奇安信网站卫士&#34;&gt;奇安信网站卫士&lt;/h3&gt;&#xA;&lt;p&gt;默认key打shiro偶遇的，拼尽全力无法战胜&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250605172012851.png&#34; alt=&#34;image-20250605172012851&#34;&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>XSS_tricks</title>
      <link>https://yuy0ung.github.io/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/xss_tricks/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://yuy0ung.github.io/blog/%E6%B8%97%E9%80%8F/waf%E5%AF%B9%E6%8A%97/xss_tricks/</guid>
      <description>&lt;h1 id=&#34;xss_tricks&#34;&gt;XSS_tricks&lt;/h1&gt;&#xA;&lt;p&gt;记录一些适用于bypass waf的XSS小tricks&lt;/p&gt;&#xA;&lt;p&gt;以及一些不是很容易想到的可以测试XSS的场景&lt;/p&gt;&#xA;&lt;h2 id=&#34;巧用反引号&#34;&gt;巧用反引号&lt;/h2&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;该trick来自于0xsdeo师傅的Spade sec公众号&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;反引号可以达到一个不用括号的效果，很适合用于&lt;code&gt;()&lt;/code&gt;括号被转义后的情况&lt;/p&gt;&#xA;&lt;p&gt;比如下面几个demo：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;控制台输出：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;console&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`1`&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;弹窗：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;alert&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`1`&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;在这里，反引号引起来的内容叫做模板字面量，又称模板字符串，在es6中一般用来字符串插值：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Yuy0ung&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sb&#34;&gt;`hello &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;效果如下：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250510100006369.png&#34; alt=&#34;image-20250510100006369&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;在除了这种用法外，就是我们payload的用法了，即配合默认或自定义标签函数&lt;/p&gt;&#xA;&lt;p&gt;那么，除了弹窗和控制台输出，获取cookie就需要再构造一下了，思路和上面的字符串插值很像：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;console&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;document&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cookie&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;sb&#34;&gt;`&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250510102443520.png&#34; alt=&#34;image-20250510102443520&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以注意到这里有一个多余的数组，具体原因可以查阅es6文档，这里不做赘述&lt;/p&gt;&#xA;&lt;p&gt;当然这个数组会导致我们使用alet弹不出cookie，所以推荐使用console.log&lt;/p&gt;&#xA;&lt;p&gt;**总结：**上面的payload优势在于反引号、&lt;code&gt;$&lt;/code&gt;、&lt;code&gt;{}&lt;/code&gt;三种符号不容易被转义，巧用了模板字面量的特性&lt;/p&gt;&#xA;&lt;h3 id=&#34;文件上传xss的content-type绕过&#34;&gt;文件上传XSS的content-type绕过&lt;/h3&gt;&#xA;&lt;p&gt;除了常规的&lt;code&gt;text/html&lt;/code&gt;的content-type，还可以有一些其他的：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;text/htm&lt;/li&gt;&#xA;&lt;li&gt;htm/text&lt;/li&gt;&#xA;&lt;li&gt;html/text&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;都可以试一试，主要基于后端的配置，在思考bypass的时候可以从这方面进行思考&lt;/p&gt;&#xA;&lt;h2 id=&#34;可能存在xss的非常规场景&#34;&gt;可能存在XSS的非常规场景&lt;/h2&gt;&#xA;&lt;h3 id=&#34;ocr服务处&#34;&gt;OCR服务处&lt;/h3&gt;&#xA;&lt;p&gt;比如有些功能点支持OCR识别发票文字内容并输出，那么我们可以在图片上P一个XSS的payload进行测试，这是一个很巧妙的思路&lt;/p&gt;&#xA;&lt;h3 id=&#34;hidden标签处&#34;&gt;hidden标签处&lt;/h3&gt;&#xA;&lt;p&gt;F12全局搜索hidden标签，可能找到一些不显示但是内容可控的标签，比如用于页面跳转功能的隐藏标签，比如下面这个demo：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250510110728205.png&#34; alt=&#34;image-20250510110728205&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;name是ReturnUrl，这里尝试直接GET传参：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250510110750381.png&#34; alt=&#34;image-20250510110750381&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;发现value可控，那么就可以尝试构造闭合：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250510110909523.png&#34; alt=&#34;image-20250510110909523&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以看见成功闭合了，那么接下来就是直接打XSS：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20250510111140278.png&#34; alt=&#34;image-20250510111140278&#34;&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
