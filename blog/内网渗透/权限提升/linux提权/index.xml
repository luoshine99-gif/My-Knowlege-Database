<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>linux提权 on mrlxl的知识库</title>
    <link>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/</link>
    <description>Recent content in linux提权 on mrlxl的知识库</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Thu, 11 Dec 2025 00:00:00 +0800</lastBuildDate>
    <atom:link href="https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Linux内核提权</title>
      <link>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/linux%E5%86%85%E6%A0%B8%E6%8F%90%E6%9D%83/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/linux%E5%86%85%E6%A0%B8%E6%8F%90%E6%9D%83/</guid>
      <description>&lt;h1 id=&#34;linux内核提权&#34;&gt;Linux内核提权&lt;/h1&gt;&#xA;&lt;p&gt;顾名思义，即利用Linux内核漏洞进行提权，一般包含三个环节：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;对目标系统进行信息收集，获取到系统内核信息以及版本信息&lt;/li&gt;&#xA;&lt;li&gt;根据内核版本获取其对应的漏洞以及EXP&lt;/li&gt;&#xA;&lt;li&gt;使用找到的EXP对目标系统发起攻击，完成提权操作&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 id=&#34;内核溢出&#34;&gt;内核溢出&lt;/h3&gt;&#xA;&lt;p&gt;漏洞的原理更偏向于pwn，指在操作系统内核空间发生的缓冲区溢出漏洞。即程序没有正确验证输入数据的大小时，多出的数据会覆盖相邻的内存，导致安全问题&lt;/p&gt;&#xA;&lt;h4 id=&#34;信息收集&#34;&gt;信息收集&lt;/h4&gt;&#xA;&lt;p&gt;首先需要对Linux发行版本、内核版本进行信息收集，这里以我的CentOS 7为例，展示以下常用命令的输出内容：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;uname -a&#x9;&lt;span class=&#34;c1&#34;&gt;# 查看系统全部信息&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240725161409405-752791162.png&#34; alt=&#34;image-20240725161408117&#34;&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat /etc/issue&#x9;&lt;span class=&#34;c1&#34;&gt;# 查看Linux 系统的版本信息&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240725162646942-1297550049.png&#34; alt=&#34;image-20240725162645654&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;不知道什么原因，这里文件中的占位符没有被解析，这些占位符的意思：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;\S&lt;/code&gt;：这表示系统的名称。在许多 Linux 发行版中，这通常会被替换为具体的发行版名称（例如 &amp;ldquo;Kali Linux&amp;rdquo;）。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;\r&lt;/code&gt;：这一部分通常表示系统的版本号，这是内核的版本信息。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;\m&lt;/code&gt;：这表示机器的硬件架构。例如，它可能会返回 &lt;code&gt;x86_64&lt;/code&gt; 表示 64 位系统，或 &lt;code&gt;i686&lt;/code&gt; 表示 32 位系统。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat /etc/*-release&#x9;&lt;span class=&#34;c1&#34;&gt;# 查看Linux 系统的详细版本信息&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240725162848673-1081222333.png&#34; alt=&#34;image-20240725162847897&#34;&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lsb_release -a&#x9;&lt;span class=&#34;c1&#34;&gt;# 获取系统的详细信息，但系统不一定有lsb_release&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240725162918156-1519238975.png&#34; alt=&#34;image-20240725162917109&#34;&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat /proc/version&#x9;&lt;span class=&#34;c1&#34;&gt;# 查看 Linux 内核的版本信息及相关的编译信息&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240725162941634-562397514.png&#34; alt=&#34;image-20240725162940901&#34;&gt;&lt;/p&gt;&#xA;&lt;h4 id=&#34;查找exp&#34;&gt;查找exp&lt;/h4&gt;&#xA;&lt;p&gt;使用kali自带的searchsploit即可查找exp，例如查找Ubantu 15.04的漏洞：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;searchsploit Ubantu 15.04&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;查到后，比如exp的path为&lt;code&gt;linux/local/37088.c&lt;/code&gt;：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;查看exp：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;searchsploit -x linux/local/37088.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;有几点需要注意阅读：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;源码注释：了解源码编译方式&lt;/li&gt;&#xA;&lt;li&gt;源码内容：了解工作流程便于优化与修改，且避免存在恶意后门&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;复制exp到当前目录：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;searchsploit -m linux/local/37088.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 id=&#34;使用exp&#34;&gt;使用exp&lt;/h4&gt;&#xA;&lt;p&gt;通常使用wget等办法将exp传到受害主机上，并按照exp使用方法进行提权（借助搜素引擎查阅使用方法），通常来说：&lt;/p&gt;</description>
    </item>
    <item>
      <title>Linux提权-通配符提权</title>
      <link>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/linux%E6%8F%90%E6%9D%83-%E9%80%9A%E9%85%8D%E7%AC%A6%E6%8F%90%E6%9D%83/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/linux%E6%8F%90%E6%9D%83-%E9%80%9A%E9%85%8D%E7%AC%A6%E6%8F%90%E6%9D%83/</guid>
      <description>&lt;h1 id=&#34;linux提权-通配符提权&#34;&gt;Linux提权-通配符提权&lt;/h1&gt;&#xA;&lt;p&gt;通配符可以帮助用户提升工作效率，本身没有安全问题，但当其与潜在危险的命令结合时，就可能导致系统安全问题&lt;/p&gt;&#xA;&lt;h3 id=&#34;chown通配符劫持提权&#34;&gt;chown+通配符劫持提权&lt;/h3&gt;&#xA;&lt;p&gt;chown是linux中用于更改文件或目录所有权的命令&lt;/p&gt;&#xA;&lt;p&gt;当管理员通过chown加通配符的方式执行命令，渗透测试人员可以使用chown的&lt;code&gt;--reference&lt;/code&gt;参数达到文件所有者劫持的效果&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;--ference&lt;/code&gt;参数的用法如下：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--reference=&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;参考目录或文件&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# 更改目标文件的所有者为参考文件的所有者&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;接下来搭建一个场景&lt;/p&gt;&#xA;&lt;h4 id=&#34;环境配置&#34;&gt;环境配置&lt;/h4&gt;&#xA;&lt;p&gt;以root权限进行配置&lt;/p&gt;&#xA;&lt;p&gt;在&lt;code&gt;/tmp/pass&lt;/code&gt;目录下创建root.pass且权限为仅root可读：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Admin123456&amp;#34;&lt;/span&gt; &amp;gt; root.pass&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod &lt;span class=&#34;m&#34;&gt;400&lt;/span&gt; root.pass&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240924105356918-1087568988.png&#34; alt=&#34;image-20240924105355224&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;创建一个定时任务，原本目的为每分钟将&lt;code&gt;/tmp/pass&lt;/code&gt;目录下的.pass文件所有者更改为root：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* * * * * root cd /tmp/pass&amp;amp;&amp;amp;/bin/chown -R root:root *.pass&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;(由于是使用root权限设置的crontab，所以这里可以不注明root)&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240925224102394-1250089020.png&#34; alt=&#34;image-20240925224100059&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;环境配置完毕，切换用户到yuy0ung，开始利用&lt;/p&gt;&#xA;&lt;h4 id=&#34;漏洞利用&#34;&gt;漏洞利用&lt;/h4&gt;&#xA;&lt;p&gt;信息收集发现存在一个以root权限使用chown更改文件所有者的定时任务，且不规范的使用了通配符&lt;code&gt;*&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240925223748726-1094626186.png&#34; alt=&#34;image-20240925223746089&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;根据内容发现&lt;code&gt;/tmp/pass/&lt;/code&gt;目录下有个root.pass的密码文件，但没有权限读取：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240924110842487-675688650.png&#34; alt=&#34;image-20240924110841359&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;这里可以尝试利用上面定时任务中不规范的命令&lt;/p&gt;&#xA;&lt;p&gt;新建两个名为a.pass、&amp;ndash;reference=a.pass的文件：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &amp;gt; a.pass&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &amp;gt;--reference&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;a.pass&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此时，若定时任务以root权限执行&lt;code&gt;cd /tmp/pass&amp;amp;&amp;amp;/bin/chown -R root:root *.pass&lt;/code&gt;，由于&lt;code&gt;*&lt;/code&gt;的存在，我们新建的文件也会被带入命令，而&lt;code&gt;--reference=a.pass&lt;/code&gt;文件会被当作是chown命令的参数处理，那么实际上的命令就会变成：将当前目录所有.pass文件所属组改为a.pass文件的所属组&lt;/p&gt;&#xA;&lt;p&gt;等待定时任务执行发现root.pass的所有者变成了yuy0ung：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240924113556320-662327273.png&#34; alt=&#34;image-20240924113554673&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;接下来即可直接读取root.pass文件：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240924113643513-242882547.png&#34; alt=&#34;image-20240924113642142&#34;&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;tar通配符注入提权&#34;&gt;tar+通配符注入提权&lt;/h3&gt;&#xA;&lt;p&gt;tar是linux中常用的文件归档工具&lt;/p&gt;&#xA;&lt;p&gt;在实际生产环境中，我们可能会通过定时任务使用tar去备份网站文件、日志文件&lt;/p&gt;&#xA;&lt;p&gt;当定时任务中调用了tar且使用了通配符，可能导致权限提升&lt;/p&gt;&#xA;&lt;p&gt;通配符注入主要在于&lt;code&gt;--checkpoint-action&lt;/code&gt;和&lt;code&gt;--checkpoint&lt;/code&gt;这两个参数的利用&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;参数&lt;/th&gt;&#xA;          &lt;th&gt;功能&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&amp;ndash;checkpoint-action=ACTION&lt;/td&gt;&#xA;          &lt;td&gt;每隔[NUMBER]个记录显示进度信息（默认为10个）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&amp;ndash;checkpoint[=NUMBER]&lt;/td&gt;&#xA;          &lt;td&gt;在每个检查点上执行ACTION&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h4 id=&#34;场景复现&#34;&gt;场景复现&lt;/h4&gt;&#xA;&lt;p&gt;这个场景在云尘靶场的&lt;strong&gt;linux提权系列-3&lt;/strong&gt;中考察了，这里直接给出我的wp作为参考：&lt;a href=&#34;https://yuy0ung.github.io/blog/%E6%B8%97%E9%80%8F/%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0/%E4%BA%91%E5%B0%98%E9%9D%B6%E5%9C%BA-linux%E6%8F%90%E6%9D%83%E7%B3%BB%E5%88%97/&#34;&gt;云尘靶场-Linux提权系列WP&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;rsync通配符注入提权&#34;&gt;rsync+通配符注入提权&lt;/h3&gt;&#xA;&lt;p&gt;rsync是一个用于在两台计算机之间同步文件的命令行工具&lt;/p&gt;</description>
    </item>
    <item>
      <title>rbash逃逸</title>
      <link>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/rbash%E9%80%83%E9%80%B8/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/rbash%E9%80%83%E9%80%B8/</guid>
      <description>&lt;h1 id=&#34;rbash逃逸&#34;&gt;rbash逃逸&lt;/h1&gt;&#xA;&lt;h3 id=&#34;何为rbash&#34;&gt;何为rbash&lt;/h3&gt;&#xA;&lt;p&gt;rbash(The restricted mode of bash),也就是限制型bash；是平时所谓的 restricted shell的一种，也是最常见的 restricted shell（rbash、ksh、rsh等）&lt;/p&gt;&#xA;&lt;p&gt;rhash可能会设置一些限制：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;不能使用cd命令（即不能更改目录）&lt;/li&gt;&#xA;&lt;li&gt;不能设置或取消环境变量：SHELL， PATH， ENV， BASH_ENV&lt;/li&gt;&#xA;&lt;li&gt;导入功能受限&lt;/li&gt;&#xA;&lt;li&gt;命令中文件名中不能包含 &amp;lsquo;/ &amp;rsquo; 或&amp;rsquo;-&amp;rsquo;&lt;/li&gt;&#xA;&lt;li&gt;不能使用使用 &amp;gt;，&amp;gt;|， &amp;lt;&amp;gt;， &amp;gt;&amp;amp;， &amp;amp;&amp;gt;， &amp;raquo; 等重定向操作符&lt;/li&gt;&#xA;&lt;li&gt;不能使用 unset 命令来取消环境变量或 shell 函数&lt;/li&gt;&#xA;&lt;li&gt;只能执行 PATH 环境变量中指定的命令，而且 PATH 环境变量通常只包含一些基本的命令，例如 ls, cat, echo 等&lt;/li&gt;&#xA;&lt;li&gt;&amp;hellip;&amp;hellip;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;rbash提高了安全性，但对我们getshell后的相关操作造成了很多限制（比如反弹shell）&lt;/p&gt;&#xA;&lt;h3 id=&#34;启用rbash&#34;&gt;启用rbash&lt;/h3&gt;&#xA;&lt;p&gt;首先创建用户：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo adduser tw&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;创建rbash软连接:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /bin&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ln -s bash rbash&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后启用rbash：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo usermod -s /bin/rbash tw&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;rbash逃逸-1&#34;&gt;rbash逃逸&lt;/h3&gt;&#xA;&lt;p&gt;本质是使用某种方法获取一个新的shell，下面提到的方法都有前提条件，比如命令/工具/语言要存在，或某个特殊符号未受限制（如&lt;code&gt;/&lt;/code&gt;）&lt;/p&gt;&#xA;&lt;h4 id=&#34;1利用常见应用文件&#34;&gt;1.利用常见应用/文件&lt;/h4&gt;&#xA;&lt;p&gt;使用Linux现有的软件，执行命令获取一个shell&lt;/p&gt;&#xA;&lt;h5 id=&#34;vi编辑器&#34;&gt;vi编辑器&lt;/h5&gt;&#xA;&lt;p&gt;打开vi，在末行模式执行命令：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;:set shell=/bin/bash&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;shell&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;即可实现逃逸&lt;/p&gt;</description>
    </item>
    <item>
      <title>sudo相关提权思路</title>
      <link>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/sudo%E7%9B%B8%E5%85%B3%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/sudo%E7%9B%B8%E5%85%B3%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF/</guid>
      <description>&lt;h1 id=&#34;sudo相关提权思路&#34;&gt;sudo相关提权思路&lt;/h1&gt;&#xA;&lt;p&gt;sudo（super user do）是linux系统中用于管理用户权限的工具，允许普通用户在无需切换到超级用户的情况下以root身份执行命令，通常，在使用sudo命令时，用户需要输入自己的密码验证自己是否有权限使用，如果没有权限，会告知用户：该用户不在sudoers文件中，这个事件将会被报告&lt;/p&gt;&#xA;&lt;p&gt;如果sudo配置不当，可能导致安全隐患&lt;/p&gt;&#xA;&lt;h3 id=&#34;一sudo权限分配不当&#34;&gt;一、sudo权限分配不当&lt;/h3&gt;&#xA;&lt;p&gt;当配置普通用户sudo权限时，设置了免密的sudo用户，即该用户不需要输入口令即可执行特权命令&lt;/p&gt;&#xA;&lt;p&gt;我们通常使用如下命令查看当前sudo权限：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo -l&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;而有一部分命令如果能免密执行，则可以进行权限提升的利用，这也是我们常说的sudo提权&lt;/p&gt;&#xA;&lt;p&gt;sudo的基本利用思路有如下几种：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;免密使用sudo权限执行某些命令，重新获取一个root身份的shell&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;某些工具允许免密sudo运行，且能够运行脚本/配置文件，可以修改脚本/配置文件实现获取一个root身份的shell&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;免密使用sudo权限执行某些命令，获取/etc/shadow第一行root的密码哈希，再进行爆破获取明文密码&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;免密使用sudo权限执行某些命令，用新的root密码哈希覆盖掉原本的/etc/shadow&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;（思路选择的推荐度按序降低，越靠后的思路，对主机造成的影响越大）&lt;/p&gt;&#xA;&lt;p&gt;由于能利用的场景太多，这里不作赘述，&lt;strong&gt;利用命令均可在这个网站上查询&lt;/strong&gt;：&lt;a href=&#34;https://gtfobins.github.io/&#34;&gt;GTFOBins&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以参考文章学习：&lt;a href=&#34;https://www.huangmj.com/17116743651246.html&#34;&gt;Linux提权之Sudo 70种提权方法&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;二sudo脚本篡改提权&#34;&gt;二、sudo脚本篡改提权&lt;/h3&gt;&#xA;&lt;p&gt;另一种情况，管理员可能会将某个shell脚本设置为sudo免密执行，如果低权限用户对该文件可写，那么我们可以将提权代码写入该文件，实现权限提升。我们配置如下场景（实验环境为centos 7）：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;首先以root身份配置：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;groupadd yuy0ung  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 创建一个名为 yuy0ung 的新组&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;useradd -d /home/yuy0ung -m yuy0ung -g yuy0ung -s /bin/bash -p &lt;span class=&#34;m&#34;&gt;123456&lt;/span&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 添加用户 yuy0ung，指定主目录为 /home/yuy0ung，若不存在则创建；设置默认 shell 为 /bin/bash；设置组为 yuy0ung；设定密码为 123456&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p ~yuy0ung/demo  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 创建目录 /home/yuy0ung/demo，若上级目录不存在，则一并创建&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown yuy0ung:yuy0ung ~yuy0ung/demo  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 将目录 /home/yuy0ung/demo 的所有者和所属组更改为 yuy0ung&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod a+x ~yuy0ung/demo  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 为所有用户增加 /home/yuy0ung/demo 目录的执行权限&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;yuy0ung ALL=(root) NOPASSWD:/home/yuy0ung/demo/shell.sh&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sudoers  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 允许 yuy0ung 用户在不输入密码的情况下以 root 身份执行 /home/yuy0ung/demo/shell.sh 脚本，将此配置追加到 /etc/sudoers 文件中&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;然后切换到yuy0ung：&lt;/p&gt;</description>
    </item>
    <item>
      <title>suid相关提权思路</title>
      <link>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/suid%E7%9B%B8%E5%85%B3%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF/</link>
      <pubDate>Thu, 11 Dec 2025 00:00:00 +0800</pubDate>
      <guid>https://luoshine99-gif.github.io/blog/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/linux%E6%8F%90%E6%9D%83/suid%E7%9B%B8%E5%85%B3%E6%8F%90%E6%9D%83%E6%80%9D%E8%B7%AF/</guid>
      <description>&lt;h1 id=&#34;suid相关提权思路&#34;&gt;suid相关提权思路&lt;/h1&gt;&#xA;&lt;p&gt;SetUID是linux的一种安全机制，允许用户在执行特定文件时暂时将其有效用户ID改为该文件&lt;strong&gt;所有者&lt;/strong&gt;的用户ID。这样，即使当前用户没有执行该文件的权限，也可以执行该文件。&lt;/p&gt;&#xA;&lt;p&gt;使用如下命令为目标文件添加suid权限：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod u+s /etc/passwd&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;只有可以执行的二进制程序文件才能设定SUID权限,非二进制文件设置SUID权限没任何意义&lt;/li&gt;&#xA;&lt;li&gt;命令执行者要对该程序文件拥有执行(x)权限才能使用&lt;/li&gt;&#xA;&lt;li&gt;SUID权限只在该程序执行过程中有效,也就是说身份改变只在程序执行过程中有效&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 id=&#34;suid配置不当提权&#34;&gt;suid配置不当提权&lt;/h3&gt;&#xA;&lt;p&gt;如果suid配置不当，可能会导致权限提升，原理也是利用被赋予suid权限的文件命令执行，获取一个新的高权限的shell&lt;/p&gt;&#xA;&lt;p&gt;我们以find命令为例配置一个实验场景（&lt;code&gt;chmod u+s /usr/bin/find&lt;/code&gt;即可）：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;我们现在的shell是普通用户yuy0ung的身份，尝试利用suid来提权：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240717172809230-494087304.png&#34; alt=&#34;image-20240717172808397&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;首先查找所有配置了suid权限的文件：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;find / -perm -4000 -type f -exec ls -la &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt; 2&amp;gt;/dev/null &lt;span class=&#34;se&#34;&gt;\;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里选项参数是这样设置的：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;-type f: 只查找普通文件，排除目录等其他类型的文件&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;-exec ls -la {} 2&amp;gt;/dev/null ;: 对查找到的文件执行 ls -la 命令，2&amp;gt;/dev/null 表示将标准错误输出重定向到 /dev/null，以避免显示不必要的错误信息&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;-perm匹配权限：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;4000&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2000&lt;/span&gt; 1000分别表示SUID SGID SBIT&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1.普通文件，文件的权限一般三位，777最高文件权限&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-perm -0777搜索的就是最高权限的文件rwxrwxrwx&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-perm +0777搜索的只要包含rwxrwxrwx任意一个的文件&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2.特殊文件，包含权限位置四位，7000为最高，即–s–s–t，同样的方法&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-perm -7000搜索的就是最高权限的文件–s–s–t&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-perm +7000搜索的只要包含–s–s–t任意一个的文件，–s — —（4000）、— –s —（2000）、— — –t（1000）等&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240717173215355-197029552.png&#34; alt=&#34;image-20240717173214585&#34;&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;根据查找结果可以看到&lt;code&gt;/usr/bin/find&lt;/code&gt;被赋予了suid权限，而他的所有者为root，我们可以这样获取一个root权限的shell：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;find /etc/passwd -exec /bin/bash -p &lt;span class=&#34;se&#34;&gt;\;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://yuy0ung.oss-cn-chengdu.aliyuncs.com/3450279-20240717174407805-64360826.png&#34; alt=&#34;image-20240717174407310&#34;&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
