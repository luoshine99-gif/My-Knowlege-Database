(()=>{document.addEventListener("DOMContentLoaded",()=>{console.log("Yuque Pro: JS Loaded");let m=document.getElementById("checkbox"),E=document.documentElement;E.getAttribute("data-theme")==="dark"&&m&&(m.checked=!0),m&&m.addEventListener("change",()=>{let e=m.checked?"dark":"light";E.setAttribute("data-theme",e),localStorage.setItem("theme",e),console.log("Theme changed to:",e)}),document.addEventListener("click",e=>{if(e.treeToggleHandled)return;let t=e.target.closest(".tree-toggle"),n=e.target.closest(".section-link"),o=t||n;if(!o)return;console.log("Tree toggle triggered by:",o);let l=o.closest("li");if(!l){console.log("No parent li found");return}e.treeToggleHandled=!0;let c=null,r=null;for(let s=0;s<l.children.length;s++){let i=l.children[s];i.classList.contains("tree-children")&&(c=i),i.classList.contains("tree-toggle")&&(r=i)}if(!c||!r){if(console.log("Missing children or toggleIcon (direct check)",{children:c,toggleIcon:r}),!c){let s=l.querySelector(".tree-children");s&&s.parentElement===l&&(c=s)}if(!r){let s=l.querySelector(".tree-toggle");s&&s.parentElement===l&&(r=s)}if(!c||!r){console.log("Still missing children or toggleIcon after fallback");return}}console.log("Toggling tree section"),e.preventDefault(),e.stopPropagation(),c.classList.contains("hidden")?(console.log("Opening section"),c.classList.remove("hidden"),c.style.display="block",r.classList.remove("collapsed"),r.classList.add("expanded")):(console.log("Closing section"),c.classList.add("hidden"),c.style.display="none",r.classList.remove("expanded"),r.classList.add("collapsed"))});let y=window.location.pathname;console.log("Current URL:",y),document.querySelectorAll(".tree a").forEach(e=>{let t=e.getAttribute("href");if(t&&(t===y||t.replace(/\/$/,"")===y.replace(/\/$/,""))){e.style.fontWeight="bold",e.style.color="var(--link-color)";let n=e.closest(".tree-children");for(;n;){n.classList.remove("hidden"),n.style.display="block";let o=n.parentElement.querySelector(".tree-toggle");o&&(o.classList.remove("collapsed"),o.classList.add("expanded")),n=n.parentElement.closest(".tree-children")}}});let d=document.createElement("div");d.className="preview-tooltip",document.body.appendChild(d);let b;document.querySelectorAll(".homepage-tree .article-link").forEach(e=>{e.addEventListener("mouseenter",t=>{if(window.innerWidth<=768)return;let n=e.getAttribute("data-summary");if(!n)return;let o=t.clientX,l=t.clientY;b=setTimeout(()=>{let c=n.length>200?n.substring(0,200)+"...":n;d.textContent=c,d.style.display="block";let r=o+15,s=l+15,i=500;r+i>window.innerWidth&&(r=o-i-15),s+150>window.innerHeight&&(s=l-140),d.style.left=`${r}px`,d.style.top=`${s}px`,d.style.position="fixed"},500)}),e.addEventListener("mouseleave",()=>{clearTimeout(b),d.style.display="none"})}),document.querySelectorAll("pre").forEach(e=>{if(e.closest(".code-wrapper"))return;let t=document.createElement("div");t.className="code-wrapper",e.parentNode.insertBefore(t,e),t.appendChild(e);let n=document.createElement("button");n.className="copy-btn",n.textContent="Copy",n.addEventListener("click",()=>{let o=e.querySelector("code"),l=o?o.innerText:e.innerText;navigator.clipboard.writeText(l).then(()=>{n.textContent="Copied!",setTimeout(()=>{n.textContent="Copy"},2e3)}).catch(c=>{console.error("Failed to copy:",c),n.textContent="Error"})}),t.appendChild(n)});let w=document.querySelector(".markdown-body");if(w){let e=document.querySelector(".post-title-template"),t=document.querySelector(".post-date"),n=w.querySelector("h1");n&&(e&&(e.style.display="none"),t&&n.after(t))}let x=document.querySelectorAll("#TableOfContents a"),k=Array.from(x).map(e=>{let t=e.getAttribute("href").slice(1);return document.getElementById(t)}).filter(e=>e!==null);if(k.length>0){let e=o=>{o.forEach(l=>{if(l.isIntersecting){x.forEach(s=>s.classList.remove("active"));let c=l.target.id,r=document.querySelector(`#TableOfContents a[href="#${c}"]`);if(r){r.classList.add("active");let s=document.querySelector(".sidebar-right");if(s){let i=r.getBoundingClientRect(),f=s.getBoundingClientRect(),L=i.top-f.top,$=i.bottom-f.top;(L<0||$>s.clientHeight)&&s.scrollTo({top:r.offsetTop-s.clientHeight/2+r.clientHeight/2,behavior:"smooth"})}}}})},t={root:null,rootMargin:"0px 0px -80% 0px",threshold:0},n=new IntersectionObserver(e,t);k.forEach(o=>n.observe(o))}let T=document.getElementById("search-trigger"),u=document.getElementById("search-modal"),g=document.getElementById("search-input"),p=document.getElementById("search-results"),S=document.querySelector(".search-loading"),h=null,a=-1,C=e=>{let t=document.querySelector(".search-modal-content");if(e&&e.type==="click"&&e.currentTarget){let n=e.currentTarget.getBoundingClientRect(),o=n.left+n.width/2,l=n.top+n.height/2,c=window.innerWidth,r=Math.min(600,c*.9),s=(c-r)/2,i=window.innerHeight*.15,f=o-s,L=l-i;t.style.transformOrigin=`${f}px ${L}px`}else t.style.transformOrigin="center top";u.classList.add("open"),g.focus(),h||A()},v=()=>{u.classList.add("closing"),u.classList.remove("open"),setTimeout(()=>{u.classList.remove("closing"),g.value="",p.innerHTML="",a=-1},200)};T&&T.addEventListener("click",C);let B=document.getElementById("mobile-search-trigger");B&&B.addEventListener("click",C);let I=document.getElementById("mobile-exit-btn"),q=document.getElementById("mobile-search-btn");I&&I.addEventListener("click",v),q&&q.addEventListener("click",()=>{let e=new Event("input",{bubbles:!0});g.dispatchEvent(e),g.blur()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&u.classList.contains("open")&&v()}),u.addEventListener("click",e=>{e.target===u&&v()});let A=async()=>{S.style.display="block";try{h=await(await fetch("/index.json?t="+new Date().getTime())).json(),console.log("Search index loaded, items:",h?h.length:0)}catch(e){console.error("Failed to load search index:",e),p.innerHTML='<div style="padding:20px;text-align:center;">Failed to load search index.</div>'}finally{S.style.display="none"}};g.addEventListener("input",e=>{let t=e.target.value.toLowerCase().trim();if(!t){p.innerHTML="",a=-1;return}if(!h)return;let n=h.filter(o=>{let l=o.title&&o.title.toLowerCase().includes(t),c=o.content&&o.content.toLowerCase().includes(t);return l||c}).slice(0,50);M(n)});let M=e=>{if(e.length===0){p.innerHTML='<div style="padding:20px;text-align:center;color:var(--text-color);opacity:0.6;">No results found.</div>';return}let t="";e.forEach((n,o)=>{t+=`
        <div class="search-result-item" data-index="${o}" onclick="window.location.href='${n.link}'">
          <span class="search-result-title">${n.title}</span>
          <span class="search-result-excerpt">${n.summary||"No summary available."}</span>
        </div>
      `}),p.innerHTML=t,a=-1};g.addEventListener("keydown",e=>{let t=document.querySelectorAll(".search-result-item");t.length!==0&&(e.key==="ArrowDown"?(e.preventDefault(),a=(a+1)%t.length,H(t)):e.key==="ArrowUp"?(e.preventDefault(),a=(a-1+t.length)%t.length,H(t)):e.key==="Enter"&&(e.preventDefault(),a>=0?t[a].click():t.length>0&&t[0].click()))});let H=e=>{e.forEach((t,n)=>{n===a?(t.classList.add("selected"),t.scrollIntoView({block:"nearest"})):t.classList.remove("selected")})}});})();
